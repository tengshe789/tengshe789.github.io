<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>tEngSHe789ã®å°ç«™</title>
  <icon>https://www.gravatar.com/avatar/daec6fa7cb1df4f13fb41049b91a3c4f</icon>
  <subtitle>éšæ€§è€Œè¡Œï¼Œä¸è¡Œæ‹‰å€’</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://tengshe789.github.io/"/>
  <updated>2020-07-01T14:27:18.335Z</updated>
  <id>https://tengshe789.github.io/</id>
  
  <author>
    <name>tEngSHe789</name>
    <email>randyvan007@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>window terminal ç©æ³•å¤§å…¨</title>
    <link href="https://tengshe789.github.io/2020/07/01/window-terminal-%E7%8E%A9%E6%B3%95%E5%A4%A7%E5%85%A8/"/>
    <id>https://tengshe789.github.io/2020/07/01/window-terminal-ç©æ³•å¤§å…¨/</id>
    <published>2020-07-01T14:18:06.000Z</published>
    <updated>2020-07-01T14:27:18.335Z</updated>
    
    <content type="html"><![CDATA[<h2 id="window-terminal-ç©æ³•å¤§å…¨"><a href="#window-terminal-ç©æ³•å¤§å…¨" class="headerlink" title="window terminal ç©æ³•å¤§å…¨"></a>window terminal ç©æ³•å¤§å…¨</h2><h3 id="æ·»åŠ åˆ°å³é”®èœå•"><a href="#æ·»åŠ åˆ°å³é”®èœå•" class="headerlink" title="æ·»åŠ åˆ°å³é”®èœå•"></a>æ·»åŠ åˆ°å³é”®èœå•</h3><h4 id="ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹"><a href="#ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹"></a>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹</h4><p>é¦–å…ˆæ‰“å¼€<code>cmd</code>ï¼Œæ³¨æ„ï¼Œ<code>gitbash</code>æ— æ•ˆã€‚</p><p>è¿è¡Œä¸‹æ–¹å‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir <span class="string">"%USERPROFILE%\AppData\Local\Terminal"</span></span><br></pre></td></tr></table></figure><h4 id="ç¬¬äºŒæ­¥ï¼Œä¸‹è½½window-terminal-icoå›¾æ ‡"><a href="#ç¬¬äºŒæ­¥ï¼Œä¸‹è½½window-terminal-icoå›¾æ ‡" class="headerlink" title="ç¬¬äºŒæ­¥ï¼Œä¸‹è½½window terminal icoå›¾æ ‡"></a>ç¬¬äºŒæ­¥ï¼Œä¸‹è½½window terminal icoå›¾æ ‡</h4><p>æ‰“å¼€ä¸‹æ–¹ç½‘å€ï¼Œå°†å›¾æ ‡å¤åˆ¶åˆ°ä¸Šæ–¹ï¼Œå‘½ä»¤çš„è·¯å¾„</p><p><a href="https://raw.githubusercontent.com/microsoft/terminal/master/res/terminal.ico" target="_blank" rel="noopener">https://raw.githubusercontent.com/microsoft/terminal/master/res/terminal.ico</a></p><h4 id="ç¬¬ä¸‰æ­¥ï¼Œæ·»åŠ æ³¨å†Œè¡¨æ–‡ä»¶"><a href="#ç¬¬ä¸‰æ­¥ï¼Œæ·»åŠ æ³¨å†Œè¡¨æ–‡ä»¶" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼Œæ·»åŠ æ³¨å†Œè¡¨æ–‡ä»¶"></a>ç¬¬ä¸‰æ­¥ï¼Œæ·»åŠ æ³¨å†Œè¡¨æ–‡ä»¶</h4><p>åˆ›å»ºæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼Œé‡å‘½åæˆ<code>.reg</code>æ ¼å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Directory\Background\shell\wt]</span><br><span class="line">@=&quot;Windows Terminal here&quot;</span><br><span class="line">&quot;Icon&quot;=&quot;C:\\Users\\[ä½ çš„ç”¨æˆ·å]\\AppData\\Local\\Terminal\\terminal.ico&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Directory\Background\shell\wt\command]</span><br><span class="line">@=&quot;C:\\Users\\[ä½ çš„ç”¨æˆ·å]\\AppData\\Local\\Microsoft\\WindowsApps\\wt.exe&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;window-terminal-ç©æ³•å¤§å…¨&quot;&gt;&lt;a href=&quot;#window-terminal-ç©æ³•å¤§å…¨&quot; class=&quot;headerlink&quot; title=&quot;window terminal ç©æ³•å¤§å…¨&quot;&gt;&lt;/a&gt;window terminal ç©æ³•å¤§å…¨&lt;/h2&gt;&lt;
      
    
    </summary>
    
    
      <category term="è½¯ä»¶åˆ†äº«" scheme="https://tengshe789.github.io/tags/%E8%BD%AF%E4%BB%B6%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>å¿«é€Ÿgit pullæ›´æ–°æ‰€æœ‰é¡¹ç›®æ–‡ä»¶</title>
    <link href="https://tengshe789.github.io/2019/09/17/%E5%BF%AB%E9%80%9Fgit-pull%E6%89%80%E6%9C%89%E9%A1%B9%E7%9B%AE%E6%96%87%E4%BB%B6/"/>
    <id>https://tengshe789.github.io/2019/09/17/å¿«é€Ÿgit-pullæ‰€æœ‰é¡¹ç›®æ–‡ä»¶/</id>
    <published>2019-09-17T11:24:03.000Z</published>
    <updated>2019-11-20T13:39:41.382Z</updated>
    
    <content type="html"><![CDATA[<p>æ²³èŸ¹ï¼Œæœ¬å±±å¤§ç‹å›æ¥äº†ã€‚å›æƒ³ä¸€ä¸‹ï¼Œå·²ç»å¤§æ¦‚æ•´æ•´7ä¸ªæœˆæ²¡ç”¨æ›´æ–°åšå®¢äº†ï¼ï¼ï¼ç­‰æˆ‘æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œå±…ç„¶è¿markdownéƒ½ä¸ä¼šå†™äº†ï¼Œç½ªæ¶ç½ªæ¶ã€‚ä»Šæ—¥ï¼Œé‡æ‹¾æˆ‘çš„çº¸å¸ï¼Œç»§ç»­æ›´æ–°åšå®¢ï¼Œè¯·å„ä½çœ‹å®¢ç»™äºˆé¼“åŠ±ã€‚</p><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>æ•…äº‹çš„å¼€å§‹æ˜¯è¿™æ ·çš„ï¼Œæœ‰ä½æ¬ç –å·¥ï¼Œåå­—å«å°å¾ï¼Œä»–æ‰€åœ¨çš„å…¬å¸ç”¨çš„æ˜¯<code>VMware Horizon 7</code>è™šæ‹Ÿæ¡Œé¢ç¯å¢ƒï¼Œè½¯ä»¶å¼€å‘æ ¹æœ¬è¿ä¸ä¸Šå¤–éƒ¨ç½‘ç»œï¼Œè¿™è®©ä»–éå¸¸è‹¦æ¼ã€‚</p><p>çªç„¶æœ‰ä¸€å¤©ï¼Œå…¬å¸å†…éƒ¨å¤§å˜é©ï¼Œè¦å¼€å§‹ä½¿ç”¨mavenç§æœï¼Œè¦å¼€å§‹ä½¿ç”¨å†…éƒ¨PaaSï¼Œè¿™è®©å°å¾å¿ƒé‡Œä¹å¼€äº†èŠ±ã€‚â€œå¯æ˜¯æ–°çŸ¥è¯†å¤ªå¤šï¼Œè¿™è¯¥å¦‚ä½•å­¦ä¹ å‘¢ï¼Ÿâ€å°å¾æ³›èµ·äº†å˜€å’•ã€‚</p><p>åŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œåœ¨å°å¾çš„æ—¥å¤œåŠªåŠ›ä¸­ï¼Œåœ¨ä¸€ä¸ªå·ç§°å…¨çƒæœ€å¤§çš„åŒæ€§äº¤å‹ç½‘ç«™ä¸Šï¼Œæ‰¾åˆ°äº†å¾ˆå¤šå­¦ä¹ èµ„æ–™ã€‚å°å¾åœ¨è‡ªå·±æŸ¥è¯¢å¤–éƒ¨äº’è”ç½‘èµ„æ–™çš„ç¬”è®°æœ¬ä¸Šï¼Œç†Ÿç»ƒçš„git cloneå„ç§å„æ ·çš„ä»“åº“ï¼Œå¾ˆå¿«ï¼Œæ»¡æ»¡ä¸€ä¸ªç¡¬ç›˜éƒ½æ˜¯è¿™äº›ä»“åº“çš„æ–‡ä»¶å¤¹ã€‚</p><p>æ—¶é—´è¿‡çš„å¾ˆå¿«ï¼Œè½¬çœ¼7ä¸ªæœˆè¿‡å»äº†ã€‚</p><p>æŠ€æœ¯å˜åŒ–çš„å¾ˆå¿«ï¼Œè½¬çœ¼ï¼Œæ»¡æ»¡ç¡¬ç›˜çš„å­¦ä¹ èµ„æ–™éƒ½è¿‡æ—¶äº†ï¼Œæ€ä¹ˆä¸€ä¸‹å­å°†ä»–ä»¬æ›´æ–°å‘¢ï¼Ÿ</p><p>ä»¥ä¸Šå°±æ˜¯å°å¾å‘æˆ‘æå‡ºäº†éœ€æ±‚ã€‚</p><h3 id="è®¾è®¡è½¯ä»¶"><a href="#è®¾è®¡è½¯ä»¶" class="headerlink" title="è®¾è®¡è½¯ä»¶"></a>è®¾è®¡è½¯ä»¶</h3><p>pythonæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ï¼ğŸ˜†</p><p>è®¾è®¡æ€è·¯å¾ˆç®€å•ï¼Œåˆ¤æ–­å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶å¤¹ä¸­ï¼Œæ˜¯å¦å…¶ä¸­åŒ…å«åç¼€æ˜¯<code>.git</code>çš„æ–‡ä»¶å¤¹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸ºä»“åº“ï¼Œè¿›è¡Œæ›´æ–°ï¼Œä¸æ˜¯å°±è·³è¿‡ã€‚</p><p>å…¶ä¸­éœ€è¦ä¾èµ–<code>gitpython</code>è¿™ä¸ªåŒ…ï¼Œæ¥è¿›è¡Œgit pullæ“ä½œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> git</span><br><span class="line"><span class="keyword">from</span> git <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isGitDir</span><span class="params">(dir)</span>:</span></span><br><span class="line">    repdir = os.path.join(os.path.abspath(<span class="string">'.'</span>), dir)</span><br><span class="line">    repgitdir = os.path.join(repdir, <span class="string">'.git'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(repgitdir):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">updateSub</span><span class="params">(subdir)</span>:</span></span><br><span class="line">    repdir = os.path.join(os.path.abspath(<span class="string">'.'</span>), subdir)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        repo = git.Repo(repdir)</span><br><span class="line">        <span class="keyword">if</span> repo.is_dirty():</span><br><span class="line">            dirSubDir.append(subdir)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        remote = repo.remote()</span><br><span class="line">        print(<span class="string">"start pulling from remote for: %s\r\n"</span> %subdir)</span><br><span class="line">        remote.pull()</span><br><span class="line">        print(<span class="string">"Done pulling for %s\r\n"</span> %subdir)</span><br><span class="line">    <span class="keyword">except</span> NoSuchPathError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> InvalidGitRepositoryError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">currDir = os.path.abspath(<span class="string">'.'</span>)</span><br><span class="line">subDirs = [x <span class="keyword">for</span> x <span class="keyword">in</span> os.listdir(<span class="string">'.'</span>) <span class="keyword">if</span> isGitDir(x)]</span><br><span class="line">print(<span class="string">"ready to update git repo:"</span>)</span><br><span class="line"><span class="keyword">for</span> dir <span class="keyword">in</span> subDirs:</span><br><span class="line">    print(dir+ <span class="string">'\r\n'</span>)</span><br><span class="line">dirSubDir = []</span><br><span class="line">poole = []</span><br><span class="line"><span class="keyword">for</span> subdir <span class="keyword">in</span> subDirs:</span><br><span class="line">    t = threading.Thread(target=updateSub,args=(subdir,))</span><br><span class="line">    t.start()</span><br><span class="line">    poole.append(t)</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> poole:</span><br><span class="line">    t.join(<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'\r\n'</span>)</span><br><span class="line"><span class="keyword">if</span> len(dirSubDir)!= <span class="number">0</span>:</span><br><span class="line">    print(<span class="string">'these repos have uncommitted changes:'</span>)</span><br><span class="line">    <span class="keyword">for</span> dirtyDir <span class="keyword">in</span> dirSubDir:</span><br><span class="line">        print(<span class="string">'dir %s has uncommited change, please check'</span> % dirtyDir)</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•æŠ•äº§"><a href="#æµ‹è¯•æŠ•äº§" class="headerlink" title="æµ‹è¯•æŠ•äº§"></a>æµ‹è¯•æŠ•äº§</h3><p>æ‰“å¼€ç”µè„‘ï¼Œåœ¨cmdä¸­è¿è¡Œ<code>pip install gitpython</code>æˆ–è€…<code>conda install gitpython</code>ï¼Œæ¥å®‰è£…å¿…è¦çš„åŒ…ã€‚</p><p>å°†ä¸Šè¿°æ–‡ä»¶ä¿å­˜åˆ°ä»“åº“çš„ç›®å½•ï¼Œå¹¶ä¸”å‘½åä¸º<code>update.py</code>ï¼Œå³é”®ä½¿ç”¨VS Codeè¿è¡Œï¼Œå³å¯å‘ç°ç›®å½•ä¸­æ‰€æœ‰ä»“åº“éƒ½æˆåŠŸgit pull äº†ï¼Œå¤§æˆåŠŸï¼</p><h3 id="ç»­1sæ—¶é—´"><a href="#ç»­1sæ—¶é—´" class="headerlink" title="ç»­1sæ—¶é—´"></a>ç»­1sæ—¶é—´</h3><p>å†™å®Œè¿™ä¸ªåšå®¢çš„æ—¶å€™ï¼Œå·å·çœ‹äº†ä¸€ä¸‹è®°å½•åšå®¢æµè§ˆé‡çš„ç½‘ç«™ï¼Œçˆ†ç‚¸äº†ï¼ï¼ï¼è¿™7ä¸ªæœˆæˆ‘ä¸åœ¨çº¿çš„æ—¥å­ï¼Œè¿™ä¹ˆå¤šäººè®¿é—®æˆ‘åšå®¢å•Šã€‚å¾ˆå¼€å¿ƒï¼Œè°¢è°¢ä½ é‚£ä¹ˆå¯çˆ±ï¼Œè¿˜ä¸€ç›´å…³æ³¨ç€æˆ‘~â¤ğŸ˜</p><p>å…¨ç‰‡ç»“æŸï¼Œè§‰å¾—æˆ‘å†™çš„ä¸é”™ï¼Ÿæƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿèµ¶å¿«æ‰“å¼€æˆ‘çš„ğŸ‘‰ä¸ªäºº<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">åšå®¢</a> ğŸ‘ˆå§ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ²³èŸ¹ï¼Œæœ¬å±±å¤§ç‹å›æ¥äº†ã€‚å›æƒ³ä¸€ä¸‹ï¼Œå·²ç»å¤§æ¦‚æ•´æ•´7ä¸ªæœˆæ²¡ç”¨æ›´æ–°åšå®¢äº†ï¼ï¼ï¼ç­‰æˆ‘æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œå±…ç„¶è¿markdownéƒ½ä¸ä¼šå†™äº†ï¼Œç½ªæ¶ç½ªæ¶ã€‚ä»Šæ—¥ï¼Œé‡æ‹¾æˆ‘çš„çº¸å¸ï¼Œç»§ç»­æ›´æ–°åšå®¢ï¼Œè¯·å„ä½çœ‹å®¢ç»™äºˆé¼“åŠ±ã€‚&lt;/p&gt;
&lt;h3 id=&quot;éœ€æ±‚åˆ†æ&quot;&gt;&lt;a href=&quot;#éœ€æ±‚åˆ†æ&quot; class
      
    
    </summary>
    
    
      <category term="åˆ†äº«" scheme="https://tengshe789.github.io/tags/%E5%88%86%E4%BA%AB/"/>
    
      <category term="çªé—¨" scheme="https://tengshe789.github.io/tags/%E7%AA%8D%E9%97%A8/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†äº«ä¸€ä¸‹å¾®æœåŠ¡ç›‘æ§è½¯ä»¶ä»¥åŠå…¶éƒ¨ç½²</title>
    <link href="https://tengshe789.github.io/2019/02/15/%E5%88%86%E4%BA%AB%E4%B8%80%E4%B8%8B%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7%E8%BD%AF%E4%BB%B6%E4%BB%A5%E5%8F%8A%E5%85%B6%E9%83%A8%E7%BD%B2/"/>
    <id>https://tengshe789.github.io/2019/02/15/åˆ†äº«ä¸€ä¸‹å¾®æœåŠ¡ç›‘æ§è½¯ä»¶ä»¥åŠå…¶éƒ¨ç½²/</id>
    <published>2019-02-15T09:58:03.000Z</published>
    <updated>2019-11-20T13:39:41.189Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å¯»æ‰¾æœ‰åˆ©çš„ç›‘æ§è½¯ä»¶ä¸ºæˆ‘çš„å¾®æœåŠ¡çŒ®èº«ï¼Œäºæ˜¯ä¹æ•´ç†æ–‡æ¡£ï¼Œè¯•éªŒï¼ŒèŠ±äº†å¾ˆé•¿æ—¶é—´ã€‚ä»Šå¤©åˆ†äº«ä¸€ä¸‹æ•´ç†çš„éƒ¨åˆ†å·¥å…·ï¼Œæœ‰æ—¶é—´ä¼šç»§ç»­åœ¨æ­¤postä¸­æ›´æ–°çš„ï¼ğŸ™ƒ</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a>ã€‚</p><h1 id="influxDB"><a href="#influxDB" class="headerlink" title="influxDB"></a>influxDB</h1><h3 id="ä»€ä¹ˆæ˜¯influxDB"><a href="#ä»€ä¹ˆæ˜¯influxDB" class="headerlink" title="ä»€ä¹ˆæ˜¯influxDB"></a>ä»€ä¹ˆæ˜¯influxDB</h3><p>influxDBæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ—¶é—´åºåˆ—æ•°æ®åº“ã€‚cAdvisorä»…ä»…æ˜¾ç¤ºå®æ—¶ä¿¡æ¯ï¼Œä½†æ˜¯ä¸å­˜å‚¨ç›‘è§†æ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æä¾›æ—¶åºæ•°æ®åº“ç”¨äºå­˜å‚¨cAdvisorç»„ä»¶æ‰€æä¾›çš„ç›‘æ§ä¿¡æ¯ï¼Œä»¥ä¾¿æ˜¾ç¤ºé™¤å®æ—¶ä¿¡æ¯ä¹‹å¤–çš„æ—¶åºæ•°æ®ã€‚</p><h3 id="influxDBå®‰è£…"><a href="#influxDBå®‰è£…" class="headerlink" title="influxDBå®‰è£…"></a>influxDBå®‰è£…</h3><p>ï¼ˆ1ï¼‰ä¸‹è½½é•œåƒ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tutum/influxdb</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run â€di \</span><br><span class="line">â€p 8083:8083 \</span><br><span class="line">â€p 8086:8086 \</span><br><span class="line">â€â€expose 8090 \</span><br><span class="line">â€â€expose 8099 \</span><br><span class="line">â€â€name influxsrv \</span><br><span class="line">tutum/influxdb</span><br></pre></td></tr></table></figure></p><p>ç«¯å£æ¦‚è¿°ï¼š 8083ç«¯å£:webè®¿é—®ç«¯å£ 8086:æ•°æ®å†™å…¥ç«¯å£<br>æ‰“å¼€æµè§ˆå™¨ <a href="http://192.168.184.135:8083/" target="_blank" rel="noopener">http://192.168.184.135:8083/</a> (ipè‡ªè§‰æ›¿æ¢)</p><h3 id="influxDBå¸¸ç”¨æ“ä½œ"><a href="#influxDBå¸¸ç”¨æ“ä½œ" class="headerlink" title="influxDBå¸¸ç”¨æ“ä½œ"></a>influxDBå¸¸ç”¨æ“ä½œ</h3><h4 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE &quot;cadvisor&quot;</span><br></pre></td></tr></table></figure><p>å›è½¦åˆ›å»ºæ•°æ®åº“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW DATABASES</span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹æ•°æ®åº“</p><h4 id="åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ"><a href="#åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ" class="headerlink" title="åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ"></a>åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ</h4><p>åˆ›å»ºç”¨æˆ·<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &quot;cadvisor&quot; WITH PASSWORD &apos;cadvisor&apos; WITH ALL PRIVILEGES</span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹ç”¨æˆ·<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW USRES</span><br></pre></td></tr></table></figure></p><p>ç”¨æˆ·æˆæƒ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grant all privileges on cadvisor to cadvisor</span><br><span class="line">grant WRITE on cadvisor to cadvisor</span><br><span class="line">grant READ on cadvisor to cadvisor</span><br></pre></td></tr></table></figure></p><h4 id="æŸ¥çœ‹é‡‡é›†çš„æ•°æ®"><a href="#æŸ¥çœ‹é‡‡é›†çš„æ•°æ®" class="headerlink" title="æŸ¥çœ‹é‡‡é›†çš„æ•°æ®"></a>æŸ¥çœ‹é‡‡é›†çš„æ•°æ®</h4><p>åˆ‡æ¢åˆ°cadvisoræ•°æ®åº“ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹é‡‡é›†çš„æ•°æ®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW MEASUREMENTS</span><br></pre></td></tr></table></figure></p><p>å¦‚æœæƒ³é‡‡é›†ç³»ç»Ÿçš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Cadvisorè½¯ä»¶æ¥å®ç°</p><h3 id="More"><a href="#More" class="headerlink" title="More"></a>More</h3><p>å®˜æ–¹æ–‡æ¡£ ï¼š <a href="https://github.com/influxdata/docs.influxdata.com" target="_blank" rel="noopener">https://github.com/influxdata/docs.influxdata.com</a></p><h1 id="cAdvisor"><a href="#cAdvisor" class="headerlink" title="cAdvisor"></a>cAdvisor</h1><h3 id="å•¥ä¹ˆæ˜¯cAdvisor"><a href="#å•¥ä¹ˆæ˜¯cAdvisor" class="headerlink" title="å•¥ä¹ˆæ˜¯cAdvisor"></a>å•¥ä¹ˆæ˜¯cAdvisor</h3><p>Googleå¼€æºçš„ç”¨äºç›‘æ§åŸºç¡€è®¾æ–½åº”ç”¨çš„å·¥å…·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç›‘æ§å·¥å…·ï¼Œä¸éœ€è¦ä»»ä½•é…ç½®å°±å¯ä»¥é€šè¿‡è¿è¡Œåœ¨Dockerä¸»æœºä¸Šçš„å®¹å™¨æ¥ç›‘æ§Dockerå®¹å™¨ï¼Œè€Œä¸”å¯ä»¥ç›‘æ§Dockerä¸»æœºã€‚</p><h3 id="cAdvisorå®‰è£…"><a href="#cAdvisorå®‰è£…" class="headerlink" title="cAdvisorå®‰è£…"></a>cAdvisorå®‰è£…</h3><p>ï¼ˆ1ï¼‰ä¸‹è½½é•œåƒ<br><code>docker pull google/cadvisor</code><br>ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> â€â€volume=/:/rootfs:ro â€â€volume=/var/run:/var/run:rw â€â€</span></span><br><span class="line"><span class="bash">volume=/sys:/sys:ro â€â€volume=/var/lib/docker/:/var/lib/docker:ro â€â€</span></span><br><span class="line"><span class="bash">publish=8080:8080 â€â€detach=<span class="literal">true</span> â€â€link influxsrv:influxsrv â€â€name=cadvisor</span></span><br><span class="line"><span class="bash">google/cadvisor â€storage_driver=influxdb â€storage_driver_db=cadvisor â€</span></span><br><span class="line"><span class="bash">storage_driver_host=influxsrv:8086</span></span><br></pre></td></tr></table></figure><p>WEBå‰ç«¯è®¿é—®åœ°å€<br><a href="http://192.168.184.135:8080/containers/" target="_blank" rel="noopener">http://192.168.184.135:8080/containers/</a>  (è¯·è‡ªè§‰æ›¿æ¢å®é™…ip)<br>æ€§èƒ½æŒ‡æ ‡å«ä¹‰å‚ç…§å¦‚ä¸‹åœ°å€<br><a href="https://blog.csdn.net/ZHANG_H_A/article/details/53097084" target="_blank" rel="noopener">https://blog.csdn.net/ZHANG_H_A/article/details/53097084</a><br>å†æ¬¡æŸ¥çœ‹influxDBï¼Œå‘ç°å·²ç»æœ‰å¾ˆå¤šæ•°æ®è¢«é‡‡é›†è¿›å»äº†ã€‚</p><h1 id="Grafana"><a href="#Grafana" class="headerlink" title="Grafana"></a>Grafana</h1><p>Grafanaæ˜¯ä¸€ä¸ªå¯è§†åŒ–é¢æ¿ï¼ˆDashboardï¼‰ï¼Œæœ‰ç€éå¸¸æ¼‚äº®çš„å›¾è¡¨å’Œå¸ƒå±€å±•ç¤ºï¼ŒåŠŸèƒ½é½å…¨çš„åº¦é‡ä»ªè¡¨ç›˜å’Œå›¾å½¢ç¼–è¾‘å™¨ã€‚æ”¯æŒGraphiteã€zabbixã€InfluxDBã€Prometheuså’ŒOpenTSDBä½œä¸ºæ•°æ®æºã€‚</p><p>Grafanaä¸»è¦ç‰¹æ€§ï¼šçµæ´»ä¸°å¯Œçš„å›¾å½¢åŒ–é€‰é¡¹ï¼›å¯ä»¥æ··åˆå¤šç§é£æ ¼ï¼›æ”¯æŒç™½å¤©å’Œå¤œé—´æ¨¡å¼ï¼›å¤šä¸ªæ•°æ®æºã€‚</p><h3 id="Grafanaå®‰è£…"><a href="#Grafanaå®‰è£…" class="headerlink" title="Grafanaå®‰è£…"></a>Grafanaå®‰è£…</h3><p>ï¼ˆ1ï¼‰ä¸‹è½½é•œåƒ<br><code>docker pull grafana/grafana</code><br>ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run â€d â€p 3001:3000 â€e INFLUXDB_HOST=influxsrv â€e</span><br><span class="line">INFLUXDB_PORT=8086 â€e INFLUXDB_NAME=cadvisor â€e INFLUXDB_USER=cadvisor â€e</span><br><span class="line">INFLUXDB_PASS=cadvisor â€â€link influxsrv:influxsrv â€â€name grafana</span><br><span class="line">grafana/grafana</span><br></pre></td></tr></table></figure></p><p>æ³¨æ„ï¼Œ<code>INFLUXDB</code>é…ç½®è¯·ä¸ä¸Šæ–‡æˆ‘çš„å†™çš„é…ç½®ç›¸åŒã€‚<br>ï¼ˆ3ï¼‰è®¿é—®<br><a href="http://192.168.184.135:3001" target="_blank" rel="noopener">http://192.168.184.135:3001</a> ï¼ˆè‡ªè§‰æ›´æ¢ipï¼‰<br>ç”¨æˆ·åå¯†ç å‡ä¸º<code>admin</code></p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>//TODO</p><h1 id="pinpoint"><a href="#pinpoint" class="headerlink" title="pinpoint"></a>pinpoint</h1><h3 id="æ˜¯å•¥"><a href="#æ˜¯å•¥" class="headerlink" title="æ˜¯å•¥"></a>æ˜¯å•¥</h3><p>pinpointæ˜¯å¼€æºåœ¨githubä¸Šçš„ä¸€æ¬¾APMç›‘æ§å·¥å…·ï¼Œå®ƒæ˜¯ç”¨Javaç¼–å†™çš„ï¼Œç”¨äºå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿç›‘æ§ã€‚å®ƒå¯¹æ€§èƒ½çš„å½±å“æœ€å°ï¼ˆåªå¢åŠ çº¦3ï¼…èµ„æºåˆ©ç”¨ç‡ï¼‰ï¼Œå®‰è£…agentæ˜¯æ— ä¾µå…¥å¼çš„ï¼Œåªéœ€è¦åœ¨è¢«æµ‹è¯•çš„Tomcatä¸­åŠ ä¸Š3å¥è¯ï¼Œæ‰“ä¸‹æ¢é’ˆï¼Œå°±å¯ä»¥ç›‘æ§æ•´å¥—ç¨‹åºäº†ã€‚</p><h3 id="æ‰€éœ€è½¯ä»¶"><a href="#æ‰€éœ€è½¯ä»¶" class="headerlink" title="æ‰€éœ€è½¯ä»¶"></a>æ‰€éœ€è½¯ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hbase-1.2.6-bin.tar.gz</span><br><span class="line">pinpoint-1.6.2.zip pinpointæºç ï¼Œä½¿ç”¨hbase-create.hbaseè„šæœ¬åˆå§‹åŒ–</span><br><span class="line">hbase</span><br><span class="line">pinpoint-collector-1.6.2.war collectoræ¨¡å—ï¼Œä½¿ç”¨tomcatè¿›è¡Œéƒ¨ç½²</span><br><span class="line">pinpoint-web-1.6.2.war webç®¡æ§å°ï¼Œä½¿ç”¨tomcatè¿›è¡Œéƒ¨ç½²</span><br><span class="line">pinpoint-agent-1.6.2.tar.gz ä¸éœ€è¦éƒ¨ç½²ï¼Œåœ¨è¢«ç›‘æ§åº”ç”¨ä¸€ç«¯</span><br><span class="line">apache-tomcat-8.5.15.zip</span><br></pre></td></tr></table></figure><p>å‡†å¤‡ä¸¤ä¸ªtomcatç¯å¢ƒï¼Œä¸€ä¸ªéƒ¨ç½²pinpoint-collector-1.6.2.warï¼Œå¦ä¸€ä¸ªéƒ¨ç½²pinpoint-web-1.6.2.war</p><h3 id="å®‰è£…hbase"><a href="#å®‰è£…hbase" class="headerlink" title="å®‰è£…hbase"></a>å®‰è£…hbase</h3><h4 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h4><p>è§£å‹hbase-1.2.6-bin.tar.gzï¼Œä¿®æ”¹hbase/conf/hbase-site.xmlæ–‡ä»¶å†…å®¹å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hbase.rootdir&lt;/name&gt;</span><br><span class="line">&lt;value&gt;file:///pinpoint/data/hbase&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;</span><br><span class="line">&lt;value&gt;/pinpoint/data/zookeeper&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hbase.master.port&lt;/name&gt;</span><br><span class="line">&lt;value&gt;60000&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hbase.regionserver.port&lt;/name&gt;</span><br><span class="line">&lt;value&gt;60020&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹<code>hbase/conf/hbase-env.sh</code>æ–‡ä»¶ï¼Œè®¾ç½®<code>JAVA_HOME</code>ç¯å¢ƒå˜é‡<br><code>export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_112.jdk/Contents/Home</code></p><h4 id="å¯åŠ¨hbase"><a href="#å¯åŠ¨hbase" class="headerlink" title="å¯åŠ¨hbase"></a>å¯åŠ¨hbase</h4><p><code>hbase/bin/start-hbase.sh</code></p><h4 id="æ‰§è¡ŒjpsæŸ¥çœ‹æ˜¯å¦æœ‰HMasterè¿›ç¨‹"><a href="#æ‰§è¡ŒjpsæŸ¥çœ‹æ˜¯å¦æœ‰HMasterè¿›ç¨‹" class="headerlink" title="æ‰§è¡ŒjpsæŸ¥çœ‹æ˜¯å¦æœ‰HMasterè¿›ç¨‹"></a>æ‰§è¡ŒjpsæŸ¥çœ‹æ˜¯å¦æœ‰HMasterè¿›ç¨‹</h4><p>è®¿é—® <a href="http://127.0.0.1:16010/master-status" target="_blank" rel="noopener">http://127.0.0.1:16010/master-status</a> æŸ¥çœ‹hbase webç®¡æ§å°<br>å¯¼å…¥hbaseåˆå§‹åŒ–è„šæ­¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">hbase/bin/hbase shell /pinpoint-1.6.2/hbase/scripts/hbase-create.hbase</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">0 row(s) in 1.4160 seconds</span><br><span class="line">0 row(s) in 1.2420 seconds</span><br><span class="line">0 row(s) in 2.2410 seconds</span><br><span class="line">0 row(s) in 1.2400 seconds</span><br><span class="line">0 row(s) in 1.2450 seconds</span><br><span class="line">0 row(s) in 1.2420 seconds</span><br><span class="line">0 row(s) in 1.2360 seconds</span><br><span class="line">0 row(s) in 1.2400 seconds</span><br><span class="line">0 row(s) in 1.2370 seconds</span><br><span class="line">0 row(s) in 2.2450 seconds</span><br><span class="line">0 row(s) in 4.2480 seconds</span><br><span class="line">0 row(s) in 1.2310 seconds</span><br><span class="line">0 row(s) in 1.2430 seconds</span><br><span class="line">0 row(s) in 1.2390 seconds</span><br><span class="line">0 row(s) in 1.2440 seconds</span><br><span class="line">0 row(s) in 1.2440 seconds</span><br><span class="line">TABLE</span><br><span class="line">AgentEvent</span><br><span class="line">AgentInfo</span><br><span class="line">AgentLifeCycle</span><br><span class="line">AgentStat</span><br><span class="line">AgentStatV2</span><br><span class="line">ApiMetaData</span><br><span class="line">ApplicationIndex</span><br><span class="line">ApplicationMapStatisticsCallee_Ver2</span><br><span class="line">ApplicationMapStatisticsCaller_Ver2</span><br><span class="line">ApplicationMapStatisticsSelf_Ver2</span><br><span class="line">ApplicationTraceIndex</span><br><span class="line">HostApplicationMap_Ver2</span><br><span class="line">SqlMetaData_Ver2</span><br><span class="line">StringMetaData</span><br><span class="line">TraceV2</span><br><span class="line">Traces</span><br><span class="line">16 row(s) in 0.0190 seconds</span><br></pre></td></tr></table></figure></p><h4 id="è¿›å…¥hbase-shell"><a href="#è¿›å…¥hbase-shell" class="headerlink" title="è¿›å…¥hbase shell"></a>è¿›å…¥hbase shell</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hbase/bin/hbase shell</span><br><span class="line">HBase Shell; enter &apos;help&lt;RETURN&gt;&apos; for list of supported commands.</span><br><span class="line">Type &quot;exit&lt;RETURN&gt;&quot; to leave the HBase Shell</span><br><span class="line">Version 1.2.6, rUnknown, Mon May 29 02:25:32 CDT 2017</span><br><span class="line">hbase(main):001:0&gt;</span><br></pre></td></tr></table></figure><p>è¾“å…¥status â€˜detailedâ€™æŸ¥çœ‹åˆšæ‰åˆå§‹åŒ–çš„è¡¨ï¼Œæ˜¯å¦å­˜åœ¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):001:0&gt; status &apos;detailed&apos;</span><br></pre></td></tr></table></figure></p><p>è®¿é—® <a href="http://127.0.0.1:16010/master-status" target="_blank" rel="noopener">http://127.0.0.1:16010/master-status</a> æŸ¥çœ‹hbase webç®¡æ§å°</p><h4 id="éƒ¨ç½²collector"><a href="#éƒ¨ç½²collector" class="headerlink" title="éƒ¨ç½²collector"></a>éƒ¨ç½²collector</h4><p>è§£å‹apache-tomcat-8.5.15.zipå¹¶é‡å‘½åä¸ºcollector<br>æ‹·è´pinpoint-collector-1.6.2.waråˆ°collector\webapps\ç›®å½•ä¸‹å¹¶é‡å‘½åä¸ºROOT.war<br>æ¶‰åŠåˆ°ä¸¤ä¸ªé…ç½®æ–‡ä»¶</p><ul><li>hbase.properties<br>ç”±äºä½¿ç”¨çš„ä¸ºhbaseè‡ªå¸¦çš„zookeeperå³hbaseå’Œzookeeperåœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œåˆ™ä¸éœ€è¦ä¿®æ”¹collector/webapps/ROOT/WEB-INF/classes/hbase.propertiesæ–‡ä»¶</li><li>pinpoint-collector.properties<br>æ³¨æ„è§‚å¯Ÿè¯¥é…ç½®æ–‡ä»¶ä¸­ä¸­çš„ä¸‰ä¸ªç«¯å£9994ã€9995ã€9996 é»˜è®¤ä¸éœ€è¦ä¿®æ”¹ï¼Œå…¶ä¸­9994ä¸ºcollectorç›‘å¬çš„tcpç«¯å£ï¼Œ9995ä¸ºcollectorç›‘å¬çš„udpç«¯å£</li></ul><p>æ‰§è¡Œcollector/bin/startup.shå¯åŠ¨collector<br>éƒ¨ç½²webç®¡æ§å°<br>è§£å‹apache-tomcat-8.5.15.zipå¹¶é‡å‘½åä¸ºweb<br>æ‹·è´pinpoint-web-1.6.2.waråˆ°web\webapps\ç›®å½•ä¸‹å¹¶é‡å‘½åä¸ºROOT.war<br>åŒæ ·ç•™æ„web/webapps/ROOT/WEB-INF/classes/hbase.propertiesä¸­çš„é…ç½®ï¼Œè‹¥ä¸hbaseåœ¨åŒä¸€å°æœºå™¨åˆ™ä¸éœ€è¦ä¿®æ”¹<br>æ‰§è¡Œweb/bin/startup.shå¯åŠ¨webç®¡æ§å°(æ³¨æ„ä¿®æ”¹tomcatç«¯å£å·ï¼Œé˜²æ­¢å†²çªï¼Œè¿™é‡Œä¿®æ”¹ç«¯å£ä¸º8088)<br>æµè§ˆå™¨è®¿é—® <a href="http://127.0.0.1:8088/" target="_blank" rel="noopener">http://127.0.0.1:8088/</a> æŸ¥çœ‹pinpointç®¡æ§å°</p><h3 id="ç›‘æ§spring-bootåº”ç”¨"><a href="#ç›‘æ§spring-bootåº”ç”¨" class="headerlink" title="ç›‘æ§spring bootåº”ç”¨"></a>ç›‘æ§spring bootåº”ç”¨</h3><p>è¿™é‡Œæœ‰ä¸€ä¸ªspring-boot-example.jarçš„åº”ç”¨ï¼Œç°åœ¨è¦ä½¿ç”¨pinpointæ¥å¯¹å…¶ç›‘æ§è·Ÿè¸ªã€‚æ“ä½œå¾ˆç®€å•ï¼Œåˆ†ä¸¤æ­¥<br>è§£å‹pinpoint-agent-1.6.2.tar.gzå¹¶å¯¹å…¶è¿›è¡Œé…ç½®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf pinpoint-agent-1.6.2.tar.gz -C pinpoint-agent</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹pinpoint-agent/pinpoint.configä¸­çš„é…ç½®ä¸collectoræœåŠ¡ä¸€è‡´ã€‚æ­¤å¤„å› ä¸ºpinpoint-agentä¸collectoråœ¨åŒ<br>ä¸€å°æœºå™¨ï¼Œå› æ­¤é»˜è®¤é…ç½®å³å¯ä¸éœ€è¦ä¿®æ”¹ã€‚<br>ä¸ºspring-bootåº”ç”¨é…ç½®pinpoint-agent<br>å¯åŠ¨spring-bootåº”ç”¨æ—¶æ·»åŠ å¦‚ä¸‹å‚æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-javaagent:$AGENT_PATH/pinpoint-bootstrap-$VERSION.jar</span><br><span class="line">-Dpinpoint.agentId</span><br><span class="line">-Dpinpoint.applicationName</span><br></pre></td></tr></table></figure></p><p>æœ¬ä¾‹ä¸­çš„å¯åŠ¨å‚æ•°ä¸º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -javaagent:/pinpoint-agent/pinpoint-bootstrap-1.6.2.jar -Dpinpoint.agentId=spring-boot-app -Dpinpoint.applicationName=spring-boot-app -jar spring-boot-docker-example-1.0.jar</span><br></pre></td></tr></table></figure></p><p>è®¿é—® <a href="http://127.0.0.1:8088/" target="_blank" rel="noopener">http://127.0.0.1:8088/</a> ï¼Œç¬¬ä¸€æ¬¡è®¿é—®å¯èƒ½æ²¡æœ‰æ•°æ®ï¼Œå¯ä»¥å…ˆè®¿é—®ä¸‹åº”ç”¨ï¼Œç„¶ååœ¨åˆ·æ–°pinpointç®¡æ§å°å³å¯</p><h3 id="more"><a href="#more" class="headerlink" title="more"></a>more</h3><p><a href="https://www.cnblogs.com/yyhh/p/6106472.html" target="_blank" rel="noopener">https://www.cnblogs.com/yyhh/p/6106472.html</a></p><h1 id="Open-Falcon"><a href="#Open-Falcon" class="headerlink" title="Open-Falcon"></a>Open-Falcon</h1><p>Open-Falconï¼Œå°ç±³å®¶çš„å¼€æºç›‘æ§ç³»ç»Ÿã€‚</p><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><p>1ã€å¼ºå¤§çµæ´»çš„æ•°æ®é‡‡é›†ï¼šè‡ªåŠ¨å‘ç°ï¼Œæ”¯æŒfalcon-agentã€snmpã€æ”¯æŒç”¨æˆ·ä¸»åŠ¨pushã€ç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶æ”¯æŒã€opentsdb data model likeï¼ˆtimestampã€endpointã€metricã€key-value tagsï¼‰</p><p>2ã€æ°´å¹³æ‰©å±•èƒ½åŠ›ï¼šæ”¯æŒæ¯ä¸ªå‘¨æœŸä¸Šäº¿æ¬¡çš„æ•°æ®é‡‡é›†ã€å‘Šè­¦åˆ¤å®šã€å†å²æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢</p><p>3ã€é«˜æ•ˆç‡çš„å‘Šè­¦ç­–ç•¥ç®¡ç†ï¼šé«˜æ•ˆçš„portalã€æ”¯æŒç­–ç•¥æ¨¡æ¿ã€æ¨¡æ¿ç»§æ‰¿å’Œè¦†ç›–ã€å¤šç§å‘Šè­¦æ–¹å¼ã€æ”¯æŒcallbackè°ƒç”¨</p><p>4ã€äººæ€§åŒ–çš„å‘Šè­¦è®¾ç½®ï¼šæœ€å¤§å‘Šè­¦æ¬¡æ•°ã€å‘Šè­¦çº§åˆ«ã€å‘Šè­¦æ¢å¤é€šçŸ¥ã€å‘Šè­¦æš‚åœã€ä¸åŒæ—¶æ®µä¸åŒé˜ˆå€¼ã€æ”¯æŒç»´æŠ¤å‘¨æœŸ</p><p>5ã€é«˜æ•ˆç‡çš„graphç»„ä»¶ï¼šå•æœºæ”¯æ’‘200ä¸‡metricçš„ä¸ŠæŠ¥ã€å½’æ¡£ã€å­˜å‚¨ï¼ˆå‘¨æœŸä¸º1åˆ†é’Ÿï¼‰</p><p>6ã€é«˜æ•ˆçš„å†å²æ•°æ®queryç»„ä»¶ï¼šé‡‡ç”¨rrdtoolçš„æ•°æ®å½’æ¡£ç­–ç•¥ï¼Œç§’çº§è¿”å›ä¸Šç™¾ä¸ªmetricä¸€å¹´çš„å†å²æ•°æ®</p><p>7ã€dashboardï¼šå¤šç»´åº¦çš„æ•°æ®å±•ç¤ºï¼Œç”¨æˆ·è‡ªå®šä¹‰Screen</p><p>8ã€é«˜å¯ç”¨ï¼šæ•´ä¸ªç³»ç»Ÿæ— æ ¸å¿ƒå•ç‚¹ï¼Œæ˜“è¿ç»´ï¼Œæ˜“éƒ¨ç½²ï¼Œå¯æ°´å¹³æ‰©å±•</p><p>9ã€å¼€å‘è¯­è¨€ï¼š æ•´ä¸ªç³»ç»Ÿçš„åç«¯ï¼Œå…¨éƒ¨golangç¼–å†™ï¼Œportalå’Œdashboardä½¿ç”¨pythonç¼–å†™ã€‚</p><h3 id="ç¤¾åŒºå’Œæ–‡æ¡£æ”¯æŒ"><a href="#ç¤¾åŒºå’Œæ–‡æ¡£æ”¯æŒ" class="headerlink" title="ç¤¾åŒºå’Œæ–‡æ¡£æ”¯æŒ"></a>ç¤¾åŒºå’Œæ–‡æ¡£æ”¯æŒ</h3><p><a href="http://book.open-falcon.org/zh/index.html" target="_blank" rel="noopener">http://book.open-falcon.org/zh/index.html</a></p><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><h3 id="å®‰è£…redis"><a href="#å®‰è£…redis" class="headerlink" title="å®‰è£…redis"></a>å®‰è£…redis</h3><p>yumå®‰è£…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y redis</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹é…ç½®redis.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/redis.conf</span><br></pre></td></tr></table></figure></p><p>å¯åŠ¨redisï¼š<code>redis-server &amp;</code></p><h3 id="å®‰è£…mysql"><a href="#å®‰è£…mysql" class="headerlink" title="å®‰è£…mysql"></a>å®‰è£…mysql</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y mysql-server</span><br></pre></td></tr></table></figure><p>å¯åŠ¨mysqlï¼š<code>service mysqld start</code><br>æŸ¥çœ‹mysqlçŠ¶æ€ï¼š<code>service mysqld status</code></p><h3 id="åˆå§‹åŒ–mysqlæ•°æ®åº“è¡¨"><a href="#åˆå§‹åŒ–mysqlæ•°æ®åº“è¡¨" class="headerlink" title="åˆå§‹åŒ–mysqlæ•°æ®åº“è¡¨"></a>åˆå§‹åŒ–mysqlæ•°æ®åº“è¡¨</h3><p>æ•°æ®é»˜è®¤æ²¡æœ‰è®¾ç½®å¯†ç ï¼Œæ‰§è¡Œçš„æ—¶å€™å‡ºç°è¾“å…¥å¯†ç ï¼Œç›´æ¥å›è½¦ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp/ &amp;&amp; git clone https://github.com/open-falcon/falcon-plus.git </span><br><span class="line">cd /tmp/falcon-plus/scripts/mysql/db_schema/</span><br><span class="line">mysql -h 127.0.0.1 -u root -p &lt; 1_uic-db-schema.sql</span><br><span class="line">mysql -h 127.0.0.1 -u root -p &lt; 2_portal-db-schema.sql</span><br><span class="line">mysql -h 127.0.0.1 -u root -p &lt; 3_dashboard-db-schema.sql</span><br><span class="line">mysql -h 127.0.0.1 -u root -p &lt; 4_graph-db-schema.sql</span><br><span class="line">mysql -h 127.0.0.1 -u root -p &lt; 5_alarms-db-schema.sql</span><br><span class="line">rm -rf /tmp/falcon-plus/</span><br></pre></td></tr></table></figure></p><p>è®¾ç½®mysqlçš„rootç”¨æˆ·å¯†ç ï¼š<br><code>mysql â€“u root</code><br>æŸ¥çœ‹mysqlç”¨æˆ·å’Œå¯†ç <br><code>select user,host,password from mysql.user;</code></p><p>å‘ç°æŸ¥è¯¢å¯†ç éƒ½æ˜¯ç©ºï¼Œç„¶åå¼€å§‹è®¾ç½®rootçš„å¯†ç ä¸ºbigdata<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set password for root@localhost=password(&apos;bigdata&apos;);</span><br></pre></td></tr></table></figure></p><p>é€€å‡ºï¼š<code>mysql&gt;exit</code></p><h3 id="ä¸‹è½½ç¼–è¯‘åçš„äºŒè¿›åˆ¶åŒ…"><a href="#ä¸‹è½½ç¼–è¯‘åçš„äºŒè¿›åˆ¶åŒ…" class="headerlink" title="ä¸‹è½½ç¼–è¯‘åçš„äºŒè¿›åˆ¶åŒ…"></a>ä¸‹è½½ç¼–è¯‘åçš„äºŒè¿›åˆ¶åŒ…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /data/program/software</span><br><span class="line">wget https://github.com/open-falcon/falcon-plus/releases/download/v0.2.1/open-falcon-v0.2.1.tar.gz</span><br></pre></td></tr></table></figure><h2 id="åç«¯å®‰è£…"><a href="#åç«¯å®‰è£…" class="headerlink" title="åç«¯å®‰è£…"></a>åç«¯å®‰è£…</h2><h3 id="åˆ›å»ºå·¥ä½œç›®å½•"><a href="#åˆ›å»ºå·¥ä½œç›®å½•" class="headerlink" title="åˆ›å»ºå·¥ä½œç›®å½•"></a>åˆ›å»ºå·¥ä½œç›®å½•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export FALCON_HOME=/home/work</span><br><span class="line">export WORKSPACE=$FALCON_HOME/open-falcon</span><br><span class="line">mkdir -p $WORKSPACE</span><br></pre></td></tr></table></figure><h3 id="è§£å‹äºŒè¿›åˆ¶åŒ…"><a href="#è§£å‹äºŒè¿›åˆ¶åŒ…" class="headerlink" title="è§£å‹äºŒè¿›åˆ¶åŒ…"></a>è§£å‹äºŒè¿›åˆ¶åŒ…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /data/program/software</span><br><span class="line">tar -xzvf open-falcon-v0.2.1.tar.gz -C $WORKSPACE</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ•°æ®åº“è´¦å·å’Œå¯†ç "><a href="#é…ç½®æ•°æ®åº“è´¦å·å’Œå¯†ç " class="headerlink" title="é…ç½®æ•°æ®åº“è´¦å·å’Œå¯†ç "></a>é…ç½®æ•°æ®åº“è´¦å·å’Œå¯†ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $WORKSPACE</span><br><span class="line">grep -Ilr 3306  ./ | xargs -n1 -- sed -i &apos;s/root:/root:bigdata/g&apos;</span><br></pre></td></tr></table></figure><p>æ³¨æ„root:åé¢é»˜è®¤å¯†ç ä¸ºç©º.</p><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>æŸ¥çœ‹ç›®å½•ä¸‹åŒ…æ‹¬Open-Falconçš„æ‰€æœ‰ç»„ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $WORKSPACE</span><br><span class="line">./open-falcon start</span><br></pre></td></tr></table></figure></p><p>æ£€æŸ¥æ‰€æœ‰æ¨¡å—çš„å¯åŠ¨çŠ¶å†µ<br><code>./open-falcon check</code></p><h3 id="æ›´å¤šå‘½ä»¤è¡Œå·¥å…·"><a href="#æ›´å¤šå‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="æ›´å¤šå‘½ä»¤è¡Œå·¥å…·"></a>æ›´å¤šå‘½ä»¤è¡Œå·¥å…·</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">./open-falcon [start|stop|restart|check|monitor|reload] module</span><br><span class="line">./open-falcon start agent</span><br><span class="line"></span><br><span class="line">./open-falcon check</span><br><span class="line">  falcon-graph         UP           53007</span><br><span class="line">  falcon-hbs         UP           53014</span><br><span class="line">  falcon-judge         UP           53020</span><br><span class="line">  falcon-transfer         UP           53026</span><br><span class="line">  falcon-nodata         UP           53032</span><br><span class="line">  falcon-aggregator         UP           53038</span><br><span class="line">  falcon-agent         UP           53044</span><br><span class="line">  falcon-gateway         UP           53050</span><br><span class="line">  falcon-api         UP           53056</span><br><span class="line">  falcon-alarm         UP           53063</span><br><span class="line"></span><br><span class="line">For debugging , You can check $WorkDir/$moduleName/log/logs/xxx.log</span><br></pre></td></tr></table></figure><h2 id="å‰ç«¯å®‰è£…"><a href="#å‰ç«¯å®‰è£…" class="headerlink" title="å‰ç«¯å®‰è£…"></a>å‰ç«¯å®‰è£…</h2><h3 id="åˆ›å»ºå·¥ä½œç›®å½•-1"><a href="#åˆ›å»ºå·¥ä½œç›®å½•-1" class="headerlink" title="åˆ›å»ºå·¥ä½œç›®å½•"></a>åˆ›å»ºå·¥ä½œç›®å½•</h3><p>è¿™ä¸€æ­¥åœ¨åˆ›å»ºåç«¯æœåŠ¡çš„æ—¶å€™å·²ç»å»ºç«‹å¥½ï¼Œæ‰€ä»¥ä¸éœ€è¦å†è¿›è¡Œæ“ä½œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export HOME=/home/work</span><br><span class="line">export WORKSPACE=$HOME/open-falcon</span><br><span class="line">mkdir -p $WORKSPACE</span><br><span class="line">cd $WORKSPACE</span><br></pre></td></tr></table></figure></p><h3 id="å…‹éš†å‰ç«¯ç»„ä»¶ä»£ç "><a href="#å…‹éš†å‰ç«¯ç»„ä»¶ä»£ç " class="headerlink" title="å…‹éš†å‰ç«¯ç»„ä»¶ä»£ç "></a>å…‹éš†å‰ç«¯ç»„ä»¶ä»£ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $WORKSPACE</span><br><span class="line">git clone https://github.com/open-falcon/dashboard.git</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¾èµ–åŒ…"><a href="#å®‰è£…ä¾èµ–åŒ…" class="headerlink" title="å®‰è£…ä¾èµ–åŒ…"></a>å®‰è£…ä¾èµ–åŒ…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y python-virtualenv</span><br><span class="line">yum install -y python-devel</span><br><span class="line">yum install -y openldap-devel</span><br><span class="line">yum install -y mysql-devel</span><br><span class="line">yum groupinstall &quot;Development tools&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $WORKSPACE/dashboard/</span><br><span class="line">virtualenv ./env</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./env/bin/pip install -r pip_requirements.txt -i https://pypi.douban.com/simple</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå¦‚æœæ‰§è¡Œä¸Šé¢æœ‰é—®é¢˜ï¼Œå°±ç›´æ¥æ‰§è¡Œ<code>./env/bin/pip install -r pip_requirements.txt</code></p><h3 id="ä¿®æ”¹é…ç½®"><a href="#ä¿®æ”¹é…ç½®" class="headerlink" title="ä¿®æ”¹é…ç½®"></a>ä¿®æ”¹é…ç½®</h3><p>dashboardçš„é…ç½®æ–‡ä»¶ä¸ºï¼š<strong> â€˜rrd/config.pyâ€™</strong>ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## API_ADDR è¡¨ç¤ºåç«¯apiç»„ä»¶çš„åœ°å€</span><br><span class="line">API_ADDR = &quot;http://127.0.0.1:8080/api/v1&quot; </span><br><span class="line">## æ ¹æ®å®é™…æƒ…å†µï¼Œä¿®æ”¹PORTAL_DB_*, é»˜è®¤ç”¨æˆ·åä¸ºrootï¼Œé»˜è®¤å¯†ç ä¸º&quot;&quot;</span><br><span class="line">## æ ¹æ®å®é™…æƒ…å†µï¼Œä¿®æ”¹ALARM_DB_*, é»˜è®¤ç”¨æˆ·åä¸ºrootï¼Œé»˜è®¤å¯†ç ä¸º&quot;&quot;</span><br></pre></td></tr></table></figure></p><h3 id="å¯åŠ¨-1"><a href="#å¯åŠ¨-1" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash control start</span><br></pre></td></tr></table></figure><p>open <a href="http://127.0.0.1:8081" target="_blank" rel="noopener">http://127.0.0.1:8081</a> in your browser.</p><p>åœæ­¢<code>bash control stop</code></p><h2 id="å®‰è£…-Agent"><a href="#å®‰è£…-Agent" class="headerlink" title="å®‰è£…-Agent"></a>å®‰è£…-Agent</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>agentç”¨äºé‡‡é›†æœºå™¨è´Ÿè½½ç›‘æ§æŒ‡æ ‡ï¼Œæ¯”å¦‚cpu.idleã€load.1minã€disk.io.utilç­‰ç­‰ï¼Œæ¯éš”60ç§’pushç»™Transferã€‚agentä¸Transferå»ºç«‹äº†é•¿è¿æ¥ï¼Œæ•°æ®å‘é€é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œagentæä¾›äº†ä¸€ä¸ªhttpæ¥å£/v1/pushç”¨äºæ¥æ”¶ç”¨æˆ·æ‰‹å·¥pushçš„ä¸€äº›æ•°æ®ï¼Œç„¶åé€šè¿‡é•¿è¿æ¥è¿…é€Ÿè½¬å‘ç»™Transferã€‚</p><h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><p>agentéœ€è¦éƒ¨ç½²åˆ°æ‰€æœ‰è¦è¢«ç›‘æ§çš„æœºå™¨ä¸Šï¼Œæ¯”å¦‚å…¬å¸æœ‰10ä¸‡å°æœºå™¨ï¼Œé‚£å°±è¦éƒ¨ç½²10ä¸‡ä¸ªagentã€‚agentæœ¬èº«èµ„æºæ¶ˆè€—å¾ˆå°‘ï¼Œä¸ç”¨æ‹…å¿ƒã€‚<br>é¦–å…ˆæ‰¾åˆ°ä¹‹å‰åç«¯æœåŠ¡çš„è§£å‹ç›®å½•ï¼š<br><code>/home/work/open-falcon/</code><br>æ‹·è´agentåˆ°éœ€è¦ç›‘æ§çš„æœåŠ¡å™¨ä¸Šé¢<br><code>scp -r agent/ root@dst1:/home/work/open-falcon</code><br>æ‹·è´open-falconåˆ°éœ€è¦ç›‘æ§çš„æœåŠ¡å™¨ä¸Šé¢<br><code>scp -r open-falcon root@dst1:/home/work/open-falcon</code><br>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š<br>é…ç½®æ–‡ä»¶å¿…é¡»å«cfg.jsonï¼Œå¦‚ä¸‹å‚ç…§ä¿®æ”¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;debug&quot;: true,  # æ§åˆ¶ä¸€äº›debugä¿¡æ¯çš„è¾“å‡ºï¼Œç”Ÿäº§ç¯å¢ƒé€šå¸¸è®¾ç½®ä¸ºfalse</span><br><span class="line">    &quot;hostname&quot;: &quot;&quot;, # agenté‡‡é›†äº†æ•°æ®å‘ç»™transferï¼Œendpointå°±è®¾ç½®ä¸ºäº†hostnameï¼Œé»˜è®¤é€šè¿‡`hostname`è·å–ï¼Œå¦‚æœé…ç½®ä¸­é…ç½®äº†hostnameï¼Œå°±ç”¨é…ç½®ä¸­çš„</span><br><span class="line">    &quot;ip&quot;: &quot;&quot;, # agentä¸hbså¿ƒè·³çš„æ—¶å€™ä¼šæŠŠè‡ªå·±çš„ipåœ°å€å‘ç»™hbsï¼Œagentä¼šè‡ªåŠ¨æ¢æµ‹æœ¬æœºipï¼Œå¦‚æœä¸æƒ³è®©agentè‡ªåŠ¨æ¢æµ‹ï¼Œå¯ä»¥æ‰‹å·¥ä¿®æ”¹è¯¥é…ç½®</span><br><span class="line">    &quot;plugin&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: false, # é»˜è®¤ä¸å¼€å¯æ’ä»¶æœºåˆ¶</span><br><span class="line">        &quot;dir&quot;: &quot;./plugin&quot;,  # æŠŠæ”¾ç½®æ’ä»¶è„šæœ¬çš„git repo cloneåˆ°è¿™ä¸ªç›®å½•</span><br><span class="line">        &quot;git&quot;: &quot;https://github.com/open-falcon/plugin.git&quot;, # æ”¾ç½®æ’ä»¶è„šæœ¬çš„git repoåœ°å€</span><br><span class="line">        &quot;logs&quot;: &quot;./logs&quot; # æ’ä»¶æ‰§è¡Œçš„logï¼Œå¦‚æœæ’ä»¶æ‰§è¡Œæœ‰é—®é¢˜ï¼Œå¯ä»¥å»è¿™ä¸ªç›®å½•çœ‹log</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;heartbeat&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,  # æ­¤å¤„enabledè¦è®¾ç½®ä¸ºtrue</span><br><span class="line">        &quot;addr&quot;: &quot;127.0.0.1:6030&quot;, # hbsçš„åœ°å€ï¼Œç«¯å£æ˜¯hbsçš„rpcç«¯å£</span><br><span class="line">        &quot;interval&quot;: 60, # å¿ƒè·³å‘¨æœŸï¼Œå•ä½æ˜¯ç§’</span><br><span class="line">        &quot;timeout&quot;: 1000 # è¿æ¥hbsçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;transfer&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true, </span><br><span class="line">        &quot;addrs&quot;: [</span><br><span class="line">            &quot;127.0.0.1:18433&quot;</span><br><span class="line">        ],  # transferçš„åœ°å€ï¼Œç«¯å£æ˜¯transferçš„rpcç«¯å£, å¯ä»¥æ”¯æŒå†™å¤šä¸ªtransferçš„åœ°å€ï¼Œagentä¼šä¿è¯HA</span><br><span class="line">        &quot;interval&quot;: 60, # é‡‡é›†å‘¨æœŸï¼Œå•ä½æ˜¯ç§’ï¼Œå³agentä¸€åˆ†é’Ÿé‡‡é›†ä¸€æ¬¡æ•°æ®å‘ç»™transfer</span><br><span class="line">        &quot;timeout&quot;: 1000 # è¿æ¥transferçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,  # æ˜¯å¦è¦ç›‘å¬httpç«¯å£</span><br><span class="line">        &quot;listen&quot;: &quot;:1988&quot;,</span><br><span class="line">        &quot;backdoor&quot;: false</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;collector&quot;: &#123;</span><br><span class="line">        &quot;ifacePrefix&quot;: [&quot;eth&quot;, &quot;em&quot;], # é»˜è®¤é…ç½®åªä¼šé‡‡é›†ç½‘å¡åç§°å‰ç¼€æ˜¯ethã€emçš„ç½‘å¡æµé‡ï¼Œé…ç½®ä¸ºç©ºå°±ä¼šé‡‡é›†æ‰€æœ‰çš„ï¼Œloçš„ä¹Ÿä¼šé‡‡é›†ã€‚å¯ä»¥ä»/proc/net/devçœ‹åˆ°å„ä¸ªç½‘å¡çš„æµé‡ä¿¡æ¯</span><br><span class="line">        &quot;mountPoint&quot;: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;default_tags&quot;: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;ignore&quot;: &#123;  # é»˜è®¤é‡‡é›†äº†200å¤šä¸ªmetricï¼Œå¯ä»¥é€šè¿‡ignoreè®¾ç½®ä¸ºä¸é‡‡é›†</span><br><span class="line">        &quot;cpu.busy&quot;: true,</span><br><span class="line">        &quot;df.bytes.free&quot;: true,</span><br><span class="line">        &quot;df.bytes.total&quot;: true,</span><br><span class="line">        &quot;df.bytes.used&quot;: true,</span><br><span class="line">        &quot;df.bytes.used.percent&quot;: true,</span><br><span class="line">        &quot;df.inodes.total&quot;: true,</span><br><span class="line">        &quot;df.inodes.free&quot;: true,</span><br><span class="line">        &quot;df.inodes.used&quot;: true,</span><br><span class="line">        &quot;df.inodes.used.percent&quot;: true,</span><br><span class="line">        &quot;mem.memtotal&quot;: true,</span><br><span class="line">        &quot;mem.memused&quot;: true,</span><br><span class="line">        &quot;mem.memused.percent&quot;: true,</span><br><span class="line">        &quot;mem.memfree&quot;: true,</span><br><span class="line">        &quot;mem.swaptotal&quot;: true,</span><br><span class="line">        &quot;mem.swapused&quot;: true,</span><br><span class="line">        &quot;mem.swapfree&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="å¯åŠ¨-2"><a href="#å¯åŠ¨-2" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p><code>./open-falcon start agent</code>  å¯åŠ¨è¿›ç¨‹<br><code>./open-falcon stop agent</code>  åœæ­¢è¿›ç¨‹<br><code>./open-falcon monitor agent</code>  æŸ¥çœ‹æ—¥å¿—<br>çœ‹varç›®å½•ä¸‹çš„logæ˜¯å¦æ­£å¸¸ï¼Œæˆ–è€…æµè§ˆå™¨è®¿é—®å…¶1988ç«¯å£ã€‚å¦å¤–agentæä¾›äº†ä¸€ä¸ªâ€“checkå‚æ•°ï¼Œå¯ä»¥æ£€æŸ¥agentæ˜¯å¦å¯ä»¥æ­£å¸¸è·‘åœ¨å½“å‰æœºå™¨ä¸Š<br><code>./falcon-agent --check</code>å¯è¿›å…¥ç›‘æ§ç•Œé¢æŸ¥çœ‹</p><h2 id="å®‰è£…æ•°æ®è½¬å‘æœåŠ¡-Transfer"><a href="#å®‰è£…æ•°æ®è½¬å‘æœåŠ¡-Transfer" class="headerlink" title="å®‰è£…æ•°æ®è½¬å‘æœåŠ¡-Transfer"></a>å®‰è£…æ•°æ®è½¬å‘æœåŠ¡-Transfer</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>transferæ˜¯æ•°æ®è½¬å‘æœåŠ¡ã€‚å®ƒæ¥æ”¶agentä¸ŠæŠ¥çš„æ•°æ®ï¼Œç„¶åæŒ‰ç…§å“ˆå¸Œè§„åˆ™è¿›è¡Œæ•°æ®åˆ†ç‰‡ã€å¹¶å°†åˆ†ç‰‡åçš„æ•°æ®åˆ†åˆ«pushç»™graph&amp;judgeç­‰ç»„ä»¶ã€‚</p><h3 id="æœåŠ¡éƒ¨ç½²"><a href="#æœåŠ¡éƒ¨ç½²" class="headerlink" title="æœåŠ¡éƒ¨ç½²"></a>æœåŠ¡éƒ¨ç½²</h3><p>æœåŠ¡éƒ¨ç½²ï¼ŒåŒ…æ‹¬é…ç½®ä¿®æ”¹ã€å¯åŠ¨æœåŠ¡ã€æ£€éªŒæœåŠ¡ã€åœæ­¢æœåŠ¡ç­‰ã€‚è¿™ä¹‹å‰ï¼Œéœ€è¦å°†å®‰è£…åŒ…è§£å‹åˆ°æœåŠ¡çš„éƒ¨ç½²ç›®å½•ä¸‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ä¿®æ”¹é…ç½®, é…ç½®é¡¹å«ä¹‰è§ä¸‹æ–‡</span><br><span class="line">vim cfg.json</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># å¯åŠ¨æœåŠ¡</span><br><span class="line">./open-falcon start transfer</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ ¡éªŒæœåŠ¡,è¿™é‡Œå‡å®šæœåŠ¡å¼€å¯äº†6060çš„httpç›‘å¬ç«¯å£ã€‚æ£€éªŒç»“æœä¸ºokè¡¨æ˜æœåŠ¡æ­£å¸¸å¯åŠ¨ã€‚</span><br><span class="line">curl -s &quot;127.0.0.1:6060/health&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># åœæ­¢æœåŠ¡</span><br><span class="line">./open-falcon stop transfer</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹æ—¥å¿—</span><br><span class="line">./open-falcon monitor transfer</span><br></pre></td></tr></table></figure><h3 id="é…ç½®è¯´æ˜"><a href="#é…ç½®è¯´æ˜" class="headerlink" title="é…ç½®è¯´æ˜"></a>é…ç½®è¯´æ˜</h3><p>é…ç½®æ–‡ä»¶é»˜è®¤ä¸º<code>./cfg.json</code><br>debug: true/false, å¦‚æœä¸ºtrueï¼Œæ—¥å¿—ä¸­ä¼šæ‰“å°debugä¿¡æ¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">minStep: 30, å…è®¸ä¸ŠæŠ¥çš„æ•°æ®æœ€å°é—´éš”ï¼Œé»˜è®¤ä¸º30ç§’</span><br><span class="line"></span><br><span class="line">http</span><br><span class="line">    - enabled: true/false, è¡¨ç¤ºæ˜¯å¦å¼€å¯è¯¥httpç«¯å£ï¼Œè¯¥ç«¯å£ä¸ºæ§åˆ¶ç«¯å£ï¼Œä¸»è¦ç”¨æ¥å¯¹transferå‘é€æ§åˆ¶å‘½ä»¤ã€ç»Ÿè®¡å‘½ä»¤ã€debugå‘½ä»¤ç­‰</span><br><span class="line">    - listen: è¡¨ç¤ºç›‘å¬çš„httpç«¯å£</span><br><span class="line"></span><br><span class="line">rpc</span><br><span class="line">    - enabled: true/false, è¡¨ç¤ºæ˜¯å¦å¼€å¯è¯¥jsonrpcæ•°æ®æ¥æ”¶ç«¯å£, Agentå‘é€æ•°æ®ä½¿ç”¨çš„å°±æ˜¯è¯¥ç«¯å£</span><br><span class="line">    - listen: è¡¨ç¤ºç›‘å¬çš„httpç«¯å£</span><br><span class="line"></span><br><span class="line">socket #å³å°†è¢«åºŸå¼ƒ,è¯·é¿å…ä½¿ç”¨</span><br><span class="line">    - enabled: true/false, è¡¨ç¤ºæ˜¯å¦å¼€å¯è¯¥telnetæ–¹å¼çš„æ•°æ®æ¥æ”¶ç«¯å£ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ä¸€è¡Œè¡Œçš„å‘é€æ•°æ®ç»™transfer</span><br><span class="line">    - listen: è¡¨ç¤ºç›‘å¬çš„httpç«¯å£</span><br><span class="line"></span><br><span class="line">judge</span><br><span class="line">    - enabled: true/false, è¡¨ç¤ºæ˜¯å¦å¼€å¯å‘judgeå‘é€æ•°æ®</span><br><span class="line">    - batch: æ•°æ®è½¬å‘çš„æ‰¹é‡å¤§å°ï¼Œå¯ä»¥åŠ å¿«å‘é€é€Ÿåº¦ï¼Œå»ºè®®ä¿æŒé»˜è®¤å€¼</span><br><span class="line">    - connTimeout: å•ä½æ˜¯æ¯«ç§’ï¼Œä¸åç«¯å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥æ ¹æ®ç½‘ç»œè´¨é‡å¾®è°ƒï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - callTimeout: å•ä½æ˜¯æ¯«ç§’ï¼Œå‘é€æ•°æ®ç»™åç«¯çš„è¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥æ ¹æ®ç½‘ç»œè´¨é‡å¾®è°ƒï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - pingMethod: åç«¯æä¾›çš„pingæ¥å£ï¼Œç”¨æ¥æ¢æµ‹è¿æ¥æ˜¯å¦å¯ç”¨ï¼Œå¿…é¡»ä¿æŒé»˜è®¤</span><br><span class="line">    - maxConns: è¿æ¥æ± ç›¸å…³é…ç½®ï¼Œæœ€å¤§è¿æ¥æ•°ï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - maxIdle: è¿æ¥æ± ç›¸å…³é…ç½®ï¼Œæœ€å¤§ç©ºé—²è¿æ¥æ•°ï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - replicas: è¿™æ˜¯ä¸€è‡´æ€§hashç®—æ³•éœ€è¦çš„èŠ‚ç‚¹å‰¯æœ¬æ•°é‡ï¼Œå»ºè®®ä¸è¦å˜æ›´ï¼Œä¿æŒé»˜è®¤å³å¯</span><br><span class="line">    - cluster: key-valueå½¢å¼çš„å­—å…¸ï¼Œè¡¨ç¤ºåç«¯çš„judgeåˆ—è¡¨ï¼Œå…¶ä¸­keyä»£è¡¨åç«¯judgeåå­—ï¼Œvalueä»£è¡¨çš„æ˜¯å…·ä½“çš„ip:port</span><br><span class="line"></span><br><span class="line">graph</span><br><span class="line">    - enabled: true/false, è¡¨ç¤ºæ˜¯å¦å¼€å¯å‘graphå‘é€æ•°æ®</span><br><span class="line">    - batch: æ•°æ®è½¬å‘çš„æ‰¹é‡å¤§å°ï¼Œå¯ä»¥åŠ å¿«å‘é€é€Ÿåº¦ï¼Œå»ºè®®ä¿æŒé»˜è®¤å€¼</span><br><span class="line">    - connTimeout: å•ä½æ˜¯æ¯«ç§’ï¼Œä¸åç«¯å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥æ ¹æ®ç½‘ç»œè´¨é‡å¾®è°ƒï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - callTimeout: å•ä½æ˜¯æ¯«ç§’ï¼Œå‘é€æ•°æ®ç»™åç«¯çš„è¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥æ ¹æ®ç½‘ç»œè´¨é‡å¾®è°ƒï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - pingMethod: åç«¯æä¾›çš„pingæ¥å£ï¼Œç”¨æ¥æ¢æµ‹è¿æ¥æ˜¯å¦å¯ç”¨ï¼Œå¿…é¡»ä¿æŒé»˜è®¤</span><br><span class="line">    - maxConns: è¿æ¥æ± ç›¸å…³é…ç½®ï¼Œæœ€å¤§è¿æ¥æ•°ï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - maxIdle: è¿æ¥æ± ç›¸å…³é…ç½®ï¼Œæœ€å¤§ç©ºé—²è¿æ¥æ•°ï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - replicas: è¿™æ˜¯ä¸€è‡´æ€§hashç®—æ³•éœ€è¦çš„èŠ‚ç‚¹å‰¯æœ¬æ•°é‡ï¼Œå»ºè®®ä¸è¦å˜æ›´ï¼Œä¿æŒé»˜è®¤å³å¯</span><br><span class="line">    - cluster: key-valueå½¢å¼çš„å­—å…¸ï¼Œè¡¨ç¤ºåç«¯çš„graphåˆ—è¡¨ï¼Œå…¶ä¸­keyä»£è¡¨åç«¯graphåå­—ï¼Œvalueä»£è¡¨çš„æ˜¯å…·ä½“çš„ip:port(å¤šä¸ªåœ°å€ç”¨é€—å·éš”å¼€, transferä¼šå°†åŒä¸€ä»½æ•°æ®å‘é€è‡³å„ä¸ªåœ°å€ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§å¯ä»¥å®ç°æ•°æ®çš„å¤šé‡å¤‡ä»½)</span><br><span class="line"></span><br><span class="line">tsdb</span><br><span class="line">    - enabled: true/false, è¡¨ç¤ºæ˜¯å¦å¼€å¯å‘open tsdbå‘é€æ•°æ®</span><br><span class="line">    - batch: æ•°æ®è½¬å‘çš„æ‰¹é‡å¤§å°ï¼Œå¯ä»¥åŠ å¿«å‘é€é€Ÿåº¦</span><br><span class="line">    - connTimeout: å•ä½æ˜¯æ¯«ç§’ï¼Œä¸åç«¯å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥æ ¹æ®ç½‘ç»œè´¨é‡å¾®è°ƒï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - callTimeout: å•ä½æ˜¯æ¯«ç§’ï¼Œå‘é€æ•°æ®ç»™åç«¯çš„è¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥æ ¹æ®ç½‘ç»œè´¨é‡å¾®è°ƒï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - maxConns: è¿æ¥æ± ç›¸å…³é…ç½®ï¼Œæœ€å¤§è¿æ¥æ•°ï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - maxIdle: è¿æ¥æ± ç›¸å…³é…ç½®ï¼Œæœ€å¤§ç©ºé—²è¿æ¥æ•°ï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">    - retry: è¿æ¥åç«¯çš„é‡è¯•æ¬¡æ•°å’Œå‘é€æ•°æ®çš„é‡è¯•æ¬¡æ•°</span><br><span class="line">    - address: tsdbåœ°å€æˆ–è€…tsdbé›†ç¾¤vipåœ°å€, é€šè¿‡tcpè¿æ¥tsdb.</span><br></pre></td></tr></table></figure></p><p>éƒ¨ç½²å®Œæˆtransferç»„ä»¶åï¼Œè¯·ä¿®æ”¹agentçš„é…ç½®ï¼Œä½¿å…¶æŒ‡å‘æ­£ç¡®çš„transferåœ°å€ã€‚åœ¨å®‰è£…å®Œgraphå’Œjudgeåï¼Œè¯·ä¿®æ”¹transferçš„ç›¸åº”é…ç½®ã€ä½¿å…¶èƒ½å¤Ÿæ­£ç¡®å¯»å€åˆ°è¿™ä¸¤ä¸ªç»„ä»¶ã€‚</p><h2 id="å®‰è£…æŸ¥è¯¢ç»„ä»¶-API"><a href="#å®‰è£…æŸ¥è¯¢ç»„ä»¶-API" class="headerlink" title="å®‰è£…æŸ¥è¯¢ç»„ä»¶-API"></a>å®‰è£…æŸ¥è¯¢ç»„ä»¶-API</h2><h3 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>apiç»„ä»¶ï¼Œæä¾›ç»Ÿä¸€çš„restAPIæ“ä½œæ¥å£ã€‚æ¯”å¦‚ï¼šapiç»„ä»¶æ¥æ”¶æŸ¥è¯¢è¯·æ±‚ï¼Œæ ¹æ®ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å»ç›¸åº”çš„graphå®ä¾‹æŸ¥è¯¢ä¸åŒmetricçš„æ•°æ®ï¼Œç„¶åæ±‡æ€»æ‹¿åˆ°çš„æ•°æ®ï¼Œæœ€åç»Ÿä¸€è¿”å›ç»™ç”¨æˆ·ã€‚</p><h3 id="æœåŠ¡éƒ¨ç½²-1"><a href="#æœåŠ¡éƒ¨ç½²-1" class="headerlink" title="æœåŠ¡éƒ¨ç½²"></a>æœåŠ¡éƒ¨ç½²</h3><p>æœåŠ¡éƒ¨ç½²ï¼ŒåŒ…æ‹¬é…ç½®ä¿®æ”¹ã€å¯åŠ¨æœåŠ¡ã€æ£€éªŒæœåŠ¡ã€åœæ­¢æœåŠ¡ç­‰ã€‚è¿™ä¹‹å‰ï¼Œéœ€è¦å°†å®‰è£…åŒ…è§£å‹åˆ°æœåŠ¡çš„éƒ¨ç½²ç›®å½•ä¸‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># ä¿®æ”¹é…ç½®, é…ç½®é¡¹å«ä¹‰è§ä¸‹æ–‡, æ³¨æ„graphé›†ç¾¤çš„é…ç½®</span><br><span class="line">vim cfg.json</span><br><span class="line"></span><br><span class="line"># å¯åŠ¨æœåŠ¡</span><br><span class="line">./open-falcon start api</span><br><span class="line"></span><br><span class="line"># åœæ­¢æœåŠ¡</span><br><span class="line">./open-falcon stop api</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ—¥å¿—</span><br><span class="line">./open-falcon monitor api</span><br></pre></td></tr></table></figure></p><h3 id="æœåŠ¡è¯´æ˜"><a href="#æœåŠ¡è¯´æ˜" class="headerlink" title="æœåŠ¡è¯´æ˜"></a>æœåŠ¡è¯´æ˜</h3><p>æ³¨æ„: è¯·ç¡®ä¿ graphsçš„å†…å®¹ä¸transferçš„é…ç½®å®Œå…¨ä¸€è‡´<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;log_level&quot;: &quot;debug&quot;,</span><br><span class="line">    &quot;db&quot;: &#123;  //æ•°æ®åº“ç›¸å…³çš„è¿æ¥é…ç½®ä¿¡æ¯</span><br><span class="line">        &quot;faclon_portal&quot;: &quot;root:@tcp(127.0.0.1:3306)/falcon_portal?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;,</span><br><span class="line">        &quot;graph&quot;: &quot;root:@tcp(127.0.0.1:3306)/graph?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;,</span><br><span class="line">        &quot;uic&quot;: &quot;root:@tcp(127.0.0.1:3306)/uic?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;,</span><br><span class="line">        &quot;dashboard&quot;: &quot;root:@tcp(127.0.0.1:3306)/dashboard?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;,</span><br><span class="line">        &quot;alarms&quot;: &quot;root:@tcp(127.0.0.1:3306)/alarms?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;,</span><br><span class="line">        &quot;db_bug&quot;: true</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;graphs&quot;: &#123;  // graphæ¨¡å—çš„éƒ¨ç½²åˆ—è¡¨ä¿¡æ¯</span><br><span class="line">        &quot;cluster&quot;: &#123;</span><br><span class="line">            &quot;graph-00&quot;: &quot;127.0.0.1:6070&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;max_conns&quot;: 100,</span><br><span class="line">        &quot;max_idle&quot;: 100,</span><br><span class="line">        &quot;conn_timeout&quot;: 1000,</span><br><span class="line">        &quot;call_timeout&quot;: 5000,</span><br><span class="line">        &quot;numberOfReplicas&quot;: 500</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;metric_list_file&quot;: &quot;./api/data/metric&quot;,</span><br><span class="line">    &quot;web_port&quot;: &quot;:8080&quot;,  // httpç›‘å¬ç«¯å£</span><br><span class="line">    &quot;access_control&quot;: true, // å¦‚æœè®¾ç½®ä¸ºfalseï¼Œé‚£ä¹ˆä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å…·å¤‡ç®¡ç†å‘˜æƒé™</span><br><span class="line">    &quot;salt&quot;: &quot;pleaseinputwhichyouareusingnow&quot;,  //æ•°æ®åº“åŠ å¯†å¯†ç çš„æ—¶å€™çš„salt</span><br><span class="line">    &quot;skip_auth&quot;: false, //å¦‚æœè®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆè®¿é—®apiå°±ä¸éœ€è¦ç»è¿‡è®¤è¯</span><br><span class="line">    &quot;default_token&quot;: &quot;default-token-used-in-server-side&quot;,  //ç”¨äºæœåŠ¡ç«¯å„æ¨¡å—é—´çš„è®¿é—®æˆæƒ</span><br><span class="line">    &quot;gen_doc&quot;: false,</span><br><span class="line">    &quot;gen_doc_path&quot;: &quot;doc/module.html&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¤‡æ³¨ï¼š<br>   éƒ¨ç½²å®Œæˆapiç»„ä»¶åï¼Œè¯·ä¿®æ”¹dashboardç»„ä»¶çš„é…ç½®ã€ä½¿å…¶èƒ½å¤Ÿæ­£ç¡®å¯»å€åˆ°apiç»„ä»¶ã€‚<br>è¯·ç¡®ä¿apiç»„ä»¶çš„graphåˆ—è¡¨ ä¸ transferçš„é…ç½® ä¸€è‡´ã€‚</p><h2 id="å®‰è£…ç»˜å›¾æ•°æ®çš„ç»„ä»¶-Graph"><a href="#å®‰è£…ç»˜å›¾æ•°æ®çš„ç»„ä»¶-Graph" class="headerlink" title="å®‰è£…ç»˜å›¾æ•°æ®çš„ç»„ä»¶- Graph"></a>å®‰è£…ç»˜å›¾æ•°æ®çš„ç»„ä»¶- Graph</h2><h3 id="ä»‹ç»-2"><a href="#ä»‹ç»-2" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>graphæ˜¯å­˜å‚¨ç»˜å›¾æ•°æ®çš„ç»„ä»¶ã€‚graphç»„ä»¶ æ¥æ”¶transferç»„ä»¶æ¨é€ä¸Šæ¥çš„ç›‘æ§æ•°æ®ï¼ŒåŒæ—¶å¤„ç†apiç»„ä»¶çš„æŸ¥è¯¢è¯·æ±‚ã€è¿”å›ç»˜å›¾æ•°æ®ã€‚</p><h3 id="æœåŠ¡éƒ¨ç½²-2"><a href="#æœåŠ¡éƒ¨ç½²-2" class="headerlink" title="æœåŠ¡éƒ¨ç½²"></a>æœåŠ¡éƒ¨ç½²</h3><p>æœåŠ¡éƒ¨ç½²ï¼ŒåŒ…æ‹¬é…ç½®ä¿®æ”¹ã€å¯åŠ¨æœåŠ¡ã€æ£€éªŒæœåŠ¡ã€åœæ­¢æœåŠ¡ç­‰ã€‚è¿™ä¹‹å‰ï¼Œéœ€è¦å°†å®‰è£…åŒ…è§£å‹åˆ°æœåŠ¡çš„éƒ¨ç½²ç›®å½•ä¸‹ã€‚ï¼ˆé€šçŸ¥ä¹‹å‰çš„ä¸€æ ·ï¼Œæ‹·è´éœ€è¦çš„åŒ…åˆ°æŒ‡å®šçš„æœåŠ¡å™¨ï¼‰</p><h1 id="ä¿®æ”¹é…ç½®-é…ç½®é¡¹å«ä¹‰è§ä¸‹æ–‡"><a href="#ä¿®æ”¹é…ç½®-é…ç½®é¡¹å«ä¹‰è§ä¸‹æ–‡" class="headerlink" title="ä¿®æ”¹é…ç½®, é…ç½®é¡¹å«ä¹‰è§ä¸‹æ–‡"></a>ä¿®æ”¹é…ç½®, é…ç½®é¡¹å«ä¹‰è§ä¸‹æ–‡</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim cfg.json</span><br><span class="line"></span><br><span class="line"># å¯åŠ¨æœåŠ¡</span><br><span class="line">./open-falcon start graph</span><br><span class="line"></span><br><span class="line"># åœæ­¢æœåŠ¡</span><br><span class="line">./open-falcon stop graph</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ—¥å¿—</span><br><span class="line">    ./open-falcon monitor graph</span><br></pre></td></tr></table></figure><p>ä¸‰ã€    é…ç½®è¯´æ˜<br>é…ç½®æ–‡ä»¶é»˜è®¤ä¸º<code>./cfg.json</code>ï¼Œé…ç½®å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;debug&quot;: false, //true or false, æ˜¯å¦å¼€å¯debugæ—¥å¿—</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true, //true or false, è¡¨ç¤ºæ˜¯å¦å¼€å¯è¯¥httpç«¯å£ï¼Œè¯¥ç«¯å£ä¸ºæ§åˆ¶ç«¯å£ï¼Œä¸»è¦ç”¨æ¥å¯¹graphå‘é€æ§åˆ¶å‘½ä»¤ã€ç»Ÿè®¡å‘½ä»¤ã€debugå‘½ä»¤</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:6071&quot; //è¡¨ç¤ºç›‘å¬çš„httpç«¯å£</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;rpc&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true, //true or false, è¡¨ç¤ºæ˜¯å¦å¼€å¯è¯¥rpcç«¯å£ï¼Œè¯¥ç«¯å£ä¸ºæ•°æ®æ¥æ”¶ç«¯å£</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:6070&quot; //è¡¨ç¤ºç›‘å¬çš„rpcç«¯å£</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;rrd&quot;: &#123;</span><br><span class="line">        &quot;storage&quot;: &quot;./data/6070&quot; // å†å²æ•°æ®çš„æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼ˆå¦‚æœ‰å¿…è¦ï¼Œè¯·ä¿®æ”¹ä¸ºåˆé€‚çš„è·¯å¾„ï¼‰</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;db&quot;: &#123;</span><br><span class="line">        &quot;dsn&quot;: &quot;root:@tcp(127.0.0.1:3306)/graph?loc=Local&amp;parseTime=true&quot;, //MySQLçš„è¿æ¥ä¿¡æ¯ï¼Œé»˜è®¤ç”¨æˆ·åæ˜¯rootï¼Œå¯†ç ä¸ºç©ºï¼Œhostä¸º127.0.0.1ï¼Œdatabaseä¸ºgraphï¼ˆå¦‚æœ‰å¿…è¦ï¼Œè¯·ä¿®æ”¹)</span><br><span class="line">        &quot;maxIdle&quot;: 4  //MySQLè¿æ¥æ± é…ç½®ï¼Œè¿æ¥æ± å…è®¸çš„æœ€å¤§è¿æ¥æ•°ï¼Œä¿æŒé»˜è®¤å³å¯</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;callTimeout&quot;: 5000,  //RPCè°ƒç”¨è¶…æ—¶æ—¶é—´ï¼Œå•ä½ms</span><br><span class="line">    &quot;migrate&quot;: &#123;  //æ‰©å®¹graphæ—¶å†å²æ•°æ®è‡ªåŠ¨è¿ç§»</span><br><span class="line">        &quot;enabled&quot;: false,  //true or false, è¡¨ç¤ºgraphæ˜¯å¦å¤„äºæ•°æ®è¿ç§»çŠ¶æ€</span><br><span class="line">        &quot;concurrency&quot;: 2, //æ•°æ®è¿ç§»æ—¶çš„å¹¶å‘è¿æ¥æ•°ï¼Œå»ºè®®ä¿æŒé»˜è®¤</span><br><span class="line">        &quot;replicas&quot;: 500, //è¿™æ˜¯ä¸€è‡´æ€§hashç®—æ³•éœ€è¦çš„èŠ‚ç‚¹å‰¯æœ¬æ•°é‡ï¼Œå»ºè®®ä¸è¦å˜æ›´ï¼Œä¿æŒé»˜è®¤å³å¯ï¼ˆå¿…é¡»å’Œtransferçš„é…ç½®ä¸­ä¿æŒä¸€è‡´ï¼‰</span><br><span class="line">        &quot;cluster&quot;: &#123; //æœªæ‰©å®¹å‰è€çš„graphå®ä¾‹åˆ—è¡¨</span><br><span class="line">            &quot;graph-00&quot; : &quot;127.0.0.1:6070&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h3><p>å¦‚æœä¸Šå›¾çº¢æ¡†ä¸­å‡ºç°åŒä¸€å°æœåŠ¡å™¨çš„ä¸åŒåå­—çš„é…ç½®ï¼Œåˆ™è¿›å…¥æ•°æ®åº“ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š<br>è¿›å…¥æ•°æ®åº“ï¼š<code>mysql â€“u root â€“p</code><br>æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ï¼š<code>show databses;</code><br>é€‰æ‹©æ•°æ®åº“ï¼š<code>use graph;</code><br>æŸ¥çœ‹è¡¨ï¼š<code>show tables;</code><br>æŸ¥è¯¢è¡¨ï¼š<code>select * from endpoint;</code><br>åˆ é™¤ä¸éœ€è¦çš„æ•°æ®ï¼š<code>delete from endpoint where id=153;</code><br>å¦‚ä¸‹å¯ä»¥ä¸æ“ä½œï¼š<br>å¯ä»¥ä¸€èµ·åˆ é™¤falcon_portalåº“ä¸­çš„hostè¡¨ä¸­çš„æ— ç”¨æ•°æ®ã€‚</p><h2 id="Mysqlç›‘æ§"><a href="#Mysqlç›‘æ§" class="headerlink" title="Mysqlç›‘æ§"></a>Mysqlç›‘æ§</h2><h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><p>åœ¨æ•°æ®é‡‡é›†ä¸€èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»äº†å¸¸è§çš„ç›‘æ§æ•°æ®æºã€‚open-falconä½œä¸ºä¸€ä¸ªç›‘æ§æ¡†æ¶ï¼Œå¯ä»¥å»é‡‡é›†ä»»ä½•ç³»ç»Ÿçš„ç›‘æ§æŒ‡æ ‡æ•°æ®ï¼Œåªè¦å°†ç›‘æ§æ•°æ®ç»„ç»‡ä¸ºopen-falconè§„èŒƒçš„æ ¼å¼å°±OKäº†ã€‚<br>MySQLçš„æ•°æ®é‡‡é›†å¯ä»¥é€šè¿‡mymonæ¥åšã€‚<br>mymonæ˜¯ä¸€ä¸ªcronï¼Œæ¯åˆ†é’Ÿè·‘ä¸€æ¬¡ï¼Œé…ç½®æ–‡ä»¶ä¸­é…ç½®äº†æ•°æ®åº“è¿æ¥åœ°å€ï¼Œmymonè¿åˆ°è¯¥æ•°æ®åº“ï¼Œé‡‡é›†ä¸€äº›ç›‘æ§æŒ‡æ ‡ï¼Œæ¯”å¦‚global status, global variables, slave statusç­‰ç­‰ï¼Œç„¶åç»„è£…ä¸ºopen-falconè§„å®šçš„æ ¼å¼çš„æ•°æ®ï¼Œpostç»™æœ¬æœºçš„falcon-agentã€‚falcon-agentæä¾›äº†ä¸€ä¸ªhttpæ¥å£ï¼Œä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒæ•°æ®é‡‡é›†ä¸­çš„ä¾‹å­ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰1000å°æœºå™¨éƒ½éƒ¨ç½²äº†MySQLå®ä¾‹ï¼Œå¯ä»¥åœ¨è¿™1000å°æœºå™¨ä¸Šåˆ†åˆ«éƒ¨ç½²1000ä¸ªcronï¼Œå³ï¼šä¸æ•°æ®åº“å®ä¾‹ä¸€ä¸€å¯¹åº”ã€‚</p><h3 id="é…ç½®å®‰è£…"><a href="#é…ç½®å®‰è£…" class="headerlink" title="é…ç½®å®‰è£…"></a>é…ç½®å®‰è£…</h3><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/open-falcon/mymon" target="_blank" rel="noopener">https://github.com/open-falcon/mymon</a><br>å®‰è£…ï¼š<br>è®¾ç½®$GOPATHï¼šexport $GOPATH =/src/<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $GOPATH/src/github.com/open-falcon</span><br><span class="line">cd $GOPATH/src/github.com/open-falcon</span><br><span class="line">git clone https://github.com/open-falcon/mymon.git</span><br><span class="line"></span><br><span class="line">cd mymon</span><br><span class="line">go get ./...</span><br><span class="line">go build -o mymon</span><br><span class="line"></span><br><span class="line">echo &apos;* * * * * cd $GOPATH/src/github.com/open-falcon/mymon &amp;&amp; ./mymon -c etc/mon.cfg&apos; &gt; /etc/cron.d/mymon</span><br></pre></td></tr></table></figure></p><p>æ‰§è¡Œgo get ./â€¦çš„æ—¶å€™å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">package golang.org/x/crypto/ssh/terminal: unrecognized import path &quot;golang.org/x/crypto/ssh/terminal&quot; (https fetch: Get https://golang.org/x/crypto/ssh/terminal?go-get=1: dial tcp 216.239.37.1:443: i/o timeout)</span><br><span class="line">package golang.org/x/sys/unix: unrecognized import path &quot;golang.org/x/sys/unix&quot; (https fetch: Get https://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:443: i/o timeout)</span><br></pre></td></tr></table></figure></p><p>è§£å†³åŠæ³•ï¼š<br>æ–¹æ³•ä¸€ï¼šç›´æ¥ä¸‹è½½æ–‡ä»¶ï¼Œç„¶åæŠŠè§£å‹å‡ºæ¥çš„æ–‡ä»¶å¤¹æ”¾åœ¨srcé‡Œã€‚<br>ä¸‹è½½åœ°å€ï¼š<a href="https://pan.baidu.com/s/1boVAtJp" target="_blank" rel="noopener">https://pan.baidu.com/s/1boVAtJp</a></p><p>æ–¹æ³•äºŒï¼šç›´æ¥ä»gitä¸Šä¸‹è½½å¯¹åº”æ–‡ä»¶æ”¾åˆ°srcä¸‹é¢ã€‚<br>mkdir -p $GOPATH/src/golang.org/x<br>cd $GOPATH/src/golang.org/x<br>git clone <a href="https://github.com/golang/crypto.git" target="_blank" rel="noopener">https://github.com/golang/crypto.git</a><br>git clone <a href="https://github.com/golang/sys.git" target="_blank" rel="noopener">https://github.com/golang/sys.git</a></p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š<br>/src/github.com/open-falcon/mymon/etc<br><code>vi mon.cfg</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[default]</span><br><span class="line"> log_file=mymon.log # æ—¥å¿—è·¯å¾„å’Œæ–‡ä»¶å</span><br><span class="line"> # Panic 0</span><br><span class="line"> # Fatal 1</span><br><span class="line"> # Error 2</span><br><span class="line"> # Warn 3</span><br><span class="line"> # Info 4</span><br><span class="line"> # Debug 5</span><br><span class="line"> log_level=4 # æ—¥å¿—çº§åˆ«</span><br><span class="line"></span><br><span class="line"> falcon_client=http://127.0.0.1:1988/v1/push # falcon agentè¿æ¥åœ°å€</span><br><span class="line"></span><br><span class="line"> #è‡ªå®šä¹‰endpoint</span><br><span class="line"> endpoint=127.0.0.1 #è‹¥ä¸è®¾ç½®åˆ™ä½¿ç”¨OSçš„hostname</span><br><span class="line"></span><br><span class="line"> [mysql]</span><br><span class="line"> user=root # æ•°æ®åº“ç”¨æˆ·å</span><br><span class="line"> password= # æ•°æ®åº“å¯†ç </span><br><span class="line"> host=127.0.0.1 # æ•°æ®åº“è¿æ¥åœ°å€</span><br><span class="line"> port=3306 # æ•°æ®åº“ç«¯å£</span><br></pre></td></tr></table></figure></p><p>é‡‡é›†æˆåŠŸ!</p><h2 id="Redisç›‘æ§"><a href="#Redisç›‘æ§" class="headerlink" title="Redisç›‘æ§"></a>Redisç›‘æ§</h2><h3 id="ä»‹ç»-3"><a href="#ä»‹ç»-3" class="headerlink" title="ä»‹ç»~"></a>ä»‹ç»~</h3><p>Redisçš„æ•°æ®é‡‡é›†å¯ä»¥é€šè¿‡é‡‡é›†è„šæœ¬<a href="https://github.com/iambocai/falcon-monit-scripts/tree/master/redis" target="_blank" rel="noopener">redis-monitor</a> æˆ–è€… <a href="https://github.com/ZhuoRoger/redismon" target="_blank" rel="noopener">redismon</a>æ¥åšã€‚</p><p>redis-monitoræ˜¯ä¸€ä¸ªcronï¼Œæ¯åˆ†é’Ÿè·‘ä¸€æ¬¡é‡‡é›†è„šæœ¬redis-monitor.pyï¼Œå…¶ä¸­é…ç½®äº†redisæœåŠ¡çš„åœ°å€ï¼Œredis-monitorè¿åˆ°rediså®ä¾‹ï¼Œé‡‡é›†ä¸€äº›ç›‘æ§æŒ‡æ ‡ï¼Œæ¯”å¦‚connected_clientsã€used_memoryç­‰ç­‰ï¼Œç„¶åç»„è£…ä¸ºopen-falconè§„å®šçš„æ ¼å¼çš„æ•°æ®ï¼Œpostç»™æœ¬æœºçš„falcon-agentã€‚falcon-agentæä¾›äº†ä¸€ä¸ªhttpæ¥å£ï¼Œä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒæ•°æ®é‡‡é›†ä¸­çš„ä¾‹å­ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰1000å°æœºå™¨éƒ½éƒ¨ç½²äº†Rediså®ä¾‹ï¼Œå¯ä»¥åœ¨è¿™1000å°æœºå™¨ä¸Šåˆ†åˆ«éƒ¨ç½²1000ä¸ªcronï¼Œå³ï¼šä¸Rediså®ä¾‹ä¸€ä¸€å¯¹åº”ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/iambocai/falcon-monit-scripts" target="_blank" rel="noopener">https://github.com/iambocai/falcon-monit-scripts</a></p><p>è¿›å…¥ç›®å½•ï¼š/data/program/software/falcon-monit-scripts-master/redis</p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š<code>vi redis-monitor.py</code><br>ä¿®æ”¹å¯¹åº”è¿æ¥åˆ°agentçš„åœ°å€ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'iambocai'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> commands</span><br><span class="line"><span class="keyword">import</span> urllib2, base64</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisStats</span>:</span></span><br><span class="line">    <span class="comment"># ÄºÃ½ÃÃ½?ÄƒÅ”Ã­Å¥ÄÅ¯??ÃÅ¥ÃŸÅ£Ã“Ä‘redisÅÅ¹??Å¯Å¥Å˜Ã¼Ã®Ãœ?Ã´Ä‘???Ã“Ä‘redis-cliÃ–Å˜?</span></span><br><span class="line">    _redis_cli = <span class="string">'/usr/local/redis/redis-cli'</span></span><br><span class="line">    _stat_regex = re.compile(<span class="string">ur'(\w+):([0-9]+\.?[0-9]*)\r'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,  port=<span class="string">'6379'</span>, passwd=None, host=<span class="string">'127.0.0.1'</span>)</span>:</span></span><br><span class="line">        self._cmd = <span class="string">'%s -h %s -p %s info'</span> % (self._redis_cli, host, port)</span><br><span class="line">        <span class="keyword">if</span> passwd <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">''</span>, <span class="keyword">None</span>]:</span><br><span class="line">            self._cmd = <span class="string">'%s -h %s -p %s -a %s info'</span> % (self._redis_cli, host, port, passwd)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">stats</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">' Return a dict containing redis stats '</span></span><br><span class="line">        info = commands.getoutput(self._cmd)</span><br><span class="line">        <span class="keyword">return</span> dict(self._stat_regex.findall(info))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    ip = <span class="string">"dst6-redis"</span></span><br><span class="line">    timestamp = int(time.time())</span><br><span class="line">    step = <span class="number">60</span></span><br><span class="line">    <span class="comment"># inst_listÅ„Ã©ÃœÃÄ‘Ã­Ã–Å‘redisÅ°ÅÃ¶Ã‡Å®Å£Ã‹Ä›Ã–ÅÅ™ÃºÅÅ¹ÄÄÃŸÃ­???Å¢ÃÅ°ÅÃ¶Ã‡Å„Ã©?Ã¶Ë˜portÅ±ÃºpasswordÅÅ¹Ã‹Ä?Å¢Ä¹Ã©Ã„????Ã®ÃœÅ°Â°Å°Ã¶?Ã”Ä‘ÅÅ¹ÄºÃ½ÅÅŸ</span></span><br><span class="line">    <span class="comment"># inst_list = [ i for i in commands.getoutput("find  /etc/ -name 'redis*.conf'" ).split('\n') ]</span></span><br><span class="line">    insts_list = [ <span class="string">'/usr/local/redis/redis.conf'</span> ]</span><br><span class="line">    p = []</span><br><span class="line">    </span><br><span class="line">    monit_keys = [</span><br><span class="line">        (<span class="string">'connected_clients'</span>,<span class="string">'GAUGE'</span>), </span><br><span class="line">        (<span class="string">'blocked_clients'</span>,<span class="string">'GAUGE'</span>), </span><br><span class="line">        (<span class="string">'used_memory'</span>,<span class="string">'GAUGE'</span>),</span><br><span class="line">        (<span class="string">'used_memory_rss'</span>,<span class="string">'GAUGE'</span>),</span><br><span class="line">        (<span class="string">'mem_fragmentation_ratio'</span>,<span class="string">'GAUGE'</span>),</span><br><span class="line">        (<span class="string">'total_commands_processed'</span>,<span class="string">'COUNTER'</span>),</span><br><span class="line">        (<span class="string">'rejected_connections'</span>,<span class="string">'COUNTER'</span>),</span><br><span class="line">        (<span class="string">'expired_keys'</span>,<span class="string">'COUNTER'</span>),</span><br><span class="line">        (<span class="string">'evicted_keys'</span>,<span class="string">'COUNTER'</span>),</span><br><span class="line">        (<span class="string">'keyspace_hits'</span>,<span class="string">'COUNTER'</span>),</span><br><span class="line">        (<span class="string">'keyspace_misses'</span>,<span class="string">'COUNTER'</span>),</span><br><span class="line">        (<span class="string">'keyspace_hit_ratio'</span>,<span class="string">'GAUGE'</span>),</span><br><span class="line">    ]</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> inst <span class="keyword">in</span> insts_list:</span><br><span class="line">        port = commands.getoutput(<span class="string">"sed -n 's/^port *\([0-9]\&#123;4,5\&#125;\)/\\1/p' %s"</span> % inst)</span><br><span class="line">        passwd = commands.getoutput(<span class="string">"sed -n 's/^requirepass *\([^ ]*\)/\\1/p' %s"</span> % inst)</span><br><span class="line">        metric = <span class="string">"redis"</span></span><br><span class="line">        endpoint = ip</span><br><span class="line">        tags = <span class="string">'port=%s'</span> % port</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            conn = RedisStats(port, passwd)</span><br><span class="line">            stats = conn.stats()</span><br><span class="line">        <span class="keyword">except</span> Exception,e:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> key,vtype <span class="keyword">in</span> monit_keys:</span><br><span class="line">            <span class="comment">#Ä›Ã©Å¢ÃÃ–ÅÃ·ÃºÃœÃ¢Ã®ÃœredisÅ„Ã©info?Å‘Ã³Ã®ÃœÄƒÃ¡ÄƒÃ“?Ã¡Â´ÅÅ¹ÄºÃ½ÃÃ½ÄšÅ”Ã¡Â´Ä›Ã©Å¢ÃÃ¤Ë›?Ã¢ÃÃ©Å Ã³ÃºÃ³Ë˜Ã®ÃœkeyÃ¶ÅšÃ”Å»?</span></span><br><span class="line">            <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> stats.keys():</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment">#?ÃŸÅ Å®Â¤Å„Ã©Ã¡Äƒ</span></span><br><span class="line">            <span class="keyword">if</span> key == <span class="string">'keyspace_hit_ratio'</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    value = float(stats[<span class="string">'keyspace_hits'</span>])/(int(stats[<span class="string">'keyspace_hits'</span>]) + int(stats[<span class="string">'keyspace_misses'</span>]))</span><br><span class="line">                <span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">                    value = <span class="number">0</span></span><br><span class="line">            <span class="comment">#Ã¡ÄÅ™Â¸Ã¡ÄƒÄƒÅ”ÃÅ ÄÄ‚?</span></span><br><span class="line">            <span class="keyword">elif</span> key == <span class="string">'mem_fragmentation_ratio'</span>:</span><br><span class="line">                value = float(stats[key])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment">#ÄÄ›Ã¶Ã¢Ã®ÃœÃ”Â´Ã³ÃºÃ³Ë˜Å•Ã·counterÅÅ¹int</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    value = int(stats[key])</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            i = &#123;</span><br><span class="line">                <span class="string">'Metric'</span>: <span class="string">'%s.%s'</span> % (metric, key),</span><br><span class="line">                <span class="string">'Endpoint'</span>: endpoint,</span><br><span class="line">                <span class="string">'Timestamp'</span>: timestamp,</span><br><span class="line">                <span class="string">'Step'</span>: step,</span><br><span class="line">                <span class="string">'Value'</span>: value,</span><br><span class="line">                <span class="string">'CounterType'</span>: vtype,</span><br><span class="line">                <span class="string">'TAGS'</span>: tags</span><br><span class="line">            &#125;</span><br><span class="line">            p.append(i)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> json.dumps(p, sort_keys=<span class="keyword">True</span>,indent=<span class="number">4</span>)</span><br><span class="line">    method = <span class="string">"POST"</span></span><br><span class="line">    handler = urllib2.HTTPHandler()</span><br><span class="line">    opener = urllib2.build_opener(handler)</span><br><span class="line">    url = <span class="string">'http://127.0.0.1:1988/v1/push'</span></span><br><span class="line">    request = urllib2.Request(url, data=json.dumps(p) )</span><br><span class="line">    request.add_header(<span class="string">"Content-Type"</span>,<span class="string">'application/json'</span>)</span><br><span class="line">    request.get_method = <span class="keyword">lambda</span>: method</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        connection = opener.open(request)</span><br><span class="line">    <span class="keyword">except</span> urllib2.HTTPError,e:</span><br><span class="line">        connection = e</span><br><span class="line"></span><br><span class="line">    <span class="comment"># check. Substitute with appropriate HTTP code.</span></span><br><span class="line">    <span class="keyword">if</span> connection.code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">print</span> connection.read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'&#123;"err":1,"msg":"%s"&#125;'</span> % connection</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    proc = commands.getoutput(<span class="string">' ps -ef|grep %s|grep -v grep|wc -l '</span> % os.path.basename(sys.argv[<span class="number">0</span>]))</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    <span class="keyword">if</span> int(proc) &lt; <span class="number">5</span>:</span><br><span class="line">        main()</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æµ‹è¯•<code>python redis-monitor.py</code></p><p>å°†è„šæœ¬åŠ å…¥crontabæ‰§è¡Œå³å¯</p><p>æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š<code>service crond status</code></p><p>ç¼–è¾‘ï¼š<code>crontab â€“e</code></p><p>åŠ å…¥å‘½ä»¤ï¼Œä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åä¿å­˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/1 * * * * python /data/program/software/falcon-monit-scripts-master/redis/redis-monitor.py</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡<code>service crond restart</code></p><h3 id="æ±‡æŠ¥å­—æ®µ"><a href="#æ±‡æŠ¥å­—æ®µ" class="headerlink" title="æ±‡æŠ¥å­—æ®µ"></a>æ±‡æŠ¥å­—æ®µ</h3><table><thead><tr><th><strong>key</strong></th><th><strong>tag</strong></th><th><strong>type</strong></th><th><strong>note</strong></th></tr></thead><tbody><tr><td>redis.connected_clients</td><td>port</td><td>GAUGE</td><td>å·²è¿æ¥å®¢æˆ·ç«¯çš„æ•°é‡</td></tr><tr><td>redis.blocked_clients</td><td>port</td><td>GAUGE</td><td>æ­£åœ¨ç­‰å¾…é˜»å¡å‘½ä»¤ï¼ˆBLPOPã€BRPOPã€BRPOPLPUSHï¼‰çš„å®¢æˆ·ç«¯çš„æ•°é‡</td></tr><tr><td>redis.used_memory</td><td>port</td><td>GAUGE</td><td>ç”±   Redis åˆ†é…å™¨åˆ†é…çš„å†…å­˜æ€»é‡ï¼Œä»¥å­—èŠ‚ï¼ˆbyteï¼‰ä¸ºå•ä½</td></tr><tr><td>redis.used_memory_rss</td><td>port</td><td>GAUGE</td><td>ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦ï¼Œè¿”å›   Redis å·²åˆ†é…çš„å†…å­˜æ€»é‡ï¼ˆä¿—ç§°å¸¸é©»é›†å¤§å°ï¼‰</td></tr><tr><td>redis.mem_fragmentation_ratio</td><td>port</td><td>GAUGE</td><td>used_memory_rss å’Œ used_memory ä¹‹é—´çš„æ¯”ç‡</td></tr><tr><td>redis.total_commands_processed</td><td>port</td><td>COUNTER</td><td>é‡‡é›†å‘¨æœŸå†…æ‰§è¡Œå‘½ä»¤æ€»æ•°</td></tr><tr><td>redis.rejected_connections</td><td>port</td><td>COUNTER</td><td>é‡‡é›†å‘¨æœŸå†…æ‹’ç»è¿æ¥æ€»æ•°</td></tr><tr><td>redis.expired_keys</td><td>port</td><td>COUNTER</td><td>é‡‡é›†å‘¨æœŸå†…è¿‡æœŸkeyæ€»æ•°</td></tr><tr><td>redis.evicted_keys</td><td>port</td><td>COUNTER</td><td>é‡‡é›†å‘¨æœŸå†…è¸¢å‡ºkeyæ€»æ•°</td></tr><tr><td>redis.keyspace_hits</td><td>port</td><td>COUNTER</td><td>é‡‡é›†å‘¨æœŸå†…keyå‘½ä¸­æ€»æ•°</td></tr><tr><td>redis.keyspace_misses</td><td>port</td><td>COUNTER</td><td>é‡‡é›†å‘¨æœŸå†…keyæ‹’ç»æ€»æ•°</td></tr><tr><td>redis.keyspace_hit_ratio</td><td>port</td><td>GAUGE</td><td>è®¿é—®å‘½ä¸­ç‡</td></tr></tbody></table><p>å¦‚éœ€å¢å‡å­—æ®µï¼Œè¯·ä¿®æ”¹monit_keyså˜é‡</p><h2 id="Rabbitmqç›‘æ§"><a href="#Rabbitmqç›‘æ§" class="headerlink" title="Rabbitmqç›‘æ§"></a>Rabbitmqç›‘æ§</h2><h3 id="ä»‹ç»-4"><a href="#ä»‹ç»-4" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>åœ¨æ•°æ®é‡‡é›†ä¸€èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»äº†å¸¸è§çš„ç›‘æ§æ•°æ®æºã€‚open-falconä½œä¸ºä¸€ä¸ªç›‘æ§æ¡†æ¶ï¼Œå¯ä»¥å»é‡‡é›†ä»»ä½•ç³»ç»Ÿçš„ç›‘æ§æŒ‡æ ‡æ•°æ®ï¼Œåªè¦å°†ç›‘æ§æ•°æ®ç»„ç»‡ä¸ºopen-falconè§„èŒƒçš„æ ¼å¼å°±OKäº†ã€‚</p><p>RMQçš„æ•°æ®é‡‡é›†å¯ä»¥é€šè¿‡è„šæœ¬rabbitmq-monitoræ¥åšã€‚</p><p>   rabbitmq-monitoræ˜¯ä¸€ä¸ªcronï¼Œæ¯åˆ†é’Ÿè·‘ä¸€æ¬¡è„šæœ¬rabbitmq-monitor.pyï¼Œå…¶ä¸­é…ç½®äº†RMQçš„ç”¨æˆ·å&amp;å¯†ç ç­‰ï¼Œè„šæœ¬è¿åˆ°è¯¥RMQå®ä¾‹ï¼Œé‡‡é›†ä¸€äº›ç›‘æ§æŒ‡æ ‡ï¼Œæ¯”å¦‚messages_readyã€messages_totalã€deliver_rateã€publish_rateç­‰ç­‰ï¼Œç„¶åç»„è£…ä¸ºopen-falconè§„å®šçš„æ ¼å¼çš„æ•°æ®ï¼Œpostç»™æœ¬æœºçš„falcon-agentã€‚falcon-agentæä¾›äº†ä¸€ä¸ªhttpæ¥å£ï¼Œä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒ<a href="http://book.open-falcon.org/zh_0_2/philosophy/data-collect.html" target="_blank" rel="noopener">æ•°æ®é‡‡é›†</a>ä¸­çš„ä¾‹å­ã€‚</p><h3 id="å®‰è£…é…ç½®"><a href="#å®‰è£…é…ç½®" class="headerlink" title="å®‰è£…é…ç½®"></a>å®‰è£…é…ç½®</h3><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/iambocai/falcon-monit-scripts/tree/master/rabbitmq" target="_blank" rel="noopener">https://github.com/iambocai/falcon-monit-scripts/tree/master/rabbitmq</a><br>ä¿®æ”¹é…ç½®ï¼š<code>vi rabbitmq-monitor.py</code><br> 1ã€æ ¹æ®å®é™…éƒ¨ç½²æƒ…å†µï¼Œä¿®æ”¹15,16è¡Œçš„rabbitmq-serverç®¡ç†ç«¯å£å’Œç™»å½•ç”¨æˆ·åå¯†ç <br> 2ã€ç¡®è®¤1ä¸­é…ç½®çš„rabbitmqç”¨æˆ·æœ‰ä½ æƒ³ç›‘æ§çš„queue/vhostsçš„æƒé™<br>3ã€å°†è„šæœ¬åŠ å…¥crontabå³å¯<br>æ–°å»ºè„šæœ¬ : <code>vi rabbitmq_cron</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* * * * * root (cd /data/program/software/falcon-monit-scripts-master/rabbitmq &amp;&amp; python  rabbitmq-monitor.py  &gt; /dev/null)</span><br><span class="line">cp rabbitmq_cron /etc/cron.d/</span><br></pre></td></tr></table></figure></p><h3 id="æ±‡æŠ¥å­—æ®µ-1"><a href="#æ±‡æŠ¥å­—æ®µ-1" class="headerlink" title="æ±‡æŠ¥å­—æ®µ"></a>æ±‡æŠ¥å­—æ®µ</h3><table><thead><tr><th><strong>key</strong></th><th><strong>tag</strong></th><th><strong>type</strong></th><th><strong>note</strong></th></tr></thead><tbody><tr><td>rabbitmq.messages_ready</td><td>name(Queueåå­—)</td><td>GAUGE</td><td>é˜Ÿåˆ—ä¸­å¤„äºç­‰å¾…è¢«æ¶ˆè´¹çŠ¶æ€æ¶ˆæ¯æ•°</td></tr><tr><td>rabbitmq.messages_unacknowledged</td><td>name(Queueåå­—)</td><td>GAUGE</td><td>é˜Ÿåˆ—ä¸­å¤„äºæ¶ˆè´¹ä¸­çŠ¶æ€çš„æ¶ˆæ¯æ•°</td></tr><tr><td>rabbitmq.messages_total</td><td>name(Queueåå­—)</td><td>GAUGE</td><td>é˜Ÿåˆ—ä¸­æ‰€æœ‰æœªå®Œæˆæ¶ˆè´¹çš„æ¶ˆæ¯æ•°ï¼Œç­‰äºmessages_ready+messages_unacknowledged</td></tr><tr><td>rabbitmq.ack_rate</td><td>name(Queueåå­—)</td><td>GAUGE</td><td>æ¶ˆè´¹è€…ackçš„é€Ÿç‡</td></tr><tr><td>rabbitmq.deliver_rate</td><td>name(Queueåå­—)</td><td>GAUGE</td><td>deliverçš„é€Ÿç‡</td></tr><tr><td>rabbitmq.deliver_get_rate</td><td>name(Queueåå­—)</td><td>GAUGE</td><td>deliver_getçš„é€Ÿç‡</td></tr><tr><td>rabbitmq.publish_rate</td><td>name(Queueåå­—)</td><td>GAUGE</td><td>publishçš„é€Ÿç‡</td></tr></tbody></table><h1 id="å®Œ"><a href="#å®Œ" class="headerlink" title="å®Œ"></a>å®Œ</h1><p>å…¨ç‰‡ç»“æŸï¼Œè§‰å¾—æˆ‘å†™çš„ä¸é”™ï¼Ÿæƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿèµ¶å¿«æ‰“å¼€æˆ‘çš„ğŸ‘‰ä¸ªäºº<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">åšå®¢</a> ğŸ‘ˆå§ï¼</p><p>è°¢è°¢ä½ é‚£ä¹ˆå¯çˆ±ï¼Œè¿˜ä¸€ç›´å…³æ³¨ç€æˆ‘~â¤ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘åœ¨å¯»æ‰¾æœ‰åˆ©çš„ç›‘æ§è½¯ä»¶ä¸ºæˆ‘çš„å¾®æœåŠ¡çŒ®èº«ï¼Œäºæ˜¯ä¹æ•´ç†æ–‡æ¡£ï¼Œè¯•éªŒï¼ŒèŠ±äº†å¾ˆé•¿æ—¶é—´ã€‚ä»Šå¤©åˆ†äº«ä¸€ä¸‹æ•´ç†çš„éƒ¨åˆ†å·¥å…·ï¼Œæœ‰æ—¶é—´ä¼šç»§ç»­åœ¨æ­¤postä¸­æ›´æ–°çš„ï¼ğŸ™ƒ&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.tech/&quot; targ
      
    
    </summary>
    
    
      <category term="åˆ†äº«" scheme="https://tengshe789.github.io/tags/%E5%88%86%E4%BA%AB/"/>
    
      <category term="è½¯ä»¶æ•™å­¦" scheme="https://tengshe789.github.io/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>è®°å½•ä¸€æ¬¡Gitlabå®‰è£…å¹¶ä¸Gitbooké›†æˆçš„ç»å†</title>
    <link href="https://tengshe789.github.io/2019/01/25/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1Gitlab%E5%AE%89%E8%A3%85%E5%B9%B6%E4%B8%8EGitbook%E9%9B%86%E6%88%90%E7%9A%84%E7%BB%8F%E5%8E%86/"/>
    <id>https://tengshe789.github.io/2019/01/25/è®°å½•ä¸€æ¬¡Gitlabå®‰è£…å¹¶ä¸Gitbooké›†æˆçš„ç»å†/</id>
    <published>2019-01-25T08:55:38.000Z</published>
    <updated>2019-11-20T13:39:41.566Z</updated>
    
    <content type="html"><![CDATA[<p>è€æ¿ä»Šå¤©åˆæ¥æéœ€æ±‚å•¦d=====(ï¿£â–½ï¿£*)b</p><p>éœ€è¦æŠŠå…¬å¸çš„ä¸€äº›æŠ€æœ¯æ–‡æ¡£æ”¾åˆ°ä¸€ä¸ªå¹³å°ä¸Šï¼Œå‘˜å·¥é˜…è¯»ï¼ŒåŒæ—¶æ–‡æ¡£è¦æœ‰è¾ƒå¥½çš„ç»´æŠ¤æ€§ï¼Œæˆæœ¬å°½å¯èƒ½ä½ã€‚</p><p>æ‰€ä»¥ï¼Œå°±æœ‰ä»Šå¤©åšå®¢çš„å†…å®¹äº†ï¼</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢<a href="https://blog.tengshe789.tech/ï¼ˆğŸ˜˜" target="_blank" rel="noopener">https://blog.tengshe789.tech/ï¼ˆğŸ˜˜</a></p><h2 id="å®‰è£…gitlab"><a href="#å®‰è£…gitlab" class="headerlink" title="å®‰è£…gitlab"></a>å®‰è£…gitlab</h2><h4 id="1-å®‰è£…å¹¶é…ç½®å¿…è¦çš„ä¾èµ–å…³ç³»"><a href="#1-å®‰è£…å¹¶é…ç½®å¿…è¦çš„ä¾èµ–å…³ç³»" class="headerlink" title="1. å®‰è£…å¹¶é…ç½®å¿…è¦çš„ä¾èµ–å…³ç³»"></a>1. å®‰è£…å¹¶é…ç½®å¿…è¦çš„ä¾èµ–å…³ç³»</h4><p>åœ¨CentOS 7ï¼ˆå’ŒRedHat / Oracle / Scientific Linux 7ï¼‰ä¸Šï¼Œä»¥ä¸‹å‘½ä»¤è¿˜å°†åœ¨ç³»ç»Ÿé˜²ç«å¢™ä¸­æ‰“å¼€HTTPå’ŒSSHè®¿é—®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y curl policycoreutils-python openssh-server</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> sshd</span><br><span class="line">sudo systemctl start sshd</span><br><span class="line">sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">sudo systemctl reload firewalld</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œå®‰è£…Postfixä»¥å‘é€é€šçŸ¥ç”µå­é‚®ä»¶ã€‚å¦‚æœæ‚¨æƒ³ä½¿ç”¨å…¶ä»–è§£å†³æ–¹æ¡ˆå‘é€ç”µå­é‚®ä»¶ï¼Œè¯·åœ¨å®‰è£…GitLabåè·³è¿‡æ­¤æ­¥éª¤å¹¶[é…ç½®å¤–éƒ¨SMTPæœåŠ¡å™¨]ï¼ˆ<a href="https://docs.gitlab.com/omnibus/settings/smtp.htmlï¼‰ã€‚" target="_blank" rel="noopener">https://docs.gitlab.com/omnibus/settings/smtp.htmlï¼‰ã€‚</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install postfix</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> postfix</span><br><span class="line">sudo systemctl start postfix</span><br></pre></td></tr></table></figure><p>åœ¨Postfixå®‰è£…æœŸé—´ï¼Œå¯èƒ½ä¼šå‡ºç°é…ç½®å±å¹•ã€‚é€‰æ‹©â€œInternet Siteâ€å¹¶æŒ‰Enteré”®ã€‚ä½¿ç”¨æœåŠ¡å™¨çš„å¤–éƒ¨DNSä½œä¸ºâ€œé‚®ä»¶åç§°â€ï¼Œç„¶åæŒ‰Enteré”®ã€‚å¦‚æœå‡ºç°å…¶ä»–å±å¹•ï¼Œè¯·ç»§ç»­æŒ‰Enteré”®æ¥å—é»˜è®¤å€¼ã€‚</p><h4 id="2-æ·»åŠ GitlabåŒ…å­˜å‚¨åº“å¹¶å®‰è£…åŒ…"><a href="#2-æ·»åŠ GitlabåŒ…å­˜å‚¨åº“å¹¶å®‰è£…åŒ…" class="headerlink" title="2. æ·»åŠ GitlabåŒ…å­˜å‚¨åº“å¹¶å®‰è£…åŒ…"></a>2. æ·»åŠ GitlabåŒ…å­˜å‚¨åº“å¹¶å®‰è£…åŒ…</h4><p>Add the GitLab package repository.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œå®‰è£…GitLabåŒ…ã€‚å°†<code>httpï¼š// gitlab.example.com</code>æ›´æ”¹ä¸ºæ‚¨è¦è®¿é—®GitLabå®ä¾‹çš„URLã€‚å®‰è£…å°†è‡ªåŠ¨é…ç½®å¹¶å¯åŠ¨è¯¥URLçš„GitLabã€‚ HTTPSåœ¨å®‰è£…åéœ€è¦å…¶ä»–é…ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo EXTERNAL_URL=<span class="string">"http://192.168.190.132:33333"</span> yum install -y gitlab-ee</span><br></pre></td></tr></table></figure><h4 id="3-ç™»é™†å¹¶éªŒè¯"><a href="#3-ç™»é™†å¹¶éªŒè¯" class="headerlink" title="3. ç™»é™†å¹¶éªŒè¯"></a>3. ç™»é™†å¹¶éªŒè¯</h4><p>åœ¨æ‚¨ç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œæ‚¨å°†è¢«é‡å®šå‘åˆ°å¯†ç é‡ç½®å±å¹•ã€‚æä¾›åˆå§‹ç®¡ç†å‘˜å¸æˆ·çš„å¯†ç ï¼Œæ‚¨å°†è¢«é‡å®šå‘å›ç™»å½•å±å¹•ã€‚ä½¿ç”¨é»˜è®¤å¸æˆ·çš„ç”¨æˆ·å<code>root</code>ç™»å½•ã€‚</p><p>See our <a href="https://docs.gitlab.com/omnibus/README.html#installation-and-configuration-using-omnibus-package" target="_blank" rel="noopener">documentation for detailed instructions on installing and configuration</a>.</p><h2 id="ä¸gitbooké›†æˆ"><a href="#ä¸gitbooké›†æˆ" class="headerlink" title="ä¸gitbooké›†æˆ"></a>ä¸gitbooké›†æˆ</h2><h3 id="å®‰è£…nodeJs"><a href="#å®‰è£…nodeJs" class="headerlink" title="å®‰è£…nodeJs"></a>å®‰è£…nodeJs</h3><p>åªèƒ½å®‰è£…ç¬¬ä¸‰æ–¹ä»“åº“ä¸­å­˜åœ¨çš„ç‰ˆæœ¬ï¼Œä¸€èˆ¬è½å node æœ€æ–°ç‰ˆæœ¬</p><ol><li>å®‰è£…EPEL ä»“åº“<br><code>yum install epel-release</code></li><li>å®‰è£… nodejs<br><code>yum install nodejs</code></li><li>å®‰è£… <code>npm yum install npm</code></li></ol><h3 id="å®‰è£…gitbook"><a href="#å®‰è£…gitbook" class="headerlink" title="å®‰è£…gitbook"></a>å®‰è£…gitbook</h3><p>GitBook æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä½¿ç”¨ Github/Git å’Œ Markdown æ¥åˆ¶ä½œç²¾ç¾çš„ç”µå­ä¹¦ã€‚GitBookæ”¯æŒè¾“å‡ºä»¥ä¸‹å‡ ç§æ–‡æ¡£æ ¼å¼</p><ul><li>é™æ€ç«™ç‚¹ï¼šGitBooké»˜è®¤è¾“å‡ºè¯¥ç§æ ¼å¼</li><li>PDFï¼šéœ€è¦å®‰è£…gitbook-pdfä¾èµ–</li><li>eBookï¼šéœ€è¦å®‰è£…ebook-convert</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install gitbook -g</span><br><span class="line">npm install -g gitbook-cli</span><br></pre></td></tr></table></figure><h4 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h4><ol><li>å‡ºç°<code>npm ERR! Error: connect ECONNREFUSED 104.16.24.35:443</code>é—®é¢˜<br>ä½¿ç”¨å¦‚ä¸‹è¯­å¥å…³é—­ä»£ç†è§£å†³é—®é¢˜ï¼š<br><code>npm config set proxy null</code></li></ol><h3 id="å®‰è£…GitLab-Ci-Runner"><a href="#å®‰è£…GitLab-Ci-Runner" class="headerlink" title="å®‰è£…GitLab Ci Runner"></a>å®‰è£…GitLab Ci Runner</h3><ol><li><p>æ·»åŠ repository<br><code>curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.rpm.sh | sudo bash</code></p></li><li><p>å®‰è£…åŒ…<br><code>yum install gitlab-runner</code></p></li></ol><p>æ‰§è¡Œä¸Šè¿°å‘½ä»¤ä¹‹åï¼Œä¹‹åçš„æµç¨‹å¦‚ä¸‹ï¼š</p><p>ç¬¬ä¸€å¤„çº¢çº¿ï¼šè¾“å…¥éƒ¨ç½²å®Œæˆçš„gitlabåœ°å€æ¯”å¦‚<a href="http://111.111.111.111:8080/" target="_blank" rel="noopener">http://111.111.111.111:8080/</a></p><p>ç¬¬äºŒå¤„çº¢çº¿: ç™»é™†<code>gitlab</code>ï¼Œå…ˆç‚¹å‡»å³ä¸Šæ–¹<code>Admin Settings</code>ï¼Œå†æ‰¾åˆ°å·¦ä¾§åˆ—è¡¨çš„ä¸­çš„<code>overview</code>ä¸€æ æ‰¾åˆ°<code>runner</code>é€‰é¡¹ï¼Œæ‰¾åˆ°å¹¶åœ¨shellä¸­è¾“å…¥token.</p><p>å‰©ä¸‹çš„è¿‡ç¨‹éšä¾¿å†™å³å¯</p><p>æœ€åçœ‹åˆ°Runner registered successfullyè¡¨ç¤ºæ³¨å†ŒæˆåŠŸã€‚</p><p>æœ€åå¯ä»¥ç™»å½•gitlabè¿›è¡ŒéªŒè¯ï¼Œæœ‰å¦‚å›¾æ‰€æœ‰åˆ—è¡¨è¯´æ˜æ³¨å†ŒæˆåŠŸ</p><h4 id="é…ç½®æŒç»­é›†æˆ"><a href="#é…ç½®æŒç»­é›†æˆ" class="headerlink" title="é…ç½®æŒç»­é›†æˆ"></a>é…ç½®æŒç»­é›†æˆ</h4><p><a href="https://docs.gitlab.com/ce/ci/quick_start/README.html#creating-a-gitlab-ciyml-file" target="_blank" rel="noopener">https://docs.gitlab.com/ce/ci/quick_start/README.html#creating-a-gitlab-ciyml-file</a></p><p>åœ¨ä»“åº“ä¸‹ï¼Œåˆ›å»º<code>.gitlab-ci.yml</code>,å†™å…¥ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">build</span></span><br><span class="line"><span class="attr">GenerateHTML:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">p=`pwd`</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">$p</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">gitbook</span> <span class="string">build</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">gitbook</span> <span class="string">serve</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€gitlabé‡Œé¢çš„pinelineï¼ŒæŸ¥çœ‹logã€‚</p><h3 id="QA-1"><a href="#QA-1" class="headerlink" title="QA"></a>QA</h3><ol><li>å‡ºç°This job is in pending state and is waiting to be picked by a runneré”™è¯¯</li></ol><p>è§£å†³ï¼šæ²¡æ‰¾åˆ°ä¼˜é›…çš„æ–¹å¼ã€‚ç²—æš´ç‚¹ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯é‡å¯<code>runner</code>ï¼Œä½¿ç”¨å‘½ä»¤<code>gitlab-ci-multi-runner restart</code>ã€‚</p><h2 id="æœ¬åœ°ä½¿ç”¨"><a href="#æœ¬åœ°ä½¿ç”¨" class="headerlink" title="æœ¬åœ°ä½¿ç”¨"></a>æœ¬åœ°ä½¿ç”¨</h2><ol><li>å°†ä»“åº“cloneä¸‹æ¥ï¼Œ<code>gitbook init bookname</code> å‰µå»ºæ›¸åçˆ²booknameçš„æ›¸</li><li>å†™ä¹¦ï¼Œå¿…è¦æ—¶ä½¿ç”¨<code>gitbook serve</code> é¢„è§ˆä¹¦ã€‚</li><li>åˆ›å»º<code>.gitlab-ci.yml</code>,å†™å…¥é…ç½®ã€‚ç„¶åä½¿ç”¨gitå‘½ä»¤ä¸Šä¼ åˆ°ä¹¦åº“ã€‚</li></ol><h3 id="QA-2"><a href="#QA-2" class="headerlink" title="QA"></a>QA</h3><ol><li>CI/CDçš„logç•Œé¢å‡ºç°æ— æ³•åˆ é™¤å›¾ä¹¦é”™è¯¯</li></ol><p>è§£å†³ï¼š CI/CDå›¾å½¢ç•Œé¢ï¼Œå³ä¾§ï¼Œç‚¹å‡»cancelå³å¯ã€‚</p><ol start="2"><li>å‡ºç°<code>RangeError: Maximum call stack size exceeded</code>é”™è¯¯</li></ol><p>è§£å†³ï¼š æ–‡ç« å†…å®¹è¿‡é•¿ï¼Œå¯¼è‡´jså †æ ˆæº¢å‡ºã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>gitbooké…ç½®å®ä¾‹<a href="https://gitlab.com/pages/gitbook#building-locally" target="_blank" rel="noopener">https://gitlab.com/pages/gitbook#building-locally</a></p><p>å…¶å®ç±»ä¼¼gitbookçš„è½¯ä»¶è¿˜æœ‰å¾ˆå¤šï¼Œå°±è­¬å¦‚<a href="https://docsify.js.org/#/" target="_blank" rel="noopener">docsify</a>ï¼Œå¤§å®¶å¯ä»¥å¤šæŸ¥é˜…ç›¸å…³èµ„æ–™ä½¿ç”¨ã€‚</p><h2 id="å®Œ"><a href="#å®Œ" class="headerlink" title="å®Œ"></a>å®Œ</h2><p>å…¨ç‰‡ç»“æŸï¼Œè§‰å¾—æˆ‘å†™çš„ä¸é”™ï¼Ÿæƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿèµ¶å¿«æ‰“å¼€æˆ‘çš„ğŸ‘‰ä¸ªäºº<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">åšå®¢</a> ğŸ‘ˆå§ï¼</p><p>è°¢è°¢ä½ é‚£ä¹ˆå¯çˆ±ï¼Œè¿˜ä¸€ç›´å…³æ³¨ç€æˆ‘~â¤ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è€æ¿ä»Šå¤©åˆæ¥æéœ€æ±‚å•¦d=====(ï¿£â–½ï¿£*)b&lt;/p&gt;
&lt;p&gt;éœ€è¦æŠŠå…¬å¸çš„ä¸€äº›æŠ€æœ¯æ–‡æ¡£æ”¾åˆ°ä¸€ä¸ªå¹³å°ä¸Šï¼Œå‘˜å·¥é˜…è¯»ï¼ŒåŒæ—¶æ–‡æ¡£è¦æœ‰è¾ƒå¥½çš„ç»´æŠ¤æ€§ï¼Œæˆæœ¬å°½å¯èƒ½ä½ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå°±æœ‰ä»Šå¤©åšå®¢çš„å†…å®¹äº†ï¼&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢&lt;a href=&quot;htt
      
    
    </summary>
    
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://tengshe789.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="åˆ†äº«" scheme="https://tengshe789.github.io/tags/%E5%88%86%E4%BA%AB/"/>
    
      <category term="è½¯ä»¶æ•™å­¦" scheme="https://tengshe789.github.io/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E5%AD%A6/"/>
    
      <category term="git" scheme="https://tengshe789.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>ä»0å¼€å§‹éƒ¨ç½²Rancher2.0åˆ°å¾®æœåŠ¡å®¹å™¨éƒ¨ç½²ä¸æŒç»­é›†æˆ</title>
    <link href="https://tengshe789.github.io/2019/01/22/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E9%83%A8%E7%BD%B2Rancher2-0/"/>
    <id>https://tengshe789.github.io/2019/01/22/ä»0å¼€å§‹éƒ¨ç½²Rancher2-0/</id>
    <published>2019-01-22T06:31:17.000Z</published>
    <updated>2019-11-20T13:39:41.170Z</updated>
    
    <content type="html"><![CDATA[<p>Rancheræ˜¯ä¸€ä¸ªå¼€æºçš„ä¼ä¸šçº§å®¹å™¨ç®¡ç†å¹³å°ã€‚é€šè¿‡Rancherï¼Œä¼ä¸šå†ä¹Ÿä¸å¿…è‡ªå·±ä½¿ç”¨ä¸€ç³»åˆ—çš„å¼€æºè½¯ä»¶å»ä»å¤´æ­å»ºå®¹å™¨æœåŠ¡å¹³å°ã€‚Rancheræä¾›äº†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨çš„ç®¡ç†Dockerå’ŒKubernetesçš„å…¨æ ˆåŒ–å®¹å™¨éƒ¨ç½²ä¸ç®¡ç†å¹³å°ã€‚ä»Šå¤©åˆ†äº«ä¸€ä¸‹æˆ‘ä»0å¼€å§‹éƒ¨ç½²Rancher2.0åˆ°å¾®æœåŠ¡å®¹å™¨éƒ¨ç½²ä¸æŒç»­é›†æˆçš„å†ç¨‹ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢<a href="https://blog.tengshe789.tech/ï¼ˆğŸ˜˜" target="_blank" rel="noopener">https://blog.tengshe789.tech/ï¼ˆğŸ˜˜</a></p><h2 id="dockerå®‰è£…"><a href="#dockerå®‰è£…" class="headerlink" title="dockerå®‰è£…"></a>dockerå®‰è£…</h2><p>è¯·çœ‹æˆ‘<a href="https://blog.tengshe789.tech/2019/01/18/%E8%AE%B0%E5%BD%95docker-%E5%AE%89%E8%A3%85%E4%B8%8E%E8%B0%83%E4%BC%98/#more" target="_blank" rel="noopener">ä¸Šç¯‡åšæ–‡</a>ã€‚</p><h2 id="å®¹å™¨ä¸‹å®‰è£…rancher"><a href="#å®¹å™¨ä¸‹å®‰è£…rancher" class="headerlink" title="å®¹å™¨ä¸‹å®‰è£…rancher"></a>å®¹å™¨ä¸‹å®‰è£…rancher</h2><h3 id="åŸºç¡€ç¯å¢ƒé…ç½®"><a href="#åŸºç¡€ç¯å¢ƒé…ç½®" class="headerlink" title="åŸºç¡€ç¯å¢ƒé…ç½®"></a>åŸºç¡€ç¯å¢ƒé…ç½®</h3><h4 id="åˆ‡æ¢åˆ°å—æ”¯æŒçš„dockerç‰ˆæœ¬"><a href="#åˆ‡æ¢åˆ°å—æ”¯æŒçš„dockerç‰ˆæœ¬" class="headerlink" title="åˆ‡æ¢åˆ°å—æ”¯æŒçš„dockerç‰ˆæœ¬"></a>åˆ‡æ¢åˆ°å—æ”¯æŒçš„dockerç‰ˆæœ¬</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ros engine switch docker-17.03.2-ce</span><br></pre></td></tr></table></figure><h4 id="å…³é—­é˜²ç«å¢™-å¯é€‰-æˆ–è€…æ”¾è¡Œç›¸åº”ç«¯å£"><a href="#å…³é—­é˜²ç«å¢™-å¯é€‰-æˆ–è€…æ”¾è¡Œç›¸åº”ç«¯å£" class="headerlink" title="å…³é—­é˜²ç«å¢™(å¯é€‰)æˆ–è€…æ”¾è¡Œç›¸åº”ç«¯å£"></a>å…³é—­é˜²ç«å¢™(å¯é€‰)æˆ–è€…æ”¾è¡Œç›¸åº”ç«¯å£</h4><p>å¯¹äºåˆšåˆšæ¥è§¦Rancherçš„ç”¨æˆ·ï¼Œå»ºè®®åœ¨å…³é—­é˜²ç«å¢™çš„æµ‹è¯•ç¯å¢ƒæˆ–æ¡Œé¢è™šæ‹Ÿæœºæ¥è¿è¡Œrancherï¼Œä»¥é¿å…å‡ºç°ç½‘ç»œé€šä¿¡é—®é¢˜ã€‚</p><ul><li><p>å…³é—­é˜²ç«å¢™</p><p>1ã€CentOS</p><p><code>systemctl stop firewalld.service &amp;&amp; systemctl disable firewalld.service</code></p><p>2ã€Ubuntu</p><p><code>ufw disable</code></p></li><li><p>ç«¯å£æ”¾è¡Œ</p><p>ç«¯å£æ”¾è¡Œè¯·æŸ¥çœ‹<a href="https://www.cnrancher.com/docs/rancher/v2.x/cn/installation/references/" target="_blank" rel="noopener">ç«¯å£éœ€æ±‚</a></p></li></ul><h4 id="CentOSå…³é—­selinux"><a href="#CentOSå…³é—­selinux" class="headerlink" title="CentOSå…³é—­selinux"></a>CentOSå…³é—­selinux</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</span><br></pre></td></tr></table></figure><h4 id="é…ç½®ä¸»æœºæ—¶é—´ã€æ—¶åŒºã€ç³»ç»Ÿè¯­è¨€"><a href="#é…ç½®ä¸»æœºæ—¶é—´ã€æ—¶åŒºã€ç³»ç»Ÿè¯­è¨€" class="headerlink" title="é…ç½®ä¸»æœºæ—¶é—´ã€æ—¶åŒºã€ç³»ç»Ÿè¯­è¨€"></a>é…ç½®ä¸»æœºæ—¶é—´ã€æ—¶åŒºã€ç³»ç»Ÿè¯­è¨€</h4><ul><li><p>æŸ¥çœ‹æ—¶åŒº</p><p><code>date -R</code>æˆ–è€…<code>timedatectl</code></p></li><li><p>ä¿®æ”¹æ—¶åŒº</p><p><code>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code></p></li><li><p>ä¿®æ”¹ç³»ç»Ÿè¯­è¨€ç¯å¢ƒ</p><p><code>sudo echo &#39;LANG=&quot;en_US.UTF-8&quot;&#39; &gt;&gt; /etc/profile;source /etc/profile</code></p></li><li><p>é…ç½®ä¸»æœºNTPæ—¶é—´åŒæ­¥</p></li></ul><h4 id="Kernelæ€§èƒ½è°ƒä¼˜"><a href="#Kernelæ€§èƒ½è°ƒä¼˜" class="headerlink" title="Kernelæ€§èƒ½è°ƒä¼˜"></a>Kernelæ€§èƒ½è°ƒä¼˜</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/sysctl.conf&lt;&lt;EOF</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">net.bridge.bridge-nf-call-iptables=1</span><br><span class="line">net.ipv4.neigh.default.gc_thresh1=4096</span><br><span class="line">net.ipv4.neigh.default.gc_thresh2=6144</span><br><span class="line">net.ipv4.neigh.default.gc_thresh3=8192</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="Hosts"><a href="#Hosts" class="headerlink" title="Hosts"></a>Hosts</h4><p>é…ç½®æ¯å°ä¸»æœºçš„hosts(/etc/hosts),æ·»åŠ <code>host_ip $hostname</code>åˆ°<code>/etc/hosts</code>æ–‡ä»¶ä¸­ã€‚</p><h3 id="å®‰è£…è¿è¡Œrancher"><a href="#å®‰è£…è¿è¡Œrancher" class="headerlink" title="å®‰è£…è¿è¡Œrancher"></a>å®‰è£…è¿è¡Œrancher</h3><h4 id="ç½‘ç»œç»„ä»¶"><a href="#ç½‘ç»œç»„ä»¶" class="headerlink" title="ç½‘ç»œç»„ä»¶"></a>ç½‘ç»œç»„ä»¶</h4><p>å®‰è£…rancherä»¥åå¯èƒ½ä¼šç¢°åˆ°ä¸€äº›è«åå…¶å¦™çš„è¿æ¥é—®é¢˜ï¼Œè­¬å¦‚æ‰¾ä¸åˆ°å‘½åè™šæ‹Ÿæœºä¸‹èƒ½ä½¿ç”¨curlå‘½åè®¿é—®å…¶ä»–è™šæ‹Ÿæœºï¼Œä½†æ˜¯å®¹å™¨å´ä¸èƒ½è®¿é—®å…¶ä»–å®¹å™¨ï¼Œè¿™æ—¶å€™å°±éœ€è¦å…ˆå®‰è£…<code>weave</code>ç½‘ç»œç»„ä»¶äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull weaveworks/weave-npc:2.5.0</span><br></pre></td></tr></table></figure><h4 id="æ­£å¼å®‰è£…"><a href="#æ­£å¼å®‰è£…" class="headerlink" title="æ­£å¼å®‰è£…"></a>æ­£å¼å®‰è£…</h4><p>å¯ä»¥å‚è€ƒå¦‚ä¸‹å‘½ä»¤å®‰è£…rancher</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher</span><br></pre></td></tr></table></figure><p>å½“ç„¶å‘½ä»¤å¯ä»¥æ‰©å±•ï¼Œè¯¦æƒ…è§„åˆ™å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">sudo docker run -d -v &lt;ä¸»æœºè·¯å¾„&gt;:/var/lib/rancher/ --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher:stable</span></span><br></pre></td></tr></table></figure><h4 id="ç™»é™†rancher"><a href="#ç™»é™†rancher" class="headerlink" title="ç™»é™†rancher"></a>ç™»é™†rancher</h4><p>Rancher Serverå®¹å™¨å¯åŠ¨å¾ˆå¿«é€Ÿï¼Œä¸åˆ°ä¸€åˆ†é’Ÿä½ å°±å¯ä»¥é€šè¿‡<code>https://&lt;server_ip&gt;</code>è®¿é—®Rancher UIã€‚</p><p>ç¬¬ä¸€æ¬¡ç™»å½•ä¼šè¦æ±‚è®¾ç½®ç®¡ç†å‘˜å¯†ç ï¼Œé»˜è®¤ç®¡ç†å‘˜è´¦å·ä¸º: adminã€‚ä¸€æ—¦Rancher ServeræˆåŠŸå®‰è£…ï¼Œç”¨æˆ·ç•Œé¢å°†æŒ‡å¯¼ä½ æ·»åŠ ç¬¬ä¸€ä¸ªé›†ç¾¤</p><h4 id="åˆ›å»ºK8Sé›†ç¾¤"><a href="#åˆ›å»ºK8Sé›†ç¾¤" class="headerlink" title="åˆ›å»ºK8Sé›†ç¾¤"></a>åˆ›å»ºK8Sé›†ç¾¤</h4><p>é¦–å…ˆï¼Œå³ä¸‹è§’æ‰¾è¯­è¨€é€‰é¡¹ï¼Œé€‰ä¸­æ–‡ã€‚ç‚¹å‡»æ·»åŠ é›†ç¾¤ã€‚</p><p><img src="/2019/01/22/ä»0å¼€å§‹éƒ¨ç½²Rancher2-0/1.jpg" alt="æ·»åŠ é›†ç¾¤"></p><p>æ¥ä¸‹æ¥å†™ä¸€ä¸‹é›†ç¾¤çš„åç§°ï¼Œç‚¹å¼€å¦‚å›¾æ‰€ç¤ºçš„é€‰é¡¹ï¼ŒæŠŠå‘½ä»¤å¤åˆ¶ä¸€ä¸‹ï¼Œç²˜è´´åˆ°å®¿ä¸»æœºä¸­è¿è¡Œã€‚</p><p>æ³¨æ„ï¼Œrancher2.0åŸºäºk8sï¼Œè€Œk8séœ€è¦etcdèŠ‚ç‚¹å’ŒcontrolèŠ‚ç‚¹ã€‚ç°åœ¨ï¼Œrancherä¼šè‡ªåŠ¨å¸®ä½ å‹¾é€‰ä¸ŠworkerèŠ‚ç‚¹ï¼Œå¦‚æœä½ æ˜¯å•æœºç¯å¢ƒï¼Œå¿…é¡»è¦å…¨éƒ¨å‹¾é€‰è¿™ä¸‰ä¸ªä¸»æœºè§’è‰²åœ¨å¤åˆ¶å‘½ä»¤ã€‚</p><p><img src="/2019/01/22/ä»0å¼€å§‹éƒ¨ç½²Rancher2-0/2.jpg" alt="æ·»åŠ é›†ç¾¤"></p><h2 id="Dockerç§æœ‰ä»“åº“"><a href="#Dockerç§æœ‰ä»“åº“" class="headerlink" title="Dockerç§æœ‰ä»“åº“"></a>Dockerç§æœ‰ä»“åº“</h2><h3 id="ç§æœ‰ä»“åº“æ­å»ºä¸é…ç½®"><a href="#ç§æœ‰ä»“åº“æ­å»ºä¸é…ç½®" class="headerlink" title="ç§æœ‰ä»“åº“æ­å»ºä¸é…ç½®"></a>ç§æœ‰ä»“åº“æ­å»ºä¸é…ç½®</h3><p>ï¼ˆ1ï¼‰æ‹‰å–ç§æœ‰ä»“åº“é•œåƒï¼ˆæ­¤æ­¥çœç•¥ï¼‰<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ2ï¼‰å¯åŠ¨ç§æœ‰ä»“åº“å®¹å™¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=registry -p 5000:5000 registry</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ3ï¼‰æ‰“å¼€æµè§ˆå™¨ è¾“å…¥åœ°å€<code>http://192.168.190.137:5000/v2/_catalog</code> çœ‹åˆ°<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">repositories: [ ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¡¨ç¤ºç§æœ‰ä»“åº“æ­å»ºæˆåŠŸå¹¶ä¸”å†…å®¹ä¸ºç©º</p><p>ï¼ˆ4ï¼‰ä¿®æ”¹dockerçš„<code>daemon.json</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure></p><p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"insecure-registries"</span>:[&lt;server ip&gt;:<span class="number">5000</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ5ï¼‰é‡å¯docker æœåŠ¡<br>æ³¨æ„ï¼Œå¦‚æœä¸Šé¢çš„<code>daemon.json</code>æ ¼å¼å‡ºé”™ï¼Œæ­¤ä½¿dockerä¼šæŠ¥é”™ï¼Œå¯åŠ¨èµ·ä¸æ¥ã€‚è¯·ä»”ç»†æŸ¥çœ‹ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></p><h3 id="é•œåƒä¸Šä¼ è‡³ç§æœ‰ä»“åº“"><a href="#é•œåƒä¸Šä¼ è‡³ç§æœ‰ä»“åº“" class="headerlink" title="é•œåƒä¸Šä¼ è‡³ç§æœ‰ä»“åº“"></a>é•œåƒä¸Šä¼ è‡³ç§æœ‰ä»“åº“</h3><p>ï¼ˆ1ï¼‰æ ‡è®°æ­¤é•œåƒä¸ºç§æœ‰ä»“åº“çš„é•œåƒ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag &lt;imgName&gt; &lt;server ip&gt;:5000/&lt;ä»“åº“ name&gt;</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ2ï¼‰å†æ¬¡å¯åŠ¨ç§æœå®¹å™¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start registry</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ3ï¼‰ä¸Šä¼ æ ‡è®°çš„é•œåƒ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push &lt;server ip&gt;:5000/&lt;ä»“åº“ name&gt;</span><br></pre></td></tr></table></figure></p><h3 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h3><p>ç§æœ‰ä»“åº“ç»å†è¿‡ç‰ˆæœ¬è¿­ä»£ï¼Œä¹Ÿæœ‰æˆæƒè®¤è¯ç­‰åŠŸèƒ½ï¼Œæƒ³è¦äº†è§£æ›´å¤šèµ„æ–™è¯·çœ‹åšæ–‡ï¼Œ<a href="https://www.cnblogs.com/wade-luffy/p/6590849.html" target="_blank" rel="noopener">https://www.cnblogs.com/wade-luffy/p/6590849.html</a></p><h2 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h2><p>Dockerfileæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ï¼Œè¿™äº›å‘½ä»¤åº”ç”¨äºåŸºç¡€é•œåƒå¹¶æœ€ç»ˆåˆ›å»ºä¸€ä¸ª<br>æ–°çš„é•œåƒã€‚</p><ol><li>å¯¹äºå¼€å‘äººå‘˜ï¼šå¯ä»¥ä¸ºå¼€å‘å›¢é˜Ÿæä¾›ä¸€ä¸ªå®Œå…¨ä¸€è‡´çš„å¼€å‘ç¯å¢ƒï¼›</li><li>å¯¹äºæµ‹è¯•äººå‘˜ï¼šå¯ä»¥ç›´æ¥æ‹¿å¼€å‘æ—¶æ‰€æ„å»ºçš„é•œåƒæˆ–è€…é€šè¿‡Dockerfileæ–‡ä»¶æ„å»ºä¸€ä¸ªæ–°<br>çš„é•œåƒå¼€å§‹å·¥ä½œäº†ï¼›</li><li>å¯¹äºè¿ç»´äººå‘˜ï¼šåœ¨éƒ¨ç½²æ—¶ï¼Œå¯ä»¥å®ç°åº”ç”¨çš„æ— ç¼ç§»æ¤</li></ol><h4 id="dockerfileå†…å®¹è¯¦è§£"><a href="#dockerfileå†…å®¹è¯¦è§£" class="headerlink" title="dockerfileå†…å®¹è¯¦è§£"></a>dockerfileå†…å®¹è¯¦è§£</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FROM : æŒ‡å®šåŸºç¡€é•œåƒï¼Œè¦åœ¨å“ªä¸ªé•œåƒå»ºç«‹</span></span><br><span class="line"><span class="keyword">FROM</span> anapsix/alpine-java:<span class="number">8</span>_server-jre_unlimited <span class="comment">## æˆ‘è¦çš„å¾®æœåŠ¡éœ€è¦ä¾èµ–jreç¯å¢ƒ</span></span><br><span class="line"><span class="comment"># å®¹å™¨å·ï¼ŒæŒä¹…åŒ–çš„ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /tmp</span></span><br><span class="line"><span class="bash"><span class="comment"># MAINTAINERï¼šæŒ‡å®šç»´æŠ¤è€…ä¿¡æ¯</span></span></span><br><span class="line"><span class="bash">MAINTAINER randyvan007@qq.com</span></span><br><span class="line"><span class="bash"><span class="comment"># RUNï¼šåœ¨é•œåƒä¸­è¦æ‰§è¡Œçš„å‘½ä»¤ è¿™ä¸ªå‘½åæ˜¯åŒæ­¥å®¹å™¨å†…æ—¶é—´ï¼Œé˜²æ­¢éƒ¨åˆ†æ“ä½œå‡ºé”™çš„ã€‚ä¸éœ€è¦å¯ä»¥ä¸æ‰§è¡Œ</span></span></span><br><span class="line"><span class="bash">RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">RUN mkdir -p /miaosha-redis</span></span><br><span class="line"><span class="bash"><span class="comment"># WORKDIRï¼šæŒ‡å®šå½“å‰å·¥ä½œç›®å½•ï¼Œç›¸å½“äº cd</span></span></span><br><span class="line"><span class="bash">WORKDIR /miaosha-redis</span></span><br><span class="line"><span class="bash"><span class="comment"># EXPOSEï¼šæŒ‡å®šå®¹å™¨è¦æ‰“å¼€çš„ç«¯å£</span></span></span><br><span class="line"><span class="bash">EXPOSE 8080</span></span><br><span class="line"><span class="bash"><span class="comment"># ADDï¼šç›¸å½“äº COPYï¼Œä½†æ˜¯æ¯” COPY åŠŸèƒ½æ›´å¼ºå¤§ COPY ï¼šå¤åˆ¶æœ¬åœ°ä¸»æœºçš„ ï¼ˆä¸º Dockerfile æ‰€åœ¨ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼‰åˆ°å®¹å™¨ä¸­çš„</span></span></span><br><span class="line"><span class="bash">ADD ./miaosha-redis/target/miaosha-redis.jar ./</span></span><br><span class="line"><span class="bash"><span class="comment"># å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤</span></span></span><br><span class="line"><span class="bash">ENTRYPOINT [<span class="string">"java"</span>, <span class="string">"-Djava.security.egd=file:/dev/./urandom"</span>, <span class="string">"-jar"</span>, <span class="string">"app.jar"</span>]</span></span><br><span class="line"><span class="bash"><span class="comment"># å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤</span></span></span><br><span class="line"><span class="bash">CMD [<span class="string">"--spring.profiles.active=test"</span>]</span></span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œå‘½ä»¤æ„å»ºé•œåƒ"><a href="#æ‰§è¡Œå‘½ä»¤æ„å»ºé•œåƒ" class="headerlink" title="æ‰§è¡Œå‘½ä»¤æ„å»ºé•œåƒ"></a>æ‰§è¡Œå‘½ä»¤æ„å»ºé•œåƒ</h4><p>åœ¨<code>dockerfile</code>çš„ç›®å½•ä¸‹ï¼Œè¾“å…¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build [options] PATH | URL</span><br></pre></td></tr></table></figure></p><ul><li><p><code>docker build</code>ï¼š ç”¨ Dockerfile æ„å»ºé•œåƒçš„å‘½ä»¤å…³é”®è¯ã€‚</p></li><li><p><code>[OPTIONS]</code> : å‘½ä»¤é€‰é¡¹ï¼Œå¸¸ç”¨çš„æŒ‡ä»¤åŒ…æ‹¬ <code>-t</code> æŒ‡å®šé•œåƒçš„åå­—ï¼Œ<br><code>-f</code> æ˜¾ç¤ºæŒ‡å®šæ„å»ºé•œåƒçš„ Dockerfile æ–‡ä»¶ï¼ˆDockerfile å¯ä¸åœ¨å½“å‰è·¯å¾„ä¸‹ï¼‰ï¼Œ<br>å¦‚æœä¸ä½¿ç”¨ -fï¼Œåˆ™é»˜è®¤å°†ä¸Šä¸‹æ–‡è·¯å¾„ä¸‹çš„åä¸º Dockerfile çš„æ–‡ä»¶è®¤ä¸ºæ˜¯æ„å»ºé•œåƒçš„ â€œDockerfileâ€ ã€‚</p></li><li><p><code>ä¸Šä¸‹æ–‡è·¯å¾„|URL</code>ï¼š æŒ‡å®šæ„å»ºé•œåƒçš„ä¸Šä¸‹æ–‡çš„è·¯å¾„ï¼Œæ„å»ºé•œåƒçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä¸”åªå¯ä»¥å¼•ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ä»»ä½•æ–‡ä»¶ ã€‚</p></li></ul><h4 id="æŸ¥çœ‹é•œåƒæ˜¯å¦å»ºç«‹å®Œæˆ"><a href="#æŸ¥çœ‹é•œåƒæ˜¯å¦å»ºç«‹å®Œæˆ" class="headerlink" title="æŸ¥çœ‹é•œåƒæ˜¯å¦å»ºç«‹å®Œæˆ"></a>æŸ¥çœ‹é•œåƒæ˜¯å¦å»ºç«‹å®Œæˆ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºå®¹å™¨"><a href="#åˆ›å»ºå®¹å™¨" class="headerlink" title="åˆ›å»ºå®¹å™¨"></a>åˆ›å»ºå®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=æ™¯è±¡åç§° /bin/bash</span><br></pre></td></tr></table></figure><h2 id="å¾®æœåŠ¡éƒ¨ç½²"><a href="#å¾®æœåŠ¡éƒ¨ç½²" class="headerlink" title="å¾®æœåŠ¡éƒ¨ç½²"></a>å¾®æœåŠ¡éƒ¨ç½²</h2><p>å¾®æœåŠ¡éƒ¨ç½²æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ol><li>æ‰‹åŠ¨éƒ¨ç½²ï¼š<br> é¦–å…ˆåŸºäºæºç æ‰“åŒ…ç”ŸæˆjaråŒ…ï¼ˆæˆ–waråŒ…ï¼‰,å°†jaråŒ…ï¼ˆæˆ–waråŒ…ï¼‰ä¸Šä¼ è‡³è™šæ‹Ÿæœºå¹¶æ‹·è´è‡³JDKå®¹å™¨ã€‚</li><li>é€šè¿‡Mavenæ’ä»¶è‡ªåŠ¨éƒ¨ç½²ã€‚<br>   å¯¹äºæ•°é‡ä¼—å¤šçš„å¾®æœåŠ¡ï¼Œæ‰‹åŠ¨éƒ¨ç½²æ— ç–‘æ˜¯éå¸¸éº»çƒ¦çš„åšæ³•ï¼Œå¹¶ä¸”å®¹æ˜“å‡ºé”™ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå­¦ä¹ å¦‚ä½•è‡ªåŠ¨éƒ¨ç½²ï¼Œè¿™ä¹Ÿæ˜¯ä¼ä¸šå®é™…å¼€å‘ä¸­ç»å¸¸ä½¿ç”¨çš„æ–¹æ³•ã€‚</li></ol><h3 id="Mavenæ’ä»¶è‡ªåŠ¨éƒ¨ç½²æ­¥éª¤ï¼š"><a href="#Mavenæ’ä»¶è‡ªåŠ¨éƒ¨ç½²æ­¥éª¤ï¼š" class="headerlink" title="Mavenæ’ä»¶è‡ªåŠ¨éƒ¨ç½²æ­¥éª¤ï¼š"></a>Mavenæ’ä»¶è‡ªåŠ¨éƒ¨ç½²æ­¥éª¤ï¼š</h3><p>ï¼ˆ1ï¼‰ä¿®æ”¹å®¿ä¸»æœºçš„dockeré…ç½®ï¼Œè®©å…¶å¯ä»¥è¿œç¨‹è®¿é—®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /lib/systemd/system/docker.service</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ExecStart=åæ·»åŠ é…ç½® <code>â€H tcp://0.0.0.0:2375 â€H unix:///var/run/docker.sock</code></p><p>ï¼ˆ2ï¼‰åˆ·æ–°é…ç½®ï¼Œé‡å¯æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemonâ€reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">docker start registry</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰å¾®æœåŠ¡çš„mavenå·¥ç¨‹pom.xml å¢åŠ é…ç½®<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.name&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.build.finalName&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- dockerçš„mavenæ’ä»¶ï¼Œå®˜ç½‘ï¼šhttps://github.com/spotify/docker-maven-plugin --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spotify<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docker-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- æ³¨æ„imageNameä¸€å®šè¦æ˜¯ç¬¦åˆæ­£åˆ™[a-z0-9-_.]çš„ï¼Œå¦åˆ™æ„å»ºä¸ä¼šæˆåŠŸ --&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- è¯¦è§ï¼šhttps://github.com/spotify/docker-maven-plugin    Invalid repository name ... only [a-z0-9-_.] are allowed--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">imageName</span>&gt;</span>$&#123;registry.url&#125;/$&#123;project.name&#125;:0.0.1<span class="tag">&lt;/<span class="name">imageName</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dockerHost</span>&gt;</span>$&#123;docker.url&#125;<span class="tag">&lt;/<span class="name">dockerHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dockerDirectory</span>&gt;</span>$&#123;project.basedir&#125;<span class="tag">&lt;/<span class="name">dockerDirectory</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">baseImage</span>&gt;</span>java<span class="tag">&lt;/<span class="name">baseImage</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">entryPoint</span>&gt;</span>["java", "-jar", "/$&#123;project.build.finalName&#125;.jar"]<span class="tag">&lt;/<span class="name">entryPoint</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>/<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">include</span>&gt;</span>$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">serverId</span>&gt;</span>docker-hub<span class="tag">&lt;/<span class="name">serverId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">registryUrl</span>&gt;</span>https://index.docker.io/v1/<span class="tag">&lt;/<span class="name">registryUrl</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spotify<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dockerfile-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>default<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>build<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>push<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ä¸Šä¸‹æ–‡è·¯å¾„é…ç½®ï¼Œæ­¤å¤„è®¾ç½®ä¸ºé¡¹ç›®æ ¹è·¯å¾„--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">contextDirectory</span>&gt;</span>$&#123;project.basedir&#125;<span class="tag">&lt;/<span class="name">contextDirectory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">useMavenSettingsForAuth</span>&gt;</span>true<span class="tag">&lt;/<span class="name">useMavenSettingsForAuth</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span>$&#123;registryUrl&#125;/hush/$&#123;project.build.finalName&#125;<span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span>$&#123;imageVersion&#125;<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ä½œä¸ºDockerfileæ–‡ä»¶ä¼ å…¥--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">buildArgs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">JAR_FILE</span>&gt;</span>$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">JAR_FILE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">buildArgs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span>&gt;</span>$&#123;maven.compiler.target&#125;<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span>$&#123;maven.compiler.source&#125;<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨ä»¥ä¸Šæ’ä»¶å¯ä»¥è‡ªåŠ¨ç”Ÿæˆdockerfile</p><p>ï¼ˆ5ï¼‰åœ¨windowsçš„CMDä¸‹ï¼Œè¿›å…¥å¾®æœåŠ¡å·¥ç¨‹æ‰€åœ¨çš„ç›®å½•ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œè¿›è¡Œæ‰“åŒ…å’Œä¸Šä¼ é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package docker:build -DpushImage</span><br></pre></td></tr></table></figure><p>ï¼ˆ6ï¼‰å»é•œåƒåº“æŸ¥çœ‹é•œåƒ<br>æµè§ˆå™¨è®¿é—®<code>http://&lt;server ip&gt;:5000/v2/_catalog</code> ï¼Œè¾“å‡ºäº†æˆ‘ä»¬ä¸Šä¸€æ­¥å‘½åçš„é•œåƒåç§°ï¼Œåˆ™ä¸Šä¼ æˆåŠŸã€‚</p><p>ï¼ˆ7ï¼‰åœ¨è™šæ‹ŸæœºæŸ¥çœ‹é•œåƒä¸å¯åŠ¨å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>æ‰“å®Œä»¥åæ˜¾ç¤ºé•œåƒåç§°ã€‚ä¸‹é¢è¯¥å¯åŠ¨å®¹å™¨äº†ï¼<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=æœåŠ¡åç§° -p å®¹å™¨å†…æœåŠ¡çš„ç«¯å£å·:å®¹å™¨å‘å¸ƒçš„ç«¯å£å· &lt;server ip&gt;:5000/é•œåƒåç§°</span><br></pre></td></tr></table></figure></p><h2 id="æŒç»­é›†æˆæŒç»­éƒ¨ç½²"><a href="#æŒç»­é›†æˆæŒç»­éƒ¨ç½²" class="headerlink" title="æŒç»­é›†æˆæŒç»­éƒ¨ç½²"></a>æŒç»­é›†æˆæŒç»­éƒ¨ç½²</h2><h3 id="ä»€ä¹ˆæ˜¯æŒç»­é›†æˆ"><a href="#ä»€ä¹ˆæ˜¯æŒç»­é›†æˆ" class="headerlink" title="ä»€ä¹ˆæ˜¯æŒç»­é›†æˆ"></a>ä»€ä¹ˆæ˜¯æŒç»­é›†æˆ</h3><p>æŒç»­é›†æˆ Continuous integration ï¼Œç®€ç§°CI<br>éšç€è½¯ä»¶å¼€å‘å¤æ‚åº¦çš„ä¸æ–­æé«˜ï¼Œå›¢é˜Ÿå¼€å‘æˆå‘˜é—´å¦‚ä½•æ›´å¥½åœ°ååŒå·¥ä½œä»¥ç¡®ä¿è½¯ä»¶å¼€å‘çš„è´¨é‡å·²ç»æ…¢æ…¢æˆä¸ºå¼€å‘è¿‡ç¨‹ä¸­ä¸å¯å›é¿çš„é—®é¢˜ã€‚å°¤å…¶æ˜¯è¿‘äº›å¹´æ¥ï¼Œæ•æ·ï¼ˆAgileï¼‰åœ¨è½¯ä»¶å·¥ç¨‹é¢†åŸŸè¶Šæ¥è¶Šçº¢ç«ï¼Œå¦‚ä½•èƒ½å†ä¸æ–­å˜åŒ–çš„éœ€æ±‚ä¸­å¿«é€Ÿé€‚åº”å’Œä¿è¯è½¯ä»¶çš„è´¨é‡ä¹Ÿæ˜¾å¾—å°¤å…¶çš„é‡è¦ã€‚<br>æŒç»­é›†æˆæ­£æ˜¯é’ˆå¯¹è¿™ä¸€ç±»é—®é¢˜çš„ä¸€ç§è½¯ä»¶å¼€å‘å®è·µã€‚å®ƒå€¡å¯¼å›¢é˜Ÿå¼€å‘æˆå‘˜å¿…é¡»ç»å¸¸é›†æˆä»–ä»¬çš„å·¥ä½œï¼Œç”šè‡³æ¯å¤©éƒ½å¯èƒ½å‘ç”Ÿå¤šæ¬¡é›†æˆã€‚è€Œæ¯æ¬¡çš„é›†æˆéƒ½æ˜¯é€šè¿‡è‡ªåŠ¨åŒ–çš„æ„å»ºæ¥éªŒè¯ï¼ŒåŒ…æ‹¬è‡ªåŠ¨ç¼–è¯‘ã€å‘å¸ƒå’Œæµ‹è¯•ï¼Œä»è€Œå°½å¿«åœ°å‘ç°é›†æˆé”™è¯¯ï¼Œè®©å›¢é˜Ÿèƒ½å¤Ÿæ›´å¿«çš„å¼€å‘å†…èšçš„è½¯ä»¶ã€‚</p><h3 id="æŒç»­é›†æˆçš„ç‰¹ç‚¹"><a href="#æŒç»­é›†æˆçš„ç‰¹ç‚¹" class="headerlink" title="æŒç»­é›†æˆçš„ç‰¹ç‚¹"></a>æŒç»­é›†æˆçš„ç‰¹ç‚¹</h3><p>å®ƒæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å‘¨æœŸæ€§çš„é›†æˆæµ‹è¯•è¿‡ç¨‹ï¼Œä»æ£€å‡ºä»£ç ã€ç¼–è¯‘æ„å»ºã€è¿è¡Œæµ‹è¯•ã€ç»“æœè®°å½•ã€æµ‹è¯•ç»Ÿè®¡ç­‰éƒ½æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼›éœ€è¦æœ‰ä¸“é—¨çš„é›†æˆæœåŠ¡å™¨æ¥æ‰§è¡Œé›†æˆæ„å»ºï¼›éœ€è¦æœ‰ä»£ç æ‰˜ç®¡å·¥å…·æ”¯æŒï¼Œæˆ‘ä»¬ä¸‹ä¸€å°èŠ‚å°†ä»‹ç»Gitä»¥åŠå¯è§†åŒ–ç•Œé¢Gogsçš„ä½¿ç”¨</p><h3 id="æŒç»­é›†æˆä½œç”¨"><a href="#æŒç»­é›†æˆä½œç”¨" class="headerlink" title="æŒç»­é›†æˆä½œç”¨"></a>æŒç»­é›†æˆä½œç”¨</h3><p>ä¿è¯å›¢é˜Ÿå¼€å‘äººå‘˜æäº¤ä»£ç çš„è´¨é‡ï¼Œå‡è½»äº†è½¯ä»¶å‘å¸ƒæ—¶çš„å‹åŠ›ï¼›æŒç»­é›†æˆä¸­çš„ä»»ä½•ä¸€ä¸ªç¯èŠ‚éƒ½æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œæ— éœ€å¤ªå¤šçš„äººå·¥å¹²é¢„ï¼Œæœ‰åˆ©äºå‡å°‘é‡å¤è¿‡ç¨‹ä»¥èŠ‚çœæ—¶é—´ã€è´¹ç”¨å’Œå·¥ä½œé‡ï¼›</p><h3 id="rancherå’ŒæŒç»­é›†æˆ"><a href="#rancherå’ŒæŒç»­é›†æˆ" class="headerlink" title="rancherå’ŒæŒç»­é›†æˆ"></a>rancherå’ŒæŒç»­é›†æˆ</h3><p>rancheræ”¯æŒä¸GitHubå¹³å°ä¸GitLabå¹³å°æŒç»­é›†æˆã€‚æ¥ä¸‹æ¥æˆ‘ä¼šæ–°å¼€ç¯‡æ–‡ç« è®²è®²gitå¹³å°ç§æœçš„æ­å»ºä»¥åŠæŒç»­é›†æˆã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.cnrancher.com/docs/rancher/v2.x/cn/overview/quick-start-guide/" target="_blank" rel="noopener">rancherå®˜æ–¹æ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Rancheræ˜¯ä¸€ä¸ªå¼€æºçš„ä¼ä¸šçº§å®¹å™¨ç®¡ç†å¹³å°ã€‚é€šè¿‡Rancherï¼Œä¼ä¸šå†ä¹Ÿä¸å¿…è‡ªå·±ä½¿ç”¨ä¸€ç³»åˆ—çš„å¼€æºè½¯ä»¶å»ä»å¤´æ­å»ºå®¹å™¨æœåŠ¡å¹³å°ã€‚Rancheræä¾›äº†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨çš„ç®¡ç†Dockerå’ŒKubernetesçš„å…¨æ ˆåŒ–å®¹å™¨éƒ¨ç½²ä¸ç®¡ç†å¹³å°ã€‚ä»Šå¤©åˆ†äº«ä¸€ä¸‹æˆ‘ä»0å¼€å§‹éƒ¨ç½²Rancher2.
      
    
    </summary>
    
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://tengshe789.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="k8s" scheme="https://tengshe789.github.io/tags/k8s/"/>
    
      <category term="åˆ†äº«" scheme="https://tengshe789.github.io/tags/%E5%88%86%E4%BA%AB/"/>
    
      <category term="è½¯ä»¶æ•™å­¦" scheme="https://tengshe789.github.io/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>è®°å½•docker å®‰è£…ä¸è°ƒä¼˜</title>
    <link href="https://tengshe789.github.io/2019/01/18/%E8%AE%B0%E5%BD%95docker-%E5%AE%89%E8%A3%85%E4%B8%8E%E8%B0%83%E4%BC%98/"/>
    <id>https://tengshe789.github.io/2019/01/18/è®°å½•docker-å®‰è£…ä¸è°ƒä¼˜/</id>
    <published>2019-01-18T08:33:42.000Z</published>
    <updated>2019-11-20T13:39:41.563Z</updated>
    
    <content type="html"><![CDATA[<p>k8sæ˜¯å®¹å™¨ç¼–æ’ç³»ç»Ÿï¼Œéœ€è¦dockerçš„æ”¯æŒï¼Œä»Šå¤©åˆ†äº«ä¸€æ³¢dockerçš„å®‰è£…ä¸è°ƒä¼˜è¿‡ç¨‹ã€‚</p><p>ä¸äº†è§£dockerçš„ç«¥é‹å¯ä»¥å‚è€ƒ<a href="https://www.cnblogs.com/SzeCheng/p/6822905.html" target="_blank" rel="noopener">åšæ–‡</a>ï¼Œæœ¬ç¯‡æ–‡ç« çš„ä¸»é¢˜ä¸åœ¨è®²è§£dockeråŸç†~</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§" target="_blank" rel="noopener">https://blog.tengshe789.tech/ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§</a></p><h1 id="docker-å®‰è£…"><a href="#docker-å®‰è£…" class="headerlink" title="docker å®‰è£…"></a>docker å®‰è£…</h1><h2 id="centos7ä¸‹"><a href="#centos7ä¸‹" class="headerlink" title="centos7ä¸‹"></a>centos7ä¸‹</h2><h3 id="æ›´æ–°-yum-æº"><a href="#æ›´æ–°-yum-æº" class="headerlink" title="æ›´æ–° yum æº"></a>æ›´æ–° yum æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y update</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹ç³»ç»Ÿæº</strong></p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br><span class="line">cat &gt; /etc/yum.repos.d/CentOS-Base.repo &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">[base]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Base - mirrors.aliyun.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.aliyuncs.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.cloud.aliyuncs.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#released updates</span></span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Updates - mirrors.aliyun.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/updates/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.aliyuncs.com/centos/<span class="variable">$releasever</span>/updates/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.cloud.aliyuncs.com/centos/<span class="variable">$releasever</span>/updates/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that may be useful</span></span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Extras - mirrors.aliyun.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/extras/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.aliyuncs.com/centos/<span class="variable">$releasever</span>/extras/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.cloud.aliyuncs.com/centos/<span class="variable">$releasever</span>/extras/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that extend functionality of existing packages</span></span><br><span class="line">[centosplus]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Plus - mirrors.aliyun.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/centosplus/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.aliyuncs.com/centos/<span class="variable">$releasever</span>/centosplus/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.cloud.aliyuncs.com/centos/<span class="variable">$releasever</span>/centosplus/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#contrib - packages by Centos Users</span></span><br><span class="line">[contrib]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Contrib - mirrors.aliyun.com</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/contrib/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.aliyuncs.com/centos/<span class="variable">$releasever</span>/contrib/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.cloud.aliyuncs.com/centos/<span class="variable">$releasever</span>/contrib/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-netstatï¼ˆç”¨äºæŸ¥çœ‹å½“å‰æœºå™¨ç«¯å£å ç”¨æƒ…å†µï¼‰"><a href="#å®‰è£…-netstatï¼ˆç”¨äºæŸ¥çœ‹å½“å‰æœºå™¨ç«¯å£å ç”¨æƒ…å†µï¼‰" class="headerlink" title="å®‰è£… netstatï¼ˆç”¨äºæŸ¥çœ‹å½“å‰æœºå™¨ç«¯å£å ç”¨æƒ…å†µï¼‰"></a>å®‰è£… netstatï¼ˆç”¨äºæŸ¥çœ‹å½“å‰æœºå™¨ç«¯å£å ç”¨æƒ…å†µï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…</span></span><br><span class="line">yum install net-tools</span><br><span class="line"><span class="comment">#ä½¿ç”¨</span></span><br><span class="line">netstat -ntlp</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ -yum-æº"><a href="#æ·»åŠ -yum-æº" class="headerlink" title="æ·»åŠ  yum æº"></a>æ·»åŠ  yum æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;/etc/yum.repos.d/docker.repo &lt;&lt;-EOF            </span><br><span class="line">    [dockerrepo]</span><br><span class="line">name=Docker Repository</span><br><span class="line">baseurl=https://yum.dockerproject.org/repo/main/centos/7</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://yum.dockerproject.org/gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-docker"><a href="#å®‰è£…-docker" class="headerlink" title="å®‰è£… docker"></a>å®‰è£… docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-selinux</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-engine</span><br></pre></td></tr></table></figure><h3 id="é…ç½®docker"><a href="#é…ç½®docker" class="headerlink" title="é…ç½®docker"></a>é…ç½®docker</h3><ul><li><p>é…ç½®æ‰€æœ‰ipçš„æ•°æ®åŒ…è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /lib/systemd/system/docker.service</span><br><span class="line">   </span><br><span class="line"><span class="comment">#æ‰¾åˆ°ExecStart=xxxï¼Œåœ¨è¿™è¡Œä¸‹é¢åŠ å…¥ä¸€è¡Œï¼Œå†…å®¹å¦‚ä¸‹ï¼š(k8sçš„ç½‘ç»œéœ€è¦)</span></span><br><span class="line">ExecStartPost=/sbin/iptables -I FORWARD -s 0.0.0.0/0 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½® docker å¼€æœºæœåŠ¡å¯åŠ¨</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker.service </span><br><span class="line"> </span><br><span class="line"><span class="comment">#ç«‹å³å¯åŠ¨ docker æœåŠ¡</span></span><br><span class="line">$ systemctl start docker.service</span><br></pre></td></tr></table></figure></li></ul><h3 id="docker-ce"><a href="#docker-ce" class="headerlink" title="docker ce"></a>docker ce</h3><blockquote><p>å› ä¸ºCentOSçš„å®‰å…¨é™åˆ¶ï¼Œé€šè¿‡RKEå®‰è£…K8Sé›†ç¾¤æ—¶å€™æ— æ³•ä½¿ç”¨<code>root</code>è´¦æˆ·ã€‚æ‰€ä»¥ï¼Œå»ºè®®<code>CentOS</code>ç”¨æˆ·ä½¿ç”¨é<code>root</code>ç”¨æˆ·æ¥è¿è¡Œdocker,ä¸ç®¡æ˜¯<code>RKE</code>è¿˜æ˜¯<code>custom</code>å®‰è£…k8s,è¯¦æƒ…æŸ¥çœ‹<a href="https://www.cnrancher.com/docs/rancher/v2.x/cn/faq/troubleshooting-ha/ssh-tunneling/" target="_blank" rel="noopener">æ— æ³•ä¸ºä¸»æœºé…ç½®SSHéš§é“</a>ã€‚</p></blockquote>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ç”¨æˆ·(å¯é€‰)</span></span><br><span class="line">sudo adduser `&lt;new_user&gt;`</span><br><span class="line"><span class="comment"># ä¸ºæ–°ç”¨æˆ·è®¾ç½®å¯†ç </span></span><br><span class="line">sudo passwd `&lt;new_user&gt;`</span><br><span class="line"><span class="comment"># ä¸ºæ–°ç”¨æˆ·æ·»åŠ sudoæƒé™</span></span><br><span class="line">sudo <span class="built_in">echo</span> <span class="string">'&lt;new_user&gt; ALL=(ALL) ALL'</span> &gt;&gt; /etc/sudoers</span><br><span class="line"><span class="comment"># å¸è½½æ—§ç‰ˆæœ¬Dockerè½¯ä»¶</span></span><br><span class="line">sudo yum remove docker \</span><br><span class="line">              docker-client \</span><br><span class="line">              docker-client-latest \</span><br><span class="line">              docker-common \</span><br><span class="line">              docker-latest \</span><br><span class="line">              docker-latest-logrotate \</span><br><span class="line">              docker-logrotate \</span><br><span class="line">              docker-selinux \</span><br><span class="line">              docker-engine-selinux \</span><br><span class="line">              docker-engine \</span><br><span class="line">              container*</span><br><span class="line"><span class="comment"># å®šä¹‰å®‰è£…ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">export</span> docker_version=17.03.2</span><br><span class="line"><span class="comment"># step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·</span></span><br><span class="line">sudo yum update -y</span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2 bash-completion</span><br><span class="line"><span class="comment"># Step 2: æ·»åŠ è½¯ä»¶æºä¿¡æ¯</span></span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment"># Step 3: æ›´æ–°å¹¶å®‰è£… Docker-CE</span></span><br><span class="line">sudo yum makecache all</span><br><span class="line">version=$(yum list docker-ce.x86_64 --showduplicates | sort -r|grep <span class="variable">$&#123;docker_version&#125;</span>|awk <span class="string">'&#123;print $2&#125;'</span>)</span><br><span class="line">sudo yum -y install --<span class="built_in">setopt</span>=obsoletes=0 docker-ce-<span class="variable">$&#123;version&#125;</span> docker-ce-selinux-<span class="variable">$&#123;version&#125;</span></span><br><span class="line"><span class="comment"># å¦‚æœå·²ç»å®‰è£…é«˜ç‰ˆæœ¬Docker,å¯è¿›è¡Œé™çº§å®‰è£…(å¯é€‰)</span></span><br><span class="line">yum downgrade --<span class="built_in">setopt</span>=obsoletes=0 -y docker-ce-<span class="variable">$&#123;version&#125;</span> docker-ce-selinux-<span class="variable">$&#123;version&#125;</span></span><br><span class="line"><span class="comment"># æŠŠå½“å‰ç”¨æˆ·åŠ å…¥dockerç»„</span></span><br><span class="line">sudo usermod -aG docker `&lt;new_user&gt;`</span><br><span class="line"><span class="comment"># è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><h2 id="Ubuntuä¸‹"><a href="#Ubuntuä¸‹" class="headerlink" title="Ubuntuä¸‹"></a>Ubuntuä¸‹</h2><h3 id="å¸è½½æ—§ç‰ˆæœ¬-å¦‚æœæœ‰çš„è¯"><a href="#å¸è½½æ—§ç‰ˆæœ¬-å¦‚æœæœ‰çš„è¯" class="headerlink" title="å¸è½½æ—§ç‰ˆæœ¬(å¦‚æœæœ‰çš„è¯)"></a>å¸è½½æ—§ç‰ˆæœ¬(å¦‚æœæœ‰çš„è¯)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get remove docker docker-engine docker.io</span><br></pre></td></tr></table></figure><h3 id="æ›´æ–°apt-getæº"><a href="#æ›´æ–°apt-getæº" class="headerlink" title="æ›´æ–°apt-getæº"></a>æ›´æ–°apt-getæº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ add-apt-repository  <span class="string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class="variable">$(lsb_release -cs)</span> stable"</span></span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹ç³»ç»Ÿæº </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line">cat &gt; /etc/apt/sources.list &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial main</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial main</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial universe</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial universe</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates universe</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security main</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security universe</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get update</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…aptçš„httpsæ”¯æŒåŒ…å¹¶æ·»åŠ gpgç§˜é’¥"><a href="#å®‰è£…aptçš„httpsæ”¯æŒåŒ…å¹¶æ·»åŠ gpgç§˜é’¥" class="headerlink" title="å®‰è£…aptçš„httpsæ”¯æŒåŒ…å¹¶æ·»åŠ gpgç§˜é’¥"></a>å®‰è£…aptçš„httpsæ”¯æŒåŒ…å¹¶æ·»åŠ gpgç§˜é’¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    software-properties-common</span><br><span class="line">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…docker-ce"><a href="#å®‰è£…docker-ce" class="headerlink" title="å®‰è£…docker-ce"></a>å®‰è£…docker-ce</h3><ul><li><p>å®‰è£…æœ€æ–°çš„ç¨³å®šç‰ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install -y docker-ce</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…æŒ‡å®šç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è·å–ç‰ˆæœ¬åˆ—è¡¨</span></span><br><span class="line">$ apt-cache madison docker-ce</span><br><span class="line"> </span><br><span class="line"><span class="comment">#æŒ‡å®šç‰ˆæœ¬å®‰è£…(æ¯”å¦‚ç‰ˆæœ¬æ˜¯17.09.1~ce-0~ubuntu)</span></span><br><span class="line">$ apt-get install -y docker-ce=17.09.1~ce-0~ubuntu</span><br></pre></td></tr></table></figure></li><li><p>æ¥å—æ‰€æœ‰ipçš„æ•°æ®åŒ…è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ vi /lib/systemd/system/docker.service</span><br><span class="line">   </span><br><span class="line"><span class="comment">#æ‰¾åˆ°ExecStart=xxxï¼Œåœ¨è¿™è¡Œä¸Šé¢åŠ å…¥ä¸€è¡Œï¼Œå†…å®¹å¦‚ä¸‹ï¼š(k8sçš„ç½‘ç»œéœ€è¦)</span></span><br><span class="line">ExecStartPost=/sbin/iptables -I FORWARD -s 0.0.0.0/0 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ service docker start</span><br></pre></td></tr></table></figure></li></ul><p>é‡åˆ°é—®é¢˜å¯ä»¥å‚è€ƒï¼š[å®˜æ–¹æ•™ç¨‹][1]</p><h1 id="éƒ¨ç½²k8så‰ç³»ç»Ÿçš„è®¾ç½®"><a href="#éƒ¨ç½²k8så‰ç³»ç»Ÿçš„è®¾ç½®" class="headerlink" title="éƒ¨ç½²k8så‰ç³»ç»Ÿçš„è®¾ç½®"></a>éƒ¨ç½²k8så‰ç³»ç»Ÿçš„è®¾ç½®</h1><h4 id="å…³é—­ã€ç¦ç”¨é˜²ç«å¢™-è®©æ‰€æœ‰æœºå™¨ä¹‹é—´éƒ½å¯ä»¥é€šè¿‡ä»»æ„ç«¯å£å»ºç«‹è¿æ¥"><a href="#å…³é—­ã€ç¦ç”¨é˜²ç«å¢™-è®©æ‰€æœ‰æœºå™¨ä¹‹é—´éƒ½å¯ä»¥é€šè¿‡ä»»æ„ç«¯å£å»ºç«‹è¿æ¥" class="headerlink" title="å…³é—­ã€ç¦ç”¨é˜²ç«å¢™(è®©æ‰€æœ‰æœºå™¨ä¹‹é—´éƒ½å¯ä»¥é€šè¿‡ä»»æ„ç«¯å£å»ºç«‹è¿æ¥)"></a>å…³é—­ã€ç¦ç”¨é˜²ç«å¢™(è®©æ‰€æœ‰æœºå™¨ä¹‹é—´éƒ½å¯ä»¥é€šè¿‡ä»»æ„ç«¯å£å»ºç«‹è¿æ¥)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ufw <span class="built_in">disable</span></span><br><span class="line"><span class="comment">#æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">$ ufw status</span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®ç³»ç»Ÿå‚æ•°-å…è®¸è·¯ç”±è½¬å‘ï¼Œä¸å¯¹bridgeçš„æ•°æ®è¿›è¡Œå¤„ç†"><a href="#è®¾ç½®ç³»ç»Ÿå‚æ•°-å…è®¸è·¯ç”±è½¬å‘ï¼Œä¸å¯¹bridgeçš„æ•°æ®è¿›è¡Œå¤„ç†" class="headerlink" title="è®¾ç½®ç³»ç»Ÿå‚æ•° - å…è®¸è·¯ç”±è½¬å‘ï¼Œä¸å¯¹bridgeçš„æ•°æ®è¿›è¡Œå¤„ç†"></a>è®¾ç½®ç³»ç»Ÿå‚æ•° - å…è®¸è·¯ç”±è½¬å‘ï¼Œä¸å¯¹bridgeçš„æ•°æ®è¿›è¡Œå¤„ç†</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å†™å…¥é…ç½®æ–‡ä»¶</span></span><br><span class="line">$ cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br><span class="line"> </span><br><span class="line"><span class="comment">#ç”Ÿæ•ˆé…ç½®æ–‡ä»¶</span></span><br><span class="line">$ sysctl -p /etc/sysctl.d/k8s.conf</span><br></pre></td></tr></table></figure><h3 id="é…ç½®hostæ–‡ä»¶"><a href="#é…ç½®hostæ–‡ä»¶" class="headerlink" title="é…ç½®hostæ–‡ä»¶"></a>é…ç½®hostæ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é…ç½®hostï¼Œä½¿æ¯ä¸ªNodeéƒ½å¯ä»¥é€šè¿‡åå­—è§£æåˆ°ipåœ°å€</span></span><br><span class="line">$ vim /etc/hosts</span><br><span class="line"><span class="comment">#åŠ å…¥å¦‚ä¸‹ç‰‡æ®µ(ipåœ°å€å’Œservernameæ›¿æ¢æˆè‡ªå·±çš„)</span></span><br><span class="line">192.168.190.137 ubuntu01</span><br><span class="line">192.168.190.136 ubuntu03</span><br><span class="line">192.168.190.132 centos7</span><br><span class="line">192.168.190.135 ubuntu02</span><br></pre></td></tr></table></figure><h1 id="è°ƒä¼˜"><a href="#è°ƒä¼˜" class="headerlink" title="è°ƒä¼˜"></a>è°ƒä¼˜</h1><p>å¯¹äºé€šè¿‡systemdæ¥ç®¡ç†æœåŠ¡çš„ç³»ç»Ÿ(æ¯”å¦‚CentOS7.Xã€Ubuntu16.X), Dockeræœ‰ä¸¤å¤„å¯ä»¥é…ç½®å‚æ•°: ä¸€ä¸ªæ˜¯<code>docker.service</code>æœåŠ¡é…ç½®æ–‡ä»¶,ä¸€ä¸ªæ˜¯Docker daemoné…ç½®æ–‡ä»¶daemon.jsonã€‚</p><ol><li><p><code>docker.service</code></p><p>å¯¹äºCentOSç³»ç»Ÿï¼Œ<code>docker.service</code>é»˜è®¤ä½äº<code>/usr/lib/systemd/system/docker.service</code>ï¼›å¯¹äºUbuntuç³»ç»Ÿï¼Œ<code>docker.service</code>é»˜è®¤ä½äº<code>/lib/systemd/system/docker.service</code></p></li><li><p><code>daemon.json</code></p><p>daemon.jsoné»˜è®¤ä½äº<code>/etc/docker/daemon.json</code>ï¼Œå¦‚æœæ²¡æœ‰å¯æ‰‹åŠ¨åˆ›å»ºï¼ŒåŸºäºsystemdç®¡ç†çš„ç³»ç»Ÿéƒ½æ˜¯ç›¸åŒçš„è·¯å¾„ã€‚é€šè¿‡ä¿®æ”¹<code>daemon.json</code>æ¥æ”¹è¿‡Dockeré…ç½®ï¼Œä¹Ÿæ˜¯Dockerå®˜æ–¹æ¨èçš„æ–¹æ³•ã€‚</p></li></ol><blockquote><p>ä»¥ä¸‹è¯´æ˜å‡åŸºäºsystemd,å¹¶é€šè¿‡<code>/etc/docker/daemon.json</code>æ¥ä¿®æ”¹é…ç½®ã€‚</p></blockquote><h2 id="è°ƒä¼˜ä¸é…ç½®"><a href="#è°ƒä¼˜ä¸é…ç½®" class="headerlink" title="è°ƒä¼˜ä¸é…ç½®"></a>è°ƒä¼˜ä¸é…ç½®</h2><h3 id="é…ç½®é•œåƒä¸‹è½½å’Œä¸Šä¼ å¹¶å‘æ•°"><a href="#é…ç½®é•œåƒä¸‹è½½å’Œä¸Šä¼ å¹¶å‘æ•°" class="headerlink" title="é…ç½®é•œåƒä¸‹è½½å’Œä¸Šä¼ å¹¶å‘æ•°"></a>é…ç½®é•œåƒä¸‹è½½å’Œä¸Šä¼ å¹¶å‘æ•°</h3><p>ä»Docker1.12å¼€å§‹ï¼Œæ”¯æŒè‡ªå®šä¹‰ä¸‹è½½å’Œä¸Šä¼ é•œåƒçš„å¹¶å‘æ•°ï¼Œé»˜è®¤å€¼ä¸Šä¼ ä¸º3ä¸ªå¹¶å‘ï¼Œä¸‹è½½ä¸º5ä¸ªå¹¶å‘ã€‚é€šè¿‡æ·»åŠ â€max-concurrent-downloadsâ€å’Œâ€max-concurrent-uploadsâ€å‚æ•°å¯¹å…¶ä¿®æ”¹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"max-concurrent-downloads"</span>: 3,</span><br><span class="line"><span class="string">"max-concurrent-uploads"</span>: 5</span><br></pre></td></tr></table></figure><h3 id="é…ç½®é•œåƒåŠ é€Ÿåœ°å€"><a href="#é…ç½®é•œåƒåŠ é€Ÿåœ°å€" class="headerlink" title="é…ç½®é•œåƒåŠ é€Ÿåœ°å€"></a>é…ç½®é•œåƒåŠ é€Ÿåœ°å€</h3><p>Rancherä»v1.6.15å¼€å§‹åˆ°v2.x.x,Rancherç³»ç»Ÿç›¸å…³çš„æ‰€æœ‰é•œåƒ(åŒ…æ‹¬1.6.xä¸Šçš„K8Sé•œåƒ)éƒ½æ‰˜ç®¡åœ¨Dockerhubä»“åº“ã€‚DockerhubèŠ‚ç‚¹åœ¨å›½å¤–ï¼Œå›½å†…ç›´æ¥æ‹‰å–é•œåƒä¼šæœ‰äº›ç¼“æ…¢ã€‚ä¸ºäº†åŠ é€Ÿé•œåƒçš„ä¸‹è½½ï¼Œå¯ä»¥ç»™Dockeré…ç½®å›½å†…çš„é•œåƒåœ°å€ã€‚</p><p>ç¼–è¾‘<code>/etc/docker/daemon.json</code>åŠ å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"registry-mirrors"</span>: [<span class="string">"https://7bezldxe.mirror.aliyuncs.com/"</span>,<span class="string">"https://IP:PORT/"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥è®¾ç½®å¤šä¸ª<code>registry-mirrors</code>åœ°å€ï¼Œä»¥æ•°ç»„å½¢å¼ä¹¦å†™ï¼Œåœ°å€éœ€è¦æ·»åŠ åè®®å¤´(httpsæˆ–è€…http)ã€‚</p></blockquote><h3 id="é…ç½®insecure-registriesç§æœ‰ä»“åº“"><a href="#é…ç½®insecure-registriesç§æœ‰ä»“åº“" class="headerlink" title="é…ç½®insecure-registriesç§æœ‰ä»“åº“"></a>é…ç½®<code>insecure-registries</code>ç§æœ‰ä»“åº“</h3><p>Dockeré»˜è®¤åªä¿¡ä»»TLSåŠ å¯†çš„ä»“åº“åœ°å€(https)ï¼Œæ‰€æœ‰éhttpsä»“åº“é»˜è®¤æ— æ³•ç™»é™†ä¹Ÿæ— æ³•æ‹‰å–é•œåƒã€‚<code>insecure-registries</code>å­—é¢æ„æ€ä¸ºä¸å®‰å…¨çš„ä»“åº“ï¼Œé€šè¿‡æ·»åŠ è¿™ä¸ªå‚æ•°å¯¹éhttpsä»“åº“è¿›è¡Œæˆä¿¡ã€‚å¯ä»¥è®¾ç½®å¤šä¸ª<code>insecure-registries</code>åœ°å€ï¼Œä»¥æ•°ç»„å½¢å¼ä¹¦å†™ï¼Œåœ°å€ä¸èƒ½æ·»åŠ åè®®å¤´(http)ã€‚</p><p>ç¼–è¾‘<code>/etc/docker/daemon.json</code>åŠ å…¥ä»¥ä¸‹å†…å®¹:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"insecure-registries"</span>: [<span class="string">"192.168.1.100"</span>,<span class="string">"IP:PORT"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®Dockerå­˜å‚¨é©±åŠ¨"><a href="#é…ç½®Dockerå­˜å‚¨é©±åŠ¨" class="headerlink" title="é…ç½®Dockerå­˜å‚¨é©±åŠ¨"></a>é…ç½®Dockerå­˜å‚¨é©±åŠ¨</h3><p>OverlayFSæ˜¯ä¸€ä¸ªæ–°ä¸€ä»£çš„è”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œç±»ä¼¼äºAUFSï¼Œä½†é€Ÿåº¦æ›´å¿«ï¼Œå®ç°æ›´ç®€å•ã€‚Dockerä¸ºOverlayFSæä¾›äº†ä¸¤ä¸ªå­˜å‚¨é©±åŠ¨ç¨‹åº:æ—§ç‰ˆçš„<code>overlay</code>ï¼Œæ–°ç‰ˆçš„<code>overlay2</code>(æ›´ç¨³å®š)ã€‚</p><p>å…ˆå†³æ¡ä»¶:</p><ul><li><code>overlay2</code>: Linuxå†…æ ¸ç‰ˆæœ¬4.0æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œæˆ–ä½¿ç”¨å†…æ ¸ç‰ˆæœ¬3.10.0-514+çš„RHELæˆ–CentOSã€‚</li><li><code>overlay</code>: ä¸»æœºLinuxå†…æ ¸ç‰ˆæœ¬3.18+</li><li>æ”¯æŒçš„ç£ç›˜æ–‡ä»¶ç³»ç»Ÿ<ul><li>ext4(ä»…é™RHEL 7.1)</li><li>xfs(RHEL7.2åŠæ›´é«˜ç‰ˆæœ¬)ï¼Œéœ€è¦å¯ç”¨d_type=trueã€‚ &gt;å…·ä½“è¯¦æƒ…å‚è€ƒ <a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/" target="_blank" rel="noopener">Docker Use the OverlayFS storage driver</a></li></ul></li></ul><p>ç¼–è¾‘<code>/etc/docker/daemon.json</code>åŠ å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"storage-driver"</span>: <span class="string">"overlay2"</span>,</span><br><span class="line"><span class="attr">"storage-opts"</span>: [<span class="string">"overlay2.override_kernel_check=true"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ—¥å¿—é©±åŠ¨"><a href="#é…ç½®æ—¥å¿—é©±åŠ¨" class="headerlink" title="é…ç½®æ—¥å¿—é©±åŠ¨"></a>é…ç½®æ—¥å¿—é©±åŠ¨</h3><p>å®¹å™¨åœ¨è¿è¡Œæ—¶ä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—æ–‡ä»¶ï¼Œå¾ˆå®¹æ˜“å æ»¡ç£ç›˜ç©ºé—´ã€‚é€šè¿‡é…ç½®æ—¥å¿—é©±åŠ¨æ¥é™åˆ¶æ–‡ä»¶å¤§å°ä¸æ–‡ä»¶çš„æ•°é‡ã€‚ &gt;é™åˆ¶å•ä¸ªæ—¥å¿—æ–‡ä»¶ä¸º<code>100M</code>,æœ€å¤šäº§ç”Ÿ<code>3</code>ä¸ªæ—¥å¿—æ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"log-driver"</span>: <span class="string">"json-file"</span>,</span><br><span class="line"><span class="attr">"log-opts"</span>: &#123;</span><br><span class="line">    <span class="attr">"max-size"</span>: <span class="string">"100m"</span>,</span><br><span class="line">    <span class="attr">"max-file"</span>: <span class="string">"3"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="Ubuntu-Debianç³»ç»Ÿ-ï¼Œdocker-infoæç¤ºWARNING-No-swap-limit-support"><a href="#Ubuntu-Debianç³»ç»Ÿ-ï¼Œdocker-infoæç¤ºWARNING-No-swap-limit-support" class="headerlink" title="Ubuntu\Debianç³»ç»Ÿ ï¼Œdocker infoæç¤ºWARNING: No swap limit support"></a>Ubuntu\Debianç³»ç»Ÿ ï¼Œdocker infoæç¤ºWARNING: No swap limit support</h3><p>Ubuntu\Debianç³»ç»Ÿä¸‹ï¼Œé»˜è®¤cgroupsæœªå¼€å¯swap accountåŠŸèƒ½ï¼Œè¿™æ ·ä¼šå¯¼è‡´è®¾ç½®å®¹å™¨å†…å­˜æˆ–è€…swapèµ„æºé™åˆ¶ä¸ç”Ÿæ•ˆã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è§£å†³:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i <span class="string">'s/GRUB_CMDLINE_LINUX="/GRUB_CMDLINE_LINUX="cgroup_enable=memory swapaccount=1  /g'</span>  /etc/default/grub</span><br><span class="line">sudo update-grub</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong>é€šè¿‡ä»¥ä¸Šå‘½ä»¤å¯è‡ªåŠ¨é…ç½®å‚æ•°ï¼Œå¦‚æœ<code>/etc/default/grub</code>éé»˜è®¤é…ç½®ï¼Œéœ€æ ¹æ®å®é™…å‚æ•°åšè°ƒæ•´ã€‚<strong>æç¤º</strong>ä»¥ä¸Šé…ç½®å®Œæˆåï¼Œå»ºè®®é‡å¯ä¸€æ¬¡ä¸»æœºã€‚</p></blockquote><h2 id="è°ƒä¼˜é…ç½®æ€»ç»“"><a href="#è°ƒä¼˜é…ç½®æ€»ç»“" class="headerlink" title="è°ƒä¼˜é…ç½®æ€»ç»“"></a>è°ƒä¼˜é…ç½®æ€»ç»“</h2><p>1ã€Dockeré•œåƒä¸‹è½½æœ€å¤§å¹¶å‘æ•°</p><p>é€šè¿‡é…ç½®é•œåƒä¸Šä¼ \ä¸‹è½½å¹¶å‘æ•°<code>max-concurrent-downloads,max-concurrent-uploads</code>,ç¼©çŸ­é•œåƒä¸Šä¼ \ä¸‹è½½çš„æ—¶é—´ã€‚</p><p>2ã€é…ç½®é•œåƒåŠ é€Ÿåœ°å€</p><p>é€šè¿‡é…ç½®é•œåƒåŠ é€Ÿåœ°å€<code>registry-mirrors</code>,å¯ä»¥å¾ˆå¤§ç¨‹åº¦æé«˜é•œåƒä¸‹è½½é€Ÿåº¦ã€‚</p><p>3ã€é…ç½®Dockerå­˜å‚¨é©±åŠ¨</p><p>OverlayFSæ˜¯ä¸€ä¸ªæ–°ä¸€ä»£çš„è”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œç±»ä¼¼äºAUFSï¼Œä½†é€Ÿåº¦æ›´å¿«ï¼Œå®ç°æ›´ç®€å•ã€‚Dockerä¸ºOverlayFSæä¾›äº†ä¸¤ä¸ªå­˜å‚¨é©±åŠ¨ç¨‹åº:æ—§ç‰ˆçš„overlayï¼Œæ–°ç‰ˆçš„<a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/" target="_blank" rel="noopener">overlay2</a>(æ›´ç¨³å®š)ã€‚</p><p>4ã€é…ç½®æ—¥å¿—æ–‡ä»¶å¤§å°</p><p>å®¹å™¨ä¸­ä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—æ–‡ä»¶ï¼Œå¾ˆå®¹å™¨å æ»¡ç£ç›˜ç©ºé—´ã€‚é€šè¿‡è®¾ç½®æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶æ—¥å¿—æ–‡ä»¶å¯¹ç£ç›˜çš„å ç”¨é‡ã€‚ä¾‹å¦‚ï¼š</p><p><img src="/2019/01/18/è®°å½•docker-å®‰è£…ä¸è°ƒä¼˜/1.png" alt="image-20180910172158993"></p><p>5ã€å¼€å¯<code>WARNING: No swap limit supportï¼ŒWARNING: No memory limit support</code>æ”¯æŒ</p><p>å¯¹äºUbuntu\Debianç³»ç»Ÿï¼Œæ‰§è¡Œ<code>docker info</code>å‘½ä»¤æ—¶èƒ½çœ‹åˆ°è­¦å‘Š<code>WARNING: No swap limit supportæˆ–è€…WARNING: No memory limit support</code>ã€‚å› ä¸ºUbuntu\Debianç³»ç»Ÿé»˜è®¤å…³é—­äº†<code>swap accountæˆ–è€…</code>åŠŸèƒ½ï¼Œè¿™æ ·ä¼šå¯¼è‡´è®¾ç½®å®¹å™¨å†…å­˜æˆ–è€…swapèµ„æºé™åˆ¶ä¸ç”Ÿæ•ˆï¼Œ<a href="https://www.cnrancher.com/docs/rancher/v2.x/cn/installation/basic-environment-configuration/#3-ubuntu%E7%B3%BB%E7%BB%9F-docker-info%E6%8F%90%E7%A4%BAwarning-no-swap-limit-support" target="_blank" rel="noopener">è§£å†³æ–¹æ³•</a>ã€‚</p><h3 id="æœ€ç»ˆå‘½ä»¤"><a href="#æœ€ç»ˆå‘½ä»¤" class="headerlink" title="æœ€ç»ˆå‘½ä»¤"></a>æœ€ç»ˆå‘½ä»¤</h3><p>è¾“å…¥å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">touch /etc/docker/daemon.json</span><br><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"log-driver"</span>: <span class="string">"json-file"</span>,</span><br><span class="line">    <span class="string">"log-opts"</span>: &#123;</span><br><span class="line">    <span class="string">"max-size"</span>: <span class="string">"100m"</span>,</span><br><span class="line">    <span class="string">"max-file"</span>: <span class="string">"3"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"max-concurrent-downloads"</span>: 10,</span><br><span class="line">    <span class="string">"max-concurrent-uploads"</span>: 10,</span><br><span class="line">    <span class="string">"registry-mirrors"</span>: [<span class="string">"https://7bezldxe.mirror.aliyuncs.com"</span>],</span><br><span class="line">    <span class="string">"storage-driver"</span>: <span class="string">"overlay2"</span>,</span><br><span class="line">    <span class="string">"storage-opts"</span>: [</span><br><span class="line">    <span class="string">"overlay2.override_kernel_check=true"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart docker</span><br></pre></td></tr></table></figure><h1 id="å®Œ"><a href="#å®Œ" class="headerlink" title="å®Œ"></a>å®Œ</h1><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="http://www.docker.org.cn/" target="_blank" rel="noopener">http://www.docker.org.cn/</a></p><p><a href="https://www.cnrancher.com/docs/rancher/v2.x/cn/overview/quick-start-guide/" target="_blank" rel="noopener">https://www.cnrancher.com/docs/rancher/v2.x/cn/overview/quick-start-guide/</a></p><h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><p>å…¨ç‰‡ç»“æŸï¼Œè§‰å¾—æˆ‘å†™çš„ä¸é”™ï¼Ÿæƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿèµ¶å¿«æ‰“å¼€æˆ‘çš„ğŸ‘‰ä¸ªäºº<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">åšå®¢</a> ğŸ‘ˆå§ï¼</p><p>è°¢è°¢ä½ é‚£ä¹ˆå¯çˆ±ï¼Œè¿˜ä¸€ç›´å…³æ³¨ç€æˆ‘~â¤ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;k8sæ˜¯å®¹å™¨ç¼–æ’ç³»ç»Ÿï¼Œéœ€è¦dockerçš„æ”¯æŒï¼Œä»Šå¤©åˆ†äº«ä¸€æ³¢dockerçš„å®‰è£…ä¸è°ƒä¼˜è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸äº†è§£dockerçš„ç«¥é‹å¯ä»¥å‚è€ƒ&lt;a href=&quot;https://www.cnblogs.com/SzeCheng/p/6822905.html&quot; target=&quot;_bl
      
    
    </summary>
    
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://tengshe789.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="k8s" scheme="https://tengshe789.github.io/tags/k8s/"/>
    
      <category term="è½¯ä»¶æ•™å­¦" scheme="https://tengshe789.github.io/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>è®°å½•ä¸€æ¬¡Ubuntuçš„è¿æ¥</title>
    <link href="https://tengshe789.github.io/2019/01/18/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1Ubuntu%E7%9A%84%E8%BF%9E%E6%8E%A5/"/>
    <id>https://tengshe789.github.io/2019/01/18/è®°å½•ä¸€æ¬¡Ubuntuçš„è¿æ¥/</id>
    <published>2019-01-18T01:29:46.000Z</published>
    <updated>2019-11-20T13:39:41.566Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å…¬å¸çš„spring cloud äº‘å¹³å°å³å°†æ„é€ å®Œæˆï¼Œè½¬è€Œè¦è¿›å…¥éƒ¨ç½²ä¸å»ºè®¾å¹³å°çš„è¿‡ç¨‹ã€‚æ•…å‡†å¤‡ç ”ç©¶ä¸€ä¸‹kubernetesï¼Œå¯æ˜¯æœ€è¿‘æ‰‹å¤´ç‰¹åˆ«ç´§ï¼Œæˆ‘éƒ¨é—¨åˆæ²¡æœ‰ç‹¬ç«‹çš„äº‘æœåŠ¡å™¨ï¼Œè€Œä¸”ç½‘é€Ÿå¾ˆæ…¢æ²¡æ³•ä¸‹è½½centosé•œåƒï¼Œæ•…å‡†å¤‡å®‰è£…è™šæ‹Ÿæœºï¼Œä½¿ç”¨æˆ‘ä»æœªç”¨è¿‡çš„Ubuntuæ¥è§£å†³é—®é¢˜ã€‚è¿™å°±æœ‰äº†è¿™æ¬¡æ–‡ç« çš„ä¸»é¢˜ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢<a href="https://blog.tengshe789.tech/ï¼ˆğŸ˜˜" target="_blank" rel="noopener">https://blog.tengshe789.tech/ï¼ˆğŸ˜˜</a></p><h3 id="Ubuntuå¼€æœºç¬¬ä¸€æ¬¡è®¾ç½®"><a href="#Ubuntuå¼€æœºç¬¬ä¸€æ¬¡è®¾ç½®" class="headerlink" title="Ubuntuå¼€æœºç¬¬ä¸€æ¬¡è®¾ç½®"></a>Ubuntuå¼€æœºç¬¬ä¸€æ¬¡è®¾ç½®</h3><p>æˆ‘æ˜¯ç”¨çš„æ˜¯Ubuntu desktop x64ç‰ˆï¼Œä¸æ˜¯æœåŠ¡å™¨ç‰ˆï¼Œå¸¦æœ‰å›¾å½¢åŒ–ç•Œé¢ã€‚è£…ç³»ç»Ÿï¼Œå¼€æœºï¼Œç‚¹å‡»å·¦ä¸Šè§’è®¾ç½®,ä½¿ç”¨<code>crtl+f</code>å¿«æ·é”®ç»„åˆï¼Œåˆ†åˆ«æœç´¢<code>lock</code>,<code>power save</code>,å°†é”å±å’Œçœç”µå…¨éƒ¨å…³é—­ã€‚ç»“æŸã€‚</p><h3 id="SSHè¿æ¥"><a href="#SSHè¿æ¥" class="headerlink" title="SSHè¿æ¥"></a>SSHè¿æ¥</h3><p>é»˜è®¤Ubuntuæ˜¯ä¸èƒ½ä½¿ç”¨sshè¿æ¥çš„ï¼Œéœ€è¦åœ¨ç³»ç»Ÿå†…å®‰è£…å’Œé…ç½®sshã€‚</p><h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><p>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥<code>sudo apt-get update</code>æ¥æ›´æ–°æºåˆ—è¡¨ã€‚</p><p>æˆåŠŸåï¼Œè¾“å…¥<code>sudo apt-get install openssh-server</code>æ ¹æ®æç¤ºæ¥å®‰è£…sshæœåŠ¡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè¾“å…¥<code>sudo apt install net-tools</code>æ ¹æ®æç¤ºæ¥å®‰è£…ç½‘ç»œå·¥å…·ã€‚</p><p>æœ€åï¼Œè¾“å…¥<code>sudo apt-get install vim-gtk</code>æ¥å®‰è£…vimå·¥å…·ï¼ˆvimå¤§æ³•å¥½ï¼ï¼‰</p><p>ç»“æŸã€‚</p><h4 id="è®¾ç½®ssh"><a href="#è®¾ç½®ssh" class="headerlink" title="è®¾ç½®ssh"></a>è®¾ç½®ssh</h4><h5 id="æŸ¥çœ‹sshæœåŠ¡æ˜¯å¦å¯åŠ¨"><a href="#æŸ¥çœ‹sshæœåŠ¡æ˜¯å¦å¯åŠ¨" class="headerlink" title="æŸ¥çœ‹sshæœåŠ¡æ˜¯å¦å¯åŠ¨"></a>æŸ¥çœ‹sshæœåŠ¡æ˜¯å¦å¯åŠ¨</h5><p>è¾“å…¥<code>sudo ps -e |grep ssh</code>ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="/2019/01/18/è®°å½•ä¸€æ¬¡Ubuntuçš„è¿æ¥/1.jpg" alt="æŸ¥çœ‹sshæœåŠ¡æ˜¯å¦å¯åŠ¨"></p><p>å¦‚æœæœ‰sshdè¿›ç¨‹ï¼Œåˆ™è¯´æ˜sshæœåŠ¡å·²ç»å¯åŠ¨ï¼Œå¦‚æœæ²¡æœ‰å¯åŠ¨ï¼Œè¾“å…¥<code>sudo service ssh start</code>ï¼ŒsshæœåŠ¡å°±ä¼šå¯åŠ¨ã€‚</p><h5 id="ä½¿ç”¨geditä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä½¿ç”¨geditä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨geditä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä½¿ç”¨geditä¿®æ”¹é…ç½®æ–‡ä»¶</h5><p>è¾“å…¥<code>sudo gedit /etc/ssh/sshd_config</code>ï¼ŒæŠŠé…ç½®æ–‡ä»¶ä¸­çš„â€PermitRootLogin without-passwordâ€åŠ ä¸€ä¸ªâ€#â€å·,æŠŠå®ƒæ³¨é‡Šæ‰ï¼Œå†å¢åŠ ä¸€å¥â€PermitRootLogin yesâ€ï¼Œä¿®æ”¹æˆåŠŸã€‚</p><p><img src="/2019/01/18/è®°å½•ä¸€æ¬¡Ubuntuçš„è¿æ¥/2.jpg" alt="æŸ¥çœ‹sshæœåŠ¡æ˜¯å¦å¯åŠ¨"></p><h5 id="æŸ¥æ‰¾IPåœ°å€"><a href="#æŸ¥æ‰¾IPåœ°å€" class="headerlink" title="æŸ¥æ‰¾IPåœ°å€"></a>æŸ¥æ‰¾IPåœ°å€</h5><p>è¾“å…¥<code>ifconfig</code>ï¼Œæ ¹æ®ipé…ç½®åˆ°sshè¿æ¥å·¥å…·å°±å¥½ã€‚</p><h3 id="å®Œæˆï¼"><a href="#å®Œæˆï¼" class="headerlink" title="å®Œæˆï¼"></a>å®Œæˆï¼</h3><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘å…¬å¸çš„spring cloud äº‘å¹³å°å³å°†æ„é€ å®Œæˆï¼Œè½¬è€Œè¦è¿›å…¥éƒ¨ç½²ä¸å»ºè®¾å¹³å°çš„è¿‡ç¨‹ã€‚æ•…å‡†å¤‡ç ”ç©¶ä¸€ä¸‹kubernetesï¼Œå¯æ˜¯æœ€è¿‘æ‰‹å¤´ç‰¹åˆ«ç´§ï¼Œæˆ‘éƒ¨é—¨åˆæ²¡æœ‰ç‹¬ç«‹çš„äº‘æœåŠ¡å™¨ï¼Œè€Œä¸”ç½‘é€Ÿå¾ˆæ…¢æ²¡æ³•ä¸‹è½½centosé•œåƒï¼Œæ•…å‡†å¤‡å®‰è£…è™šæ‹Ÿæœºï¼Œä½¿ç”¨æˆ‘ä»æœªç”¨è¿‡çš„Ubuntuæ¥è§£å†³é—®é¢˜ã€‚è¿™å°±æœ‰
      
    
    </summary>
    
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://tengshe789.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="è½¯ä»¶æ•™å­¦" scheme="https://tengshe789.github.io/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>å°†æˆ‘çš„javaç¨‹åºç»„ä»¶éƒ¨ç½²åˆ°mavenä¸­å¤®ä»“åº“</title>
    <link href="https://tengshe789.github.io/2019/01/17/%E5%B0%86%E6%88%91%E7%9A%84%E7%A8%8B%E5%BA%8F%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%86%8C%E5%88%B0maven/"/>
    <id>https://tengshe789.github.io/2019/01/17/å°†æˆ‘çš„ç¨‹åºç»„ä»¶æ³¨å†Œåˆ°maven/</id>
    <published>2019-01-17T01:09:45.000Z</published>
    <updated>2019-11-20T13:39:41.264Z</updated>
    
    <content type="html"><![CDATA[<p>å‰ä¸€é˜µå­å·¥ä½œæœ‰ç‚¹å¿™ï¼Œä¹Ÿæ¯”è¾ƒç„¦è™‘ã€‚æ²¡æœ‰æ—¶é—´å†™ä¸€äº›åšå®¢æ–‡ç« ï¼Œä»Šå¤©æ¥è¡¥å……ä¸€ä¸‹ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a>ã€‚ğŸ˜</p><h2 id="åšç‚¹ä»€ä¹ˆï¼Ÿ"><a href="#åšç‚¹ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åšç‚¹ä»€ä¹ˆï¼Ÿ"></a>åšç‚¹ä»€ä¹ˆï¼Ÿ</h2><p>é¢ä¸´æ¯•ä¸šï¼Œä¸æƒ³ä¸€ç›´å’¸é±¼ï¼Œå¯æ˜¯åˆä»€ä¹ˆéƒ½ä¸ä¼šï¼Œåšç‚¹ä»€ä¹ˆçš„ï¼Ÿæ€æ¥æƒ³å»ï¼Œä¹Ÿæ˜¯ä¸ºäº†ç»™è‡ªå·±å°‘ä¸€ç‚¹éº»çƒ¦ï¼Œå°±å†³å®šæŠŠè‡ªå·±åŠå¹´å‰é‚£ä¸ª<a href="https://github.com/tengshe789/-miaosha" target="_blank" rel="noopener">ç§’æ€å•†åŸé¡¹ç›®</a>é‡æ„ä¸€ä¸‹ï¼Œæ”¾åˆ°äº‘å¹³å°ä¸Šã€‚ä¸è¿‡æ—¢ç„¶éƒ½æ˜¯äº‘å¹³å°äº†ï¼Œè‚¯å®šä¼šæœ‰å„ç§æ”¯æ’‘æœåŠ¡ï¼Œå°±è­¬å¦‚è¯´ç¼“å­˜ä¸­å¿ƒï¼Œæ—¥å¿—ä¸­å¿ƒï¼Œç›‘æ§ä¸­å¿ƒï¼Œæƒé™ç®¡ç†ä¸­å¿ƒç­‰ç­‰ï¼Œä½†æ˜¯è¿™äº›åŠŸèƒ½ï¼Œåœ¨åˆ«çš„é¡¹ç›®ä¸­ä¹Ÿå¯ä»¥ç”¨åˆ°ï¼Œè¿™å°±å¸¦æ¥ä¸€äº›ä¸å¿…è¦çš„éº»çƒ¦ã€‚</p><p>è¿™æ—¶å€™ï¼Œå°±æ¨èä½¿ç”¨mavenæ¥ç»Ÿä¸€ç®¡ç†äº†ã€‚</p><p>å‰äº›æ—¥å­ï¼Œè¶ç€æ¯•ä¸šç”Ÿåˆ›ä¸šæŒ‡å¯¼å¼€è¯¾çš„æ—¶å€™ï¼Œæˆ‘æŠŠç¼“å­˜ä¸­å¿ƒæ•²å®Œäº†ã€‚ç„¶åå°†ä»–éƒ¨ç½²åˆ°mavenä¸­å¤®ä»“åº“ã€‚ä¸‹é¢æˆ‘å°±æ¥åˆ†äº«ä¸€ä¸‹éƒ¨ç½²åˆ°ä¸­å¤®ä»“åº“çš„é‚£äº›å‘ğŸ•³ã€‚</p><h2 id="éƒ¨ç½²åˆ°ä¸­å¤®ä»“åº“"><a href="#éƒ¨ç½²åˆ°ä¸­å¤®ä»“åº“" class="headerlink" title="éƒ¨ç½²åˆ°ä¸­å¤®ä»“åº“"></a>éƒ¨ç½²åˆ°ä¸­å¤®ä»“åº“</h2><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><ul><li><p>æ‰“å¼€æµè§ˆå™¨ï¼Œ<a href="https://issues.sonatype.org/" target="_blank" rel="noopener"> sonatype å®˜ç½‘</a>ï¼Œè¿™ä¸ªåœ°å€ï¼Œæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œå¹¶ä¸”è®°ä½ç”¨æˆ·åå¯†ç </p></li><li><p>ä¸‹è½½å¥½<code>git</code>å®¢æˆ·ç«¯</p></li></ul><h3 id="æäº¤issue"><a href="#æäº¤issue" class="headerlink" title="æäº¤issue"></a>æäº¤issue</h3><p>åœ¨ <a href="https://issues.sonatype.org/secure/CreateIssue.jspa?issuetype=21&amp;pid=10134" target="_blank" rel="noopener">https://issues.sonatype.org/secure/CreateIssue.jspa?issuetype=21&amp;pid=10134</a> ä¸­æ–°å»ºä¸€ä¸ªâ€œProject ticketâ€ã€‚</p><p>ä¸‹é¢å¼•ä»¥ä¸‹<a href="https://home.cnblogs.com/u/aimqqroad-13/" target="_blank" rel="noopener">Spiderman.L</a>å¤§ä½¬åšå®¢ä¸Šçš„å›¾ç‰‡ï¼ˆå¤ªæ‡’äº†ä¸æƒ³é‡æ–°å¡«ä¸€éï¼‰ï¼Œç…§ç€è¿™ä¸ªæ­¥éª¤æ¥ã€‚</p><p><img src="/2019/01/17/å°†æˆ‘çš„ç¨‹åºç»„ä»¶æ³¨å†Œåˆ°maven/3.png" alt="æ€ä¹ˆå¡«"></p><p>ã€€ã€€ç‚¹å‡»<code>Create</code>ä¹‹åï¼Œä½ å°±ä¼šè¿›å…¥ä¸€ä¸ª <code>jira</code> é¡µé¢(sonatype ä½¿ç”¨jira æ¥è¿½è¸ªæ¯ä¸€ä¸ªé¡¹ç›®è¿›åº¦)ï¼Œä¸æ­¤åŒæ—¶ä½ æ³¨å†Œæ—¶ä½¿ç”¨çš„é‚®ç®±ä¸­ä¹Ÿä¼šæ”¶åˆ°ä¸€å°é‚®ä»¶æç¤ºä½ ï¼Œä»»åŠ¡åˆ›å»ºæˆåŠŸ,æ­£åœ¨ç­‰å¾…å¤„ç†ã€‚</p><h3 id="ç­‰å¾…æ—¶é—´"><a href="#ç­‰å¾…æ—¶é—´" class="headerlink" title="ç­‰å¾…æ—¶é—´"></a>ç­‰å¾…æ—¶é—´</h3><p>åˆ›å»ºå®Œæ¯•åå°±ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œåˆ·æ–°é¡µé¢ã€‚å½“çŠ¶æ€å˜ä¸º<code>â€œresolvedâ€</code>ï¼Œç„¶åä½ å°±å¯ä»¥ä½¿ç”¨<code>maven</code>ä¸Šä¼ é¡¹ç›®äº†ã€‚æˆ–è€…å°±ç­‰ç€æ¥æ”¶ <code>sonatype</code>çš„åé¦ˆé‚®ä»¶ï¼Œç¡®è®¤å·²ç»ä¸ºä½ åˆ›å»ºå¥½äº†æ–°é¡¹ç›®</p><p><img src="/2019/01/17/å°†æˆ‘çš„ç¨‹åºç»„ä»¶æ³¨å†Œåˆ°maven/4.png" alt="ç­‰å¾…æ—¶é—´"></p><h3 id="å›å¤commit"><a href="#å›å¤commit" class="headerlink" title="å›å¤commit"></a>å›å¤commit</h3><p>å‘å¸ƒå®Œåï¼Œå¯èƒ½å‡ åˆ†é’Ÿï¼Œä¹Ÿå¯èƒ½å‡ å°æ—¶ï¼Œä¼šæœ‰å·¥ä½œäººå‘˜é—®ä½ æ˜¯å¦æœ‰Group Idå¯¹åº”çš„é‚£ä¸ªåŸŸåçš„æ‰€æœ‰æƒï¼Œå¦‚æœæœ‰çš„è¯å°±å›å¤æœ‰ï¼Œå¹¶ä¸”æŒ‰ç…§ä»–è¯´çš„ä¸‰ä¸ªæ–¹æ³•æ¥ï¼ˆä¸‹å›¾ä¸ºå‚è€ƒè¯­å¥ï¼‰ï¼Œç„¶åå°±ä¼šå¾—åˆ°Configuration has been preparedçš„å›å¤ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å‡†å¤‡å‘å¸ƒäº†ã€‚</p><p><img src="/2019/01/17/å°†æˆ‘çš„ç¨‹åºç»„ä»¶æ³¨å†Œåˆ°maven/1.png" alt="1"></p><p>æˆ‘ç”¨çš„æ˜¯ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œå› ä¸ºæˆ‘çš„åŸŸåæ˜¯ä»é˜¿é‡Œäº‘ä¸Šä¹°çš„ï¼Œæˆ‘åœ¨é˜¿é‡Œäº‘å¹³å°çš„åŸŸåç®¡ç†ä¸­å¿ƒå¤„ï¼Œæ·»åŠ äº†ä¸€ä¸ªTXTè®°å½•åˆ°è¿™ä¸ª<code>ticket</code>ä¸Šï¼Œè¿™æ ·ä»–ä¼šè‡ªå·±æ£€æµ‹ã€‚</p><p>å½“ç„¶äº†ï¼Œå¦‚æœè‡ªå·±æ²¡æœ‰åŸŸåçš„è¯å¯ä»¥æŒ‚åœ¨å¼€æºçš„åŸŸåä¸‹é¢ï¼Œä¾‹å¦‚com.github.tengshe789ï¼Œè¿™æ ·ä¸€æ ·å¯ä»¥å‘å¸ƒã€‚</p><p>æœ€å·®çš„æ–¹æ³•ï¼Œå°±æ˜¯ç”¨ä¸ªäººåŸŸåé‚®ç®±å‘é€ç»™ä»–é‚®ä»¶ã€‚</p><h3 id="è·å¾—éƒ¨ç½²æƒé™"><a href="#è·å¾—éƒ¨ç½²æƒé™" class="headerlink" title="è·å¾—éƒ¨ç½²æƒé™"></a>è·å¾—éƒ¨ç½²æƒé™</h3><p>åšå®Œä¸Šä¸€æ­¥ï¼Œä»–ä¼šåœ¨ç¾å›½å·¥ä½œæ—¥æ—¶é—´é‡Œå›å¤éƒ¨ç½²çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚å›¾ï¼š</p><p><img src="/2019/01/17/å°†æˆ‘çš„ç¨‹åºç»„ä»¶æ³¨å†Œåˆ°maven/2.png" alt="2"></p><p>å½“æˆ‘ä»¬çš„<code>ticket</code>æœ€ç»ˆçŠ¶æ€å˜ä¸º<code>Resolved</code>çš„æ—¶å€™ï¼Œè¡¨ç¤ºæˆ‘ä»¬æœ‰æƒé™å¯ä»¥ä¸Šä¼ ä¸œè¥¿äº†ã€‚</p><h3 id="mavenæœ¬åœ°è®¾ç½®"><a href="#mavenæœ¬åœ°è®¾ç½®" class="headerlink" title="mavenæœ¬åœ°è®¾ç½®"></a>mavenæœ¬åœ°è®¾ç½®</h3><p>æ‰¾åˆ°ä½ å®‰è£…mavençš„ç›®å½•ä¸‹é¢ï¼Œæ‰“å¼€<code>mavenç›®å½•\conf\settings.xml</code>æ–‡ä»¶ã€‚åœ¨<code>servers</code>æ ‡ç­¾ä¸­å¡«å†™å¦‚ä¸‹ä¿¡æ¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servers</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>sonatype-nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">username</span>&gt;</span>tengshe789ï¼ˆæˆ‘çš„ç”¨æˆ·åï¼‰<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">password</span>&gt;</span>ï¼ˆæˆ‘çš„sonatypeå¯†ç ï¼‰<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>sonatype-nexus-staging<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">username</span>&gt;</span>tengshe789ï¼ˆæˆ‘çš„ç”¨æˆ·åï¼‰<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">password</span>&gt;</span>ï¼ˆæˆ‘çš„sonatypeå¯†ç ï¼‰<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="javaç¨‹åºpom-XMLè®¾ç½®"><a href="#javaç¨‹åºpom-XMLè®¾ç½®" class="headerlink" title="javaç¨‹åºpom.XMLè®¾ç½®"></a>javaç¨‹åºpom.XMLè®¾ç½®</h3><p>æŒ‰ç…§ä¸‹é¢ä»£ç æ·»åŠ ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">connection</span>&gt;</span>scm:git:https://github.com/tengshe789/miaocache.git<span class="tag">&lt;/<span class="name">connection</span>&gt;</span> <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span>scm:git:https://github.com/tengshe789/miaocache.git<span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://github.com/tengshe789/miaocache<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">tag</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™äº›åœ°å€å¡«çš„æ˜¯ä½ githubä¸Šçš„åœ°å€ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿™ä¸ªidä¸æˆ‘ä¸Šä¸€æ­¥åœ¨setting.xmlä¸­è®¾ç½®çš„idä¸€è‡´çš„  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>sonatype-nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>OSS Snapshots Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿™é‡Œçš„urlå°±æ˜¯Issueä¸­å›å¤çš„snapshots çš„repoåœ°å€--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://oss.sonatype.org/content/repositories/snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- è¿™ä¸ªidä¸æˆ‘ä¸Šä¸€æ­¥åœ¨setting.xmlä¸­è®¾ç½®çš„idä¸€è‡´çš„  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>sonatype-nexus-staging<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>OSS Staging Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¿™é‡Œçš„urlå°±æ˜¯Issueä¸­å›å¤çš„staging çš„repoåœ°å€--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://oss.sonatype.org/service/local/staging/deploy/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™äº›åœ°å€ç›´æ¥å¤åˆ¶ä¸Šå°±è¡Œã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.name&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.build.finalName&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>$&#123;maven.compiler.target&#125;<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>$&#123;maven.compiler.source&#125;<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é˜¿é‡Œäº‘ä¸»ä»“åº“ï¼Œä»£ç†äº†maven centralå’Œjcenterä»“åº“--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é˜¿é‡Œäº‘ä»£ç†Spring å®˜æ–¹ä»“åº“--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-milestones<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Milestones<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/spring<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é˜¿é‡Œäº‘ä»£ç†Spring æ’ä»¶ä»“åº“--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-plugin<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>spring-plugin<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/spring-plugin<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- Source --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar-no-fork<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- Javadoc --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>sonatype-nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>OSS Snapshots Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span> <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://oss.sonatype.org/content/repositories/snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>sonatype-nexus-staging<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>OSS Staging Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- è¿™é‡Œçš„urlå°±æ˜¯Issueä¸­å›å¤çš„staging çš„repoåœ°å€--&gt;</span> <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://oss.sonatype.org/service/local/staging/deploy/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢åœ°å€æ˜¯é€šç”¨çš„æ’ä»¶å’Œprofilesé…ç½®ï¼Œä¸èƒ½å°‘ï¼ŒæŒ‰ç…§éœ€æ±‚æ¥è®¾ç½®ã€‚æœ‰èƒ½åŠ›çš„åŒå­¦è‡ªå·±ç ”ç©¶ä¸€ä¸‹ã€‚</p><h3 id="ä½¿ç”¨gpgç”Ÿæˆå¯†é’¥"><a href="#ä½¿ç”¨gpgç”Ÿæˆå¯†é’¥" class="headerlink" title="ä½¿ç”¨gpgç”Ÿæˆå¯†é’¥"></a>ä½¿ç”¨gpgç”Ÿæˆå¯†é’¥</h3><p>æ‰“å¼€gitçª—å£ï¼Œè¾“å…¥<code>gpg --gen-key</code>ã€‚è¿™æ—¶å€™ä¼šå‡ºç°ä¸€å¤§ç‰‡è‹±æ–‡ï¼Œçœ‹ä¸æ‡‚çš„åŒå­¦ä¸è¦ç´§ï¼Œè·Ÿç€æˆ‘åšå°±è¡Œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --list-keys</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤æ˜¯æŸ¥çœ‹è‡ªå·±keyçš„ç¼–å·ã€‚æ‰¾åˆ° pubå¯¹åº”çš„é‚£ä¸ªç¼–å·ï¼Œä¾‹å¦‚<code>pub 2048R/8C473F5C</code><br>ä¸Šä¼ åˆ°keyéªŒè¯åº“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --keyserver hkp://keyserver.ubuntu.com:11371 --send-keys 8C473F5C</span><br></pre></td></tr></table></figure><h3 id="mavenå‘½ä»¤"><a href="#mavenå‘½ä»¤" class="headerlink" title="mavenå‘½ä»¤"></a>mavenå‘½ä»¤</h3><p>æ‰“å¼€ideaï¼Œæ‰¾åˆ°ä¸‹é¢çš„ç»ˆç«¯ï¼Œè¾“å…¥mavenå‘½ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean deploy -P sonatype-oss-release -Darguments="gpg.passphrase=è®¾ç½®gpgè®¾ç½®å¯†é’¥æ—¶å€™è¾“å…¥çš„Passphrase"</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.cnblogs.com/aimqqroad-13/p/9645776.html" target="_blank" rel="noopener">https://www.cnblogs.com/aimqqroad-13/p/9645776.html</a></p><p><a href="https://blog.csdn.net/sun5769675/article/details/78519948" target="_blank" rel="noopener">https://blog.csdn.net/sun5769675/article/details/78519948</a></p><p><a href="https://www.jianshu.com/p/bb930e9ad5f4" target="_blank" rel="noopener">https://www.jianshu.com/p/bb930e9ad5f4</a></p><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>ã€ç‰ˆæƒç”³æ˜ã€‘æ­¤ç‰‡ä¸ºåŸåˆ›å†…å®¹ï¼Œä½¿ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank" rel="noopener">CC BY-NC-SA 3.0</a>æˆæƒæ¡æ¬¾ï¼Œè¯·éµå®ˆå¯¹åº”çš„ä¹‰åŠ¡ï¼Œå³è¢«æˆæƒäººæœ‰ä¹‰åŠ¡åœ¨æ‰€æœ‰å‰¯æœ¬ä¸­éƒ½å¿…é¡»åŒ…å«ç‰ˆæƒå£°æ˜ã€‚è°¢è°¢åˆä½œ~</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢<a href="https://blog.tengshe789.tech/ï¼ˆğŸ˜˜" target="_blank" rel="noopener">https://blog.tengshe789.tech/ï¼ˆğŸ˜˜</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‰ä¸€é˜µå­å·¥ä½œæœ‰ç‚¹å¿™ï¼Œä¹Ÿæ¯”è¾ƒç„¦è™‘ã€‚æ²¡æœ‰æ—¶é—´å†™ä¸€äº›åšå®¢æ–‡ç« ï¼Œä»Šå¤©æ¥è¡¥å……ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.tech/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æˆ‘çš„åšå®¢&lt;/a&gt;ã€‚
      
    
    </summary>
    
    
      <category term="åˆ†äº«" scheme="https://tengshe789.github.io/tags/%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>æ–°å¹´å¿«ä¹</title>
    <link href="https://tengshe789.github.io/2019/01/01/%E6%96%B0%E5%B9%B4%E5%BF%AB%E4%B9%90/"/>
    <id>https://tengshe789.github.io/2019/01/01/æ–°å¹´å¿«ä¹/</id>
    <published>2019-01-01T02:19:46.000Z</published>
    <updated>2019-11-20T13:39:41.538Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€æ˜¯ä¸€å¹´æ˜¥å¥½å¤„,ç»èƒœçƒŸæŸ³æ»¡çš‡éƒ½ã€‚</p><p>è½¬çœ¼é—´å…ƒæ—¦åˆ°äº†ï¼Œé¦–å…ˆå‘¢ï¼Œç¥ç¦æ‰€æœ‰çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„ä½ ï¼Œå…ƒæ—¦å¿«ä¹ï¼Œç”Ÿæ´»ç¾æ»¡ï¼Œå¿ƒæƒ³äº‹æˆã€‚</p><p>æ˜¨å¤œåˆšåˆšä»é’å²›å›åˆ°æµå—çš„å­¦æ ¡å®¿èˆï¼Œåœ¨å­¦æ ¡åƒäº†ä¸€é¡¿é£Ÿå ‚ï¼Œèººåœ¨å®¿èˆé‡Œçœ‹å¹³æˆæœ€åçš„çº¢ç™½æ­Œä¼šã€‚æ„å¤–çš„å‘ç°ä¸€ä¸ªè¶…æ¼‚äº®å¾ˆæœ‰ä»™æ°”çš„å°å§å§ï¼Œè¥¿é‡ä¸ƒæ¿‘ ! æˆ‘è§‰å¾—æˆ‘çš„å¿ƒç¬é—´å°±è¢«å¥½å‡ å›¢å¤§å¤§çš„æ£‰èŠ±å¡«å……äº†ï¼Œå†¬å¤©å‡›å†½çš„å¯’é£ä¹Ÿä¸æ¯«å¸¦ä¸è¶³æˆ‘å¿ƒçš„ä¸€ä¸çƒ­é‡ï¼Œ å¦‚å›¾</p><p><img src="https://ww2.sinaimg.cn/large/005Bj70qgy1fyq9puy4c6j30wm0mau0x.jpg" alt="è¥¿é‡ä¸ƒæ¿‘1"></p><p><img src="https://ww4.sinaimg.cn/large/68fea95bgy1fyq86yqxbuj21120kuh8u.jpg" alt="è¥¿é‡ä¸ƒæ¿‘2"></p><p><img src="https://ww4.sinaimg.cn/large/68fea95bgy1fyq86ysn5fj21120ku4jm.jpg" alt="è¥¿é‡ä¸ƒæ¿‘3"></p><p>æœ‰æ²¡æœ‰ï¼Ÿæ˜¯ä¸æ˜¯ä»™æ°”åè¶³ã€‚</p><p>å¯æƒœä¸ƒæ¿‘é…±å·²ç»å®£å¸ƒé€€å½¹äº†ï¼Œè¿™æ˜¯æœ€åä¸€åœºåœ¨ä¹ƒæœ¨å‚46çš„è¡¨æ¼”ã€‚çŸ¥é“è¿™ä¸ªæ¶ˆæ¯çš„æˆ‘ä¹Ÿæ˜¯æ¯”è¾ƒæƒ‹æƒœï¼Œåœ¨æ¨ç‰¹å’Œinsä¸Šç”¨æ—¥æ–‡é¼“åŠ±äº†å°å§å§ä»¥åï¼Œå®‰ç„¶å…¥ç¡~</p><p>ä¸€è§‰é†’æ¥ï¼Œæ—©ä¸Š9ç‚¹ã€‚è¿·ç³Šä¸­æ‹¿èµ·æ‰‹æœºï¼ŒæŠ¢äº†å‡ ä¸ªå‡Œæ™¨ç¾¤å‹å‘çš„çº¢åŒ…ï¼ŒæŠ–æ“æŠ–æ“ç²¾ç¥ã€‚æ¥ä¸‹æ¥çš„ä»»åŠ¡æœ‰å¾ˆå¤šï¼Œæˆ‘ä¸€ä¸€åˆ—äº†ä¸ªæ¸…å•ï¼š</p><ul><li>æŠ½ç©ºçœ‹ç‰æ´</li></ul><ul><li>å…ƒæ—¦æœŸé—´å°±è¦ä¸Šäº¤æ¯•ä¸šè®ºæ–‡çš„å¼€é¢˜æŠ¥å‘Šï¼Œå¯æˆ‘å› ä¸ºç©å½©è™¹å…­å·åˆ°ç°åœ¨è¿˜æ²¡æ€è€ƒå†™ä»€ä¹ˆã€‚ã€‚è€å¸ˆè¯´éšä¾¿åšå°±è¡Œï¼Œé‚£æˆ‘åˆçº ç»“èµ·æ¥äº†ã€‚ç”¨javaçš„å¾®æœåŠ¡ç§’æ€å•†åŸï¼Ÿè¿˜æ˜¯ç”¨pythonåšæˆ¿åœ°äº§ä»·æ ¼èµ°åŠ¿çˆ¬è™«ä¸­å¿ƒï¼Ÿç¬¬ä¸€ç§èŠ±æ—¶é—´å¤šä½†è¿˜ç®—ç†Ÿç»ƒï¼Œç¬¬äºŒå¼ æ—¶é—´æˆæœ¬å¤šä¸€äº›ã€‚</li><li>æ˜å¤©è¦å»åŒ—äº¬å‡ºå·®</li><li>è¿‡å¹´å›å®¶ä¹°ç«è½¦ç¥¨ã€‚</li><li>å› ä¸ºæ²¡æœ‰é è°±çš„å·¥ä½œæ‰€æœ‰è¿˜åœ¨å‡†å¤‡å·¥ä½œé¢è¯•ã€‚é˜¿é‡Œå·´å·´çš„å†…æ¨åˆ°ç°åœ¨è¿˜æ²¡ç»™æˆ‘å‘é¢è¯•ç»“æœï¼ŒğŸ˜«ç»§ç»­å‡†å¤‡</li></ul><p>å°±è¿™æ ·æŠŠ~æœç€è‡ªå·±å¿ƒä¸­ä¸æ–­åŠªåŠ›ï¼æ–°çš„ä¸€å¹´è¦åŠ æ²¹ï¼â€“9012</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€æ˜¯ä¸€å¹´æ˜¥å¥½å¤„,ç»èƒœçƒŸæŸ³æ»¡çš‡éƒ½ã€‚&lt;/p&gt;
&lt;p&gt;è½¬çœ¼é—´å…ƒæ—¦åˆ°äº†ï¼Œé¦–å…ˆå‘¢ï¼Œç¥ç¦æ‰€æœ‰çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„ä½ ï¼Œå…ƒæ—¦å¿«ä¹ï¼Œç”Ÿæ´»ç¾æ»¡ï¼Œå¿ƒæƒ³äº‹æˆã€‚&lt;/p&gt;
&lt;p&gt;æ˜¨å¤œåˆšåˆšä»é’å²›å›åˆ°æµå—çš„å­¦æ ¡å®¿èˆï¼Œåœ¨å­¦æ ¡åƒäº†ä¸€é¡¿é£Ÿå ‚ï¼Œèººåœ¨å®¿èˆé‡Œçœ‹å¹³æˆæœ€åçš„çº¢ç™½æ­Œä¼šã€‚æ„å¤–çš„å‘ç°ä¸€ä¸ªè¶…æ¼‚äº®å¾ˆæœ‰ä»™æ°”çš„å°å§å§ï¼Œè¥¿é‡ä¸ƒ
      
    
    </summary>
    
    
      <category term="åˆ" scheme="https://tengshe789.github.io/tags/%E5%88%9D/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨å•ä¾‹æ¨¡å¼æ¥è¯´çº¿ç¨‹å®‰å…¨</title>
    <link href="https://tengshe789.github.io/2018/12/13/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E4%B8%8E%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/"/>
    <id>https://tengshe789.github.io/2018/12/13/å•ä¾‹æ¨¡å¼ä¸çº¿ç¨‹å®‰å…¨/</id>
    <published>2018-12-13T06:55:23.000Z</published>
    <updated>2019-11-20T13:39:41.236Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡<a href="https://blog.tengshe789.tech/2018/09/30/java%E4%B8%8E%E5%86%85%E5%AD%98/" target="_blank" rel="noopener">åšæ–‡</a>è®²äº†æœ‰å…³javaå’Œå†…å­˜é‚£äº›äº‹æƒ…ï¼Œä»Šå¤©æ¥å»¶ç”³ä¸€ä¸‹,ç»“åˆè®¾è®¡æ¨¡å¼çš„å•ä¾‹æ¨¡å¼ï¼Œæ¥è¯´è¯´çº¿ç¨‹å®‰å…¨é‚£äº›äº‹æƒ…ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">https://blog.tengshe789.tech/</a></p><h1 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h1><p>å•ä¾‹æ¨¡å¼å¤§å®¶åº”è¯¥éƒ½ä¸é™Œç”Ÿï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿä¸­ï¼Œåº”ç”¨çš„ç±»ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚ä¼ ç»Ÿè¯¾æœ¬ä¸Šå•ä¾‹æ¨¡å¼åˆ†ä¸¤ç§ï¼Œä¸€ç§é¥¿æ±‰å¼ï¼Œä¸€ç§æ‡’æ±‰å¼ã€‚å¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼š</p><h3 id="æ‡’æ±‰å¼"><a href="#æ‡’æ±‰å¼" class="headerlink" title="æ‡’æ±‰å¼"></a>æ‡’æ±‰å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰æ¨¡å¼</span></span><br><span class="line"><span class="comment"> * å•ä¾‹å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶è¿›è¡Œåˆ›å»º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonExample1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonExample1</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å•ä¾‹å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonExample1 instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€çš„å·¥å‚æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonExample1 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> SingletonExample1();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‡’æ±‰å¼çš„å®ä¾‹æ˜¯åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åˆ›å»ºçš„ï¼Œç›¸åº”çš„é™æ€å·¥å‚åŠæ³•ä¼šå…ˆåˆ¤æ–­æœ‰æ²¡æœ‰å®ä¾‹ï¼Œæ²¡æœ‰å®ä¾‹åœ¨è¿›è¡Œåˆ›å»ºã€‚</p><p>ç„¶è€Œè¿™ç§åˆ›å»ºæ–¹æ³•æ—¶<strong>çº¿ç¨‹ä¸å®‰å…¨</strong>çš„ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼ŒåŒä¸€æ—¶åˆ»æ‹¿åˆ°å•ä¾‹å¯¹è±¡ï¼Œè¦å»é™æ€å·¥å‚åŠæ³•è®¿é—®ï¼Œç”±äºå·¥å‚åŠæ³•æ²¡æœ‰é”ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½è¿™ä¸¤ä¸ªçº¿ç¨‹æœ€ç»ˆä¼šæ‹¿åˆ°ä¸¤ä¸ªå®ä¾‹ã€‚</p><h3 id="é¥¿æ±‰å¼"><a href="#é¥¿æ±‰å¼" class="headerlink" title="é¥¿æ±‰å¼"></a>é¥¿æ±‰å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¥¿æ±‰æ¨¡å¼</span></span><br><span class="line"><span class="comment"> * å•ä¾‹å®ä¾‹åœ¨ç±»è£…è½½æ—¶è¿›è¡Œåˆ›å»º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonExample2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonExample2</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å•ä¾‹å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonExample2 instance = <span class="keyword">new</span> SingletonExample2();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€çš„å·¥å‚æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonExample2 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸å¯¹äºä¸Šé¢é‚£ç§æ‡’æ±‰å¼ï¼Œé¥¿æ±‰å¼æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ã€‚ç›´æ¥å°†å•ä¾‹å¯¹è±¡ç”¨staticä¿®é¥°ï¼ŒæŠŠå®ä¾‹å¯¹è±¡æ”¾åˆ°å †å†…å­˜ä¸­ï¼Œä¿è¯äº†å¤šä¸ªçº¿ç¨‹åœ¨è®¿é—®æ—¶çš„å¯è§æ€§ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆå¤§çš„ï¼Œæ­£æ˜¯ç”±äºæŠŠå®ä¾‹å¯¹è±¡æ”¾åˆ°å †å†…å­˜ä¸­ï¼Œè¿™æ ·åº”ç”¨ä¸€åŠ è½½å°±ä¼šçœ‹åˆ°å¯¹åº”å®ä¾‹ï¼Œæå¤§æµªè´¹å†…å­˜ã€‚</p><h3 id="å°è¯•ç”¨synchronizedæ”¹é€ æ‡’æ±‰å¼"><a href="#å°è¯•ç”¨synchronizedæ”¹é€ æ‡’æ±‰å¼" class="headerlink" title="å°è¯•ç”¨synchronizedæ”¹é€ æ‡’æ±‰å¼"></a>å°è¯•ç”¨synchronizedæ”¹é€ æ‡’æ±‰å¼</h3><p>æ’ä¸€å¥å˜´ï¼Œ<code>synchronized</code>åº•å±‚åŸç†ï¼Œä¸»è¦æ˜¯ä¸¤ä¸ªæŒ‡ä»¤å®ç°çš„ï¼Œåˆ†åˆ«æ˜¯<code>monitorenter</code>å’Œ<code>monitorexit</code>æŒ‡ä»¤ï¼Œä¸‹é¢æ˜¯æˆ‘ä»ç½‘ç»œä¸Šæ‰¾åˆ°çš„å¯¹åº”æŒ‡ä»¤çš„è§£é‡Šï¼š</p><blockquote><p><code>monitorenter</code>ï¼š</p><p>æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªç›‘è§†å™¨é”ï¼ˆmonitorï¼‰ã€‚å½“monitorè¢«å ç”¨æ—¶å°±ä¼šå¤„äºé”å®šçŠ¶æ€ï¼Œçº¿ç¨‹æ‰§è¡ŒmonitorenteræŒ‡ä»¤æ—¶å°è¯•è·å–monitorçš„æ‰€æœ‰æƒï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€å¦‚æœmonitorçš„è¿›å…¥æ•°ä¸º0ï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥monitorï¼Œç„¶åå°†è¿›å…¥æ•°è®¾ç½®ä¸º1ï¼Œè¯¥çº¿ç¨‹å³ä¸ºmonitorçš„æ‰€æœ‰è€…ã€‚</p><p>2ã€å¦‚æœçº¿ç¨‹å·²ç»å æœ‰è¯¥monitorï¼Œåªæ˜¯é‡æ–°è¿›å…¥ï¼Œåˆ™è¿›å…¥monitorçš„è¿›å…¥æ•°åŠ 1.</p><p>3.å¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»å ç”¨äº†monitorï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°monitorçš„è¿›å…¥æ•°ä¸º0ï¼Œå†é‡æ–°å°è¯•è·å–monitorçš„æ‰€æœ‰æƒã€‚</p><p><code>monitorexit</code>ï¼š</p><p>æ‰§è¡Œmonitorexitçš„çº¿ç¨‹å¿…é¡»æ˜¯objectrefæ‰€å¯¹åº”çš„monitorçš„æ‰€æœ‰è€…ã€‚</p><p>æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œmonitorçš„è¿›å…¥æ•°å‡1ï¼Œå¦‚æœå‡1åè¿›å…¥æ•°ä¸º0ï¼Œé‚£çº¿ç¨‹é€€å‡ºmonitorï¼Œä¸å†æ˜¯è¿™ä¸ªmonitorçš„æ‰€æœ‰è€…ã€‚å…¶ä»–è¢«è¿™ä¸ªmonitoré˜»å¡çš„çº¿ç¨‹å¯ä»¥å°è¯•å»è·å–è¿™ä¸ª monitor çš„æ‰€æœ‰æƒã€‚ </p><p>ã€€ã€€é€šè¿‡è¿™ä¸¤æ®µæè¿°ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¾ˆæ¸…æ¥šçš„çœ‹å‡ºSynchronizedçš„å®ç°åŸç†ï¼ŒSynchronizedçš„è¯­ä¹‰åº•å±‚æ˜¯é€šè¿‡ä¸€ä¸ªmonitorçš„å¯¹è±¡æ¥å®Œæˆï¼Œå…¶å®wait/notifyç­‰æ–¹æ³•ä¹Ÿä¾èµ–äºmonitorå¯¹è±¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåªæœ‰åœ¨åŒæ­¥çš„å—æˆ–è€…æ–¹æ³•ä¸­æ‰èƒ½è°ƒç”¨wait/notifyç­‰æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡ºjava.lang.IllegalMonitorStateExceptionçš„å¼‚å¸¸çš„åŸå› ã€‚</p></blockquote><p>æ¯«æ— ç–‘é—®ï¼Œæ‡’æ±‰å¼çš„æ€§èƒ½æ˜¯å‡ºè‰²çš„ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸åœ¨æ‡’æ±‰å¼çš„åŸºç¡€ä¸Šä½¿ç”¨<code>synchronized</code>ä¿®é¥°å‘¢ï¼Ÿ</p><p>ä¸‹é¢æ˜¯ç›¸å…³ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰æ¨¡å¼</span></span><br><span class="line"><span class="comment"> * å•ä¾‹å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶è¿›è¡Œåˆ›å»º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonExample3</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonExample3</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å•ä¾‹å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonExample3 instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€çš„å·¥å‚æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> SingletonExample3 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> SingletonExample3();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ äº†<code>synchronized</code>ä¿®é¥°åçš„å·¥å‚æ–¹æ³•ï¼Œæ„å‘³ç€åœ¨åŒä¸€æ—¶é—´å†…åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚è¿™æ¯«æ— ç–‘é—®æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ã€‚ä½†æ˜¯è¿™åŒæ—¶æ˜¯ä¸è¢«æ¨èçš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå’Œä¸Šé¢ä½¿ç”¨<code>static</code>ä¿®é¥°çš„æ‡’æ±‰æ¨¡å¼ä¸åŒï¼Œè¿™ä¸ªå·¥å‚æ–¹æ³•ï¼Œåœ¨åŒä¸€æ—¶é—´æ®µå†…åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œæå¤§çš„é™åˆ¶cpuèµ„æºï¼Œæ€§èƒ½æå…¶å·®ï¼</p><h3 id="åŒé‡åŒæ­¥é”å•ä¾‹æ¨¡å¼"><a href="#åŒé‡åŒæ­¥é”å•ä¾‹æ¨¡å¼" class="headerlink" title="åŒé‡åŒæ­¥é”å•ä¾‹æ¨¡å¼"></a>åŒé‡åŒæ­¥é”å•ä¾‹æ¨¡å¼</h3><p>é‚£ä¹ˆæˆ‘ä»¬å¸å–ä¸Šé¢çš„æ•™è®­ï¼Œå¯ä¸å¯ä»¥åœ¨ä½¿ç”¨<code>synchronized</code>ä¿®é¥°åŸºç¡€ä¸Šåœ¨åŠ ä»¥æ”¹è¿›å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰æ¨¡å¼ -ã€‹ åŒé‡åŒæ­¥é”å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> * å•ä¾‹å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶è¿›è¡Œåˆ›å»º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonExample4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonExample4</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å•ä¾‹å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonExample4 instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€çš„å·¥å‚æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonExample4 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123; <span class="comment">// åŒé‡æ£€æµ‹æœºåˆ¶        // B</span></span><br><span class="line">            <span class="keyword">synchronized</span> (SingletonExample4.class) &#123; <span class="comment">// åŒæ­¥é”</span></span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> SingletonExample4(); <span class="comment">// A - 3</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå¤šäººä¼šè®¤ä¸ºè¿™ç§åŠæ³•æ˜¯æœ€ä½³çš„è§£å†³åŠæ³•äº†ï¼Œå…¶å®ä¸æ˜¯ï¼Œè¿™ä¹Ÿæ˜¯<strong>çº¿ç¨‹ä¸å®‰å…¨</strong>çš„ã€‚æ€ä¹ˆè¯´å‘¢ï¼Ÿ</p><p>å½“çº¿ç¨‹è¿›å…¥åŒæ­¥é”ï¼Œèµ°åˆ°<code>instance = new SingletonExample4();</code>æ—¶ï¼ŒJVMä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ol><li>memory = allocate() åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´</li><li>ctorInstance() åˆå§‹åŒ–å¯¹è±¡</li><li>instance = memory è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜</li></ol><p>å•çº¿ç¨‹æƒ…å†µä¸‹è‚¯å®šæ²¡é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼ŒJVMå’ŒCPUçš„ä¼˜åŒ–ä¸­å¯èƒ½ä¼šæ‰§è¡ŒæŒ‡ä»¤é‡æ’ã€‚ä¸Šé¢çš„ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥ä¸­ï¼Œç”±äºæ²¡æœ‰å‰åå¿…ç„¶å…³ç³»ï¼Œcpuå¯èƒ½éšæ—¶è°ƒæ¢ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥çš„æ‰§è¡Œé¡ºåºã€‚ä¹Ÿå°±æ˜¯ä¼šå‘ç”Ÿ132è¿™ç§é¡ºåºã€‚</p><h3 id="å•ä¾‹å¯¹è±¡-volatile-åŒé‡æ£€æµ‹æœºåˆ¶"><a href="#å•ä¾‹å¯¹è±¡-volatile-åŒé‡æ£€æµ‹æœºåˆ¶" class="headerlink" title="å•ä¾‹å¯¹è±¡ volatile + åŒé‡æ£€æµ‹æœºåˆ¶"></a>å•ä¾‹å¯¹è±¡ volatile + åŒé‡æ£€æµ‹æœºåˆ¶</h3><p>å¸å–æ•™è®­ç»§ç»­æ”¹è¿›ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰æ¨¡å¼ -ã€‹ åŒé‡åŒæ­¥é”å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> * å•ä¾‹å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶è¿›è¡Œåˆ›å»º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonExample5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonExample5</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1ã€memory = allocate() åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´</span></span><br><span class="line">    <span class="comment">// 2ã€ctorInstance() åˆå§‹åŒ–å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// 3ã€instance = memory è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å•ä¾‹å¯¹è±¡ volatile + åŒé‡æ£€æµ‹æœºåˆ¶ -&gt; ç¦æ­¢æŒ‡ä»¤é‡æ’</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> SingletonExample5 instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€çš„å·¥å‚æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonExample5 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123; <span class="comment">// åŒé‡æ£€æµ‹æœºåˆ¶        // B</span></span><br><span class="line">            <span class="keyword">synchronized</span> (SingletonExample5.class) &#123; <span class="comment">// åŒæ­¥é”</span></span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> SingletonExample5(); <span class="comment">// A - 3</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>volatile</code>çš„ç›¸å…³åŠŸèƒ½è¯·çœ‹æˆ‘<a href="https://blog.tengshe789.tech/2018/09/30/java%E4%B8%8E%E5%86%85%E5%AD%98/" target="_blank" rel="noopener">ä¹‹å‰çš„åšå®¢</a>ã€‚åˆ°è¿™é‡Œï¼Œæ‡’æ±‰æ¨¡å¼æ”¹è¿›å°±å®Œæˆäº†ã€‚</p><h3 id="æšä¸¾æ¨¡å¼-ã€‹æœ€å®‰å…¨"><a href="#æšä¸¾æ¨¡å¼-ã€‹æœ€å®‰å…¨" class="headerlink" title="æšä¸¾æ¨¡å¼-ã€‹æœ€å®‰å…¨"></a>æšä¸¾æ¨¡å¼-ã€‹æœ€å®‰å…¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æšä¸¾æ¨¡å¼ï¼šæœ€å®‰å…¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonExample6</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonExample6</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonExample6 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Singleton.INSTANCE.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">enum</span> Singleton &#123;</span><br><span class="line">        INSTANCE;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> SingletonExample6 singleton;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// JVMä¿è¯è¿™ä¸ªæ–¹æ³•ç»å¯¹åªè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">        Singleton() &#123;</span><br><span class="line">            singleton = <span class="keyword">new</span> SingletonExample6();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> SingletonExample6 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> singleton;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€æ¨èçš„æ˜¯ä½¿ç”¨æšä¸¾ç±»å®ç°å•ä¾‹æ¨¡å¼ï¼Œè¿™æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ã€‚JVMä¼šä¿è¯æšä¸¾ç±»ä¸­çš„æ„é€ æ–¹æ³•åªè°ƒç”¨ä¸€æ¬¡ï¼Œå› æ­¤ä½¿ç”¨æšä¸¾ä¼šä¿è¯åªå®ä¾‹åŒ–ä¸€æ¬¡ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.cnblogs.com/paddix/p/5367116.html" target="_blank" rel="noopener">Javaå¹¶å‘ç¼–ç¨‹ï¼šSynchronizedåŠå…¶å®ç°åŸç†</a></p><p>å…¨ç‰‡ç»“æŸï¼Œè§‰å¾—æˆ‘å†™çš„ä¸é”™ï¼Ÿæƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿèµ¶å¿«æ‰“å¼€æˆ‘çš„ğŸ‘‰ä¸ªäºº<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">åšå®¢</a> ğŸ‘ˆå§ï¼</p><p>è°¢è°¢ä½ é‚£ä¹ˆå¯çˆ±ï¼Œè¿˜ä¸€ç›´å…³æ³¨ç€æˆ‘~â¤ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸Šä¸€ç¯‡&lt;a href=&quot;https://blog.tengshe789.tech/2018/09/30/java%E4%B8%8E%E5%86%85%E5%AD%98/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åšæ–‡&lt;/a&gt;è®²äº†æœ‰å…³javaå’Œå†…å­˜é‚£äº›äº‹
      
    
    </summary>
    
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="å¹¶å‘" scheme="https://tengshe789.github.io/tags/%E5%B9%B6%E5%8F%91/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://tengshe789.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·</title>
    <link href="https://tengshe789.github.io/2018/12/13/%E5%88%86%E4%BA%AB%E4%B8%80%E4%B8%8B%E6%88%91%E5%B8%B8%E7%94%A8%E7%9A%84%E9%AB%98%E5%B9%B6%E5%8F%91%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    <id>https://tengshe789.github.io/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/</id>
    <published>2018-12-13T01:39:59.000Z</published>
    <updated>2019-11-20T13:39:41.198Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘åŠå¹´å‰è¿™ä¸ªå­¦ä¹ é¡¹ç›®ğŸ‘‰ <a href="https://github.com/tengshe789/-miaosha" target="_blank" rel="noopener">https://github.com/tengshe789/-miaosha</a> ğŸ‘ˆåˆæœ‰äººç‚¹èµäº†23333ï¼Œçœ‹æ¥æŠ€æœ¯è¿˜æ²¡æ­»ã€‚é‚£ä¹ˆä»Šå¤©åˆ†äº«ä¸€ä¸‹è¿™ä¸ªç§’æ€ç³»ç»Ÿä½¿ç”¨çš„æµ‹è¯•å·¥å…·~</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h2 id="Postmanè¯·æ±‚æ¨¡æ‹Ÿå·¥å…·"><a href="#Postmanè¯·æ±‚æ¨¡æ‹Ÿå·¥å…·" class="headerlink" title="Postmanè¯·æ±‚æ¨¡æ‹Ÿå·¥å…·"></a>Postmanè¯·æ±‚æ¨¡æ‹Ÿå·¥å…·</h2><h3 id="ä¸‹è½½å®‰è£…"><a href="#ä¸‹è½½å®‰è£…" class="headerlink" title="ä¸‹è½½å®‰è£…"></a>ä¸‹è½½å®‰è£…</h3><p>æ—¥åæ›´æ–°</p><h3 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h3><p><img src="/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/1.png" alt="Postman"></p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>ç•Œé¢å³ä¾§æœ‰ä¸ªè“è‰²çš„å·¨å¤§çš„buttonï¼Œä¸Šé¢å†™ç€<code>send</code>ï¼Œæ—è¾¹æœ‰å„ç§å‚æ•°ã€‚æƒ³æµ‹è¯•çš„è¯ï¼Œé€‰æ‹©è¯·æ±‚ç±»å‹ï¼Œè¯·æ±‚æ•°æ®ç­‰ç­‰ï¼Œç‚¹å‡»<code>send</code>å°±å¥½ã€‚</p><h4 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h4><p>æœ€å³ä¸Šè§’é½¿è½®å½¢çŠ¶çš„å›¾æ ‡ï¼Œæ·»åŠ ä½ éœ€è¦çš„é”®å’Œå€¼ã€‚</p><p><img src="/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/2.png" alt="Postman"></p><p>è®¿é—®çš„æ—¶å€™ç›´æ¥ä½¿ç”¨<code>/æ¥å£</code>å°±è¡Œ</p><h4 id="æµ‹è¯•è®°å½•"><a href="#æµ‹è¯•è®°å½•" class="headerlink" title="æµ‹è¯•è®°å½•"></a>æµ‹è¯•è®°å½•</h4><p>ä¸€æ¸…äºŒæ¥š</p><p><img src="/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/3.png" alt="Postman"></p><h4 id="æ–°å¢collection"><a href="#æ–°å¢collection" class="headerlink" title="æ–°å¢collection"></a>æ–°å¢collection</h4><p>historyæ—è¾¹æœ‰collectionï¼Œå¯ä»¥ä½¿ç”¨å¹¶å‘æµ‹è¯•ã€‚</p><p>æ–°å»ºå¦‚å›¾ï¼š</p><p><img src="/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/4.png" alt="Postman"></p><p><code>Iterations</code>é€‰æ‹©å¹¶å‘æ¬¡æ•°ï¼Œ<code>delay</code>é€‰æ‹©å»¶è¿Ÿæ—¶é—´ã€‚</p><p><img src="/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/5.png" alt="Postman"></p><p>ç»“æœæˆ‘å°±ä¸è´´å›¾äº†ï¼Œå¤§ä¼™è‡ªå·±æ¢ç´¢å§ã€‚</p><h3 id="apache-bench"><a href="#apache-bench" class="headerlink" title="apache bench"></a>apache bench</h3><p>ApacheBench æ˜¯ Apache æœåŠ¡å™¨è‡ªå¸¦çš„ä¸€ä¸ªwebå‹åŠ›æµ‹è¯•å·¥å…·ï¼Œç®€ç§°abã€‚abåˆæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯¹å‘èµ·è´Ÿè½½çš„æœ¬æœºè¦æ±‚å¾ˆä½ï¼Œæ ¹æ®abå‘½ä»¤å¯ä»¥åˆ›å»ºå¾ˆå¤šçš„å¹¶å‘è®¿é—®çº¿ç¨‹ï¼Œæ¨¡æ‹Ÿå¤šä¸ªè®¿é—®è€…åŒæ—¶å¯¹æŸä¸€URLåœ°å€è¿›è¡Œè®¿é—®ï¼Œå› æ­¤å¯ä»¥ç”¨æ¥æµ‹è¯•ç›®æ ‡æœåŠ¡å™¨çš„è´Ÿè½½å‹åŠ›ã€‚æ€»çš„æ¥è¯´abå·¥å…·å°å·§ç®€å•ï¼Œä¸Šæ‰‹å­¦ä¹ è¾ƒå¿«ï¼Œå¯ä»¥æä¾›éœ€è¦çš„åŸºæœ¬æ€§èƒ½æŒ‡æ ‡ï¼Œä½†æ˜¯æ²¡æœ‰å›¾å½¢åŒ–ç»“æœï¼Œä¸èƒ½ç›‘æ§ã€‚</p><h4 id="ä¸‹è½½å®‰è£…-1"><a href="#ä¸‹è½½å®‰è£…-1" class="headerlink" title="ä¸‹è½½å®‰è£…"></a>ä¸‹è½½å®‰è£…</h4><p><a href="https://www.cnblogs.com/Ryana/p/6279232.html" target="_blank" rel="noopener">https://www.cnblogs.com/Ryana/p/6279232.html</a></p><h3 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>è¯´è¯´å‘½ä»¤å«ä¹‰</p><p>æœ€å¼€å¤´çš„å‘½ä»¤<code>ab</code>æ˜¯apache benchçš„ç¼©å†™ï¼Œä½¿ç”¨ä»–å³æ„å‘³ç€ä½¿ç”¨è¿™ä¸ªè½¯ä»¶</p><p><code>-n</code>å°±æ˜¯newäº†ã€‚</p><p>å‚æ•°<code>1000</code>æ˜¯æµ‹è¯•è¯·æ±‚æ¬¡æ•°</p><p><code>-c</code>å°±æ˜¯Concurrencyå¹¶å‘ï¼Œåé¢çš„å‚æ•°50ï¼Œæ˜¯åŒæ—¶å…è®¸çš„è¯·æ±‚æ•°</p><p><img src="/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/6.png" alt="Postman"></p><p>ç»“æœå¦‚ä¸‹å›¾ğŸ‘‡</p><p>ç»“æœä¾æ¬¡çš„å«ä¹‰ä¸ºï¼š</p><ul><li><p>å¹¶å‘é‡50</p></li><li><p>æ•´ä¸ªæµ‹è¯•æ‰€ç”¨æ—¶é—´0.466</p></li><li><p>å®Œæˆè¯·æ±‚æ•°1000</p></li><li><p>å¤±è´¥è¯·æ±‚æ•°ç›®0</p></li><li><p>æ‰€æœ‰è¯·æ±‚å“åº”æ•°æ®çš„é•¿åº¦æ€»å’Œï¼ˆåŒ…æ‹¬æ‰€æœ‰httpå¤´éƒ¨å’Œæ­£æ–‡æ•°æ®çš„é•¿åº¦ï¼Œä¸åŒ…æ‹¬httpè¯·æ±‚æ•°æ®çš„é•¿åº¦ï¼‰136000B</p></li><li><p>HTMLæ­£æ–‡æ•°æ®æ€»é•¿åº¦4000B</p></li><li><p>ååç‡(TPS)2144.47</p></li><li><p>ç”¨æˆ·å¹³å‡è¯·æ±‚ç­‰å¾…æ—¶é—´23.316ms</p></li><li><p>æœåŠ¡å™¨å¹³å‡è¯·æ±‚ç­‰å¾…æ—¶é—´0.466</p></li><li><p>å•ä½æ—¶é—´å†…çš„æ•°æ®é•¿åº¦284.81</p><p><img src="/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/7.png" alt="Postman"></p></li></ul><h2 id="Apache-JMeter"><a href="#Apache-JMeter" class="headerlink" title="Apache JMeter"></a>Apache JMeter</h2><p>Apache JMeteræ˜¯Apacheç»„ç»‡å¼€å‘çš„åŸºäºJavaçš„å‹åŠ›æµ‹è¯•å·¥å…·ã€‚ç”¨äºå¯¹è½¯ä»¶åšå‹åŠ›æµ‹è¯•ï¼Œå®ƒæœ€åˆè¢«<br>è®¾è®¡ç”¨äºWebåº”ç”¨æµ‹è¯•ï¼Œä½†åæ¥æ‰©å±•åˆ°å…¶ä»–æµ‹è¯•é¢†åŸŸã€‚ å®ƒå¯ä»¥ç”¨äºæµ‹è¯•é™æ€å’ŒåŠ¨æ€èµ„æºï¼Œä¾‹å¦‚é™æ€æ–‡ä»¶ã€Java å°æœåŠ¡ç¨‹åºã€CGI è„šæœ¬ã€Java å¯¹è±¡ã€æ•°æ®åº“ã€FTP æœåŠ¡å™¨ï¼Œ ç­‰ç­‰ã€‚JMeter å¯ä»¥ç”¨äºå¯¹æœåŠ¡å™¨ã€ç½‘ç»œæˆ–å¯¹è±¡æ¨¡æ‹Ÿå·¨å¤§çš„è´Ÿè½½ï¼Œæ¥è‡ªä¸åŒå‹åŠ›ç±»åˆ«ä¸‹æµ‹è¯•å®ƒä»¬çš„å¼ºåº¦å’Œåˆ†ææ•´ä½“æ€§èƒ½ã€‚å¦å¤–ï¼ŒJMeterèƒ½å¤Ÿå¯¹åº”ç”¨ç¨‹åºåšåŠŸèƒ½/å›å½’æµ‹è¯•ï¼Œé€šè¿‡åˆ›å»ºå¸¦æœ‰æ–­è¨€çš„è„šæœ¬æ¥éªŒè¯ä½ çš„ç¨‹åºè¿”å›äº†ä½ æœŸæœ›çš„ç»“æœã€‚ä¸ºäº†æœ€å¤§é™åº¦çš„çµæ´»æ€§ï¼ŒJMeterå…è®¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ›å»ºæ–­è¨€ã€‚ï¼ˆå¤åˆ¶çš„ç™¾åº¦ç™¾ç§‘çš„233ğŸ™ƒï¼‰</p><h3 id="ä¸‹è½½å®‰è£…-2"><a href="#ä¸‹è½½å®‰è£…-2" class="headerlink" title="ä¸‹è½½å®‰è£…"></a>ä¸‹è½½å®‰è£…</h3><p><a href="https://jmeter.apache.org/" target="_blank" rel="noopener">https://jmeter.apache.org/</a></p><h3 id="UI-1"><a href="#UI-1" class="headerlink" title="UI"></a>UI</h3><p><img src="/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/8.png" alt="Postman"></p><h3 id="ä½¿ç”¨-2"><a href="#ä½¿ç”¨-2" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="æ–°å»ºæµ‹è¯•"><a href="#æ–°å»ºæµ‹è¯•" class="headerlink" title="æ–°å»ºæµ‹è¯•"></a>æ–°å»ºæµ‹è¯•</h4><p>å¦‚å›¾ï¼Œåœ¨å³ä¾§æ–°å»ºçº¿ç¨‹ç»„ï¼Œè‡ªå·±å–ä¸ªåã€‚çœ‹å³ä¾§ã€‚</p><p>çº¿ç¨‹å±æ€§çš„çº¿ç¨‹æ•°æ˜¯ä»£è¡¨å¤šå°‘ç”¨æˆ·è®¿é—®è¿™ä¸ªç³»ç»Ÿã€‚è¿™é‡Œè¡¨ç¤ºæœ‰50ä¸ªç”¨æˆ·è®¿é—®ç³»ç»Ÿã€‚</p><p>ç¬¬äºŒè¡ŒR-U Pï¼Œæ˜¯è™šæ‹Ÿç”¨æˆ·å¢é•¿æ—¶é•¿ã€‚ä¸€èˆ¬çš„è¯æ—¶é—´è®¾ç½®æˆæœ€åˆä¹å¸¸è§„çš„ï¼Œç”¨æˆ·æ•°é‡å¢é•¿æœ€å¿«çš„æ—¶é—´æ®µã€‚</p><p>ç¬¬ä¸‰è¡Œï¼Œé»˜è®¤ä¸ºä¸€ï¼Œæ„æ€æ˜¯ä¸€ä¸ªè™šæ‹Ÿç”¨æˆ·é»˜è®¤è¿è¡Œå®Œä¸€è¾¹åå°±åœæ­¢äº†ã€‚æ—è¾¹çš„æ¡†æ¡†ï¼Œæ„å‘³ç€æµ‹è¯•è¿è¡Œèµ·æ¥å°±æ°¸è¿œä¸åœäº†</p><p>  <img src="/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/9.png" alt="Postman"></p><h4 id="æ–°å»ºhttpè¯·æ±‚"><a href="#æ–°å»ºhttpè¯·æ±‚" class="headerlink" title="æ–°å»ºhttpè¯·æ±‚"></a>æ–°å»ºhttpè¯·æ±‚</h4><p>å›åˆ°å·¦è¾¹ä¾§æ ï¼Œå³é”®çº¿ç¨‹ç»„ï¼Œæ–°å»ºHTTPè¯·æ±‚.å¦‚å›¾</p><p>  <img src="/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/10.png" alt="Postman"></p><h4 id="æ–°å»ºç›‘å¬"><a href="#æ–°å»ºç›‘å¬" class="headerlink" title="æ–°å»ºç›‘å¬"></a>æ–°å»ºç›‘å¬</h4><p>ç›‘å¬å°±æ˜¯ä»¥å›¾è¡¨å½¢å¼è¡¨ç°å‡ºæ¥æµ‹è¯•çš„ç»“æœã€‚</p><p><img src="/2018/12/13/åˆ†äº«ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é«˜å¹¶å‘æµ‹è¯•å·¥å…·/11.png" alt="Postman"></p><h2 id="å®Œ"><a href="#å®Œ" class="headerlink" title="å®Œ"></a>å®Œ</h2><p>å…¨ç‰‡ç»“æŸï¼Œè§‰å¾—æˆ‘å†™çš„ä¸é”™ï¼Ÿæƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿèµ¶å¿«æ‰“å¼€æˆ‘çš„ğŸ‘‰ä¸ªäºº<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">åšå®¢</a> ğŸ‘ˆå§ï¼</p><p>è°¢è°¢ä½ é‚£ä¹ˆå¯çˆ±ï¼Œè¿˜ä¸€ç›´å…³æ³¨ç€æˆ‘~â¤ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æˆ‘åŠå¹´å‰è¿™ä¸ªå­¦ä¹ é¡¹ç›®ğŸ‘‰ &lt;a href=&quot;https://github.com/tengshe789/-miaosha&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/tengshe789/-miaosha&lt;/a&gt; ï¿½
      
    
    </summary>
    
    
      <category term="å¹¶å‘" scheme="https://tengshe789.github.io/tags/%E5%B9%B6%E5%8F%91/"/>
    
      <category term="åˆ†äº«" scheme="https://tengshe789.github.io/tags/%E5%88%86%E4%BA%AB/"/>
    
      <category term="è½¯ä»¶æ•™å­¦" scheme="https://tengshe789.github.io/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E5%AD%A6/"/>
    
      <category term="çªé—¨" scheme="https://tengshe789.github.io/tags/%E7%AA%8D%E9%97%A8/"/>
    
      <category term="æµ‹è¯•" scheme="https://tengshe789.github.io/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>çœ‹Pigå¼€æºé¡¹ç›®çš„äº‘è¸©å‘è®°</title>
    <link href="https://tengshe789.github.io/2018/12/12/%E5%86%B7%E5%86%B7Pig%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0/"/>
    <id>https://tengshe789.github.io/2018/12/12/å†·å†·Pigå¼€æºé¡¹ç›®å­¦ä¹ /</id>
    <published>2018-12-12T02:25:52.000Z</published>
    <updated>2019-11-20T13:39:41.181Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘çœ‹åˆ°ä¸€ä¸ªæœ‰è¶£çš„å¼€æºé¡¹ç›®pigï¼Œä¸»è¦çš„æŠ€æœ¯ç‚¹åœ¨è®¤è¯æˆæƒä¸­å¿ƒï¼Œspring security oauthï¼Œzuulç½‘å…³å®ç°ï¼ŒElastic-Jobå®šæ—¶ä»»åŠ¡ï¼Œè¶ç€åˆšåˆšå…¥é—¨å¾®æœåŠ¡ï¼Œèµ¶å¿«å†™ä¸ªåšå®¢åˆ†æä¸€ä¸‹ã€‚æ­¤ç¯‡æ–‡ç« ä¸»è¦ç”¨äºä¸ªäººå¤‡å¿˜ã€‚å¦‚æœæœ‰ä¸å¯¹ï¼Œè¯·æ‰¹è¯„ã€‚ğŸ˜­</p><p>ç”±äºæ¯ä¸ªæ¨¡å—ç¯‡å¹…è¾ƒé•¿ï¼Œä¸”éƒ¨åˆ†å†…å®¹å’Œ<a href="https://blog.tengshe789.tech/2018/12/02/%E6%84%9F%E6%80%A7%E8%AE%A4%E8%AF%86jwt/#more" target="_blank" rel="noopener">å‰æ–‡</a>æœ‰é‡å ï¼Œå¹²è´§å’Œå›¾ç‰‡è¾ƒå°‘ï¼Œé˜…è¯»æ—¶ä½¿ç”¨æ—è¾¹çš„å¯¼èˆªåŠŸèƒ½ä½“éªŒè¾ƒä½³ã€‚ğŸ˜‰</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">https://blog.tengshe789.tech/</a></p><h1 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h1><p>æœ¬ç¯‡æ–‡ç« æ˜¯å¯¹åŸºäº<code>spring boot</code>1.5çš„<code>pig 1</code>ç‰ˆæœ¬åšçš„åˆ†æï¼Œä¸æ˜¯æ”¶è´¹çš„<code>pigx 2</code>ç‰ˆæœ¬ã€‚</p><h3 id="å¼€æºé¡¹ç›®åœ°å€"><a href="#å¼€æºé¡¹ç›®åœ°å€" class="headerlink" title="å¼€æºé¡¹ç›®åœ°å€"></a>å¼€æºé¡¹ç›®åœ°å€</h3><p><a href="https://gitee.com/log4j/pig" target="_blank" rel="noopener">https://gitee.com/log4j/pig</a></p><p>é…ç½®ä¸­å¿ƒï¼š<a href="https://gitee.com/cqzqxq_lxh/pig-config" target="_blank" rel="noopener">https://gitee.com/cqzqxq_lxh/pig-config</a></p><h4 id="å†·å†·å®˜æ–¹åœ°å€"><a href="#å†·å†·å®˜æ–¹åœ°å€" class="headerlink" title="å†·å†·å®˜æ–¹åœ°å€"></a>å†·å†·å®˜æ–¹åœ°å€</h4><p><a href="https://pig4cloud.com/zh-cn/index.html" target="_blank" rel="noopener">https://pig4cloud.com/zh-cn/index.html</a></p><h4 id="ä½“éªŒåœ°å€"><a href="#ä½“éªŒåœ°å€" class="headerlink" title="ä½“éªŒåœ°å€"></a>ä½“éªŒåœ°å€</h4><p><a href="http://pigx.pig4cloud.com/#/wel/index" target="_blank" rel="noopener">http://pigx.pig4cloud.com/#/wel/index</a></p><h4 id="é¡¹ç›®å¯åŠ¨é¡ºåº"><a href="#é¡¹ç›®å¯åŠ¨é¡ºåº" class="headerlink" title="é¡¹ç›®å¯åŠ¨é¡ºåº"></a>é¡¹ç›®å¯åŠ¨é¡ºåº</h4><p>è¯·ç¡®ä¿å¯åŠ¨é¡ºåºï¼ˆ<strong>è¦å…ˆå¯åŠ¨è®¤è¯ä¸­å¿ƒï¼Œå†å¯åŠ¨ç½‘å…³</strong>ï¼‰</p><ol><li>eureka</li><li>config</li><li>auth</li><li>gateway</li><li>upms</li></ol><h1 id="è®¤è¯ä¸­å¿ƒ"><a href="#è®¤è¯ä¸­å¿ƒ" class="headerlink" title="è®¤è¯ä¸­å¿ƒ"></a>è®¤è¯ä¸­å¿ƒ</h1><p>è€è§„çŸ©ï¼Œè‡ªä¸Šåˆ°ä¸‹çœ‹ä»£ç ï¼Œå…ˆä»æ¥å£å±‚çœ‹èµ·</p><h2 id="è¯·æ±‚restæ¥å£"><a href="#è¯·æ±‚restæ¥å£" class="headerlink" title="è¯·æ±‚restæ¥å£"></a>è¯·æ±‚restæ¥å£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/authentication"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthenticationController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"consumerTokenServices"</span>)</span><br><span class="line">    <span class="keyword">private</span> ConsumerTokenServices consumerTokenServices;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¤è¯é¡µé¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ModelAndView</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/require"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">require</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"ftl/login"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ä¿¡æ¯æ ¡éªŒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authentication ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">user</span><span class="params">(Authentication authentication)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> authentication.getPrincipal();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¸…é™¤Redisä¸­ accesstoken refreshtoken</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> accesstoken  accesstoken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true/false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/removeToken"</span>)</span><br><span class="line">    <span class="meta">@CacheEvict</span>(value = SecurityConstants.TOKEN_USER_DETAIL, key = <span class="string">"#accesstoken"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R&lt;Boolean&gt; <span class="title">removeToken</span><span class="params">(String accesstoken)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> R&lt;&gt;( consumerTokenServices.revokeToken(accesstoken));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥å£å±‚æœ‰ä¸‰ä¸ªæ¥å£è·¯å¾„ï¼Œç¬¬ä¸€ä¸ªåº”è¯¥æ²¡ç”¨ï¼Œå‰©ä¸‹ä¸¤ä¸ªæ˜¯æ ¡éªŒç”¨æˆ·ä¿¡æ¯çš„<code>/user</code>å’Œæ¸…é™¤Redisä¸­ accesstoken ä¸refreshtokençš„<code>/removeToken</code></p><h2 id="æ¡†æ¶é…ç½®"><a href="#æ¡†æ¶é…ç½®" class="headerlink" title="æ¡†æ¶é…ç½®"></a>æ¡†æ¶é…ç½®</h2><h3 id="æ¡†æ¶é…ç½®-1"><a href="#æ¡†æ¶é…ç½®-1" class="headerlink" title="æ¡†æ¶é…ç½®"></a>æ¡†æ¶é…ç½®</h3><p>ä¸‹é¢è¿™æ®µä»£ç æ—¶é…ç½®å„ç§<code>spring security</code>é…ç½®ï¼ŒåŒ…æ‹¬ç™»é™†ç•Œé¢urlæ˜¯<code>&quot;/authentication/require&quot;</code>å•¦ã€‚å¦‚æœä¸ä½¿ç”¨é»˜è®¤çš„å¼¹å‡ºæ¡†è€Œä½¿ç”¨è‡ªå·±çš„é¡µé¢ï¼Œè¡¨å•çš„actionæ˜¯<code>&quot;/authentication/form&quot;</code>å•¦ã€‚ä½¿ç”¨è‡ªå·±å®šä¹‰çš„è¿‡æ»¤è§„åˆ™å•¦ã€‚ç¦ç”¨<code>csrf</code>å•¦ï¼ˆè‡ªè¡Œæœç´¢csrfï¼ŒjwtéªŒè¯ä¸éœ€è¦é˜²è·¨åŸŸï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨xssè¿‡æ»¤ï¼‰ã€‚ä½¿ç”¨æ‰‹æœºç™»é™†é…ç½®å•¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order</span>(SecurityProperties.ACCESS_OVERRIDE_ORDER - <span class="number">1</span>)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PigSecurityConfigurerAdapter</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FilterIgnorePropertiesConfig filterIgnorePropertiesConfig;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MobileSecurityConfigurer mobileSecurityConfigurer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ExpressionUrlAuthorizationConfigurer&lt;HttpSecurity&gt;.ExpressionInterceptUrlRegistry registry =</span><br><span class="line">                http.formLogin().loginPage(<span class="string">"/authentication/require"</span>)</span><br><span class="line">                        .loginProcessingUrl(<span class="string">"/authentication/form"</span>)</span><br><span class="line">                        .and()</span><br><span class="line">                        .authorizeRequests();</span><br><span class="line">        filterIgnorePropertiesConfig.getUrls().forEach(url -&gt; registry.antMatchers(url).permitAll());</span><br><span class="line">        registry.anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">                .csrf().disable();</span><br><span class="line">        http.apply(mobileSecurityConfigurer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ ¡éªŒç”¨æˆ·ä¿¡æ¯"><a href="#æ ¡éªŒç”¨æˆ·ä¿¡æ¯" class="headerlink" title="æ ¡éªŒç”¨æˆ·ä¿¡æ¯"></a>æ ¡éªŒç”¨æˆ·ä¿¡æ¯</h2><p>è¯»é…ç½®ç±»å’Œæ¥å£å±‚ï¼Œæˆ‘ä»¬çŸ¥é“äº†ï¼Œæ€»çš„é€»è¾‘å¤§æ¦‚å°±æ˜¯ç”¨æˆ·ç™»é™†äº†ä»¥åï¼Œä½¿ç”¨spring securityæ¡†æ¶çš„è®¤è¯æ¥è·å–æƒé™ã€‚</p><p>æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çœ‹ï¼Œè¾¹çŒœæƒ³è¾¹æ¥ã€‚æ¥å£å¤„æœ‰<code>&quot;ftl/login&quot;</code>ï¼Œè¿™å¤§æ¦‚å°±æ˜¯ä½¿ç”¨freemarkeræ¨¡æ¿ï¼Œloginä¿¡æ¯æºå¸¦çš„<code>token</code>ä¼šä¼ åˆ°ç”¨æˆ·ä¿¡æ¯æ ¡éªŒurl<code>&quot;/user&quot;</code>ä¸Šï¼Œå¯ä½œè€…ç›´æ¥ä½¿ç”¨<code>Authentication</code>è¿”å›ä¸€ä¸ª<code>getPrincipal()</code>ï¼Œå°±æ²¡äº†ï¼Œæ ¹æœ¬æ²¡çœ‹è§è‡ªå®šä¹‰çš„ä»£ç ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p><p>åŸæ¥ï¼Œä½œè€…ä½¿ç”¨<code>spring security</code>æ¡†æ¶ï¼Œä½¿ç”¨æ¡†æ¶æ¥å®ç°æ ¡éªŒä¿¡æ¯ã€‚</p><p>æ‰“å¡<code>config</code>åŒ…ä¸‹çš„<code>PigAuthorizationConfig</code>ï¼Œæˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p><h3 id="ä½¿ç”¨spring-security-å®ç°-æˆæƒæœåŠ¡å™¨"><a href="#ä½¿ç”¨spring-security-å®ç°-æˆæƒæœåŠ¡å™¨" class="headerlink" title="ä½¿ç”¨spring security å®ç° æˆæƒæœåŠ¡å™¨"></a>ä½¿ç”¨spring security å®ç° æˆæƒæœåŠ¡å™¨</h3><p>æ³¨æ˜ï¼Œé˜…è¯»æ­¤å¤„æ¨¡å—éœ€è¦OAUTHåŸºç¡€ï¼Œ<a href="https://blog.tengshe789.tech/2018/12/02/%E6%84%9F%E6%80%A7%E8%AE%A4%E8%AF%86jwt/#more" target="_blank" rel="noopener">https://blog.tengshe789.tech/2018/12/02/%E6%84%9F%E6%80%A7%E8%AE%A4%E8%AF%86jwt/#more</a></p><p>è¿™é‡Œç®€å•æä¸€ä¸‹ï¼Œ<code>spring security oauth</code>é‡Œæœ‰ä¸¤ä¸ªæ¦‚å¿µï¼ŒæˆæƒæœåŠ¡å™¨å’Œèµ„æºæœåŠ¡å™¨ã€‚</p><p>æˆæƒæœåŠ¡å™¨æ˜¯æ ¹æ®æˆæƒè®¸å¯ç»™è®¿é—®çš„å®¢æˆ·ç«¯å‘æ”¾<code>access token</code>ä»¤ç‰Œçš„ï¼Œæä¾›è®¤è¯ã€æˆæƒæœåŠ¡ï¼›</p><p>èµ„æºæœåŠ¡å™¨éœ€è¦éªŒè¯è¿™ä¸ª<code>access token</code>,å®¢æˆ·ç«¯æ‰èƒ½è®¿é—®å¯¹åº”æœåŠ¡ã€‚</p><h4 id="å®¢æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡é…ç½®"><a href="#å®¢æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡é…ç½®" class="headerlink" title="å®¢æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡é…ç½®"></a>å®¢æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡é…ç½®</h4><p><code>ClientDetailsServiceConfigurer</code>(<code>AuthorizationServerConfigurer</code> çš„ä¸€ä¸ªå›è°ƒé…ç½®é¡¹) èƒ½å¤Ÿä½¿ç”¨å†…å­˜æˆ–è€…JDBCæ¥å®ç°å®¢æˆ·ç«¯è¯¦æƒ…æœåŠ¡ï¼ˆClientDetailsServiceï¼‰ï¼Œ<code>Spring Security OAuth2</code>çš„é…ç½®æ–¹æ³•æ˜¯ç¼–å†™<code>@Configuration</code>ç±»ç»§æ‰¿<code>AuthorizationServerConfigurerAdapter</code>ï¼Œç„¶åé‡å†™<code>void configure(ClientDetailsServiceConfigurer clients)</code>æ–¹æ³•</p><p>ä¸‹é¢ä»£ç ä¸»è¦é€»è¾‘æ˜¯ï¼Œä½¿ç”¨<code>spring security</code>æ¡†æ¶å°è£…çš„ç®€å•sqlè¿æ¥å™¨ï¼ŒæŸ¥è¯¢å®¢æˆ·ç«¯çš„è¯¦ç»†ä¿¡æ¯ğŸ‘‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(` clients)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       JdbcClientDetailsService clientDetailsService = <span class="keyword">new</span> JdbcClientDetailsService(dataSource);</span><br><span class="line">       clientDetailsService.setSelectClientDetailsSql(SecurityConstants.DEFAULT_SELECT_STATEMENT);</span><br><span class="line">       clientDetailsService.setFindClientDetailsSql(SecurityConstants.DEFAULT_FIND_STATEMENT);</span><br><span class="line">       clients.withClientDetails(clientDetailsService);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ç›¸å…³çš„sqlè¯­å¥å¦‚ä¸‹ï¼Œç”±äºè€¦åˆåº¦è¾ƒå¤§ï¼Œæˆ‘å°†sqlå£°æ˜è¯­å¥æ”¹äº†ä¸€æ”¹ï¼Œæ–¹é¢é˜…è¯»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * é»˜è®¤çš„æŸ¥è¯¢è¯­å¥</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   String DEFAULT_FIND_STATEMENT = <span class="string">"select "</span> + <span class="string">"client_id, client_secret, resource_ids, scope, "</span></span><br><span class="line">           + <span class="string">"authorized_grant_types, web_server_redirect_uri, authorities, access_token_validity, "</span></span><br><span class="line">           + <span class="string">"refresh_token_validity, additional_information, autoapprove"</span></span><br><span class="line">           + <span class="string">" from sys_oauth_client_details"</span> + <span class="string">" order by client_id"</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æŒ‰æ¡ä»¶client_id æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   String DEFAULT_SELECT_STATEMENT = <span class="string">"select "</span> +<span class="string">"client_id, client_secret, resource_ids, scope, "</span></span><br><span class="line">           + <span class="string">"authorized_grant_types, web_server_redirect_uri, authorities, access_token_validity, "</span></span><br><span class="line">           + <span class="string">"refresh_token_validity, additional_information, autoapprove"</span></span><br><span class="line">           + <span class="string">" from sys_oauth_client_details"</span> + <span class="string">" where client_id = ?"</span>;</span><br></pre></td></tr></table></figure><p>ç›¸å…³æ•°æ®åº“ä¿¡æ¯å¦‚ä¸‹ï¼š</p><p><img src="/2018/12/12/å†·å†·Pigå¼€æºé¡¹ç›®å­¦ä¹ /2.png" alt="æœåŠ¡ç½‘å…³"></p><h4 id="æˆæƒæœåŠ¡å™¨ç«¯ç‚¹é…ç½®å™¨"><a href="#æˆæƒæœåŠ¡å™¨ç«¯ç‚¹é…ç½®å™¨" class="headerlink" title="æˆæƒæœåŠ¡å™¨ç«¯ç‚¹é…ç½®å™¨"></a>æˆæƒæœåŠ¡å™¨ç«¯ç‚¹é…ç½®å™¨</h4><p><code>endpoints</code>å‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿæ‰€æœ‰è·å–ä»¤ç‰Œçš„è¯·æ±‚éƒ½å°†ä¼šåœ¨Spring MVC controller <code>endpoints</code>ä¸­è¿›è¡Œå¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//tokenå¢å¼ºé…ç½®</span></span><br><span class="line">        TokenEnhancerChain tokenEnhancerChain = <span class="keyword">new</span> TokenEnhancerChain();</span><br><span class="line">        tokenEnhancerChain.setTokenEnhancers(</span><br><span class="line">                Arrays.asList(tokenEnhancer(), jwtAccessTokenConverter()));</span><br><span class="line"></span><br><span class="line">        endpoints</span><br><span class="line">                .tokenStore(redisTokenStore())</span><br><span class="line">                .tokenEnhancer(tokenEnhancerChain)</span><br><span class="line">                .authenticationManager(authenticationManager)</span><br><span class="line">                .reuseRefreshTokens(<span class="keyword">false</span>)</span><br><span class="line">                .userDetailsService(userDetailsService);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h5 id="tokenå¢å¼ºå™¨ï¼ˆè‡ªå®šä¹‰tokenä¿¡æ¯ä¸­æºå¸¦çš„ä¿¡æ¯ï¼‰"><a href="#tokenå¢å¼ºå™¨ï¼ˆè‡ªå®šä¹‰tokenä¿¡æ¯ä¸­æºå¸¦çš„ä¿¡æ¯ï¼‰" class="headerlink" title="tokenå¢å¼ºå™¨ï¼ˆè‡ªå®šä¹‰tokenä¿¡æ¯ä¸­æºå¸¦çš„ä¿¡æ¯ï¼‰"></a>tokenå¢å¼ºå™¨ï¼ˆè‡ªå®šä¹‰tokenä¿¡æ¯ä¸­æºå¸¦çš„ä¿¡æ¯ï¼‰</h5><p>æœ‰æ—¶å€™éœ€è¦é¢å¤–çš„ä¿¡æ¯åŠ åˆ°tokenè¿”å›ä¸­ï¼Œè¿™éƒ¨åˆ†ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª<code>TokenEnhancer</code>ï¼Œæ¥è‡ªå®šä¹‰ç”Ÿæˆtokenæºå¸¦çš„ä¿¡æ¯ã€‚<code>TokenEnhancer</code>æ¥å£æä¾›ä¸€ä¸ª <code>enhance(OAuth2AccessToken var1, OAuth2Authentication var2)</code> æ–¹æ³•ï¼Œç”¨äºå¯¹tokenä¿¡æ¯çš„æ·»åŠ ï¼Œä¿¡æ¯æ¥æºäº<code>OAuth2Authentication</code>ã€‚</p><p>ä½œè€…å°†ç”Ÿæˆçš„<code>accessToken</code>ä¸­ï¼ŒåŠ ä¸Šäº†è‡ªå·±çš„åå­—ï¼ŒåŠ ä¸Šäº†<code>userId</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TokenEnhancer <span class="title">tokenEnhancer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (accessToken, authentication) -&gt; &#123;</span><br><span class="line">            <span class="keyword">final</span> Map&lt;String, Object&gt; additionalInfo = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">2</span>);</span><br><span class="line">            additionalInfo.put(<span class="string">"license"</span>, SecurityConstants.PIG_LICENSE);</span><br><span class="line">            UserDetailsImpl user = (UserDetailsImpl) authentication.getUserAuthentication().getPrincipal();</span><br><span class="line">            <span class="keyword">if</span> (user != <span class="keyword">null</span>) &#123;</span><br><span class="line">                additionalInfo.put(<span class="string">"userId"</span>, user.getUserId());</span><br><span class="line">            &#125;</span><br><span class="line">            ((DefaultOAuth2AccessToken) accessToken).setAdditionalInformation(additionalInfo);</span><br><span class="line">            <span class="keyword">return</span> accessToken;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h5 id="JWTè½¬æ¢å™¨ï¼ˆè‡ªå®šä¹‰tokenä¿¡æ¯ä¸­æ·»åŠ çš„ä¿¡æ¯ï¼‰"><a href="#JWTè½¬æ¢å™¨ï¼ˆè‡ªå®šä¹‰tokenä¿¡æ¯ä¸­æ·»åŠ çš„ä¿¡æ¯ï¼‰" class="headerlink" title="JWTè½¬æ¢å™¨ï¼ˆè‡ªå®šä¹‰tokenä¿¡æ¯ä¸­æ·»åŠ çš„ä¿¡æ¯ï¼‰"></a>JWTè½¬æ¢å™¨ï¼ˆè‡ªå®šä¹‰tokenä¿¡æ¯ä¸­æ·»åŠ çš„ä¿¡æ¯ï¼‰</h5><p>JWTä¸­ï¼Œéœ€è¦åœ¨tokenä¸­æºå¸¦é¢å¤–çš„ä¿¡æ¯ï¼Œè¿™æ ·å¯ä»¥åœ¨æœåŠ¡ä¹‹é—´å…±äº«éƒ¨åˆ†ç”¨æˆ·ä¿¡æ¯ï¼Œspring securityé»˜è®¤åœ¨JWTçš„tokenä¸­åŠ å…¥äº†user_nameï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦é¢å¤–çš„ä¿¡æ¯ï¼Œéœ€è¦è‡ªå®šä¹‰è¿™éƒ¨åˆ†å†…å®¹ã€‚</p><p><code>JwtAccessTokenConverter</code>æ˜¯ä½¿ç”¨<code>JWT</code>æ›¿æ¢é»˜è®¤çš„Tokençš„è½¬æ¢å™¨ï¼Œè€Œtokenä»¤ç‰Œé»˜è®¤æ˜¯æœ‰ç­¾åçš„ï¼Œä¸”èµ„æºæœåŠ¡å™¨éœ€è¦éªŒè¯è¿™ä¸ªç­¾åã€‚æ­¤å¤„çš„åŠ å¯†åŠéªŒç­¾åŒ…æ‹¬ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><p>å¯¹ç§°åŠ å¯†</p></li><li><p>éå¯¹ç§°åŠ å¯†ï¼ˆå…¬é’¥å¯†é’¥ï¼‰</p></li></ul><p>å¯¹ç§°åŠ å¯†éœ€è¦æˆæƒæœåŠ¡å™¨å’Œèµ„æºæœåŠ¡å™¨å­˜å‚¨åŒä¸€keyå€¼ï¼Œè€Œéå¯¹ç§°åŠ å¯†å¯ä½¿ç”¨å¯†é’¥åŠ å¯†ï¼Œæš´éœ²å…¬é’¥ç»™èµ„æºæœåŠ¡å™¨éªŒç­¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PigJwtAccessTokenConverter</span> <span class="keyword">extends</span> <span class="title">JwtAccessTokenConverter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, ?&gt; convertAccessToken(OAuth2AccessToken token, OAuth2Authentication authentication) &#123;</span><br><span class="line">        Map&lt;String, Object&gt; representation = (Map&lt;String, Object&gt;) <span class="keyword">super</span>.convertAccessToken(token, authentication);</span><br><span class="line">        representation.put(<span class="string">"license"</span>, SecurityConstants.PIG_LICENSE);</span><br><span class="line">        <span class="keyword">return</span> representation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OAuth2AccessToken <span class="title">extractAccessToken</span><span class="params">(String value, Map&lt;String, ?&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.extractAccessToken(value, map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OAuth2Authentication <span class="title">extractAuthentication</span><span class="params">(Map&lt;String, ?&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.extractAuthentication(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="redisä¸token"><a href="#redisä¸token" class="headerlink" title="redisä¸token"></a>redisä¸token</h5><p>ä½¿ç”¨é‰´æƒçš„<code>endpoint</code>å°†åŠ ä¸Šè‡ªå·±åå­—çš„<code>token</code>æ”¾å…¥<code>redis</code>ï¼Œredisè¿æ¥å™¨ç”¨çš„<code>srping data redis</code>æ¡†æ¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * tokenstore å®šåˆ¶åŒ–å¤„ç†</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> TokenStore</span></span><br><span class="line"><span class="comment">    * 1. å¦‚æœä½¿ç”¨çš„ redis-cluster æ¨¡å¼è¯·ä½¿ç”¨ PigRedisTokenStore</span></span><br><span class="line"><span class="comment">    * PigRedisTokenStore tokenStore = new PigRedisTokenStore();</span></span><br><span class="line"><span class="comment">    * tokenStore.setRedisTemplate(redisTemplate);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> TokenStore <span class="title">redisTokenStore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       RedisTokenStore tokenStore = <span class="keyword">new</span> RedisTokenStore(redisConnectionFactory);</span><br><span class="line">       tokenStore.setPrefix(SecurityConstants.PIG_PREFIX);</span><br><span class="line">       <span class="keyword">return</span> tokenStore;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="æˆæƒæœåŠ¡å™¨å®‰å…¨é…ç½®å™¨"><a href="#æˆæƒæœåŠ¡å™¨å®‰å…¨é…ç½®å™¨" class="headerlink" title="æˆæƒæœåŠ¡å™¨å®‰å…¨é…ç½®å™¨"></a>æˆæƒæœåŠ¡å™¨å®‰å…¨é…ç½®å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerSecurityConfigurer security)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        security</span><br><span class="line">                .allowFormAuthenticationForClients()</span><br><span class="line">                .tokenKeyAccess(<span class="string">"isAuthenticated()"</span>)</span><br><span class="line">                .checkTokenAccess(<span class="string">"permitAll()"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰å®ç°çš„æ‰‹æœºå·-è®¤è¯æœåŠ¡"><a href="#è‡ªå®šä¹‰å®ç°çš„æ‰‹æœºå·-è®¤è¯æœåŠ¡" class="headerlink" title="è‡ªå®šä¹‰å®ç°çš„æ‰‹æœºå· è®¤è¯æœåŠ¡"></a>è‡ªå®šä¹‰å®ç°çš„æ‰‹æœºå· è®¤è¯æœåŠ¡</h3><h4 id="æ¥å£å±‚"><a href="#æ¥å£å±‚" class="headerlink" title="æ¥å£å±‚"></a>æ¥å£å±‚</h4><p>å…ˆçœ‹æ¥å£å±‚ï¼Œè¿™é‡Œå’Œ<code>pig-upms-service</code>è”åŠ¨ï¼Œç»™äº†ä¸‰ä¸ªè·¯å¾„ï¼Œç”¨æˆ·ä½¿ç”¨æ‰‹æœºå·ç ç™»é™†å¯é€šè¿‡ä¸‰ä¸ªè·¯å¾„å‘é€è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(name = <span class="string">"pig-upms-service"</span>, fallback = UserServiceFallbackImpl.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ã€è§’è‰²ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> UserVo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/user/findUserByUsername/&#123;username&#125;"</span>)</span><br><span class="line">    <span class="function">UserVO <span class="title">findUserByUsername</span><span class="params">(@PathVariable(<span class="string">"username"</span>)</span> String username)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·ã€è§’è‰²ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mobile æ‰‹æœºå·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> UserVo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/user/findUserByMobile/&#123;mobile&#125;"</span>)</span><br><span class="line">    <span class="function">UserVO <span class="title">findUserByMobile</span><span class="params">(@PathVariable(<span class="string">"mobile"</span>)</span> String mobile)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®OpenIdæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> openId openId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> UserVo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/user/findUserByOpenId/&#123;openId&#125;"</span>)</span><br><span class="line">    <span class="function">UserVO <span class="title">findUserByOpenId</span><span class="params">(@PathVariable(<span class="string">"openId"</span>)</span> String openId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h4><p>é‡å†™<code>SecurityConfigurerAdapter</code>çš„æ–¹æ³•ï¼Œé€šè¿‡httpè¯·æ±‚ï¼Œæ‰¾å‡ºæœ‰å…³æ‰‹æœºå·çš„tokenï¼Œç”¨tokenæ‰¾å‡ºç›¸å…³ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå·²<code>Authentication</code>æ–¹å¼ä¿å­˜ã€‚æ‹¿åˆ°ä¿¡æ¯åï¼Œä½¿ç”¨è¿‡æ»¤å™¨éªŒè¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MobileSecurityConfigurer</span> <span class="keyword">extends</span> <span class="title">SecurityConfigurerAdapter</span>&lt;<span class="title">DefaultSecurityFilterChain</span>, <span class="title">HttpSecurity</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationSuccessHandler mobileLoginSuccessHandler;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        MobileAuthenticationFilter mobileAuthenticationFilter = <span class="keyword">new</span> MobileAuthenticationFilter();</span><br><span class="line">        mobileAuthenticationFilter.setAuthenticationManager(http.getSharedObject(AuthenticationManager.class));</span><br><span class="line">        mobileAuthenticationFilter.setAuthenticationSuccessHandler(mobileLoginSuccessHandler);</span><br><span class="line"></span><br><span class="line">        MobileAuthenticationProvider mobileAuthenticationProvider = <span class="keyword">new</span> MobileAuthenticationProvider();</span><br><span class="line">        mobileAuthenticationProvider.setUserService(userService);</span><br><span class="line">        http.authenticationProvider(mobileAuthenticationProvider)</span><br><span class="line">                .addFilterAfter(mobileAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰‹æœºå·ç™»å½•æ ¡éªŒé€»è¾‘MobileAuthenticationProvider"><a href="#æ‰‹æœºå·ç™»å½•æ ¡éªŒé€»è¾‘MobileAuthenticationProvider" class="headerlink" title="æ‰‹æœºå·ç™»å½•æ ¡éªŒé€»è¾‘MobileAuthenticationProvider"></a>æ‰‹æœºå·ç™»å½•æ ¡éªŒé€»è¾‘MobileAuthenticationProvider</h4><p>åœ¨<code>spring security</code> ä¸­ï¼Œ<code>AuthenticationManage</code>ç®¡ç†ä¸€ç³»åˆ—çš„<code>AuthenticationProvider</code>ï¼Œ<br>è€Œæ¯ä¸€ä¸ª<code>Provider</code>éƒ½ä¼šé€š<code>UserDetailsService</code>å’Œ<code>UserDetail</code>æ¥è¿”å›ä¸€ä¸ª<br>ä»¥<code>MobileAuthenticationToken</code>å®ç°çš„å¸¦ç”¨æˆ·ä»¥åŠæƒé™çš„<code>Authentication</code></p><p>æ­¤å¤„é€»è¾‘æ˜¯ï¼Œé€šè¿‡<code>UserService</code>æŸ¥æ‰¾å·²æœ‰ç”¨æˆ·çš„æ‰‹æœºå·ç ï¼Œç”Ÿæˆå¯¹åº”çš„<code>UserDetails</code>,ä½¿ç”¨UserDetailsç”Ÿæˆæ‰‹æœºéªŒè¯<code>Authentication</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        MobileAuthenticationToken mobileAuthenticationToken = (MobileAuthenticationToken) authentication;</span><br><span class="line">        UserVO userVo = userService.findUserByMobile((String) mobileAuthenticationToken.getPrincipal());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (userVo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">"æ‰‹æœºå·ä¸å­˜åœ¨:"</span> + mobileAuthenticationToken.getPrincipal());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        UserDetailsImpl userDetails = buildUserDeatils(userVo);</span><br><span class="line"></span><br><span class="line">        MobileAuthenticationToken authenticationToken = <span class="keyword">new</span> MobileAuthenticationToken(userDetails, userDetails.getAuthorities());</span><br><span class="line">        authenticationToken.setDetails(mobileAuthenticationToken.getDetails());</span><br><span class="line">        <span class="keyword">return</span> authenticationToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> UserDetailsImpl <span class="title">buildUserDeatils</span><span class="params">(UserVO userVo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserDetailsImpl(userVo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class&lt;?&gt; authentication)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MobileAuthenticationToken.class.isAssignableFrom(authentication);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h5 id="æ‰‹æœºå·ç™»å½•ä»¤ç‰Œç±»MobileAuthenticationToken"><a href="#æ‰‹æœºå·ç™»å½•ä»¤ç‰Œç±»MobileAuthenticationToken" class="headerlink" title="æ‰‹æœºå·ç™»å½•ä»¤ç‰Œç±»MobileAuthenticationToken"></a>æ‰‹æœºå·ç™»å½•ä»¤ç‰Œç±»MobileAuthenticationToken</h5><p><code>MobileAuthenticationToken</code>ç»§æ‰¿<code>AbstractAuthenticationToken</code>å®ç°<code>Authentication</code><br>æ‰€ä»¥å½“åœ¨é¡µé¢ä¸­è¾“å…¥æ‰‹æœºä¹‹åé¦–å…ˆä¼šè¿›å…¥åˆ°<code>MobileAuthenticationToken</code>éªŒè¯(Authentication)ï¼Œ<br>ç„¶åç”Ÿæˆçš„<code>Authentication</code>ä¼šè¢«äº¤ç”±æˆ‘ä¸Šé¢è¯´çš„<code>AuthenticationManager</code>æ¥è¿›è¡Œç®¡ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MobileAuthenticationToken</span> <span class="keyword">extends</span> <span class="title">AbstractAuthenticationToken</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = SpringSecurityCoreVersion.SERIAL_VERSION_UID;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object principal;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MobileAuthenticationToken</span><span class="params">(String mobile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">this</span>.principal = mobile;</span><br><span class="line">        setAuthenticated(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MobileAuthenticationToken</span><span class="params">(Object principal,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Collection&lt;? extends GrantedAuthority&gt; authorities)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(authorities);</span><br><span class="line">        <span class="keyword">this</span>.principal = principal;</span><br><span class="line">        <span class="keyword">super</span>.setAuthenticated(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getPrincipal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.principal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getCredentials</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthenticated</span><span class="params">(<span class="keyword">boolean</span> isAuthenticated)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isAuthenticated) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                    <span class="string">"Cannot set this token to trusted - use constructor which takes a GrantedAuthority list instead"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.setAuthenticated(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eraseCredentials</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.eraseCredentials();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰‹æœºå·ç™»å½•éªŒè¯filter"><a href="#æ‰‹æœºå·ç™»å½•éªŒè¯filter" class="headerlink" title="æ‰‹æœºå·ç™»å½•éªŒè¯filter"></a>æ‰‹æœºå·ç™»å½•éªŒè¯filter</h4><p>åˆ¤æ–­httpè¯·æ±‚æ˜¯å¦æ˜¯postï¼Œä¸æ˜¯åˆ™è¿”å›é”™è¯¯ã€‚</p><p>æ ¹æ®requestè¯·æ±‚æ‹¿åˆ°moblieä¿¡æ¯ï¼Œä½¿ç”¨moblieä¿¡æ¯è¿”å›æ‰‹æœºå·ç ç™»é™†æˆåŠŸçš„oauth tokenã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">attemptAuthentication</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                HttpServletResponse response)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (postOnly &amp;&amp; !request.getMethod().equals(HttpMethod.POST.name())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationServiceException(</span><br><span class="line">                    <span class="string">"Authentication method not supported: "</span> + request.getMethod());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String mobile = obtainMobile(request);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mobile == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mobile = <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mobile = mobile.trim();</span><br><span class="line"></span><br><span class="line">        MobileAuthenticationToken mobileAuthenticationToken = <span class="keyword">new</span> MobileAuthenticationToken(mobile);</span><br><span class="line"></span><br><span class="line">        setDetails(request, mobileAuthenticationToken);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getAuthenticationManager().authenticate(mobileAuthenticationToken);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰‹æœºç™»é™†æˆåŠŸçš„å¤„ç†å™¨MobileLoginSuccessHandler"><a href="#æ‰‹æœºç™»é™†æˆåŠŸçš„å¤„ç†å™¨MobileLoginSuccessHandler" class="headerlink" title="æ‰‹æœºç™»é™†æˆåŠŸçš„å¤„ç†å™¨MobileLoginSuccessHandler"></a>æ‰‹æœºç™»é™†æˆåŠŸçš„å¤„ç†å™¨MobileLoginSuccessHandler</h4><p>è¿™ä¸ªå¤„ç†å™¨å¯ä»¥è¿”å›æ‰‹æœºå·ç™»å½•æˆåŠŸçš„<code>oauth token</code>ï¼Œä½†æ˜¯è¦å°†<code>oauth token</code>ä¼ è¾“å‡ºå»å¿…é¡»é…åˆä¸Šé¢çš„æ‰‹æœºå·ç™»å½•éªŒè¯filter</p><p>é€»è¾‘éƒ½åœ¨æ³¨é‡Šä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> </span>&#123;</span><br><span class="line">        String header = request.getHeader(<span class="string">"Authorization"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (header == <span class="keyword">null</span> || !header.startsWith(BASIC_)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnapprovedClientAuthenticationException(<span class="string">"è¯·æ±‚å¤´ä¸­clientä¿¡æ¯ä¸ºç©º"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String[] tokens = AuthUtils.extractAndDecodeHeader(header);</span><br><span class="line">            <span class="keyword">assert</span> tokens.length == <span class="number">2</span>;</span><br><span class="line">            String clientId = tokens[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">            ClientDetails clientDetails = clientDetailsService.loadClientByClientId(clientId);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ ¡éªŒsecret</span></span><br><span class="line">            <span class="keyword">if</span> (!clientDetails.getClientSecret().equals(tokens[<span class="number">1</span>])) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InvalidClientException(<span class="string">"Given client ID does not match authenticated client"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            TokenRequest tokenRequest = <span class="keyword">new</span> TokenRequest(MapUtil.newHashMap(), clientId, clientDetails.getScope(), <span class="string">"mobile"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ ¡éªŒscope</span></span><br><span class="line">            <span class="keyword">new</span> DefaultOAuth2RequestValidator().validateScope(tokenRequest, clientDetails);</span><br><span class="line">            OAuth2Request oAuth2Request = tokenRequest.createOAuth2Request(clientDetails);</span><br><span class="line">            OAuth2Authentication oAuth2Authentication = <span class="keyword">new</span> OAuth2Authentication(oAuth2Request, authentication);</span><br><span class="line">            OAuth2AccessToken oAuth2AccessToken = authorizationServerTokenServices.createAccessToken(oAuth2Authentication);</span><br><span class="line">            log.info(<span class="string">"è·å–token æˆåŠŸï¼š&#123;&#125;"</span>, oAuth2AccessToken.getValue());</span><br><span class="line"></span><br><span class="line">            response.setCharacterEncoding(CommonConstant.UTF8);</span><br><span class="line">            response.setContentType(CommonConstant.CONTENT_TYPE);</span><br><span class="line">            PrintWriter printWriter = response.getWriter();</span><br><span class="line">            printWriter.append(objectMapper.writeValueAsString(oAuth2AccessToken));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BadCredentialsException(</span><br><span class="line">                    <span class="string">"Failed to decode basic authentication token"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»header è¯·æ±‚ä¸­çš„clientId/clientsecect</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> header headerä¸­çš„å‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> CheckedException if the Basic header is not present or is not valid</span></span><br><span class="line"><span class="comment">     *                          Base64</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] extractAndDecodeHeader(String header)</span><br><span class="line">            <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] base64Token = header.substring(<span class="number">6</span>).getBytes(<span class="string">"UTF-8"</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] decoded;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            decoded = Base64.decode(base64Token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CheckedException(</span><br><span class="line">                    <span class="string">"Failed to decode basic authentication token"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String token = <span class="keyword">new</span> String(decoded, CommonConstant.UTF8);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> delim = token.indexOf(<span class="string">":"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (delim == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CheckedException(<span class="string">"Invalid basic authentication token"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;token.substring(<span class="number">0</span>, delim), token.substring(delim + <span class="number">1</span>)&#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–é…ç½®"><a href="#å…¶ä»–é…ç½®" class="headerlink" title="å…¶ä»–é…ç½®"></a>å…¶ä»–é…ç½®</h3><h4 id="redisé›†ç¾¤"><a href="#redisé›†ç¾¤" class="headerlink" title="redisé›†ç¾¤"></a>redisé›†ç¾¤</h4><p>æŒºå¥½çš„æ¨¡æ¿ï¼Œæ”¶è—ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PigRedisTokenStore</span> <span class="keyword">implements</span> <span class="title">TokenStore</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCESS = <span class="string">"access:"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String AUTH_TO_ACCESS = <span class="string">"auth_to_access:"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String AUTH = <span class="string">"auth:"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REFRESH_AUTH = <span class="string">"refresh_auth:"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCESS_TO_REFRESH = <span class="string">"access_to_refresh:"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REFRESH = <span class="string">"refresh:"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REFRESH_TO_ACCESS = <span class="string">"refresh_to_access:"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CLIENT_ID_TO_ACCESS = <span class="string">"client_id_to_access:"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String UNAME_TO_ACCESS = <span class="string">"uname_to_access:"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">getRedisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRedisTemplate</span><span class="params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AuthenticationKeyGenerator authenticationKeyGenerator = <span class="keyword">new</span> DefaultAuthenticationKeyGenerator();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthenticationKeyGenerator</span><span class="params">(AuthenticationKeyGenerator authenticationKeyGenerator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.authenticationKeyGenerator = authenticationKeyGenerator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OAuth2AccessToken <span class="title">getAccessToken</span><span class="params">(OAuth2Authentication authentication)</span> </span>&#123;</span><br><span class="line">        String key = authenticationKeyGenerator.extractKey(authentication);</span><br><span class="line">        OAuth2AccessToken accessToken = (OAuth2AccessToken) redisTemplate.opsForValue().get(AUTH_TO_ACCESS + key);</span><br><span class="line">        <span class="keyword">if</span> (accessToken != <span class="keyword">null</span></span><br><span class="line">                &amp;&amp; !key.equals(authenticationKeyGenerator.extractKey(readAuthentication(accessToken.getValue())))) &#123;</span><br><span class="line">            storeAccessToken(accessToken, authentication);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> accessToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OAuth2Authentication <span class="title">readAuthentication</span><span class="params">(OAuth2AccessToken token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> readAuthentication(token.getValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OAuth2Authentication <span class="title">readAuthentication</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (OAuth2Authentication) <span class="keyword">this</span>.redisTemplate.opsForValue().get(AUTH + token);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OAuth2Authentication <span class="title">readAuthenticationForRefreshToken</span><span class="params">(OAuth2RefreshToken token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> readAuthenticationForRefreshToken(token.getValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OAuth2Authentication <span class="title">readAuthenticationForRefreshToken</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (OAuth2Authentication) <span class="keyword">this</span>.redisTemplate.opsForValue().get(REFRESH_AUTH + token);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeAccessToken</span><span class="params">(OAuth2AccessToken token, OAuth2Authentication authentication)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.opsForValue().set(ACCESS + token.getValue(), token);</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.opsForValue().set(AUTH + token.getValue(), authentication);</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.opsForValue().set(AUTH_TO_ACCESS + authenticationKeyGenerator.extractKey(authentication), token);</span><br><span class="line">        <span class="keyword">if</span> (!authentication.isClientOnly()) &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(UNAME_TO_ACCESS + getApprovalKey(authentication), token);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForList().rightPush(CLIENT_ID_TO_ACCESS + authentication.getOAuth2Request().getClientId(), token);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (token.getExpiration() != <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> seconds = token.getExpiresIn();</span><br><span class="line">            redisTemplate.expire(ACCESS + token.getValue(), seconds, TimeUnit.SECONDS);</span><br><span class="line">            redisTemplate.expire(AUTH + token.getValue(), seconds, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">            redisTemplate.expire(AUTH_TO_ACCESS + authenticationKeyGenerator.extractKey(authentication), seconds, TimeUnit.SECONDS);</span><br><span class="line">            redisTemplate.expire(CLIENT_ID_TO_ACCESS + authentication.getOAuth2Request().getClientId(), seconds, TimeUnit.SECONDS);</span><br><span class="line">            redisTemplate.expire(UNAME_TO_ACCESS + getApprovalKey(authentication), seconds, TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (token.getRefreshToken() != <span class="keyword">null</span> &amp;&amp; token.getRefreshToken().getValue() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.redisTemplate.opsForValue().set(REFRESH_TO_ACCESS + token.getRefreshToken().getValue(), token.getValue());</span><br><span class="line">            <span class="keyword">this</span>.redisTemplate.opsForValue().set(ACCESS_TO_REFRESH + token.getValue(), token.getRefreshToken().getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getApprovalKey</span><span class="params">(OAuth2Authentication authentication)</span> </span>&#123;</span><br><span class="line">        String userName = authentication.getUserAuthentication() == <span class="keyword">null</span> ? <span class="string">""</span> : authentication.getUserAuthentication()</span><br><span class="line">                .getName();</span><br><span class="line">        <span class="keyword">return</span> getApprovalKey(authentication.getOAuth2Request().getClientId(), userName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getApprovalKey</span><span class="params">(String clientId, String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> clientId + (userName == <span class="keyword">null</span> ? <span class="string">""</span> : <span class="string">":"</span> + userName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeAccessToken</span><span class="params">(OAuth2AccessToken accessToken)</span> </span>&#123;</span><br><span class="line">        removeAccessToken(accessToken.getValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OAuth2AccessToken <span class="title">readAccessToken</span><span class="params">(String tokenValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (OAuth2AccessToken) <span class="keyword">this</span>.redisTemplate.opsForValue().get(ACCESS + tokenValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeAccessToken</span><span class="params">(String tokenValue)</span> </span>&#123;</span><br><span class="line">        OAuth2AccessToken removed = (OAuth2AccessToken) redisTemplate.opsForValue().get(ACCESS + tokenValue);</span><br><span class="line">        <span class="comment">// caller to do that</span></span><br><span class="line">        OAuth2Authentication authentication = (OAuth2Authentication) <span class="keyword">this</span>.redisTemplate.opsForValue().get(AUTH + tokenValue);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.delete(AUTH + tokenValue);</span><br><span class="line">        redisTemplate.delete(ACCESS + tokenValue);</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.delete(ACCESS_TO_REFRESH + tokenValue);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (authentication != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.redisTemplate.delete(AUTH_TO_ACCESS + authenticationKeyGenerator.extractKey(authentication));</span><br><span class="line"></span><br><span class="line">            String clientId = authentication.getOAuth2Request().getClientId();</span><br><span class="line">            redisTemplate.opsForList().leftPop(UNAME_TO_ACCESS + getApprovalKey(clientId, authentication.getName()));</span><br><span class="line"></span><br><span class="line">            redisTemplate.opsForList().leftPop(CLIENT_ID_TO_ACCESS + clientId);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.redisTemplate.delete(AUTH_TO_ACCESS + authenticationKeyGenerator.extractKey(authentication));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeRefreshToken</span><span class="params">(OAuth2RefreshToken refreshToken, OAuth2Authentication authentication)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.opsForValue().set(REFRESH + refreshToken.getValue(), refreshToken);</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.opsForValue().set(REFRESH_AUTH + refreshToken.getValue(), authentication);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OAuth2RefreshToken <span class="title">readRefreshToken</span><span class="params">(String tokenValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (OAuth2RefreshToken) <span class="keyword">this</span>.redisTemplate.opsForValue().get(REFRESH + tokenValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeRefreshToken</span><span class="params">(OAuth2RefreshToken refreshToken)</span> </span>&#123;</span><br><span class="line">        removeRefreshToken(refreshToken.getValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeRefreshToken</span><span class="params">(String tokenValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.delete(REFRESH + tokenValue);</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.delete(REFRESH_AUTH + tokenValue);</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.delete(REFRESH_TO_ACCESS + tokenValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeAccessTokenUsingRefreshToken</span><span class="params">(OAuth2RefreshToken refreshToken)</span> </span>&#123;</span><br><span class="line">        removeAccessTokenUsingRefreshToken(refreshToken.getValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeAccessTokenUsingRefreshToken</span><span class="params">(String refreshToken)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String token = (String) <span class="keyword">this</span>.redisTemplate.opsForValue().get(REFRESH_TO_ACCESS + refreshToken);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (token != <span class="keyword">null</span>) &#123;</span><br><span class="line">            redisTemplate.delete(ACCESS + token);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;OAuth2AccessToken&gt; <span class="title">findTokensByClientIdAndUserName</span><span class="params">(String clientId, String userName)</span> </span>&#123;</span><br><span class="line">        List&lt;Object&gt; result = redisTemplate.opsForList().range(UNAME_TO_ACCESS + getApprovalKey(clientId, userName), <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="keyword">null</span> || result.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptySet();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;OAuth2AccessToken&gt; accessTokens = <span class="keyword">new</span> ArrayList&lt;&gt;(result.size());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;Object&gt; it = result.iterator(); it.hasNext(); ) &#123;</span><br><span class="line">            OAuth2AccessToken accessToken = (OAuth2AccessToken) it.next();</span><br><span class="line">            accessTokens.add(accessToken);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableCollection(accessTokens);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;OAuth2AccessToken&gt; <span class="title">findTokensByClientId</span><span class="params">(String clientId)</span> </span>&#123;</span><br><span class="line">        List&lt;Object&gt; result = redisTemplate.opsForList().range((CLIENT_ID_TO_ACCESS + clientId), <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="keyword">null</span> || result.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptySet();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;OAuth2AccessToken&gt; accessTokens = <span class="keyword">new</span> ArrayList&lt;&gt;(result.size());</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;Object&gt; it = result.iterator(); it.hasNext(); ) &#123;</span><br><span class="line">            OAuth2AccessToken accessToken = (OAuth2AccessToken) it.next();</span><br><span class="line">            accessTokens.add(accessToken);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableCollection(accessTokens);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æœåŠ¡ç½‘å…³æ¨¡å—"><a href="#æœåŠ¡ç½‘å…³æ¨¡å—" class="headerlink" title="æœåŠ¡ç½‘å…³æ¨¡å—"></a>æœåŠ¡ç½‘å…³æ¨¡å—</h1><p>ç½‘å…³ä¸»ä½“åœ¨åŒ…<code>pig\pig-gateway\src\main\java\com\github\pig\gateway</code>ä¸‹</p><p><img src="/2018/12/12/å†·å†·Pigå¼€æºé¡¹ç›®å­¦ä¹ /1.png" alt="æœåŠ¡ç½‘å…³"></p><p>ä½œè€…ä½¿ç”¨äº†Zuulåšä¸ºç½‘å…³ï¼Œå®ƒNetflixå¼€æºçš„å¾®æœåŠ¡ç½‘å…³ï¼Œå¯ä»¥å’ŒEureka,Ribbon,Hystrixç­‰ç»„ä»¶é…åˆä½¿ç”¨ã€‚</p><p>Zuulç»„ä»¶çš„æ ¸å¿ƒæ˜¯ä¸€ç³»åˆ—çš„è¿‡æ»¤å™¨ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯ä»¥å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li><p>èº«ä»½è®¤è¯å’Œå®‰å…¨: è¯†åˆ«æ¯ä¸€ä¸ªèµ„æºçš„éªŒè¯è¦æ±‚ï¼Œå¹¶æ‹’ç»é‚£äº›ä¸ç¬¦çš„è¯·æ±‚</p></li><li><p>å®¡æŸ¥ä¸ç›‘æ§ï¼š</p></li><li><p>åŠ¨æ€è·¯ç”±ï¼šåŠ¨æ€å°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒåç«¯é›†ç¾¤</p></li><li><p>å‹åŠ›æµ‹è¯•ï¼šé€æ¸å¢åŠ æŒ‡å‘é›†ç¾¤çš„æµé‡ï¼Œä»¥äº†è§£æ€§èƒ½</p></li><li><p>è´Ÿè½½åˆ†é…ï¼šä¸ºæ¯ä¸€ç§è´Ÿè½½ç±»å‹åˆ†é…å¯¹åº”å®¹é‡ï¼Œå¹¶å¼ƒç”¨è¶…å‡ºé™å®šå€¼çš„è¯·æ±‚</p></li><li><p>é™æ€å“åº”å¤„ç†ï¼šè¾¹ç¼˜ä½ç½®è¿›è¡Œå“åº”ï¼Œé¿å…è½¬å‘åˆ°å†…éƒ¨é›†ç¾¤</p></li><li><p>å¤šåŒºåŸŸå¼¹æ€§ï¼šè·¨åŸŸAWS Regionè¿›è¡Œè¯·æ±‚è·¯ç”±ï¼Œæ—¨åœ¨å®ç°ELB(ElasticLoad Balancing)ä½¿ç”¨å¤šæ ·åŒ–</p></li></ul><h2 id="å¤šç§åŠŸèƒ½çš„è¿‡æ»¤å™¨è¿‡æ»¤å™¨"><a href="#å¤šç§åŠŸèƒ½çš„è¿‡æ»¤å™¨è¿‡æ»¤å™¨" class="headerlink" title="å¤šç§åŠŸèƒ½çš„è¿‡æ»¤å™¨è¿‡æ»¤å™¨"></a>å¤šç§åŠŸèƒ½çš„è¿‡æ»¤å™¨è¿‡æ»¤å™¨</h2><p>Zuulç»„ä»¶çš„æ ¸å¿ƒæ˜¯ä¸€ç³»åˆ—çš„è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬å…ˆä»è¿‡æ»¤å™¨ä¸‹æ‰‹ã€‚</p><h3 id="ç½‘å…³ç»Ÿä¸€å¼‚å¸¸è¿‡æ»¤å™¨"><a href="#ç½‘å…³ç»Ÿä¸€å¼‚å¸¸è¿‡æ»¤å™¨" class="headerlink" title="ç½‘å…³ç»Ÿä¸€å¼‚å¸¸è¿‡æ»¤å™¨"></a>ç½‘å…³ç»Ÿä¸€å¼‚å¸¸è¿‡æ»¤å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorHandlerFilter</span> <span class="keyword">extends</span> <span class="title">ZuulFilter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LogSendService logSendService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">filterType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ERROR_TYPE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">filterOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SEND_RESPONSE_FILTER_ORDER + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RequestContext requestContext = RequestContext.getCurrentContext();</span><br><span class="line">        <span class="keyword">return</span> requestContext.getThrowable() != <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RequestContext requestContext = RequestContext.getCurrentContext();</span><br><span class="line">        logSendService.send(requestContext);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½œè€…ä»¥åŸç”Ÿzuulè¿‡æ»¤å™¨ä¸ºåŸºç¡€åŠ äº†æ—¥å¿—é…ç½®,ä¼˜å…ˆçº§ä¸º+1ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šä½ã€‚</p><h3 id="XSSè¿‡æ»¤å™¨"><a href="#XSSè¿‡æ»¤å™¨" class="headerlink" title="XSSè¿‡æ»¤å™¨"></a>XSSè¿‡æ»¤å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XssSecurityFilter</span> <span class="keyword">extends</span> <span class="title">OncePerRequestFilter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        XssHttpServletRequestWrapper xssRequest = <span class="keyword">new</span> XssHttpServletRequestWrapper(request);</span><br><span class="line">        filterChain.doFilter(xssRequest, response);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é‡å†™springMVCé‡Œé¢çš„çš„ç¡®ä¿åœ¨ä¸€æ¬¡è¯·æ±‚åªé€šè¿‡ä¸€æ¬¡filterçš„ç±»<code>OncePerRequestFilter</code>ï¼Œæ·»åŠ ä¸€æ¡<a href="https://gitee.com/renrenio/renren-fastçš„å·¥å…·ç±»`XssHttpServletRequestWrapper`ä¸ºè¿‡æ»¤é“¾æ¡ã€‚" target="_blank" rel="noopener">https://gitee.com/renrenio/renren-fastçš„å·¥å…·ç±»`XssHttpServletRequestWrapper`ä¸ºè¿‡æ»¤é“¾æ¡ã€‚</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletInputStream <span class="title">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">Â·Â·Â·Â·ç•¥</span><br><span class="line">        <span class="comment">//xssè¿‡æ»¤</span></span><br><span class="line">        json = xssEncode(json);</span><br><span class="line">        <span class="keyword">final</span> ByteArrayInputStream bis = <span class="keyword">new</span> ByteArrayInputStream(json.getBytes(<span class="string">"utf-8"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServletInputStream() &#123;</span><br><span class="line">Â·Â·Â·ç•¥</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="å¯†ç è¿‡æ»¤å™¨DecodePasswordFilter"><a href="#å¯†ç è¿‡æ»¤å™¨DecodePasswordFilter" class="headerlink" title="å¯†ç è¿‡æ»¤å™¨DecodePasswordFilter"></a>å¯†ç è¿‡æ»¤å™¨DecodePasswordFilter</h3><p>æ­¤è¿‡æ»¤å™¨ä¼˜å…ˆçº§ä¸º+2.æ¯å½“ä¸€ä¸ªè¯·æ±‚ä¸æ˜¯è¯·æ±‚<code>/oauth/token</code>æˆ–è€…<code>/mobile/token</code>è¿™ä¸ªåœ°å€æ—¶ï¼Œéƒ½ä¼šè§£æä½¿ç”¨aesè§£ç å™¨<code>password</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RequestContext ctx = RequestContext.getCurrentContext();</span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; params = ctx.getRequestQueryParams();</span><br><span class="line">        <span class="keyword">if</span> (params == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; passList = params.get(PASSWORD);</span><br><span class="line">        <span class="keyword">if</span> (CollUtil.isEmpty(passList)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String password = passList.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isNotBlank(password)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                password = decryptAES(password, key);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">"å¯†ç è§£å¯†å¤±è´¥:&#123;&#125;"</span>, password);</span><br><span class="line">            &#125;</span><br><span class="line">            params.put(PASSWORD, CollUtil.newArrayList(password.trim()));</span><br><span class="line">        &#125;</span><br><span class="line">        ctx.setRequestQueryParams(params);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æ ¡éªŒç è¿‡æ»¤å™¨ValidateCodeFilter"><a href="#æ ¡éªŒç è¿‡æ»¤å™¨ValidateCodeFilter" class="headerlink" title="æ ¡éªŒç è¿‡æ»¤å™¨ValidateCodeFilter"></a>æ ¡éªŒç è¿‡æ»¤å™¨ValidateCodeFilter</h3><p>é€»è¾‘ä½œè€…éƒ½å†™åœ¨æ³¨é‡Šä¸­äº†ï¼Œæ­¤å¤„ä½¿ç”¨äº†redisåšä¸ºæœåŠ¡ç«¯éªŒè¯ç çš„ç¼“å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">**</span><br><span class="line">     * æ˜¯å¦æ ¡éªŒéªŒè¯ç </span><br><span class="line">     * <span class="number">1</span>. åˆ¤æ–­éªŒè¯ç å¼€å…³æ˜¯å¦å¼€å¯</span><br><span class="line">     * <span class="number">2</span>. åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç™»å½•è¯·æ±‚</span><br><span class="line">     * <span class="number">2.1</span> åˆ¤æ–­æ˜¯ä¸æ˜¯åˆ·æ–°è¯·æ±‚(ä¸ç”¨å•ç‹¬åœ¨å»ºç«‹åˆ·æ–°å®¢æˆ·ç«¯)</span><br><span class="line">     * <span class="number">3</span>. åˆ¤æ–­ç»ˆç«¯æ˜¯å¦æ”¯æŒ</span><br><span class="line">     *</span><br><span class="line">     * <span class="meta">@return</span> <span class="keyword">true</span>/<span class="keyword">false</span></span><br><span class="line">     */</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HttpServletRequest request = RequestContext.getCurrentContext().getRequest();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!StrUtil.containsAnyIgnoreCase(request.getRequestURI(),</span><br><span class="line">                SecurityConstants.OAUTH_TOKEN_URL, SecurityConstants.MOBILE_TOKEN_URL)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (SecurityConstants.REFRESH_TOKEN.equals(request.getParameter(GRANT_TYPE))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String[] clientInfos = AuthUtils.extractAndDecodeHeader(request);</span><br><span class="line">            <span class="keyword">if</span> (CollUtil.containsAny(filterIgnorePropertiesConfig.getClients(), Arrays.asList(clientInfos))) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">"è§£æç»ˆç«¯ä¿¡æ¯å¤±è´¥"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            checkCode(RequestContext.getCurrentContext().getRequest());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ValidateCodeException e) &#123;</span><br><span class="line">            RequestContext ctx = RequestContext.getCurrentContext();</span><br><span class="line">            R&lt;String&gt; result = <span class="keyword">new</span> R&lt;&gt;(e);</span><br><span class="line">            result.setCode(<span class="number">478</span>);</span><br><span class="line"></span><br><span class="line">            ctx.setResponseStatusCode(<span class="number">478</span>);</span><br><span class="line">            ctx.setSendZuulResponse(<span class="keyword">false</span>);</span><br><span class="line">            ctx.getResponse().setContentType(<span class="string">"application/json;charset=UTF-8"</span>);</span><br><span class="line">            ctx.setResponseBody(JSONObject.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥code</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletRequest request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ValidateCodeException éªŒè¯ç æ ¡éªŒå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkCode</span><span class="params">(HttpServletRequest httpServletRequest)</span> <span class="keyword">throws</span> ValidateCodeException </span>&#123;</span><br><span class="line">        String code = httpServletRequest.getParameter(<span class="string">"code"</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(code)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ValidateCodeException(<span class="string">"è¯·è¾“å…¥éªŒè¯ç "</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String randomStr = httpServletRequest.getParameter(<span class="string">"randomStr"</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(randomStr)) &#123;</span><br><span class="line">            randomStr = httpServletRequest.getParameter(<span class="string">"mobile"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String key = SecurityConstants.DEFAULT_CODE_KEY + randomStr;</span><br><span class="line">        <span class="keyword">if</span> (!redisTemplate.hasKey(key)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ValidateCodeException(EXPIRED_CAPTCHA_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Object codeObj = redisTemplate.opsForValue().get(key);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (codeObj == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ValidateCodeException(EXPIRED_CAPTCHA_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String saveCode = codeObj.toString();</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(saveCode)) &#123;</span><br><span class="line">            redisTemplate.delete(key);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ValidateCodeException(EXPIRED_CAPTCHA_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!StrUtil.equals(saveCode, code)) &#123;</span><br><span class="line">            redisTemplate.delete(key);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ValidateCodeException(<span class="string">"éªŒè¯ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        redisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="ç°åº¦å‘å¸ƒ"><a href="#ç°åº¦å‘å¸ƒ" class="headerlink" title="ç°åº¦å‘å¸ƒ"></a>ç°åº¦å‘å¸ƒ</h2><p>ç°åº¦å‘å¸ƒï¼Œå·²ç»ä¸æ˜¯ä¸€ä¸ªå¾ˆæ–°çš„æ¦‚å¿µäº†ï¼ä¸€ä¸ªäº§å“ï¼Œå¦‚æœéœ€è¦å¿«é€Ÿè¿­ä»£å¼€å‘ä¸Šçº¿ï¼Œåˆè¦ä¿è¯è´¨é‡ï¼Œä¿è¯åˆšä¸Šçº¿çš„ç³»ç»Ÿï¼Œä¸€æ—¦å‡ºç°é—®é¢˜é‚£ä¹ˆå¯ä»¥å¾ˆå¿«çš„æ§åˆ¶å½±å“é¢ï¼Œå°±éœ€è¦è®¾è®¡ä¸€å¥—ç°åº¦å‘å¸ƒç³»ç»Ÿï¼</p><p>ç°åº¦å‘å¸ƒç³»ç»Ÿçš„ä½œç”¨åœ¨äºï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„é…ç½®ï¼Œæ¥å°†ç”¨æˆ·çš„æµé‡å¯¼åˆ°æ–°ä¸Šçº¿çš„ç³»ç»Ÿä¸Šï¼Œæ¥å¿«é€ŸéªŒè¯æ–°çš„åŠŸèƒ½ä¿®æ”¹ï¼Œè€Œä¸€æ—¦å‡ºé—®é¢˜ï¼Œä¹Ÿå¯ä»¥é©¬ä¸Šçš„æ¢å¤ï¼Œç®€å•çš„è¯´ï¼Œå°±æ˜¯ä¸€å¥—A/BTestç³»ç»Ÿï¼</p><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>ä¸‹é¢æ˜¯ç°åº¦è·¯ç”±åˆå§‹åŒ–ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(DiscoveryEnabledNIWSServerList.class)</span><br><span class="line"><span class="meta">@AutoConfigureBefore</span>(RibbonClientConfiguration.class)</span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(value = <span class="string">"zuul.ribbon.metadata.enabled"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RibbonMetaFilterAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="meta">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ZoneAvoidanceRule <span class="title">metadataAwareRule</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MetadataCanaryRuleHandler();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç°åº¦å‘å¸ƒæœ‰å…³è¿‡æ»¤å™¨AccessFilter"><a href="#ç°åº¦å‘å¸ƒæœ‰å…³è¿‡æ»¤å™¨AccessFilter" class="headerlink" title="ç°åº¦å‘å¸ƒæœ‰å…³è¿‡æ»¤å™¨AccessFilter"></a>ç°åº¦å‘å¸ƒæœ‰å…³è¿‡æ»¤å™¨AccessFilter</h3><p>é¦–å…ˆé‡å†™<code>filterOrder()</code>æ–¹æ³•ï¼Œä½¿è¿™ä¸ªè¿‡æ»¤å™¨åœ¨<code>åœ¨RateLimitPreFilter</code>ä¹‹å‰è¿è¡Œï¼Œä¸ä¼šå‡ºç°ç©ºæŒ‡é’ˆé—®é¢˜ã€‚æ­¤å¤„ä¼˜å…ˆçº§<code>FORM_BODY_WRAPPER_FILTER_ORDER-1</code>.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccessFilter</span> <span class="keyword">extends</span> <span class="title">ZuulFilter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;zuul.ribbon.metadata.enabled:false&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> canary;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">filterType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> FilterConstants.PRE_TYPE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">filterOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> FORM_BODY_WRAPPER_FILTER_ORDER - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RequestContext requestContext = RequestContext.getCurrentContext();</span><br><span class="line">        String version = requestContext.getRequest().getHeader(SecurityConstants.VERSION);</span><br><span class="line">        <span class="keyword">if</span> (canary &amp;&amp; StrUtil.isNotBlank(version)) &#123;</span><br><span class="line">            RibbonVersionHolder.setContext(version);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        requestContext.set(<span class="string">"startTime"</span>, System.currentTimeMillis());</span><br><span class="line">        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="keyword">if</span> (authentication != <span class="keyword">null</span>) &#123;</span><br><span class="line">            requestContext.addZuulRequestHeader(SecurityConstants.USER_HEADER, authentication.getName());</span><br><span class="line">            requestContext.addZuulRequestHeader(SecurityConstants.ROLE_HEADER, CollectionUtil.join(authentication.getAuthorities(), <span class="string">","</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ–¹æ³•åœ¨run()ä¸Šï¼Œé¦–å…ˆå—åˆ°requestè¯·æ±‚ï¼Œæ‹¿åˆ°ä»–çš„ç‰ˆæœ¬çº¦æŸä¿¡æ¯ï¼Œç„¶åæ ¹æ®é€‰æ‹©æ·»åŠ token</p><h3 id="è·¯ç”±å¾®æœåŠ¡æ–­è¨€å¤„ç†å™¨MetadataCanaryRuleHandler"><a href="#è·¯ç”±å¾®æœåŠ¡æ–­è¨€å¤„ç†å™¨MetadataCanaryRuleHandler" class="headerlink" title="è·¯ç”±å¾®æœåŠ¡æ–­è¨€å¤„ç†å™¨MetadataCanaryRuleHandler"></a>è·¯ç”±å¾®æœåŠ¡æ–­è¨€å¤„ç†å™¨MetadataCanaryRuleHandler</h3><p>è‡ªå®šä¹‰<code>ribbon</code>è·¯ç”±è§„åˆ™åŒ¹é…å¤šç‰ˆæœ¬è¯·æ±‚ï¼Œå®ç°<strong>ç°åº¦å‘å¸ƒ</strong>ã€‚å¤åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§é€‰æ‹©serverï¼Œå³ï¼Œä½¿ç”¨ZoneAvoidancePredicateå’ŒAvailabilityPredicateæ¥åˆ¤æ–­æ˜¯å¦é€‰æ‹©æŸä¸ªserverï¼Œå‰ä¸€ä¸ªåˆ¤æ–­åˆ¤å®šä¸€ä¸ªzoneçš„è¿è¡Œæ€§èƒ½æ˜¯å¦å¯ç”¨ï¼Œå‰”é™¤ä¸å¯ç”¨çš„zoneï¼ˆçš„æ‰€æœ‰serverï¼‰ï¼ŒAvailabilityPredicateç”¨äºè¿‡æ»¤æ‰è¿æ¥æ•°è¿‡å¤šçš„Serverã€‚</p><p>æ­¤å¤„é€»è¾‘æ˜¯</p><ol><li>eureka metadata ï¼ˆä¸»æœºåï¼ŒIPåœ°å€ï¼Œç«¯å£å·ï¼ŒçŠ¶æ€é¡µå¥åº·æ£€æŸ¥ç­‰ä¿¡æ¯ï¼Œæˆ–è€…é€šè¿‡é…ç½®æ–‡ä»¶è‡ªå®šä¹‰å…ƒæ•°æ®ï¼‰å­˜åœ¨ç‰ˆæœ¬å®šä¹‰æ—¶å€™è¿›è¡Œåˆ¤æ–­ </li><li>ä¸å­˜åœ¨ metadata ç›´æ¥è¿”å›true</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AbstractServerPredicate <span class="title">getPredicate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AbstractServerPredicate() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">apply</span><span class="params">(PredicateKey predicateKey)</span> </span>&#123;</span><br><span class="line">                String targetVersion = RibbonVersionHolder.getContext();</span><br><span class="line">                RibbonVersionHolder.clearContext();</span><br><span class="line">                <span class="keyword">if</span> (StrUtil.isBlank(targetVersion)) &#123;</span><br><span class="line">                    log.debug(<span class="string">"å®¢æˆ·ç«¯æœªé…ç½®ç›®æ ‡ç‰ˆæœ¬ç›´æ¥è·¯ç”±"</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                DiscoveryEnabledServer server = (DiscoveryEnabledServer) predicateKey.getServer();</span><br><span class="line">                <span class="keyword">final</span> Map&lt;String, String&gt; metadata = server.getInstanceInfo().getMetadata();</span><br><span class="line">                <span class="keyword">if</span> (StrUtil.isBlank(metadata.get(SecurityConstants.VERSION))) &#123;</span><br><span class="line">                    log.debug(<span class="string">"å½“å‰å¾®æœåŠ¡&#123;&#125; æœªé…ç½®ç‰ˆæœ¬ç›´æ¥è·¯ç”±"</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (metadata.get(SecurityConstants.VERSION).equals(targetVersion)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    log.debug(<span class="string">"å½“å‰å¾®æœåŠ¡&#123;&#125; ç‰ˆæœ¬ä¸º&#123;&#125;ï¼Œç›®æ ‡ç‰ˆæœ¬&#123;&#125; åŒ¹é…å¤±è´¥"</span>, server.getInstanceInfo().getAppName()</span><br><span class="line">                            , metadata.get(SecurityConstants.VERSION), targetVersion);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€è·¯ç”±"><a href="#åŠ¨æ€è·¯ç”±" class="headerlink" title="åŠ¨æ€è·¯ç”±"></a>åŠ¨æ€è·¯ç”±</h2><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicRouteLocator</span> <span class="keyword">extends</span> <span class="title">DiscoveryClientRouteLocator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ZuulProperties properties;</span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DynamicRouteLocator</span><span class="params">(String servletPath, DiscoveryClient discovery, ZuulProperties properties,</span></span></span><br><span class="line"><span class="function"><span class="params">                               ServiceInstance localServiceInstance, RedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(servletPath, discovery, properties, localServiceInstance);</span><br><span class="line">        <span class="keyword">this</span>.properties = properties;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡å†™è·¯ç”±é…ç½®</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 1. properties é…ç½®ã€‚</span></span><br><span class="line"><span class="comment">     * 2. eureka é»˜è®¤é…ç½®ã€‚</span></span><br><span class="line"><span class="comment">     * 3. DBæ•°æ®åº“é…ç½®ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è·¯ç”±è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> LinkedHashMap&lt;String, ZuulProperties.ZuulRoute&gt; locateRoutes() &#123;</span><br><span class="line">        LinkedHashMap&lt;String, ZuulProperties.ZuulRoute&gt; routesMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¯»å–propertiesé…ç½®ã€eurekaé»˜è®¤é…ç½®</span></span><br><span class="line">        routesMap.putAll(<span class="keyword">super</span>.locateRoutes());</span><br><span class="line">        log.debug(<span class="string">"åˆå§‹é»˜è®¤çš„è·¯ç”±é…ç½®å®Œæˆ"</span>);</span><br><span class="line">        routesMap.putAll(locateRoutesFromDb());</span><br><span class="line">        LinkedHashMap&lt;String, ZuulProperties.ZuulRoute&gt; values = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, ZuulProperties.ZuulRoute&gt; entry : routesMap.entrySet()) &#123;</span><br><span class="line">            String path = entry.getKey();</span><br><span class="line">            <span class="keyword">if</span> (!path.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">                path = <span class="string">"/"</span> + path;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (StrUtil.isNotBlank(<span class="keyword">this</span>.properties.getPrefix())) &#123;</span><br><span class="line">                path = <span class="keyword">this</span>.properties.getPrefix() + path;</span><br><span class="line">                <span class="keyword">if</span> (!path.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">                    path = <span class="string">"/"</span> + path;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            values.put(path, entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> values;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Redisä¸­ä¿å­˜çš„ï¼Œæ²¡æœ‰ä»upmsæ‹‰å»ï¼Œé¿å…å¯åŠ¨é“¾è·¯ä¾èµ–é—®é¢˜ï¼ˆå–èˆï¼‰ï¼Œç½‘å…³ä¾èµ–ä¸šåŠ¡æ¨¡å—çš„é—®é¢˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, ZuulProperties.ZuulRoute&gt; locateRoutesFromDb() &#123;</span><br><span class="line">        Map&lt;String, ZuulProperties.ZuulRoute&gt; routes = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        Object obj = redisTemplate.opsForValue().get(CommonConstant.ROUTE_KEY);</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> routes;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;SysZuulRoute&gt; results = (List&lt;SysZuulRoute&gt;) obj;</span><br><span class="line">        <span class="keyword">for</span> (SysZuulRoute result : results) &#123;</span><br><span class="line">            <span class="keyword">if</span> (StrUtil.isBlank(result.getPath()) &amp;&amp; StrUtil.isBlank(result.getUrl())) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ZuulProperties.ZuulRoute zuulRoute = <span class="keyword">new</span> ZuulProperties.ZuulRoute();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                zuulRoute.setId(result.getServiceId());</span><br><span class="line">                zuulRoute.setPath(result.getPath());</span><br><span class="line">                zuulRoute.setServiceId(result.getServiceId());</span><br><span class="line">                zuulRoute.setRetryable(StrUtil.equals(result.getRetryable(), <span class="string">"0"</span>) ? Boolean.FALSE : Boolean.TRUE);</span><br><span class="line">                zuulRoute.setStripPrefix(StrUtil.equals(result.getStripPrefix(), <span class="string">"0"</span>) ? Boolean.FALSE : Boolean.TRUE);</span><br><span class="line">                zuulRoute.setUrl(result.getUrl());</span><br><span class="line">                List&lt;String&gt; sensitiveHeadersList = StrUtil.splitTrim(result.getSensitiveheadersList(), <span class="string">","</span>);</span><br><span class="line">                <span class="keyword">if</span> (sensitiveHeadersList != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    Set&lt;String&gt; sensitiveHeaderSet = CollUtil.newHashSet();</span><br><span class="line">                    sensitiveHeadersList.forEach(sensitiveHeader -&gt; sensitiveHeaderSet.add(sensitiveHeader));</span><br><span class="line">                    zuulRoute.setSensitiveHeaders(sensitiveHeaderSet);</span><br><span class="line">                    zuulRoute.setCustomSensitiveHeaders(<span class="keyword">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">"ä»æ•°æ®åº“åŠ è½½è·¯ç”±é…ç½®å¼‚å¸¸"</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">            log.debug(<span class="string">"æ·»åŠ æ•°æ®åº“è‡ªå®šä¹‰çš„è·¯ç”±é…ç½®,pathï¼š&#123;&#125;ï¼ŒserviceId:&#123;&#125;"</span>, zuulRoute.getPath(), zuulRoute.getServiceId());</span><br><span class="line">            routes.put(zuulRoute.getPath(), zuulRoute);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> routes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç½‘å…³æ—¥å¿—å¤„ç†"><a href="#ç½‘å…³æ—¥å¿—å¤„ç†" class="headerlink" title="ç½‘å…³æ—¥å¿—å¤„ç†"></a>ç½‘å…³æ—¥å¿—å¤„ç†</h2><p>ä»£ç æ³¨é‡Šå·²ç»å°†é€»è¾‘å†™çš„å¾ˆæ¸…æ¥šäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogSendServiceImpl</span> <span class="keyword">implements</span> <span class="title">LogSendService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SERVICE_ID = <span class="string">"serviceId"</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AmqpTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. è·å– requestContext ä¸­çš„è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * 2. å¦‚æœè¿”å›çŠ¶æ€ä¸æ˜¯OKï¼Œåˆ™è·å–è¿”å›ä¿¡æ¯ä¸­çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * 3. å‘é€åˆ°MQ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestContext ä¸Šä¸‹æ–‡å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(RequestContext requestContext)</span> </span>&#123;</span><br><span class="line">        HttpServletRequest request = requestContext.getRequest();</span><br><span class="line">        String requestUri = request.getRequestURI();</span><br><span class="line">        String method = request.getMethod();</span><br><span class="line">        SysLog sysLog = <span class="keyword">new</span> SysLog();</span><br><span class="line">        sysLog.setType(CommonConstant.STATUS_NORMAL);</span><br><span class="line">        sysLog.setRemoteAddr(HttpUtil.getClientIP(request));</span><br><span class="line">        sysLog.setRequestUri(URLUtil.getPath(requestUri));</span><br><span class="line">        sysLog.setMethod(method);</span><br><span class="line">        sysLog.setUserAgent(request.getHeader(<span class="string">"user-agent"</span>));</span><br><span class="line">        sysLog.setParams(HttpUtil.toParams(request.getParameterMap()));</span><br><span class="line">        Long startTime = (Long) requestContext.get(<span class="string">"startTime"</span>);</span><br><span class="line">        sysLog.setTime(System.currentTimeMillis() - startTime);</span><br><span class="line">        <span class="keyword">if</span> (requestContext.get(SERVICE_ID) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            sysLog.setServiceId(requestContext.get(SERVICE_ID).toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ­£å¸¸å‘é€æœåŠ¡å¼‚å¸¸è§£æ</span></span><br><span class="line">        <span class="keyword">if</span> (requestContext.getResponseStatusCode() == HttpStatus.SC_INTERNAL_SERVER_ERROR</span><br><span class="line">                &amp;&amp; requestContext.getResponseDataStream() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            InputStream inputStream = requestContext.getResponseDataStream();</span><br><span class="line">            ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">            InputStream stream1 = <span class="keyword">null</span>;</span><br><span class="line">            InputStream stream2;</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = IoUtil.readBytes(inputStream);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                baos.write(buffer);</span><br><span class="line">                baos.flush();</span><br><span class="line">                stream1 = <span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray());</span><br><span class="line">                stream2 = <span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray());</span><br><span class="line">                String resp = IoUtil.read(stream1, CommonConstant.UTF8);</span><br><span class="line">                sysLog.setType(CommonConstant.STATUS_LOCK);</span><br><span class="line">                sysLog.setException(resp);</span><br><span class="line">                requestContext.setResponseDataStream(stream2);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                log.error(<span class="string">"å“åº”æµè§£æå¼‚å¸¸ï¼š"</span>, e);</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                IoUtil.close(stream1);</span><br><span class="line">                IoUtil.close(baos);</span><br><span class="line">                IoUtil.close(inputStream);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç½‘å…³å†…éƒ¨å¼‚å¸¸</span></span><br><span class="line">        Throwable throwable = requestContext.getThrowable();</span><br><span class="line">        <span class="keyword">if</span> (throwable != <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.error(<span class="string">"ç½‘å…³å¼‚å¸¸"</span>, throwable);</span><br><span class="line">            sysLog.setException(throwable.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ä¿å­˜å‘å¾€MQï¼ˆåªä¿å­˜æˆæƒï¼‰</span></span><br><span class="line">        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="keyword">if</span> (authentication != <span class="keyword">null</span> &amp;&amp; StrUtil.isNotBlank(authentication.getName())) &#123;</span><br><span class="line">            LogVO logVo = <span class="keyword">new</span> LogVO();</span><br><span class="line">            sysLog.setCreateBy(authentication.getName());</span><br><span class="line">            logVo.setSysLog(sysLog);</span><br><span class="line">            logVo.setUsername(authentication.getName());</span><br><span class="line">            rabbitTemplate.convertAndSend(MqQueueConstant.LOG_QUEUE, logVo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤šç»´åº¦é™æµ"><a href="#å¤šç»´åº¦é™æµ" class="headerlink" title="å¤šç»´åº¦é™æµ"></a>å¤šç»´åº¦é™æµ</h2><h3 id="é™æµé™çº§å¤„ç†å™¨ZuulRateLimiterErrorHandler"><a href="#é™æµé™çº§å¤„ç†å™¨ZuulRateLimiterErrorHandler" class="headerlink" title="é™æµé™çº§å¤„ç†å™¨ZuulRateLimiterErrorHandler"></a>é™æµé™çº§å¤„ç†å™¨ZuulRateLimiterErrorHandler</h3><p>é‡å†™zuulä¸­é»˜è®¤çš„é™æµå¤„ç†å™¨<code>DefaultRateLimiterErrorHandler</code>ï¼Œä½¿ä¹‹è®°å½•æ—¥å¿—å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RateLimiterErrorHandler <span class="title">rateLimitErrorHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultRateLimiterErrorHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleSaveError</span><span class="params">(String key, Exception e)</span> </span>&#123;</span><br><span class="line">                log.error(<span class="string">"ä¿å­˜key:[&#123;&#125;]å¼‚å¸¸"</span>, key, e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleFetchError</span><span class="params">(String key, Exception e)</span> </span>&#123;</span><br><span class="line">                log.error(<span class="string">"è·¯ç”±å¤±è´¥:[&#123;&#125;]å¼‚å¸¸"</span>, key);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleError</span><span class="params">(String msg, Exception e)</span> </span>&#123;</span><br><span class="line">                log.error(<span class="string">"é™æµå¼‚å¸¸:[&#123;&#125;]"</span>, msg, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸spring-security-oAuthæ–¹æ³•æ•´åˆå•ç‚¹ç™»é™†"><a href="#ä¸spring-security-oAuthæ–¹æ³•æ•´åˆå•ç‚¹ç™»é™†" class="headerlink" title="ä¸spring security oAuthæ–¹æ³•æ•´åˆå•ç‚¹ç™»é™†"></a>ä¸spring security oAuthæ–¹æ³•æ•´åˆå•ç‚¹ç™»é™†</h2><h3 id="æˆæƒæ‹’ç»å¤„ç†å™¨-PigAccessDeniedHandler"><a href="#æˆæƒæ‹’ç»å¤„ç†å™¨-PigAccessDeniedHandler" class="headerlink" title="æˆæƒæ‹’ç»å¤„ç†å™¨ PigAccessDeniedHandler"></a>æˆæƒæ‹’ç»å¤„ç†å™¨ PigAccessDeniedHandler</h3><p>é‡å†™<code>Srping security oAuth</code> æä¾›å•ç‚¹ç™»å½•éªŒè¯æ‹’ç»<code>OAuth2AccessDeniedHandler</code>æ¥å£ï¼Œä½¿ç”¨RåŒ…è£…å¤±è´¥ä¿¡æ¯åˆ°<code>PigDeniedException</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AccessDeniedException authException)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        log.info(<span class="string">"æˆæƒå¤±è´¥ï¼Œç¦æ­¢è®¿é—® &#123;&#125;"</span>, request.getRequestURI());</span><br><span class="line">        response.setCharacterEncoding(CommonConstant.UTF8);</span><br><span class="line">        response.setContentType(CommonConstant.CONTENT_TYPE);</span><br><span class="line">        R&lt;String&gt; result = <span class="keyword">new</span> R&lt;&gt;(<span class="keyword">new</span> PigDeniedException(<span class="string">"æˆæƒå¤±è´¥ï¼Œç¦æ­¢è®¿é—®"</span>));</span><br><span class="line">        response.setStatus(HttpStatus.SC_FORBIDDEN);</span><br><span class="line">        PrintWriter printWriter = response.getWriter();</span><br><span class="line">        printWriter.append(objectMapper.writeValueAsString(result));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="èœå•ç®¡ç†"><a href="#èœå•ç®¡ç†" class="headerlink" title="èœå•ç®¡ç†"></a>èœå•ç®¡ç†</h2><h3 id="MenuService"><a href="#MenuService" class="headerlink" title="MenuService"></a>MenuService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(name = <span class="string">"pig-upms-service"</span>, fallback = MenuServiceFallbackImpl.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MenuService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡è§’è‰²åæŸ¥è¯¢èœå•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> role è§’è‰²åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> èœå•åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/menu/findMenuByRole/&#123;role&#125;"</span>)</span><br><span class="line">    <span class="function">Set&lt;MenuVO&gt; <span class="title">findMenuByRole</span><span class="params">(@PathVariable(<span class="string">"role"</span>)</span> String role)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨feignè¿æ¥pigç³»ç»Ÿçš„èœå•å¾®æœåŠ¡</p><h4 id="èœå•æƒé™"><a href="#èœå•æƒé™" class="headerlink" title="èœå•æƒé™"></a>èœå•æƒé™</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"permissionService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionServiceImpl</span> <span class="keyword">implements</span> <span class="title">PermissionService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MenuService menuService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AntPathMatcher antPathMatcher = <span class="keyword">new</span> AntPathMatcher();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPermission</span><span class="params">(HttpServletRequest request, Authentication authentication)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ele-admin options è·¨åŸŸé…ç½®ï¼Œç°åœ¨å¤„ç†æ˜¯é€šè¿‡å‰ç«¯é…ç½®ä»£ç†ï¼Œä¸ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå­˜åœ¨é£é™©</span></span><br><span class="line"><span class="comment">//        if (HttpMethod.OPTIONS.name().equalsIgnoreCase(request.getMethod())) &#123;</span></span><br><span class="line"><span class="comment">//            return true;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        Object principal = authentication.getPrincipal();</span><br><span class="line">        List&lt;SimpleGrantedAuthority&gt; authorityList = (List&lt;SimpleGrantedAuthority&gt;) authentication.getAuthorities();</span><br><span class="line">        AtomicBoolean hasPermission = <span class="keyword">new</span> AtomicBoolean(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (principal != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (CollUtil.isEmpty(authorityList)) &#123;</span><br><span class="line">                log.warn(<span class="string">"è§’è‰²åˆ—è¡¨ä¸ºç©ºï¼š&#123;&#125;"</span>, authentication.getPrincipal());</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Set&lt;MenuVO&gt; urls = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">            authorityList.stream().filter(authority -&gt;</span><br><span class="line">                    !StrUtil.equals(authority.getAuthority(), <span class="string">"ROLE_USER"</span>))</span><br><span class="line">                    .forEach(authority -&gt; &#123;</span><br><span class="line">                        Set&lt;MenuVO&gt; menuVOSet = menuService.findMenuByRole(authority.getAuthority());</span><br><span class="line">                        CollUtil.addAll(urls, menuVOSet);</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">            urls.stream().filter(menu -&gt; StrUtil.isNotEmpty(menu.getUrl())</span><br><span class="line">                    &amp;&amp; antPathMatcher.match(menu.getUrl(), request.getRequestURI())</span><br><span class="line">                    &amp;&amp; request.getMethod().equalsIgnoreCase(menu.getMethod()))</span><br><span class="line">                    .findFirst().ifPresent(menuVO -&gt; hasPermission.set(<span class="keyword">true</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hasPermission.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç½‘å…³æ€»ç»“"><a href="#ç½‘å…³æ€»ç»“" class="headerlink" title="ç½‘å…³æ€»ç»“"></a>ç½‘å…³æ€»ç»“</h3><p>pigè¿™ä¸ªç³»ç»Ÿæ˜¯ä¸ªå¾ˆå¥½çš„æ¡†æ¶ï¼Œæœ¬æ¬¡ä½“éªŒçš„æ˜¯pigçš„zuulç½‘å…³æ¨¡å—ï¼Œæ­¤æ¨¡å—ä¸feignï¼Œribbonï¼Œspring securityï¼ŒEurasiaè¿›è¡Œæ•´åˆï¼Œå®Œæˆæˆ–éƒ¨åˆ†å®Œæˆäº†<strong>åŠ¨æ€è·¯ç”±</strong>ï¼Œ<strong>ç°åº¦å‘å¸ƒ</strong>,<strong>èœå•æƒé™ç®¡ç†</strong>ï¼Œ<strong>æœåŠ¡é™æµ</strong>ï¼Œ<strong>ç½‘å…³æ—¥å¿—å¤„ç†</strong>ï¼Œéå¸¸å€¼å¾—å­¦ä¹ ï¼</p><h1 id="UPMsæƒé™ç®¡ç†ç³»ç»Ÿæ¨¡å—"><a href="#UPMsæƒé™ç®¡ç†ç³»ç»Ÿæ¨¡å—" class="headerlink" title="UPMsæƒé™ç®¡ç†ç³»ç»Ÿæ¨¡å—"></a>UPMsæƒé™ç®¡ç†ç³»ç»Ÿæ¨¡å—</h1><p>ç™¾åº¦äº†ä¸€ä¸‹ï¼Œ<em>UPMS</em>æ˜¯User Permissions Management Systemï¼Œé€šç”¨ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ</p><h2 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h2><h3 id="éƒ¨é—¨è¡¨"><a href="#éƒ¨é—¨è¡¨" class="headerlink" title="éƒ¨é—¨è¡¨"></a>éƒ¨é—¨è¡¨</h3><p><img src="/2018/12/12/å†·å†·Pigå¼€æºé¡¹ç›®å­¦ä¹ /4.png" alt="æœåŠ¡ç½‘å…³"></p><h4 id="éƒ¨é—¨å…³ç³»è¡¨"><a href="#éƒ¨é—¨å…³ç³»è¡¨" class="headerlink" title="éƒ¨é—¨å…³ç³»è¡¨"></a>éƒ¨é—¨å…³ç³»è¡¨</h4><p><img src="/2018/12/12/å†·å†·Pigå¼€æºé¡¹ç›®å­¦ä¹ /5.png" alt="æœåŠ¡ç½‘å…³"></p><h3 id="å­—å…¸è¡¨"><a href="#å­—å…¸è¡¨" class="headerlink" title="å­—å…¸è¡¨"></a>å­—å…¸è¡¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–å·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@TableId</span>(value=<span class="string">"id"</span>, type= IdType.AUTO)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">private</span> String value;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ‡ç­¾å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">private</span> String label;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">private</span> String type;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æè¿°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’åºï¼ˆå‡åºï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">private</span> BigDecimal sort;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºæ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@TableField</span>(<span class="string">"create_time"</span>)</span><br><span class="line"><span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@TableField</span>(<span class="string">"update_time"</span>)</span><br><span class="line"><span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤‡æ³¨ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">private</span> String remarks;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æ ‡è®°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@TableField</span>(<span class="string">"del_flag"</span>)</span><br><span class="line"><span class="keyword">private</span> String delFlag;</span><br></pre></td></tr></table></figure><h3 id="æ—¥å¿—è¡¨"><a href="#æ—¥å¿—è¡¨" class="headerlink" title="æ—¥å¿—è¡¨"></a>æ—¥å¿—è¡¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysLog</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–å·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableId</span>(type = IdType.ID_WORKER)</span><br><span class="line">    <span class="meta">@JsonSerialize</span>(using = ToStringSerializer.class)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ—¥å¿—ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ—¥å¿—æ ‡é¢˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè€…</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String createBy;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºæ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ“ä½œIPåœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String remoteAddr;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ä»£ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userAgent;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯·æ±‚URI</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String requestUri;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ“ä½œæ–¹å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String method;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ“ä½œæäº¤çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String params;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰§è¡Œæ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long time;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æ ‡è®°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String delFlag;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String exception;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœåŠ¡ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String serviceId; &#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="èœå•æƒé™è¡¨"><a href="#èœå•æƒé™è¡¨" class="headerlink" title="èœå•æƒé™è¡¨"></a>èœå•æƒé™è¡¨</h3><p><img src="/2018/12/12/å†·å†·Pigå¼€æºé¡¹ç›®å­¦ä¹ /6.png" alt="æœåŠ¡ç½‘å…³"></p><h3 id="è§’è‰²è¡¨"><a href="#è§’è‰²è¡¨" class="headerlink" title="è§’è‰²è¡¨"></a>è§’è‰²è¡¨</h3><p><img src="/2018/12/12/å†·å†·Pigå¼€æºé¡¹ç›®å­¦ä¹ /7.png" alt="æœåŠ¡ç½‘å…³"></p><h4 id="è§’è‰²ä¸éƒ¨é—¨å¯¹åº”å…³ç³»"><a href="#è§’è‰²ä¸éƒ¨é—¨å¯¹åº”å…³ç³»" class="headerlink" title="è§’è‰²ä¸éƒ¨é—¨å¯¹åº”å…³ç³»"></a>è§’è‰²ä¸éƒ¨é—¨å¯¹åº”å…³ç³»</h4><p>ç•¥</p><h4 id="è§’è‰²ä¸èœå•æƒé™å¯¹åº”å…³ç³»"><a href="#è§’è‰²ä¸èœå•æƒé™å¯¹åº”å…³ç³»" class="headerlink" title="è§’è‰²ä¸èœå•æƒé™å¯¹åº”å…³ç³»"></a>è§’è‰²ä¸èœå•æƒé™å¯¹åº”å…³ç³»</h4><p>ç•¥</p><h3 id="ç”¨æˆ·è¡¨"><a href="#ç”¨æˆ·è¡¨" class="headerlink" title="ç”¨æˆ·è¡¨"></a>ç”¨æˆ·è¡¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸»é”®ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableId</span>(value = <span class="string">"user_id"</span>, type = IdType.AUTO)</span><br><span class="line"><span class="keyword">private</span> Integer userId;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éšæœºç›</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonIgnore</span></span><br><span class="line"><span class="keyword">private</span> String salt;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºæ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField</span>(<span class="string">"create_time"</span>)</span><br><span class="line"><span class="keyword">private</span> Date createTime;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹æ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField</span>(<span class="string">"update_time"</span>)</span><br><span class="line"><span class="keyword">private</span> Date updateTime;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 0-æ­£å¸¸ï¼Œ1-åˆ é™¤</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField</span>(<span class="string">"del_flag"</span>)</span><br><span class="line"><span class="keyword">private</span> String delFlag;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç®€ä»‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String phone;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤´åƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éƒ¨é—¨ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField</span>(<span class="string">"dept_id"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer deptId;</span><br></pre></td></tr></table></figure><h3 id="åŠ¨æ€è·¯ç”±é…ç½®è¡¨"><a href="#åŠ¨æ€è·¯ç”±é…ç½®è¡¨" class="headerlink" title="åŠ¨æ€è·¯ç”±é…ç½®è¡¨"></a>åŠ¨æ€è·¯ç”±é…ç½®è¡¨</h3><p><img src="/2018/12/12/å†·å†·Pigå¼€æºé¡¹ç›®å­¦ä¹ /8.png" alt="æœåŠ¡ç½‘å…³"></p><h2 id="ä¸šåŠ¡é€»è¾‘"><a href="#ä¸šåŠ¡é€»è¾‘" class="headerlink" title="ä¸šåŠ¡é€»è¾‘"></a>ä¸šåŠ¡é€»è¾‘</h2><p><img src="/2018/12/12/å†·å†·Pigå¼€æºé¡¹ç›®å­¦ä¹ /3.png" alt="æœåŠ¡ç½‘å…³"></p><p>å…¨æ˜¯åŸºäº<a href="https://mp.baomidou.com/" target="_blank" rel="noopener">mybatis plus</a>çš„CRUDï¼Œæœ‰ç‚¹å¤šã€‚å¤§éƒ¨åˆ†å¹²è¿™è¡Œçš„éƒ½æ‡‚ï¼Œæˆ‘å°±ä¸è¯¦ç»†å±•å¼€äº†ã€‚</p><h3 id="éªŒè¯ç "><a href="#éªŒè¯ç " class="headerlink" title="éªŒè¯ç "></a>éªŒè¯ç </h3><h4 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h4><p><code>ValidateCodeController</code>å¯ä»¥æ‰¾åˆ°åˆ›å»ºéªŒè¯ç ç›¸å…³ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºéªŒè¯ç </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(SecurityConstants.DEFAULT_VALIDATE_CODE_URL_PREFIX + <span class="string">"/&#123;randomStr&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createCode</span><span class="params">(@PathVariable String randomStr, HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Assert.isBlank(randomStr, <span class="string">"æœºå™¨ç ä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Cache-Control"</span>, <span class="string">"no-store, no-cache"</span>);</span><br><span class="line">        response.setContentType(<span class="string">"image/jpeg"</span>);</span><br><span class="line">        <span class="comment">//ç”Ÿæˆæ–‡å­—éªŒè¯ç </span></span><br><span class="line">        String text = producer.createText();</span><br><span class="line">        <span class="comment">//ç”Ÿæˆå›¾ç‰‡éªŒè¯ç </span></span><br><span class="line">        BufferedImage image = producer.createImage(text);</span><br><span class="line">        userService.saveImageCode(randomStr, text);</span><br><span class="line">        ServletOutputStream out = response.getOutputStream();</span><br><span class="line">        ImageIO.write(image, <span class="string">"JPEG"</span>, out);</span><br><span class="line">        IOUtils.closeQuietly(out);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­çš„ <code>producer</code>æ˜¯ä½¿ç”¨<code>Kaptcha</code>ï¼Œä¸‹é¢æ˜¯é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KaptchaConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KAPTCHA_BORDER = <span class="string">"kaptcha.border"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KAPTCHA_TEXTPRODUCER_FONT_COLOR = <span class="string">"kaptcha.textproducer.font.color"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KAPTCHA_TEXTPRODUCER_CHAR_SPACE = <span class="string">"kaptcha.textproducer.char.space"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KAPTCHA_IMAGE_WIDTH = <span class="string">"kaptcha.image.width"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KAPTCHA_IMAGE_HEIGHT = <span class="string">"kaptcha.image.height"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KAPTCHA_TEXTPRODUCER_CHAR_LENGTH = <span class="string">"kaptcha.textproducer.char.length"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object KAPTCHA_IMAGE_FONT_SIZE = <span class="string">"kaptcha.textproducer.font.size"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultKaptcha <span class="title">producer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.put(KAPTCHA_BORDER, SecurityConstants.DEFAULT_IMAGE_BORDER);</span><br><span class="line">        properties.put(KAPTCHA_TEXTPRODUCER_FONT_COLOR, SecurityConstants.DEFAULT_COLOR_FONT);</span><br><span class="line">        properties.put(KAPTCHA_TEXTPRODUCER_CHAR_SPACE, SecurityConstants.DEFAULT_CHAR_SPACE);</span><br><span class="line">        properties.put(KAPTCHA_IMAGE_WIDTH, SecurityConstants.DEFAULT_IMAGE_WIDTH);</span><br><span class="line">        properties.put(KAPTCHA_IMAGE_HEIGHT, SecurityConstants.DEFAULT_IMAGE_HEIGHT);</span><br><span class="line">        properties.put(KAPTCHA_IMAGE_FONT_SIZE, SecurityConstants.DEFAULT_IMAGE_FONT_SIZE);</span><br><span class="line">        properties.put(KAPTCHA_TEXTPRODUCER_CHAR_LENGTH, SecurityConstants.DEFAULT_IMAGE_LENGTH);</span><br><span class="line">        Config config = <span class="keyword">new</span> Config(properties);</span><br><span class="line">        DefaultKaptcha defaultKaptcha = <span class="keyword">new</span> DefaultKaptcha();</span><br><span class="line">        defaultKaptcha.setConfig(config);</span><br><span class="line">        <span class="keyword">return</span> defaultKaptcha;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‘é€æ‰‹æœºéªŒè¯ç "><a href="#å‘é€æ‰‹æœºéªŒè¯ç " class="headerlink" title="å‘é€æ‰‹æœºéªŒè¯ç "></a>å‘é€æ‰‹æœºéªŒè¯ç </h4><p>å¤§ä½“é€»è¾‘ä¸ºï¼Œå…ˆæŸ¥è¯¢éªŒè¯ç redisç¼“å­˜ï¼Œæ²¡æœ‰ç¼“å­˜åˆ™è¯´æ˜éªŒè¯ç ç¼“å­˜æ²¡æœ‰å¤±æ•ˆï¼Œè¿”å›é”™è¯¯ã€‚</p><p>æŸ¥åˆ°æ²¡æœ‰éªŒè¯ç ï¼Œåˆ™æ ¹æ®æ‰‹æœºå·ç ä»æ•°æ®åº“è·å¾—ç”¨æˆ·ä¿¡æ¯ï¼Œç”Ÿæˆä¸€ä¸ª4ä½çš„éªŒè¯ç ï¼Œä½¿ç”¨<code>rabbbitmq</code>é˜Ÿåˆ—æŠŠçŸ­ä¿¡éªŒè¯ç ä¿å­˜åˆ°é˜Ÿåˆ—ï¼ŒåŒæ—¶åŠ ä¸Šæ‰‹æœºéªŒè¯ç çš„redisç¼“å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€éªŒè¯ç </span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 1. å…ˆå»redis æŸ¥è¯¢æ˜¯å¦ 60Så†…å·²ç»å‘é€</span></span><br><span class="line"><span class="comment">     * 2. æœªå‘é€ï¼š åˆ¤æ–­æ‰‹æœºå·æ˜¯å¦å­˜ ? false :äº§ç”Ÿ4ä½æ•°å­—  æ‰‹æœºå·-éªŒè¯ç </span></span><br><span class="line"><span class="comment">     * 3. å‘å¾€æ¶ˆæ¯ä¸­å¿ƒ-ã€‹å‘é€ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * 4. ä¿å­˜redis</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mobile æ‰‹æœºå·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueã€false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R&lt;Boolean&gt; <span class="title">sendSmsCode</span><span class="params">(String mobile)</span> </span>&#123;</span><br><span class="line">        Object tempCode = redisTemplate.opsForValue().get(SecurityConstants.DEFAULT_CODE_KEY + mobile);</span><br><span class="line">        <span class="keyword">if</span> (tempCode != <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.error(<span class="string">"ç”¨æˆ·:&#123;&#125;éªŒè¯ç æœªå¤±æ•ˆ&#123;&#125;"</span>, mobile, tempCode);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> R&lt;&gt;(<span class="keyword">false</span>, <span class="string">"éªŒè¯ç æœªå¤±æ•ˆï¼Œè¯·å¤±æ•ˆåå†æ¬¡ç”³è¯·"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        SysUser params = <span class="keyword">new</span> SysUser();</span><br><span class="line">        params.setPhone(mobile);</span><br><span class="line">        List&lt;SysUser&gt; userList = <span class="keyword">this</span>.selectList(<span class="keyword">new</span> EntityWrapper&lt;&gt;(params));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (CollectionUtil.isEmpty(userList)) &#123;</span><br><span class="line">            log.error(<span class="string">"æ ¹æ®ç”¨æˆ·æ‰‹æœºå·&#123;&#125;æŸ¥è¯¢ç”¨æˆ·ä¸ºç©º"</span>, mobile);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> R&lt;&gt;(<span class="keyword">false</span>, <span class="string">"æ‰‹æœºå·ä¸å­˜åœ¨"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String code = RandomUtil.randomNumbers(<span class="number">4</span>);</span><br><span class="line">        JSONObject contextJson = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        contextJson.put(<span class="string">"code"</span>, code);</span><br><span class="line">        contextJson.put(<span class="string">"product"</span>, <span class="string">"Pig4Cloud"</span>);</span><br><span class="line">        log.info(<span class="string">"çŸ­ä¿¡å‘é€è¯·æ±‚æ¶ˆæ¯ä¸­å¿ƒ -&gt; æ‰‹æœºå·:&#123;&#125; -&gt; éªŒè¯ç ï¼š&#123;&#125;"</span>, mobile, code);</span><br><span class="line">        rabbitTemplate.convertAndSend(MqQueueConstant.MOBILE_CODE_QUEUE,</span><br><span class="line">                <span class="keyword">new</span> MobileMsgTemplate(</span><br><span class="line">                        mobile,</span><br><span class="line">                        contextJson.toJSONString(),</span><br><span class="line">                        CommonConstant.ALIYUN_SMS,</span><br><span class="line">                        EnumSmsChannelTemplate.LOGIN_NAME_LOGIN.getSignName(),</span><br><span class="line">                        EnumSmsChannelTemplate.LOGIN_NAME_LOGIN.getTemplate()</span><br><span class="line">                ));</span><br><span class="line">        redisTemplate.opsForValue().set(SecurityConstants.DEFAULT_CODE_KEY + mobile, code, SecurityConstants.DEFAULT_IMAGE_EXPIRE, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> R&lt;&gt;(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æ ‘å½¢èŠ‚ç‚¹å·¥å…·æ "><a href="#æ ‘å½¢èŠ‚ç‚¹å·¥å…·æ " class="headerlink" title="æ ‘å½¢èŠ‚ç‚¹å·¥å…·æ "></a>æ ‘å½¢èŠ‚ç‚¹å·¥å…·æ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸¤å±‚å¾ªç¯å®ç°å»ºæ ‘</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> treeNodes ä¼ å…¥çš„æ ‘èŠ‚ç‚¹åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends TreeNode&gt; <span class="function">List&lt;T&gt; <span class="title">bulid</span><span class="params">(List&lt;T&gt; treeNodes, Object root)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        List&lt;T&gt; trees = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (T treeNode : treeNodes) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (root.equals(treeNode.getParentId())) &#123;</span><br><span class="line">                trees.add(treeNode);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (T it : treeNodes) &#123;</span><br><span class="line">                <span class="keyword">if</span> (it.getParentId() == treeNode.getId()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (treeNode.getChildren() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        treeNode.setChildren(<span class="keyword">new</span> ArrayList&lt;TreeNode&gt;());</span><br><span class="line">                    &#125;</span><br><span class="line">                    treeNode.add(it);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> trees;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨é€’å½’æ–¹æ³•å»ºæ ‘</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> treeNodes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends TreeNode&gt; <span class="function">List&lt;T&gt; <span class="title">buildByRecursive</span><span class="params">(List&lt;T&gt; treeNodes, Object root)</span> </span>&#123;</span><br><span class="line">        List&lt;T&gt; trees = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line">        <span class="keyword">for</span> (T treeNode : treeNodes) &#123;</span><br><span class="line">            <span class="keyword">if</span> (root.equals(treeNode.getParentId())) &#123;</span><br><span class="line">                trees.add(findChildren(treeNode, treeNodes));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> trees;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å½’æŸ¥æ‰¾å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> treeNodes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends TreeNode&gt; <span class="function">T <span class="title">findChildren</span><span class="params">(T treeNode, List&lt;T&gt; treeNodes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (T it : treeNodes) &#123;</span><br><span class="line">            <span class="keyword">if</span> (treeNode.getId() == it.getParentId()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (treeNode.getChildren() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    treeNode.setChildren(<span class="keyword">new</span> ArrayList&lt;TreeNode&gt;());</span><br><span class="line">                &#125;</span><br><span class="line">                treeNode.add(findChildren(it, treeNodes));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> treeNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡sysMenuåˆ›å»ºæ ‘å½¢èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> menus</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> root</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;MenuTree&gt; <span class="title">bulidTree</span><span class="params">(List&lt;SysMenu&gt; menus, <span class="keyword">int</span> root)</span> </span>&#123;</span><br><span class="line">        List&lt;MenuTree&gt; trees = <span class="keyword">new</span> ArrayList&lt;MenuTree&gt;();</span><br><span class="line">        MenuTree node;</span><br><span class="line">        <span class="keyword">for</span> (SysMenu menu : menus) &#123;</span><br><span class="line">            node = <span class="keyword">new</span> MenuTree();</span><br><span class="line">            node.setId(menu.getMenuId());</span><br><span class="line">            node.setParentId(menu.getParentId());</span><br><span class="line">            node.setName(menu.getName());</span><br><span class="line">            node.setUrl(menu.getUrl());</span><br><span class="line">            node.setPath(menu.getPath());</span><br><span class="line">            node.setCode(menu.getPermission());</span><br><span class="line">            node.setLabel(menu.getName());</span><br><span class="line">            node.setComponent(menu.getComponent());</span><br><span class="line">            node.setIcon(menu.getIcon());</span><br><span class="line">            trees.add(node);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> TreeUtil.bulid(trees, root);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆavueæ¨¡æ¿ç±»"><a href="#ç”Ÿæˆavueæ¨¡æ¿ç±»" class="headerlink" title="ç”Ÿæˆavueæ¨¡æ¿ç±»"></a>ç”Ÿæˆavueæ¨¡æ¿ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PigResourcesGenerator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String outputDir = <span class="string">"/Users/lengleng/work/temp"</span>;</span><br><span class="line">        <span class="keyword">final</span> String viewOutputDir = outputDir + <span class="string">"/view/"</span>;</span><br><span class="line">        AutoGenerator mpg = <span class="keyword">new</span> AutoGenerator();</span><br><span class="line">        <span class="comment">// å…¨å±€é…ç½®</span></span><br><span class="line">        GlobalConfig gc = <span class="keyword">new</span> GlobalConfig();</span><br><span class="line">        gc.setOutputDir(outputDir);</span><br><span class="line">        gc.setFileOverride(<span class="keyword">true</span>);</span><br><span class="line">        gc.setActiveRecord(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// XML äºŒçº§ç¼“å­˜</span></span><br><span class="line">        gc.setEnableCache(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// XML ResultMap</span></span><br><span class="line">        gc.setBaseResultMap(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// XML columList</span></span><br><span class="line">        gc.setBaseColumnList(<span class="keyword">true</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">"lengleng"</span>);</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•°æ®æºé…ç½®</span></span><br><span class="line">        DataSourceConfig dsc = <span class="keyword">new</span> DataSourceConfig();</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        dsc.setDriverName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">"lengleng"</span>);</span><br><span class="line">        dsc.setUrl(<span class="string">"jdbc:mysql://139.224.200.249:3309/pig?characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false"</span>);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­–ç•¥é…ç½®</span></span><br><span class="line">        StrategyConfig strategy = <span class="keyword">new</span> StrategyConfig();</span><br><span class="line">        <span class="comment">// strategy.setCapitalMode(true);// å…¨å±€å¤§å†™å‘½å ORACLE æ³¨æ„</span></span><br><span class="line">        strategy.setSuperControllerClass(<span class="string">"com.github.pig.common.web.BaseController"</span>);</span><br><span class="line">        <span class="comment">// è¡¨åç”Ÿæˆç­–ç•¥</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŒ…é…ç½®</span></span><br><span class="line">        PackageConfig pc = <span class="keyword">new</span> PackageConfig();</span><br><span class="line">        pc.setParent(<span class="string">"com.github.pig.admin"</span>);</span><br><span class="line">        pc.setController(<span class="string">"controller"</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨å…¥è‡ªå®šä¹‰é…ç½®ï¼Œå¯ä»¥åœ¨ VM ä¸­ä½¿ç”¨ cfg.abc è®¾ç½®çš„å€¼</span></span><br><span class="line">        InjectionConfig cfg = <span class="keyword">new</span> InjectionConfig() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// ç”Ÿæˆçš„æ¨¡ç‰ˆè·¯å¾„ï¼Œä¸å­˜åœ¨æ—¶éœ€è¦å…ˆæ–°å»º</span></span><br><span class="line">        File viewDir = <span class="keyword">new</span> File(viewOutputDir);</span><br><span class="line">        <span class="keyword">if</span> (!viewDir.exists()) &#123;</span><br><span class="line">            viewDir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;FileOutConfig&gt; focList = <span class="keyword">new</span> ArrayList&lt;FileOutConfig&gt;();</span><br><span class="line">        focList.add(<span class="keyword">new</span> FileOutConfig(<span class="string">"/templates/listvue.vue.vm"</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">outputFile</span><span class="params">(TableInfo tableInfo)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> getGeneratorViewPath(viewOutputDir, tableInfo, <span class="string">".vue"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        cfg.setFileOutConfigList(focList);</span><br><span class="line">        mpg.setCfg(cfg);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”Ÿæˆcontrollerç›¸å…³</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> é…ç½®Props</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Properties <span class="title">getProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¯»å–é…ç½®æ–‡ä»¶</span></span><br><span class="line">        Resource resource = <span class="keyword">new</span> ClassPathResource(<span class="string">"/config/application.properties"</span>);</span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            props = PropertiesLoaderUtils.loadProperties(resource);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> props;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é¡µé¢ç”Ÿæˆçš„æ–‡ä»¶å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getGeneratorViewPath</span><span class="params">(String viewOutputDir, TableInfo tableInfo, String suffixPath)</span> </span>&#123;</span><br><span class="line">        String name = StringUtils.firstToLowerCase(tableInfo.getEntityName());</span><br><span class="line">        String path = viewOutputDir + <span class="string">"/"</span> + name + <span class="string">"/index"</span>  + suffixPath;</span><br><span class="line">        File viewDir = <span class="keyword">new</span> File(path).getParentFile();</span><br><span class="line">        <span class="keyword">if</span> (!viewDir.exists()) &#123;</span><br><span class="line">            viewDir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>velocityæ¨¡æ¿</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> $!&#123;<span class="keyword">package</span>.Controller&#125;;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> com.github.pig.common.constant.CommonConstant;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.mapper.EntityWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.plugins.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pig.common.util.Query;</span><br><span class="line"><span class="keyword">import</span> com.github.pig.common.util.R;</span><br><span class="line"><span class="keyword">import</span> $!&#123;<span class="keyword">package</span>.Entity&#125;.$!&#123;entity&#125;;</span><br><span class="line"><span class="keyword">import</span> $!&#123;<span class="keyword">package</span>.Service&#125;.$!&#123;entity&#125;Service;</span><br><span class="line">#if($!&#123;superControllerClassPackage&#125;)</span><br><span class="line"><span class="keyword">import</span> $!&#123;superControllerClassPackage&#125;;</span><br><span class="line">#end</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * $!&#123;table.comment&#125; å‰ç«¯æ§åˆ¶å™¨</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> $!&#123;author&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> $!&#123;date&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/$!&#123;table.entityPath&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> $!</span>&#123;table.controllerName&#125; extends $!&#123;superControllerClass&#125; &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> $!&#123;entity&#125;Service $!&#123;table.entityPath&#125;Service;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * é€šè¿‡IDæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id ID</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> $!&#123;entity&#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="keyword">public</span> R&lt;$!&#123;entity&#125;&gt; get(<span class="meta">@PathVariable</span> Integer id) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> R&lt;&gt;($!&#123;table.entityPath&#125;Service.selectById(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * åˆ†é¡µæŸ¥è¯¢ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> params åˆ†é¡µå¯¹è±¡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> åˆ†é¡µå¯¹è±¡</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/page"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page <span class="title">page</span><span class="params">(@RequestParam Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">        params.put(CommonConstant.DEL_FLAG, CommonConstant.STATUS_NORMAL);</span><br><span class="line">        <span class="keyword">return</span> $!&#123;table.entityPath&#125;Service.selectPage(<span class="keyword">new</span> Query&lt;&gt;(params), <span class="keyword">new</span> EntityWrapper&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  $!&#123;table.entityPath&#125;  å®ä½“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> success/false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R&lt;Boolean&gt; <span class="title">add</span><span class="params">(@RequestBody $!&#123;entity&#125; $!&#123;table.entityPath&#125;)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> R&lt;&gt;($!&#123;table.entityPath&#125;Service.insert($!&#123;table.entityPath&#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> success/false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R&lt;Boolean&gt; <span class="title">delete</span><span class="params">(@PathVariable Integer id)</span> </span>&#123;</span><br><span class="line">        $!&#123;entity&#125; $!&#123;table.entityPath&#125; = <span class="keyword">new</span> $!&#123;entity&#125;();</span><br><span class="line">        $!&#123;table.entityPath&#125;.setId(id);</span><br><span class="line">        $!&#123;table.entityPath&#125;.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        $!&#123;table.entityPath&#125;.setDelFlag(CommonConstant.STATUS_DEL);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> R&lt;&gt;($!&#123;table.entityPath&#125;Service.updateById($!&#123;table.entityPath&#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–è¾‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  $!&#123;table.entityPath&#125;  å®ä½“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> success/false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R&lt;Boolean&gt; <span class="title">edit</span><span class="params">(@RequestBody $!&#123;entity&#125; $!&#123;table.entityPath&#125;)</span> </span>&#123;</span><br><span class="line">        $!&#123;table.entityPath&#125;.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> R&lt;&gt;($!&#123;table.entityPath&#125;Service.updateById($!&#123;table.entityPath&#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><p>åœ¨éƒ¨åˆ†å®ç°ç±»ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä½œè€…ä½¿ç”¨äº†<code>spring cache</code>ç›¸å…³çš„æ³¨è§£ã€‚ç°åœ¨æˆ‘ä»¬å›å¿†ä¸€ä¸‹ç›¸å…³ç¼“å­˜æ³¨è§£çš„å«ä¹‰ï¼š</p><p><img src="/2018/12/12/å†·å†·Pigå¼€æºé¡¹ç›®å­¦ä¹ /9.png" alt="æœåŠ¡ç½‘å…³"></p><p><code>@Cacheable</code>:ç”¨æ¥å®šä¹‰ç¼“å­˜çš„ã€‚å¸¸ç”¨åˆ°æ˜¯value,key;åˆ†åˆ«ç”¨æ¥æŒ‡æ˜ç¼“å­˜çš„åç§°å’Œæ–¹æ³•ä¸­å‚æ•°ï¼Œå¯¹äºvalueä½ ä¹Ÿå¯ä»¥ä½¿ç”¨cacheNameï¼Œåœ¨æŸ¥çœ‹æºä»£ç æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šä¸¤è€…æ˜¯æŒ‡çš„åŒä¸€ä¸ªä¸œè¥¿ã€‚</p><p><code>@CacheEvict</code>:ç”¨æ¥æ¸…ç†ç¼“å­˜ã€‚å¸¸ç”¨æœ‰cacheNamesï¼ŒallEntriesï¼ˆé»˜è®¤å€¼falseï¼‰ï¼›åˆ†åˆ«ä»£è¡¨äº†è¦æ¸…é™¤çš„ç¼“å­˜åç§°å’Œæ˜¯å¦å…¨éƒ¨æ¸…é™¤(trueä»£è¡¨å…¨éƒ¨æ¸…é™¤)ã€‚</p><p><code>@CachePut</code>:ç”¨æ¥æ›´æ–°ç¼“å­˜ï¼Œç”¨å®ƒæ¥æ³¨è§£çš„æ–¹æ³•éƒ½ä¼šè¢«æ‰§è¡Œï¼Œæ‰§è¡Œå®Œåç»“æœè¢«æ·»åŠ åˆ°ç¼“å­˜ä¸­ã€‚è¯¥æ–¹æ³•ä¸èƒ½å’Œ@CacheableåŒæ—¶åœ¨åŒä¸€ä¸ªæ–¹æ³•ä¸Šä½¿ç”¨ã€‚</p><h1 id="åå°è·‘æ‰¹å®šæ—¶ä»»åŠ¡æ¨¡å—"><a href="#åå°è·‘æ‰¹å®šæ—¶ä»»åŠ¡æ¨¡å—" class="headerlink" title="åå°è·‘æ‰¹å®šæ—¶ä»»åŠ¡æ¨¡å—"></a>åå°è·‘æ‰¹å®šæ—¶ä»»åŠ¡æ¨¡å—</h1><p><code>Elastic-Job</code>æ˜¯ddframeä¸­dd-jobçš„ä½œä¸šæ¨¡å—ä¸­åˆ†ç¦»å‡ºæ¥çš„åˆ†å¸ƒå¼å¼¹æ€§ä½œä¸šæ¡†æ¶ã€‚å»æ‰äº†å’Œdd-jobä¸­çš„ç›‘æ§å’Œddframeæ¥å…¥è§„èŒƒéƒ¨åˆ†ã€‚è¯¥é¡¹ç›®åŸºäºæˆç†Ÿçš„å¼€æºäº§å“Quartzå’ŒZookeeperåŠå…¶å®¢æˆ·ç«¯Curatorè¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li><strong>å®šæ—¶ä»»åŠ¡ï¼š</strong> åŸºäºæˆç†Ÿçš„å®šæ—¶ä»»åŠ¡ä½œä¸šæ¡†æ¶Quartz cronè¡¨è¾¾å¼æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚</li><li><strong>ä½œä¸šæ³¨å†Œä¸­å¿ƒï¼š</strong> åŸºäºZookeeperå’Œå…¶å®¢æˆ·ç«¯Curatorå®ç°çš„å…¨å±€ä½œä¸šæ³¨å†Œæ§åˆ¶ä¸­å¿ƒã€‚ç”¨äºæ³¨å†Œï¼Œæ§åˆ¶å’Œåè°ƒåˆ†å¸ƒå¼ä½œä¸šæ‰§è¡Œã€‚</li><li><strong>ä½œä¸šåˆ†ç‰‡ï¼š</strong> å°†ä¸€ä¸ªä»»åŠ¡åˆ†ç‰‡æˆä¸ºå¤šä¸ªå°ä»»åŠ¡é¡¹åœ¨å¤šæœåŠ¡å™¨ä¸ŠåŒæ—¶æ‰§è¡Œã€‚</li><li><strong>å¼¹æ€§æ‰©å®¹ç¼©å®¹ï¼š</strong> è¿è¡Œä¸­çš„ä½œä¸šæœåŠ¡å™¨å´©æºƒï¼Œæˆ–æ–°å¢åŠ nå°ä½œä¸šæœåŠ¡å™¨ï¼Œä½œä¸šæ¡†æ¶å°†åœ¨ä¸‹æ¬¡ä½œä¸šæ‰§è¡Œå‰é‡æ–°åˆ†ç‰‡ï¼Œä¸å½±å“å½“å‰ä½œä¸šæ‰§è¡Œã€‚</li><li><strong>æ”¯æŒå¤šç§ä½œä¸šæ‰§è¡Œæ¨¡å¼ï¼š</strong> æ”¯æŒOneOffï¼ŒPerpetualå’ŒSequencePerpetualä¸‰ç§ä½œä¸šæ¨¡å¼ã€‚</li><li><strong>å¤±æ•ˆè½¬ç§»ï¼š</strong> è¿è¡Œä¸­çš„ä½œä¸šæœåŠ¡å™¨å´©æºƒä¸ä¼šå¯¼è‡´é‡æ–°åˆ†ç‰‡ï¼Œåªä¼šåœ¨ä¸‹æ¬¡ä½œä¸šå¯åŠ¨æ—¶åˆ†ç‰‡ã€‚å¯ç”¨å¤±æ•ˆè½¬ç§»åŠŸèƒ½å¯ä»¥åœ¨æœ¬æ¬¡ä½œä¸šæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç›‘æµ‹å…¶ä»–ä½œä¸šæœåŠ¡å™¨ç©ºé—²ï¼ŒæŠ“å–æœªå®Œæˆçš„å­¤å„¿åˆ†ç‰‡é¡¹æ‰§è¡Œã€‚</li><li><strong>è¿è¡Œæ—¶çŠ¶æ€æ”¶é›†ï¼š</strong> ç›‘æ§ä½œä¸šè¿è¡Œæ—¶çŠ¶æ€ï¼Œç»Ÿè®¡æœ€è¿‘ä¸€æ®µæ—¶é—´å¤„ç†çš„æ•°æ®æˆåŠŸå’Œå¤±è´¥æ•°é‡ï¼Œè®°å½•ä½œä¸šä¸Šæ¬¡è¿è¡Œå¼€å§‹æ—¶é—´ï¼Œç»“æŸæ—¶é—´å’Œä¸‹æ¬¡è¿è¡Œæ—¶é—´ã€‚</li><li><strong>ä½œä¸šåœæ­¢ï¼Œæ¢å¤å’Œç¦ç”¨ï¼š</strong>ç”¨äºæ“ä½œä½œä¸šå¯åœï¼Œå¹¶å¯ä»¥ç¦æ­¢æŸä½œä¸šè¿è¡Œï¼ˆä¸Šçº¿æ—¶å¸¸ç”¨ï¼‰ã€‚</li><li><strong>è¢«é”™è¿‡æ‰§è¡Œçš„ä½œä¸šé‡è§¦å‘ï¼š</strong>è‡ªåŠ¨è®°å½•é”™è¿‡æ‰§è¡Œçš„ä½œä¸šï¼Œå¹¶åœ¨ä¸Šæ¬¡ä½œä¸šå®Œæˆåè‡ªåŠ¨è§¦å‘ã€‚å¯å‚è€ƒQuartzçš„misfireã€‚</li><li><strong>å¤šçº¿ç¨‹å¿«é€Ÿå¤„ç†æ•°æ®ï¼š</strong>ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†æŠ“å–åˆ°çš„æ•°æ®ï¼Œæå‡ååé‡ã€‚</li><li><strong>å¹‚ç­‰æ€§ï¼š</strong>é‡å¤ä½œä¸šä»»åŠ¡é¡¹åˆ¤å®šï¼Œä¸é‡å¤æ‰§è¡Œå·²è¿è¡Œçš„ä½œä¸šä»»åŠ¡é¡¹ã€‚ç”±äºå¼€å¯å¹‚ç­‰æ€§éœ€è¦ç›‘å¬ä½œä¸šè¿è¡ŒçŠ¶æ€ï¼Œå¯¹ç¬æ—¶åå¤è¿è¡Œçš„ä½œä¸šå¯¹æ€§èƒ½æœ‰è¾ƒå¤§å½±å“ã€‚</li><li><strong>å®¹é”™å¤„ç†ï¼š</strong>ä½œä¸šæœåŠ¡å™¨ä¸ZookeeperæœåŠ¡å™¨é€šä¿¡å¤±è´¥åˆ™ç«‹å³åœæ­¢ä½œä¸šè¿è¡Œï¼Œé˜²æ­¢ä½œä¸šæ³¨å†Œä¸­å¿ƒå°†å¤±æ•ˆçš„åˆ†ç‰‡åˆ†é¡¹é…ç»™å…¶ä»–ä½œä¸šæœåŠ¡å™¨ï¼Œè€Œå½“å‰ä½œä¸šæœåŠ¡å™¨ä»åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå¯¼è‡´é‡å¤æ‰§è¡Œã€‚</li><li><strong>Springæ”¯æŒï¼š</strong>æ”¯æŒspringå®¹å™¨ï¼Œè‡ªå®šä¹‰å‘½åç©ºé—´ï¼Œæ”¯æŒå ä½ç¬¦ã€‚</li><li><strong>è¿ç»´å¹³å°ï¼š</strong>æä¾›è¿ç»´ç•Œé¢ï¼Œå¯ä»¥ç®¡ç†ä½œä¸šå’Œæ³¨å†Œä¸­å¿ƒã€‚</li></ul><h2 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>ä½œè€…ç›´æ¥ä½¿ç”¨äº†å¼€æºé¡¹ç›®çš„é…ç½®ï¼Œæˆ‘é¡ºç€ä»–çš„pomæ–‡ä»¶æ‰¾åˆ°äº†è¿™å®¶çš„githubï¼Œåœ°å€å¦‚ä¸‹</p><p><a href="https://github.com/xjzrc/elastic-job-lite-spring-boot-starter" target="_blank" rel="noopener">https://github.com/xjzrc/elastic-job-lite-spring-boot-starter</a></p><h3 id="å·¥ä½œæµä½œä¸šé…ç½®"><a href="#å·¥ä½œæµä½œä¸šé…ç½®" class="headerlink" title="å·¥ä½œæµä½œä¸šé…ç½®"></a>å·¥ä½œæµä½œä¸šé…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ElasticJobConfig</span>(cron = <span class="string">"0 0 0/1 * * ? "</span>, shardingTotalCount = <span class="number">3</span>, shardingItemParameters = <span class="string">"0=Beijing,1=Shanghai,2=Guangzhou"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PigDataflowJob</span> <span class="keyword">implements</span> <span class="title">DataflowJob</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">fetchData</span><span class="params">(ShardingContext shardingContext)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processData</span><span class="params">(ShardingContext shardingContext, List&lt;Integer&gt; list)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@ElasticJobConfig</span>(cron = <span class="string">"0 0 0/1 * * ?"</span>, shardingTotalCount = <span class="number">3</span>,</span><br><span class="line">        shardingItemParameters = <span class="string">"0=pig1,1=pig2,2=pig3"</span>,</span><br><span class="line">        startedTimeoutMilliseconds = <span class="number">5000L</span>,</span><br><span class="line">        completedTimeoutMilliseconds = <span class="number">10000L</span>,</span><br><span class="line">        eventTraceRdbDataSource = <span class="string">"dataSource"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PigSimpleJob</span> <span class="keyword">implements</span> <span class="title">SimpleJob</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸šåŠ¡æ‰§è¡Œé€»è¾‘</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shardingContext åˆ†ç‰‡ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(ShardingContext shardingContext)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"shardingContext:&#123;&#125;"</span>, shardingContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼€æºç‰ˆå¯¹è¿™ä¸ªæ”¯æŒæœ‰é™ï¼Œç­‰åˆ°æ‹¿åˆ°æ”¶è´¹ç‰ˆæˆ‘åœ¨åšåˆ†æã€‚</p><h1 id="æ¶ˆæ¯ä¸­å¿ƒ"><a href="#æ¶ˆæ¯ä¸­å¿ƒ" class="headerlink" title="æ¶ˆæ¯ä¸­å¿ƒ"></a>æ¶ˆæ¯ä¸­å¿ƒ</h1><p>è¿™é‡Œçš„æ¶ˆæ¯ä¸­å¿ƒä¸»è¦æ˜¯é›†æˆäº†é’‰é’‰æœåŠ¡å’Œé˜¿é‡Œå¤§é±¼çŸ­æ¯æœåŠ¡</p><h2 id="é’‰é’‰"><a href="#é’‰é’‰" class="headerlink" title="é’‰é’‰"></a>é’‰é’‰</h2><h3 id="é…ç½®-2"><a href="#é…ç½®-2" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>é’‰é’‰æ˜¯ç›¸å½“ç®€å•äº†ï¼Œåªéœ€è¦ä¸€ä¸ª<code>webhook</code>ä¿¡æ¯å°±å¤Ÿäº†ã€‚</p><p><code>webhook</code>æ˜¯ä¸€ç§webå›è°ƒæˆ–è€…httpçš„push APIï¼Œæ˜¯å‘APPæˆ–è€…å…¶ä»–åº”ç”¨æä¾›å®æ—¶ä¿¡æ¯çš„ä¸€ç§æ–¹å¼ã€‚Webhookåœ¨æ•°æ®äº§ç”Ÿæ—¶ç«‹å³å‘é€æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä½ èƒ½å®æ—¶æ”¶åˆ°æ•°æ®ã€‚è¿™ä¸€ç§ä¸åŒäºå…¸å‹çš„APIï¼Œéœ€è¦ç”¨äº†å®æ—¶æ€§éœ€è¦è¶³å¤Ÿå¿«çš„è½®è¯¢ã€‚è¿™æ— è®ºæ˜¯å¯¹ç”Ÿäº§è¿˜æ˜¯å¯¹æ¶ˆè´¹è€…éƒ½æ˜¯é«˜æ•ˆçš„ï¼Œå”¯ä¸€çš„ç¼ºç‚¹æ˜¯åˆå§‹å»ºç«‹å›°éš¾ã€‚Webhookæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºåå‘APIï¼Œå› ä¸ºä»–æä¾›äº†APIè§„åˆ™ï¼Œä½ éœ€è¦è®¾è®¡è¦ä½¿ç”¨çš„APIã€‚Webhookå°†å‘ä½ çš„åº”ç”¨å‘èµ·httpè¯·æ±‚ï¼Œå…¸å‹çš„æ˜¯postè¯·æ±‚ï¼Œåº”ç”¨ç¨‹åºç”±è¯·æ±‚é©±åŠ¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"sms.dingtalk"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DingTalkPropertiesConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * webhook</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String webhook;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯æ¨¡æ¿"><a href="#æ¶ˆæ¯æ¨¡æ¿" class="headerlink" title="æ¶ˆæ¯æ¨¡æ¿"></a>æ¶ˆæ¯æ¨¡æ¿</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lengleng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/1/15</span></span><br><span class="line"><span class="comment"> * é’‰é’‰æ¶ˆæ¯æ¨¡æ¿</span></span><br><span class="line"><span class="comment"> * msgtype : text</span></span><br><span class="line"><span class="comment"> * text : &#123;"content":"æœåŠ¡: pig-upms-service çŠ¶æ€ï¼šUP"&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DingTalkMsgTemplate</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String msgtype;</span><br><span class="line">    <span class="keyword">private</span> TextBean text;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsgtype</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msgtype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsgtype</span><span class="params">(String msgtype)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msgtype = msgtype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TextBean <span class="title">getText</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(TextBean text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.text = text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TextBean</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * content : æœåŠ¡: pig-upms-service çŠ¶æ€ï¼šUP</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> content;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContent</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.content = content;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç›‘å¬"><a href="#ç›‘å¬" class="headerlink" title="ç›‘å¬"></a>ç›‘å¬</h3><p>ä½¿ç”¨é˜Ÿåˆ—æ—¶æ—¶ç›‘å¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queues = MqQueueConstant.DINGTALK_SERVICE_STATUS_CHANGE)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DingTalkServiceChangeReceiveListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DingTalkMessageHandler dingTalkMessageHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        log.info(<span class="string">"æ¶ˆæ¯ä¸­å¿ƒæ¥æ”¶åˆ°é’‰é’‰å‘é€è¯·æ±‚-&gt; å†…å®¹ï¼š&#123;&#125; "</span>, text);</span><br><span class="line">        dingTalkMessageHandler.process(text);</span><br><span class="line">        <span class="keyword">long</span> useTime = System.currentTimeMillis() - startTime;</span><br><span class="line">        log.info(<span class="string">"è°ƒç”¨ é’‰é’‰ç½‘å…³å¤„ç†å®Œæ¯•ï¼Œè€—æ—¶ &#123;&#125;æ¯«ç§’"</span>, useTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‘é€"><a href="#å‘é€" class="headerlink" title="å‘é€"></a>å‘é€</h3><p>ä½¿ç”¨é˜Ÿåˆ—å‘é€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DingTalkMessageHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DingTalkPropertiesConfig dingTalkPropertiesConfig;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸šåŠ¡å¤„ç†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        String webhook = dingTalkPropertiesConfig.getWebhook();</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(webhook)) &#123;</span><br><span class="line">            log.error(<span class="string">"é’‰é’‰é…ç½®é”™è¯¯ï¼Œwebhookä¸ºç©º"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        DingTalkMsgTemplate dingTalkMsgTemplate = <span class="keyword">new</span> DingTalkMsgTemplate();</span><br><span class="line">        dingTalkMsgTemplate.setMsgtype(<span class="string">"text"</span>);</span><br><span class="line">        DingTalkMsgTemplate.TextBean textBean = <span class="keyword">new</span> DingTalkMsgTemplate.TextBean();</span><br><span class="line">        textBean.setContent(text);</span><br><span class="line">        dingTalkMsgTemplate.setText(textBean);</span><br><span class="line">        String result = HttpUtil.post(webhook, JSONObject.toJSONString(dingTalkMsgTemplate));</span><br><span class="line">        log.info(<span class="string">"é’‰é’‰æé†’æˆåŠŸ,æŠ¥æ–‡å“åº”:&#123;&#125;"</span>, result);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é˜¿é‡Œå¤§é±¼çŸ­æ¯æœåŠ¡"><a href="#é˜¿é‡Œå¤§é±¼çŸ­æ¯æœåŠ¡" class="headerlink" title="é˜¿é‡Œå¤§é±¼çŸ­æ¯æœåŠ¡"></a>é˜¿é‡Œå¤§é±¼çŸ­æ¯æœåŠ¡</h2><h3 id="é…ç½®-3"><a href="#é…ç½®-3" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnExpression</span>(<span class="string">"!'$&#123;sms.aliyun&#125;'.isEmpty()"</span>)</span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"sms.aliyun"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsAliyunPropertiesConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åº”ç”¨ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åº”ç”¨ç§˜é’¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çŸ­ä¿¡æ¨¡æ¿é…ç½®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; channels;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç›‘å¬-1"><a href="#ç›‘å¬-1" class="headerlink" title="ç›‘å¬"></a>ç›‘å¬</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queues = MqQueueConstant.MOBILE_SERVICE_STATUS_CHANGE)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MobileServiceChangeReceiveListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, SmsMessageHandler&gt; messageHandlerMap;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(MobileMsgTemplate mobileMsgTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        log.info(<span class="string">"æ¶ˆæ¯ä¸­å¿ƒæ¥æ”¶åˆ°çŸ­ä¿¡å‘é€è¯·æ±‚-&gt; æ‰‹æœºå·ï¼š&#123;&#125; -&gt; ä¿¡æ¯ä½“ï¼š&#123;&#125; "</span>, mobileMsgTemplate.getMobile(), mobileMsgTemplate.getContext());</span><br><span class="line">        String channel = mobileMsgTemplate.getChannel();</span><br><span class="line">        SmsMessageHandler messageHandler = messageHandlerMap.get(channel);</span><br><span class="line">        <span class="keyword">if</span> (messageHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.error(<span class="string">"æ²¡æœ‰æ‰¾åˆ°æŒ‡å®šçš„è·¯ç”±é€šé“ï¼Œä¸è¿›è¡Œå‘é€å¤„ç†å®Œæ¯•ï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        messageHandler.execute(mobileMsgTemplate);</span><br><span class="line">        <span class="keyword">long</span> useTime = System.currentTimeMillis() - startTime;</span><br><span class="line">        log.info(<span class="string">"è°ƒç”¨ &#123;&#125; çŸ­ä¿¡ç½‘å…³å¤„ç†å®Œæ¯•ï¼Œè€—æ—¶ &#123;&#125;æ¯«ç§’"</span>, mobileMsgTemplate.getType(), useTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‘é€-1"><a href="#å‘é€-1" class="headerlink" title="å‘é€"></a>å‘é€</h3><p>ä¸é”™çš„æ¨¡æ¿</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span>(CommonConstant.ALIYUN_SMS)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsAliyunMessageHandler</span> <span class="keyword">extends</span> <span class="title">AbstractMessageHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SmsAliyunPropertiesConfig smsAliyunPropertiesConfig;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PRODUCT = <span class="string">"Dysmsapi"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DOMAIN = <span class="string">"dysmsapi.aliyuncs.com"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®æ ¡éªŒ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mobileMsgTemplate æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(MobileMsgTemplate mobileMsgTemplate)</span> </span>&#123;</span><br><span class="line">        Assert.isBlank(mobileMsgTemplate.getMobile(), <span class="string">"æ‰‹æœºå·ä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">        Assert.isBlank(mobileMsgTemplate.getContext(), <span class="string">"çŸ­ä¿¡å†…å®¹ä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸šåŠ¡å¤„ç†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mobileMsgTemplate æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(MobileMsgTemplate mobileMsgTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å¯è‡ªåŠ©è°ƒæ•´è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        System.setProperty(<span class="string">"sun.net.client.defaultConnectTimeout"</span>, <span class="string">"10000"</span>);</span><br><span class="line">        System.setProperty(<span class="string">"sun.net.client.defaultReadTimeout"</span>, <span class="string">"10000"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–acsClient,æš‚ä¸æ”¯æŒregionåŒ–</span></span><br><span class="line">        IClientProfile profile = DefaultProfile.getProfile(<span class="string">"cn-hangzhou"</span>, smsAliyunPropertiesConfig.getAccessKey(), smsAliyunPropertiesConfig.getSecretKey());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DefaultProfile.addEndpoint(<span class="string">"cn-hou"</span>, <span class="string">"cn-hangzhou"</span>, PRODUCT, DOMAIN);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">            log.error(<span class="string">"åˆå§‹åŒ–SDK å¼‚å¸¸"</span>, e);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        IAcsClient acsClient = <span class="keyword">new</span> DefaultAcsClient(profile);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»„è£…è¯·æ±‚å¯¹è±¡-å…·ä½“æè¿°è§æ§åˆ¶å°-æ–‡æ¡£éƒ¨åˆ†å†…å®¹</span></span><br><span class="line">        SendSmsRequest request = <span class="keyword">new</span> SendSmsRequest();</span><br><span class="line">        <span class="comment">//å¿…å¡«:å¾…å‘é€æ‰‹æœºå·</span></span><br><span class="line">        request.setPhoneNumbers(mobileMsgTemplate.getMobile());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¿…å¡«:çŸ­ä¿¡ç­¾å-å¯åœ¨çŸ­ä¿¡æ§åˆ¶å°ä¸­æ‰¾åˆ°</span></span><br><span class="line">        request.setSignName(mobileMsgTemplate.getSignName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¿…å¡«:çŸ­ä¿¡æ¨¡æ¿-å¯åœ¨çŸ­ä¿¡æ§åˆ¶å°ä¸­æ‰¾åˆ°</span></span><br><span class="line">        request.setTemplateCode(smsAliyunPropertiesConfig.getChannels().get(mobileMsgTemplate.getTemplate()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯é€‰:æ¨¡æ¿ä¸­çš„å˜é‡æ›¿æ¢JSONä¸²,å¦‚æ¨¡æ¿å†…å®¹ä¸º"äº²çˆ±çš„$&#123;name&#125;,æ‚¨çš„éªŒè¯ç ä¸º$&#123;code&#125;"</span></span><br><span class="line">        request.setTemplateParam(mobileMsgTemplate.getContext());</span><br><span class="line">        request.setOutId(mobileMsgTemplate.getMobile());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//hint æ­¤å¤„å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ³¨æ„catch</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SendSmsResponse sendSmsResponse = acsClient.getAcsResponse(request);</span><br><span class="line">            log.info(<span class="string">"çŸ­ä¿¡å‘é€å®Œæ¯•ï¼Œæ‰‹æœºå·ï¼š&#123;&#125;ï¼Œè¿”å›çŠ¶æ€ï¼š&#123;&#125;"</span>, mobileMsgTemplate.getMobile(), sendSmsResponse.getCode());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">            log.error(<span class="string">"å‘é€å¼‚å¸¸"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤±è´¥å¤„ç†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mobileMsgTemplate æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fail</span><span class="params">(MobileMsgTemplate mobileMsgTemplate)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">"çŸ­ä¿¡å‘é€å¤±è´¥ -&gt; ç½‘å…³ï¼š&#123;&#125; -&gt; æ‰‹æœºå·ï¼š&#123;&#125;"</span>, mobileMsgTemplate.getType(), mobileMsgTemplate.getMobile());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="èµ„æºè®¤è¯æœåŠ¡å™¨-ï¼ˆå•ç‚¹ç™»é™†åŠŸèƒ½ï¼‰"><a href="#èµ„æºè®¤è¯æœåŠ¡å™¨-ï¼ˆå•ç‚¹ç™»é™†åŠŸèƒ½ï¼‰" class="headerlink" title="èµ„æºè®¤è¯æœåŠ¡å™¨ ï¼ˆå•ç‚¹ç™»é™†åŠŸèƒ½ï¼‰"></a>èµ„æºè®¤è¯æœåŠ¡å™¨ ï¼ˆå•ç‚¹ç™»é™†åŠŸèƒ½ï¼‰</h1><p>ç”±äºä½œè€…åœ¨è®¤è¯ä¸­å¿ƒä½¿ç”¨äº†spring security oauthæ¡†æ¶ï¼Œæ‰€ä»¥éœ€è¦åœ¨å¾®æœåŠ¡çš„å®¢æˆ·ç«¯å®ç°ä¸€ä¸ªèµ„æºè®¤è¯æœåŠ¡å™¨ï¼Œæ¥å®ŒæˆSSOéœ€æ±‚ã€‚</p><h2 id="é…ç½®-4"><a href="#é…ç½®-4" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>æš´éœ²ç›‘æ§ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableResourceServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceServerConfiguration</span> <span class="keyword">extends</span> <span class="title">ResourceServerConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">                .csrf().disable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableOAuth</span>2Sso</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PigSsoClientDemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PigSsoClientDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç›‘æ§æ¨¡å—"><a href="#ç›‘æ§æ¨¡å—" class="headerlink" title="ç›‘æ§æ¨¡å—"></a>ç›‘æ§æ¨¡å—</h1><h2 id="springboot-adminé…ç½®"><a href="#springboot-adminé…ç½®" class="headerlink" title="springboot adminé…ç½®"></a>springboot adminé…ç½®</h2><p><code>RemindingNotifier</code>ä¼šåœ¨åº”ç”¨ä¸Šçº¿æˆ–å®•æ‰çš„æ—¶å€™å‘é€æé†’ï¼Œä¹Ÿå°±æ˜¯æŠŠ<code>notifications</code>å‘é€ç»™å…¶ä»–çš„<code>notifier</code>ï¼Œnotifierçš„å®ç°å¾ˆæœ‰æ„æ€ï¼Œä¸æ·±ç©¶äº†ï¼Œä»ç±»å…³ç³»å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥è¿™ä¹ˆå‡ ç§æ–¹å¼å‘é€notificationsï¼šPagerdutyã€Hipchat ã€Slack ã€Mailã€ Reminder</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">NotifierConfig</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="meta">@Primary</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> RemindingNotifier <span class="title">remindingNotifier</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            RemindingNotifier notifier = <span class="keyword">new</span> RemindingNotifier(filteringNotifier(loggerNotifier()));</span><br><span class="line">            notifier.setReminderPeriod(TimeUnit.SECONDS.toMillis(<span class="number">10</span>));</span><br><span class="line">            <span class="keyword">return</span> notifier;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Scheduled</span>(fixedRate = <span class="number">1_000L</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remind</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            remindingNotifier().sendReminders();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> FilteringNotifier <span class="title">filteringNotifier</span><span class="params">(Notifier delegate)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> FilteringNotifier(delegate);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> LoggingNotifier <span class="title">loggerNotifier</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LoggingNotifier();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="çŸ­ä¿¡æœåŠ¡ä¸‹çº¿é€šçŸ¥"><a href="#çŸ­ä¿¡æœåŠ¡ä¸‹çº¿é€šçŸ¥" class="headerlink" title="çŸ­ä¿¡æœåŠ¡ä¸‹çº¿é€šçŸ¥"></a>çŸ­ä¿¡æœåŠ¡ä¸‹çº¿é€šçŸ¥</h3><p>ç»§æ‰¿<code>AbstractStatusChangeNotifier</code>ï¼Œå°†çŸ­ä¿¡æœåŠ¡æ³¨å†Œåˆ°<code>spring boot admin</code>ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StatusChangeNotifier</span> <span class="keyword">extends</span> <span class="title">AbstractStatusChangeNotifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    <span class="keyword">private</span> MonitorPropertiesConfig monitorMobilePropertiesConfig;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StatusChangeNotifier</span><span class="params">(MonitorPropertiesConfig monitorMobilePropertiesConfig, RabbitTemplate rabbitTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rabbitTemplate = rabbitTemplate;</span><br><span class="line">        <span class="keyword">this</span>.monitorMobilePropertiesConfig = monitorMobilePropertiesConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šçŸ¥é€»è¾‘</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> event äº‹ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doNotify</span><span class="params">(ClientApplicationEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (event <span class="keyword">instanceof</span> ClientApplicationStatusChangedEvent) &#123;</span><br><span class="line">            log.info(<span class="string">"Application &#123;&#125; (&#123;&#125;) is &#123;&#125;"</span>, event.getApplication().getName(),</span><br><span class="line">                    event.getApplication().getId(), ((ClientApplicationStatusChangedEvent) event).getTo().getStatus());</span><br><span class="line">            String text = String.format(<span class="string">"åº”ç”¨:%s æœåŠ¡ID:%s çŠ¶æ€æ”¹å˜ä¸ºï¼š%sï¼Œæ—¶é—´ï¼š%s"</span></span><br><span class="line">                    , event.getApplication().getName()</span><br><span class="line">                    , event.getApplication().getId()</span><br><span class="line">                    , ((ClientApplicationStatusChangedEvent) event).getTo().getStatus()</span><br><span class="line">                    , DateUtil.date(event.getTimestamp()).toString());</span><br><span class="line"></span><br><span class="line">            JSONObject contextJson = <span class="keyword">new</span> JSONObject();</span><br><span class="line">            contextJson.put(<span class="string">"name"</span>, event.getApplication().getName());</span><br><span class="line">            contextJson.put(<span class="string">"seid"</span>, event.getApplication().getId());</span><br><span class="line">            contextJson.put(<span class="string">"time"</span>, DateUtil.date(event.getTimestamp()).toString());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å¼€å¯çŸ­ä¿¡é€šçŸ¥</span></span><br><span class="line">            <span class="keyword">if</span> (monitorMobilePropertiesConfig.getMobile().getEnabled()) &#123;</span><br><span class="line">                log.info(<span class="string">"å¼€å§‹çŸ­ä¿¡é€šçŸ¥ï¼Œå†…å®¹ï¼š&#123;&#125;"</span>, text);</span><br><span class="line">                rabbitTemplate.convertAndSend(MqQueueConstant.MOBILE_SERVICE_STATUS_CHANGE,</span><br><span class="line">                        <span class="keyword">new</span> MobileMsgTemplate(</span><br><span class="line">                                CollUtil.join(monitorMobilePropertiesConfig.getMobile().getMobiles(), <span class="string">","</span>),</span><br><span class="line">                                contextJson.toJSONString(),</span><br><span class="line">                                CommonConstant.ALIYUN_SMS,</span><br><span class="line">                                EnumSmsChannelTemplate.SERVICE_STATUS_CHANGE.getSignName(),</span><br><span class="line">                                EnumSmsChannelTemplate.SERVICE_STATUS_CHANGE.getTemplate()</span><br><span class="line">                        ));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (monitorMobilePropertiesConfig.getDingTalk().getEnabled()) &#123;</span><br><span class="line">                log.info(<span class="string">"å¼€å§‹é’‰é’‰é€šçŸ¥ï¼Œå†…å®¹ï¼š&#123;&#125;"</span>, text);</span><br><span class="line">                rabbitTemplate.convertAndSend(MqQueueConstant.DINGTALK_SERVICE_STATUS_CHANGE, text);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">"Application &#123;&#125; (&#123;&#125;) &#123;&#125;"</span>, event.getApplication().getName(),</span><br><span class="line">                    event.getApplication().getId(), event.getType());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="zipkin-é“¾è·¯è¿½è¸ª"><a href="#zipkin-é“¾è·¯è¿½è¸ª" class="headerlink" title="zipkin é“¾è·¯è¿½è¸ª"></a>zipkin é“¾è·¯è¿½è¸ª</h1><p>ç”±äºzipkinæ˜¯ä¾µå…¥å¼ï¼Œå› æ­¤è¿™éƒ¨åˆ†ç»„ä»¶æ²¡æœ‰ä»£ç ï¼Œåªæœ‰ç›¸å…³ä¾èµ–ã€‚ä¸‹é¢åˆ†äº«ä¸€ä¸‹ä½œè€…çš„yaml</p><h2 id="DB"><a href="#DB" class="headerlink" title="DB"></a>DB</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">5003</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># datasoureé»˜è®¤ä½¿ç”¨JDBC</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">ENC(gc16brBHPNq27HsjaULgKGq00Rz6ZUji)</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://127.0.0.1:3309/pig?characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">zipkin:</span></span><br><span class="line"><span class="attr">  collector:</span></span><br><span class="line"><span class="attr">    rabbitmq:</span></span><br><span class="line"><span class="attr">      addresses:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:5682</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">lengleng</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">pig</span></span><br><span class="line"><span class="attr">      queue:</span> <span class="string">zipkin</span></span><br><span class="line"><span class="attr">  storage:</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">mysql</span></span><br></pre></td></tr></table></figure><h2 id="ELK"><a href="#ELK" class="headerlink" title="ELK"></a>ELK</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  port:</span> <span class="number">5002</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">zipkin:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  collector:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    rabbitmq:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      addresses:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:5682</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      password:</span> <span class="string">lengleng</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      username:</span> <span class="string">pig</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      queue:</span> <span class="string">zipkin</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  storage:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    type:</span> <span class="string">elasticsearch</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    elasticsearch:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      hosts:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9200</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      cluster:</span> <span class="string">elasticsearch</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      index:</span> <span class="string">zipkin</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      max-requests:</span> <span class="number">64</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      index-shards:</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="attr">      index-replicas:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h1 id="ç»­1sæ—¶é—´"><a href="#ç»­1sæ—¶é—´" class="headerlink" title="ç»­1sæ—¶é—´"></a>ç»­1sæ—¶é—´</h1><p>å…¨ç‰‡ç»“æŸï¼Œè§‰å¾—æˆ‘å†™çš„ä¸é”™ï¼Ÿæƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿèµ¶å¿«æ‰“å¼€æˆ‘çš„ğŸ‘‰ä¸ªäºº<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">åšå®¢</a> ğŸ‘ˆå§ï¼</p><p>è°¢è°¢ä½ é‚£ä¹ˆå¯çˆ±ï¼Œè¿˜ä¸€ç›´å…³æ³¨ç€æˆ‘~â¤ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘çœ‹åˆ°ä¸€ä¸ªæœ‰è¶£çš„å¼€æºé¡¹ç›®pigï¼Œä¸»è¦çš„æŠ€æœ¯ç‚¹åœ¨è®¤è¯æˆæƒä¸­å¿ƒï¼Œspring security oauthï¼Œzuulç½‘å…³å®ç°ï¼ŒElastic-Jobå®šæ—¶ä»»åŠ¡ï¼Œè¶ç€åˆšåˆšå…¥é—¨å¾®æœåŠ¡ï¼Œèµ¶å¿«å†™ä¸ªåšå®¢åˆ†æä¸€ä¸‹ã€‚æ­¤ç¯‡æ–‡ç« ä¸»è¦ç”¨äºä¸ªäººå¤‡å¿˜ã€‚å¦‚æœæœ‰ä¸å¯¹ï¼Œè¯·æ‰¹è¯„ã€‚ğŸ˜­&lt;/p&gt;
&lt;p&gt;ç”±äºæ¯ä¸ªæ¨¡
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="æºç " scheme="https://tengshe789.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="å­¦å¥½åˆ†å¸ƒå¼æ¶æ„" scheme="https://tengshe789.github.io/tags/%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ </title>
    <link href="https://tengshe789.github.io/2018/12/10/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AECloud-Admin%E5%88%86%E6%9E%90%E4%B8%8E%E5%AD%A6%E4%B9%A0/"/>
    <id>https://tengshe789.github.io/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /</id>
    <published>2018-12-10T02:39:36.000Z</published>
    <updated>2019-11-20T13:39:41.269Z</updated>
    
    <content type="html"><![CDATA[<p>å‰ä¸€æ®µæ—¶é—´åœ¨<a href="https://blog.tengshe789.tech/2018/12/02/%E6%84%9F%E6%80%A7%E8%AE%A4%E8%AF%86jwt/#more" target="_blank" rel="noopener">â€œæ„Ÿæ€§è®¤è¯†JWTâ€</a>ä¸€åšæ–‡ä¸­åˆ†äº«äº†ï¼Œå¾ˆç«çš„å¼€æºé¡¹ç›®<code>Cloud-Admin</code>ä¸­é‰´æƒä¸­å¿ƒå’Œç½‘å…³çš„å®ç°ã€‚ä»Šå¤©å†æ¥çœ‹çœ‹å…¶ä»–å„ä¸ªéƒ¨åˆ†æºç </p><h2 id="æç¤º"><a href="#æç¤º" class="headerlink" title="æç¤º"></a>æç¤º</h2><p>è€è§„çŸ©ï¼Œæ”¾å¼€æºé¡¹ç›®åœ°å€ï¼š<a href="https://gitee.com/minull/ace-security" target="_blank" rel="noopener">https://gitee.com/minull/ace-security</a></p><h3 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><p><img src="/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /5.png" alt="1543763543823"></p><h3 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h3><p>ä¸‹é¢æ˜¯å®˜æ–¹æä¾›çš„æ¶æ„æ¨¡å‹ã€‚</p><p><img src="/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /6.png" alt="image.png"></p><h3 id="é¡¹ç›®çš„è¿è¡Œæ­¥éª¤"><a href="#é¡¹ç›®çš„è¿è¡Œæ­¥éª¤" class="headerlink" title="é¡¹ç›®çš„è¿è¡Œæ­¥éª¤"></a>é¡¹ç›®çš„è¿è¡Œæ­¥éª¤</h3><ul><li>å…ˆå¯åŠ¨rabbitmqã€redisã€mysqlä»¥åŠconsulæ³¨å†Œä¸­å¿ƒ</li><li>è¿è¡Œæ•°æ®åº“è„šæœ¬ï¼šä¾æ¬¡è¿è¡Œæ•°æ®åº“ï¼šace-admin/db/init.sqlã€ace-auth-server/db/init.sqlã€ace-trace</li><li>ä¿®æ”¹é…ç½®æ•°æ®åº“é…ç½®ï¼šace-admin/src/main/resources/application.ymlã€ace-gate/src/main/resources/application.yml</li><li>æŒ‰<code>é¡ºåº</code>è¿è¡Œmainç±»ï¼šCenterBootstrapï¼ˆace-centerï¼‰ã€AuthBootstrapï¼ˆace-auth-serverï¼‰ã€AdminBootstrapï¼ˆace-adminï¼‰ã€GatewayServerBootstrapï¼ˆace-gateway-v2ï¼‰</li></ul><h2 id="Adminæ¨¡å—"><a href="#Adminæ¨¡å—" class="headerlink" title="Adminæ¨¡å—"></a>Adminæ¨¡å—</h2><h3 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h3><p>å…ˆçœ‹çœ‹æ•°æ®åº“è®¾è®¡ï¼Œadminæ¨¡å—è´Ÿè´£æ‰€æœ‰æƒé™çš„ç®¡ç†ã€‚ç¬¬ä¸€å¼ è¡¨<code>base_element</code>ï¼Œå®šä¹‰äº†å„ä¸ªèµ„æºçš„codeï¼Œç±»å‹ï¼Œuriï¼Œæ¯ä¸€ä¸ªç‰¹å®šèµ„æºå¯¹åº”ä¸€ç§è¯·æ±‚è·¯å¾„ï¼Œå¦‚å›¾ğŸ‘‡</p><p><img src="/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /1.png" alt="base_element"></p><p>ç¬¬äºŒå¼ ï¼Œ<code>base_group</code>å®šä¹‰äº†è§’è‰²å’Œè¯·æ±‚è·¯å¾„çš„å…³ç³»ã€‚ğŸ‘‡</p><p><img src="/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /2.png" alt="base_element"></p><p>ç¬¬ä¸‰å¼ ï¼Œ<code>base_group_type</code>å®šä¹‰äº†ç±»å‹ğŸ‘‡</p><p><img src="/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /3.png" alt="base_element"></p><p>ç¬¬å››å¼ ï¼Œ<code>base_menu</code>å®šä¹‰äº†èœå•ğŸ‘‡</p><p><img src="/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /4.png" alt="base_element"></p><p>ç¬¬äº”å¼ ï¼Œè®°å½•äº†ç½‘å…³æ—¥å¿—ç›¸å…³ä¿¡æ¯</p><p><img src="/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /5.png" alt="base_element"></p><p>ç¬¬å…­å¼ ï¼Œç”¨æˆ·è¡¨</p><p><img src="/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /6.png" alt="base_element"></p><h3 id="ä¸šåŠ¡é€»è¾‘"><a href="#ä¸šåŠ¡é€»è¾‘" class="headerlink" title="ä¸šåŠ¡é€»è¾‘"></a>ä¸šåŠ¡é€»è¾‘</h3><p>æ¥å£è¿™éƒ¨åˆ†ä½œè€…å†™çš„æœ‰äº›ä¹±ï¼Œå°†å¾ˆå¤šä¸šåŠ¡é€»è¾‘çš„æœ‰å…³ä»£ç æ”¾åˆ°æ¥å£å±‚äº†ï¼ˆåæ§½ï¼‰ã€‚è¿™éƒ¨åˆ†ä»£ç æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯æ ¹æ®ä¸Šé¢çš„æ•°æ®åº“<code>CRUD</code>ã€‚æ¥å£çš„è·¯å¾„åˆ†ä¸º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/api/user/validate</span><br><span class="line">/element/**"</span><br><span class="line">/gateLog/**"</span><br><span class="line">/group/**"</span><br><span class="line">/groupType/**"</span><br><span class="line">/menu/**"</span><br><span class="line">/user/**"</span><br><span class="line">/api/permissions"</span><br><span class="line">/api/user/un/**"</span><br></pre></td></tr></table></figure><p>è¿™å‡ ç±»ï¼Œå¹¶ä¸”èµ°æ¯ä¸€å±‚éƒ½ä¼šèµ°é‰´æƒä¸­å¿ƒæ¥é‰´åˆ«ï¼Œå…·ä½“é€»è¾‘æ˜¯ä½¿ç”¨springbootçš„<code>addInterceptors()</code>æ–¹æ³•æ·»åŠ ä¸¤å±‚æ‹¦æˆªå™¨ç»„æˆä¸€ä¸ªæ‹¦æˆªå™¨é“¾ï¼Œå¦‚ä¸‹ğŸ‘‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(getServiceAuthRestInterceptor()).</span><br><span class="line">                addPathPatterns(getIncludePathPatterns()).addPathPatterns(<span class="string">"/api/user/validate"</span>);</span><br><span class="line">        registry.addInterceptor(getUserAuthRestInterceptor()).</span><br><span class="line">                addPathPatterns(getIncludePathPatterns());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€å±‚æ‹¦æˆªå™¨æ˜¯é‰´æƒä¸­å¿ƒçš„<code>ServiceAuthRestInterceptor</code>æ‹¦æˆªå™¨ï¼Œåˆ¤æ–­è®¿é—®çš„å®¢æˆ·ç«¯æ˜¯å¦æœ‰æƒé™è®¿é—®ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€å±‚æ‹¦æˆªå™¨ </span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HandlerMethod handlerMethod = (HandlerMethod) handler;</span><br><span class="line">        <span class="comment">// é…ç½®è¯¥æ³¨è§£ï¼Œè¯´æ˜ä¸è¿›è¡ŒæœåŠ¡æ‹¦æˆª</span></span><br><span class="line">        IgnoreClientToken annotation = handlerMethod.getBeanType().getAnnotation(IgnoreClientToken.class);</span><br><span class="line">        <span class="keyword">if</span> (annotation == <span class="keyword">null</span>) &#123;</span><br><span class="line">            annotation = handlerMethod.getMethodAnnotation(IgnoreClientToken.class);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(annotation!=<span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String token = request.getHeader(serviceAuthConfig.getTokenHeader());</span><br><span class="line">        IJWTInfo infoFromToken = serviceAuthUtil.getInfoFromToken(token);</span><br><span class="line">        String uniqueName = infoFromToken.getUniqueName();</span><br><span class="line">        <span class="keyword">for</span>(String client:serviceAuthUtil.getAllowedClient())&#123;</span><br><span class="line">            <span class="keyword">if</span>(client.equals(uniqueName))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ClientForbiddenException(<span class="string">"Client is Forbidden!"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå±‚æ‹¦æˆªå™¨æ˜¯é‰´æƒä¸­å¿ƒçš„<code>UserAuthRestInterceptor</code>æ‹¦æˆªå™¨ï¼Œæ‹¦æˆªéæ³•ç”¨æˆ·ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HandlerMethod handlerMethod = (HandlerMethod) handler;</span><br><span class="line">        <span class="comment">// é…ç½®è¯¥æ³¨è§£ï¼Œè¯´æ˜ä¸è¿›è¡Œç”¨æˆ·æ‹¦æˆª</span></span><br><span class="line">        IgnoreUserToken annotation = handlerMethod.getBeanType().getAnnotation(IgnoreUserToken.class);</span><br><span class="line">        <span class="keyword">if</span> (annotation == <span class="keyword">null</span>) &#123;</span><br><span class="line">            annotation = handlerMethod.getMethodAnnotation(IgnoreUserToken.class);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (annotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">        &#125;</span><br><span class="line">        String token = request.getHeader(userAuthConfig.getTokenHeader());</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(token)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (request.getCookies() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Cookie cookie : request.getCookies()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cookie.getName().equals(userAuthConfig.getTokenHeader())) &#123;</span><br><span class="line">                        token = cookie.getValue();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        IJWTInfo infoFromToken = userAuthUtil.getInfoFromToken(token);</span><br><span class="line">        BaseContextHandler.setUsername(infoFromToken.getUniqueName());</span><br><span class="line">        BaseContextHandler.setName(infoFromToken.getName());</span><br><span class="line">        BaseContextHandler.setUserID(infoFromToken.getId());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼“å­˜ä¸­å¿ƒ"><a href="#ç¼“å­˜ä¸­å¿ƒ" class="headerlink" title="ç¼“å­˜ä¸­å¿ƒ"></a>ç¼“å­˜ä¸­å¿ƒ</h2><p>åœ¨ä¸Šé¢çš„adminæ¨¡å—ä¸­ï¼Œä½œè€…åœ¨useræ¥å£ä¸Šï¼Œä½¿ç”¨äº†è‡ªå®šä¹‰çš„ç¼“å­˜æ³¨è§£<code>@Cache</code>ï¼Œç”¨æ¥ä¿å­˜ç”¨æˆ·çš„æƒé™ä¿¡æ¯ï¼Œå‡å°æ•°æ®åº“çš„è®¿é—®å‹åŠ›ğŸ‘‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"api"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PermissionService permissionService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cache</span>(key=<span class="string">"permission"</span>)</span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/permissions"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function">List&lt;PermissionInfo&gt; <span class="title">getAllPermission</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> permissionService.getAllPermission();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cache</span>(key=<span class="string">"permission:u&#123;1&#125;"</span>)</span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/user/un/&#123;username&#125;/permissions"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">List&lt;PermissionInfo&gt; <span class="title">getPermissionByUsername</span><span class="params">(@PathVariable(<span class="string">"username"</span>)</span> String username)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> permissionService.getPermissionByUsername(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/user/validate"</span>, method = RequestMethod.POST)</span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">UserInfo <span class="title">validate</span><span class="params">(@RequestBody Map&lt;String,String&gt; body)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> permissionService.validate(body.get(<span class="string">"username"</span>),body.get(<span class="string">"password"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬å°±åˆ†æä¸€ä¸‹ç¼“å­˜ä¸­å¿ƒçš„è®¾è®¡ã€‚</p><h3 id="ç›®å½•ç»“æ„-1"><a href="#ç›®å½•ç»“æ„-1" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><p><img src="/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /7.png" alt="base_element"></p><p>ç¼“å­˜ä¸­å¿ƒæ˜¯ä½œè€…é€šè¿‡mavenæ–¹å¼æ·»åŠ çš„ï¼Œå¹¶æ²¡æœ‰é€šè¿‡ç›´æ¥é¡¹ç›®ä»£ç å±•ç°ã€‚å› æ­¤æˆ‘ä½¿ç”¨<code>idea</code>çš„åç¼–ç å·¥å…·è¿›è¡Œåˆ†æ</p><h4 id="å…¥å£"><a href="#å…¥å£" class="headerlink" title="å…¥å£"></a>å…¥å£</h4><p>å…¥å£ä¸º<code>EnableAceCache</code>ï¼Œå¼€å¯è¿™ä¸ªå°±å¯ä»¥è‡ªåŠ¨é…ç½®ç¼“å­˜ç›¸å…³äº‹é¡¹</p><h3 id="ç¼“å­˜å®ä½“"><a href="#ç¼“å­˜å®ä½“" class="headerlink" title="ç¼“å­˜å®ä½“"></a>ç¼“å­˜å®ä½“</h3><p>å…ˆçœ‹ç¼“å­˜å®ä½“ï¼Œä½œè€…å®šä¹‰äº†keyï¼Œæè¿°ä¿¡æ¯descï¼Œä»¥åŠè¿‡æœŸæ—¶é—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String key = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">private</span> String desc = <span class="string">""</span>;</span><br><span class="line">    <span class="meta">@JsonFormat</span>(</span><br><span class="line">        timezone = <span class="string">"GMT+8"</span>,</span><br><span class="line">        pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">private</span> Date expireTime;</span><br><span class="line">    ..................&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h3><p>ä¸€å…±æœ‰ä¸¤ä¸ªé…ç½®</p><p><img src="/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /8.png" alt="base_element"></p><h4 id="RedisConfig"><a href="#RedisConfig" class="headerlink" title="RedisConfig"></a>RedisConfig</h4><p>å…ˆçœ‹<code>RedisConfig</code>ï¼Œä½¿ç”¨<code>@PostConstruct</code>æ³¨è§£ï¼Œæ„æ€æ˜¯ä¼šåœ¨æœåŠ¡å™¨åŠ è½½<code>Servlet</code>çš„æ—¶å€™ï¼Œå°†æœåŠ¡ç«¯<code>yml</code>ä¸­æœ‰å…³<code>redis</code>çš„é…ç½®åŠ è½½åˆ°<code>JedisPool</code>ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•åªä¼šè¢«æœåŠ¡å™¨è°ƒç”¨ä¸€æ¬¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment env;</span><br><span class="line">    <span class="keyword">private</span> JedisPool pool;</span><br><span class="line">    <span class="keyword">private</span> String maxActive;</span><br><span class="line">    <span class="keyword">private</span> String maxIdle;</span><br><span class="line">    <span class="keyword">private</span> String maxWait;</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String timeout;</span><br><span class="line">    <span class="keyword">private</span> String database;</span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line">    <span class="keyword">private</span> String enable;</span><br><span class="line">    <span class="keyword">private</span> String sysName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PropertiesLoaderUtils prop = <span class="keyword">new</span> PropertiesLoaderUtils(<span class="keyword">new</span> String[]&#123;<span class="string">"application.properties"</span>&#125;);</span><br><span class="line">        <span class="keyword">this</span>.host = prop.getProperty(<span class="string">"redis.host"</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(<span class="keyword">this</span>.host)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.host = <span class="keyword">this</span>.env.getProperty(<span class="string">"redis.host"</span>);</span><br><span class="line">            <span class="keyword">this</span>.maxActive = <span class="keyword">this</span>.env.getProperty(<span class="string">"redis.pool.maxActive"</span>);</span><br><span class="line">            <span class="keyword">this</span>.maxIdle = <span class="keyword">this</span>.env.getProperty(<span class="string">"redis.pool.maxIdle"</span>);</span><br><span class="line">            <span class="keyword">this</span>.maxWait = <span class="keyword">this</span>.env.getProperty(<span class="string">"redis.pool.maxWait"</span>);</span><br><span class="line">            <span class="keyword">this</span>.password = <span class="keyword">this</span>.env.getProperty(<span class="string">"redis.password"</span>);</span><br><span class="line">            <span class="keyword">this</span>.timeout = <span class="keyword">this</span>.env.getProperty(<span class="string">"redis.timeout"</span>);</span><br><span class="line">            <span class="keyword">this</span>.database = <span class="keyword">this</span>.env.getProperty(<span class="string">"redis.database"</span>);</span><br><span class="line">            <span class="keyword">this</span>.port = <span class="keyword">this</span>.env.getProperty(<span class="string">"redis.port"</span>);</span><br><span class="line">            <span class="keyword">this</span>.sysName = <span class="keyword">this</span>.env.getProperty(<span class="string">"redis.sysName"</span>);</span><br><span class="line">            <span class="keyword">this</span>.enable = <span class="keyword">this</span>.env.getProperty(<span class="string">"redis.enable"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.maxActive = prop.getProperty(<span class="string">"redis.pool.maxActive"</span>);</span><br><span class="line">            <span class="keyword">this</span>.maxIdle = prop.getProperty(<span class="string">"redis.pool.maxIdle"</span>);</span><br><span class="line">            <span class="keyword">this</span>.maxWait = prop.getProperty(<span class="string">"redis.pool.maxWait"</span>);</span><br><span class="line">            <span class="keyword">this</span>.password = prop.getProperty(<span class="string">"redis.password"</span>);</span><br><span class="line">            <span class="keyword">this</span>.timeout = prop.getProperty(<span class="string">"redis.timeout"</span>);</span><br><span class="line">            <span class="keyword">this</span>.database = prop.getProperty(<span class="string">"redis.database"</span>);</span><br><span class="line">            <span class="keyword">this</span>.port = prop.getProperty(<span class="string">"redis.port"</span>);</span><br><span class="line">            <span class="keyword">this</span>.sysName = prop.getProperty(<span class="string">"redis.sysName"</span>);</span><br><span class="line">            <span class="keyword">this</span>.enable = prop.getProperty(<span class="string">"redis.enable"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JedisPoolConfig <span class="title">constructJedisPoolConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        config.setMaxTotal(Integer.parseInt(<span class="keyword">this</span>.maxActive));</span><br><span class="line">        config.setMaxIdle(Integer.parseInt(<span class="keyword">this</span>.maxIdle));</span><br><span class="line">        config.setMaxWaitMillis((<span class="keyword">long</span>)Integer.parseInt(<span class="keyword">this</span>.maxWait));</span><br><span class="line">        config.setTestOnBorrow(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(</span><br><span class="line">        name = &#123;<span class="string">"pool"</span>&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JedisPool <span class="title">constructJedisPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String ip = <span class="keyword">this</span>.host;</span><br><span class="line">        <span class="keyword">int</span> port = Integer.parseInt(<span class="keyword">this</span>.port);</span><br><span class="line">        String password = <span class="keyword">this</span>.password;</span><br><span class="line">        <span class="keyword">int</span> timeout = Integer.parseInt(<span class="keyword">this</span>.timeout);</span><br><span class="line">        <span class="keyword">int</span> database = Integer.parseInt(<span class="keyword">this</span>.database);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == <span class="keyword">this</span>.pool) &#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isBlank(password)) &#123;</span><br><span class="line">                <span class="keyword">this</span>.pool = <span class="keyword">new</span> JedisPool(<span class="keyword">this</span>.constructJedisPoolConfig(), ip, port, timeout);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.pool = <span class="keyword">new</span> JedisPool(<span class="keyword">this</span>.constructJedisPoolConfig(), ip, port, timeout, password, database);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pool;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="CacheWebConfig"><a href="#CacheWebConfig" class="headerlink" title="CacheWebConfig"></a>CacheWebConfig</h4><p>ç¬¬äºŒä¸ªé…ç½®ï¼Œå°±æ˜¯ä½¿ç”¨<code>springboot</code>æ‹¦æˆªå™¨ï¼Œå°†ä½œè€…è‡ªå·±å†™çš„ç¼“å­˜ç®¡ç†ä¸­å¿ƒè§†å›¾ç•Œé¢å±•ç¤ºå‡ºæ¥ï¼ˆè¿™ä¸ªæ“ä½œå¤ªç¥å¥‡äº†ï¼Œç¬¬ä¸€æ¬¡çœ‹åˆ°ï¼‰ğŸ‘‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="keyword">new</span> String[]&#123;<span class="string">"/static/cache/**"</span>&#125;).addResourceLocations(<span class="keyword">new</span> String[]&#123;<span class="string">"classpath:/META-INF/static/"</span>&#125;);</span><br><span class="line">        <span class="keyword">super</span>.addResourceHandlers(registry);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="/2018/12/10/å¼€æºé¡¹ç›®Cloud-Adminåˆ†æä¸å­¦ä¹ /9.png" alt="base_element"></p><h3 id="ä½¿ç”¨ç¼“å­˜"><a href="#ä½¿ç”¨ç¼“å­˜" class="headerlink" title="ä½¿ç”¨ç¼“å­˜"></a>ä½¿ç”¨ç¼“å­˜</h3><h4 id="RedisServiceImplå’ŒCacheRedis"><a href="#RedisServiceImplå’ŒCacheRedis" class="headerlink" title="RedisServiceImplå’ŒCacheRedis"></a>RedisServiceImplå’ŒCacheRedis</h4><p><code>RedisServiceImpl</code>ä½¿ç”¨äº†<code>JedisPool</code>é‚£å‡ ä¸ªæ–¹æ³•å®ç°äº†å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œä»£ç çœç•¥ã€‚</p><p><code>CacheRedis</code>åˆ™<code>RedisServiceImpl</code>æ˜¯åŠ å…¥ä¸€äº›å¢åˆ æ”¹æŸ¥é€»è¾‘ï¼Œè­¬å¦‚ä»€ä¹ˆæ˜¯ä»€ä¹ˆè®¾ç½®ç¼“å­˜ã€‚</p><h4 id="åˆ‡é¢åŠ å…¥ç¼“å­˜"><a href="#åˆ‡é¢åŠ å…¥ç¼“å­˜" class="headerlink" title="åˆ‡é¢åŠ å…¥ç¼“å­˜"></a>åˆ‡é¢åŠ å…¥ç¼“å­˜</h4><h5 id="æ ¸å¿ƒæ–¹æ³•"><a href="#æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="æ ¸å¿ƒæ–¹æ³•"></a>æ ¸å¿ƒæ–¹æ³•</h5><p>æ ¸å¿ƒæ–¹æ³•<code>interceptor</code>å¦‚ä¸‹ï¼Œä½¿ç”¨<code>ProceedingJoinPoint</code>æ‹¿åˆ°è¢«<code>@Cache</code>æ ‡è®°çš„çš„æ–¹æ³•ä¸­çš„å‚æ•°ï¼Œç”¨<code>getKeyï¼ˆï¼‰</code>æ–¹æ³•æ‹¿åˆ°å…·ä½“ç¼“å­˜çš„keyï¼Œä½¿ç”¨<code>CacheRedisçš„get()</code>æ–¹æ³•æŸ¥æ‰¾å¯¹åº”çš„keyï¼Œå¦‚æœkeyæ‰¾ä¸åˆ°åˆ™ç”¨<code>CacheRedisçš„set()</code>æ–¹æ³•æ·»åŠ æ–°çš„ç¼“å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around</span>(<span class="string">"aspect()&amp;&amp;@annotation(anno)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">interceptor</span><span class="params">(ProceedingJoinPoint invocation, Cache anno)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        MethodSignature signature = (MethodSignature)invocation.getSignature();</span><br><span class="line">        Method method = signature.getMethod();</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span><br><span class="line">        Object[] arguments = invocation.getArgs();</span><br><span class="line">        String key = <span class="string">""</span>;</span><br><span class="line">        String value = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            key = <span class="keyword">this</span>.getKey(anno, parameterTypes, arguments);</span><br><span class="line">            value = <span class="keyword">this</span>.cacheAPI.get(key);</span><br><span class="line">            Type returnType = method.getGenericReturnType();</span><br><span class="line">            result = <span class="keyword">this</span>.getResult(anno, result, value, returnType);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var14) &#123;</span><br><span class="line">            <span class="keyword">this</span>.log.error(<span class="string">"è·å–ç¼“å­˜å¤±è´¥ï¼š"</span> + key, var14);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">                result = invocation.proceed();</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isNotBlank(key)) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.cacheAPI.set(key, result, anno.expire());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h5 id="å–å¾—key"><a href="#å–å¾—key" class="headerlink" title="å–å¾—key"></a>å–å¾—key</h5><p><code>getKeyï¼ˆï¼‰</code>æ–¹æ³•çš„é€»è¾‘ä¸ºï¼Œåˆ¤æ–­keyç”Ÿæˆå™¨æ˜¯å¦æ˜¯é»˜è®¤ç”Ÿæˆå™¨ï¼ˆå¯ä»¥ä½¿ç”¨å¤šç§ç”Ÿæˆå™¨ï¼‰ï¼Œç„¶åæ ¹æ®é»˜è®¤ç”Ÿæˆå™¨çš„è§„åˆ™ç”Ÿæˆä¸€ä¸ªkeyã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getKey</span><span class="params">(Cache anno, Class&lt;?&gt;[] parameterTypes, Object[] arguments)</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException </span>&#123;</span><br><span class="line">        String generatorClsName = anno.generator().getName();</span><br><span class="line">        IKeyGenerator keyGenerator = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (anno.generator().equals(DefaultKeyGenerator.class)) &#123;</span><br><span class="line">            keyGenerator = <span class="keyword">this</span>.keyParser;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.generatorMap.contains(generatorClsName)) &#123;</span><br><span class="line">            keyGenerator = (IKeyGenerator)<span class="keyword">this</span>.generatorMap.get(generatorClsName);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            keyGenerator = (IKeyGenerator)anno.generator().newInstance();</span><br><span class="line">            <span class="keyword">this</span>.generatorMap.put(generatorClsName, keyGenerator);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String key = keyGenerator.getKey(anno.key(), anno.scope(), parameterTypes, arguments);</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h5 id="keyç”Ÿæˆå™¨"><a href="#keyç”Ÿæˆå™¨" class="headerlink" title="keyç”Ÿæˆå™¨"></a>keyç”Ÿæˆå™¨</h5><p>é»˜è®¤keyç”Ÿæˆå™¨çš„ä»£ç å¦‚ä¸‹ï¼ˆç”Ÿæˆè§„åˆ™æˆ‘çœ‹ä¸æ‡‚ğŸ˜­ï¼‰ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">buildKey</span><span class="params">(String key, CacheScope scope, Class&lt;?&gt;[] parameterTypes, Object[] arguments)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> isFirst = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (key.indexOf(<span class="string">"&#123;"</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            key = key.replace(<span class="string">"&#123;"</span>, <span class="string">":&#123;"</span>);</span><br><span class="line">            Pattern pattern = Pattern.compile(<span class="string">"\\d+\\.?[\\w]*"</span>);</span><br><span class="line">            Matcher matcher = pattern.matcher(key);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(matcher.find()) &#123;</span><br><span class="line">                String tmp = matcher.group();</span><br><span class="line">                String[] express = matcher.group().split(<span class="string">"\\."</span>);</span><br><span class="line">                String i = express[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">int</span> index = Integer.parseInt(i) - <span class="number">1</span>;</span><br><span class="line">                Object value = arguments[index];</span><br><span class="line">                <span class="keyword">if</span> (parameterTypes[index].isAssignableFrom(List.class)) &#123;</span><br><span class="line">                    List result = (List)arguments[index];</span><br><span class="line">                    value = result.get(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (value == <span class="keyword">null</span> || value.equals(<span class="string">"null"</span>)) &#123;</span><br><span class="line">                    value = <span class="string">""</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (express.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                    String field = express[<span class="number">1</span>];</span><br><span class="line">                    value = ReflectionUtils.getFieldValue(value, field);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (isFirst) &#123;</span><br><span class="line">                    key = key.replace(<span class="string">"&#123;"</span> + tmp + <span class="string">"&#125;"</span>, value.toString());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    key = key.replace(<span class="string">"&#123;"</span> + tmp + <span class="string">"&#125;"</span>, <span class="string">"_"</span> + value.toString());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h5 id="keyè§£æ"><a href="#keyè§£æ" class="headerlink" title="keyè§£æ"></a>keyè§£æ</h5><p>å› ä¸ºä½œè€…çš„keyç”Ÿæˆå™¨æŠ–äº†å¾ˆå¤šæœºçµï¼Œå› æ­¤ï¼Œæ‹¿åˆ°keyä»¥åï¼Œè¦å°†ç”Ÿæˆkeyå’Œvalueä¹‹å‰çš„æ•°å€¼æ‰¾åˆ°æ‰èƒ½è¿›è¡Œæ¯”å¯¹ï¼Œä¸‹é¢æ—¶è§£ækeyçš„ä»£ç ğŸ‘‡å¤§æ¦‚é€»è¾‘æ˜¯æ ¹æ®ä¸åŒçš„valueç±»å‹è¿”å›json</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">parse</span><span class="params">(String value, Type type, Class... origins)</span> </span>&#123;</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (type <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">            ParameterizedType parameterizedType = (ParameterizedType)type;</span><br><span class="line">            Type rawType = parameterizedType.getRawType();</span><br><span class="line">            <span class="keyword">if</span> (((Class)rawType).isAssignableFrom(List.class)) &#123;</span><br><span class="line">                result = JSON.parseArray(value, (Class)parameterizedType.getActualTypeArguments()[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (origins == <span class="keyword">null</span>) &#123;</span><br><span class="line">            result = JSON.parseObject(value, (Class)type);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result = JSON.parseObject(value, origins[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ‡é¢æ¸…é™¤ç¼“å­˜"><a href="#åˆ‡é¢æ¸…é™¤ç¼“å­˜" class="headerlink" title="åˆ‡é¢æ¸…é™¤ç¼“å­˜"></a>åˆ‡é¢æ¸…é™¤ç¼“å­˜</h4><p>å¤§æ¦‚æ„æ€å’Œä¸Šé¢å·®ä¸å¤šï¼Œåªè¦æœåŠ¡ç«¯ä¸ŠåŠ å…¥<code>@CacheClear</code>æ³¨è§£å°±å¯ä»¥æ¸…é™¤å¯¹åº”ç¼“å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around</span>(<span class="string">"aspect()&amp;&amp;@annotation(anno)"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">interceptor</span><span class="params">(ProceedingJoinPoint invocation, CacheClear anno)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">       MethodSignature signature = (MethodSignature)invocation.getSignature();</span><br><span class="line">       Method method = signature.getMethod();</span><br><span class="line">       Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span><br><span class="line">       Object[] arguments = invocation.getArgs();</span><br><span class="line">       String key = <span class="string">""</span>;</span><br><span class="line">       <span class="keyword">if</span> (StringUtils.isNotBlank(anno.key())) &#123;</span><br><span class="line">           key = <span class="keyword">this</span>.getKey(anno, anno.key(), CacheScope.application, parameterTypes, arguments);</span><br><span class="line">           <span class="keyword">this</span>.cacheAPI.remove(key);</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isNotBlank(anno.pre())) &#123;</span><br><span class="line">           key = <span class="keyword">this</span>.getKey(anno, anno.pre(), CacheScope.application, parameterTypes, arguments);</span><br><span class="line">           <span class="keyword">this</span>.cacheAPI.removeByPre(key);</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (anno.keys().length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">           String[] arr$ = anno.keys();</span><br><span class="line">           <span class="keyword">int</span> len$ = arr$.length;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">int</span> i$ = <span class="number">0</span>; i$ &lt; len$; ++i$) &#123;</span><br><span class="line">               String tmp = arr$[i$];</span><br><span class="line">               tmp = <span class="keyword">this</span>.getKey(anno, tmp, CacheScope.application, parameterTypes, arguments);</span><br><span class="line">               <span class="keyword">this</span>.cacheAPI.removeByPre(tmp);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‰ä¸€æ®µæ—¶é—´åœ¨&lt;a href=&quot;https://blog.tengshe789.tech/2018/12/02/%E6%84%9F%E6%80%A7%E8%AE%A4%E8%AF%86jwt/#more&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;â€œæ„Ÿæ€§è®¤
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="æºç " scheme="https://tengshe789.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="å­¦å¥½åˆ†å¸ƒå¼æ¶æ„" scheme="https://tengshe789.github.io/tags/%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†</title>
    <link href="https://tengshe789.github.io/2018/12/08/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E6%A2%B3%E7%90%86/"/>
    <id>https://tengshe789.github.io/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/</id>
    <published>2018-12-08T01:35:23.000Z</published>
    <updated>2019-11-20T13:39:41.280Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å…¬å¸å­¦ä¹ äº†æ¥è¿‘ä¸€ä¸ªæœˆã€‚ </p><p>ä¸€ä¸ªæœˆå†…ï¼Œä»0å¼€å§‹å¼€å§‹æ¥è§¦åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ï¼Œç»™äº†æˆ‘ä¸å°çš„æ”¶è·ã€‚ä»Šå¤©ï¼Œæˆ‘æ¥ä»å¤´åˆ°å°¾æ¢³ç†ä¸€ä¸‹ï¼Œæœ‰å…³å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒå†…å®¹ï¼ˆå…¨æ˜¯å¹²è´§ï¼‰ã€‚</p><p>ä¸‹æ–‡ï¼Œä½ å°†çœ‹åˆ°ä¸šç•Œä¸»æµå¾®æœåŠ¡æ¡†æ¶çš„æ ¸å¿ƒåŸç†ï¼ŒåŒ…æ‹¬æœåŠ¡å‘ç°ï¼Œç½‘å…³ï¼Œé…ç½®ä¸­å¿ƒï¼Œç›‘æ§ç­‰ç»„ä»¶ï¼ŒåŠŸèƒ½å’Œæ¶æ„åŸç†çš„ç®€å•ä»‹ç»ã€‚æ„Ÿè°¢é˜…è¯»ï¼ğŸ˜‹</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a>ã€‚ğŸ˜</p><h2 id="Helloï¼ŒMicroservices"><a href="#Helloï¼ŒMicroservices" class="headerlink" title="Helloï¼ŒMicroservices"></a>Helloï¼ŒMicroservices</h2><h3 id="ä»€ä¹ˆæ˜¯å¾®æœåŠ¡"><a href="#ä»€ä¹ˆæ˜¯å¾®æœåŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯å¾®æœåŠ¡"></a>ä»€ä¹ˆæ˜¯å¾®æœåŠ¡</h3><p>å¾®æœåŠ¡Microservicesä¹‹çˆ¶ï¼Œé©¬ä¸.ç¦å‹’ï¼Œå¯¹å¾®æœåŠ¡å¤§æ¦‚çš„æ¦‚è¿°å¦‚ä¸‹ï¼š</p><blockquote><p>å°±ç›®å‰è€Œè¨€ï¼Œå¯¹äºå¾®æœåŠ¡ä¸šç•Œå¹¶æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ã€æ ‡å‡†çš„å®šä¹‰ï¼ˆWhile there is no precise definition of this architectural style ) ã€‚<br>ä½†é€šåœ¨å…¶å¸¸è€Œè¨€ï¼Œå¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§æ¶æ„æ¨¡å¼æˆ–è€…è¯´æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå®ƒæå€¡å°†å•ä¸€åº”ç”¨ç¨‹åºåˆ’åˆ†æˆä¸€ç»„å°çš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œç‹¬ç«‹çš„è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡ä¹‹é—´äº’ç›¸åè°ƒã€äº’ç›¸é…åˆï¼Œä¸ºç”¨æˆ·æä¾›æœ€ç»ˆä»·å€¼ã€‚æœåŠ¡ä¹‹é—´é‡‡ç”¨è½»é‡çº§çš„é€šä¿¡æœºåˆ¶äº’ç›¸æ²Ÿé€šï¼ˆé€šå¸¸æ˜¯åŸºäº HTTP çš„ RESTful API ) ã€‚æ¯ä¸ªæœåŠ¡éƒ½å›´ç»•ç€å…·ä½“ä¸šåŠ¡è¿›è¡Œæ„å»ºï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«ç‹¬ç«‹åœ°éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€ç±»ç”Ÿäº§ç¯å¢ƒç­‰ã€‚<br>å¦å¤–ï¼Œåº”å°½é‡é¿å…ç»Ÿä¸€çš„ã€é›†ä¸­å¼çš„æœåŠ¡ç®¡ç†æœºåˆ¶ï¼Œå¯¹å…·ä½“çš„ä¸€ä¸ªæœåŠ¡è€Œè¨€ï¼Œåº”æ ¹æ®ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼Œé€‰æ‹©åˆé€‚çš„è¯­è¨€ã€å·¥å…·å¯¹å…¶è¿›è¡Œæ„å»ºï¼Œå¯ä»¥æœ‰ä¸€ä¸ªéå¸¸è½»é‡çº§çš„é›†ä¸­å¼ç®¡ç†æ¥åè°ƒè¿™äº›æœåŠ¡ã€‚å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€æ¥ç¼–å†™æœåŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®å­˜å‚¨ã€‚</p></blockquote><p>æ ¹æ®é©¬ä¸.ç¦å‹’çš„æè¿°ï¼Œæˆ‘æ€»ç»“äº†ä¸€ä¸‹å‡ ç‚¹ï¼š</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/2.jpg" alt="åº·å¨å®šå¾‹"></p><p>ï¼ˆå­—å·®ï¼Œå‹¿å«Œï¼‰</p><h4 id="å°æœåŠ¡"><a href="#å°æœåŠ¡" class="headerlink" title="å°æœåŠ¡"></a>å°æœåŠ¡</h4><p>å°æœåŠ¡ï¼Œæ²¡æœ‰ç‰¹å®šçš„æ ‡å‡†æˆ–è€…è§„èŒƒï¼Œä½†ä»–åœ¨æ€»ä½“è§„èŒƒä¸Šä¸€å®šæ˜¯å°çš„ã€‚</p><h4 id="è¿›ç¨‹ç‹¬ç«‹"><a href="#è¿›ç¨‹ç‹¬ç«‹" class="headerlink" title="è¿›ç¨‹ç‹¬ç«‹"></a>è¿›ç¨‹ç‹¬ç«‹</h4><p>æ¯ä¸€ç»„æœåŠ¡éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œå¯èƒ½æˆ‘è¿™ä¸ªæœåŠ¡è¿è¡Œåœ¨<code>tomcat</code>å®¹å™¨ï¼Œè€Œå¦ä¸€ä¸ªæœåŠ¡è¿è¡Œåœ¨<code>jetty</code>ä¸Šã€‚å¯ä»¥é€šè¿‡è¿›ç¨‹æ–¹å¼ï¼Œä¸æ–­çš„æ¨ªå‘æ‰©å±•æ•´ä¸ªæœåŠ¡ã€‚</p><h4 id="é€šä¿¡"><a href="#é€šä¿¡" class="headerlink" title="é€šä¿¡"></a>é€šä¿¡</h4><p>è¿‡å»çš„åè®®éƒ½æ˜¯å¾ˆé‡çš„ï¼Œå°±åƒESBï¼Œå°±åƒSOAPï¼Œè½»é€šä¿¡ï¼Œç€æ„å‘³ç€ç›¸æ¯”è¿‡å»æ›´æ™ºèƒ½æ›´è½»é‡çš„æœåŠ¡ç›¸äº’è°ƒç”¨ï¼Œå°±æ‰€è°“smart endpoints and dumb pipesï¼Œè¿™äº›endpointéƒ½æ˜¯è§£è€¦çš„ï¼Œå®Œæˆä¸€ä¸ªä¸šåŠ¡é€šä¿¡è°ƒç”¨ä¸²èµ·è¿™äº›micro serviceå°±åƒæ˜¯linuxç³»ç»Ÿä¸­é€šè¿‡ç®¡é“ä¸²èµ·ä¸€ç³»åˆ—å‘½ä»¤ä¸šåŠ¡ã€‚</p><p>è¿‡å»çš„ä¸šåŠ¡ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè€ƒè™‘å„ç§å„æ ·çš„ä¾èµ–å…³ç³»ï¼Œè€ƒè™‘ç³»ç»Ÿè€¦åˆå¸¦æ¥çš„é—®é¢˜ã€‚å¾®æœåŠ¡ï¼Œå¯ä»¥è®©å¼€å‘è€…æ›´ä¸“æ³¨äºä¸šåŠ¡çš„é€»è¾‘å¼€å‘ã€‚</p><h4 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h4><p>ä¸æ­¢ä¸šåŠ¡è¦ç‹¬ç«‹ï¼Œéƒ¨ç½²ä¹Ÿè¦ç‹¬ç«‹ã€‚ä¸è¿‡è¿™ä¹Ÿæ„å‘³ç€ï¼Œä¼ ç»Ÿçš„å¼€å‘æµç¨‹ä¼šå‡ºç°ä¸€å®šç¨‹åº¦çš„æ”¹å˜ï¼Œå¼€å‘çš„é€‚åˆä¹Ÿè¦æœ‰ä¸€å®šçš„è¿ç»´æŒ‡è´£</p><h4 id="ç®¡ç†"><a href="#ç®¡ç†" class="headerlink" title="ç®¡ç†"></a>ç®¡ç†</h4><p>ä¼ ç»Ÿçš„ä¼ä¸šçº§SOAæœåŠ¡å¾€å¾€å¾ˆå¤§ï¼Œä¸æ˜“äºç®¡ç†ï¼Œè€¦åˆæ€§é«˜ï¼Œå›¢é˜Ÿå¼€å‘æˆæœ¬æ¯”è¾ƒå¤§ã€‚å¾®æœåŠ¡ï¼Œå¯ä»¥è®©å›¢é˜Ÿå„æ€å…¶æ”¿çš„é€‰æ‹©æŠ€æœ¯å®ç°ï¼Œä¸åŒçš„serviceå¯ä»¥æ ¹æ®å„è‡ªçš„éœ€è¦é€‰æ‹©ä¸åŒçš„æŠ€æœ¯æ ˆæ¥å®ç°å…¶ä¸šåŠ¡é€»è¾‘ã€‚</p><h3 id="å¾®æœåŠ¡çš„åˆ©ä¸å¼Š"><a href="#å¾®æœåŠ¡çš„åˆ©ä¸å¼Š" class="headerlink" title="å¾®æœåŠ¡çš„åˆ©ä¸å¼Š"></a>å¾®æœåŠ¡çš„åˆ©ä¸å¼Š</h3><p>ä¸ºä»€ä¹ˆç”¨å¾®æœåŠ¡å‘¢ï¼Ÿå› ä¸ºå¥½ç©ï¼Ÿ</p><p>ä¸æ˜¯çš„ã€‚ä¸‹é¢æ˜¯æˆ‘ä»ç½‘ç»œä¸Šæ‰¾åˆ°è¯´çš„æ¯”è¾ƒå…¨çš„ä¼˜ç‚¹ï¼š</p><blockquote><ul><li><p>ä¼˜ç‚¹æ¯ä¸ªæœåŠ¡è¶³å¤Ÿå†…èšï¼Œè¶³å¤Ÿå°ï¼Œä»£ç å®¹æ˜“ç†è§£è¿™æ ·èƒ½èšç„¦ä¸€ä¸ªæŒ‡å®šçš„ä¸šåŠ¡åŠŸèƒ½æˆ–ä¸šåŠ¡éœ€æ±‚</p></li><li><p>å¼€å‘ç®€å•ã€å¼€å‘æ•ˆç‡æé«˜ï¼Œä¸€ä¸ªæœåŠ¡å¯èƒ½å°±æ˜¯ä¸“ä¸€çš„åªå¹²ä¸€ä»¶äº‹ã€‚</p></li><li>å¾®æœåŠ¡èƒ½å¤Ÿè¢«å°å›¢é˜Ÿå•ç‹¬å¼€å‘ï¼Œè¿™ä¸ªå°å›¢é˜Ÿæ˜¯ 2 åˆ° 5 äººçš„å¼€å‘äººå‘˜ç»„æˆã€‚</li><li>å¾®æœåŠ¡æ˜¯æ¾è—•åˆçš„ï¼Œæ˜¯æœ‰åŠŸèƒ½æ„ä¹‰çš„æœåŠ¡ï¼Œæ— è®ºæ˜¯åœ¨å¼€å‘é˜¶æ®µæˆ–éƒ¨ç½²é˜¶æ®µéƒ½æ˜¯ç‹¬ç«‹çš„ã€‚</li><li>å¾®æœåŠ¡èƒ½ä½¿ç”¨ä¸åŒçš„è¯­è¨€å¼€å‘ã€‚</li><li>æ˜“äºå’Œç¬¬ä¸‰æ–¹é›†æˆï¼Œå¾®æœåŠ¡å…è®¸å®¹æ˜“ä¸”çµæ´»çš„æ–¹å¼é›†æˆè‡ªåŠ¨éƒ¨ç½²ï¼Œé€šè¿‡æŒç»­é›†æˆå·¥å…·ï¼Œå¦‚Jenkins,Hudson,bambooã€‚</li><li>å¾®æœåŠ¡æ˜“äºè¢«ä¸€ä¸ªå¼€å‘äººå‘˜ç†è§£ï¼Œä¿®æ”¹å’Œç»´æŠ¤ï¼Œè¿™æ ·å°å›¢é˜Ÿèƒ½å¤Ÿæ›´å…³æ³¨è‡ªå·±çš„å·¥ä½œæˆæœã€‚æ— éœ€- - é€šè¿‡åˆä½œæ‰èƒ½ä½“ç°ä»·å€¼ã€‚å¾®æœåŠ¡å…è®¸ä½ åˆ©ç”¨èåˆæœ€æ–°æŠ€æœ¯ã€‚</li><li>å¾®æœåŠ¡åªæ˜¯ä¸šåŠ¡é€»è¾‘çš„ä»£ç ï¼Œä¸ä¼šå’Œ HTML,CSSæˆ–å…¶ä»–ç•Œé¢ç»„ä»¶æ··åˆã€‚</li><li>æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„å­˜å‚¨èƒ½åŠ›ï¼Œå¯ä»¥æœ‰è‡ªå·±çš„æ•°æ®åº“ã€‚ä¹Ÿå¯ä»¥æœ‰ç»Ÿä¸€æ•°æ®åº“ã€‚</li></ul></blockquote><p>æ€»çš„æ¥è¯´ï¼Œå¾®æœåŠ¡çš„ä¼˜åŠ¿ï¼Œå°±æ˜¯åœ¨äºï¼Œé¢å¯¹å¤§çš„ç³»ç»Ÿï¼Œå¯ä»¥æœ‰æ•ˆçš„å‡å°‘å¤æ‚ç¨‹åº¦ï¼Œä½¿æœåŠ¡æ¶æ„çš„é€»è¾‘æ›´æ¸…æ™°æ˜äº†ã€‚</p><p>ä½†æ˜¯è¿™æ ·ä¹Ÿä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ï¼Œå°±è­¬å¦‚åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æ•°æ®ä¸€è‡´æ€§ï¼Œæµ‹è¯•çš„å¤æ‚æ€§ï¼Œè¿ç»´çš„å¤æ‚æ€§ã€‚</p><h3 id="ä»€ä¹ˆç»„ç»‡é€‚åˆä½¿ç”¨å¾®æœåŠ¡ï¼Ÿ"><a href="#ä»€ä¹ˆç»„ç»‡é€‚åˆä½¿ç”¨å¾®æœåŠ¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆç»„ç»‡é€‚åˆä½¿ç”¨å¾®æœåŠ¡ï¼Ÿ"></a>ä»€ä¹ˆç»„ç»‡é€‚åˆä½¿ç”¨å¾®æœåŠ¡ï¼Ÿ</h3><p>å¾®æœåŠ¡å¸¦äº†ç§ç§ä¼˜ç‚¹ï¼Œç§ç§å¼Šç«¯ï¼Œé‚£ä¹ˆä»€ä¹ˆç»„ç»‡é€‚åˆä½¿ç”¨å¾®æœåŠ¡ï¼Ÿ</p><h4 id="å¢¨è²å®šå¾‹ï¼ˆè®¾è®¡ç³»ç»Ÿï¼‰å’Œåº·å¨å®šå¾‹ï¼ˆç³»ç»Ÿåˆ’åˆ†ï¼‰"><a href="#å¢¨è²å®šå¾‹ï¼ˆè®¾è®¡ç³»ç»Ÿï¼‰å’Œåº·å¨å®šå¾‹ï¼ˆç³»ç»Ÿåˆ’åˆ†ï¼‰" class="headerlink" title="å¢¨è²å®šå¾‹ï¼ˆè®¾è®¡ç³»ç»Ÿï¼‰å’Œåº·å¨å®šå¾‹ï¼ˆç³»ç»Ÿåˆ’åˆ†ï¼‰"></a>å¢¨è²å®šå¾‹ï¼ˆè®¾è®¡ç³»ç»Ÿï¼‰å’Œåº·å¨å®šå¾‹ï¼ˆç³»ç»Ÿåˆ’åˆ†ï¼‰</h4><p>åº·å¨å®šå¾‹ï¼Œæ˜¯ä¸€ä¸ªäº”åå¤šå¹´å‰å°±è¢«æå‡ºæ¥çš„å¾®æœåŠ¡æ¦‚å¿µã€‚åœ¨åº·å¨çš„è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæœ€æœ‰åçš„ä¸€å¥è¯å°±æ˜¯ï¼š</p><blockquote><p>Organizations which design systems are constrained to produce designs which are copies of the communication structures of these organizations. - Melvin Conway(1967)</p></blockquote><p>ä¸­æ–‡ç›´è¯‘å¤§æ¦‚çš„æ„æ€å°±æ˜¯ï¼šè®¾è®¡ç³»ç»Ÿçš„ç»„ç»‡ï¼Œå…¶äº§ç”Ÿçš„è®¾è®¡ç­‰åŒäºç»„ç»‡ä¹‹å†…ã€ç»„ç»‡ä¹‹é—´çš„æ²Ÿé€šç»“æ„ã€‚çœ‹çœ‹ä¸‹é¢çš„å›¾ç‰‡ï¼ˆæ¥æºäºäº’è”ç½‘ï¼Œä¾µåˆ ï¼‰ï¼Œå†æƒ³æƒ³Appleçš„äº§å“ã€å¾®è½¯çš„äº§å“è®¾è®¡ï¼Œå°±èƒ½å½¢è±¡ç”ŸåŠ¨çš„ç†è§£è¿™å¥è¯ã€‚</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/åº·å¨å®šå¾‹.png" alt="åº·å¨å®šå¾‹"></p><p>æ„Ÿå…´è¶£çš„å„ä½å¯ä»¥ç ”ç©¶ä¸€ä¸‹</p><h4 id="æ¶æ„æ¼”åŒ–"><a href="#æ¶æ„æ¼”åŒ–" class="headerlink" title="æ¶æ„æ¼”åŒ–"></a>æ¶æ„æ¼”åŒ–</h4><p>æ¶æ„æ˜¯ä¸æ–­æ¼”åŒ–å‡ºæ¥çš„ï¼Œå¾®æœåŠ¡ä¹Ÿæ˜¯è¿™æ ·ï¼Œå½“ä»å„å¤§ç§‘æŠ€å…¬å¸ï¼Œè§„æ¨¡å¤§åˆ°ä¸€å®šç¨‹åº¦ï¼Œå®Œå…¨éœ€è¦æ¼”åŒ–æˆæ›´è¿›ä¸€æ­¥ç®¡ç†çš„æŠ€æœ¯æ¶æ„ä½“ç³»ã€‚</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/3.jpg" alt="åº·å¨å®šå¾‹"></p><p>ï¼ˆå­—å·®ï¼Œå‹¿å«Œï¼‰</p><p>ä¼ ç»Ÿçš„å›¢é˜Ÿï¼Œéƒ½æ˜¯é¢å‘è¿‡ç¨‹åŒ–çš„ï¼Œäº§å“æƒ³å®Œäº†å»æ‰¾ç­–åˆ’ï¼Œç­–åˆ’å®Œäº†æ‰¾å¼€å‘ï¼Œæ¥ç€é¡ºç€ä¸€æ­¥ä¸€æ­¥æ‰¾ã€‚æˆ‘ä»¬åšæŠ€æœ¯éƒ½æ˜¯ä¸ºäº†äº§å“çš„ï¼Œä¸€æ—¦è¿‡ç¨‹å‡ºæ¥äº†ä»€ä¹ˆé—®é¢˜ï¼Œå›æº¯å¯»æ‰¾é—®é¢˜ä¼šéå¸¸è€—æ—¶ã€‚</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/4.jpg" alt="åº·å¨å®šå¾‹"></p><p>ï¼ˆå­—å·®ï¼Œå‹¿å«Œï¼‰</p><p>ä½¿ç”¨äº†å¾®æœåŠ¡æ¶æ„ä½“ç³»ï¼Œå›¢é˜Ÿç»„ç»‡æ–¹å¼éœ€è¦è½¬å˜æˆè·¨èŒèƒ½å›¢é˜Ÿï¼Œå³æ¯ä¸ªå›¢é˜Ÿéƒ½æœ‰äº§å“ä¸“å®¶ï¼Œç­–åˆ’ä¸“å®¶ï¼Œå¼€å‘ä¸“å®¶ï¼Œè¿ç»´ä¸“å®¶ï¼Œä»–ä»¬ä½¿ç”¨APIæ–¹å¼å‘å¸ƒä»–ä»¬çš„åŠŸèƒ½ï¼Œè€Œå¹³å°ä½¿ç”¨ä»–ä»¬çš„åŠŸèƒ½å‘å¸ƒäº§å“</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/6.png" alt="DevOps"></p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/18.jpg" alt="devops"></p><h2 id="å¾®æœåŠ¡æŠ€æœ¯æ¶æ„ä½“ç³»"><a href="#å¾®æœåŠ¡æŠ€æœ¯æ¶æ„ä½“ç³»" class="headerlink" title="å¾®æœåŠ¡æŠ€æœ¯æ¶æ„ä½“ç³»"></a>å¾®æœåŠ¡æŠ€æœ¯æ¶æ„ä½“ç³»</h2><p>ä¸‹é¢æˆ‘åˆ†äº«ä¸€ä¸‹å¤§éƒ¨åˆ†å…¬å¸éƒ½ä½¿ç”¨çš„å¾®æœåŠ¡æŠ€æœ¯æ¶æ„ä½“ç³»ã€‚</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/7.jpg" alt="åº·å¨å®šå¾‹"></p><p>ï¼ˆå›¾å·®ï¼Œå‹¿å«Œï¼‰</p><h3 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="headerlink" title="æœåŠ¡å‘ç°"></a>æœåŠ¡å‘ç°</h3><p>ä¸»æµçš„æœåŠ¡å‘ç°ï¼Œåˆ†ä¸ºä¸‰ç§</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/8.jpg" alt="åº·å¨å®šå¾‹"></p><p>ç¬¬ä¸€ç§ï¼Œå¼€å‘äººå‘˜å¼€å‘äº†ç¨‹åºä»¥åï¼Œä¼šæ‰¾è¿ç»´é…ä¸€ä¸ªåŸŸåï¼ŒæœåŠ¡çš„è¯é€šè¿‡dnså°±èƒ½æ‰¾åˆ°æˆ‘ä»¬å¯¹åº”çš„æœåŠ¡</p><p>ç¼ºç‚¹æ˜¯ï¼Œç”±äºæœåŠ¡æ²¡æœ‰è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œå¯¹è´Ÿè½½å‡è¡¡æœåŠ¡ï¼Œå¯èƒ½ä¼šæœ‰ç›¸å½“å¤§çš„æ€§èƒ½é—®é¢˜ã€‚</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/9.jpg" alt="åº·å¨å®šå¾‹"></p><p>ç¬¬äºŒç§ï¼Œæ˜¯ç›®å‰æ™®éçš„åšæ³•ã€‚å¯ä»¥å‚è€ƒæˆ‘ä¸Šç¯‡åšå®¢åˆ†æçš„zuulç½‘å…³ï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½é€šè¿‡æœåŠ¡ç«¯å†…ç½®çš„åŠŸèƒ½æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼ŒæœåŠ¡æ¶ˆè´¹è€…ä¸æ–­è½®è¯¢æ³¨å†Œä¸­å¿ƒå‘ç°å¯¹åº”çš„æœåŠ¡ï¼Œä½¿ç”¨å†…ç½®è´Ÿè½½å‡è¡¡è°ƒç”¨æœåŠ¡ã€‚</p><p>ç¼ºç‚¹æ˜¯ï¼Œå¯¹å¤šè¯­è¨€ç¯å¢ƒä¸æ˜¯å¾ˆå¥½ï¼Œä½ éœ€è¦å•ç‹¬ç»™æ¶ˆè´¹è€…çš„å®¢æˆ·ç«¯å¼€å‘æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚å½“ç„¶äº†ï¼Œè¿™ä¸ªæ–¹æ³•é€šå¸¸éƒ½æ˜¯ç”¨åœ¨<code>spring cloud</code>ä¸Šçš„ã€‚</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/10.jpg" alt="åº·å¨å®šå¾‹"></p><p>ç¬¬ä¸‰ç§ï¼Œæ˜¯å°†å®¢æˆ·ç«¯å’Œè´Ÿè½½å‡è¡¡æ”¾åœ¨åŒä¸€ä¸ªä¸»æœºï¼Œè€Œä¸æ˜¯åŒä¸€ä¸ªè¿›ç¨‹å†…ã€‚</p><p>è¿™ç§æ–¹æ³•ç›¸å¯¹ç¬¬ä¸€ç§ç¬¬äºŒç§æ–¹æ³•æ¥è¯´ï¼Œæ”¹å–„äº†ä»–ä»¬çš„ç¼ºç‚¹ï¼Œä½†æ˜¯ä¼šæå¤§å¢åŠ è¿ç»´æˆæœ¬ã€‚</p><h3 id="ç½‘å…³"><a href="#ç½‘å…³" class="headerlink" title="ç½‘å…³"></a>ç½‘å…³</h3><h4 id="å¾®æœåŠ¡çš„ç½‘å…³æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å¾®æœåŠ¡çš„ç½‘å…³æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¾®æœåŠ¡çš„ç½‘å…³æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å¾®æœåŠ¡çš„ç½‘å…³æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>æˆ‘ä»¬å¯ä»¥è”ç³»ç”Ÿæ´»å®é™…æƒ³ä¸€ä¸‹ã€‚æ¯ä¸€ä¸ªå¤§çš„å…¬å¸ï¼Œéƒ½ä¼šæœ‰ä¸€åå±äºè‡ªå·±çš„å»ºç­‘åŒºï¼Œè€Œè¿™å»ºç­‘åŒºå†…ï¼Œéƒ½æœ‰ä¸å°‘çš„é—¨å«ã€‚å¦‚æœæœ‰å¤–æ¥äººå‘˜è¿›å…¥å…¬å¸ï¼Œä¼šå…ˆå’Œé—¨å«æ‰“å¥½æ‹›å‘¼ï¼Œæ‰èƒ½è¿›å»ã€‚</p><p>å°†ç”Ÿæ´»å®é™…è”ç³»åˆ°å¾®æœåŠ¡ä¸Šï¼Œå°±ä¸éš¾ç†è§£ç½‘å…³çš„æ„æ€äº†ã€‚</p><h4 id="ç½‘å…³æœ‰ä»€ä¹ˆç”¨"><a href="#ç½‘å…³æœ‰ä»€ä¹ˆç”¨" class="headerlink" title="ç½‘å…³æœ‰ä»€ä¹ˆç”¨"></a>ç½‘å…³æœ‰ä»€ä¹ˆç”¨</h4><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/11.jpg" alt="åº·å¨å®šå¾‹"></p><ul><li>åå‘è·¯ç”±ï¼šå¾ˆå¤šæ—¶å€™ï¼Œå…¬å¸ä¸æƒ³è®©å¤–éƒ¨äººå‘˜çœ‹åˆ°æˆ‘ä»¬å…¬å¸çš„å†…éƒ¨ï¼Œå°±éœ€è¦ç½‘å…³æ¥è¿›è¡Œåå‘è·¯ç”±ã€‚å³å°†å¤–éƒ¨è¯·æ±‚è½¬æ¢æˆå†…éƒ¨å…·ä½“æœåŠ¡æ¡ç”¨</li><li>å®‰å…¨è®¤è¯ï¼šç½‘ç»œä¸­ä¼šæœ‰å¾ˆå¤šæ¶æ„è®¿é—®ï¼Œè­¬å¦‚çˆ¬è™«ï¼Œè­¬å¦‚é»‘å®¢æ”»å‡»ï¼Œç½‘å…³ç»´æŠ¤å®‰å…¨åŠŸèƒ½ã€‚</li><li>é™æµç†”æ–­ï¼šå‚è€ƒæˆ‘å­¦å¥½åˆ†å¸ƒå¼zookepperçš„åšå®¢ï¼Œå½“è¯·æ±‚å¾ˆå¤šæœåŠ¡ä¸å ªé‡è´Ÿï¼Œä¼šè®©æˆ‘ä»¬çš„æœåŠ¡è‡ªåŠ¨å…³é—­ï¼Œå¯¼è‡´ä¸èƒ½ç”¨æœåŠ¡ã€‚é™æµç†”æ–­å¯ä»¥æœ‰æ•ˆçš„é¿å…è¿™ç±»é—®é¢˜</li><li>æ—¥å¿—ç›‘æ§ï¼šæ‰€æœ‰çš„å¤–é¢çš„è¯·æ±‚éƒ½ä¼šç»è¿‡ç½‘å…³ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç½‘å…³æ¥è®°å½•æ—¥å¿—ä¿¡æ¯</li><li>ç°åº¦å‘å¸ƒï¼Œè“ç»¿éƒ¨ç½²ã€‚æ˜¯æŒ‡èƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡çš„ä¸€ç§å‘å¸ƒæ–¹å¼ã€‚åœ¨å…¶ä¸Šå¯ä»¥è¿›è¡ŒA/B testingï¼Œå³è®©ä¸€éƒ¨åˆ†ç”¨æˆ·ç»§ç»­ç”¨äº§å“ç‰¹æ€§Aï¼Œä¸€éƒ¨åˆ†ç”¨æˆ·å¼€å§‹ç”¨äº§å“ç‰¹æ€§Bï¼Œå¦‚æœç”¨æˆ·å¯¹Bæ²¡æœ‰ä»€ä¹ˆåå¯¹æ„è§ï¼Œé‚£ä¹ˆé€æ­¥æ‰©å¤§èŒƒå›´ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·éƒ½è¿ç§»åˆ°Bä¸Šé¢æ¥ã€‚</li></ul><h4 id="å¼€æºç½‘å…³Zuulæ¶æ„"><a href="#å¼€æºç½‘å…³Zuulæ¶æ„" class="headerlink" title="å¼€æºç½‘å…³Zuulæ¶æ„"></a>å¼€æºç½‘å…³Zuulæ¶æ„</h4><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/zuulæ¶æ„.png" alt="zuulæ¶æ„"></p><p><code>zuul</code>ç½‘å…³æ ¸å¿ƒå…¶å®æ˜¯ä¸€ä¸ª<code>servlet</code>ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šç»è¿‡<code>zuul servlet</code>ä¼ åˆ°<code>zuulFilter Runner</code>ï¼Œç„¶ååˆ†å‘åˆ°ä¸‰ç§è¿‡æ»¤å™¨ã€‚</p><p>å…ˆè¯´è¯´æ¶æ„å›¾å·¦åŠéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ä½¿ç”¨<code>Groovy</code>å®ç°çš„å‰ç½®è·¯ç”±è¿‡æ»¤å™¨ï¼Œè·¯ç”±è¿‡æ»¤å™¨ï¼Œåç½®è·¯ç”±è¿‡æ»¤å™¨ã€‚</p><p>ä¸€èˆ¬è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡<strong>å‰ç½®è·¯ç”±è¿‡æ»¤å™¨</strong>å¤„ç†ï¼Œä¸€èˆ¬çš„è‡ªå®šä¹‰javaå°è£…é€»è¾‘ä¹Ÿä¼šåœ¨è¿™é‡Œå®ç°ã€‚</p><p><strong>è·¯ç”±è¿‡æ»¤å™¨</strong>ï¼Œå®ç°çš„æ˜¯æ‰¾åˆ°å¯¹åº”çš„å¾®æœåŠ¡è¿›è¡Œè°ƒç”¨ã€‚</p><p>è°ƒç”¨å®Œäº†ï¼Œå“åº”å›æ¥ï¼Œä¼šç»è¿‡<strong>åç½®è·¯ç”±è¿‡æ»¤å™¨</strong>ï¼Œé€šè¿‡åç½®è·¯ç”±è¿‡æ»¤å™¨æˆ‘ä»¬å¯ä»¥å°è£…æ—¥å¿—å®¡è®¡çš„å¤„ç†ã€‚</p><p>å¯ä»¥è¯´<code>zuul</code>ç½‘å…³æœ€å¤§çš„ç‰¹è‰²å°±æ˜¯å®ƒä¸‰å±‚è¿‡æ»¤å™¨ã€‚</p><p>æ¶æ„å›¾å³åŠéƒ¨åˆ†ï¼Œæ˜¯<code>zuul</code>ç½‘å…³è®¾è®¡çš„è‡ªå®šä¹‰è¿‡æ»¤å™¨åŠ è½½æœºåˆ¶ã€‚ç½‘å…³å†…éƒ¨ä¼šæœ‰ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œè‡ªåŠ¨çš„å°†è¿‡æ»¤å™¨è„šæœ¬å‘å¸ƒåˆ°<code>zuul</code>ç½‘å…³è¯»å–åŠ è½½è¿è¡Œã€‚</p><h3 id="é…ç½®ä¸­å¿ƒ"><a href="#é…ç½®ä¸­å¿ƒ" class="headerlink" title="é…ç½®ä¸­å¿ƒ"></a>é…ç½®ä¸­å¿ƒ</h3><p>ä»¥å‰ï¼Œå¼€å‘äººå‘˜æŠŠé…ç½®æ–‡ä»¶æ”¾åœ¨å¼€å‘æ–‡ä»¶é‡Œé¢ï¼Œè¿™æ ·ä¼šæœ‰å¾ˆå¤šéšæ‚£ã€‚è­¬å¦‚ï¼Œé…ç½®è§„èŒƒä¸åŒï¼Œæ— æ³•è¿½æº¯é…ç½®äººå‘˜ã€‚ä¸€æ—¦éœ€è¦å¤§è§„æ¨¡æ”¹åŠ¨é…ç½®ï¼Œæ”¹åŠ¨æ—¶é—´ä¼šå¾ˆé•¿ï¼Œæ— æ³•è¿½æº¯é…ç½®äººå‘˜ï¼Œä»è€Œå½±å“æ•´ä¸ªäº§å“ï¼Œåæœæ˜¯æˆ‘ä»¬æ‰¿æ‹…ä¸èµ·çš„ã€‚</p><p>å› æ­¤å°±æœ‰é…ç½®ä¸­å¿ƒè¿™ä¸ªå–½~</p><p>ç°åœ¨çš„å¼€æºä¸­å¿ƒæœ‰<em>ç™¾åº¦é…ç½®ä¸­å¿ƒ</em> Disconfï¼Œspring cloud configï¼ŒApolloï¼Œä»Šå¤©é‡ç‚¹è¯´è¯´ç°åœ¨åº”ç”¨è´¨é‡ä¸é”™çš„é…ç½®ä¸­å¿ƒé˜¿æ³¢ç½—ã€‚</p><h4 id="æºç¨‹å¼€æºçš„Apollo"><a href="#æºç¨‹å¼€æºçš„Apollo" class="headerlink" title="æºç¨‹å¼€æºçš„Apollo"></a>æºç¨‹å¼€æºçš„Apollo</h4><p>å¼€æºåœ°å€ğŸ‘‰ï¼š<a href="https://github.com/ctripcorp/apollo" target="_blank" rel="noopener">https://github.com/ctripcorp/apollo</a></p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/12.jpg" alt="åº·å¨å®šå¾‹"></p><p>apolloçš„é…ç½®ä¸­å¿ƒè§„æ¨¡æ¯”è¾ƒå¤§ï¼Œæœ¬åœ°åº”ç”¨ä¼šæœ‰å“åº”çš„é…ç½®ä¸­å¿ƒå®¢æˆ·ç«¯ï¼Œå¯ä»¥å®šæ—¶åŒæ­¥é…ç½®ä¸­å¿ƒé‡Œçš„é…ç½®ã€‚å¦‚æœé…ç½®ä¸­å¿ƒæ€ æœºï¼Œä¼šä½¿ç”¨ç¼“å­˜æ¥è¿›è¡Œé…ç½®ã€‚</p><h3 id="é€šè®¯æ–¹å¼"><a href="#é€šè®¯æ–¹å¼" class="headerlink" title="é€šè®¯æ–¹å¼"></a>é€šè®¯æ–¹å¼</h3><p>å…³äºé€šè®¯æ–¹å¼ï¼Œä¸€èˆ¬å¸‚é¢ä¹Ÿå°±æ˜¯ä¸¤ç§è¿œç¨‹è°ƒç”¨æ–¹å¼ï¼Œæˆ‘æ•´ç†äº†ä¸€ä¸ªè¡¨æ ¼ï¼š</p><table><thead><tr><th></th><th>RPC</th><th>REST</th></tr></thead><tbody><tr><td>è€¦åˆæ€§</td><td>å¼ºè€¦åˆ</td><td>æ¾æ•£è€¦åˆ</td></tr><tr><td>æ¶ˆæ¯åè®®</td><td>TCP</td><td>HTTP</td></tr><tr><td>é€šè®¯åè®®</td><td>äºŒè¿›åˆ¶</td><td>æ–‡æœ¬XMLï¼ŒJson</td></tr><tr><td>æ€§èƒ½</td><td>é«˜</td><td>ä½äºRPC</td></tr><tr><td>æ¥å£å¥‘çº¦IDL</td><td>thrift,protobuf,IdL</td><td>Swagger</td></tr><tr><td>å®¢æˆ·ç«¯</td><td>å¼ºç±»å‹å®¢æˆ·ç«¯ï¼Œä¸€èˆ¬è‡ªåŠ¨ç”Ÿæˆ</td><td>ä¸€èˆ¬HTTPå¯è®¿é—®ï¼Œç”Ÿæˆå¼ºç±»å‹å®¢æˆ·ç«¯ï¼Œå¤šè¯­è¨€æ”¯æŒå¥½</td></tr><tr><td>æ¡ˆä¾‹</td><td>Dubboï¼ŒDubbox,motan,tars,grpc,thrift</td><td>spring boot,tax-rs,dropwizard</td></tr><tr><td>å¼€å‘è€…å‹å¥½</td><td>å®¢æˆ·ç«¯æ¯”è¾ƒæ–¹é¢ï¼ŒäºŒè¿›åˆ¶æ¶ˆæ¯ä¸èƒ½è¯»</td><td>å¯è¯»æ¶ˆæ¯</td></tr><tr><td>å¯¹å¤–å¼€æ”¾</td><td>ä¸€èˆ¬éœ€è¦è½¬æˆREST/æ–‡æœ¬åè®®</td><td>å¯ç›´æ¥å¯¹å¤–å¼€å‘</td></tr></tbody></table><h3 id="ç›‘æ§é¢„è­¦"><a href="#ç›‘æ§é¢„è­¦" class="headerlink" title="ç›‘æ§é¢„è­¦"></a>ç›‘æ§é¢„è­¦</h3><p>ç›‘æ§é¢„è­¦å¯¹äºå¾®æœåŠ¡å¾ˆé‡è¦ï¼Œä¸€ä¸ªå¯é çš„ç›‘æ§é¢„è­¦ä½“ç³»å¯¹å¾®æœåŠ¡è¿è¡Œè‡³å…³é‡è¦ã€‚ä¸€èˆ¬ç›‘æ§åˆ†ä¸ºå¦‚ä¸‹å±‚æ¬¡ï¼š</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/13.jpg" alt="åº·å¨å®šå¾‹"></p><p>ä»åŸºç¡€è®¾æ–½åˆ°ç”¨æˆ·ç«¯ï¼Œå±‚å±‚æœ‰ç›‘æ§ï¼Œå…¨æ–¹ä½ï¼Œå¤šè§’åº¦ï¼Œæ¯ä¸€ä¸ªå±‚é¢éƒ½å¾ˆé‡è¦ã€‚æ€»ä½“æ¥è¯´ï¼Œå¾®æœåŠ¡å¯åˆ†5ä¸ªç›‘æ§ç‚¹ï¼š<strong>æ—¥å¿—ç›‘æ§</strong>ï¼Œ<strong>Metricsç›‘æ§</strong>ï¼Œ<strong>å¥åº·æ£€æŸ¥</strong>ï¼Œ<strong>è°ƒç”¨é“¾æ£€æŸ¥</strong>ï¼Œ<strong>å‘Šè­¦ç³»ç»Ÿ</strong></p><h4 id="ç›‘æ§æ¶æ„"><a href="#ç›‘æ§æ¶æ„" class="headerlink" title="ç›‘æ§æ¶æ„"></a>ç›‘æ§æ¶æ„</h4><p>ä¸‹é¢çš„å›¾æ˜¯å¤§éƒ¨åˆ†å…¬å¸çš„ä¸€ç§ç›‘æ§æ¶æ„å›¾ã€‚æ¯ä¸€ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ª<code>agent</code>ï¼Œ<code>agent</code>æ”¶é›†åˆ°å…³é”®ä¿¡æ¯ï¼Œä¼šä¼ åˆ°ä¸€äº›<em>MQ</em>ä¸­ï¼Œä¸ºäº†è§£è€¦ã€‚åŒæ—¶å°†æ—¥å¿—ä¼ å…¥<em>ELK</em>ï¼Œå°†<em>Metrics</em>ä¼ å…¥<em>InfluxDB</em>æ—¶é—´åºåˆ—åº“ã€‚è€Œåƒ<em>nagios</em>ï¼Œå¯ä»¥å®šæœŸå‘agentå‘èµ·ä¿¡æ¯æ£€æŸ¥å¾®æœåŠ¡ã€‚</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/14.jpg" alt="åº·å¨å®šå¾‹"></p><h4 id="è°ƒç”¨é“¾ç›‘æ§APM"><a href="#è°ƒç”¨é“¾ç›‘æ§APM" class="headerlink" title="è°ƒç”¨é“¾ç›‘æ§APM"></a>è°ƒç”¨é“¾ç›‘æ§APM</h4><p>å¾ˆå¤šå…¬å¸éƒ½æœ‰è°ƒç”¨é“¾ç›‘æ§ï¼Œå°±è­¬å¦‚é˜¿é‡Œæœ‰é¹°çœ¼ç›‘æ§ï¼Œç‚¹è¯„çš„<em>Cat</em>ï¼Œå¤§éƒ¨åˆ†è°ƒç”¨é“¾ç›‘æ§ï¼ˆæ²¡é”™ï¼Œæˆ‘æŒ‡çš„<code>Zipkin</code>ï¼‰æ¶æ„æ˜¯è¿™æ ·çš„ğŸ‘‡</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/15.jpg" alt="åº·å¨å®šå¾‹"></p><p>å½“è¯·æ±‚è¿›å…¥Webå®¹å™¨çš„æ—¶å€™ï¼Œä¼šç»è¿‡åˆ›å»º<code>Tracer</code>ï¼Œè¿æ¥<code>spans</code>ï¼ˆæ¨¡æ‹Ÿæ½œåœ¨çš„åˆ†å¸ƒå¼å·¥ä½œçš„å»¶è¿Ÿï¼Œè¯¥æ¨¡å—è¿˜åŒ…å«åœ¨ç³»ç»Ÿç½‘ç»œé—´ä¼ é€’è·Ÿè¸ªä¸Šä¸‹æ–‡ä¿¡æ¯çš„å·¥å…·åŒ…ï¼Œå¦‚é€šè¿‡http headersï¼‰ã€‚<code>Spans</code>æœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå…¶ä¸­åŒ…å«<code>tracer</code>æ ‡è¯†ç¬¦ï¼Œå°†å…¶æ”¾åœ¨è¡¨ç¤ºåˆ†å¸ƒå¼æ“ä½œçš„æ ‘çš„æ­£ç¡®ä½ç½®ã€‚å½“æˆ‘ä»¬æŠŠå›¾ä¸­çš„å„ç§spanæ”¾åˆ°åç«¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„æœåŠ¡è°ƒç”¨é“¾ä¼šåŠ¨æ€çš„ç”Ÿæˆè°ƒç”¨é“¾ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›å¸‚åœºä¸Šç”¨çš„æ¯”è¾ƒå¤šçš„è°ƒç”¨é“¾ç›‘æ§ï¼š</p><p>  <strong>1ã€Pinpoint</strong><br>githubåœ°å€ï¼š<a href="https://blog.csdn.net/mbugatti/article/details/53405203" target="_blank" rel="noopener">GitHub - naver/pinpoint: Pinpoint is an open source APM (Application Performance Management) tool for large-scale distributed systems written in Java.</a><br>å¯¹javaé¢†åŸŸçš„æ€§èƒ½åˆ†ææœ‰å…´è¶£çš„æœ‹å‹éƒ½åº”è¯¥çœ‹çœ‹è¿™ä¸ªå¼€æºé¡¹ç›®ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªéŸ©å›½å›¢é˜Ÿå¼€æºå‡ºæ¥çš„ï¼Œé€šè¿‡JavaAgentçš„æœºåˆ¶æ¥åšå­—èŠ‚ç ä»£ç æ¤å…¥ï¼Œå®ç°åŠ å…¥traceidå’ŒæŠ“å–æ€§èƒ½æ•°æ®çš„ç›®çš„ã€‚<br>NewRelicã€Oneapmä¹‹ç±»çš„å·¥å…·åœ¨javaå¹³å°ä¸Šçš„æ€§èƒ½åˆ†æä¹Ÿæ˜¯ç±»ä¼¼çš„æœºåˆ¶ã€‚</p><p><strong>2ã€SkyWalking</strong><br>githubåœ°å€ï¼š<a href="https://blog.csdn.net/mbugatti/article/details/53405203" target="_blank" rel="noopener">wu-sheng/sky-walking</a><br>è¿™æ˜¯å›½å†…ä¸€ä½å«å´æ™Ÿçš„å…„å¼Ÿå¼€æºçš„ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯¹JAVAåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºé›†ç¾¤çš„ä¸šåŠ¡è¿è¡Œæƒ…å†µè¿›è¡Œè¿½è¸ªã€å‘Šè­¦å’Œåˆ†æçš„ç³»ç»Ÿï¼Œåœ¨githubä¸Šä¹Ÿæœ‰400å¤šé¢—æ˜Ÿäº†ã€‚<br>åŠŸèƒ½ç›¸å¯¹pinpointè¿˜æ˜¯ç¨å¼±ä¸€äº›ï¼Œæ’ä»¶è¿˜æ²¡é‚£ä¹ˆä¸°å¯Œï¼Œä¸è¿‡ä¹Ÿå¾ˆéš¾å¾—äº†ã€‚</p><p><strong>3ã€Zipkin</strong><br>å®˜ç½‘ï¼š<a href="https://blog.csdn.net/mbugatti/article/details/53405203" target="_blank" rel="noopener">OpenZipkin Â· A distributed tracing system</a><br>githubåœ°å€ï¼š<a href="https://blog.csdn.net/mbugatti/article/details/53405203" target="_blank" rel="noopener">GitHub - openzipkin/zipkin: Zipkin is a distributed tracing system</a><br>è¿™ä¸ªæ˜¯twitterå¼€æºå‡ºæ¥çš„ï¼Œä¹Ÿæ˜¯å‚è€ƒDapperçš„ä½“ç³»æ¥åšçš„ã€‚</p><p>Zipkinçš„javaåº”ç”¨ç«¯æ˜¯é€šè¿‡ä¸€ä¸ªå«Braveçš„ç»„ä»¶æ¥å®ç°å¯¹åº”ç”¨å†…éƒ¨çš„æ€§èƒ½åˆ†ææ•°æ®é‡‡é›†ã€‚<br>Braveçš„githubåœ°å€ï¼š<a href="https://blog.csdn.net/mbugatti/article/details/53405203" target="_blank" rel="noopener">https://github.com/openzipkin/brave</a><br>è¿™ä¸ªç»„ä»¶é€šè¿‡å®ç°ä¸€ç³»åˆ—çš„javaæ‹¦æˆªå™¨ï¼Œæ¥åšåˆ°å¯¹http/servletè¯·æ±‚ã€æ•°æ®åº“è®¿é—®çš„è°ƒç”¨è¿‡ç¨‹è·Ÿè¸ªã€‚<br>ç„¶åé€šè¿‡åœ¨springä¹‹ç±»çš„é…ç½®æ–‡ä»¶é‡ŒåŠ å…¥è¿™äº›æ‹¦æˆªå™¨ï¼Œå®Œæˆå¯¹javaåº”ç”¨çš„æ€§èƒ½æ•°æ®é‡‡é›†ã€‚</p><p><strong>4ã€CAT</strong><br>githubåœ°å€ï¼š<a href="https://blog.csdn.net/mbugatti/article/details/53405203" target="_blank" rel="noopener">GitHub - dianping/cat: Central Application Tracking</a><br>è¿™ä¸ªæ˜¯å¤§ä¼—ç‚¹è¯„å¼€æºå‡ºæ¥çš„ï¼Œå®ç°çš„åŠŸèƒ½ä¹Ÿè¿˜æ˜¯è›®ä¸°å¯Œçš„ï¼Œå›½å†…ä¹Ÿæœ‰ä¸€äº›å…¬å¸åœ¨ç”¨äº†ã€‚<br>ä¸è¿‡ä»–å®ç°è·Ÿè¸ªçš„æ‰‹æ®µï¼Œæ˜¯è¦åœ¨ä»£ç é‡Œç¡¬ç¼–ç å†™ä¸€äº›â€œåŸ‹ç‚¹â€ï¼Œä¹Ÿå°±æ˜¯ä¾µå…¥å¼çš„ã€‚<br>è¿™æ ·åšæœ‰åˆ©æœ‰å¼Šï¼Œå¥½å¤„æ˜¯å¯ä»¥åœ¨è‡ªå·±éœ€è¦çš„åœ°æ–¹åŠ åŸ‹ç‚¹ï¼Œæ¯”è¾ƒæœ‰é’ˆå¯¹æ€§ï¼›åå¤„æ˜¯å¿…é¡»æ”¹åŠ¨ç°æœ‰ç³»ç»Ÿï¼Œå¾ˆå¤šå¼€å‘å›¢é˜Ÿä¸æ„¿æ„ã€‚</p><p><strong>5ã€Xhprof/Xhgui</strong><br>è¿™ä¸¤ä¸ªå·¥å…·çš„ç»„åˆï¼Œæ˜¯é’ˆå¯¹PHPåº”ç”¨æä¾›APMèƒ½åŠ›çš„å·¥å…·ï¼Œä¹Ÿæ˜¯éä¾µå…¥å¼çš„ã€‚<br>Xhprof githubåœ°å€ï¼š<a href="https://blog.csdn.net/mbugatti/article/details/53405203" target="_blank" rel="noopener">GitHub - preinheimer/xhprof: XHGUI is a GUI for the XHProf PHP extension, using a database backend, and pretty graphs to make it easy to use and interpret.</a><br>Xhgui githubåœ°å€ï¼š<a href="https://blog.csdn.net/mbugatti/article/details/53405203" target="_blank" rel="noopener">GitHub - perftools/xhgui: A graphical interface for XHProf data built on MongoDB</a><br>æˆ‘å¯¹PHPä¸ç†Ÿï¼Œä¸è¿‡ç½‘ä¸Šä»‹ç»è¿™ä¸¤ä¸ªå·¥å…·çš„èµ„æ–™è¿˜æ˜¯è›®å¤šçš„ã€‚  </p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/16.jpg" alt="åº·å¨å®šå¾‹"></p><h3 id="ç†”æ–­ã€éš”ç¦»ã€é™æµã€é™çº§"><a href="#ç†”æ–­ã€éš”ç¦»ã€é™æµã€é™çº§" class="headerlink" title="ç†”æ–­ã€éš”ç¦»ã€é™æµã€é™çº§"></a>ç†”æ–­ã€éš”ç¦»ã€é™æµã€é™çº§</h3><p>é¢å¯¹å·¨å¤§çš„çªå‘æµé‡ä¸‹ï¼Œå¤§å‹å…¬å¸ä¸€èˆ¬ä¼šé‡‡ç”¨ä¸€ç³»åˆ—çš„<strong>ç†”æ–­</strong>ï¼ˆç³»ç»Ÿè‡ªåŠ¨å°†æœåŠ¡å…³é—­é˜²æ­¢è®©å‡ºç°çš„é—®é¢˜æœ€å¤§åŒ–ï¼‰ã€<strong>éš”ç¦»</strong>ï¼ˆå°†æœåŠ¡å’ŒæœåŠ¡éš”ç¦»ï¼Œé˜²æ­¢ä¸€ä¸ªæœåŠ¡æŒ‚äº†å…¶ä»–æœåŠ¡ä¸èƒ½è®¿é—®ï¼‰ã€<strong>é™æµ</strong>ï¼ˆå•ä½æ—¶é—´å†…ä¹‹å…è®¸ä¸€å®šæ•°é‡ç”¨æˆ·è®¿é—®ï¼‰ã€<strong>é™çº§</strong>ï¼ˆå½“æ•´ä¸ªå¾®æœåŠ¡æ¶æ„æ•´ä½“çš„è´Ÿè½½è¶…å‡ºäº†é¢„è®¾çš„ä¸Šé™é˜ˆå€¼æˆ–å³å°†åˆ°æ¥çš„æµé‡é¢„è®¡å°†ä¼šè¶…è¿‡é¢„è®¾çš„é˜ˆå€¼æ—¶ï¼Œä¸ºäº†ä¿è¯é‡è¦æˆ–åŸºæœ¬çš„æœåŠ¡èƒ½æ­£å¸¸è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€äº› ä¸é‡è¦æˆ– ä¸ç´§æ€¥ çš„æœåŠ¡æˆ–ä»»åŠ¡è¿›è¡ŒæœåŠ¡çš„ å»¶è¿Ÿä½¿ç”¨ æˆ– æš‚åœä½¿ç”¨ï¼‰æªæ–½ã€‚</p><p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹<code>hystrix</code>çš„è¿è¡Œæµç¨‹ï¼ˆæ²¡æ‰¾åˆ°æ¶æ„å›¾ä¸å¥½æ„æ€ï¼‰ï¼š</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/17.png" alt="hystrix"></p><p>æ¯ä¸€ä¸ªå¾®æœåŠ¡è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šä½¿ç”¨<code>hystrix</code>çš„<code>command</code>æ–¹å¼ï¼ˆä¸Šå›¾çš„å·¦ä¸Šè§’é‚£ä¸ªï¼‰ï¼Œç„¶åä½¿ç”¨<code>command</code><em>åŒæ­¥çš„</em>ï¼Œæˆ–è€…æ˜¯<em>å“åº”å¼çš„</em>ï¼Œæˆ–è€…æ˜¯<em>å¼‚æ­¥çš„</em>ï¼Œåˆ¤æ–­ç”µè·¯æ˜¯å¦ç†”æ–­ï¼ˆé¡ºç€å›¾ä»å·¦å¾€å³çœ‹ï¼‰ï¼Œ</p><p>å¦‚æœæ–­è·¯åˆ™èµ°é™çº§fallbackï¼›</p><p>å¦‚æœè¿™ä¸ªçº¿é—­åˆç€ï¼Œä½†æ˜¯çº¿ç¨‹èµ„æºæ²¡äº†ï¼Œé˜Ÿåˆ—æ»¡äº†ï¼Œåˆ™èµ°é™æµæªæ–½ï¼ˆçœ‹å›¾çš„ç¬¬5æ­¥ï¼‰ï¼›</p><p>å¦‚æœèµ°å®Œäº†ï¼Œæ‰§è¡ŒæˆåŠŸäº†ï¼Œåˆ™èµ°run()æ–¹æ³•ï¼Œè·å–responseï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹å¦‚æœå‡ºé”™äº†ï¼Œåˆ™ç»§ç»­èµ°é™çº§fallback.</p><p>åŒæ—¶ï¼Œçœ‹å›¾æœ€ä¸Šé¢æœ‰ä¸€ä¸ªåç¼€æ˜¯<code>health</code>çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªè®¡ç®—æ•´ä¸ªé“¾è·¯æ˜¯å¦å¥åº·çš„ç»„ä»¶ï¼Œæ¯ä¸€æ­¥æ“ä½œéƒ½è¢«å®ƒè®°å½•ç€ã€‚</p><h3 id="å®¹å™¨ä¸æœåŠ¡ç¼–æ’å¼•æ“"><a href="#å®¹å™¨ä¸æœåŠ¡ç¼–æ’å¼•æ“" class="headerlink" title="å®¹å™¨ä¸æœåŠ¡ç¼–æ’å¼•æ“"></a>å®¹å™¨ä¸æœåŠ¡ç¼–æ’å¼•æ“</h3><p>ä»ç‰©ç†æœºåˆ°è™šæ‹Ÿæœºï¼Œä»è™šæ‹Ÿæœºåˆ°å®¹å™¨ï¼›ä»ç‰©ç†é›†ç¾¤åˆ°<code>open stack</code>ï¼Œ<code>open stack</code>åˆ°<code>kubernetes</code>ï¼›ç§‘æŠ€ä¸æ–­çš„å˜åŒ–ï¼Œæˆ‘ä»¬çš„è®¤çŸ¥ä¹Ÿæ²¡åˆ·æ–°ã€‚</p><p>æˆ‘ä»¬ä»å®¹å™¨å¼€å§‹è¯´èµ·ï¼Œå®ƒé¦–å…ˆæ˜¯ä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼Œåœ¨è¿™ä¸€ç‚¹æœ‰ç‚¹ç±»ä¼¼äºè™šæ‹Ÿæœºï¼Œä½†æ˜¯ä¸åƒè™šæ‹Ÿæœºé‚£æ ·å½»åº•ã€‚<br>ã€€ã€€è™šæ‹Ÿæœºä¼šå°†è™šæ‹Ÿç¡¬ä»¶ã€å†…æ ¸ï¼ˆå³æ“ä½œç³»ç»Ÿï¼‰ä»¥åŠç”¨æˆ·ç©ºé—´æ‰“åŒ…åœ¨æ–°è™šæ‹Ÿæœºå½“ä¸­ï¼Œè™šæ‹Ÿæœºèƒ½å¤Ÿåˆ©ç”¨â€œè™šæ‹Ÿæœºç®¡ç†ç¨‹åºâ€è¿è¡Œåœ¨ç‰©ç†è®¾å¤‡ä¹‹ä¸Šã€‚è™šæ‹Ÿæœºä¾èµ–äºhypervisorï¼Œå…¶é€šå¸¸è¢«å®‰è£…åœ¨â€œè£¸é‡‘å±â€ç³»ç»Ÿç¡¬ä»¶ä¹‹ä¸Šï¼Œè¿™å¯¼è‡´hypervisoråœ¨æŸäº›æ–¹é¢è¢«è®¤ä¸ºæ˜¯ä¸€ç§æ“ä½œç³»ç»Ÿã€‚ä¸€æ—¦ hypervisorå®‰è£…å®Œæˆï¼Œ å°±å¯ä»¥ä»ç³»ç»Ÿå¯ç”¨è®¡ç®—èµ„æºå½“ä¸­åˆ†é…è™šæ‹Ÿæœºå®ä¾‹äº†ï¼Œæ¯å°è™šæ‹Ÿæœºéƒ½èƒ½å¤Ÿè·å¾—å”¯ä¸€çš„æ“ä½œç³»ç»Ÿå’Œè´Ÿè½½(åº”ç”¨ç¨‹åº)ã€‚ç®€è¨€ä¹‹ï¼Œè™šæ‹Ÿæœºå…ˆéœ€è¦è™šæ‹Ÿä¸€ä¸ªç‰©ç†ç¯å¢ƒï¼Œç„¶åæ„å»ºä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå†æ­å»ºä¸€å±‚Runtimeï¼Œç„¶åä¾›åº”ç”¨ç¨‹åºè¿è¡Œã€‚<br>ã€€ã€€<br>ã€€ã€€ å¯¹äºå®¹å™¨ç¯å¢ƒæ¥è¯´ï¼Œä¸éœ€è¦å®‰è£…ä¸»æœºæ“ä½œç³»ç»Ÿï¼Œç›´æ¥å°†å®¹å™¨å±‚(æ¯”å¦‚LXCæˆ–libcontainer)å®‰è£…åœ¨ä¸»æœºæ“ä½œç³»ç»Ÿ(é€šå¸¸æ˜¯Linuxå˜ç§)ä¹‹ä¸Šã€‚åœ¨å®‰è£…å®Œå®¹å™¨å±‚ä¹‹åï¼Œå°±å¯ä»¥ä»ç³»ç»Ÿå¯ç”¨è®¡ç®—èµ„æºå½“ä¸­åˆ†é…å®¹å™¨å®ä¾‹äº†ï¼Œå¹¶ä¸”ä¼ä¸šåº”ç”¨å¯ä»¥è¢«éƒ¨ç½²åœ¨å®¹å™¨å½“ä¸­ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªå®¹å™¨åŒ–åº”ç”¨éƒ½ä¼šå…±äº«ç›¸åŒçš„æ“ä½œç³»ç»Ÿ(å•ä¸ªä¸»æœºæ“ä½œç³»ç»Ÿ)ã€‚å®¹å™¨å¯ä»¥çœ‹æˆä¸€ä¸ªè£…å¥½äº†ä¸€ç»„ç‰¹å®šåº”ç”¨çš„è™šæ‹Ÿæœºï¼Œå®ƒç›´æ¥åˆ©ç”¨äº†å®¿ä¸»æœºçš„å†…æ ¸ï¼ŒæŠ½è±¡å±‚æ¯”è™šæ‹Ÿæœºæ›´å°‘ï¼Œæ›´åŠ è½»é‡åŒ–ï¼Œå¯åŠ¨é€Ÿåº¦æå¿«ã€‚</p><p>ã€€ã€€ç›¸æ¯”äºè™šæ‹Ÿæœºï¼Œå®¹å™¨æ‹¥æœ‰æ›´é«˜çš„èµ„æºä½¿ç”¨æ•ˆç‡ï¼Œå› ä¸ºå®ƒå¹¶ä¸éœ€è¦ä¸ºæ¯ä¸ªåº”ç”¨åˆ†é…å•ç‹¬çš„æ“ä½œç³»ç»Ÿâ€”â€”å®ä¾‹è§„æ¨¡æ›´å°ã€åˆ›å»ºå’Œè¿ç§»é€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚è¿™æ„å‘³ç›¸æ¯”äºè™šæ‹Ÿæœºï¼Œå•ä¸ªæ“ä½œç³»ç»Ÿèƒ½å¤Ÿæ‰¿è½½æ›´å¤šçš„å®¹å™¨ã€‚äº‘æä¾›å•†ååˆ†çƒ­è¡·äºå®¹å™¨æŠ€æœ¯ï¼Œå› ä¸ºåœ¨ç›¸åŒçš„ç¡¬ä»¶è®¾å¤‡å½“ä¸­ï¼Œå¯ä»¥éƒ¨ç½²æ•°é‡æ›´å¤šçš„å®¹å™¨å®ä¾‹ã€‚æ­¤å¤–ï¼Œå®¹å™¨æ˜“äºè¿ç§»ï¼Œä½†æ˜¯åªèƒ½è¢«è¿ç§»åˆ°å…·æœ‰å…¼å®¹æ“ä½œç³»ç»Ÿå†…æ ¸çš„å…¶ä»–æœåŠ¡å™¨å½“ä¸­ï¼Œè¿™æ ·å°±ä¼šç»™è¿ç§»é€‰æ‹©å¸¦æ¥é™åˆ¶ã€‚å› ä¸ºå®¹å™¨ä¸åƒè™šæ‹Ÿæœºé‚£æ ·åŒæ ·å¯¹å†…æ ¸æˆ–è€…è™šæ‹Ÿç¡¬ä»¶è¿›è¡Œæ‰“åŒ…ï¼Œæ‰€ä»¥æ¯å¥—å®¹å™¨éƒ½æ‹¥æœ‰è‡ªå·±çš„éš”ç¦»åŒ–ç”¨æˆ·ç©ºé—´ï¼Œä»è€Œä½¿å¾—å¤šå¥—å®¹å™¨èƒ½å¤Ÿè¿è¡Œåœ¨åŒä¸€ä¸»æœºç³»ç»Ÿä¹‹ä¸Šã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¨éƒ¨æ“ä½œç³»ç»Ÿå±‚çº§çš„æ¶æ„éƒ½å¯å®ç°è·¨å®¹å™¨å…±äº«ï¼ŒæƒŸä¸€éœ€è¦ç‹¬ç«‹æ„å»ºçš„å°±æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ä¸åº“ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œå®¹å™¨æ‰æ‹¥æœ‰æä¸ºå‡ºè‰²çš„è½»é‡åŒ–ç‰¹æ€§ã€‚ </p><p>æˆ‘ä»¬æœ€å¸¸ç”¨çš„å®¹å™¨æ˜¯daockerï¼Œç½‘å€å¦‚ä¸‹ğŸ‘‰<a href="https://www.docker.com/" target="_blank" rel="noopener">https://www.docker.com/</a></p><h4 id="å®¹å™¨ç¼–æ’"><a href="#å®¹å™¨ç¼–æ’" class="headerlink" title="å®¹å™¨ç¼–æ’"></a>å®¹å™¨ç¼–æ’</h4><p>è¿‡å»è™šæ‹Ÿæœºå¯ä»¥é€šè¿‡äº‘å¹³å°<code>open stack</code>ç®¡ç†è™šæ‹ŸåŒ–ï¼Œå®¹å™¨æ—¶ä»£å¦‚ä½•ç®¡ç†å®¹å™¨å‘¢ï¼Ÿè¿™å°±è¦çœ‹çœ‹å®¹å™¨ç¼–æ’å¼•æ“äº†ã€‚</p><h5 id="Apache-mesos"><a href="#Apache-mesos" class="headerlink" title="Apache mesos"></a>Apache mesos</h5><p>mesosæ˜¯åŸºäºmasterï¼Œslaveæ¶æ„ï¼Œæ¡†æ¶å†³å®šå¦‚ä½•åˆ©ç”¨èµ„æºï¼Œmasterè´Ÿè´£ç®¡ç†æœºå™¨ï¼Œslaveä¼šå®šæœŸçš„å°†æœºå™¨æƒ…å†µæŠ¥å‘Šç»™masterï¼Œmasterå†å°†ä¿¡æ¯ç»™æ¡†æ¶ã€‚masteræ˜¯é«˜å¯ç”¨çš„ï¼Œå› ä¸ºzkï¼Œä¹Ÿæœ‰leaderçš„å­˜åœ¨ã€‚ä¸‹é¢æ˜¯æ¶æ„å›¾ğŸ‘‡</p><p><img src="/2018/12/08/å¾®æœåŠ¡æ ¸å¿ƒæ¶æ„æ¢³ç†/19.png" alt="1544264985310"></p><h5 id="kubernetes"><a href="#kubernetes" class="headerlink" title="kubernetes"></a>kubernetes</h5><p>kubernetesæ˜¯æœ€è¿‘ååˆ†ç«çƒ­çš„å¼€æºå®¹å™¨ç¼–æ’å¼•æ“ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://www.kubernetes.org.cn/kubernetesè®¾è®¡æ¶æ„" target="_blank" rel="noopener">kubernetesä¸­æ–‡æ–‡æ¡£</a></p><p><img src="https://raw.githubusercontent.com/kubernetes/kubernetes/release-1.2/docs/design/architecture.png" alt="k8s"></p><p>Kubernetesè®¾è®¡ç†å¿µå’ŒåŠŸèƒ½å…¶å®å°±æ˜¯ä¸€ä¸ªç±»ä¼¼Linuxçš„åˆ†å±‚æ¶æ„ï¼Œå…ˆè¯´è¯´æ¯ä¸€ä¸ªKubernetesèŠ‚ç‚¹å†…éƒ¨ï¼Œkubeletç®¡ç†å…¨å±€å…¨å±€podï¼Œè€Œæ¯ä¸€ä¸ªpodæ‰¿è½½ç€ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œkube-proxyè´Ÿè´£ç½‘ç»œä»£ç†å’Œè´Ÿè½½å‡è¡¡    ã€‚</p><p>KubernetesèŠ‚ç‚¹å¤–éƒ¨ï¼Œåˆ™æ˜¯å¯¹åº”çš„æ§åˆ¶ç®¡ç†æœåŠ¡å™¨ï¼Œè´Ÿè´£ç»Ÿä¸€ç®¡ç†å„ä¸ªèŠ‚ç‚¹è°ƒåº¦åˆ†é…ä¸è¿è¡Œã€‚</p><h4 id="æœåŠ¡ç½‘æ ¼åŒ–"><a href="#æœåŠ¡ç½‘æ ¼åŒ–" class="headerlink" title="æœåŠ¡ç½‘æ ¼åŒ–"></a>æœåŠ¡ç½‘æ ¼åŒ–</h4><p>ã€‚ã€‚ã€‚å¾…æ›´æ–°</p><h3 id="èµ„æ–™ä¸æ–‡çŒ®"><a href="#èµ„æ–™ä¸æ–‡çŒ®" class="headerlink" title="èµ„æ–™ä¸æ–‡çŒ®"></a>èµ„æ–™ä¸æ–‡çŒ®</h3><p><a href="https://martinfowler.com/articles/microservices.html#MicroservicesAndSoa" target="_blank" rel="noopener">é©¬ä¸.ç¦å‹’å¯¹å¾®æœåŠ¡çš„æè¿°</a></p><p><a href="https://yq.aliyun.com/articles/8611" target="_blank" rel="noopener">å¾®æœåŠ¡æ¶æ„çš„ç†è®ºåŸºç¡€ - åº·å¨å®šå¾‹</a></p><p><a href="https://www.jianshu.com/p/0fbbf99a236e" target="_blank" rel="noopener">è°ƒç”¨é“¾é€‰å‹ä¹‹Zipkinï¼ŒPinpointï¼ŒSkyWalkingï¼ŒCAT</a></p><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ</p><p>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> </p><p>æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨<a href="https://blog.tengshe789.tech/2018/12/08/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E6%A2%B3%E7%90%86/#more" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a>ç‡å…ˆå‘è¡¨ï¼Œéšåçœ‹å¿ƒæƒ…å¯èƒ½ä¼šåœ¨CSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œ<strong>ç¼˜åˆ†å‘¢</strong>å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹ï¼Œå’±ä»¬ä¸¤ä¸ªæƒ³ä¸ªå·ç ï¼Œ ä¹°ä¸ªå½©ç¥¨ï¼Œå…ˆæŒ£ä»–ä¸ªå‡ ç™¾ä¸‡ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨å…¬å¸å­¦ä¹ äº†æ¥è¿‘ä¸€ä¸ªæœˆã€‚ &lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæœˆå†…ï¼Œä»0å¼€å§‹å¼€å§‹æ¥è§¦åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ï¼Œç»™äº†æˆ‘ä¸å°çš„æ”¶è·ã€‚ä»Šå¤©ï¼Œæˆ‘æ¥ä»å¤´åˆ°å°¾æ¢³ç†ä¸€ä¸‹ï¼Œæœ‰å…³å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒå†…å®¹ï¼ˆå…¨æ˜¯å¹²è´§ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹æ–‡ï¼Œä½ å°†çœ‹åˆ°ä¸šç•Œä¸»æµå¾®æœåŠ¡æ¡†æ¶çš„æ ¸å¿ƒåŸç†ï¼ŒåŒ…æ‹¬æœåŠ¡å‘ç°ï¼Œç½‘å…³ï¼Œé…ç½®ä¸­å¿ƒï¼Œç›‘æ§ç­‰ç»„ä»¶ï¼ŒåŠŸ
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="å­¦å¥½åˆ†å¸ƒå¼æ¶æ„" scheme="https://tengshe789.github.io/tags/%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/"/>
    
      <category term="æ¶æ„" scheme="https://tengshe789.github.io/tags/%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ</title>
    <link href="https://tengshe789.github.io/2018/12/07/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/"/>
    <id>https://tengshe789.github.io/2018/12/07/é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ/</id>
    <published>2018-12-07T06:51:38.000Z</published>
    <updated>2019-11-20T13:39:41.572Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ†æä¸€ä¸‹å¹¿æ³›æµä¼ çš„é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œï¼Œå½“ä½œåœ¨çº¿æ–‡æ¡£ï¼Œè½¬ä¾µåˆ ã€‚ã€‚</p><div class="row">    <embed src="é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ.pdf" width="100%" height="550" type="application/pdf"></div> ]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åˆ†æä¸€ä¸‹å¹¿æ³›æµä¼ çš„é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œï¼Œå½“ä½œåœ¨çº¿æ–‡æ¡£ï¼Œè½¬ä¾µåˆ ã€‚ã€‚&lt;/p&gt;


	&lt;div class=&quot;row&quot;&gt;
    &lt;embed src=&quot;é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ.pdf&quot; width=&quot;100%&quot; height=&quot;550&quot; type=&quot;application
      
    
    </summary>
    
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="åˆ†äº«" scheme="https://tengshe789.github.io/tags/%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>é˜…è¯»é˜¿é‡Œå¼€å‘æ‰‹å†Œå‘ç°çš„ConcurrentModificationExceptionå¼‚å¸¸</title>
    <link href="https://tengshe789.github.io/2018/12/06/ConcurrentModificationException%E5%BC%82%E5%B8%B8/"/>
    <id>https://tengshe789.github.io/2018/12/06/ConcurrentModificationExceptionå¼‚å¸¸/</id>
    <published>2018-12-06T01:45:13.000Z</published>
    <updated>2019-11-20T13:39:40.560Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©é˜…è¯»é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ(ç»ˆæç‰ˆ).pdfï¼Œå¶ç„¶å‘ç°ä¸€æ¡å¼ºåˆ¶è§„èŒƒï¼š</p><blockquote><p>ã€å¼ºåˆ¶ã€‘ä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove/add æ“ä½œã€‚remove å…ƒç´ è¯·ä½¿ç”¨ <code>Iterator</code><br>æ–¹å¼ï¼Œå¦‚æœå¹¶å‘æ“ä½œï¼Œéœ€è¦å¯¹ Iterator å¯¹è±¡åŠ é”ã€‚</p></blockquote><p>è¿™å¼•å‘äº†æˆ‘çš„æ³¨æ„åŠ›ã€‚</p><p>æŒ‰ç…§ä»–è¯´çš„åšäº†ä¸€éï¼Œæœç„¶æœ‰è¿™ä¸ªé—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¢ç´¢ä¸€ä¸‹ï¼Œåˆ°åº•ä¸ºä»€ä¹ˆä¼šå‡ºè¿™ä¸ªé—®é¢˜å§ï¼</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">https://blog.tengshe789.tech/</a></p><h3 id="å®éªŒä»£ç "><a href="#å®éªŒä»£ç " class="headerlink" title="å®éªŒä»£ç "></a>å®éªŒä»£ç </h3><p>ä¸‹é¢æ˜¯æ¨èä½¿ç”¨çš„<code>Iterator</code>æ–¹å¼æ¥<code>remove/add</code>æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">test1</span><span class="params">(List&lt;String&gt; list)</span></span>&#123;</span><br><span class="line">       Iterator&lt;String&gt; iterator = list.iterator();</span><br><span class="line">       <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">           String item = iterator.next();</span><br><span class="line">           <span class="keyword">if</span> (item.equals(NUM2)) &#123;</span><br><span class="line">               iterator.remove();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> list;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ä¸æ¨èä½¿ç”¨çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">test2</span><span class="params">(List&lt;String&gt; list)</span></span>&#123;</span><br><span class="line">       <span class="keyword">for</span> (String item : list) &#123;</span><br><span class="line">           <span class="keyword">if</span> (NUM2.equals(item)) &#123;</span><br><span class="line">               list.remove(item);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> list;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘çš„mainæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NUM1 = <span class="string">"1"</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NUM2 = <span class="string">"2"</span>;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">       list.add(<span class="string">"1"</span>);</span><br><span class="line">       list.add(<span class="string">"2"</span>);</span><br><span class="line"></span><br><span class="line">       test2(list);</span><br><span class="line"></span><br><span class="line">       list.forEach(item -&gt; &#123;</span><br><span class="line">           System.out.println(<span class="string">"ç»“æœæ˜¯ "</span> + item);</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p><img src="/2018/12/06/ConcurrentModificationExceptionå¼‚å¸¸/1.png" alt="ConcurrentModificationExceptionå¼‚å¸¸"><br>æœç„¶ï¼Œå°†åˆ¤æ–­æ¡ä»¶è®¾ç½®æˆ<code>NUM2</code>æ—¶ï¼Œå°±å‡ºå¼‚å¸¸äº†ï¼Œå¯æ˜¯è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><h3 id="ä¸€æ¢ç©¶ç«Ÿ"><a href="#ä¸€æ¢ç©¶ç«Ÿ" class="headerlink" title="ä¸€æ¢ç©¶ç«Ÿ"></a>ä¸€æ¢ç©¶ç«Ÿ</h3><p>æˆ‘ä»¬ä»å‡ºé”™æ—¥å¿—ä¸­æŸ¥æ‰¾ç­”æ¡ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">      <span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          checkForComodification();</span><br><span class="line">          <span class="keyword">int</span> i = cursor;</span><br><span class="line">          <span class="keyword">if</span> (i &gt;= size)</span><br><span class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">          Object[] elementData = ArrayList.<span class="keyword">this</span>.elementData;</span><br><span class="line">          <span class="keyword">if</span> (i &gt;= elementData.length)</span><br><span class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">          cursor = i + <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>æ¥åˆ°<code>foreach</code>ä¸­èµ°çš„<code>next()</code>ï¼Œç¬¬ä¸€æ­¥éœ€è¦èµ°<code>checkForComodification()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">checkForComodification</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>è¿™è¾¹åˆå‡ºç°ä¸€ä¸ªæˆå‘˜å˜é‡<code>modCount</code>ï¼Œæˆ‘ä»¬é¡ºç€æ¥æ‰¾æ‰¾çœ‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of times this list has been &lt;i&gt;structurally modified&lt;/i&gt;.</span></span><br><span class="line"><span class="comment">     * Structural modifications are those that change the size of the</span></span><br><span class="line"><span class="comment">     * list, or otherwise perturb it in such a fashion that iterations in</span></span><br><span class="line"><span class="comment">     * progress may yield incorrect results.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;This field is used by the iterator and list iterator implementation</span></span><br><span class="line"><span class="comment">     * returned by the &#123;<span class="doctag">@code</span> iterator&#125; and &#123;<span class="doctag">@code</span> listIterator&#125; methods.</span></span><br><span class="line"><span class="comment">     * If the value of this field changes unexpectedly, the iterator (or list</span></span><br><span class="line"><span class="comment">     * iterator) will throw a &#123;<span class="doctag">@code</span> ConcurrentModificationException&#125; in</span></span><br><span class="line"><span class="comment">     * response to the &#123;<span class="doctag">@code</span> next&#125;, &#123;<span class="doctag">@code</span> remove&#125;, &#123;<span class="doctag">@code</span> previous&#125;,</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> set&#125; or &#123;<span class="doctag">@code</span> add&#125; operations.  This provides</span></span><br><span class="line"><span class="comment">     * &lt;i&gt;fail-fast&lt;/i&gt; behavior, rather than non-deterministic behavior in</span></span><br><span class="line"><span class="comment">     * the face of concurrent modification during iteration.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;&lt;b&gt;Use of this field by subclasses is optional.&lt;/b&gt; If a subclass</span></span><br><span class="line"><span class="comment">     * wishes to provide fail-fast iterators (and list iterators), then it</span></span><br><span class="line"><span class="comment">     * merely has to increment this field in its &#123;<span class="doctag">@code</span> add(int, E)&#125; and</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> remove(int)&#125; methods (and any other methods that it overrides</span></span><br><span class="line"><span class="comment">     * that result in structural modifications to the list).  A single call to</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> add(int, E)&#125; or &#123;<span class="doctag">@code</span> remove(int)&#125; must add no more than</span></span><br><span class="line"><span class="comment">     * one to this field, or the iterators (and list iterators) will throw</span></span><br><span class="line"><span class="comment">     * bogus &#123;<span class="doctag">@code</span> ConcurrentModificationExceptions&#125;.  If an implementation</span></span><br><span class="line"><span class="comment">     * does not wish to provide fail-fast iterators, this field may be</span></span><br><span class="line"><span class="comment">     * ignored.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">transient</span> <span class="keyword">int</span> <span class="keyword">transient</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>å“¦ï¼Œç¼˜æ¥ä¹³æ­¤ï¼Œ<code>list</code>æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå› æ­¤å¦‚æœåœ¨ä½¿ç”¨è¿­ä»£å™¨çš„è¿‡ç¨‹ä¸­æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†<code>list</code>ï¼Œé‚£ä¹ˆå°†æŠ›å‡º<code>ConcurrentModificationException</code>ï¼Œè¿™å°±æ˜¯æ‰€è°“<code>fail-fast</code>ç­–ç•¥(è§jdkæ³¨é‡Š)ã€‚</p><p><code>modCount</code>å®ƒä»£è¡¨è¯¥Listå¯¹è±¡è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œæ¯å¯¹<code>List</code>å¯¹è±¡ä¿®æ”¹ä¸€æ¬¡ï¼Œ<code>modCount</code>éƒ½ä¼šåŠ <code>Iterator</code>ç±»é‡Œæœ‰ä¸€ä¸ªæˆå‘˜å˜é‡<code>expectedModCount</code>ï¼Œå®ƒçš„å€¼ä¸ºåˆ›å»º<code>Iterator</code>å¯¹è±¡çš„æ—¶å€™<code>Listçš„modCount</code>å€¼ã€‚ç”¨æ­¤å˜é‡æ¥æ£€éªŒåœ¨è¿­ä»£è¿‡ç¨‹ä¸­Listå¯¹è±¡æ˜¯å¦è¢«ä¿®æ”¹äº†ï¼Œå¦‚æœè¢«ä¿®æ”¹äº†åˆ™æŠ›å‡º<code>java.util.ConcurrentModificationException</code>å¼‚å¸¸ã€‚åœ¨æ¯æ¬¡è°ƒç”¨<code>Iterator</code>å¯¹è±¡çš„<code>next()</code>æ–¹æ³•çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨<code>checkForComodification()</code>æ–¹æ³•è¿›è¡Œä¸€æ¬¡æ£€éªŒï¼Œ<code>checkForComodification()</code>æ–¹æ³•ä¸­åšçš„å·¥ä½œå°±æ˜¯æ¯”è¾ƒ<code>expectedModCount</code>å’Œ<code>modCount</code>çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œå°±è®¤ä¸ºè¿˜æœ‰å…¶ä»–å¯¹è±¡æ­£åœ¨å¯¹å½“å‰çš„Listè¿›è¡Œæ“ä½œï¼Œé‚£ä¸ªå°±ä¼šæŠ›å‡º<code>ConcurrentModificationException</code>å¼‚å¸¸ã€‚</p><p>ç½‘ä¸ŠæŸ¥æ‰¾çš„å…³äº<code>Iterator</code>çš„å·¥ä½œæœºåˆ¶ã€‚<code>Iterator</code>æ˜¯å·¥ä½œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­ï¼Œå¹¶ä¸”æ‹¥æœ‰ä¸€ä¸ª <code>mutex</code>é”ï¼Œå°±æ˜¯è¯´<code>Iterator</code>åœ¨å·¥ä½œçš„æ—¶å€™ï¼Œæ˜¯ä¸å…è®¸è¢«è¿­ä»£çš„å¯¹è±¡è¢«æ”¹å˜çš„ã€‚è€Œ<code>List</code>ç­‰æ˜¯åŠ¨æ€çš„ï¼Œå¯å˜å¯¹è±¡æ•°é‡çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯<code>Iterator</code>åˆ™æ˜¯å•å‘ä¸å¯å˜ï¼Œåªèƒ½é¡ºåºè¯»å–ï¼Œä¸èƒ½é€†åºæ“ä½œçš„æ•°æ®ç»“æ„ï¼Œå½“ <code>Iterator</code>æŒ‡å‘çš„åŸå§‹æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>Iterator</code>è‡ªå·±å°±è¿·å¤±äº†æ–¹å‘ã€‚</p><h3 id="ç»­1sæ—¶é—´"><a href="#ç»­1sæ—¶é—´" class="headerlink" title="ç»­1sæ—¶é—´"></a>ç»­1sæ—¶é—´</h3><p>å…¨ç‰‡ç»“æŸï¼Œè§‰å¾—æˆ‘å†™çš„ä¸é”™ï¼Ÿæƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿèµ¶å¿«æ‰“å¼€æˆ‘çš„ğŸ‘‰ä¸ªäºº<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">åšå®¢</a> ğŸ‘ˆå§ï¼</p><p>è°¢è°¢ä½ é‚£ä¹ˆå¯çˆ±ï¼Œè¿˜ä¸€ç›´å…³æ³¨ç€æˆ‘~â¤ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©é˜…è¯»é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ(ç»ˆæç‰ˆ).pdfï¼Œå¶ç„¶å‘ç°ä¸€æ¡å¼ºåˆ¶è§„èŒƒï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ã€å¼ºåˆ¶ã€‘ä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove/add æ“ä½œã€‚remove å…ƒç´ è¯·ä½¿ç”¨ &lt;code&gt;Iterator&lt;/code&gt;&lt;br&gt;æ–¹å¼
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ç³»ç»Ÿ--æ„Ÿæ€§è®¤è¯†JWT</title>
    <link href="https://tengshe789.github.io/2018/12/02/%E6%84%9F%E6%80%A7%E8%AE%A4%E8%AF%86JWT/"/>
    <id>https://tengshe789.github.io/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/</id>
    <published>2018-12-02T12:30:23.000Z</published>
    <updated>2019-11-20T13:39:41.383Z</updated>
    
    <content type="html"><![CDATA[<p>å¥½ä¹…æ²¡å†™åšå®¢äº†ï¼Œå› ä¸ºæœ€è¿‘å…¬å¸è¦æ±‚æˆ‘å­¦<code>spring cloud</code>ï¼Œæ—©ç‚¹å°†ä»¥å‰è½¯ä»¶è¿ç§»åˆ°æ–°çš„æ¶æ„ä¸Šã€‚æ‰€ä»¥æˆ‘é‚£ä¸ªæ‹¼å‘½çš„å­¦å‘ï¼Œæ€»æ˜¯å›¾å¿«ï¼Œå¾ˆå¤šå…³é”®çš„ç¬”è®°æ²¡æœ‰åšå¥½è®°å½•ï¼Œç°åœ¨åˆé—å¿˜äº†å¾ˆå¤šå…³é”®çš„æŠ€æœ¯ç‚¹ï¼Œæå…¶ç½ªæ¶ï¼</p><p>ç°åœ¨æƒ³ä¸€æƒ³ï¼Œè¿˜æ˜¯è¸è¸å®å®çš„èµ°æ¯”è¾ƒå¥½ã€‚è¿™ä¸ï¼Œä»Šå¤©æˆ‘å†’äº†ä¸ªæ³¡ï¼Œæ¥è¡¥ä¸€è¡¥å‰é¢æˆ‘æ‰€å­¦æ‰€å¿˜çš„çŸ¥è¯†ç‚¹ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a>ã€‚</p><h2 id="å¸¸è§çš„è®¤è¯æœºåˆ¶"><a href="#å¸¸è§çš„è®¤è¯æœºåˆ¶" class="headerlink" title="å¸¸è§çš„è®¤è¯æœºåˆ¶"></a>å¸¸è§çš„è®¤è¯æœºåˆ¶</h2><p>ä»Šå¤©æˆ‘ä¹ˆèŠä¸€èŠJWTã€‚</p><p>å…³äºJWTï¼Œç›¸ä¿¡å¾ˆå¤šäººéƒ½å·²ç»çœ‹è¿‡ç”¨è¿‡ï¼Œä»–æ˜¯åŸºäº<code>json</code>æ•°æ®ç»“æ„çš„è®¤è¯è§„èŒƒï¼Œç®€å•çš„è¯´å°±æ˜¯éªŒè¯ç”¨æˆ·ç™»æ²¡ç™»é™†çš„ç©æ„ã€‚è¿™æ—¶å€™ä½ å¯èƒ½å›æƒ³ï¼Œå“å“Ÿï¼Œä¸æ˜¯åˆé‚£ä¸ªsessionä¹ˆï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç”¨<code>redis</code>åšåˆ†å¸ƒå¼sessionï¼Œé‚£è¿™ä¸ªjwtæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p><p>è¯·å¬æˆ‘æ…¢æ…¢è¯‰è¯´è¿™å†å²ï¼</p><h3 id="æœ€åŸå§‹çš„åŠæ³•â€“HTTP-BASIC-AUTH"><a href="#æœ€åŸå§‹çš„åŠæ³•â€“HTTP-BASIC-AUTH" class="headerlink" title="æœ€åŸå§‹çš„åŠæ³•â€“HTTP BASIC AUTH"></a>æœ€åŸå§‹çš„åŠæ³•â€“HTTP BASIC AUTH</h3><p>HTTP BASIC authï¼Œåˆ«çœ‹å®ƒåå­—é‚£ä¹ˆé•¿é‚£ä¹ˆç”Ÿï¼Œä½ å°±è®¤ä¸ºè¿™ä¸ªç©æ„å¾ˆé«˜å¤§ä¸Šã€‚å…¶å®åŸç†å¾ˆç®€å•ï¼Œç®€å•çš„è¯´å°±æ˜¯æ¯æ¬¡è¯·æ±‚APIçš„æ—¶å€™ï¼Œéƒ½ä¼šæŠŠç”¨æˆ·åå’Œå¯†ç é€šè¿‡<code>restful API</code>ä¼ ç»™æœåŠ¡ç«¯ã€‚è¿™æ ·å°±å¯ä»¥å®ç°ä¸€ä¸ª<strong>æ— çŠ¶æ€</strong>æ€æƒ³ï¼Œå³æ¯æ¬¡HTTPè¯·æ±‚å’Œä»¥å‰éƒ½æ²¡æœ‰å•¥å…³ç³»ï¼Œåªæ˜¯è·å–ç›®æ ‡URIï¼Œå¾—åˆ°ç›®æ ‡å†…å®¹ä¹‹åï¼Œè¿™æ¬¡è¿æ¥å°±è¢«æ€æ­»ï¼Œæ²¡æœ‰ä»»ä½•ç—•è¿¹ã€‚ä½ å¯åˆ«ä¸€å¬æ— çŠ¶æ€ï¼Œæ­£æ˜¯ç°åœ¨çš„çƒ­é—¨æ€æƒ³ï¼Œå°±è§‰å¾—å¾ˆå‰å®³ã€‚å…¶å®ä»–çš„ç¼ºç‚¹è¿˜æ˜¯åˆçš„ï¼Œæˆ‘ä»¬é€šè¿‡httpè¯·æ±‚å‘é€ç»™æœåŠ¡ç«¯çš„æ—¶å€™ï¼Œå¾ˆæœ‰å¯èƒ½å°†æˆ‘ä»¬çš„ç”¨æˆ·åå¯†ç ç›´æ¥æš´æ¼ç»™ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ï¼Œé£é™©ç‰¹åˆ«å¤§ï¼Œå› æ­¤ç”Ÿäº§ç¯å¢ƒä¸‹ç”¨è¿™ä¸ªæ–¹æ³•å¾ˆå°‘ã€‚</p><h3 id="Sessionå’Œcookie"><a href="#Sessionå’Œcookie" class="headerlink" title="Sessionå’Œcookie"></a>Sessionå’Œcookie</h3><p>sessionå’Œcookieè€ç”Ÿå¸¸è°ˆäº†ã€‚å¼€å§‹æ—¶ï¼Œéƒ½ä¼šåœ¨æœåŠ¡ç«¯å…¨å±€åˆ›å»ºsessionå¯¹è±¡ï¼Œsessionå¯¹è±¡ä¿å­˜ç€å„ç§å…³é”®ä¿¡æ¯ï¼ŒåŒæ—¶å‘å®¢æˆ·ç«¯å‘é€ä¸€ç»„<code>sessionId</code>ï¼Œæˆä¸ºä¸€ä¸ªcookieå¯¹è±¡ä¿å­˜åœ¨æµè§ˆå™¨ä¸­ã€‚</p><p>å½“è®¤è¯æ—¶ï¼Œcookieçš„æ•°æ®ä¼šä¼ å…¥æœåŠ¡ç«¯ä¸sessionè¿›è¡ŒåŒ¹é…ï¼Œè¿›è€Œè¿›è¡Œæ•°æ®è®¤è¯ã€‚</p><p><img src="/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/how-session-work.png" alt="how session work"></p><p>æ­¤æ—¶ï¼Œå®ç°çš„æ˜¯ä¸€ä¸ª<strong>æœ‰çŠ¶æ€</strong>çš„æ€æƒ³ï¼Œå³è¯¥æœåŠ¡çš„å®ä¾‹å¯ä»¥å°†ä¸€éƒ¨åˆ†æ•°æ®éšæ—¶è¿›è¡Œå¤‡ä»½ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„æœ‰çŠ¶æ€æœåŠ¡æ—¶ï¼Œå¯ä»¥é€šè¿‡å¤‡ä»½æ¢å¤è¿™äº›æ•°æ®ï¼Œä»¥è¾¾åˆ°æ•°æ®æŒä¹…åŒ–çš„ç›®çš„ã€‚</p><h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><p>è¿™ç§è®¤è¯æ–¹æ³•åŸºæœ¬æ˜¯ç°åœ¨è½¯ä»¶æœ€å¸¸ç”¨çš„æ–¹æ³•äº†ï¼Œå®ƒæœ‰ä¸€äº›è‡ªå·±çš„ç¼ºç‚¹ï¼š</p><ul><li><strong>å®‰å…¨æ€§</strong>ã€‚cookiesçš„å®‰å…¨æ€§ä¸å¥½ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è·å–æœ¬åœ°cookiesè¿›è¡Œæ¬ºéª—æˆ–è€…åˆ©ç”¨cookiesè¿›è¡Œ<strong>CSRF</strong>æ”»å‡»ã€‚</li><li><strong>è·¨åŸŸé—®é¢˜</strong>ã€‚ä½¿ç”¨cookiesæ—¶ï¼Œåœ¨å¤šä¸ªåŸŸåä¸‹ï¼Œä¼šå­˜åœ¨è·¨åŸŸé—®é¢˜ã€‚</li><li><strong>æœ‰çŠ¶æ€</strong>ã€‚sessionåœ¨ä¸€å®šçš„æ—¶é—´é‡Œï¼Œéœ€è¦å­˜æ”¾åœ¨æœåŠ¡ç«¯ï¼Œå› æ­¤å½“æ‹¥æœ‰å¤§é‡ç”¨æˆ·æ—¶ï¼Œä¹Ÿä¼šå¤§å¹…åº¦é™ä½æœåŠ¡ç«¯çš„æ€§èƒ½ã€‚</li><li><strong>çŠ¶æ€é—®é¢˜</strong>ã€‚å½“æœ‰å¤šå°æœºå™¨æ—¶ï¼Œå¦‚ä½•å…±äº«sessionä¹Ÿä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·ç¬¬ä¸€ä¸ªè®¿é—®çš„æ—¶å€™æ˜¯æœåŠ¡å™¨Aï¼Œè€Œç¬¬äºŒä¸ªè¯·æ±‚è¢«è½¬å‘ç»™äº†æœåŠ¡å™¨Bï¼Œé‚£æœåŠ¡å™¨Bå¦‚ä½•å¾—çŸ¥å…¶çŠ¶æ€ã€‚</li><li><strong>ç§»åŠ¨æ‰‹æœºé—®é¢˜</strong>ã€‚ç°åœ¨çš„æ™ºèƒ½æ‰‹æœºï¼ŒåŒ…æ‹¬å®‰å“ï¼ŒåŸç”Ÿä¸æ”¯æŒcookieï¼Œè¦ä½¿ç”¨cookieæŒºéº»çƒ¦ã€‚</li></ul><h3 id="Tokenè®¤è¯ï¼ˆä½¿ç”¨jwtè§„èŒƒï¼‰"><a href="#Tokenè®¤è¯ï¼ˆä½¿ç”¨jwtè§„èŒƒï¼‰" class="headerlink" title="Tokenè®¤è¯ï¼ˆä½¿ç”¨jwtè§„èŒƒï¼‰"></a>Tokenè®¤è¯ï¼ˆä½¿ç”¨jwtè§„èŒƒï¼‰</h3><p>token å³ä½¿æ˜¯åœ¨è®¡ç®—æœºé¢†åŸŸä¸­ä¹Ÿæœ‰ä¸åŒçš„å®šä¹‰ï¼Œè¿™é‡Œæˆ‘ä»¬è¯´çš„tokenï¼Œæ˜¯æŒ‡ <strong>è®¿é—®èµ„æºçš„å‡­æ®</strong> ã€‚ä½¿ç”¨åŸºäº Token çš„èº«ä»½éªŒè¯æ–¹æ³•ï¼Œåœ¨æœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨ç”¨æˆ·çš„ç™»å½•è®°å½•ã€‚å¤§æ¦‚çš„æµç¨‹æ˜¯ è¿™æ ·çš„ï¼š</p><ol><li>å®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åè·Ÿå¯†ç è¯·æ±‚ç™»å½•  </li><li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œå»éªŒè¯ç”¨æˆ·åä¸å¯†ç  </li><li>éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šç­¾å‘ä¸€ä¸ª Tokenï¼Œå†æŠŠè¿™ä¸ª Token å‘é€ç»™å®¢æˆ·ç«¯ </li><li>å®¢æˆ·ç«¯æ”¶åˆ° Token ä»¥åå¯ä»¥æŠŠå®ƒå­˜å‚¨èµ·æ¥ï¼Œæ¯”å¦‚æ”¾åœ¨ Cookie é‡Œ </li><li>å®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡ç«¯è¯·æ±‚èµ„æºçš„æ—¶å€™éœ€è¦å¸¦ç€æœåŠ¡ç«¯ç­¾å‘çš„ Token </li><li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œç„¶åå»éªŒè¯å®¢æˆ·ç«¯è¯·æ±‚é‡Œé¢å¸¦ç€çš„ Tokenï¼Œå¦‚æœéªŒè¯æˆåŠŸï¼Œå°±å‘å®¢æˆ·ç«¯è¿”å›è¯·æ±‚çš„æ•°æ®</li></ol><p>Tokenæœºåˆ¶ï¼Œæˆ‘è®¤ä¸ºå…¶æœ¬è´¨æ€æƒ³å°±æ˜¯å°†sessionä¸­çš„ä¿¡æ¯ç®€åŒ–å¾ˆå¤šï¼Œå½“ä½œcookieç”¨ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯çš„â€œsessionâ€ã€‚</p><h4 id="å¥½å¤„"><a href="#å¥½å¤„" class="headerlink" title="å¥½å¤„"></a>å¥½å¤„</h4><p>é‚£Tokenæœºåˆ¶ç›¸å¯¹äºCookieæœºåˆ¶åˆæœ‰ä»€ä¹ˆ<strong>å¥½å¤„</strong>å‘¢ï¼Ÿ </p><ul><li><strong>æ”¯æŒè·¨åŸŸè®¿é—®:</strong> Cookieæ˜¯ä¸å…è®¸å®åŸŸè®¿é—®çš„ï¼Œè¿™ä¸€ç‚¹å¯¹Tokenæœºåˆ¶æ˜¯ä¸å­˜åœ¨çš„ï¼Œå‰æ æ˜¯ä¼ è¾“çš„ç”¨æˆ·è®¤è¯ä¿¡æ¯é€šè¿‡HTTPå¤´ä¼ è¾“. </li><li><strong>æ— çŠ¶æ€</strong>:Tokenæœºåˆ¶æœ¬è´¨æ˜¯æ ¡éªŒ, ä»–å¾—åˆ°çš„ä¼šè¯çŠ¶æ€å®Œå…¨æ¥è‡ªäºå®¢æˆ·ç«¯, Tokenæœºåˆ¶åœ¨æœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨sessionä¿¡æ¯ï¼Œå› ä¸º Token è‡ªèº«åŒ…å«äº†æ‰€æœ‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåªéœ€è¦åœ¨å®¢æˆ·ç«¯çš„cookieæˆ–æœ¬åœ°ä»‹è´¨å­˜å‚¨çŠ¶æ€ä¿¡æ¯. </li><li><strong>æ›´é€‚ç”¨CDN</strong>: å¯ä»¥é€šè¿‡å†…å®¹åˆ†å‘ç½‘ç»œè¯·æ±‚ä½ æœåŠ¡ç«¯çš„æ‰€æœ‰èµ„æ–™ï¼ˆå¦‚ï¼šjavascriptï¼Œ HTML,å›¾ç‰‡ç­‰ï¼‰ï¼Œè€Œä½ çš„æœåŠ¡ç«¯åªè¦æä¾›APIå³å¯. </li><li><strong>å»è€¦</strong>: ä¸éœ€è¦ç»‘å®šåˆ°ä¸€ä¸ªç‰¹å®šçš„èº«ä»½éªŒè¯æ–¹æ¡ˆã€‚Tokenå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç”Ÿæˆï¼Œåªè¦åœ¨ ä½ çš„APIè¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä½ å¯ä»¥è¿›è¡ŒTokenç”Ÿæˆè°ƒç”¨å³å¯. </li><li><strong>æ›´é€‚ç”¨äºç§»åŠ¨åº”ç”¨</strong>: å½“ä½ çš„å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªåŸç”Ÿå¹³å°ï¼ˆiOS, Androidï¼ŒWindows 8ç­‰ï¼‰ æ—¶ï¼ŒCookieæ˜¯ä¸è¢«æ”¯æŒçš„ï¼ˆä½ éœ€è¦é€šè¿‡Cookieå®¹å™¨è¿›è¡Œå¤„ç†ï¼‰ï¼Œè¿™æ—¶é‡‡ç”¨Tokenè®¤ è¯æœºåˆ¶å°±ä¼šç®€å•å¾—å¤šã€‚ CSRF:å› ä¸ºä¸å†ä¾èµ–äºCookieï¼Œæ‰€ä»¥ä½ å°±ä¸éœ€è¦è€ƒè™‘å¯¹CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰çš„é˜² èŒƒã€‚ </li><li><strong>æ€§èƒ½</strong>: ä¸€æ¬¡ç½‘ç»œå¾€è¿”æ—¶é—´ï¼ˆé€šè¿‡æ•°æ®åº“æŸ¥è¯¢sessionä¿¡æ¯ï¼‰æ€»æ¯”åšä¸€æ¬¡HMACSHA256 è®¡ç®— çš„TokenéªŒè¯å’Œè§£æè¦è´¹æ—¶å¾—å¤š. ä¸éœ€è¦ä¸ºç™»å½•é¡µé¢åšç‰¹æ®Šå¤„ç†: å¦‚æœä½ ä½¿ç”¨Protractor åšåŠŸèƒ½æµ‹è¯•çš„æ—¶å€™ï¼Œä¸å†éœ€è¦ ä¸ºç™»å½•é¡µé¢åšç‰¹æ®Šå¤„ç†.</li><li><strong>åŸºäºæ ‡å‡†åŒ–</strong>:ä½ çš„APIå¯ä»¥é‡‡ç”¨æ ‡å‡†åŒ–çš„ JSON Web Token (JWT). è¿™ä¸ªæ ‡å‡†å·²ç»å­˜åœ¨ å¤šä¸ªåç«¯åº“ï¼ˆ.NET, Ruby, Java,Python, PHPï¼‰å’Œå¤šå®¶å…¬å¸çš„æ”¯æŒï¼ˆå¦‚ï¼š Firebase,Google, Microsoftï¼‰</li></ul><h4 id="ç¼ºé™·åœ¨å“ªï¼Ÿ"><a href="#ç¼ºé™·åœ¨å“ªï¼Ÿ" class="headerlink" title="ç¼ºé™·åœ¨å“ªï¼Ÿ"></a>ç¼ºé™·åœ¨å“ªï¼Ÿ</h4><p>è¯´äº†é‚£ä¹ˆå¤štokenè®¤è¯çš„å¥½å¤„ï¼Œä½†ä»–å…¶å®å¹¶æ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆç¥ï¼Œtoken ä¹Ÿå¹¶ä¸æ˜¯æ²¡æœ‰é—®é¢˜ã€‚</p><ol><li><p>å å¸¦å®½</p><p>æ­£å¸¸æƒ…å†µä¸‹è¦æ¯” session_id æ›´å¤§ï¼Œéœ€è¦<strong>æ¶ˆè€—æ›´å¤šæµé‡</strong>ï¼ŒæŒ¤å æ›´å¤šå¸¦å®½ï¼Œå‡å¦‚ä½ çš„ç½‘ç«™æ¯æœˆæœ‰ 10 ä¸‡æ¬¡çš„æµè§ˆå™¨ï¼Œå°±æ„å‘³ç€è¦å¤šå¼€é”€å‡ åå…†çš„æµé‡ã€‚å¬èµ·æ¥å¹¶ä¸å¤šï¼Œä½†æ—¥ç§¯æœˆç´¯ä¹Ÿæ˜¯ä¸å°ä¸€ç¬”å¼€é”€ã€‚å®é™…ä¸Šï¼Œè®¸å¤šäººä¼šåœ¨ JWT ä¸­å­˜å‚¨çš„ä¿¡æ¯ä¼šæ›´å¤šã€‚</p></li><li><p>æ— è®ºå¦‚ä½•ä½ éœ€è¦æ“ä½œæ•°æ®åº“</p><p>åœ¨ç½‘ç«™ä¸Šä½¿ç”¨ JWTï¼Œå¯¹äºç”¨æˆ·åŠ è½½çš„å‡ ä¹æ‰€æœ‰é¡µé¢ï¼Œéƒ½éœ€è¦ä»ç¼“å­˜/æ•°æ®åº“ä¸­åŠ è½½ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœå¯¹äºé«˜æµé‡çš„æœåŠ¡ï¼Œä½ ç¡®å®šè¿™ä¸ªæ“ä½œåˆé€‚ä¹ˆï¼Ÿå¦‚æœä½¿ç”¨redisè¿›è¡Œç¼“å­˜ï¼Œé‚£ä¹ˆæ•ˆç‡ä¸Šä¹Ÿå¹¶ä¸èƒ½æ¯” session æ›´é«˜æ•ˆ</p></li><li><p>æ— æ³•åœ¨æœåŠ¡ç«¯æ³¨é”€ï¼Œé‚£ä¹ˆä¹…<strong>å¾ˆéš¾è§£å†³åŠ«æŒ</strong>é—®é¢˜</p></li><li><p>æ€§èƒ½é—®é¢˜</p><p>JWT çš„å–ç‚¹ä¹‹ä¸€å°±æ˜¯åŠ å¯†ç­¾åï¼Œç”±äºè¿™ä¸ªç‰¹æ€§ï¼Œæ¥æ”¶æ–¹å¾—ä»¥éªŒè¯ JWT æ˜¯å¦æœ‰æ•ˆä¸”è¢«ä¿¡ä»»ã€‚ä½†æ˜¯å¤§å¤šæ•° Web èº«ä»½è®¤è¯åº”ç”¨ä¸­ï¼ŒJWT éƒ½ä¼šè¢«å­˜å‚¨åˆ° Cookie ä¸­ï¼Œè¿™å°±æ˜¯è¯´ä½ æœ‰äº†ä¸¤ä¸ªå±‚é¢çš„ç­¾åã€‚å¬ç€ä¼¼ä¹å¾ˆç‰›é€¼ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•ä¼˜åŠ¿ï¼Œä¸ºæ­¤ï¼Œä½ éœ€è¦èŠ±è´¹ä¸¤å€çš„ CPU å¼€é”€æ¥éªŒè¯ç­¾åã€‚å¯¹äºæœ‰ç€ä¸¥æ ¼æ€§èƒ½è¦æ±‚çš„ Web åº”ç”¨ï¼Œè¿™å¹¶ä¸ç†æƒ³ï¼Œå°¤å…¶å¯¹äºå•çº¿ç¨‹ç¯å¢ƒã€‚</p></li></ol><h2 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h2><p>ç°åœ¨æˆ‘ä»¬æ¥è¯´è¯´ä»Šå¤©çš„ä¸»è§’ï¼Œ<code>JWT</code></p><p>JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ä¸ªéå¸¸è½»å·§çš„è§„èŒƒã€‚è¿™ä¸ªè§„èŒƒå…è®¸æˆ‘ä»¬ä½¿ç”¨JWTåœ¨ç”¨ æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’å®‰å…¨å¯é çš„ä¿¡æ¯</p><p><img src="/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/4.png" alt="1543760350545"></p><h3 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h3><p>ä¸€ä¸ªJWTå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œ<strong>å¤´éƒ¨</strong>ã€<strong>è½½è·</strong>ä¸<strong>ç­¾å</strong>ã€‚ </p><h4 id="å¤´éƒ¨-header"><a href="#å¤´éƒ¨-header" class="headerlink" title="å¤´éƒ¨(header)"></a>å¤´éƒ¨(header)</h4><p>å¤´éƒ¨ç”¨äºæè¿°å…³äºè¯¥JWTçš„æœ€åŸºæœ¬çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å…¶ç±»å‹ä»¥åŠç­¾åæ‰€ç”¨çš„ç®—æ³•ç­‰ã€‚è¿™ä¹Ÿå¯ä»¥ è¢«è¡¨ç¤ºæˆä¸€ä¸ªJSONå¯¹è±¡ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"typ"</span>:<span class="string">"JWT"</span>,</span><br><span class="line">    <span class="attr">"alg"</span>:<span class="string">"HS256"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯å¤´éƒ¨çš„æ˜æ–‡å†…å®¹ï¼Œç¬¬ä¸€éƒ¨åˆ†è¯´æ˜ä»–æ˜¯ä¸€ä¸ªjwtï¼Œç¬¬äºŒéƒ¨åˆ†åˆ™æŒ‡å‡ºç­¾åç®—æ³•ç”¨çš„æ˜¯<em>HS256ç®—æ³•</em>ã€‚</p><p>ç„¶åå°†è¿™ä¸ªå¤´éƒ¨è¿›è¡ŒBASE64ç¼–ç ï¼Œç¼–ç åå½¢æˆå¤´éƒ¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9</span><br></pre></td></tr></table></figure><h4 id="è½½è·-payload"><a href="#è½½è·-payload" class="headerlink" title="è½½è·(payload)"></a>è½½è·(payload)</h4><p>è½½è·å°±æ˜¯å­˜æ”¾æœ‰æ•ˆä¿¡æ¯çš„åœ°æ–¹,æœ‰æ•ˆä¿¡æ¯åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†:</p><p>ï¼ˆ1ï¼‰<strong>æ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜</strong>ï¼ˆå»ºè®®ä½†ä¸å¼ºåˆ¶ä½¿ç”¨ï¼‰</p><ul><li>iss: jwtç­¾å‘è€…  </li><li>sub: jwtæ‰€é¢å‘çš„ç”¨æˆ·  </li><li>aud: æ¥æ”¶jwtçš„ä¸€æ–¹  </li><li>exp: jwtçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å¿…é¡»è¦å¤§äºç­¾å‘æ—¶é—´  </li><li>nbf: å®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„.  </li><li>iat: jwtçš„ç­¾å‘æ—¶é—´  </li><li>jti: jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»ã€‚</li></ul><p>ï¼ˆ2ï¼‰<strong>å…¬å…±çš„å£°æ˜</strong><br>å…¬å…±çš„å£°æ˜å¯ä»¥æ·»åŠ ä»»ä½•çš„ä¿¡æ¯ï¼Œä¸€èˆ¬æ·»åŠ ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯æˆ–å…¶ä»–ä¸šåŠ¡éœ€è¦çš„å¿…è¦ä¿¡æ¯. ä½†ä¸å»ºè®®æ·»åŠ æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†åœ¨å®¢æˆ·ç«¯å¯è§£å¯†.  </p><p>ï¼ˆ3ï¼‰<strong>ç§æœ‰çš„å£°æ˜</strong> </p><p>ç§æœ‰å£°æ˜æ˜¯æä¾›è€…å’Œæ¶ˆè´¹è€…æ‰€å…±åŒå®šä¹‰çš„å£°æ˜ï¼Œä¸€èˆ¬ä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºbase64 æ˜¯å¯¹ç§°è§£å¯†çš„ï¼Œæ„å‘³ç€è¯¥éƒ¨åˆ†ä¿¡æ¯å¯ä»¥å½’ç±»ä¸ºæ˜æ–‡ä¿¡æ¯ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"sub"</span>:<span class="string">"1234567890"</span>,</span><br><span class="line">    <span class="attr">"name"</span>:<span class="string">"tengshe789"</span>,</span><br><span class="line">    <span class="attr">"admin"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å°±æ˜¯ä¸€ä¸ªç®€å•çš„è½½è·çš„æ˜æ–‡ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨base64åŠ å¯†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9</span><br></pre></td></tr></table></figure><h4 id="ç­¾è¯ï¼ˆsignatureï¼‰"><a href="#ç­¾è¯ï¼ˆsignatureï¼‰" class="headerlink" title="ç­¾è¯ï¼ˆsignatureï¼‰"></a>ç­¾è¯ï¼ˆsignatureï¼‰</h4><p>jwtçš„ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ä¸€ä¸ªç­¾è¯ä¿¡æ¯ï¼Œè¿™ä¸ªç­¾è¯ä¿¡æ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><ol><li>header (base64åçš„) </li><li>payload (base64åçš„)</li><li>secret</li></ol><p>è¿™ä¸ªéƒ¨åˆ†éœ€è¦base64åŠ å¯†åçš„headerå’Œbase64åŠ å¯†åçš„payloadä½¿ç”¨.è¿æ¥ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡headerä¸­å£°æ˜çš„åŠ å¯†æ–¹å¼è¿›è¡ŒåŠ ç›secretç»„åˆåŠ å¯†ï¼Œç„¶åå°±æ„æˆäº†jwtçš„ç¬¬ ä¸‰éƒ¨åˆ†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</span><br></pre></td></tr></table></figure><h4 id="åˆæˆ"><a href="#åˆæˆ" class="headerlink" title="åˆæˆ"></a>åˆæˆ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6I kpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7Hg Q</span><br></pre></td></tr></table></figure><h2 id="å®ç°JWT"><a href="#å®ç°JWT" class="headerlink" title="å®ç°JWT"></a>å®ç°JWT</h2><p>ç°åœ¨ä¸€èˆ¬å®ç°jwtï¼Œéƒ½ä½¿ç”¨Apache çš„å¼€æºé¡¹ç›®JJWTï¼ˆä¸€ä¸ªæä¾›ç«¯åˆ°ç«¯çš„JWTåˆ›å»ºå’ŒéªŒè¯çš„Javaåº“ï¼‰ã€‚</p><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºtokençš„demo"><a href="#åˆ›å»ºtokençš„demo" class="headerlink" title="åˆ›å»ºtokençš„demo"></a>åˆ›å»ºtokençš„demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateJWT</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        JwtBuilder builder = Jwts.builder().setId(<span class="string">"123"</span>)</span><br><span class="line">                .setSubject(<span class="string">"jwtæ‰€é¢å‘çš„ç”¨æˆ·"</span>)</span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> Date())</span><br><span class="line">                .signWith(SignatureAlgorithm.HS256,<span class="string">"tengshe789"</span>);</span><br><span class="line">        String s = builder.compact();</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        <span class="comment">//eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIxMjMiLCJzdWIiOiJqd3TmiYDpnaLlkJHnmoTnlKjmiLciLCJpYXQiOjE1NDM3NTk0MjJ9.1sIlEynqqZmA4PbKI6GgiP3ljk_aiypcsUxSN6-ATIA</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚å›¾ï¼š</p><p><img src="/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/2.png" alt="1543759471279"></p><p>ï¼ˆæ³¨æ„ï¼Œjjwtä¸æ”¯æŒjdk11ï¼Œ0.9.1ä»¥åçš„jjwtå¿…é¡»å®ç°signWith()æ–¹æ³•æ‰èƒ½å®ç°ï¼‰</p><h3 id="è§£æTokençš„demo"><a href="#è§£æTokençš„demo" class="headerlink" title="è§£æTokençš„demo"></a>è§£æTokençš„demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParseJWT</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String token = <span class="string">"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIxMjMiLCJzdWIiOiJqd3TmiYDpnaLlkJHnmoTnlKjmiLciLCJpYXQiOjE1NDM3NTk0MjJ9.1sIlEynqqZmA4PbKI6GgiP3ljk_aiypcsUxSN6-ATIA"</span>;</span><br><span class="line"></span><br><span class="line">        Claims claims =</span><br><span class="line">                Jwts.parser().setSigningKey(<span class="string">"tengshe789"</span>).parseClaimsJws(token).getBody();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"id"</span>+claims.getId());</span><br><span class="line">        System.out.println(<span class="string">"Subject"</span>+claims.getSubject());</span><br><span class="line">        System.out.println(<span class="string">"IssuedAt"</span>+claims.getIssuedAt());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚å›¾ï¼š</p><p><img src="/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/3.png" alt="1543759769057"></p><h2 id="ç”Ÿäº§ä¸­çš„JWT"><a href="#ç”Ÿäº§ä¸­çš„JWT" class="headerlink" title="ç”Ÿäº§ä¸­çš„JWT"></a>ç”Ÿäº§ä¸­çš„JWT</h2><p>åœ¨ä¼ä¸šçº§ç³»ç»Ÿä¸­ï¼Œé€šå¸¸å†…éƒ¨ä¼šæœ‰éå¸¸å¤šçš„å·¥å…·å¹³å°ä¾›å¤§å®¶ä½¿ç”¨ï¼Œæ¯”å¦‚äººåŠ›èµ„æºï¼Œä»£ç ç®¡ç†ï¼Œæ—¥å¿—ç›‘æ§ï¼Œé¢„ç®—ç”³è¯·ç­‰ç­‰ã€‚å¦‚æœæ¯ä¸€ä¸ªå¹³å°éƒ½å®ç°è‡ªå·±çš„ç”¨æˆ·ä½“ç³»çš„è¯æ— ç–‘æ˜¯å·¨å¤§çš„æµªè´¹ï¼Œæ‰€ä»¥å…¬å¸å†…éƒ¨ä¼šæœ‰ä¸€å¥—å…¬ç”¨çš„ç”¨æˆ·ä½“ç³»ï¼Œç”¨æˆ·åªè¦ç™»é™†ä¹‹åï¼Œå°±èƒ½å¤Ÿè®¿é—®æ‰€æœ‰çš„ç³»ç»Ÿã€‚</p><p>è¿™å°±æ˜¯ <strong>å•ç‚¹ç™»å½•ï¼ˆSSO: Single Sign-Onï¼‰</strong></p><p>SSO æ˜¯ä¸€ç±»è§£å†³æ–¹æ¡ˆçš„ç»Ÿç§°ï¼Œè€Œåœ¨å…·ä½“çš„å®æ–½æ–¹é¢ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§ç­–ç•¥å¯ä¾›é€‰æ‹©ï¼š</p><ol><li>SAML 2.0</li><li>OAuth 2.0</li></ol><p>æ¬²æ‰¬å…ˆæŠ‘ï¼Œå…ˆè¯´è¯´å‡ ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹ã€‚</p><h3 id="Authentication-VS-Authorisation"><a href="#Authentication-VS-Authorisation" class="headerlink" title="Authentication VS Authorisation"></a>Authentication VS Authorisation</h3><ul><li><p>Authentication: èº«ä»½é‰´åˆ«ï¼Œé‰´æƒï¼Œä»¥ä¸‹ç®€ç§°è®¤è¯</p><p><strong>è®¤è¯</strong> çš„ä½œç”¨åœ¨äºè®¤å¯ä½ æœ‰æƒé™è®¿é—®ç³»ç»Ÿï¼Œç”¨äºé‰´åˆ«è®¿é—®è€…æ˜¯å¦æ˜¯åˆæ³•ç”¨æˆ·ã€‚è´Ÿè´£è®¤è¯çš„æœåŠ¡é€šå¸¸ç§°ä¸º Authorization Server æˆ–è€… Identity Providerï¼Œä»¥ä¸‹ç®€ç§° <strong>IdP</strong></p></li><li><p>Authorisation: æˆæƒ</p><p> <strong>æˆæƒ</strong> ç”¨äºå†³å®šä½ æœ‰è®¿é—®å“ªäº›èµ„æºçš„æƒé™ã€‚å¤§å¤šæ•°äººä¸ä¼šåŒºåˆ†è¿™ä¸¤è€…çš„åŒºåˆ«ï¼Œå› ä¸ºç«™åœ¨ç”¨æˆ·çš„ç«‹åœºä¸Šã€‚è€Œä½œä¸ºç³»ç»Ÿçš„è®¾è®¡è€…æ¥è¯´ï¼Œè¿™ä¸¤è€…æ˜¯æœ‰å·®åˆ«çš„ï¼Œè¿™æ˜¯ä¸åŒçš„ä¸¤ä¸ªå·¥ä½œèŒè´£ï¼Œæˆ‘ä»¬å¯ä»¥åªéœ€è¦è®¤è¯åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦æˆæƒåŠŸèƒ½ï¼Œç”šè‡³ä¸éœ€è¦è‡ªå·±å®ç°è®¤è¯åŠŸèƒ½ï¼Œè€Œå€ŸåŠ© Google çš„è®¤è¯ç³»ç»Ÿï¼Œå³ç”¨æˆ·å¯ä»¥ç”¨ Google çš„è´¦å·è¿›è¡Œç™»é™†ã€‚è´Ÿè´£æä¾›èµ„æºï¼ˆAPIè°ƒç”¨ï¼‰çš„æœåŠ¡ç§°ä¸º Resource Server æˆ–è€… Service Providerï¼Œä»¥ä¸‹ç®€ç§° <strong>SP</strong></p></li></ul><h3 id="SMAL-2-0"><a href="#SMAL-2-0" class="headerlink" title="SMAL 2.0"></a>SMAL 2.0</h3><p><img src="/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/smalflow.png" alt="smal flow"></p><h3 id="OAuthï¼ˆJWTï¼‰"><a href="#OAuthï¼ˆJWTï¼‰" class="headerlink" title="OAuthï¼ˆJWTï¼‰"></a>OAuthï¼ˆJWTï¼‰</h3><p>OAuthï¼ˆå¼€æ”¾æˆæƒï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾çš„æˆæƒæ ‡å‡†ï¼Œå…è®¸ç”¨æˆ·è®©ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®è¯¥ç”¨æˆ·åœ¨ æŸä¸€webæœåŠ¡ä¸Šå­˜å‚¨çš„ç§å¯†çš„èµ„æºï¼ˆå¦‚ç…§ç‰‡ï¼Œè§†é¢‘ï¼Œè”ç³»äººåˆ—è¡¨ï¼‰ï¼Œè€Œæ— éœ€å°†ç”¨æˆ·åå’Œå¯†ç æä¾›ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚</p><p>æµç¨‹å¯ä»¥å‚è€ƒå¦‚ä¸‹ï¼š</p><p><img src="/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/1.png" alt="oauth"></p><p>ç®€å•çš„æ¥è¯´ï¼Œå°±æ˜¯ä½ è¦è®¿é—®ä¸€ä¸ªåº”ç”¨æœåŠ¡ï¼Œå…ˆæ‰¾å®ƒè¦ä¸€ä¸ª<code>request token</code>ï¼ˆè¯·æ±‚ä»¤ç‰Œï¼‰ï¼Œå†æŠŠè¿™ä¸ª<code>request token</code>å‘åˆ°ç¬¬ä¸‰æ–¹è®¤è¯æœåŠ¡å™¨ï¼Œæ­¤æ—¶ç¬¬ä¸‰æ–¹è®¤è¯æœåŠ¡å™¨ä¼šç»™ä½ ä¸€ä¸ª<code>aceess token</code>ï¼ˆé€šè¡Œä»¤ç‰Œï¼‰, æœ‰äº†<code>aceess token</code>ä½ å°±å¯ä»¥ä½¿ç”¨ä½ çš„åº”ç”¨æœåŠ¡äº†ã€‚</p><p>æ³¨æ„å›¾ä¸­ç¬¬4æ­¥å…‘æ¢ <code>access token</code> çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œå¦‚Google ï¼Œå¹¶ä¸ä¼šä»…ä»…è¿”å› <code>access token</code>ï¼Œè¿˜ä¼šè¿”å›é¢å¤–çš„ä¿¡æ¯ï¼Œè¿™å…¶ä¸­å’Œä¹‹åæ›´æ–°ç›¸å…³çš„å°±æ˜¯ <code>refresh token</code>ã€‚ä¸€æ—¦ <code>access token</code>è¿‡æœŸï¼Œä½ å°±å¯ä»¥é€šè¿‡ <code>refresh token</code> å†æ¬¡è¯·æ±‚ <code>access token</code>ã€‚</p><p><img src="/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/refresh-token.png" alt="refresh token"></p><p>å½“ç„¶äº†ï¼Œæµç¨‹æ˜¯æ ¹æ®ä½ çš„è¯·æ±‚æ–¹å¼å’Œè®¿é—®çš„èµ„æºç±»å‹è€Œå®šçš„ï¼Œä¸šåŠ¡å¾ˆå¤šä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ‘è¿™æ˜¯ç®€å•çš„èŠèŠã€‚</p><p>ç°åœ¨è¿™ç§æ–¹æ³•æ¯”è¾ƒå¸¸è§ï¼Œå¸¸è§çš„è­¬å¦‚ä½¿ç”¨QQå¿«é€Ÿç™»é™†ï¼Œç”¨çš„åŸºæœ¬çš„éƒ½æ˜¯è¿™ç§æ–¹æ³•ã€‚</p><h3 id="å¼€æºé¡¹ç›®"><a href="#å¼€æºé¡¹ç›®" class="headerlink" title="å¼€æºé¡¹ç›®"></a>å¼€æºé¡¹ç›®</h3><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªå¾ˆç«çš„å¼€æºé¡¹ç›®<a href="https://gitee.com/minull/ace-security" target="_blank" rel="noopener">Cloud-Admin</a>ä¸ºæ —å­ï¼Œæ¥åˆ†æä¸€ä¸‹jwtçš„åº”ç”¨ã€‚</p><p>Cloud-Adminæ˜¯åŸºäºSpring Cloudå¾®æœåŠ¡åŒ–å¼€å‘å¹³å°ï¼Œå…·æœ‰ç»Ÿä¸€æˆæƒã€è®¤è¯åå°ç®¡ç†ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…å«å…·å¤‡ç”¨æˆ·ç®¡ç†ã€èµ„æºæƒé™ç®¡ç†ã€ç½‘å…³APIç®¡ç†ç­‰å¤šä¸ªæ¨¡å—ï¼Œæ”¯æŒå¤šä¸šåŠ¡ç³»ç»Ÿå¹¶è¡Œå¼€å‘ã€‚</p><h4 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h4><p><img src="/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/5.png" alt="1543763543823"></p><p>é‰´æƒä¸­å¿ƒåŠŸèƒ½åœ¨<code>ace-auth</code>ä¸<code>ace-gate</code>ä¸‹ã€‚</p><h4 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p>ä¸‹é¢æ˜¯å®˜æ–¹æä¾›çš„æ¶æ„æ¨¡å‹ã€‚</p><p><img src="/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/6.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>AuthServer</code>åœ¨æ¶æ„çš„ä¸­å¿ƒç¯èŠ‚ï¼Œè¦è®¿é—®æœåŠ¡ï¼Œå¿…é¡»éœ€è¦é‰´æƒä¸­å¿ƒçš„JWTé‰´æƒã€‚</p><h3 id="é‰´æƒä¸­å¿ƒæœåŠ¡ç«¯ä»£ç è§£è¯»"><a href="#é‰´æƒä¸­å¿ƒæœåŠ¡ç«¯ä»£ç è§£è¯»" class="headerlink" title="é‰´æƒä¸­å¿ƒæœåŠ¡ç«¯ä»£ç è§£è¯»"></a>é‰´æƒä¸­å¿ƒæœåŠ¡ç«¯ä»£ç è§£è¯»</h3><h4 id="å®ä½“ç±»"><a href="#å®ä½“ç±»" class="headerlink" title="å®ä½“ç±»"></a>å®ä½“ç±»</h4><p>å…ˆçœ‹å®ä½“ç±»ï¼Œè¿™é‡Œé‰´æƒä¸­å¿ƒå®šä¹‰äº†ä¸€ç»„å®¢æˆ·ç«¯å®ä½“ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table</span>(name = <span class="string">"auth_client"</span>)</span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String secret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String locked = <span class="string">"0"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"crt_time"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date crtTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"crt_user"</span>)</span><br><span class="line">    <span class="keyword">private</span> String crtUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"crt_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String crtName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"crt_host"</span>)</span><br><span class="line">    <span class="keyword">private</span> String crtHost;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"upd_time"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date updTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"upd_user"</span>)</span><br><span class="line">    <span class="keyword">private</span> String updUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"upd_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String updName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"upd_host"</span>)</span><br><span class="line">    <span class="keyword">private</span> String updHost;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String attr1;</span><br><span class="line">    <span class="keyword">private</span> String attr2;</span><br><span class="line">    <span class="keyword">private</span> String attr3;</span><br><span class="line">    <span class="keyword">private</span> String attr4;</span><br><span class="line">    <span class="keyword">private</span> String attr5;</span><br><span class="line">    <span class="keyword">private</span> String attr6;</span><br><span class="line">    <span class="keyword">private</span> String attr7;</span><br><span class="line">    <span class="keyword">private</span> String attr8;</span><br></pre></td></tr></table></figure><p>å¯¹åº”æ•°æ®åº“ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`auth_client`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`code`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æœåŠ¡ç¼–ç '</span>,</span><br><span class="line">  <span class="string">`secret`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æœåŠ¡å¯†é’¥'</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æœåŠ¡å'</span>,</span><br><span class="line">  <span class="string">`locked`</span> <span class="built_in">char</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ˜¯å¦é”å®š'</span>,</span><br><span class="line">  <span class="string">`description`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æè¿°'</span>,</span><br><span class="line">  <span class="string">`crt_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'åˆ›å»ºæ—¶é—´'</span>,</span><br><span class="line">  <span class="string">`crt_user`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'åˆ›å»ºäºº'</span>,</span><br><span class="line">  <span class="string">`crt_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'åˆ›å»ºäººå§“å'</span>,</span><br><span class="line">  <span class="string">`crt_host`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'åˆ›å»ºä¸»æœº'</span>,</span><br><span class="line">  <span class="string">`upd_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ›´æ–°æ—¶é—´'</span>,</span><br><span class="line">  <span class="string">`upd_user`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ›´æ–°äºº'</span>,</span><br><span class="line">  <span class="string">`upd_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ›´æ–°å§“å'</span>,</span><br><span class="line">  <span class="string">`upd_host`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ›´æ–°ä¸»æœº'</span>,</span><br><span class="line">  <span class="string">`attr1`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`attr2`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`attr3`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`attr4`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`attr5`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`attr6`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`attr7`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`attr8`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">14</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4;</span><br></pre></td></tr></table></figure><p>è¿™äº›æ˜¯æ¯ç»„å¾®æœåŠ¡å®¢æˆ·ç«¯çš„ä¿¡æ¯</p><p>ç¬¬äºŒä¸ªå®ä½“ç±»ï¼Œå°±æ˜¯å®¢æˆ·ç«¯_æœåŠ¡çš„å®ä½“ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€é‚£äº›å¾®æœåŠ¡å®¢æˆ·ç«¯èƒ½è°ƒç”¨å“ªäº›å¾®æœåŠ¡å®¢æˆ·ç«¯ï¼š</p><p>å¤§æ¦‚å¯¹åº”çš„å°±æ˜¯å¾®æœåŠ¡é—´è°ƒç”¨æƒé™å…³ç³»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table</span>(name = <span class="string">"auth_client_service"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"service_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> String serviceId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"client_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> String clientId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"crt_time"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date crtTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"crt_user"</span>)</span><br><span class="line">    <span class="keyword">private</span> String crtUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"crt_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String crtName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"crt_host"</span>)</span><br><span class="line">    <span class="keyword">private</span> String crtHost;&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¥å£å±‚"><a href="#æ¥å£å±‚" class="headerlink" title="æ¥å£å±‚"></a>æ¥å£å±‚</h4><p>æˆ‘ä»¬è·³ç€çœ‹ï¼Œå…ˆçœ‹æ¥å£å±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"jwt"</span>)</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jwt.token-header&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String tokenHeader;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthService authService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"token"</span>, method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObjectRestResponse&lt;String&gt; <span class="title">createAuthenticationToken</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @RequestBody JwtAuthenticationRequest authenticationRequest)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.info(authenticationRequest.getUsername()+<span class="string">" require logging..."</span>);</span><br><span class="line">        <span class="keyword">final</span> String token = authService.login(authenticationRequest);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ObjectRestResponse&lt;&gt;().data(token);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"refresh"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObjectRestResponse&lt;String&gt; <span class="title">refreshAndGetAuthenticationToken</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String token = request.getHeader(tokenHeader);</span><br><span class="line">        String refreshedToken = authService.refresh(token);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ObjectRestResponse&lt;&gt;().data(refreshedToken);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"verify"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="keyword">public</span> ObjectRestResponse&lt;?&gt; verify(String token) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        authService.validate(token);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ObjectRestResponse&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ”¾å‡ºäº†ä¸‰ä¸ªæ¥å£</p><p>å…ˆè¯´ç¬¬ä¸€ä¸ªæ¥å£ï¼Œåˆ›å»º<code>token</code>ã€‚</p><p>å…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š<br>æ¯ä¸€ä¸ªç”¨æˆ·<strong>ç™»é™†</strong>è¿›æ¥æ—¶ï¼Œéƒ½ä¼šè¿›å…¥è¿™ä¸ªç¯èŠ‚ã€‚æ ¹æ®requestä¸­ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ©ç”¨<code>feign</code>å®¢æˆ·ç«¯çš„æ‹¦æˆªå™¨æ‹¦æˆªrequestï¼Œç„¶åä½¿ç”¨ä½œè€…å†™çš„<code>JwtTokenUtil</code>é‡Œé¢çš„å„ç§æ–¹æ³•å–å‡ºtokenä¸­çš„keyå’Œå¯†é’¥ï¼ŒéªŒè¯tokenæ˜¯å¦æ­£ç¡®ï¼Œæ­£ç¡®åˆ™ç”¨<code>authService.login(authenticationRequest);</code>çš„æ–¹æ³•è¿”å›å‡ºå»ä¸€ä¸ªæ–°çš„tokenã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(JwtAuthenticationRequest authenticationRequest)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        UserInfo info = userService.validate(authenticationRequest);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(info.getId())) &#123;</span><br><span class="line">            <span class="keyword">return</span> jwtTokenUtil.generateToken(<span class="keyword">new</span> JWTInfo(info.getUsername(), info.getId() + <span class="string">""</span>, info.getName()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UserInvalidException(<span class="string">"ç”¨æˆ·ä¸å­˜åœ¨æˆ–è´¦æˆ·å¯†ç é”™è¯¯!"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾æ˜¯è¯¦ç»†é€»è¾‘å›¾ï¼š</p><p><img src="/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/model.png" alt="model"></p><h3 id="é‰´æƒä¸­å¿ƒå®¢æˆ·ç«¯ä»£ç "><a href="#é‰´æƒä¸­å¿ƒå®¢æˆ·ç«¯ä»£ç " class="headerlink" title="é‰´æƒä¸­å¿ƒå®¢æˆ·ç«¯ä»£ç "></a>é‰´æƒä¸­å¿ƒå®¢æˆ·ç«¯ä»£ç </h3><h4 id="å…¥å£"><a href="#å…¥å£" class="headerlink" title="å…¥å£"></a>å…¥å£</h4><p>ä½œè€…å†™äº†ä¸ªæ³¨è§£çš„å…¥å£ï¼Œä½¿ç”¨<code>@EnableAceAuthClient</code>å³è‡ªåŠ¨å¼€å¯å¾®æœåŠ¡(å®¢æˆ·ç«¯)çš„é‰´æƒç®¡ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Import</span>(AutoConfiguration.class)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAceAuthClient &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>æ¥ç€æ²¿ç€æ³¨è§£çš„å…¥å£çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(&#123;<span class="string">"com.github.wxiaoqi.security.auth.client"</span>,<span class="string">"com.github.wxiaoqi.security.auth.common.event"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">ServiceAuthConfig <span class="title">getServiceAuthConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServiceAuthConfig();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">UserAuthConfig <span class="title">getUserAuthConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserAuthConfig();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨è§£ä¼šè‡ªåŠ¨çš„å°†å®¢æˆ·ç«¯çš„ç”¨æˆ·tokenå’ŒæœåŠ¡tokençš„å…³é”®ä¿¡æ¯åŠ è½½åˆ°beanä¸­</p><h4 id="feiginæ‹¦æˆªå™¨"><a href="#feiginæ‹¦æˆªå™¨" class="headerlink" title="feiginæ‹¦æˆªå™¨"></a>feiginæ‹¦æˆªå™¨</h4><p>ä½œè€…é‡å†™äº†<code>okhttp3</code>æ‹¦æˆªå™¨çš„æ–¹æ³•ï¼Œæ¯ä¸€æ¬¡å¾®æœåŠ¡å®¢æˆ·ç«¯è¯·æ±‚çš„tokenéƒ½ä¼šè¢«æ‹¦æˆªä¸‹æ¥ï¼ŒéªŒè¯æœåŠ¡è°ƒç”¨æœåŠ¡çš„tokenå’Œç”¨æˆ·è°ƒç”¨æœåŠ¡çš„tokenæ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸåˆ™è¿”å›æ–°çš„token</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Request newRequest = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (chain.request().url().toString().contains(<span class="string">"client/token"</span>)) &#123;</span><br><span class="line">            newRequest = chain.request()</span><br><span class="line">                    .newBuilder()</span><br><span class="line">                    .header(userAuthConfig.getTokenHeader(), BaseContextHandler.getToken())</span><br><span class="line">                    .build();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newRequest = chain.request()</span><br><span class="line">                    .newBuilder()</span><br><span class="line">                    .header(userAuthConfig.getTokenHeader(), BaseContextHandler.getToken())</span><br><span class="line">                    .header(serviceAuthConfig.getTokenHeader(), serviceAuthUtil.getClientToken())</span><br><span class="line">                    .build();</span><br><span class="line">        &#125;</span><br><span class="line">        Response response = chain.proceed(newRequest);</span><br><span class="line">        <span class="keyword">if</span> (HttpStatus.FORBIDDEN.value() == response.code()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (response.body().string().contains(String.valueOf(CommonConstants.EX_CLIENT_INVALID_CODE))) &#123;</span><br><span class="line">                log.info(<span class="string">"Client Token Expire,Retry to request..."</span>);</span><br><span class="line">                serviceAuthUtil.refreshClientToken();</span><br><span class="line">                newRequest = chain.request()</span><br><span class="line">                        .newBuilder()</span><br><span class="line">                        .header(userAuthConfig.getTokenHeader(), BaseContextHandler.getToken())</span><br><span class="line">                        .header(serviceAuthConfig.getTokenHeader(), serviceAuthUtil.getClientToken())</span><br><span class="line">                        .build();</span><br><span class="line">                response = chain.proceed(newRequest);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="springå®¹å™¨çš„æ‹¦æˆªå™¨"><a href="#springå®¹å™¨çš„æ‹¦æˆªå™¨" class="headerlink" title="springå®¹å™¨çš„æ‹¦æˆªå™¨"></a>springå®¹å™¨çš„æ‹¦æˆªå™¨</h4><p>ç¬¬äºŒé“æ‹¦æˆªå™¨æ˜¯æ¥è‡ªspringå®¹å™¨çš„ï¼Œç¬¬ä¸€é“feignæ‹¦æˆªå™¨åªæ˜¯éªŒè¯äº†ä¸¤ä¸ªtokenæ˜¯å¦è¿‡æœŸï¼Œä½†tokençœŸå®çš„æƒé™å´æ²¡éªŒè¯ã€‚æ¥ä¸‹æ¥å°±è¦éªŒè¯ä¸¤ä¸ªtokençš„æƒé™é—®é¢˜äº†ã€‚</p><p>æœåŠ¡è°ƒç”¨æƒé™ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HandlerMethod handlerMethod = (HandlerMethod) handler;</span><br><span class="line">        <span class="comment">// é…ç½®è¯¥æ³¨è§£ï¼Œè¯´æ˜ä¸è¿›è¡ŒæœåŠ¡æ‹¦æˆª</span></span><br><span class="line">        IgnoreClientToken annotation = handlerMethod.getBeanType().getAnnotation(IgnoreClientToken.class);</span><br><span class="line">        <span class="keyword">if</span> (annotation == <span class="keyword">null</span>) &#123;</span><br><span class="line">            annotation = handlerMethod.getMethodAnnotation(IgnoreClientToken.class);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(annotation!=<span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String token = request.getHeader(serviceAuthConfig.getTokenHeader());</span><br><span class="line">        IJWTInfo infoFromToken = serviceAuthUtil.getInfoFromToken(token);</span><br><span class="line">        String uniqueName = infoFromToken.getUniqueName();</span><br><span class="line">        <span class="keyword">for</span>(String client:serviceAuthUtil.getAllowedClient())&#123;</span><br><span class="line">            <span class="keyword">if</span>(client.equals(uniqueName))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ClientForbiddenException(<span class="string">"Client is Forbidden!"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·æƒé™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HandlerMethod handlerMethod = (HandlerMethod) handler;</span><br><span class="line">        <span class="comment">// é…ç½®è¯¥æ³¨è§£ï¼Œè¯´æ˜ä¸è¿›è¡Œç”¨æˆ·æ‹¦æˆª</span></span><br><span class="line">        IgnoreUserToken annotation = handlerMethod.getBeanType().getAnnotation(IgnoreUserToken.class);</span><br><span class="line">        <span class="keyword">if</span> (annotation == <span class="keyword">null</span>) &#123;</span><br><span class="line">            annotation = handlerMethod.getMethodAnnotation(IgnoreUserToken.class);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (annotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">        &#125;</span><br><span class="line">        String token = request.getHeader(userAuthConfig.getTokenHeader());</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(token)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (request.getCookies() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Cookie cookie : request.getCookies()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cookie.getName().equals(userAuthConfig.getTokenHeader())) &#123;</span><br><span class="line">                        token = cookie.getValue();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        IJWTInfo infoFromToken = userAuthUtil.getInfoFromToken(token);</span><br><span class="line">        BaseContextHandler.setUsername(infoFromToken.getUniqueName());</span><br><span class="line">        BaseContextHandler.setName(infoFromToken.getName());</span><br><span class="line">        BaseContextHandler.setUserID(infoFromToken.getId());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        BaseContextHandler.remove();</span><br><span class="line">        <span class="keyword">super</span>.afterCompletion(request, response, handler, ex);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="spring-cloud-gatewayç½‘å…³ä»£ç "><a href="#spring-cloud-gatewayç½‘å…³ä»£ç " class="headerlink" title="spring cloud gatewayç½‘å…³ä»£ç "></a>spring cloud gatewayç½‘å…³ä»£ç </h3><p>è¯¥æ¡†æ¶ä¸­æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šèµ°ç½‘å…³æœåŠ¡ï¼ˆace-gatev2ï¼‰ï¼Œé€šè¿‡ç½‘å…³ï¼Œæ¥éªŒè¯tokenæ˜¯å¦è¿‡æœŸå¼‚å¸¸ï¼ŒéªŒè¯tokenæ˜¯å¦ä¸å­˜åœ¨ï¼ŒéªŒè¯tokenæ˜¯å¦æœ‰æƒé™è¿›è¡ŒæœåŠ¡ã€‚</p><p>ä¸‹é¢æ˜¯æ ¸å¿ƒä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange serverWebExchange, GatewayFilterChain gatewayFilterChain)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"check token and user permission...."</span>);</span><br><span class="line">        LinkedHashSet requiredAttribute = serverWebExchange.getRequiredAttribute(ServerWebExchangeUtils.GATEWAY_ORIGINAL_REQUEST_URL_ATTR);</span><br><span class="line">        ServerHttpRequest request = serverWebExchange.getRequest();</span><br><span class="line">        String requestUri = request.getPath().pathWithinApplication().value();</span><br><span class="line">        <span class="keyword">if</span> (requiredAttribute != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Iterator&lt;URI&gt; iterator = requiredAttribute.iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">                URI next = iterator.next();</span><br><span class="line">                <span class="keyword">if</span>(next.getPath().startsWith(GATE_WAY_PREFIX))&#123;</span><br><span class="line">                    requestUri = next.getPath().substring(GATE_WAY_PREFIX.length());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> String method = request.getMethod().toString();</span><br><span class="line">        BaseContextHandler.setToken(<span class="keyword">null</span>);</span><br><span class="line">        ServerHttpRequest.Builder mutate = request.mutate();</span><br><span class="line">        <span class="comment">// ä¸è¿›è¡Œæ‹¦æˆªçš„åœ°å€</span></span><br><span class="line">        <span class="keyword">if</span> (isStartWith(requestUri)) &#123;</span><br><span class="line">            ServerHttpRequest build = mutate.build();</span><br><span class="line">            <span class="keyword">return</span> gatewayFilterChain.filter(serverWebExchange.mutate().request(build).build());</span><br><span class="line">        &#125;</span><br><span class="line">        IJWTInfo user = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            user = getJWTUser(request, mutate);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"ç”¨æˆ·Tokenè¿‡æœŸå¼‚å¸¸"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> getVoidMono(serverWebExchange, <span class="keyword">new</span> TokenForbiddenResponse(<span class="string">"User Token Forbidden or Expired!"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;PermissionInfo&gt; permissionIfs = userService.getAllPermissionInfo();</span><br><span class="line">        <span class="comment">// åˆ¤æ–­èµ„æºæ˜¯å¦å¯ç”¨æƒé™çº¦æŸ</span></span><br><span class="line">        Stream&lt;PermissionInfo&gt; stream = getPermissionIfs(requestUri, method, permissionIfs);</span><br><span class="line">        List&lt;PermissionInfo&gt; result = stream.collect(Collectors.toList());</span><br><span class="line">        PermissionInfo[] permissions = result.toArray(<span class="keyword">new</span> PermissionInfo[]&#123;&#125;);</span><br><span class="line">        <span class="keyword">if</span> (permissions.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (checkUserPermission(permissions, serverWebExchange, user)) &#123;</span><br><span class="line">                <span class="keyword">return</span> getVoidMono(serverWebExchange, <span class="keyword">new</span> TokenForbiddenResponse(<span class="string">"User Forbidden!Does not has Permission!"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç”³è¯·å®¢æˆ·ç«¯å¯†é’¥å¤´</span></span><br><span class="line">        mutate.header(serviceAuthConfig.getTokenHeader(), serviceAuthUtil.getClientToken());</span><br><span class="line">        ServerHttpRequest build = mutate.build();</span><br><span class="line">        <span class="keyword">return</span> gatewayFilterChain.filter(serverWebExchange.mutate().request(build).build());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="/2018/12/02/æ„Ÿæ€§è®¤è¯†JWT/7.png" alt="1543848104059"></p><h3 id="cloud-adminæ€»ç»“"><a href="#cloud-adminæ€»ç»“" class="headerlink" title="cloud adminæ€»ç»“"></a>cloud adminæ€»ç»“</h3><p>æ€»çš„æ¥è¯´ï¼Œé‰´æƒå’Œç½‘å…³æ¨¡å—å°±è¯´å®Œäº†ã€‚ä½œè€…ä»£ç æ„æ€æå…¶ç²¾å¦™ï¼Œä½¿ç”¨åœ¨å¤§å‹çš„æƒé™ç³»ç»Ÿä¸­ï¼Œå¯ä»¥å·§å¦™çš„å‡å°‘è€¦åˆæ€§ï¼Œè®©æœåŠ¡é‰´æƒç²’åº¦ç»†åŒ–ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚</p><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> </p><p>æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨<a href="https://blog.tengshe789.tech/2018/12/02/%E6%84%9F%E6%80%A7%E8%AE%A4%E8%AF%86jwt/#more" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a>ç‡å…ˆå‘è¡¨ï¼Œéšåçœ‹å¿ƒæƒ…å¯èƒ½ä¼šåœ¨CSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œ<strong>ç¼˜åˆ†å‘¢</strong>å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹ï¼Œå’±ä»¬ä¸¤ä¸ªæƒ³ä¸ªå·ç ï¼Œ ä¹°ä¸ªå½©ç¥¨ï¼Œå…ˆæŒ£ä»–ä¸ªå‡ ç™¾ä¸‡ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¥½ä¹…æ²¡å†™åšå®¢äº†ï¼Œå› ä¸ºæœ€è¿‘å…¬å¸è¦æ±‚æˆ‘å­¦&lt;code&gt;spring cloud&lt;/code&gt;ï¼Œæ—©ç‚¹å°†ä»¥å‰è½¯ä»¶è¿ç§»åˆ°æ–°çš„æ¶æ„ä¸Šã€‚æ‰€ä»¥æˆ‘é‚£ä¸ªæ‹¼å‘½çš„å­¦å‘ï¼Œæ€»æ˜¯å›¾å¿«ï¼Œå¾ˆå¤šå…³é”®çš„ç¬”è®°æ²¡æœ‰åšå¥½è®°å½•ï¼Œç°åœ¨åˆé—å¿˜äº†å¾ˆå¤šå…³é”®çš„æŠ€æœ¯ç‚¹ï¼Œæå…¶ç½ªæ¶ï¼&lt;/p&gt;
&lt;p&gt;ç°åœ¨æƒ³ä¸€æƒ³ï¼Œè¿˜æ˜¯è¸è¸å®å®çš„èµ°æ¯”è¾ƒå¥½ã€‚è¿™
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="æºç " scheme="https://tengshe789.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="å­¦å¥½åˆ†å¸ƒå¼æ¶æ„" scheme="https://tengshe789.github.io/tags/%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/"/>
    
      <category term="ç½‘ç»œ" scheme="https://tengshe789.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>å…‰é²œä¸‹çš„china</title>
    <link href="https://tengshe789.github.io/2018/11/03/%E5%88%86%E4%BA%AB%E5%BE%AE%E5%8D%9A/"/>
    <id>https://tengshe789.github.io/2018/11/03/åˆ†äº«å¾®åš/</id>
    <published>2018-11-03T10:56:32.000Z</published>
    <updated>2019-11-20T13:39:41.227Z</updated>
    
    <content type="html"><![CDATA[<p>çœ‹åˆ°ä¸€ç¯‡å¾®åšæ–‡ç« ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚</p><p><img src="/2018/11/03/åˆ†äº«å¾®åš/1.png" alt="å¾®åš"></p><p>ä¸ºä»€ä¹ˆåˆ†äº«è¿™ç¯‡æ–‡ç« å‘¢ï¼Ÿ</p><p>å…¶å®ç°åœ¨ï¼Œæˆ‘å¯¹ç°åœ¨çš„ç¯å¢ƒè¿˜æ˜¯æŠ±æœ‰ä¸€ç‚¹æ‚²è§‚æ€åº¦çš„ã€‚ä»Šå¤©å’Œåå¹´å‰çš„ä»Šå¤©ä¸ä¸€æ ·ï¼Œåå¹´å‰ï¼Œæˆ‘å°å­¦6å¹´çº§ï¼ŒåŒ—äº¬å¥¥è¿ä¼šï¼Œçº¢æ­Œæ´‹æº¢ï¼Œæ¬¢å£°ç¬‘è¯­ï¼Œé‚£æ—¶å€™ï¼Œè°·æ­Œæ²¡æœ‰é€€å‡ºä¸­å›½ï¼ŒFacebookè¿˜èƒ½ç»§ç»­ç™»é™†ï¼ŒGFWæ ¹æœ¬ä¸å­˜åœ¨ã€‚é‚£æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å‘è¾¾ï¼Œä½†æ˜¯æˆ‘ä»¬æ¯å®¶å®‰å±…ä¹ä¸šã€‚</p><p>éšåæ±¶å·å¤§åœ°éœ‡ï¼Œæ²¡ä¸ªä¸­å›½äººä¼—å¿—æˆåŸï¼Œæˆ‘ä»¬æ²¡é’±ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰ç‰©èµ„ã€‚æ¯ä¸ªäººéƒ½ä¼šè‡ªåŠ¨çŒ®å‡ºè‡ªå·±çš„ä¸€ç‰‡å¿ƒæ„ã€‚å¤§è¡—ä¸Šå¤§å®¶ä¼™è‡ªå‘å‘ä¸Šçš„è¸Šè·ƒæŠ¥åå¿—æ„¿è€…ï¼Œå…¨ä¸­å›½äººæ°‘ä¼—å¿—æˆåŸã€‚é‚£æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å‘è¾¾ï¼Œä½†æ˜¯æˆ‘ä»¬è‡ªç”±å›¢ç»“ã€‚</p><p>å†åæ¥ï¼Œé‡‘èå±æœºï¼Œä¸¾ä¸–è§æ¡ï¼Œæˆ‘ä»¬æ‹¥æœ‰ä¼˜è‰¯çš„ç¤¾ä¼šåˆ¶åº¦ï¼Œæˆ‘ä»¬ä¹Ÿé­å—ç€ä¸€ç³»åˆ—çš„æŸå¤±ï¼Œä½†æ˜¯è¿œä¸å¦‚å…¶ä»–å›½å®¶é‚£ä¹ˆå¼ºçƒˆã€‚åœ¨è¿™æœŸé—´ï¼Œæˆ‘ä»¬ä¸å…‰è‡ªæˆ‘æ”¹é©ï¼Œè€Œä¸”è¿˜æ´åŠ©æ•´ä¸ªä¸–ç•Œã€‚é‚£æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å‘è¾¾ï¼Œä½†æ˜¯æˆ‘ä»¬åˆ¶åº¦å…ˆè¿›ã€‚</p><p>ç°åœ¨å‘¢ï¼Ÿ</p><p>æˆ‘é•¿å¤§äº†ï¼Œæˆå¹´äº†ã€‚21å²ï¼Œä¸€ä¸ªå€¼å¾—å¨“å¨“é“æ¥çš„å¹´é¾„ï¼Œä¸€ä¸ªéœ€è¦æ‹…èµ·è´£ä»»çš„å¹´é¾„ï¼Œä¸€ä¸ªåˆå…¥ç¤¾ä¼šçš„å¹´é¾„ã€‚ä¸€ä¸ªç”·äººï¼Œåˆæ˜¯ä¸€ä¸ªå®¶æ—çš„ç‹¬ç”Ÿå­ï¼Œéœ€è¦å…»è€ï¼Œéœ€è¦æ‰¾åª³å¦‡ï¼Œéœ€è¦å®ç°è‡ªæˆ‘è´£ä»»ä¸ä¹‰åŠ¡çš„å¹´é¾„ã€‚</p><p>å¯æ˜¯åœ¨ç°åœ¨çš„ç¯å¢ƒä¸‹ï¼Œæˆ¿ä»·æ¶¨äº†ï¼Œæˆ¿ä»·ï¼ˆé’å²›ï¼‰ä»åå¹´å‰çš„4000ç¿»åˆ°ç°åœ¨çš„30000ï¼›å°±ä¸šå°‘äº†ï¼Œå°±ä¸šç”Ÿ/å½“å±Šåº”å±Šç”Ÿ çš„æ¯”ä¾‹ä¸€å¹´æ¯”ä¸€å¹´å°‘ï¼›ç¨æ”¶é«˜äº†ï¼Œé«˜æ–°äº§ä¸šç¨åŠ¡ä¸¥é‡ï¼Œæ¶ˆè´¹äº§å“ä¸€èˆ¬äººæ¶ˆè´¹ä¸èµ·æ¥ï¼›GFWæ¥äº†ï¼Œä¸–ç•Œä¹Ÿå˜å°äº†ï¼Œç”šè‡³æˆ‘ä»¬ç”Ÿè€Œä¸ºäºº-è¯´è¯çš„æƒåŠ›ï¼Œéƒ½è¢«å‰Šå¼±äº†ã€‚</p><p><strong>å¥½å¤±æœ›</strong>ã€‚</p><p>ä¸å…‰æ˜¯æˆ‘ï¼Œè‚¯å®šä¹Ÿæœ‰å¾ˆå¤šå’Œæˆ‘ä¸€ä¸ªå¹´é¾„çš„äººï¼Œæ‰¿å—ç€å’Œæˆ‘ä¸€æ ·çš„å›°æ‰°ã€‚æ†‹åœ¨å¿ƒé‡Œå¥½éš¾å—å•Šï¼Œæƒ³è¯´ï¼æƒ³è¯´ï¼æƒ³æŠŠå®ƒåƒç—˜ç—˜ä¸€æ ·æŒ¤å‡ºæ¥ï¼Œä¸è¦è®©ä»–å˜å¤§ï¼Œä¸è¦è®©ä»–å˜é»„ã€‚</p><p>å¯æ˜¯ï¼Œå·²ç»å¾ˆå°‘æœ‰äººè¯´è¯äº†ã€‚å…³äºæ”¿æ²»ï¼Œå…³äºä¸­å›½å·¦å€¾ï¼Œå¾ˆå°‘æœ‰äººå‡ºæ¥è¯´è¯äº†ã€‚è¯´äº†ï¼Œå°±æ˜¯ä¸æ‡‚äº‹ï¼›è¯´äº†ï¼Œå°±æ˜¯ä¸å°Šè€ï¼›è¯´äº†ï¼Œå°±æ˜¯ä¸çˆ±å›½ã€‚</p><blockquote><p>è§£å†³é—®é¢˜çš„æœ€å¥½æ–¹æ³•å°±æ˜¯è§£å†³è¯´å‡ºé—®é¢˜çš„äººã€‚ </p></blockquote><p>æˆ‘ä¸æ•¢è¯´ï¼Œæˆ‘æœ‰çˆ¶æ¯ï¼Œæˆ‘æœ‰çˆ±äººï¼Œè¯´è¯çš„ä»£ä»·å¤ªå¤§äº†ï¼Œæˆ‘æ‰¿å—ä¸èµ·ã€‚</p><p>çˆ¶æ¯è®©æˆ‘åšå…¬åŠ¡å‘˜ï¼Œæˆ‘è§‰å¾—å¾ˆä¸é”™ï¼Œå› ä¸ºæˆ‘è§‰å¾—æ€»æœ‰å’Œæˆ‘ä¸€æ ·çš„äººï¼Œçƒ­çˆ±è¿™ç‰‡åœŸåœ°ï¼Œè¿™çˆ±è¿™ä¸ªå›½å®¶ï¼Œå´åˆçœ‹è§è¿™ä¸–ç•ŒçŸ›ç›¾ä¸å…¬å¹³çš„ç°è±¡ã€‚</p><p><strong>ä½†æˆ‘æ”¾å¼ƒäº†ã€‚</strong>ç†ç”±ï¼Œå°±æ˜¯é‚£æ ·ã€‚</p><p>æˆ‘å¾ˆç¬¨ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©å­¦è®¡ç®—æœºï¼Œå®‰å®‰å¿ƒå¿ƒçš„åšä¸€ä¸ªæŠ€æœ¯äººå‘˜ï¼Œå®‰å®‰å¿ƒå¿ƒçš„è·Ÿç€äººæ°‘ç¾¤ä¼—èµ°ï¼Œåšå†³æ‹¥æŠ¤å…šçš„æ­£ç¡®é¢†å¯¼ã€‚åšä¸€ä¸ªä¹Œé¾Ÿï¼Œåšä¸€ä¸ªä¹¦å‘†å­ï¼Œæ…¢æ…¢ç§¯å¾·ï¼Œæ²¡å‡†ï¼Œä¸‹è¾ˆå­æˆ‘å°±ä¼šå¯Œè£•äº†å‘¢ï¼</p><blockquote><p>å½“æˆ‘æ²‰é»˜çš„æ—¶å€™ï¼Œæˆ‘è§‰å¾—å¾ˆå……å®ï¼Œå½“æˆ‘å¼€å£è¯´è¯ï¼Œå°±æ„Ÿåˆ°äº†ç©ºè™šã€‚   â€“é²è¿…</p></blockquote>]]></content>
    
    <summary type="html">
    
      ä¸å½“è¨€è®ºè­¦å‘Šï¼Œæ–‡ç« è®¿é—®éœ€è¦å¯†ç ï¼
    
    </summary>
    
    
      <category term="æ—¥å¸¸" scheme="https://tengshe789.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>ç§‹æ‹›å¤±è´¥äº†ï¼Œè¿˜æ˜¯è¦ç»§ç»­</title>
    <link href="https://tengshe789.github.io/2018/11/03/%E5%8A%A0%E6%B2%B92/"/>
    <id>https://tengshe789.github.io/2018/11/03/åŠ æ²¹2/</id>
    <published>2018-11-03T10:21:58.000Z</published>
    <updated>2019-11-20T13:39:41.236Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æµå—æœ¬åœ°æŠ•äº†å‡ ä»½ç®€å†ï¼Œæ”¶åˆ°äº†äº”å…­ä»½offerï¼Œæ„Ÿè§‰é™¤äº†ä¸€å®¶å°å…¬å¸ä»¥å¤–ä»¥å¤–ï¼Œéƒ½ä¸æ˜¯å¾ˆæ»¡æ„ã€‚å®˜åƒšä½œé£ï¼ŒæŠ€æœ¯å°é—­ï¼Œå¹²æ´»ç´¯ï¼Œä¸å°Šé‡åº”è˜è€…ï¼Œä»€ä¹ˆéƒ½æœ‰ã€‚</p><p><strong>äººç”Ÿå¥½è¿·èŒ«ï¼Œåšäººå¥½ç´¯å•Šã€‚</strong></p><p>ä»Šå¤©å¥³æœ‹å‹é€¼æˆ‘ï¼Œé—®æˆ‘æ„å‘åŸå¸‚ï¼Œå¥¹æ€§å­æ€¥ï¼Œå¥¹æƒ³æ ¹æ®æˆ‘é€‰çš„å·¥ä½œåœ°ç‚¹æ‰¾å·¥ä½œã€‚å¯æ˜¯æˆ‘å¤ªå¼±å°äº†ï¼Œæˆ‘æ‰¾ä¸åˆ°å·¥ä½œï¼Œå¥½çƒ¦ã€‚å¥½æƒ†æ€…ã€‚å¥¹å’Œæˆ‘è¯´æˆ‘ä»¬å¯èƒ½è¦åˆ†æ‰‹äº†ï¼Œå·¥ä½œåœ°ç‚¹ä¸åŒï¼Œä¸¤æ–¹ä¸ä¼šåœ¨ä¸€èµ·çš„ã€‚æˆ‘å¾ˆéš¾å—ï¼Œå¯ç°å®å°±æ˜¯è¿™æ ·ï¼Œèœæ˜¯åŸç½ªï¼Œè€Œæˆ‘æ°å¥½å°±å¾ˆèœã€‚</p><p>å¥¹æ˜¯ä¸ªå¾ˆæ‡’çš„äººï¼Œä¹Ÿæ˜¯ä¸ªç»å¸¸ç„¦è™‘çš„äººã€‚ä»Šå¹´ç§‹æ‹›ï¼Œå¥¹åªå»äº†ä¸€ä¸ªé¢è¯•ï¼Œç»“æœè¿‡äº†ï¼Œå·¥ä½œåœ°ç‚¹åœ¨é’å²›å³å¢¨ï¼Œä¸€ä¸ªä¸æ˜¯å¾ˆå‘è¾¾çš„åœ°æ–¹ï¼Œå’Œæˆ‘è€å®¶åœ¨ä¸€ä¸ªå¸‚ï¼Œä½†æ˜¯è·ç¦»éå¸¸è¿œï¼Œå·¥èµ„4Kï¼Œå¤–è´¸ä¸“å‘˜ã€‚æˆ‘ä¸çœ‹å¥½å¥¹çš„å·¥ä½œï¼Œä¸»è¦æ˜¯åœ°ç‚¹ä¸å¥½ï¼Œä¸æ˜¯å¸‚åŒºï¼Œæˆ‘è®©ä»–æ”¾å¼ƒï¼Œå¯å¥¹ä¸ç”˜å¿ƒï¼Œè¯´æ€ªæˆ‘æ²¡å®šä¸‹æ¥åœ°ç‚¹ï¼Œæˆ‘ä¸é è°±ã€‚æˆ‘ä»¬åµäº†å¾ˆå¤šæ¬¡ï¼Œæ²¡æœ‰ç»“æœã€‚</p><p><strong>è¶…çº§æƒ³è½¬è¡Œ~</strong></p><p>æœ‰æ—¶å€™çœŸçš„è§‰å¾—ï¼Œè®¡ç®—æœºæ–¹é¢æˆ‘æœ‰çˆ±å¥½ï¼Œä½†æ˜¯å´æ²¡æœ‰è¿™ä¸ªèƒ½åŠ›ã€‚</p><p>å¦‚æœæˆ‘åšç®¡ç†ï¼Œç»“æœä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿå¦‚æœæˆ‘åšè¥é”€ï¼Œç»“æœä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿå¦‚æœæˆ‘åšæ•™ä¹¦ï¼Œç»“æœä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘ä¸çŸ¥é“ï¼Œä½†æˆ‘è®¤ä¸ºæˆ‘ä¼šåšçš„å¾ˆå¥½ï¼Œåœ¨æˆ–è€…ï¼Œä¼šéå¸¸ä¸ç”˜å¿ƒå§ã€‚</p><p>ä¸ç®¡å¦‚ä½•ï¼Œè¿˜æ˜¯æ…¢æ…¢çš„æ´»ç€å§ã€‚å°±åƒæˆ‘çˆ¶æ¯æœ€å¼€å§‹çš„æ„¿æœ›ï¼Œè®©æˆ‘å®‰å®‰ç¨³ç¨³çš„æ´»ç€ï¼Œæœ€å¥½è¡£é£Ÿæ— å¿§ï¼Œä¹Ÿä¸è¦åšä¸ªå¯Œäººï¼Œå—äººå«‰å¦’ï¼Œåšä¸ªå°å°çš„å‹¤åŠ³çš„èš‚èšå°±å¥½ã€‚</p><p>è¿™ä¸ªæœˆä¸­æ—¬æˆ‘è¦å»å®ä¹ äº†ï¼Œå»é‚£å®¶ï¼Œä¸€å¼€å§‹ç»™æˆ‘é¢è¯•å¾ˆå’Œè”¼åˆæ„Ÿè§‰å¾ˆæœ‰æ·±åº¦çš„é¢è¯•å®˜æ‰€åœ¨çš„å…¬å¸ã€‚ç”Ÿæ´»è¿˜åœ¨ç»§ç»­ï¼Œ<strong>æˆ‘è¿˜æ˜¯ä¼šæ…¢æ…¢æ´»ç€ï¼Œä½†æ˜¯æˆ‘æ°¸è¿œä¸ä¼šåœæ­¢æˆ‘å¯¹è‡ªå·±çš„è¿½æ±‚ï¼</strong></p><blockquote><p>ä¼˜ç§€çš„äººä¸åœ¨äºé¡ºå¢ƒå¦‚ä½•è¿‡æ´»ï¼Œè€Œæ˜¯åœ¨é€†å¢ƒæ´»å‡ºç²¾å½©ã€‚éš¾ç†¬çš„æ—¥å­æ€»ä¼šå‡ºç°ï¼Œè¿‡å»äº†å°±æ˜¯è¿‡å»ï¼Œæ›´åŠ åšéŸ§ã€‚</p></blockquote><p>é¸¡æ±¤ç‚¹åˆ°ä¸ºæ­¢ï¼Œè¦å¼€å§‹åƒé¥­äº†ï¼Œç§‹æ‹›åªæ˜¯å·¥ä½œç”Ÿæ¶¯çš„å¼€å§‹ï¼Œèµ·è·‘çº¿è½æˆ·çš„äº‹ä¸æ˜¯æ²¡ç»å†è¿‡ï¼Œç°åœ¨å¼€å§‹åŠªåŠ›ï¼Œæœ€å·®ä¸è¿‡ä¸‹ä¸€ç«™æ˜¥æ‹›ï¼Œæ²¡å†æ€•çš„ã€‚</p><p>Nothing to lose,everything will be !  </p>]]></content>
    
    <summary type="html">
    
      è´Ÿé¢æƒ…ç»ªè­¦å‘Šï¼Œæ–‡ç« è®¿é—®å—é™ï¼
    
    </summary>
    
    
      <category term="æ—¥å¸¸" scheme="https://tengshe789.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
      <category term="ç”Ÿæ´»" scheme="https://tengshe789.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
      <category term="åæ§½" scheme="https://tengshe789.github.io/tags/%E5%90%90%E6%A7%BD/"/>
    
  </entry>
  
  <entry>
    <title>æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾</title>
    <link href="https://tengshe789.github.io/2018/11/01/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF%E5%9B%BE/"/>
    <id>https://tengshe789.github.io/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/</id>
    <published>2018-11-01T12:40:11.000Z</published>
    <updated>2019-11-20T13:39:41.407Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ†äº«ä¸€ä¸‹å­¦ä¹ æŠ€æœ¯çš„æ€ç»´è„‘å›¾ï¼Œä¸»è¦æ˜¯<strong>æ¶æ„å¸ˆå›¾è°±ï¼ŒjavaçŸ¥è¯†å›¾è°±ï¼Œå‰ç«¯æŠ€æœ¯å­¦ä¹ å¯¼å›¾ï¼Œå¤§æ•°æ®ä¸äº‘è®¡ç®—æŠ€èƒ½ï¼ŒDevOpsç›¸å…³å›¾è°±</strong>ï¼Œç•™ä½œä¸ªäººå¤‡ä»½ç”¨ã€‚ç´ æå…¨éƒ¨æœé›†äºç½‘ç»œï¼Œä¾µåˆ ï¼</p><h3 id="æ¶æ„å¸ˆå›¾è°±"><a href="#æ¶æ„å¸ˆå›¾è°±" class="headerlink" title="æ¶æ„å¸ˆå›¾è°±"></a>æ¶æ„å¸ˆå›¾è°±</h3><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/1.1 æ¶æ„å¸ˆå›¾è°±.jpg" alt="1.1 æ¶æ„å¸ˆå›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/1.2 Javaæ¶æ„å¸ˆå›¾è°±.jpg" alt="1.2 Javaæ¶æ„å¸ˆå›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/1.3 å¾®æœåŠ¡æ¶æ„ç§˜ç±.jpg" alt="1.3 å¾®æœåŠ¡æ¶æ„ç§˜ç±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/1.4 ä¸€è‡´æ€§å›¾è°±.jpg" alt="1.4 ä¸€è‡´æ€§å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/1.5 äº’è”ç½‘å¤§æµé‡çš„æ–¹æ³•.jpg" alt="1.5 äº’è”ç½‘å¤§æµé‡çš„æ–¹æ³•"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/1.6 å®‰å…¨ç§˜ç±.jpg" alt="1.6 å®‰å…¨ç§˜ç±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/1.7 é˜¿é‡Œå·´å·´å¸¸ç”¨å°æ¡†æ¶.jpg" alt="1.7 é˜¿é‡Œå·´å·´å¸¸ç”¨å°æ¡†æ¶"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/1.8 æ¶æ„æ–¹æ³•è®ºå›¾è°±.jpg" alt="1.8 æ¶æ„æ–¹æ³•è®ºå›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/1.9 è®¾è®¡æ¨¡å¼ç§˜ç±å›¾è°±.jpg" alt="1.9 è®¾è®¡æ¨¡å¼ç§˜ç±å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/å¾®ä¿¡å›¾ç‰‡_20180915145231.jpg" alt="äº‘åŸç”Ÿæ¶æ„å›¾"></p><h3 id="javaçŸ¥è¯†å›¾è°±"><a href="#javaçŸ¥è¯†å›¾è°±" class="headerlink" title="javaçŸ¥è¯†å›¾è°±"></a>javaçŸ¥è¯†å›¾è°±</h3><h4 id="javaæ¡†æ¶å›¾è°±"><a href="#javaæ¡†æ¶å›¾è°±" class="headerlink" title="javaæ¡†æ¶å›¾è°±"></a>javaæ¡†æ¶å›¾è°±</h4><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/2.3 Javaé›†åˆå›¾è°±.jpg" alt="2.3 Javaé›†åˆå›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/2.4 Javaé›†åˆç±»å›¾.jpg" alt="2.4 Javaé›†åˆç±»å›¾"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/2.5 Java Listç±»å›¾.jpg" alt="2.5 Java Listç±»å›¾"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/2.6 Java Mapç±»å›¾.jpg" alt="2.6 Java Mapç±»å›¾"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/2.7 Java Setç±»å›¾.jpg" alt="2.7 Java Setç±»å›¾"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/2.8 Java TCP IP.png" alt="2.8 Java TCP IP"></p><h4 id="Javaå¹¶å‘çŸ¥è¯†å›¾è°±"><a href="#Javaå¹¶å‘çŸ¥è¯†å›¾è°±" class="headerlink" title="Javaå¹¶å‘çŸ¥è¯†å›¾è°±"></a>Javaå¹¶å‘çŸ¥è¯†å›¾è°±</h4><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/Javaå¹¶å‘çŸ¥è¯†å›¾è°±.png" alt="Javaå¹¶å‘çŸ¥è¯†å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/2.2 Javaå¹¶å‘å›¾è°±.jpg" alt="2.2 Javaå¹¶å‘å›¾è°±"></p><h3 id="å‰ç«¯æŠ€æœ¯å­¦ä¹ å¯¼å›¾"><a href="#å‰ç«¯æŠ€æœ¯å­¦ä¹ å¯¼å›¾" class="headerlink" title="å‰ç«¯æŠ€æœ¯å­¦ä¹ å¯¼å›¾"></a>å‰ç«¯æŠ€æœ¯å­¦ä¹ å¯¼å›¾</h3><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/ç°ä»£å‰ç«¯æŠ€æœ¯è§£æ_V2@é«˜æ¸….jpg" alt="å‰ç«¯æŠ€æœ¯å­¦ä¹ å¯¼å›¾"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.3 å‰ç«¯æŠ€èƒ½å›¾è°±.jpg" alt="5.3 å‰ç«¯æŠ€èƒ½å›¾è°±"></p><h3 id="å¤§æ•°æ®ä¸äº‘è®¡ç®—æŠ€èƒ½"><a href="#å¤§æ•°æ®ä¸äº‘è®¡ç®—æŠ€èƒ½" class="headerlink" title="å¤§æ•°æ®ä¸äº‘è®¡ç®—æŠ€èƒ½"></a>å¤§æ•°æ®ä¸äº‘è®¡ç®—æŠ€èƒ½</h3><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/218695c599e9e09aceb41e593bea4397.png" alt="æŸè¯¾å ‚æ•™å­¦å¤§çº²"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/3.1 HadoopæŠ€èƒ½å›¾è°±.jpg" alt="3.1 HadoopæŠ€èƒ½å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/3.2 å¤§æ•°æ®æŠ€èƒ½å›¾è°±.jpg" alt="3.2 å¤§æ•°æ®æŠ€èƒ½å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/4.1 äº‘è®¡ç®—å›¾è°±.jpg" alt="4.1 äº‘è®¡ç®—å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/4.2 äº‘è®¡ç®—æŠ€èƒ½å›¾è°±.jpg" alt="4.2 äº‘è®¡ç®—æŠ€èƒ½å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.2 OpenRestyæŠ€èƒ½å›¾è°±.jpg" alt="5.2 OpenRestyæŠ€èƒ½å›¾è°±"></p><h3 id="iosæŠ€èƒ½"><a href="#iosæŠ€èƒ½" class="headerlink" title="iosæŠ€èƒ½"></a>iosæŠ€èƒ½</h3><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.1 iOSæŠ€èƒ½å›¾è°±.jpg" alt="5.1 iOSæŠ€èƒ½å›¾è°±"></p><h3 id="DevOpsç›¸å…³å›¾è°±"><a href="#DevOpsç›¸å…³å›¾è°±" class="headerlink" title="DevOpsç›¸å…³å›¾è°±"></a>DevOpsç›¸å…³å›¾è°±</h3><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.4 å®¹å™¨æŠ€èƒ½å›¾è°±.jpg" alt="5.4 å®¹å™¨æŠ€èƒ½å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.5 åµŒå…¥å¼å¼€å‘æŠ€èƒ½å›¾è°±.jpg" alt="5.5 åµŒå…¥å¼å¼€å‘æŠ€èƒ½å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.6 å¼€å‘è¯­è¨€å®å…¸.jpg" alt="5.6 å¼€å‘è¯­è¨€å®å…¸"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.7 ç§»åŠ¨ç«¯æµ‹è¯•å›¾è°±.jpg" alt="5.7 ç§»åŠ¨ç«¯æµ‹è¯•å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.8 è¿ç»´æŠ€èƒ½å›¾è°±.jpg" alt="5.8 è¿ç»´æŠ€èƒ½å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.9 è½¯ä»¶å·¥ç¨‹å›¾è°±.jpeg" alt="5.9 è½¯ä»¶å·¥ç¨‹å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.10 DevOpså›¾è°±.jpg" alt="5.10 DevOpså›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.11 å‰ç«¯å¼€å‘å›¾è°±.jpg" alt="5.11 å‰ç«¯å¼€å‘å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.12 åç«¯å¼€å‘å›¾è°±.jpg" alt="5.12 åç«¯å¼€å‘å›¾è°±"></p><p><img src="/2018/11/01/æŠ€æœ¯å­¦ä¹ è·¯çº¿å›¾/5.13 è½¯ä»¶å‘å¸ƒæµç¨‹.jpeg" alt="5.13 è½¯ä»¶å‘å¸ƒæµç¨‹"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åˆ†äº«ä¸€ä¸‹å­¦ä¹ æŠ€æœ¯çš„æ€ç»´è„‘å›¾ï¼Œä¸»è¦æ˜¯&lt;strong&gt;æ¶æ„å¸ˆå›¾è°±ï¼ŒjavaçŸ¥è¯†å›¾è°±ï¼Œå‰ç«¯æŠ€æœ¯å­¦ä¹ å¯¼å›¾ï¼Œå¤§æ•°æ®ä¸äº‘è®¡ç®—æŠ€èƒ½ï¼ŒDevOpsç›¸å…³å›¾è°±&lt;/strong&gt;ï¼Œç•™ä½œä¸ªäººå¤‡ä»½ç”¨ã€‚ç´ æå…¨éƒ¨æœé›†äºç½‘ç»œï¼Œä¾µåˆ ï¼&lt;/p&gt;
&lt;h3 id=&quot;æ¶æ„å¸ˆå›¾è°±&quot;&gt;&lt;a href=&quot;#æ¶æ„å¸ˆå›¾è°±&quot; 
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="åˆ†äº«" scheme="https://tengshe789.github.io/tags/%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>æœªæ¥ã®ç›®æ¨™</title>
    <link href="https://tengshe789.github.io/2018/10/27/%E6%9C%AA%E6%9D%A5%E3%81%AE%E7%9B%AE%E6%A8%99/"/>
    <id>https://tengshe789.github.io/2018/10/27/æœªæ¥ã®ç›®æ¨™/</id>
    <published>2018-10-27T09:20:25.000Z</published>
    <updated>2019-11-20T13:39:41.543Z</updated>
    
    <content type="html"><![CDATA[<p>å¾ˆå¤šæ—¶å€™ï¼Œç”Ÿæ´»å¹¶ä¸å¦‚æ„ï¼›å¾ˆå¤šæ—¶å€™ï¼Œç†æƒ³å¹¶ä¸èƒ½å®ç°ï¼›è·¯å¾ˆé•¿ï¼Œèº«ä½“å¾ˆç´¯ï¼Œå¯è¿˜æ˜¯ä¸€ç›´è¦èµ°ä¸‹å»ã€‚</p><hr><h3 id="å§‹"><a href="#å§‹" class="headerlink" title="å§‹"></a>å§‹</h3><p>æˆ‘æ˜¯ä¸€ä¸ªä¸€ä¸ªæ™®æ™®é€šé€šçš„åŒéå­¦æ ¡çš„å¤§å­¦ç”Ÿï¼Œæ¥è‡ªå±±ä¸œçš„äºŒåçº¿å°åŸå¸‚ï¼Œå®¶å¢ƒä¸€èˆ¬ï¼Œç”Ÿæ´»å¾ˆå®‰é€¸ã€‚å¯èƒ½å°æ—¶å€™å—åˆ°çš„ç†é™¶æ¯”è¾ƒå¤šå§ï¼Œå®¶é‡Œäººæ¯”è¾ƒæŠ¤çŠŠï¼Œæ¥è§¦çš„äº‹æƒ…ä¹Ÿå¾ˆå°‘ã€‚å¹³æ—¶æ²¡å•¥ä¹ æƒ¯ï¼Œæœ€å¤§çš„çˆ±å¥½æ˜¯æ£é¼“è®¡ç®—æœºã€‚</p><p>å¦ˆå¦ˆçš„çœ¼ç•Œå¾ˆå¹¿ï¼Œæˆ‘å°æ—¶å€™ä¸‰å¹´çº§ï¼Œå¦ˆå¦ˆæ•™äº†flashåŠ¨ç”»ï¼Œåˆä¸­å‚»äº†å§å”§çš„çš„ç©å›½å¤–æ¸¸æˆï¼Œå› æ­¤è‹±è¯­è¿˜ç®—å¯ä»¥ï¼Œé«˜ä¸­è‡ªå·±å­¦diyç”µè„‘ï¼Œææœºå™¨ã€‚</p><p>ä¸€æ­¥ä¸€æ­¥çš„æˆé•¿ï¼Œåˆ°äº†å¿«ä¸Šå¤§å­¦çš„å¹´çºªï¼Œè‡ªå·±å•¥ä¹Ÿä¸çŸ¥é“ï¼Œåªé ç€çˆ¶æ¯ã€‚çˆ¶æ¯å¾ˆçˆ±æˆ‘ï¼Œç»™æˆ‘é€‰äº†ä¸€ä¸ªç½‘ç»œå·¥ç¨‹ä¸“ä¸šã€‚è¿›äº†å¤§å­¦ï¼Œä»€ä¹ˆéƒ½å˜äº†ï¼Œäººå˜äº†ï¼Œæ¥¼å˜äº†ï¼Œä¸–ç•Œå˜äº†ã€‚è¿™é‡Œçš„äººæ¸©æ–‡å°”é›…ï¼Œè¿™é‡Œçš„äººè¡£ç€æ•´é½ï¼Œæˆ‘åŠ¨å¿ƒäº†ï¼Œç”Ÿæ´»åœ¨è¿™é‡Œå¥½å¹¸ç¦ã€‚</p><p>æˆ‘åœ¨æ…¢æ…¢æ‡‚äº‹ã€‚</p><p>ç¬¬ä¸€å¹´ï¼Œæˆ‘å»äº†å­¦ç”Ÿä¼šï¼Œæˆ‘å»äº†ä¸€å®¶ä¸–ç•Œ500å¼ºå®ä¹ ï¼ŒåŒæ—¶è¿˜æ‰¾äº†ä¸€ä»½ä¿®ç”µè„‘çš„å…¼èŒï¼Œåˆå¯¹ä¸€ä¸ªå¥³å­©äº§ç”Ÿäº†å¥½æ„Ÿã€‚</p><p>ç¬¬äºŒå¹´ï¼Œæ…¢æ…¢çš„æ‘¸ç´¢ï¼Œæˆ‘ç»§ç»­æˆ‘çš„è€è·¯ã€‚æˆ‘è®¤ä¸ºæˆ‘è‡ªå·±åšçš„å†³å®šï¼Œå¾ˆå®Œå–„ï¼Œå¾ˆå¥½ï¼Œæˆ‘æ²‰æµ¸åœ¨å…¶ä¸­ã€‚</p><p>ç¬¬ä¸‰å¹´ï¼Œæ‹çˆ±ä½™æ¸©é™ä¸‹æ¥äº†ï¼Œç°å®ä¹Ÿæ¥äº†ã€‚é’æ˜¥æœŸçš„çƒ¦æ¼æ¥è¸µè€Œè‡³ï¼Œâ€œæˆ‘åœ¨å“ªï¼Ÿæˆ‘ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿâ€ï¼Œæˆ‘æ€»æ˜¯åœ¨è‡ªå·±æ¢ç´¢ï¼Œæˆ‘æ€»æ˜¯æ¯”åˆ«äººæ™šå‘è‚²å¾ˆå¤šã€‚</p><p>æœ‰è¿™æ ·ä¸€ä¸ªæ•…äº‹ï¼Œä¸€åè®°è€…çœ‹è§å†œæ‘çš„ä¸€ä¸ªæ­£åœ¨æ”¾ç¾Šçš„å°å­©ï¼Œé—®ä»–â€œä½ çš„ç†æƒ³æ˜¯ä»€ä¹ˆï¼Ÿâ€<br>å°å­©å›ç­”è¯´ï¼šâ€œæ”¾ç¾Šï¼â€<br>â€œç¾Šå„¿å–‚å¤§äº†å¹²ä»€ä¹ˆï¼Ÿâ€<br>â€œå–é’±ï¼â€<br>â€œæœ‰äº†å–ç¾Šå„¿çš„é’±å¹²ä»€ä¹ˆï¼Ÿâ€<br>â€œå¨¶è€å©†ï¼â€<br>â€œå¨¶è€å©†å¹²ä»€ä¹ˆï¼Ÿâ€<br>â€œç”Ÿå°å­©ï¼â€<br>â€œç”Ÿå°å­©æ¥å¹²ä»€ä¹ˆï¼Ÿâ€<br>â€œæ”¾ç¾Šï¼â€<br>â€¦â€¦</p><p>æ”¾ç¾Šçš„å°å­©å¯¹ä¸–ç•Œçš„ç†è§£ä¹Ÿå°±æ˜¯ï¼šæ”¾ç¾ŠæŒ£é’±å¨¶è€å©†ç”Ÿå°å­©å†æ”¾ç¾Šã€‚å¯¹å¤–é¢ä¸–ç•Œçš„äº†è§£å¯èƒ½è¶‹å‘äºäº†é›¶ï¼Œåœ¨ä»–çš„ä¸–ç•Œé‡Œï¼Œè¿™å°±æ˜¯ç¾å¥½çš„ä¸€åˆ‡ï¼Œå¹¸ç¦çš„ç”Ÿæ´»ã€‚å¯¹ä¸–ç•Œè®¤è¯†çš„å±€é™æ€§ä¼šå¯¼è‡´æ€ç»´çš„å±€é™æ€§ï¼Œæ€ç»´çš„å±€é™æ€§ä¼šå¯¼è‡´ç›®æ ‡çš„å±€é™æ€§ï¼Œç›®æ ‡çš„å±€é™æ€§æœ€ç»ˆå¯¼è‡´è¡Œä¸ºçš„å±€é™æ€§ï¼Œä»è€Œå½±å“äººç”Ÿä¸­çš„å„ç§é€‰æ‹©ã€‚</p><p>æˆ‘ï¼Œä¼šæ”¾ç¾Šï¼Œä½†æ˜¯æˆ‘ä¸æƒ³ä¸€ç›´æ”¾ç¾Šã€‚æˆ‘éœ€è¦åŠªåŠ›ï¼Œæˆ‘éœ€è¦ä¸Šè¿›ï¼Œæˆ‘æƒ³èµšé’±ï¼Œæˆ‘æƒ³ç»™æˆ‘çˆ±çš„äººæœ€å¥½çš„ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘æƒ³åšç¨‹åºå‘˜ã€‚</p><h3 id="èµ°"><a href="#èµ°" class="headerlink" title="èµ°"></a>èµ°</h3><p>æˆ‘åšè¿‡å¾ˆå¤šäº‹æƒ…ï¼Œå¾ˆå¤šæ²¡æœ‰ç›®æ ‡ã€‚å¯åšç¨‹åºå‘˜ï¼Œæ²¡æœ‰ç›®æ ‡æ˜¯ä¸è¡Œçš„ã€‚ç°åœ¨æ˜¯2018å¹´äº†ï¼Œæˆ‘é¢ä¸´ç€éå¸¸å·¨å¤§çš„ç«äº‰å‹åŠ›ã€‚è¿™ä¸€å¹´ï¼Œæ­£å¥½èµ¶ä¸Šäº†90åçš„æœ«ç­æ½®ï¼Œå…¨å›½å­¦æ ¡éƒ½å·²ç»æ‰©å®¹å®Œæ¯•ï¼Œæ•°ä¸èƒœæ•°çš„ï¼Œæ¯”æˆ‘ä¼˜ç§€çš„211ï¼Œ985å¤§å­¦ç”Ÿç ”ç©¶ç”Ÿï¼Œç–¯ç‹‚çš„æŒ¤å…¥äººæ‰å¸‚åœºã€‚å¯æ˜¯ï¼Œä»Šå¹´çš„äººæ‰ä¾›æ±‚å´è¿œä¸å¦‚å»å¹´å‰å¹´ã€‚æˆ‘ï¼Œè§‰å¾—æˆ‘å¤±ä¸šäº†ã€‚</p><p>æˆ‘ä¸ç”˜å¿ƒï¼Œæˆ‘æŠ•äº†å¾ˆå¤šå¾ˆå¤šé¢è¯•ï¼Œæœ‰çš„é•¿è¾ˆå¯¹æˆ‘å¤§å¼å¤§å«ï¼Œè¯´æˆ‘è¿™æ ·æ˜¯ä¸å¯èƒ½æ‰¾åˆ°å·¥ä½œçš„ï¼Œæœ‰çš„é•¿è¾ˆè¿çœ‹éƒ½ä¸çœ‹ï¼Œåªæ˜¯å†·æ¼ çš„è¯´å£°â€œä½ èµ°å§â€ã€‚</p><p>æœ›å°½ä¸–ä¿—å¸¸æ€ï¼Œå”¯æœ‰æå‡è‡ªå·±æ‰æ˜¯æ ¹æœ¬ã€‚</p><p>æ‰€ä»¥æˆ‘æƒ³åŠªåŠ›ï¼Œæˆ‘æƒ³æˆä¸ºæˆ‘è‡ªå·±ã€‚</p><h3 id="å­¦ä¹ ç›®æ ‡"><a href="#å­¦ä¹ ç›®æ ‡" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h3><p>åœ¨è¿™é‡Œæˆ‘å®šä¸‹ç›®æ ‡ï¼Œä¸‰å¹´å†…ï¼Œéœ€è¦å­¦ä¼šæˆ–è€…ç²¾é€šä»¥ä¸‹çŸ¥è¯†ï¼š</p><ul><li style="list-style: none"><input type="checkbox" checked> æ•°æ®ç»“æ„<ul><li style="list-style: none"><input type="checkbox" checked> é˜Ÿåˆ—</li><li style="list-style: none"><input type="checkbox" checked> é›†åˆ</li><li style="list-style: none"><input type="checkbox" checked> é“¾è¡¨ã€æ•°ç»„</li><li style="list-style: none"><input type="checkbox" checked> å­—å…¸ã€å…³è”æ•°ç»„</li><li style="list-style: none"><input type="checkbox" checked> æ ˆ</li><li style="list-style: none"><input type="checkbox" checked> æ ‘<ul><li style="list-style: none"><input type="checkbox" checked> äºŒå‰æ ‘</li><li style="list-style: none"><input type="checkbox" checked> å®Œå…¨äºŒå‰æ ‘</li><li style="list-style: none"><input type="checkbox" checked> å¹³è¡¡äºŒå‰æ ‘</li><li style="list-style: none"><input type="checkbox" checked> äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBSTï¼‰</li><li style="list-style: none"><input type="checkbox" checked> Bï¼ŒB+ï¼ŒB - [x]æ ‘</li><li style="list-style: none"><input type="checkbox" checked> çº¢é»‘æ ‘</li><li style="list-style: none"><input type="checkbox" checked> LSM æ ‘</li></ul></li><li style="list-style: none"><input type="checkbox" checked> å¸¸ç”¨ç®—æ³•<ul><li style="list-style: none"><input type="checkbox" checked> æ’åºã€æŸ¥æ‰¾ç®—æ³•<ul><li style="list-style: none"><input type="checkbox" checked> é€‰æ‹©æ’åº</li><li style="list-style: none"><input type="checkbox" checked> å†’æ³¡æ’åº</li><li style="list-style: none"><input type="checkbox" checked> æ’å…¥æ’åº</li><li style="list-style: none"><input type="checkbox" checked> å¿«é€Ÿæ’åº</li><li style="list-style: none"><input type="checkbox" checked> å½’å¹¶æ’åº</li><li style="list-style: none"><input type="checkbox" checked> æ¡¶æ’åº</li><li style="list-style: none"><input type="checkbox" checked> è®¡æ•°æ’åº</li><li style="list-style: none"><input type="checkbox" checked> å¸Œå°”æ’åº</li><li style="list-style: none"><input type="checkbox" checked> åŸºæ•°æ’åº</li><li style="list-style: none"><input type="checkbox" checked> è®¡æ•°æ’åº</li><li style="list-style: none"><input type="checkbox" checked> äºŒåˆ†æŸ¥æ‰¾</li><li style="list-style: none"><input type="checkbox" checked> å½’å¹¶æ’åº</li><li style="list-style: none"><input type="checkbox" checked> Java ä¸­çš„æ’åºæ•°æ®ç»“æ„ï¼ˆarraylistï¼‰</li></ul></li><li style="list-style: none"><input type="checkbox" checked> å¸ƒéš†è¿‡æ»¤å™¨</li><li style="list-style: none"><input type="checkbox" checked> å­—ç¬¦ä¸²æ¯”è¾ƒ<ul><li style="list-style: none"><input type="checkbox" checked> KMP ç®—æ³•</li></ul></li><li style="list-style: none"><input type="checkbox" checked> æ·±åº¦ä¼˜å…ˆã€å¹¿åº¦ä¼˜å…ˆ</li><li style="list-style: none"><input type="checkbox" checked> è´ªå¿ƒç®—æ³•</li><li style="list-style: none"><input type="checkbox" checked> å›æº¯ç®—æ³•</li><li style="list-style: none"><input type="checkbox" checked> å‰ªæç®—æ³•</li><li style="list-style: none"><input type="checkbox" checked> åŠ¨æ€è§„åˆ’</li><li style="list-style: none"><input type="checkbox" checked> æœ´ç´ è´å¶æ–¯</li><li style="list-style: none"><input type="checkbox" checked> æœ€å°ç”Ÿæˆæ ‘ç®—æ³•</li><li style="list-style: none"><input type="checkbox" checked> æœ€çŸ­è·¯å¾„ç®—æ³•</li></ul></li><li style="list-style: none"><input type="checkbox" checked> å¹¶å‘ç¼–ç¨‹<ul><li style="list-style: none"><input type="checkbox" checked> Java å¹¶å‘</li><li style="list-style: none"><input type="checkbox" checked> å¤šçº¿ç¨‹</li><li style="list-style: none"><input type="checkbox" checked> çº¿ç¨‹å®‰å…¨</li><li style="list-style: none"><input type="checkbox" checked> ä¸€è‡´æ€§ã€äº‹åŠ¡<ul><li style="list-style: none"><input type="checkbox" checked> ACID</li><li style="list-style: none"><input type="checkbox" checked> äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</li><li style="list-style: none"><input type="checkbox" checked> MVCC</li></ul></li><li style="list-style: none"><input type="checkbox" checked> é”<ul><li style="list-style: none"><input type="checkbox" checked> Javaä¸­çš„é”å’ŒåŒæ­¥ç±»</li><li style="list-style: none"><input type="checkbox" checked> å…¬å¹³é” &amp; éå…¬å¹³é”</li><li style="list-style: none"><input type="checkbox" checked> æ‚²è§‚é”</li><li style="list-style: none"><input type="checkbox" checked> ä¹è§‚é” &amp; CAS</li><li style="list-style: none"><input type="checkbox" checked> ABA é—®é¢˜</li><li style="list-style: none"><input type="checkbox" checked> CopyOnWriteå®¹å™¨</li><li style="list-style: none"><input type="checkbox" checked> RingBuffer</li><li style="list-style: none"><input type="checkbox" checked> å¯é‡å…¥é” &amp; ä¸å¯é‡å…¥é”</li><li style="list-style: none"><input type="checkbox" checked> äº’æ–¥é” &amp; å…±äº«é”</li><li style="list-style: none"><input type="checkbox" checked> æ­»é”</li></ul></li></ul></li><li style="list-style: none"><input type="checkbox" checked> æ“ä½œç³»ç»Ÿ<ul><li style="list-style: none"><input type="checkbox" checked> è®¡ç®—æœºåŸç†</li><li style="list-style: none"><input type="checkbox" checked> CPU</li><li style="list-style: none"><input type="checkbox" checked> å†…å­˜</li><li style="list-style: none"><input type="checkbox" checked> è¿›ç¨‹çº¿ç¨‹åç¨‹</li><li style="list-style: none"><input type="checkbox" checked> Linux</li></ul></li><li style="list-style: none"><input type="checkbox" checked> è®¾è®¡æ¨¡å¼<ul><li style="list-style: none"><input type="checkbox" checked> 23ç§å¸¸è§è®¾è®¡æ¨¡å¼</li><li style="list-style: none"><input type="checkbox" checked> MVC</li><li style="list-style: none"><input type="checkbox" checked> IOC</li><li style="list-style: none"><input type="checkbox" checked> AOP</li><li style="list-style: none"><input type="checkbox" checked> è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™</li><li style="list-style: none"><input type="checkbox" checked> å¾®æœåŠ¡æ€æƒ³<ul><li style="list-style: none"><input type="checkbox" checked> åº·å¨å®šå¾‹</li></ul></li></ul></li><li style="list-style: none"><input type="checkbox" checked> è¿ç»´<ul><li style="list-style: none"><input type="checkbox" checked> å¸¸è§„ç›‘æ§</li><li style="list-style: none"><input type="checkbox" checked> APM</li><li style="list-style: none"><input type="checkbox" checked> ç»Ÿè®¡åˆ†æ</li><li style="list-style: none"><input type="checkbox" checked> æŒç»­é›†æˆ(CI/CD)<ul><li style="list-style: none"><input type="checkbox" checked> ç¯å¢ƒåˆ†ç¦»</li><li style="list-style: none"><input type="checkbox" checked> Jenkins</li></ul></li><li style="list-style: none"><input type="checkbox" checked> è‡ªåŠ¨åŒ–è¿ç»´</li></ul></li><li style="list-style: none"><input type="checkbox" checked> è¿ç»´ ; ç»Ÿè®¡ ; æŠ€æœ¯æ”¯æŒ<ul><li style="list-style: none"><input type="checkbox" checked> Jenkins</li><li style="list-style: none"><input type="checkbox" checked> ç¯å¢ƒåˆ†ç¦»<ul><li style="list-style: none"><input type="checkbox" checked> è‡ªåŠ¨åŒ–è¿ç»´</li></ul></li><li style="list-style: none"><input type="checkbox" checked> Ansible</li><li style="list-style: none"><input type="checkbox" checked> puppet</li><li style="list-style: none"><input type="checkbox" checked> chef<ul><li style="list-style: none"><input type="checkbox" checked> æµ‹è¯•</li></ul></li><li style="list-style: none"><input type="checkbox" checked> TDD ç†è®º</li><li style="list-style: none"><input type="checkbox" checked> å•å…ƒæµ‹è¯•</li><li style="list-style: none"><input type="checkbox" checked> å‹åŠ›æµ‹è¯•</li><li style="list-style: none"><input type="checkbox" checked> å…¨é“¾è·¯å‹æµ‹</li><li style="list-style: none"><input type="checkbox" checked> A/B ã€ç°åº¦ã€è“ç»¿æµ‹è¯•<ul><li style="list-style: none"><input type="checkbox" checked> è™šæ‹ŸåŒ–</li></ul></li><li style="list-style: none"><input type="checkbox" checked> KVM</li><li style="list-style: none"><input type="checkbox" checked> Xen</li><li style="list-style: none"><input type="checkbox" checked> OpenVZ<ul><li style="list-style: none"><input type="checkbox" checked> å®¹å™¨æŠ€æœ¯</li></ul></li><li style="list-style: none"><input type="checkbox" checked> Docker<ul><li style="list-style: none"><input type="checkbox" checked> äº‘æŠ€æœ¯</li></ul></li><li style="list-style: none"><input type="checkbox" checked> OpenStack<ul><li style="list-style: none"><input type="checkbox" checked> DevOps</li><li style="list-style: none"><input type="checkbox" checked> æ–‡æ¡£ç®¡ç†</li></ul></li></ul></li><li style="list-style: none"><input type="checkbox" checked> ä¸­é—´ä»¶<ul><li style="list-style: none"><input type="checkbox" checked> Web Server<ul><li style="list-style: none"><input type="checkbox" checked> Nginx</li><li style="list-style: none"><input type="checkbox" checked> OpenResty</li><li style="list-style: none"><input type="checkbox" checked> Tengine</li><li style="list-style: none"><input type="checkbox" checked> <a href="apache-httpd">Apache Httpd</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="tomcat">Tomcat</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æ¶æ„åŸç†">æ¶æ„åŸç†</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="è°ƒä¼˜æ–¹æ¡ˆ">è°ƒä¼˜æ–¹æ¡ˆ</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="jetty">Jetty</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="ç¼“å­˜">ç¼“å­˜</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æœ¬åœ°ç¼“å­˜">æœ¬åœ°ç¼“å­˜</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="å®¢æˆ·ç«¯ç¼“å­˜">å®¢æˆ·ç«¯ç¼“å­˜</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æœåŠ¡ç«¯ç¼“å­˜">æœåŠ¡ç«¯ç¼“å­˜</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="webç¼“å­˜">Webç¼“å­˜</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="memcached">Memcached</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="redis">Redis</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æ¶æ„">æ¶æ„</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="å›æ”¶ç­–ç•¥">å›æ”¶ç­–ç•¥</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="tair">Tair</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ¶ˆæ¯é˜Ÿåˆ—">æ¶ˆæ¯é˜Ÿåˆ—</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æ¶ˆæ¯æ€»çº¿">æ¶ˆæ¯æ€»çº¿</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ¶ˆæ¯çš„é¡ºåº">æ¶ˆæ¯çš„é¡ºåº</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="rabbitmq">RabbitMQ</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="rocketmq">RocketMQ</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="activemq">ActiveMQ</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="kafka">Kafka</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="redis-æ¶ˆæ¯æ¨é€">Redis æ¶ˆæ¯æ¨é€</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="zeromq">ZeroMQ</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="å®šæ—¶è°ƒåº¦">å®šæ—¶è°ƒåº¦</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="å•æœºå®šæ—¶è°ƒåº¦">å•æœºå®šæ—¶è°ƒåº¦</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åˆ†å¸ƒå¼å®šæ—¶è°ƒåº¦">åˆ†å¸ƒå¼å®šæ—¶è°ƒåº¦</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="rpc">RPC</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="dubbo">Dubbo</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="thrift">Thrift</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="grpc">gRPC</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ•°æ®åº“ä¸­é—´ä»¶">æ•°æ®åº“ä¸­é—´ä»¶</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="sharding-jdbc">Sharding Jdbc</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ—¥å¿—ç³»ç»Ÿ">æ—¥å¿—ç³»ç»Ÿ</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æ—¥å¿—æœé›†">æ—¥å¿—æœé›†</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="é…ç½®ä¸­å¿ƒ">é…ç½®ä¸­å¿ƒ</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="api-ç½‘å…³">API ç½‘å…³</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="ç½‘ç»œ">ç½‘ç»œ</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="åè®®">åè®®</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="osi-ä¸ƒå±‚åè®®">OSI ä¸ƒå±‚åè®®</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="tcpip">TCP/IP</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="http">HTTP</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="http20">HTTP2.0</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="https">HTTPS</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="ç½‘ç»œæ¨¡å‹">ç½‘ç»œæ¨¡å‹</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="epoll">Epoll</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="java-nio">Java NIO</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="kqueue">kqueue</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="è¿æ¥å’ŒçŸ­è¿æ¥">è¿æ¥å’ŒçŸ­è¿æ¥</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ¡†æ¶">æ¡†æ¶</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="é›¶æ‹·è´zero-copy">é›¶æ‹·è´ï¼ˆZero-copyï¼‰</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åºåˆ—åŒ–äºŒè¿›åˆ¶åè®®">åºåˆ—åŒ–(äºŒè¿›åˆ¶åè®®)</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="hessian">Hessian</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="protobuf">Protobuf</a></li></ul></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ•°æ®åº“">æ•°æ®åº“</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="åŸºç¡€ç†è®º">åŸºç¡€ç†è®º</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æ•°æ®åº“è®¾è®¡çš„ä¸‰å¤§èŒƒå¼">æ•°æ®åº“è®¾è®¡çš„ä¸‰å¤§èŒƒå¼</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="mysql">MySQL</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="åŸç†">åŸç†</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="innodb">InnoDB</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="ä¼˜åŒ–">ä¼˜åŒ–</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="ç´¢å¼•">ç´¢å¼•</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="èšé›†ç´¢å¼•-éèšé›†ç´¢å¼•">èšé›†ç´¢å¼•, éèšé›†ç´¢å¼•</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="å¤åˆç´¢å¼•">å¤åˆç´¢å¼•</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ahi">è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•(AHI)</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="explain">explain</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="nosql">NoSQL</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="mongodb">MongoDB</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="hbase">Hbase</a></li></ul></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="æœç´¢å¼•æ“">æœç´¢å¼•æ“</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æœç´¢å¼•æ“åŸç†">æœç´¢å¼•æ“åŸç†</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="lucene">Lucene</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="elasticsearch">Elasticsearch</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="solr">Solr</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="sphinx">sphinx</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ€§èƒ½">æ€§èƒ½</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æ€§èƒ½ä¼˜åŒ–æ–¹æ³•è®º">æ€§èƒ½ä¼˜åŒ–æ–¹æ³•è®º</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="å®¹é‡è¯„ä¼°">å®¹é‡è¯„ä¼°</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="cdn-ç½‘ç»œ">CDN ç½‘ç»œ</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="è¿æ¥æ± ">è¿æ¥æ± </a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ€§èƒ½è°ƒä¼˜">æ€§èƒ½è°ƒä¼˜</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="å¤§æ•°æ®">å¤§æ•°æ®</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æµå¼è®¡ç®—">æµå¼è®¡ç®—</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="storm">Storm</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="flink">Flink</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="kafka-stream">Kafka Stream</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åº”ç”¨åœºæ™¯-1">åº”ç”¨åœºæ™¯</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="hadoop">Hadoop</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="hdfs">HDFS</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="mapreduce">MapReduce</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="yarn">Yarn</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="spark">Spark</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="å®‰å…¨">å®‰å…¨</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="web-å®‰å…¨">web å®‰å…¨</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="xss">XSS</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="csrf">CSRF</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="sql-æ³¨å…¥">SQL æ³¨å…¥</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="hash-dos">Hash Dos</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="è„šæœ¬æ³¨å…¥">è„šæœ¬æ³¨å…¥</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ¼æ´æ‰«æå·¥å…·">æ¼æ´æ‰«æå·¥å…·</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="éªŒè¯ç ">éªŒè¯ç </a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="ddos-é˜²èŒƒ">DDoS é˜²èŒƒ</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="ç”¨æˆ·éšç§ä¿¡æ¯ä¿æŠ¤">ç”¨æˆ·éšç§ä¿¡æ¯ä¿æŠ¤</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åºåˆ—åŒ–æ¼æ´">åºåˆ—åŒ–æ¼æ´</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åŠ å¯†è§£å¯†">åŠ å¯†è§£å¯†</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="å¯¹ç§°åŠ å¯†">å¯¹ç§°åŠ å¯†</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="å“ˆå¸Œç®—æ³•">å“ˆå¸Œç®—æ³•</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="éå¯¹ç§°åŠ å¯†">éå¯¹ç§°åŠ å¯†</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="æœåŠ¡å™¨å®‰å…¨">æœåŠ¡å™¨å®‰å…¨</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ•°æ®å®‰å…¨">æ•°æ®å®‰å…¨</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æ•°æ®å¤‡ä»½">æ•°æ®å¤‡ä»½</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="ç½‘ç»œéš”ç¦»">ç½‘ç»œéš”ç¦»</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="å†…å¤–ç½‘åˆ†ç¦»">å†…å¤–ç½‘åˆ†ç¦»</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="ç™»å½•è·³æ¿æœº">ç™»å½•è·³æ¿æœº</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="æˆæƒè®¤è¯">æˆæƒã€è®¤è¯</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="rbac">RBAC</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="oauth20">OAuth2.0</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åŒå› ç´ è®¤è¯2fa">åŒå› ç´ è®¤è¯ï¼ˆ2FAï¼‰</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="å•ç‚¹ç™»å½•sso">å•ç‚¹ç™»å½•(SSO)</a></li></ul></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="å¸¸ç”¨å¼€æºæ¡†æ¶">å¸¸ç”¨å¼€æºæ¡†æ¶</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="å¼€æºåè®®">å¼€æºåè®®</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ—¥å¿—æ¡†æ¶">æ—¥å¿—æ¡†æ¶</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="log4jlog4j2">Log4jã€Log4j2</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="logback">Logback</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="orm">ORM</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="ç½‘ç»œæ¡†æ¶">ç½‘ç»œæ¡†æ¶</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="web-æ¡†æ¶">Web æ¡†æ¶</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="spring-å®¶æ—">Spring å®¶æ—</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="å·¥å…·æ¡†æ¶">å·¥å…·æ¡†æ¶</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="åˆ†å¸ƒå¼è®¾è®¡">åˆ†å¸ƒå¼è®¾è®¡</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æ‰©å±•æ€§è®¾è®¡">æ‰©å±•æ€§è®¾è®¡</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="ç¨³å®šæ€§--é«˜å¯ç”¨">ç¨³å®šæ€§ &amp; é«˜å¯ç”¨</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="ç¡¬ä»¶è´Ÿè½½å‡è¡¡">ç¡¬ä»¶è´Ÿè½½å‡è¡¡</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="è½¯ä»¶è´Ÿè½½å‡è¡¡">è½¯ä»¶è´Ÿè½½å‡è¡¡</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="é™æµ">é™æµ</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åº”ç”¨å±‚å®¹ç¾">åº”ç”¨å±‚å®¹ç¾</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="è·¨æœºæˆ¿å®¹ç¾">è·¨æœºæˆ¿å®¹ç¾</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="å®¹ç¾æ¼”ç»ƒæµç¨‹">å®¹ç¾æ¼”ç»ƒæµç¨‹</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="å¹³æ»‘å¯åŠ¨">å¹³æ»‘å¯åŠ¨</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ•°æ®åº“æ‰©å±•">æ•°æ®åº“æ‰©å±•</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="è¯»å†™åˆ†ç¦»æ¨¡å¼">è¯»å†™åˆ†ç¦»æ¨¡å¼</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åˆ†ç‰‡æ¨¡å¼">åˆ†ç‰‡æ¨¡å¼</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="æœåŠ¡æ²»ç†">æœåŠ¡æ²»ç†</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æœåŠ¡æ³¨å†Œä¸å‘ç°">æœåŠ¡æ³¨å†Œä¸å‘ç°</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æœåŠ¡è·¯ç”±æ§åˆ¶">æœåŠ¡è·¯ç”±æ§åˆ¶</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="åˆ†å¸ƒå¼ä¸€è‡´">åˆ†å¸ƒå¼ä¸€è‡´</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="cap-ä¸-base-ç†è®º">CAP ä¸ BASE ç†è®º</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åˆ†å¸ƒå¼é”">åˆ†å¸ƒå¼é”</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•">åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="paxos">PAXOS</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="zab">Zab</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="raft">Raft</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="gossip">Gossip</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="ä¸¤é˜¶æ®µæäº¤å¤šé˜¶æ®µæäº¤">ä¸¤é˜¶æ®µæäº¤ã€å¤šé˜¶æ®µæäº¤</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="å¹‚ç­‰">å¹‚ç­‰</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åˆ†å¸ƒå¼ä¸€è‡´æ–¹æ¡ˆ">åˆ†å¸ƒå¼ä¸€è‡´æ–¹æ¡ˆ</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="åˆ†å¸ƒå¼-leader-èŠ‚ç‚¹é€‰ä¸¾">åˆ†å¸ƒå¼ Leader èŠ‚ç‚¹é€‰ä¸¾</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="tcctryconfirmcancel-æŸ”æ€§äº‹åŠ¡">TCC(Try/Confirm/Cancel) æŸ”æ€§äº‹åŠ¡</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ">åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="å”¯ä¸€id-ç”Ÿæˆ">å”¯ä¸€ID ç”Ÿæˆ</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="å…¨å±€å”¯ä¸€id">å…¨å±€å”¯ä¸€ID</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="ä¸€è‡´æ€§hashç®—æ³•">ä¸€è‡´æ€§Hashç®—æ³•</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="è®¾è®¡æ€æƒ³--å¼€å‘æ¨¡å¼">è®¾è®¡æ€æƒ³ &amp; å¼€å‘æ¨¡å¼</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="ddddomain-driven-design---é¢†åŸŸé©±åŠ¨è®¾è®¡">DDD(Domain-driven Design - é¢†åŸŸé©±åŠ¨è®¾è®¡)</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»cqrs">å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»(CQRS)</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="è´«è¡€å……è¡€æ¨¡å‹">è´«è¡€ï¼Œå……è¡€æ¨¡å‹</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="actor-æ¨¡å¼">Actor æ¨¡å¼</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="å“åº”å¼ç¼–ç¨‹">å“åº”å¼ç¼–ç¨‹</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="reactor">Reactor</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="rxjava">RxJava</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="vertx">Vert.x</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="dodaf20">DODAF2.0</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="serverless">Serverless</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="service-mesh">Service Mesh</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="é¡¹ç›®ç®¡ç†">é¡¹ç›®ç®¡ç†</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æ¶æ„è¯„å®¡">æ¶æ„è¯„å®¡</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="é‡æ„">é‡æ„</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="ä»£ç è§„èŒƒ">ä»£ç è§„èŒƒ</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="ä»£ç -review">ä»£ç  Review</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="rup">RUP</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="çœ‹æ¿ç®¡ç†">çœ‹æ¿ç®¡ç†</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="scrum">SCRUM</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ•æ·å¼€å‘">æ•æ·å¼€å‘</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æé™ç¼–ç¨‹xp">æé™ç¼–ç¨‹ï¼ˆXPï¼‰</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="ç»“å¯¹ç¼–ç¨‹">ç»“å¯¹ç¼–ç¨‹</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="pdca-å¾ªç¯è´¨é‡ç®¡ç†">PDCA å¾ªç¯è´¨é‡ç®¡ç†</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="fmeaç®¡ç†æ¨¡å¼">FMEAç®¡ç†æ¨¡å¼</a></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="é€šç”¨ä¸šåŠ¡æœ¯è¯­">é€šç”¨ä¸šåŠ¡æœ¯è¯­</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æŠ€æœ¯è¶‹åŠ¿">æŠ€æœ¯è¶‹åŠ¿</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ”¿ç­–æ³•è§„">æ”¿ç­–ã€æ³•è§„</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æ³•å¾‹">æ³•å¾‹</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="ä¸¥æ ¼éµå®ˆåˆ‘æ³•253æ³•æ¡">ä¸¥æ ¼éµå®ˆåˆ‘æ³•253æ³•æ¡</a></li></ul></li></ul></li><li style="list-style: none"><input type="checkbox" checked> <a href="æ¶æ„å¸ˆç´ è´¨">æ¶æ„å¸ˆç´ è´¨</a></li><li style="list-style: none"><input type="checkbox" checked> <a href="å›¢é˜Ÿç®¡ç†">å›¢é˜Ÿç®¡ç†</a><ul><li style="list-style: none"><input type="checkbox" checked> <a href="æ‹›è˜">æ‹›è˜</a><h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3>æœ‰ç›®æ ‡ï¼Œå°±æœ‰åŠ¨åŠ›ã€‚æœªæ¥ï¼Œæˆ‘æœŸæœ›ç€ä½ ï¼</li></ul></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¾ˆå¤šæ—¶å€™ï¼Œç”Ÿæ´»å¹¶ä¸å¦‚æ„ï¼›å¾ˆå¤šæ—¶å€™ï¼Œç†æƒ³å¹¶ä¸èƒ½å®ç°ï¼›è·¯å¾ˆé•¿ï¼Œèº«ä½“å¾ˆç´¯ï¼Œå¯è¿˜æ˜¯ä¸€ç›´è¦èµ°ä¸‹å»ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&quot;å§‹&quot;&gt;&lt;a href=&quot;#å§‹&quot; class=&quot;headerlink&quot; title=&quot;å§‹&quot;&gt;&lt;/a&gt;å§‹&lt;/h3&gt;&lt;p&gt;æˆ‘æ˜¯ä¸€ä¸ªä¸€ä¸ªæ™®æ™®é€šé€šçš„åŒéå­¦æ ¡çš„å¤§
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»" scheme="https://tengshe789.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>è®ºå¦‚ä½•åœ¨è®ºæ–‡ä¸­ä¼˜ç¾çš„é»è´´ä»£ç </title>
    <link href="https://tengshe789.github.io/2018/10/27/%E8%AE%BA%E5%A6%82%E4%BD%95%E5%9C%A8%E8%AE%BA%E6%96%87%E4%B8%AD%E4%BC%98%E7%BE%8E%E7%9A%84%E9%BB%8F%E8%B4%B4%E4%BB%A3%E7%A0%81/"/>
    <id>https://tengshe789.github.io/2018/10/27/è®ºå¦‚ä½•åœ¨è®ºæ–‡ä¸­ä¼˜ç¾çš„é»è´´ä»£ç /</id>
    <published>2018-10-27T08:39:32.000Z</published>
    <updated>2019-11-20T13:39:41.568Z</updated>
    
    <content type="html"><![CDATA[<p>åˆæ˜¯ä¸€å¹´è®ºæ–‡å­£ï¼Œå­¦ç”Ÿå…šè¡¨ç¤ºé¸­æ¢¨å±±å¤§ã€‚</p><p><img src="/2018/10/27/è®ºå¦‚ä½•åœ¨è®ºæ–‡ä¸­ä¼˜ç¾çš„é»è´´ä»£ç /1.jpg" alt="1.jpg"></p><p>è¿™ä¸ï¼Œå¤åˆ¶ç²˜è´´ä¸€ä¸ªé¡¹ç›®é‡Œçš„ä»£ç ï¼Œæå¾—æ•´ä¸ªç»“æ„ä¹±ä¸ƒå…«ç³Ÿçš„ï¼è¿™è¯¥å¦‚ä½•æ˜¯å¥½å‘¢ï¼Ÿ</p><p>ä»Šå¤©ï¼Œæˆ‘æ¥åˆ†äº«ä¸€ä¸ªç½‘ç«™ï¼Œå¯ä»¥ä¼˜é›…çš„å°†æˆ‘çš„ä»£ç å¤åˆ¶åˆ°WORDä¸Š~</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><h4 id="æ–¹æ³•1ï¼š"><a href="#æ–¹æ³•1ï¼š" class="headerlink" title="æ–¹æ³•1ï¼š"></a>æ–¹æ³•1ï¼š</h4><p>æ‰“å¼€è¿™ä¸ªç½‘é¡µ<a href="http://www.planetb.ca/projects/syntaxHighlighter/" target="_blank" rel="noopener">PlanetB</a></p><h4 id="æ–¹æ³•2ï¼š"><a href="#æ–¹æ³•2ï¼š" class="headerlink" title="æ–¹æ³•2ï¼š"></a>æ–¹æ³•2ï¼š</h4><p>è°·æ­Œæœç´¢syntax highlight code in word documentsï¼Œæ£€ç´¢ç»“æœçš„ç¬¬ä¸€ä¸ªã€‚å½“ç„¶äº†ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯åŒä¸€ä¸ªç½‘ç«™ã€‚</p><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li><p>å°†ä½ éœ€è¦æ’å…¥åœ¨wordä¸­çš„ä»£ç å®Œæ•´çš„å¤åˆ¶åˆ°è¯¥ç½‘ç«™æç¤ºçš„æ–‡æœ¬æ¡†å†…ï¼Œé€‰æ‹©ä½ çš„ä»£ç ç±»å‹ï¼Œå¦‚Java,C++,HTMLç­‰ï¼Œå¹¶ç‚¹å‡»<code>Show Highlighted</code>ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/2018/10/27/è®ºå¦‚ä½•åœ¨è®ºæ–‡ä¸­ä¼˜ç¾çš„é»è´´ä»£ç /3.jpg" alt="1.jpg"></p></li><li><p>è¯¥ç½‘é¡µä¼šè‡ªåŠ¨å°†è¯¥ä»£ç ç”Ÿæˆåˆ°ä¸€ä¸ªæ–°çš„é¡µé¢ï¼Œæ­¤æ—¶ctrl+Aå…¨é€‰ï¼Œåctrl+cå¤åˆ¶åˆ°wordä¸­ç²˜è´´å°±å¥½ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/2018/10/27/è®ºå¦‚ä½•åœ¨è®ºæ–‡ä¸­ä¼˜ç¾çš„é»è´´ä»£ç /2.jpg" alt="1.jpg"></p></li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯æ•ˆæœå¾ˆå¥½ï¼Ÿå„ä½çœ‹è§‚è€çˆ·ï¼Œå–œæ¬¢å°±ç‚¹ä¸ªèµå§ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åˆæ˜¯ä¸€å¹´è®ºæ–‡å­£ï¼Œå­¦ç”Ÿå…šè¡¨ç¤ºé¸­æ¢¨å±±å¤§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2018/10/27/è®ºå¦‚ä½•åœ¨è®ºæ–‡ä¸­ä¼˜ç¾çš„é»è´´ä»£ç /1.jpg&quot; alt=&quot;1.jpg&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ï¼Œå¤åˆ¶ç²˜è´´ä¸€ä¸ªé¡¹ç›®é‡Œçš„ä»£ç ï¼Œæå¾—æ•´ä¸ªç»“æ„ä¹±ä¸ƒå…«ç³Ÿçš„ï¼è¿™è¯¥å¦‚ä½•æ˜¯å¥½å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä»Šå¤©ï¼Œ
      
    
    </summary>
    
    
      <category term="çªé—¨" scheme="https://tengshe789.github.io/tags/%E7%AA%8D%E9%97%A8/"/>
    
  </entry>
  
  <entry>
    <title>ä¸‡ç‰©åŸºäºSpringï¼ˆä¸€ï¼‰</title>
    <link href="https://tengshe789.github.io/2018/10/07/%E4%B8%87%E7%89%A9%E5%9F%BA%E4%BA%8ESpring/"/>
    <id>https://tengshe789.github.io/2018/10/07/ä¸‡ç‰©åŸºäºSpring/</id>
    <published>2018-10-07T13:08:03.000Z</published>
    <updated>2019-11-20T13:39:41.168Z</updated>
    
    <content type="html"><![CDATA[<p>å‰é¢æ–‡ç« æåˆ°äº†ï¼Œ<code>Springboot</code>æ˜¯åŸºäºspringä¸ºåŸºç¡€æ‰©å±•å‡ºæ¥çš„ä¸€ä¸ªå¿«é€’æ¡†æ¶ã€‚æ·±å…¥ç†è§£<code>springboot</code>å°±éœ€è¦ç†è§£<code>spring</code>çš„ç›¸å…³åŸç†ã€‚æ‰€ä»¥æˆ‘ä»¬å°±å¼€å§‹å§ï¼</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢<a href="https://blog.tengshe789.tech/ï¼ˆğŸ˜˜" target="_blank" rel="noopener">https://blog.tengshe789.tech/ï¼ˆğŸ˜˜</a></p><h2 id="Springçš„æ¦‚è¿°"><a href="#Springçš„æ¦‚è¿°" class="headerlink" title="Springçš„æ¦‚è¿°"></a>Springçš„æ¦‚è¿°</h2><p>Springæ˜¯ä¸€ä¸ªå¼€æºçš„è½»é‡çº§JavaSEï¼ˆJavaæ ‡å‡†ç‰ˆæœ¬ï¼‰/ JavaEEï¼ˆJavaä¼ä¸šç‰ˆæœ¬ï¼‰å¼€å‘åº”ç”¨æ¡†æ¶ï¼Œå…¶ç›®çš„æ˜¯ç”¨äºç®€åŒ–ä¼ä¸šçº§åº”ç”¨ç¨‹åºå¼€å‘ã€‚</p><p>åº”ç”¨ç¨‹åºæ˜¯ç”±ä¸€ç»„ç›¸äº’åä½œçš„å¯¹è±¡ç»„æˆã€‚è€Œåœ¨ä¼ ç»Ÿåº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œä¸€ä¸ªå®Œæ•´çš„åº”ç”¨æ˜¯ç”±ä¸€ç»„ç›¸äº’åä½œçš„å¯¹è±¡ç»„æˆã€‚æ‰€ä»¥å¼€å‘ä¸€ä¸ªåº”ç”¨é™¤äº†è¦å¼€å‘ä¸šåŠ¡é€»è¾‘ä¹‹å¤–ï¼Œæœ€å¤šçš„æ˜¯å…³æ³¨å¦‚ä½•ä½¿è¿™äº›å¯¹è±¡åä½œæ¥å®Œæˆæ‰€éœ€åŠŸèƒ½ï¼Œè€Œä¸”è¦<strong>ä½è€¦åˆã€é«˜å†…èš</strong>ã€‚</p><p>ä¸šåŠ¡é€»è¾‘å¼€å‘æ˜¯ä¸å¯é¿å…çš„ï¼Œé‚£å¦‚æœæœ‰ä¸ªæ¡†æ¶å‡ºæ¥å¸®æˆ‘ä»¬æ¥åˆ›å»ºå¯¹è±¡åŠç®¡ç†è¿™äº›å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å¯èƒ½æœ‰äººè¯´äº†ï¼Œæ¯”å¦‚â€œæŠ½è±¡å·¥å‚ã€å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼â€ä¸ä¹Ÿå¯ä»¥å¸®æˆ‘ä»¬åˆ›å»ºå¯¹è±¡ï¼Œâ€œç”Ÿæˆå™¨æ¨¡å¼â€å¸®æˆ‘ä»¬å¤„ç†å¯¹è±¡é—´çš„ä¾èµ–å…³ç³»ï¼Œä¸ä¹Ÿèƒ½å®Œæˆè¿™äº›åŠŸèƒ½å—ï¼Ÿå¯æ˜¯è¿™äº›åˆéœ€è¦æˆ‘ä»¬åˆ›å»ºå¦ä¸€äº›å·¥å‚ç±»ã€ç”Ÿæˆå™¨ç±»ï¼Œæˆ‘ä»¬åˆè¦è€Œå¤–ç®¡ç†è¿™äº›ç±»ï¼Œå¢åŠ äº†æˆ‘ä»¬çš„è´Ÿæ‹…ï¼Œå¦‚æœèƒ½æœ‰ç§é€šè¿‡é…ç½®æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ï¼Œç®¡ç†å¯¹è±¡ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬ä¸éœ€è¦é€šè¿‡å·¥å‚å’Œç”Ÿæˆå™¨æ¥åˆ›å»ºåŠç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè¿™æ ·æˆ‘ä»¬æ˜¯ä¸æ˜¯å‡å°‘äº†è®¸å¤šå·¥ä½œï¼ŒåŠ é€Ÿäº†å¼€å‘ï¼Œèƒ½èŠ‚çœå‡ºå¾ˆå¤šæ—¶é—´æ¥å¹²å…¶ä»–äº‹ã€‚</p><p>Springæ¡†æ¶åˆšå‡ºæ¥æ—¶ä¸»è¦å°±æ˜¯æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p><p><img src="/2018/10/07/ä¸‡ç‰©åŸºäºSpring/1.jpg" alt="Spring"></p><p>Springæ¡†æ¶é™¤äº†å¸®æˆ‘ä»¬ç®¡ç†å¯¹è±¡åŠå…¶ä¾èµ–å…³ç³»ï¼Œè¿˜æä¾›åƒé€šç”¨<strong>æ—¥å¿—è®°å½•</strong>ã€<strong>æ€§èƒ½ç»Ÿè®¡</strong>ã€<strong>å®‰å…¨æ§åˆ¶</strong>ã€<strong>å¼‚å¸¸å¤„ç†</strong>ç­‰é¢å‘åˆ‡é¢çš„èƒ½åŠ›ï¼Œè¿˜èƒ½å¸®æˆ‘ä»¬ç®¡ç†æœ€å¤´ç–¼çš„<strong>æ•°æ®åº“äº‹åŠ¡</strong>ï¼Œæœ¬èº«æä¾›äº†ä¸€å¥—ç®€å•çš„JDBCè®¿é—®å®ç°ï¼Œæä¾›ä¸ç¬¬ä¸‰æ–¹æ•°æ®è®¿é—®æ¡†æ¶é›†æˆï¼Œå¦‚JPAï¼ˆé»˜è®¤ä½¿ç”¨<code>Hibernate</code>ï¼‰ï¼Œä¸å„ç§JavaEEæŠ€æœ¯æ•´åˆï¼ˆå¦‚<code>JavaMail</code>ã€ä»»åŠ¡è°ƒåº¦ç­‰ç­‰ï¼‰ï¼Œæä¾›ä¸€å¥—è‡ªå·±çš„webå±‚æ¡†æ¶<code>SpringMVC</code>ã€<code>Webflex</code>ï¼Œè€Œä¸”è¿˜èƒ½éå¸¸ç®€å•çš„ä¸ç¬¬ä¸‰æ–¹Webæ¡†æ¶é›†æˆã€‚</p><p>ä»è¿™é‡Œå¯ä»¥è®¤ä¸ºSpringæ˜¯ä¸€ä¸ªè¶…çº§ç²˜åˆå¹³å°ï¼Œé™¤äº†è‡ªå·±æä¾›åŠŸèƒ½å¤–ï¼Œè¿˜æä¾›ç²˜åˆå…¶ä»–æŠ€æœ¯å’Œæ¡†æ¶çš„èƒ½åŠ›ï¼Œä»è€Œä½¿æˆ‘ä»¬å¯ä»¥æ›´è‡ªç”±çš„é€‰æ‹©åˆ°åº•ä½¿ç”¨ä»€ä¹ˆæŠ€æœ¯è¿›è¡Œå¼€å‘ã€‚è€Œä¸”ä¸ç®¡æ˜¯JAVASEï¼ˆC/Sæ¶æ„ï¼‰åº”ç”¨ç¨‹åºè¿˜æ˜¯JAVAEEï¼ˆB/Sæ¶æ„ï¼‰åº”ç”¨ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¹³å°è¿›è¡Œå¼€å‘ã€‚è®©æˆ‘ä»¬æ¥æ·±å…¥çœ‹ä¸€ä¸‹Springåˆ°åº•èƒ½å¸®æˆ‘ä»¬åšäº›ä»€ä¹ˆï¼Ÿ</p><h2 id="å†å²çš„å¼€å§‹"><a href="#å†å²çš„å¼€å§‹" class="headerlink" title="å†å²çš„å¼€å§‹"></a>å†å²çš„å¼€å§‹</h2><p>1996ï¼ŒJavaè¿˜åªæ˜¯ä¸€ä¸ªæ–°å…´çš„ã€åˆå‡ºèŒ…åºçš„ç¼–ç¨‹è¯­è¨€ã€‚äººä»¬ä¹‹æ‰€ä»¥å…³æ³¨å¥¹ä»…ä»…æ˜¯å› ä¸ºï¼Œå¯ä»¥ä½¿ç”¨Javaçš„Appletæ¥å¼€å‘Webåº”ç”¨ã€‚ä½†è¿™äº›å¼€å‘è€…å¾ˆå¿«å°±å‘ç°è¿™ä¸ªæ–°å…´çš„è¯­è¨€è¿˜èƒ½åšæ›´å¤šçš„äº‹æƒ…ã€‚ä¸ä¹‹å‰çš„æ‰€æœ‰è¯­è¨€ä¸åŒï¼ŒJavaè®©æ¨¡å—åŒ–æ„å»ºå¤æ‚çš„ç³»ç»Ÿæˆä¸ºå¯èƒ½ï¼ˆå½“æ—¶çš„è½¯ä»¶è¡Œä¸šè™½ç„¶åœ¨ä¸šåŠ¡ä¸Šçªé£çŒ›è¿›ï¼Œä½†å½“æ—¶å¼€å‘ç”¨çš„æ˜¯ä¼ ç»Ÿçš„é¢å‘è¿‡ç¨‹å¼€å‘æ€æƒ³ï¼Œè½¯ä»¶çš„å¼€å‘æ•ˆç‡ä¸€ç›´è¸Ÿè¹°ä¸å‰ã€‚ä¼´éšç€ä¸šåŠ¡å¤æ‚æ€§çš„ä¸æ–­åŠ æ·±ï¼Œå¼€å‘ä¹Ÿå˜å¾—è¶Šå‘å›°éš¾ã€‚å…¶å®ï¼Œå½“æ—¶ä¹Ÿæ˜¯é¢å‘å¯¹è±¡æ€æƒ³é£é€Ÿå‘å±•çš„æ—¶æœŸï¼Œå¥¹åœ¨80å¹´ä»£æœ«è¢«æå‡ºï¼Œæˆç†Ÿäº90å¹´ä»£ï¼Œç°ä»Šå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æ˜¯é¢å‘å¯¹è±¡çš„ï¼Œå½“ç„¶è¿™æ˜¯åè¯äº†ï¼‰ã€‚ä»–ä»¬ä¸ºAppletè€Œæ¥ï¼Œä¸ºç»„ä»¶åŒ–è€Œç•™ã€‚è¿™ä¾¿æ˜¯æœ€æ—©çš„Javaã€‚</p><p>åŒæ ·åœ¨è¿™ä¸€å¹´çš„12æœˆï¼ŒSunå…¬å¸å‘å¸ƒäº†å½“æ—¶è¿˜åä¸è§ç»ä¼ ä½†åæ¥äººå°½çš†çŸ¥çš„JavaBean1.00-Aè§„èŒƒã€‚æ—©æœŸçš„JavaBeanè§„èŒƒé’ˆå¯¹äºJavaï¼Œå¥¹å®šä¹‰äº†è½¯ä»¶ç»„ä»¶æ¨¡å‹ã€‚è¿™ä¸ªè§„èŒƒè§„å®šäº†ä¸€æ•´å¥—ç¼–ç ç­–ç•¥ï¼Œä½¿ç®€å•çš„Javaå¯¹è±¡ä¸ä»…å¯ä»¥è¢«é‡ç”¨ï¼Œè€Œä¸”è¿˜å¯ä»¥è½»æ¾åœ°æ„å»ºæ›´ä¸ºå¤æ‚çš„åº”ç”¨ã€‚å°½ç®¡JavaBeanæœ€åˆæ˜¯ä¸ºé‡ç”¨åº”ç”¨ç»„ä»¶è€Œè®¾è®¡çš„ï¼Œä½†å½“æ—¶ä»–ä»¬å´æ˜¯ä¸»è¦ç”¨ä½œæ„å»ºçª—ä½“æ§ä»¶ï¼Œæ¯•ç«Ÿåœ¨PCæ—¶ä»£é‚£æ‰æ˜¯ä¸»æµã€‚ä½†ç›¸æ¯”äºå½“æ—¶æ­£å¦‚æ—¥ä¸­å¤©çš„Delphiã€VBå’ŒC++ï¼Œä»–çœ‹èµ·æ¥è¿˜æ˜¯å¤ªç®€æ˜“äº†ï¼Œä»¥è‡³äºæ— æ³•èƒœä»»ä»»ä½•â€å®é™…çš„â€å·¥ä½œã€‚</p><p>å¤æ‚çš„åº”ç”¨é€šå¸¸éœ€è¦è¯¸å¦‚äº‹ç‰©ã€å®‰å…¨ã€åˆ†å¸ƒå¼ç­‰æœåŠ¡çš„æ”¯æŒï¼Œä½†JavaBeanå¹¶æœªç›´æ¥æä¾›ã€‚æ‰€ä»¥åˆ°äº†1998å¹´3æœˆï¼ŒSunå‘å¸ƒäº†EJB1.0è§„èŒƒï¼Œè¯¥è§„èŒƒæŠŠJavaç»„ä»¶çš„è®¾è®¡ç†å¿µå»¶ä¼¸åˆ°äº†æœåŠ¡å™¨ç«¯ï¼Œå¹¶æä¾›äº†è®¸å¤šå¿…é¡»çš„ä¼ä¸šçº§æœåŠ¡ï¼Œä½†ä»–ä¹Ÿä¸å†åƒæ—©æœŸçš„JavaBeané‚£ä¹ˆç®€å•äº†ã€‚å®é™…ä¸Šï¼Œé™¤äº†åå­—ï¼ŒEJBBeanå·²ç»å’ŒJavaBeanæ²¡æœ‰ä»»ä½•å…³ç³»äº†ã€‚</p><p>å°½ç®¡ç°å®ä¸­æœ‰å¾ˆå¤šç³»ç»Ÿæ˜¯åŸºäºEJBæ„å»ºçš„ï¼Œä½†EJBä»æ¥æ²¡æœ‰å®ç°å®ƒæœ€åˆçš„è®¾æƒ³ï¼šç®€åŒ–å¼€å‘ã€‚EJBçš„å£°æ˜å¼ç¼–ç¨‹æ¨¡å‹çš„ç¡®ç®€åŒ–äº†å¾ˆå¤šåŸºç¡€æ¶æ„å±‚é¢çš„å¼€å‘ï¼Œä¾‹å¦‚äº‹åŠ¡å’Œå®‰å…¨ï¼›ä½†å¦ä¸€æ–¹é¢EJBåœ¨éƒ¨ç½²æè¿°ç¬¦å’Œé…å¥—ä»£ç å®ç°ç­‰æ–¹é¢å˜å¾—å¼‚å¸¸å¤æ‚ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¾ˆå¤šå¼€å‘è€…å¯¹EJBå·²ç»ä¸å†æŠ±æœ‰å¹»æƒ³ï¼Œå¼€å§‹å¯»æ±‚æ›´ç®€æ´çš„æ–¹æ³•ã€‚</p><p>ç°åœ¨Javaç»„ä»¶å¼€å‘ç†å¿µé‡æ–°å›å½’æ­£è½¨ã€‚æ–°çš„ç¼–ç¨‹æŠ€æœ¯AOPå’ŒDIçš„ä¸æ–­å‡ºç°ï¼Œä»–ä»¬ä¸ºJavaBeanæä¾›äº†ä¹‹å‰EJBæ‰èƒ½æ‹¥æœ‰çš„å¼ºå¤§åŠŸèƒ½ã€‚è¿™äº›æŠ€æœ¯ä¸ºPOJOæä¾›äº†ç±»ä¼¼EJBçš„å£°æ˜å¼ç¼–ç¨‹æ¨¡å‹ï¼Œè€Œæ²¡æœ‰å¼•å…¥ä»»ä½•EJBçš„å¤æ‚æ€§ã€‚å½“ç®€å•çš„JavaBeanè¶³ä»¥èƒœä»»æ—¶ï¼Œäººä»¬ä¾¿ä¸æ„¿ç¼–å†™ç¬¨é‡çš„EJBç»„ä»¶äº†ã€‚</p><p>å®¢è§‚åœ°è®²ï¼ŒEJBçš„å‘å±•ç”šè‡³ä¿ƒè¿›äº†åŸºäºPOJOçš„ç¼–ç¨‹æ¨¡å‹ã€‚å¼•å…¥æ–°çš„ç†å¿µï¼Œæœ€æ–°çš„EJBè§„èŒƒç›¸æ¯”ä¹‹å‰çš„è§„èŒƒæœ‰äº†å‰æ‰€æœªæœ‰çš„ç®€åŒ–ï¼Œä½†å¯¹å¾ˆå¤šå¼€å‘è€…è€Œè¨€ï¼Œè¿™ä¸€åˆ‡çš„ä¸€åˆ‡éƒ½æ¥å¾—å¤ªè¿Ÿäº†ã€‚åˆ°äº†EJB3è§„èŒƒå‘å¸ƒæ—¶ï¼Œå…¶ä»–åŸºäºPOJOçš„å¼€å‘æ¶æ„å·²ç»æˆä¸ºäº‹å®çš„æ ‡å‡†äº†ï¼Œè€ŒSpringæ¡†æ¶ä¹Ÿæ˜¯åœ¨è¿™æ ·çš„å¤§ç¯å¢ƒä¸‹å‡ºç°çš„ã€‚</p><h3 id="Springè®¾è®¡çš„åˆè¡·"><a href="#Springè®¾è®¡çš„åˆè¡·" class="headerlink" title="Springè®¾è®¡çš„åˆè¡·"></a>Springè®¾è®¡çš„åˆè¡·</h3><p>Springæ˜¯ä¸ºè§£å†³ä¼ä¸šçº§åº”ç”¨å¼€å‘çš„å¤æ‚æ€§è€Œè®¾è®¡ï¼Œå¥¹å¯ä»¥åšå¾ˆå¤šäº‹ã€‚ä½†å½’æ ¹åˆ°åº•æ”¯æ’‘Springçš„ä»…ä»…æ˜¯å°‘è®¸çš„åŸºæœ¬ç†å¿µï¼Œè€Œæ‰€æœ‰åœ°è¿™äº›çš„åŸºæœ¬ç†å¿µéƒ½èƒ½å¯ä»¥è¿½æº¯åˆ°ä¸€ä¸ªæœ€æ ¹æœ¬çš„ä½¿å‘½ï¼šç®€åŒ–å¼€å‘ã€‚è¿™æ˜¯ä¸€ä¸ªéƒ‘é‡çš„æ‰¿è¯ºï¼Œå…¶å®è®¸å¤šæ¡†æ¶éƒ½å£°ç§°åœ¨æŸäº›æ–¹é¢åšäº†ç®€åŒ–ã€‚</p><p>è€ŒSpringåˆ™ç«‹å¿—äºå…¨æ–¹é¢çš„ç®€åŒ–Javaå¼€å‘ã€‚å¯¹æ­¤ï¼Œå¥¹ä¸»è¦é‡‡å–äº†4ä¸ªå…³é”®ç­–ç•¥ï¼š</p><p>1ï¼ŒåŸºäºPOJOçš„è½»é‡çº§å’Œæœ€å°ä¾µå…¥æ€§ç¼–ç¨‹ï¼›</p><p>2ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥å’Œé¢å‘æ¥å£æ¾è€¦åˆï¼›</p><p>3ï¼ŒåŸºäºåˆ‡é¢è¿›è¡Œå£°æ˜å¼ç¼–ç¨‹ï¼›</p><p>4ï¼Œé€šè¿‡åˆ‡é¢å’Œæ¨¡æ¿å‡å°‘æ ·æ¿å¼ä»£ç ï¼›</p><p>è€Œä»–ä¸»è¦æ˜¯é€šè¿‡ï¼šé¢å‘Beanã€ä¾èµ–æ³¨å…¥ä»¥åŠé¢å‘åˆ‡é¢è¿™ä¸‰ç§æ–¹å¼æ¥è¾¾æˆçš„ã€‚</p><h3 id="BOPç¼–ç¨‹ä¼Šå§‹"><a href="#BOPç¼–ç¨‹ä¼Šå§‹" class="headerlink" title="BOPç¼–ç¨‹ä¼Šå§‹"></a>BOPç¼–ç¨‹ä¼Šå§‹</h3><p>Springæ˜¯<strong>é¢å‘Beançš„ç¼–ç¨‹</strong>ï¼ˆBeanOrientedProgramming,BOPï¼‰ï¼ŒBeanåœ¨Springä¸­æ‰æ˜¯çœŸæ­£çš„ä¸»è§’ã€‚Beanåœ¨Springä¸­ä½œç”¨å°±åƒObjectå¯¹OOPçš„æ„ä¹‰ä¸€æ ·ï¼ŒSpringä¸­æ²¡æœ‰Beanä¹Ÿå°±æ²¡æœ‰Springå­˜åœ¨çš„æ„ä¹‰ã€‚Springæä¾›äº†IOCå®¹å™¨é€šè¿‡é…ç½®æ–‡ä»¶æˆ–è€…æ³¨è§£çš„æ–¹å¼æ¥ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><p>æ§åˆ¶åè½¬(å…¶ä¸­æœ€å¸¸è§çš„æ–¹å¼å«åšä¾èµ–æ³¨å…¥ï¼ˆDependencyInjectionï¼ŒDIï¼‰ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼å«â€œä¾èµ–æŸ¥æ‰¾â€ï¼ˆDependencyLookupï¼ŒDLï¼‰ï¼Œå¥¹åœ¨C++ã€Javaã€PHPä»¥åŠ.NETä¸­éƒ½è¿ç”¨ã€‚åœ¨æœ€æ—©çš„Springä¸­æ˜¯åŒ…å«æœ‰ä¾èµ–æ³¨å…¥æ–¹æ³•å’Œä¾èµ–æŸ¥è¯¢çš„ï¼Œä½†å› ä¸ºä¾èµ–æŸ¥è¯¢ä½¿ç”¨é¢‘ç‡è¿‡ä½ï¼Œä¸ä¹…å°±è¢«Springç§»é™¤äº†ï¼Œæ‰€ä»¥åœ¨Springä¸­æ§åˆ¶åè½¬ä¹Ÿè¢«ç§°ä½œä¾èµ–æ³¨å…¥)ï¼Œå¥¹çš„åŸºæœ¬æ¦‚å¿µæ˜¯ï¼šä¸åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯æè¿°åˆ›å»ºå®ƒä»¬çš„æ–¹å¼ã€‚åœ¨ä»£ç ä¸­ä¸ç›´æ¥ä¸å¯¹è±¡å’ŒæœåŠ¡è¿æ¥ï¼Œä½†åœ¨é…ç½®æ–‡ä»¶ä¸­æè¿°å“ªä¸€ä¸ªç»„ä»¶éœ€è¦å“ªä¸€é¡¹æœåŠ¡ã€‚å®¹å™¨ï¼ˆåœ¨Springæ¡†æ¶ä¸­æ˜¯IOCå®¹å™¨ï¼‰è´Ÿè´£å°†è¿™äº›è”ç³»åœ¨ä¸€èµ·ã€‚</p><p>åœ¨å…¸å‹çš„IOCåœºæ™¯ä¸­ï¼Œå®¹å™¨åˆ›å»ºäº†æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶è®¾ç½®å¿…è¦çš„å±æ€§å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ï¼Œå†³å®šä»€ä¹ˆæ—¶é—´è°ƒç”¨æ–¹æ³•ã€‚</p><h3 id="ä¾èµ–æ³¨å…¥DIçš„åŸºæœ¬æ¦‚å¿µ"><a href="#ä¾èµ–æ³¨å…¥DIçš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ä¾èµ–æ³¨å…¥DIçš„åŸºæœ¬æ¦‚å¿µ"></a>ä¾èµ–æ³¨å…¥DIçš„åŸºæœ¬æ¦‚å¿µ</h3><p>Springè®¾è®¡çš„æ ¸å¿ƒorg.springframework.beansåŒ…ï¼ˆæ¶æ„æ ¸å¿ƒæ˜¯org.springframework.coreåŒ…ï¼‰ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯ä¸JavaBeanç»„ä»¶ä¸€èµ·ä½¿ç”¨ã€‚è¿™ä¸ªåŒ…é€šå¸¸ä¸æ˜¯ç”±ç”¨æˆ·ç›´æ¥ä½¿ç”¨ï¼Œè€Œæ˜¯ç”±æœåŠ¡å™¨å°†å…¶ç”¨ä½œå…¶ä»–å¤šæ•°åŠŸèƒ½çš„åº•å±‚ä¸­ä»‹ã€‚ä¸‹ä¸€ä¸ªæœ€é«˜çº§æŠ½è±¡æ˜¯BeanFactoryæ¥å£ï¼Œå®ƒæ˜¯å·¥å‚è®¾è®¡æ¨¡å¼çš„å®ç°ï¼Œå…è®¸é€šè¿‡åç§°åˆ›å»ºå’Œæ£€ç´¢å¯¹è±¡ã€‚BeanFactoryä¹Ÿå¯ä»¥ç®¡ç†å¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚</p><p>BeanFactoryæ”¯æŒä¸¤ä¸ªå¯¹è±¡æ¨¡å‹ã€‚</p><p>1ï¼Œå•ä¾‹ï¼šæ¨¡å‹æä¾›äº†å…·æœ‰ç‰¹å®šåç§°çš„å¯¹è±¡çš„å…±äº«å®ä¾‹ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢æ—¶å¯¹å…¶è¿›è¡Œæ£€ç´¢ã€‚Singletonæ˜¯é»˜è®¤çš„ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„å¯¹è±¡æ¨¡å‹ã€‚å¯¹äºæ— çŠ¶æ€æœåŠ¡å¯¹è±¡å¾ˆç†æƒ³ã€‚</p><p>2ï¼ŒåŸå‹ï¼šæ¨¡å‹ç¡®ä¿æ¯æ¬¡æ£€ç´¢éƒ½ä¼šåˆ›å»ºå•ç‹¬çš„å¯¹è±¡ã€‚åœ¨æ¯ä¸ªç”¨æˆ·éƒ½éœ€è¦è‡ªå·±çš„å¯¹è±¡æ—¶ï¼ŒåŸå‹æ¨¡å‹æœ€é€‚åˆã€‚</p><p>Beanå·¥å‚çš„æ¦‚å¿µæ˜¯Springä½œä¸ºIOCå®¹å™¨çš„åŸºç¡€ã€‚IOCåˆ™å°†å¤„ç†äº‹æƒ…çš„è´£ä»»ä»åº”ç”¨ç¨‹åºä»£ç è½¬ç§»åˆ°æ¡†æ¶ã€‚</p><h3 id="AOPç¼–ç¨‹ç†å¿µ"><a href="#AOPç¼–ç¨‹ç†å¿µ" class="headerlink" title="AOPç¼–ç¨‹ç†å¿µ"></a>AOPç¼–ç¨‹ç†å¿µ</h3><p>é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå³AOPï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³ï¼Œå®ƒå…è®¸ç¨‹åºå‘˜å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹æˆ–æ¨ªåˆ‡å…¸å‹çš„èŒè´£åˆ†ç•Œçº¿çš„è¡Œä¸ºï¼ˆä¾‹å¦‚æ—¥å¿—å’Œäº‹åŠ¡ç®¡ç†ï¼‰è¿›è¡Œæ¨¡å—åŒ–ã€‚AOPçš„æ ¸å¿ƒæ„é€ æ˜¯æ–¹é¢ï¼ˆåˆ‡é¢ï¼‰ï¼Œå®ƒå°†é‚£äº›å½±å“å¤šä¸ªç±»çš„è¡Œä¸ºå°è£…åˆ°å¯é‡ç”¨çš„æ¨¡å—ä¸­ã€‚</p><p>AOPå’ŒIOCæ˜¯è¡¥å……æ€§çš„æŠ€æœ¯ï¼Œå®ƒä»¬éƒ½è¿ç”¨æ¨¡å—åŒ–æ–¹å¼è§£å†³ä¼ä¸šåº”ç”¨ç¨‹åºå¼€å‘ä¸­çš„å¤æ‚é—®é¢˜ã€‚åœ¨å…¸å‹çš„é¢å‘å¯¹è±¡å¼€å‘æ–¹å¼ä¸­ï¼Œå¯èƒ½è¦å°†æ—¥å¿—è®°å½•è¯­å¥æ”¾åœ¨æ‰€æœ‰æ–¹æ³•å’ŒJavaç±»ä¸­æ‰èƒ½å®ç°æ—¥å¿—åŠŸèƒ½ã€‚åœ¨AOPæ–¹å¼ä¸­ï¼Œå¯ä»¥åè¿‡æ¥å°†æ—¥å¿—æœåŠ¡æ¨¡å—åŒ–ï¼Œå¹¶ä»¥å£°æ˜çš„æ–¹å¼å°†å®ƒä»¬åº”ç”¨åˆ°éœ€è¦æ—¥å¿—çš„ç»„ä»¶ä¸Šã€‚å½“ç„¶ï¼Œä¼˜åŠ¿å°±æ˜¯Javaç±»ä¸éœ€è¦çŸ¥é“æ—¥å¿—æœåŠ¡çš„å­˜åœ¨ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘ç›¸å…³çš„ä»£ç ã€‚æ‰€ä»¥ï¼Œç”¨SpringAOPç¼–å†™çš„åº”ç”¨ç¨‹åºä»£ç æ˜¯æ¾æ•£è€¦åˆçš„ã€‚</p><p>AOPçš„åŠŸèƒ½å®Œå…¨é›†æˆåˆ°äº†Springäº‹åŠ¡ç®¡ç†ã€æ—¥å¿—å’Œå…¶ä»–å„ç§ç‰¹æ€§çš„ä¸Šä¸‹æ–‡ä¸­ã€‚</p><p>AOPç¼–ç¨‹çš„å¸¸ç”¨åœºæ™¯æœ‰ï¼šAuthenticationæƒé™è®¤è¯ã€Loggingæ—¥å¿—ã€TransctionsManageräº‹åŠ¡ã€LazyLoadingæ‡’åŠ è½½ã€ContextProcessä¸Šä¸‹æ–‡å¤„ç†ã€ErrorHandleré”™è¯¯è·Ÿè¸ªï¼ˆå¼‚å¸¸æ•è·æœºåˆ¶ï¼‰ã€Cacheç¼“å­˜ã€‚</p><h3 id="ç¼–ç¨‹æ€æƒ³æ€»ç»“"><a href="#ç¼–ç¨‹æ€æƒ³æ€»ç»“" class="headerlink" title="ç¼–ç¨‹æ€æƒ³æ€»ç»“"></a>ç¼–ç¨‹æ€æƒ³æ€»ç»“</h3><table><thead><tr><th>Springæ€æƒ³</th><th>åº”ç”¨åœºæ™¯ï¼ˆç‰¹ç‚¹ï¼‰</th><th>ä¸€å¥è¯å½’çº³</th></tr></thead><tbody><tr><td>AOP</td><td>AspectOrientedProgramming(é¢å‘åˆ‡é¢ç¼–ç¨‹)              æ‰¾å‡ºå¤šä¸ªç±»ä¸­æœ‰ä¸€å®šè§„å¾‹çš„ä»£ç ï¼Œå¼€å‘æ—¶æ‹†å¼€ï¼Œè¿è¡Œæ—¶å†åˆå¹¶ã€‚              é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå³é¢å‘è§„åˆ™ç¼–ç¨‹ã€‚</td><td>è§£è€¦ï¼Œä¸“äººåšä¸“äº‹ã€‚</td></tr><tr><td>OOP</td><td>ObjectOrientedProgrammingï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰              å½’çº³æ€»ç»“ç”Ÿæ´»ä¸­ä¸€åˆ‡äº‹ç‰©ã€‚</td><td>å°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚</td></tr><tr><td>BOP</td><td>BeanOrientedProgrammingï¼ˆé¢å‘Beanç¼–ç¨‹ï¼‰              é¢å‘Beanï¼ˆæ™®é€šçš„javaç±»ï¼‰è®¾è®¡ç¨‹åºã€‚</td><td>ä¸€åˆ‡ä»Beanå¼€å§‹ã€‚</td></tr><tr><td>IOC</td><td>InversionofControlï¼ˆæ§åˆ¶åè½¬ï¼‰              å°†newå¯¹è±¡çš„åŠ¨ä½œäº¤ç»™Springç®¡ç†ï¼Œå¹¶ç”±Springä¿å­˜å·²åˆ›å»ºçš„å¯¹è±¡ï¼ˆIOCå®¹å™¨ï¼‰ã€‚</td><td>è½¬äº¤æ§åˆ¶æƒï¼ˆå³æ§åˆ¶æƒåè½¬ï¼‰ã€‚</td></tr><tr><td>DI/DL</td><td>DependencyInjectionï¼ˆä¾èµ–æ³¨å…¥ï¼‰æˆ–è€…DependencyLookupï¼ˆä¾èµ–æŸ¥æ‰¾ï¼‰              ä¾èµ–æ³¨å…¥ã€ä¾èµ–æŸ¥æ‰¾ï¼ŒSpringä¸ä»…ä¿å­˜è‡ªå·±åˆ›å»ºçš„å¯¹è±¡ï¼Œè€Œä¸”ä¿å­˜å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚              æ³¨å…¥å³èµ‹å€¼ï¼Œä¸»è¦ä¸‰ç§æ–¹å¼æ„é€ æ–¹æ³•ã€setæ–¹æ³•ã€ç›´æ¥èµ‹å€¼ã€‚</td><td>å…ˆç†æ¸…å…³ç³»å†èµ‹å€¼ã€‚</td></tr></tbody></table><h2 id="Springæ¶æ„è®¾è®¡"><a href="#Springæ¶æ„è®¾è®¡" class="headerlink" title="Springæ¶æ„è®¾è®¡"></a>Springæ¶æ„è®¾è®¡</h2><p>Springæ€»å…±å¤§çº¦æœ‰20ä¸ªæ¨¡å—ï¼Œç”±1300å¤šä¸ªä¸åŒçš„æ–‡ä»¶æ„æˆã€‚è€Œè¿™äº›ç»„ä»¶è¢«åˆ†åˆ«æ•´åˆåœ¨æ ¸å¿ƒå®¹å™¨ï¼ˆCoreContainerï¼‰ã€AOPï¼ˆAspectOrientedProgrammingï¼‰å’Œè®¾å¤‡æ”¯æŒï¼ˆInstrmentationï¼‰ã€æ•°æ®è®¿é—®åŠé›†æˆï¼ˆDataAccess/Integerationï¼‰ã€Webã€æŠ¥æ–‡å‘é€ï¼ˆMessagingï¼‰ã€Testï¼Œ6ä¸ªæ¨¡å—é›†åˆä¸­ã€‚ä»¥ä¸‹æ˜¯springæ€»ä½“æ¶æ„å›¾å’ŒSpring5çš„æ¨¡å—ç»“æ„å›¾ï¼š</p><p><img src="/2018/10/07/ä¸‡ç‰©åŸºäºSpring/2.svg" alt="springboot"></p><p><img src="/2018/10/07/ä¸‡ç‰©åŸºäºSpring/3.jpg" alt="spring5"></p><p>ç»„æˆ<code>Spring</code>æ¡†æ¶çš„æ¯ä¸ªæ¨¡å—é›†åˆæˆ–è€…æ¨¡å—éƒ½å¯ä»¥å•ç‹¬å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—è”åˆå®ç°ã€‚æ¯ä¸ªæ¨¡å—çš„ç»„æˆå’ŒåŠŸèƒ½å¦‚ä¸‹ï¼š</p><p>1.<strong>æ ¸å¿ƒå®¹å™¨</strong>ï¼šç”±<code>spring-beans</code>ã€<code>spring-core</code>ã€<code>spring-context</code>å’Œ<code>spring-expression</code>ï¼ˆSpringExpressionLanguage,SpELï¼‰4ä¸ªæ¨¡å—ç»„æˆã€‚</p><p><code>spring-beans</code>å’Œ<code>spring-core</code>æ¨¡å—æ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒæ¨¡å—ï¼ŒåŒ…å«äº†æ§åˆ¶åè½¬ï¼ˆInversionofControl,IOCï¼‰å’Œä¾èµ–æ³¨å…¥ï¼ˆDependencyInjection,DIï¼‰ã€‚BeanFactoryæ¥å£æ˜¯Springæ¡†æ¶ä¸­çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒæ˜¯å·¥å‚æ¨¡å¼çš„å…·ä½“å®ç°ã€‚BeanFactoryä½¿ç”¨æ§åˆ¶åè½¬å¯¹åº”ç”¨ç¨‹åºçš„é…ç½®å’Œä¾èµ–æ€§è§„èŒƒä¸å®é™…çš„åº”ç”¨ç¨‹åºä»£ç è¿›è¡Œäº†åˆ†ç¦»ã€‚ä½†BeanFactoryå®¹å™¨å®ä¾‹åŒ–åå¹¶ä¸ä¼šè‡ªåŠ¨å®ä¾‹åŒ–Beanï¼Œåªæœ‰å½“Beanè¢«ä½¿ç”¨æ—¶BeanFactoryå®¹å™¨æ‰ä¼šå¯¹è¯¥Beanè¿›è¡Œå®ä¾‹åŒ–ä¸ä¾èµ–å…³ç³»çš„è£…é…ã€‚</p><p><code>spring-context</code>æ¨¡å—æ„æ¶äºæ ¸å¿ƒæ¨¡å—ä¹‹ä¸Šï¼Œä»–æ‰©å±•äº†<code>BeanFactory</code>ï¼Œä¸ºå¥¹æ·»åŠ äº†Beanç”Ÿå‘½å‘¨æœŸæ§åˆ¶ã€æ¡†æ¶äº‹ä»¶ä½“ç³»ä»¥åŠèµ„æºåŠ è½½é€æ˜åŒ–ç­‰åŠŸèƒ½ã€‚æ­¤å¤–è¯¥æ¨¡å—è¿˜æä¾›äº†è®¸å¤šä¼ä¸šçº§æ”¯æŒï¼Œå¦‚é‚®ä»¶è®¿é—®ã€è¿œç¨‹è®¿é—®ã€ä»»åŠ¡è°ƒåº¦ç­‰ï¼ŒApplicationContextæ˜¯è¯¥æ¨¡å—çš„æ ¸å¿ƒæ¥å£ï¼Œå¥¹æ˜¯BeanFactoryçš„è¶…ç±»ï¼Œä¸BeanFactoryä¸åŒï¼ŒApplicationContextå®¹å™¨å®ä¾‹åŒ–åä¼šè‡ªåŠ¨å¯¹æ‰€æœ‰çš„å•å®ä¾‹Beanè¿›è¡Œå®ä¾‹åŒ–ä¸ä¾èµ–å…³ç³»çš„è£…é…ï¼Œä½¿ä¹‹å¤„äºå¾…ç”¨çŠ¶æ€ã€‚</p><p><code>spring-expression</code>æ¨¡å—æ˜¯ç»Ÿä¸€è¡¨è¾¾å¼è¯­è¨€ï¼ˆELï¼‰çš„æ‰©å±•æ¨¡å—ï¼Œå¯ä»¥æŸ¥è¯¢ã€ç®¡ç†è¿è¡Œä¸­çš„å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿çš„å¯ä»¥è°ƒç”¨å¯¹è±¡æ–¹æ³•ã€æ“ä½œæ•°ç»„ã€é›†åˆç­‰ã€‚å®ƒçš„è¯­æ³•ç±»ä¼¼äºä¼ ç»ŸELï¼Œä½†æä¾›äº†é¢å¤–çš„åŠŸèƒ½ï¼Œæœ€å‡ºè‰²çš„è¦æ•°å‡½æ•°è°ƒç”¨å’Œç®€å•å­—ç¬¦ä¸²çš„æ¨¡æ¿å‡½æ•°ã€‚è¿™ç§è¯­è¨€çš„ç‰¹æ€§æ˜¯åŸºäºSpringäº§å“çš„éœ€æ±‚è€Œè®¾è®¡ï¼Œä»–å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åŒSpringIOCè¿›è¡Œäº¤äº’ã€‚</p><p>2.AOPå’Œè®¾å¤‡æ”¯æŒï¼šç”±<code>spring-aop</code>ã€<code>spring-aspects</code>å’Œ<code>spring-instrument</code>3ä¸ªæ¨¡å—ç»„æˆã€‚</p><p><code>spring-aop</code>æ˜¯Springçš„å¦ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œæ˜¯AOPä¸»è¦çš„å®ç°æ¨¡å—ã€‚ä½œä¸ºç»§OOPåï¼Œå¯¹ç¨‹åºå‘˜å½±å“æœ€å¤§çš„ç¼–ç¨‹æ€æƒ³ä¹‹ä¸€ï¼ŒAOPæå¤§åœ°å¼€æ‹“äº†äººä»¬å¯¹äºç¼–ç¨‹çš„æ€è·¯ã€‚åœ¨Springä¸­ï¼Œä»–æ˜¯ä»¥JVMçš„åŠ¨æ€ä»£ç†æŠ€æœ¯ä¸ºåŸºç¡€ï¼Œç„¶åè®¾è®¡å‡ºäº†ä¸€ç³»åˆ—çš„AOPæ¨ªåˆ‡å®ç°ï¼Œæ¯”å¦‚å‰ç½®é€šçŸ¥ã€è¿”å›é€šçŸ¥ã€å¼‚å¸¸é€šçŸ¥ç­‰ï¼ŒåŒæ—¶ï¼ŒPointcutæ¥å£æ¥åŒ¹é…åˆ‡å…¥ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ç°æœ‰çš„åˆ‡å…¥ç‚¹æ¥è®¾è®¡æ¨ªåˆ‡é¢ï¼Œä¹Ÿå¯ä»¥æ‰©å±•ç›¸å…³æ–¹æ³•æ ¹æ®éœ€æ±‚è¿›è¡Œåˆ‡å…¥ã€‚</p><p><code>spring-aspects</code>æ¨¡å—é›†æˆè‡ªAspectJæ¡†æ¶ï¼Œä¸»è¦æ˜¯ä¸ºSpringAOPæä¾›å¤šç§AOPå®ç°æ–¹æ³•ã€‚</p><p><code>spring-instrument</code>æ¨¡å—æ˜¯åŸºäºJAVASEä¸­çš„â€java.lang.instrumentâ€è¿›è¡Œè®¾è®¡çš„ï¼Œåº”è¯¥ç®—æ˜¯AOPçš„ä¸€ä¸ªæ”¯æ´æ¨¡å—ï¼Œä¸»è¦ä½œç”¨æ˜¯åœ¨JVMå¯ç”¨æ—¶ï¼Œç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ï¼Œç¨‹åºå‘˜é€šè¿‡ä»£ç†ç±»åœ¨è¿è¡Œæ—¶ä¿®æ”¹ç±»çš„å­—èŠ‚ï¼Œä»è€Œæ”¹å˜ä¸€ä¸ªç±»çš„åŠŸèƒ½ï¼Œå®ç°AOPçš„åŠŸèƒ½ã€‚åœ¨åˆ†ç±»é‡Œï¼Œæˆ‘æŠŠä»–åˆ†åœ¨äº†AOPæ¨¡å—ä¸‹ï¼Œåœ¨Springå®˜æ–¹æ–‡æ¡£é‡Œå¯¹è¿™ä¸ªåœ°æ–¹ä¹Ÿæœ‰ç‚¹å«ç³Šä¸æ¸…ï¼Œè¿™é‡Œæ˜¯çº¯ä¸ªäººè§‚ç‚¹ã€‚</p><p>3.æ•°æ®è®¿é—®åŠé›†æˆï¼šç”±<code>spring-jdbc</code>ã€<code>spring-tx</code>ã€<code>spring-orm</code>ã€<code>spring-jms</code>å’Œ<code>spring-oxm</code>5ä¸ªæ¨¡å—ç»„æˆã€‚</p><p><code>spring-jdbc</code>æ¨¡å—æ˜¯Springæä¾›çš„JDBCæŠ½è±¡æ¡†æ¶çš„ä¸»è¦å®ç°æ¨¡å—ï¼Œç”¨äºç®€åŒ–SpringJDBCã€‚ä¸»è¦æ˜¯æä¾›JDBCæ¨¡æ¿æ–¹å¼ã€å…³ç³»æ•°æ®åº“å¯¹è±¡åŒ–æ–¹å¼ã€SimpleJdbcæ–¹å¼ã€äº‹åŠ¡ç®¡ç†æ¥ç®€åŒ–JDBCç¼–ç¨‹ï¼Œä¸»è¦å®ç°ç±»æ˜¯JdbcTemplateã€SimpleJdbcTemplateä»¥åŠNamedParameterJdbcTemplateã€‚</p><p><code>spring-tx</code>æ¨¡å—æ˜¯SpringJDBCäº‹åŠ¡æ§åˆ¶å®ç°æ¨¡å—ã€‚ä½¿ç”¨Springæ¡†æ¶ï¼Œå®ƒå¯¹äº‹åŠ¡åšäº†å¾ˆå¥½çš„å°è£…ï¼Œé€šè¿‡å®ƒçš„AOPé…ç½®ï¼Œå¯ä»¥çµæ´»çš„é…ç½®åœ¨ä»»ä½•ä¸€å±‚ï¼›ä½†æ˜¯åœ¨å¾ˆå¤šçš„éœ€æ±‚å’Œåº”ç”¨ï¼Œç›´æ¥ä½¿ç”¨JDBCäº‹åŠ¡æ§åˆ¶è¿˜æ˜¯æœ‰å…¶ä¼˜åŠ¿çš„ã€‚å…¶å®ï¼Œäº‹åŠ¡æ˜¯ä»¥ä¸šåŠ¡é€»è¾‘ä¸ºåŸºç¡€çš„ï¼›ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡åº”è¯¥å¯¹åº”ä¸šåŠ¡å±‚é‡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼›å¦‚æœä¸šåŠ¡æ“ä½œå¤±è´¥ï¼Œåˆ™æ•´ä¸ªäº‹åŠ¡å›æ»šï¼›æ‰€ä»¥ï¼Œäº‹åŠ¡æ§åˆ¶æ˜¯ç»å¯¹åº”è¯¥æ”¾åœ¨ä¸šåŠ¡å±‚çš„ï¼›ä½†æ˜¯ï¼ŒæŒä¹…å±‚çš„è®¾è®¡åˆ™åº”è¯¥éµå¾ªä¸€ä¸ªå¾ˆé‡è¦çš„åŸåˆ™ï¼šä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œå³æŒä¹…å±‚é‡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½åº”è¯¥æ˜¯ä¸å¯ä»¥åˆ†å‰²çš„ã€‚æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨SpringJDBCäº‹åŠ¡æ§åˆ¶æ—¶ï¼Œåº”è¯¥æ³¨æ„å…¶ç‰¹æ®Šæ€§ã€‚</p><p><code>spring-orm</code>æ¨¡å—æ˜¯ORMæ¡†æ¶æ”¯æŒæ¨¡å—ï¼Œä¸»è¦é›†æˆHibernate,JavaPersistenceAPI(JPA)å’ŒJavaDataObjects(JDO)ç”¨äºèµ„æºç®¡ç†ã€æ•°æ®è®¿é—®å¯¹è±¡(DAO)çš„å®ç°å’Œäº‹åŠ¡ç­–ç•¥ã€‚</p><p><code>spring-jms</code>æ¨¡å—ï¼ˆJavaMessagingServiceï¼‰èƒ½å¤Ÿå‘é€å’Œæ¥å—ä¿¡æ¯ï¼Œè‡ªSpringFramework4.1ä»¥åï¼Œä»–è¿˜æä¾›äº†å¯¹spring-messagingæ¨¡å—çš„æ”¯æ’‘ã€‚</p><p><code>spring-oxm</code>æ¨¡å—ä¸»è¦æä¾›ä¸€ä¸ªæŠ½è±¡å±‚ä»¥æ”¯æ’‘OXMï¼ˆOXMæ˜¯Object-to-XML-Mappingçš„ç¼©å†™ï¼Œå®ƒæ˜¯ä¸€ä¸ªO/M-mapperï¼Œå°†javaå¯¹è±¡æ˜ å°„æˆXMLæ•°æ®ï¼Œæˆ–è€…å°†XMLæ•°æ®æ˜ å°„æˆjavaå¯¹è±¡ï¼‰ï¼Œä¾‹å¦‚ï¼šJAXB,Castor,XMLBeans,JiBXå’ŒXStreamç­‰ã€‚</p><p>4.Webï¼šç”±<code>spring-web</code>ã€<code>spring-webmvc</code>ã€<code>spring-websocket</code>å’Œ<code>spring-webflux</code>4ä¸ªæ¨¡å—ç»„æˆã€‚</p><p><code>spring-web</code>æ¨¡å—ä¸ºSpringæä¾›äº†æœ€åŸºç¡€Webæ”¯æŒï¼Œä¸»è¦å»ºç«‹äºæ ¸å¿ƒå®¹å™¨ä¹‹ä¸Šï¼Œé€šè¿‡Servletæˆ–è€…Listenersæ¥åˆå§‹åŒ–IOCå®¹å™¨ï¼Œä¹ŸåŒ…å«ä¸€äº›ä¸Webç›¸å…³çš„æ”¯æŒã€‚</p><p><code>spring-webmvc</code>æ¨¡å—ä¼—æ‰€å‘¨çŸ¥æ˜¯ä¸€ä¸ªçš„Web-Servletæ¨¡å—ï¼Œå®ç°äº†SpringMVCï¼ˆmodel-view-Controllerï¼‰çš„Webåº”ç”¨ã€‚</p><p><code>spring-websocket</code>æ¨¡å—ä¸»è¦æ˜¯ä¸Webå‰ç«¯çš„å…¨åŒå·¥é€šè®¯çš„åè®®ã€‚ï¼ˆèµ„æ–™ç¼ºä¹ï¼Œè¿™æ˜¯ä¸ªäººç†è§£ï¼‰</p><p><code>spring-webflux</code>æ˜¯ä¸€ä¸ªæ–°çš„éå µå¡å‡½æ•°å¼ReactiveWebæ¡†æ¶ï¼Œå¯ä»¥ç”¨æ¥å»ºç«‹å¼‚æ­¥çš„ï¼Œéé˜»å¡ï¼Œäº‹ä»¶é©±åŠ¨çš„æœåŠ¡ï¼Œå¹¶ä¸”æ‰©å±•æ€§éå¸¸å¥½ã€‚</p><p>5.æŠ¥æ–‡å‘é€ï¼šå³<code>spring-messaging</code>æ¨¡å—ã€‚</p><p><code>spring-messaging</code>æ˜¯ä»Spring4å¼€å§‹æ–°åŠ å…¥çš„ä¸€ä¸ªæ¨¡å—ï¼Œä¸»è¦èŒè´£æ˜¯ä¸ºSpringæ¡†æ¶é›†æˆä¸€äº›åŸºç¡€çš„æŠ¥æ–‡ä¼ é€åº”ç”¨ã€‚</p><p>6.Testï¼šå³<code>spring-test</code>æ¨¡å—ã€‚</p><p><code>spring-test</code>æ¨¡å—ä¸»è¦ä¸ºæµ‹è¯•æä¾›æ”¯æŒçš„ï¼Œæ¯•ç«Ÿåœ¨ä¸éœ€è¦å‘å¸ƒï¼ˆç¨‹åºï¼‰åˆ°ä½ çš„åº”ç”¨æœåŠ¡å™¨æˆ–è€…è¿æ¥åˆ°å…¶ä»–ä¼ä¸šè®¾æ–½çš„æƒ…å†µä¸‹èƒ½å¤Ÿæ‰§è¡Œä¸€äº›é›†æˆæµ‹è¯•æˆ–è€…å…¶ä»–æµ‹è¯•å¯¹äºä»»ä½•ä¼ä¸šéƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚</p><h3 id="Spirngå„æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»"><a href="#Spirngå„æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»" class="headerlink" title="Spirngå„æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»"></a>Spirngå„æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»</h3><p>è¯¥å›¾æ˜¯Spring5çš„åŒ…ç»“æ„ï¼Œå¯ä»¥ä»ä¸­æ¸…æ¥šçœ‹å‡ºSpringå„ä¸ªæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><p><img src="/2018/10/07/ä¸‡ç‰©åŸºäºSpring/3.jpg" alt="spring5"></p><h2 id="æœªå®Œå¾…ç»­"><a href="#æœªå®Œå¾…ç»­" class="headerlink" title="æœªå®Œå¾…ç»­"></a>æœªå®Œå¾…ç»­</h2><p>è¿™æ˜¯9æœˆä»½å†™çš„ï¼Œå¤§éƒ¨åˆ†æ˜¯å¤åˆ¶çš„ï¼Œå› ä¸ºé¢è¯•æ²¡æœ‰å†™å®Œï¼Œæ‰€ä»¥æœªå®Œå¾…ç»­å§ï¼</p><p>æ¥ä¸‹æ¥å’±ä»¬ä»‹ç»<code>Spring</code>çš„è¿™ä¸ªåšå®¢ï¼Œæ˜¯ä»spring-coreå¼€å§‹ï¼Œå…¶æ¬¡æ˜¯spring-beanså’Œspring-aopï¼Œéšåæ˜¯spring-contextï¼Œå†å…¶æ¬¡æ˜¯spring-txå’Œspring-ormï¼Œæœ€åæ˜¯spring-webå’Œå…¶ä»–éƒ¨åˆ†ã€‚</p><p>æ„Ÿè°¢è§‚çœ‹</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>å¤§éƒ¨åˆ†æ¥è‡ªå’•æ³¡å­¦é™¢TOMè€å¸ˆçš„ææ–™</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‰é¢æ–‡ç« æåˆ°äº†ï¼Œ&lt;code&gt;Springboot&lt;/code&gt;æ˜¯åŸºäºspringä¸ºåŸºç¡€æ‰©å±•å‡ºæ¥çš„ä¸€ä¸ªå¿«é€’æ¡†æ¶ã€‚æ·±å…¥ç†è§£&lt;code&gt;springboot&lt;/code&gt;å°±éœ€è¦ç†è§£&lt;code&gt;spring&lt;/code&gt;çš„ç›¸å…³åŸç†ã€‚æ‰€ä»¥æˆ‘ä»¬å°±å¼€å§‹å§ï¼&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="Spring" scheme="https://tengshe789.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>å¹¶å‘åŸºç¡€-ç¼“å­˜ã€å†…å­˜ä¸JVM</title>
    <link href="https://tengshe789.github.io/2018/09/30/Java%E4%B8%8E%E5%86%85%E5%AD%98/"/>
    <id>https://tengshe789.github.io/2018/09/30/Javaä¸å†…å­˜/</id>
    <published>2018-09-30T13:10:41.000Z</published>
    <updated>2019-11-20T13:39:40.575Z</updated>
    
    <content type="html"><![CDATA[<p>åˆæ˜¯ä¸€å¹´ç§‹æ‹›å­£ï¼Œå“å‘€å¦ˆå‘€æˆ‘è¢«è™çš„æƒ¨æ¥~è¿™ä¸ï¼Œå‰å‡ é˜µå¤±è¸ªæ²¡æ›´æ–°åšå®¢ï¼Œå…¶å®æ˜¯æˆ‘å·å·æŠŠæ—¶é—´ç”¨åœ¨å¤ä¹ è¯¾æœ¬äº†ï¼ˆé›¾</p><p>åšæŒåœ¨ç¤¾åŒºåˆ†äº«åšå®¢ä¹Ÿå¾ˆä¹…äº†ï¼Œç”±äºè¿‡å»çš„æ–‡ç« æœ‰å¾ˆå¤šç–æ¼ä¹‹å¤„ï¼Œå¾ˆå¤šå¤§ä½¬éƒ½åœ¨è¯„è®ºæŒ‡å‡ºæˆ‘çš„è¿‡é”™ï¼Œæˆ‘å¾ˆå¼€å¿ƒä¹Ÿå¾ˆå¤±æœ›ï¼Œå¼€å¿ƒçš„æ˜¯æœ‰å¤§å®¶å¸®æˆ‘æŒ‡å‡ºé”™è¯¯ï¼Œå¤±æœ›çš„é„™äººå­¦è¯†æµ…è–„æ€»æ²¡æ³•åšåˆ°å®Œç¾ã€‚æ€»ä¹‹ï¼Œæ¬¢è¿è¯„è®ºåŒºå„ç§pr~</p><p>å¥½ï¼Œå›åˆ°æ­£é¢˜ã€‚å¤ä¹ çš„æ—¶å€™ï¼Œæ— æ„é—´çœ‹åˆ°javaè™šæ‹Ÿæœºçš„æœ‰å…³çŸ¥è¯†ç‚¹ï¼Œæˆ‘äº§ç”Ÿäº†éå¸¸æµ“åšçš„å…´è¶£ï¼Œä»Šå¤©æˆ‘æ¥ç»“åˆ<strong>è®¡ç®—æœºå†…å­˜æ¨¡å‹</strong>çš„ç›¸å…³çŸ¥è¯†ï¼Œä¸<strong>Javaå†…å­˜æ¨¡å‹</strong>ã€<strong>Javaå¯¹è±¡æ¨¡å‹</strong>ã€<strong>JVMå†…å­˜ç»“æ„</strong>ç­‰ç›¸å…³çš„çŸ¥è¯†ä¸²è”èµ·æ¥ï¼Œæœ¬ç¯‡æ–‡ç« å…±1.5Wå­—ï¼Œåˆ†äº«ç»™å¤§å®¶ï¼Œæ„Ÿè°¢é˜…è¯»ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢<a href="https://blog.tengshe789.tech/ï¼ˆğŸ˜˜" target="_blank" rel="noopener">https://blog.tengshe789.tech/ï¼ˆğŸ˜˜</a></p><h2 id="è®¡ç®—æœºå†…å­˜"><a href="#è®¡ç®—æœºå†…å­˜" class="headerlink" title="è®¡ç®—æœºå†…å­˜"></a>è®¡ç®—æœºå†…å­˜</h2><p>ç›¸ä¿¡æ¯ä¸ªäººéƒ½æœ‰ä¸€å°ç”µè„‘ï¼Œä¹Ÿæœ‰diyç”µè„‘çš„ç»å†ã€‚ç°åœ¨ä¸€å°åŠŸèƒ½å¼ºå¤§çš„diyç”µè„‘å¤§æ¦‚3kå°±èƒ½ç»„è£…èµ·æ¥ï¼Œä¸€ä¸ªi5-8400 çš„cpu 869å…ƒï¼ŒDDR4 å†…å­˜ 1200å—é’±ï¼Œb360ä¸»æ¿300å…ƒ æ•£çƒ­å™¨50å…ƒ æœºæ¢°ç¡¬ç›˜200å…ƒ 350wç”µæº300å…ƒ æœºç®±100å…ƒ ï¼Œæ²¡é”™ï¼Œåªè¦3kå°±èƒ½æ‹¿åˆ°ä¸€ä¸ªæ€§èƒ½å¼ºå¤§çš„6C6Tç”µè„‘ã€‚</p><p>è¦è¯´ä¸€å°PCä¸­æœ€é‡è¦çš„éƒ¨ä»¶æ˜¯ä»€ä¹ˆï¼Ÿå¤§å®¶çœ‹ä»·æ ¼ä¹Ÿä¼šçœ‹æ˜ç™½ï¼Œæ˜¯cpuå’Œå†…å­˜ï¼Œä¸‹é¢æˆ‘æ¥ä»‹ç»ä¸€ä¸‹cpuå’Œå†…å­˜ä¹‹é—´çš„å…³ç³»ã€‚</p><h3 id="cpuä¸å†…å­˜ç¼“å­˜çš„åƒä¸ä¸‡ç¼•"><a href="#cpuä¸å†…å­˜ç¼“å­˜çš„åƒä¸ä¸‡ç¼•" class="headerlink" title="cpuä¸å†…å­˜ç¼“å­˜çš„åƒä¸ä¸‡ç¼•"></a>cpuä¸å†…å­˜ç¼“å­˜çš„åƒä¸ä¸‡ç¼•</h3><h4 id="cpuç›¸å…³æœ¯è¯­"><a href="#cpuç›¸å…³æœ¯è¯­" class="headerlink" title="cpuç›¸å…³æœ¯è¯­"></a>cpuç›¸å…³æœ¯è¯­</h4><p>é¦–å…ˆè¯´æ˜ä¸€ä¸‹ç›¸å…³çš„cpuæœ¯è¯­ï¼š</p><ul><li>socketï¼šcpuæ’åœ¨ä¸»æ¿ä¸Šé‚£ä¸ªæ§½ä¸cpuç§°ä½œä¸€ä¸ªsocketã€‚</li><li>Dieï¼šæ ¸å¿ƒï¼ˆDieï¼‰åˆç§°ä¸ºå†…æ ¸ï¼Œæ˜¯cpuçš„ç‰©ç†ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚cpuä¹Ÿä¼šåˆ†ä¸ºå¤šdie cpuä¸å•die cpuï¼Œè­¬å¦‚æˆ‘ä»¬ç°åœ¨å¼ºå¤§çš„AMD TR-2990WXå°±æ˜¯4die cpuï¼Œæ¯ä¸ªdieé‡Œé¢æœ‰8ä¸ªæ ¸å¿ƒï¼ˆcoreï¼‰</li><li>coreï¼šä¹Ÿå°±æ˜¯ç‰©ç†æ ¸å¿ƒäº†ã€‚coreè¿™ä¸ªè¯æ˜¯è‹±ç‰¹å°”èµ·çš„ï¼Œèµ·åˆæ˜¯ä¸ºäº†ä¸ç«äº‰å¯¹æ‰‹AMDåŒºåˆ«å¼€ï¼Œåé¢ç”¨çš„å¤šäº†ä¹Ÿæ·¡äº†ã€‚</li><li>threadï¼šå°±æ˜¯ç¡¬ä»¶çº¿ç¨‹æ•°ã€‚ä¸€ä¸ªç¨‹åºæ‰§è¡Œå¯èƒ½éœ€è¦å¤šä¸ªçº¿ç¨‹ä¸€èµ·è¿›è¡Œ~è€Œç°åœ¨ä¹Ÿå°±æ¯”è¾ƒå¼ºå¤§çš„è¶…çº¿ç¨‹æŠ€æœ¯ï¼Œè¿‡å»çš„cpuå¾€å¾€ä¸€ä¸ªcpuæ ¸å¿ƒåªæ”¯æŒä¸€ä¸ªçº¿ç¨‹ï¼Œç°åœ¨ä¸€äº›å¼ºå¤§çš„cpuä¸­ï¼Œå°±è­¬å¦‚IBM çš„POWER 9 ï¼Œæ”¯æŒ8æ ¸å¿ƒ32ä¸ªçº¿ç¨‹ï¼ˆå¹³å‡ä¸€ä¸ªæ ¸å¿ƒ4ä¸ªçº¿ç¨‹ï¼‰ï¼Œç†è®ºæ€§èƒ½éå¸¸å¼ºå¤§ã€‚</li></ul><p>æ€»ç»“ä¸€ä¸‹ï¼Œä»¥æ˜æ˜Ÿcpu AMD TR-2990WXä½œä¸ºæ —å­ï¼Œè¿™ä¸ªcpuä½¿ç”¨ä¸€ä¸ªsocketï¼Œä¸€ä¸ªsocketé‡Œé¢æœ‰4ä¸ªdieï¼Œæ€»å…±32ä¸ªç‰©ç†æ ¸å¿ƒ64ä¸ªçº¿ç¨‹</p><h4 id="cpuç¼“å­˜"><a href="#cpuç¼“å­˜" class="headerlink" title="cpuç¼“å­˜"></a>cpuç¼“å­˜</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œcpuå°†è¦å¤„ç†çš„æ•°æ®ä¼šæ”¾åˆ°å†…å­˜ä¸­ä¿å­˜ï¼Œå¯æ˜¯ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œå°†å†…å­˜ç¼“å­˜ç¡¬ç›˜è¡Œä¸è¡Œå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆå½“ç„¶æ˜¯ä¸è¡Œçš„ã€‚cpuçš„å¤„ç†é€Ÿåº¦å¾ˆå¼ºå¤§ï¼Œå†…å­˜çš„é€Ÿåº¦è™½ç„¶éå¸¸å¿«é€Ÿä½†æ˜¯æ ¹æœ¬è·Ÿä¸ä¸Šcpuçš„æ­¥ä¼ï¼Œæ‰€ä»¥ï¼Œå°±å‡ºç°çš„ç¼“å­˜ã€‚ä¸æ¥è‡ªDRAMå®¶æ—çš„å†…å­˜ä¸åŒï¼Œç¼“å­˜SRAMä¸å†…å­˜æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ï¼Œç‰¹åˆ«å¿«ï¼Œå®¹é‡å°ï¼Œç»“æ„å¤æ‚ï¼Œæˆæœ¬ä¹Ÿé«˜ã€‚</p><p>é€ æˆå†…å­˜å’Œç¼“å­˜æ€§èƒ½å·®å¼‚ï¼Œä¸»è¦æœ‰ä»¥ä¸‹åŸå› ï¼š</p><ol><li>DRAMå‚¨å­˜ä¸€ä½æ•°æ®åªéœ€è¦ä¸€ä¸ªç”µå®¹åŠ ä¸Šä¸€ä¸ªæ™¶ä½“ç®¡ï¼Œè€ŒSRAMéœ€è¦6ä¸ªæ™¶ä½“ç®¡ã€‚ç”±äºDRAMä¿å­˜æ•°æ®å…¶å®æ˜¯åœ¨ç”µå®¹é‡Œé¢çš„ï¼Œç”µå®¹éœ€è¦å……æ”¾ç”µæ‰èƒ½è¿›è¡Œè¯»å†™æ“ä½œï¼Œè¿™å°±å¯¼è‡´å…¶è¯»å†™æ•°æ®å°±æœ‰æ¯”è¾ƒå¤§çš„å»¶è¿Ÿé—®é¢˜ã€‚</li><li>å­˜å‚¨å¯ä»¥çœ‹é”™ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ¯ä¸ªå­˜å‚¨å•å…ƒéƒ½æœ‰å…¶è¡Œåœ°å€åˆ—åœ°å€ã€‚SRAMçš„å®¹é‡å¾ˆå°ï¼Œå…¶å­˜å‚¨å•å…ƒæ¯”è¾ƒçŸ­ï¼ˆè¡Œåˆ—çŸ­ï¼‰ï¼Œå¯ä»¥ä¸€æ¬¡æ€§ä¼ è¾“åˆ°SRAMä¸­ï¼›è€ŒDRAMï¼Œéœ€è¦åˆ†åˆ«ä¼ é€è¡Œåˆ—åœ°å€ã€‚</li><li>SRAMçš„é¢‘ç‡å’Œcpué¢‘ç‡æ¯”è¾ƒæ¥è¿‘ï¼›è€ŒDRAMçš„é¢‘ç‡å’Œcpuå·®è·æ¯”è¾ƒå¤§ã€‚    </li></ol><p>è¿‘ä»£çš„ç¼“å­˜é€šå¸¸è¢«é›†æˆåˆ°cpuå½“ä¸­ï¼Œä¸ºäº†é€‚åº”æ€§èƒ½ä¸æˆæœ¬çš„éœ€è¦ï¼Œç°å®ä¸­çš„ç¼“å­˜å¾€å¾€ä½¿ç”¨é‡‘å­—å¡”å‹å¤šçº§ç¼“å­˜æ¶æ„ã€‚ä¹Ÿå°±æ˜¯<strong>å½“CPUè¦è¯»å–ä¸€ä¸ªæ•°æ®æ—¶ï¼Œé¦–å…ˆä»ä¸€çº§ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å†ä»äºŒçº§ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰å°±ä»ä¸‰çº§ç¼“å­˜æˆ–å†…å­˜ä¸­æŸ¥æ‰¾ã€‚</strong></p><p>ä¸‹é¢æ˜¯è‹±ç‰¹å°”æœ€è¿‘ä»¥æ¥ç”¨çš„åˆä»£skylakeæ¶æ„</p><p><img src="/2018/09/30/Javaä¸å†…å­˜/1.png" alt="sklæ¶æ„"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªä¸ªæ ¸å¿ƒæœ‰ä¸“å±çš„L1ï¼ŒL2ç¼“å­˜ï¼Œä»–ä»¬å…±äº«ä¸€ä¸ªL3ç¼“å­˜ã€‚å¦‚æœcpuå¦‚æœè¦è®¿é—®å†…å­˜ä¸­çš„æ•°æ®ï¼Œå¿…é¡»è¦ç»è¿‡L1,L2,L3,LLCï¼ˆæˆ–è€…L4ï¼‰å››å±‚ç¼“å­˜ã€‚</p><h3 id="ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜"><a href="#ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜"></a>ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</h3><p>æœ€å¼€å§‹çš„cpuï¼Œå…¶å®åªæ˜¯ä¸€ä¸ªæ ¸å¿ƒä¸€ä¸ªçº¿ç¨‹çš„ï¼Œå½“æ—¶æ ¹æœ¬ä¸éœ€è¦è€ƒè™‘ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Œ<strong>å•çº¿ç¨‹</strong>ï¼Œä¹Ÿå°±æ˜¯cpuæ ¸å¿ƒçš„ç¼“å­˜åªè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚ç¼“å­˜ç‹¬å ï¼Œä¸ä¼šå‡ºç°è®¿é—®å†²çªç­‰é—®é¢˜ã€‚</p><p>åæ¥è¶…çº¿ç¨‹æŠ€æœ¯æ¥åˆ°æˆ‘ä»¬è§†é‡ï¼Œ<strong>â€˜â€™å•æ ¸CPUå¤šçº¿ç¨‹â€™â€™</strong>ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¼šåŒæ—¶è®¿é—®è¿›ç¨‹ä¸­çš„å…±äº«æ•°æ®ï¼ŒCPUå°†æŸå—å†…å­˜åŠ è½½åˆ°ç¼“å­˜åï¼Œä¸åŒçº¿ç¨‹åœ¨è®¿é—®ç›¸åŒçš„ç‰©ç†åœ°å€çš„æ—¶å€™ï¼Œéƒ½ä¼šæ˜ å°„åˆ°ç›¸åŒçš„ç¼“å­˜ä½ç½®ï¼Œè¿™æ ·å³ä½¿å‘ç”Ÿçº¿ç¨‹çš„åˆ‡æ¢ï¼Œç¼“å­˜ä»ç„¶ä¸ä¼šå¤±æ•ˆã€‚ä½†ç”±äºä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œå› æ­¤ä¸ä¼šå‡ºç°ç¼“å­˜è®¿é—®å†²çªã€‚</p><p>æ—¶ä»£ä¸æ–­å‘å±•ï¼Œ<strong>â€œå¤šæ ¸CPUå¤šçº¿ç¨‹â€</strong>æ¥äº†ï¼Œå³å¤šä¸ªçº¿ç¨‹è®¿é—®è¿›ç¨‹ä¸­çš„æŸä¸ªå…±äº«å†…å­˜ï¼Œä¸”è¿™å¤šä¸ªçº¿ç¨‹åˆ†åˆ«åœ¨ä¸åŒçš„æ ¸å¿ƒä¸Šæ‰§è¡Œï¼Œåˆ™æ¯ä¸ªæ ¸å¿ƒéƒ½ä¼šåœ¨å„è‡ªçš„caeheä¸­ä¿ç•™ä¸€ä»½å…±äº«å†…å­˜çš„ç¼“å†²ã€‚ç”±äºå¤šæ ¸æ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼Œå¯èƒ½ä¼šå‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™å„è‡ªçš„ç¼“å­˜çš„æƒ…å†µï¼Œè€Œå„è‡ªçš„cacheä¹‹é—´çš„æ•°æ®å°±æœ‰å¯èƒ½ä¸åŒã€‚</p><p>è¿™å°±æ˜¯æˆ‘ä»¬è¯´çš„<strong>ç¼“å­˜ä¸€è‡´æ€§</strong>é—®é¢˜ã€‚</p><p>ç›®å‰å…¬è®¤æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯è‹±ç‰¹å°”çš„<strong>MESIåè®®</strong>ï¼Œä¸‹é¢æˆ‘ä»¬ç€é‡ä»‹ç»ã€‚</p><h4 id="MESIåè®®"><a href="#MESIåè®®" class="headerlink" title="MESIåè®®"></a>MESIåè®®</h4><p>é¦–å…ˆè¯´è¯´I/Oæ“ä½œçš„å•ä½é—®é¢˜ï¼Œå¤§éƒ¨åˆ†äººéƒ½çŸ¥é“ï¼Œåœ¨å†…å­˜ä¸­æ“ä½œI/Oä¸æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œè€Œæ˜¯ä»¥â€œå—â€ä¸ºå•ä½ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å…¶å®è¿™æ˜¯å› ä¸ºI/Oæ“ä½œçš„æ•°æ®è®¿é—®æœ‰ç©ºé—´è¿ç»­æ€§ç‰¹å¾ï¼Œå³éœ€è¦è®¿é—®å†…å­˜ç©ºé—´å¾ˆå¤šæ•°æ®ï¼Œä½†æ˜¯I/Oæ“ä½œæ¯”è¾ƒæ…¢ï¼Œè¯»ä¸€ä¸ªå­—èŠ‚å’Œè¯»Nä¸ªå­—èŠ‚çš„æ—¶é—´åŸºæœ¬ç›¸åŒã€‚</p><p>æœºæ™ºçš„intelå°±è§„å®šäº†ï¼Œcpuç¼“å­˜ä¸­æœ€å°çš„å­˜å‚¨å•å…ƒæ˜¯<strong>ç¼“å­˜è¡Œ</strong><code>cache line</code>ï¼Œåœ¨x86çš„cpuä¸­ï¼Œä¸€ä¸ª<code>cache line</code>å‚¨å­˜64å­—èŠ‚ï¼Œæ¯ä¸€çº§çš„ç¼“å­˜éƒ½ä¼šè¢«åˆ’åˆ†æˆè®¸å¤šç»„<code>cache line</code>ã€‚</p><p>ç¼“å­˜å·¥ä½œåŸç†è¯·çœ‹ğŸ‘‰<a href="https://en.wikipedia.org/wiki/CPU_cache" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹MESIè§„èŒƒï¼Œè¿™å…¶å®æ˜¯ç”¨å››ç§ç¼“å­˜è¡ŒçŠ¶æ€å‘½åçš„ï¼Œæˆ‘ä»¬å®šä¹‰äº†CPUä¸­æ¯ä¸ªç¼“å­˜è¡Œä½¿ç”¨4ç§çŠ¶æ€è¿›è¡Œæ ‡è®°ï¼ˆä½¿ç”¨é¢å¤–çš„ä¸¤ä½(bit)è¡¨ç¤º)ï¼Œåˆ†åˆ«æ˜¯:</p><ul><li><p><strong>M: è¢«ä¿®æ”¹ï¼ˆModified)</strong></p><p>è¯¥ç¼“å­˜è¡Œåªè¢«ç¼“å­˜åœ¨è¯¥CPUçš„ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”æ˜¯è¢«ä¿®æ”¹è¿‡çš„ï¼ˆdirty),å³ä¸ä¸»å­˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè¯¥ç¼“å­˜è¡Œä¸­çš„å†…å­˜éœ€è¦åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹ï¼ˆå…è®¸å…¶å®ƒCPUè¯»å–è¯·ä¸»å­˜ä¸­ç›¸åº”å†…å­˜ä¹‹å‰ï¼‰å†™å›ï¼ˆwrite backï¼‰ä¸»å­˜ã€‚å½“è¢«å†™å›ä¸»å­˜ä¹‹åï¼Œè¯¥ç¼“å­˜è¡Œçš„çŠ¶æ€ä¼šå˜æˆç‹¬äº«ï¼ˆexclusive)çŠ¶æ€ã€‚</p></li><li><p><strong>E: ç‹¬äº«çš„ï¼ˆExclusive)</strong></p><p>è¯¥ç¼“å­˜è¡Œåªè¢«ç¼“å­˜åœ¨è¯¥CPUçš„ç¼“å­˜ä¸­ï¼Œå®ƒæ˜¯æœªè¢«ä¿®æ”¹è¿‡çš„ï¼ˆclean)ï¼Œä¸ä¸»å­˜ä¸­æ•°æ®ä¸€è‡´ã€‚è¯¥çŠ¶æ€å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»å½“æœ‰å…¶å®ƒCPUè¯»å–è¯¥å†…å­˜æ—¶å˜æˆå…±äº«çŠ¶æ€ï¼ˆshared)ã€‚åŒæ ·åœ°ï¼Œå½“CPUä¿®æ”¹è¯¥ç¼“å­˜è¡Œä¸­å†…å®¹æ—¶ï¼Œè¯¥çŠ¶æ€å¯ä»¥å˜æˆModifiedçŠ¶æ€ã€‚</p></li><li><p><strong>S:  å…±äº«çš„ï¼ˆShared)</strong></p><p>è¯¥çŠ¶æ€æ„å‘³ç€è¯¥ç¼“å­˜è¡Œå¯èƒ½è¢«å¤šä¸ªCPUç¼“å­˜ï¼Œå¹¶ä¸”å„ä¸ªç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸»å­˜æ•°æ®ä¸€è‡´ï¼ˆclean)ï¼Œå½“æœ‰ä¸€ä¸ªCPUä¿®æ”¹è¯¥ç¼“å­˜è¡Œä¸­ï¼Œå…¶å®ƒCPUä¸­è¯¥ç¼“å­˜è¡Œå¯ä»¥è¢«ä½œåºŸï¼ˆå˜æˆæ— æ•ˆçŠ¶æ€ï¼ˆInvalidï¼‰ï¼‰ã€‚</p></li><li><p><strong>I: æ— æ•ˆçš„ï¼ˆInvalidï¼‰</strong></p><p>è¯¥ç¼“å­˜æ˜¯æ— æ•ˆçš„ï¼ˆå¯èƒ½æœ‰å…¶å®ƒCPUä¿®æ”¹äº†è¯¥ç¼“å­˜è¡Œï¼‰ã€‚</p></li></ul><p><img src="/2018/09/30/Javaä¸å†…å­˜/2.png" alt="mesi"></p><p>ç„¶è€Œï¼Œåªæ˜¯æœ‰è¿™å››ç§çŠ¶æ€ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„é—®é¢˜ã€‚ä¸‹é¢å¼•ç”¨ä¸€ä¸‹oracleçš„<a href="https://docs.oracle.com/cd/E19205-01/821-0393/aewcx/index.html" target="_blank" rel="noopener">æ–‡æ¡£</a>ã€‚</p><blockquote><p>åŒæ—¶æ›´æ–°æ¥è‡ªä¸åŒå¤„ç†å™¨çš„ç›¸åŒç¼“å­˜ä»£ç è¡Œä¸­çš„å•ä¸ªå…ƒç´ ä¼šä½¿æ•´ä¸ªç¼“å­˜ä»£ç è¡Œæ— æ•ˆï¼Œå³ä½¿è¿™äº›æ›´æ–°åœ¨é€»è¾‘ä¸Šæ˜¯å½¼æ­¤ç‹¬ç«‹çš„ã€‚æ¯æ¬¡å¯¹ç¼“å­˜ä»£ç è¡Œçš„å•ä¸ªå…ƒç´ è¿›è¡Œæ›´æ–°æ—¶ï¼Œéƒ½ä¼šå°†æ­¤ä»£ç è¡Œæ ‡è®°ä¸º<strong>æ— æ•ˆ</strong>ã€‚å…¶ä»–è®¿é—®åŒä¸€ä»£ç è¡Œä¸­ä¸åŒå…ƒç´ çš„å¤„ç†å™¨å°†çœ‹åˆ°è¯¥ä»£ç è¡Œå·²æ ‡è®°ä¸º<strong>æ— æ•ˆ</strong>ã€‚å³ä½¿æ‰€è®¿é—®çš„å…ƒç´ æœªè¢«ä¿®æ”¹ï¼Œä¹Ÿä¼šå¼ºåˆ¶å®ƒä»¬ä»å†…å­˜æˆ–å…¶ä»–ä½ç½®è·å–è¯¥ä»£ç è¡Œçš„è¾ƒæ–°å‰¯æœ¬ã€‚è¿™æ˜¯å› ä¸ºåŸºäºç¼“å­˜ä»£ç è¡Œä¿æŒç¼“å­˜ä¸€è‡´æ€§ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å•ä¸ªå…ƒç´ çš„ã€‚å› æ­¤ï¼Œäº’è¿é€šä¿¡å’Œå¼€é”€æ–¹é¢éƒ½å°†æœ‰æ‰€å¢é•¿ã€‚å¹¶ä¸”ï¼Œæ­£åœ¨è¿›è¡Œç¼“å­˜ä»£ç è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œç¦æ­¢è®¿é—®è¯¥ä»£ç è¡Œä¸­çš„å…ƒç´ ã€‚</p></blockquote><p><strong>MESIåè®®ï¼Œå¯ä»¥ä¿è¯ç¼“å­˜çš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯æ— æ³•ä¿è¯å®æ—¶æ€§ã€‚</strong>è¿™ç§æƒ…å†µç§°ä¸º<strong>ä¼ªå…±äº«</strong>ã€‚</p><h4 id="ä¼ªå…±äº«é—®é¢˜"><a href="#ä¼ªå…±äº«é—®é¢˜" class="headerlink" title="ä¼ªå…±äº«é—®é¢˜"></a>ä¼ªå…±äº«é—®é¢˜</h4><p>ä¼ªå…±äº«é—®é¢˜å…¶å®åœ¨Javaä¸­æ˜¯çœŸå®å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜ã€‚å‡è®¾æœ‰å¦‚ä¸‹æ‰€ç¤ºçš„java class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyObiect</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> a;</span><br><span class="line">    <span class="keyword">long</span> b;</span><br><span class="line">    <span class="keyword">long</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§javaè§„èŒƒï¼ŒMyObiectå¯¹è±¡æ˜¯åœ¨å †ç©ºé—´ä¸­åˆ†é…çš„ï¼Œaã€bã€cè¿™ä¸‰ä¸ªå˜é‡åœ¨å†…å­˜ç©ºé—´ä¸­æ˜¯è¿‘é‚»ï¼Œåˆ†åˆ«å 8å­—èŠ‚ï¼Œé•¿åº¦ä¹‹å’Œä¸º24å­—èŠ‚ã€‚è€Œæˆ‘ä»¬çš„x86çš„ç¼“å­˜è¡Œæ˜¯64å­—èŠ‚ï¼Œè¿™ä¸‰ä¸ªå˜é‡å®Œå…¨æœ‰å¯èƒ½ä¼šåœ¨ä¸€ä¸ªç¼“å­˜è¡Œä¸­ï¼Œå¹¶ä¸”è¢«ä¸¤ä¸ªä¸åŒçš„cpuæ ¸å¿ƒå…±äº«ï¼</p><p>æ ¹æ®MESIåè®®ï¼Œå¦‚æœä¸åŒç‰©ç†æ ¸å¿ƒcpuä¸­çš„çº¿ç¨‹1å’Œçº¿ç¨‹2è¦äº’æ–¥çš„å¯¹è¿™å‡ ä¸ªå˜é‡è¿›è¡Œæ“ä½œï¼Œå¾ˆæœ‰å¯èƒ½è¦äº’ç›¸æŠ¢å èµ„æºï¼Œå¯¼è‡´åŸæ¥çš„å¹¶è¡Œå˜æˆä¸²è¡Œï¼Œå¤§å¤§é™ä½äº†ç³»ç»Ÿçš„å¹¶å‘æ€§ï¼Œè¿™å°±æ˜¯ç¼“å­˜çš„ä¼ªå…±äº«ã€‚</p><h4 id="è§£å†³ä¼ªå…±äº«"><a href="#è§£å†³ä¼ªå…±äº«" class="headerlink" title="è§£å†³ä¼ªå…±äº«"></a>è§£å†³ä¼ªå…±äº«</h4><p>å…¶å®è§£å†³ä¼ªå…±äº«å¾ˆç®€å•ï¼Œåªéœ€è¦å°†è¿™å‡ ä¸ªå˜é‡åˆ†åˆ«æ”¾åˆ°ä¸åŒçš„ç¼“å­˜è¡Œå³å¯ã€‚åœ¨java8ä¸­ï¼Œå°±å·²ç»æä¾›äº†æ™®é€‚æ€§çš„è§£å†³æ–¹æ¡ˆï¼Œå³é‡‡ç”¨<code>@Contended</code>æ³¨è§£æ¥ä¿è¯å¯¹è±¡ä¸­çš„å˜é‡æˆ–è€…å±æ€§ä¸åœ¨ä¸€ä¸ªç¼“å­˜è¡Œä¸­~</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Contended</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VolatileObiect</span></span>&#123;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">long</span> a = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">long</span> b = <span class="number">2L</span>;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">long</span> c = <span class="number">3L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…å­˜ä¸ä¸€è‡´æ€§é—®é¢˜"><a href="#å†…å­˜ä¸ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="å†…å­˜ä¸ä¸€è‡´æ€§é—®é¢˜"></a>å†…å­˜ä¸ä¸€è‡´æ€§é—®é¢˜</h3><p>ä¸Šé¢æˆ‘è¯´äº†MESIåè®®åœ¨å¤šæ ¸å¿ƒcpuä¸­è§£å†³ç¼“å­˜ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œä¸‹é¢æˆ‘ä»¬è¯´è¯´cpuçš„å†…å­˜ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚</p><h4 id="ä¸‰ç§cpuæ¶æ„"><a href="#ä¸‰ç§cpuæ¶æ„" class="headerlink" title="ä¸‰ç§cpuæ¶æ„"></a>ä¸‰ç§cpuæ¶æ„</h4><p>é¦–å…ˆï¼Œè¦äº†è§£ä¸‰ä¸ªåè¯ï¼š</p><ul><li>SMP(Symmetric Multi-Processor)</li></ul><blockquote><p>SMP ,å¯¹ç§°å¤šå¤„ç†ç³»ç»Ÿå†…æœ‰è®¸å¤šç´§è€¦åˆå¤šå¤„ç†å™¨ï¼Œåœ¨è¿™æ ·çš„ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰çš„CPUå…±äº«å…¨éƒ¨èµ„æºï¼Œå¦‚æ€»çº¿ï¼Œå†…å­˜å’ŒI/Oç³»ç»Ÿç­‰ï¼Œæ“ä½œç³»ç»Ÿæˆ–ç®¡ç†æ•°æ®åº“çš„å¤æœ¬åªæœ‰ä¸€ä¸ªï¼Œè¿™ç§ç³»ç»Ÿæœ‰ä¸€ä¸ªæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å…±äº«æ‰€æœ‰èµ„æºã€‚å¤šä¸ªCPUä¹‹é—´æ²¡æœ‰åŒºåˆ«ï¼Œå¹³ç­‰åœ°è®¿é—®å†…å­˜ã€å¤–è®¾ã€ä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚æ“ä½œç³»ç»Ÿç®¡ç†ç€ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªå¤„ç†å™¨ä¾æ¬¡å¤„ç†é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ã€‚å¦‚æœä¸¤ä¸ªå¤„ç†å™¨åŒæ—¶è¯·æ±‚è®¿é—®ä¸€ä¸ªèµ„æºï¼ˆä¾‹å¦‚åŒä¸€æ®µå†…å­˜åœ°å€ï¼‰ï¼Œç”±ç¡¬ä»¶ã€è½¯ä»¶çš„é”æœºåˆ¶å»è§£å†³èµ„æºäº‰ç”¨é—®é¢˜ã€‚</p></blockquote><p><a href="https://gooqia.bay.livefilestore.com/y1mTR45b2QQBvMknXoy3T6RC7QW_bimMfEFsHvninuE5BlQRc5CpJu-XhG5EM0L20gGCUUYgBbYMkpvckoz7whBhXF8bXDRyyux_cspQ4Z_CgHpDB_86XN_zt6QwLXFH3xhgy1_OF1jz5k/smp%5b2%5d.gif" target="_blank" rel="noopener"><img src="/2018/09/30/Javaä¸å†…å­˜/clip_image001_d7728dc2-e525-4e5b-b84c-6f5a7f4de300.gif" alt="clip_image001"></a></p><blockquote><p>æ‰€è°“å¯¹ç§°å¤šå¤„ç†å™¨ç»“æ„ï¼Œæ˜¯æŒ‡æœåŠ¡å™¨ä¸­å¤šä¸ª CPU å¯¹ç§°å·¥ä½œï¼Œæ— ä¸»æ¬¡æˆ–ä»å±å…³ç³»ã€‚å„ CPU å…±äº«ç›¸åŒçš„ç‰©ç†å†…å­˜ï¼Œæ¯ä¸ª CPU è®¿é—®å†…å­˜ä¸­çš„ä»»ä½•åœ°å€æ‰€éœ€æ—¶é—´æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤ SMP ä¹Ÿè¢«ç§°ä¸ºä¸€è‡´å­˜å‚¨å™¨è®¿é—®ç»“æ„ (UMA ï¼š Uniform Memory Access) ã€‚å¯¹ SMP æœåŠ¡å™¨è¿›è¡Œæ‰©å±•çš„æ–¹å¼åŒ…æ‹¬å¢åŠ å†…å­˜ã€ä½¿ç”¨æ›´å¿«çš„ CPU ã€å¢åŠ  CPU ã€æ‰©å…… I/O( æ§½å£æ•°ä¸æ€»çº¿æ•° ) ä»¥åŠæ·»åŠ æ›´å¤šçš„å¤–éƒ¨è®¾å¤‡ ( é€šå¸¸æ˜¯ç£ç›˜å­˜å‚¨ ) ã€‚</p><p>SMP æœåŠ¡å™¨çš„ä¸»è¦ç‰¹å¾æ˜¯å…±äº«ï¼Œç³»ç»Ÿä¸­æ‰€æœ‰èµ„æº (CPU ã€å†…å­˜ã€ I/O ç­‰ ) éƒ½æ˜¯å…±äº«çš„ã€‚ä¹Ÿæ­£æ˜¯ç”±äºè¿™ç§ç‰¹å¾ï¼Œå¯¼è‡´äº† SMP æœåŠ¡å™¨çš„ä¸»è¦é—®é¢˜ï¼Œé‚£å°±æ˜¯å®ƒçš„æ‰©å±•èƒ½åŠ›éå¸¸æœ‰é™ã€‚å¯¹äº SMP æœåŠ¡å™¨è€Œè¨€ï¼Œæ¯ä¸€ä¸ªå…±äº«çš„ç¯èŠ‚éƒ½å¯èƒ½é€ æˆ SMP æœåŠ¡å™¨æ‰©å±•æ—¶çš„ç“¶é¢ˆï¼Œè€Œæœ€å—é™åˆ¶çš„åˆ™æ˜¯å†…å­˜ã€‚ç”±äºæ¯ä¸ª CPU å¿…é¡»é€šè¿‡ç›¸åŒçš„å†…å­˜æ€»çº¿è®¿é—®ç›¸åŒçš„å†…å­˜èµ„æºï¼Œå› æ­¤éšç€ CPU æ•°é‡çš„å¢åŠ ï¼Œå†…å­˜è®¿é—®å†²çªå°†è¿…é€Ÿå¢åŠ ï¼Œæœ€ç»ˆä¼šé€ æˆ CPU èµ„æºçš„æµªè´¹ï¼Œä½¿ CPU æ€§èƒ½çš„æœ‰æ•ˆæ€§å¤§å¤§é™ä½ã€‚å®éªŒè¯æ˜ï¼Œ SMP æœåŠ¡å™¨ CPU åˆ©ç”¨ç‡æœ€å¥½çš„æƒ…å†µæ˜¯ 2 è‡³ 4 ä¸ª CPU ã€‚</p></blockquote><p><a href="http://images.cnblogs.com/cnblogs_com/yubo/WindowsLiveWriter/SMPNUMAMPP_F6D4/clip_image002_2.gif" target="_blank" rel="noopener"><img src="/2018/09/30/Javaä¸å†…å­˜/clip_image002_thumb.gif" alt="clip_image002"></a></p><ul><li>NUMA(Non-Uniform Memory Access)</li></ul><blockquote><p>ã€€ã€€ç”±äº SMP åœ¨æ‰©å±•èƒ½åŠ›ä¸Šçš„é™åˆ¶ï¼Œäººä»¬å¼€å§‹æ¢ç©¶å¦‚ä½•è¿›è¡Œæœ‰æ•ˆåœ°æ‰©å±•ä»è€Œæ„å»ºå¤§å‹ç³»ç»Ÿçš„æŠ€æœ¯ï¼Œ NUMA å°±æ˜¯è¿™ç§åŠªåŠ›ä¸‹çš„ç»“æœä¹‹ä¸€ã€‚åˆ©ç”¨ NUMA æŠ€æœ¯ï¼Œå¯ä»¥æŠŠå‡ åä¸ª CPU( ç”šè‡³ä¸Šç™¾ä¸ª CPU) ç»„åˆåœ¨ä¸€ä¸ªæœåŠ¡å™¨å†…ã€‚å…¶NUMA æœåŠ¡å™¨ CPU æ¨¡å—ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š</p></blockquote><p><a href="http://images.cnblogs.com/cnblogs_com/yubo/WindowsLiveWriter/SMPNUMAMPP_F6D4/clip_image003_2.gif" target="_blank" rel="noopener"><img src="/2018/09/30/Javaä¸å†…å­˜/clip_image003_thumb.gif" alt="clip_image003"></a></p><blockquote><p>NUMA æœåŠ¡å™¨çš„åŸºæœ¬ç‰¹å¾æ˜¯å…·æœ‰å¤šä¸ª CPU æ¨¡å—ï¼Œæ¯ä¸ª CPU æ¨¡å—ç”±å¤šä¸ª CPU( å¦‚ 4 ä¸ª ) ç»„æˆï¼Œå¹¶ä¸”å…·æœ‰ç‹¬ç«‹çš„æœ¬åœ°å†…å­˜ã€ I/O æ§½å£ç­‰ã€‚ç”±äºå…¶èŠ‚ç‚¹ä¹‹é—´å¯ä»¥é€šè¿‡äº’è”æ¨¡å— ( å¦‚ç§°ä¸º Crossbar Switch) è¿›è¡Œè¿æ¥å’Œä¿¡æ¯äº¤äº’ï¼Œå› æ­¤æ¯ä¸ª CPU å¯ä»¥è®¿é—®æ•´ä¸ªç³»ç»Ÿçš„å†…å­˜ ( è¿™æ˜¯ NUMA ç³»ç»Ÿä¸ MPP ç³»ç»Ÿçš„é‡è¦å·®åˆ« ) ã€‚æ˜¾ç„¶ï¼Œè®¿é—®æœ¬åœ°å†…å­˜çš„é€Ÿåº¦å°†è¿œè¿œé«˜äºè®¿é—®è¿œåœ°å†…å­˜ ( ç³»ç»Ÿå†…å…¶å®ƒèŠ‚ç‚¹çš„å†…å­˜ ) çš„é€Ÿåº¦ï¼Œè¿™ä¹Ÿæ˜¯éä¸€è‡´å­˜å‚¨è®¿é—® NUMA çš„ç”±æ¥ã€‚ç”±äºè¿™ä¸ªç‰¹ç‚¹ï¼Œä¸ºäº†æ›´å¥½åœ°å‘æŒ¥ç³»ç»Ÿæ€§èƒ½ï¼Œå¼€å‘åº”ç”¨ç¨‹åºæ—¶éœ€è¦å°½é‡å‡å°‘ä¸åŒ CPU æ¨¡å—ä¹‹é—´çš„ä¿¡æ¯äº¤äº’ã€‚</p><p>åˆ©ç”¨ NUMA æŠ€æœ¯ï¼Œå¯ä»¥è¾ƒå¥½åœ°è§£å†³åŸæ¥ SMP ç³»ç»Ÿçš„æ‰©å±•é—®é¢˜ï¼Œåœ¨ä¸€ä¸ªç‰©ç†æœåŠ¡å™¨å†…å¯ä»¥æ”¯æŒä¸Šç™¾ä¸ª CPU ã€‚æ¯”è¾ƒå…¸å‹çš„ NUMA æœåŠ¡å™¨çš„ä¾‹å­åŒ…æ‹¬ HP çš„ Superdome ã€ SUN15K ã€ IBMp690 ç­‰ã€‚</p><p>ã€€ã€€ä½† NUMA æŠ€æœ¯åŒæ ·æœ‰ä¸€å®šç¼ºé™·ï¼Œç”±äºè®¿é—®è¿œåœ°å†…å­˜çš„å»¶æ—¶è¿œè¿œè¶…è¿‡æœ¬åœ°å†…å­˜ï¼Œå› æ­¤å½“ CPU æ•°é‡å¢åŠ æ—¶ï¼Œç³»ç»Ÿæ€§èƒ½æ— æ³•çº¿æ€§å¢åŠ ã€‚å¦‚ HP å…¬å¸å‘å¸ƒ Superdome æœåŠ¡å™¨æ—¶ï¼Œæ›¾å…¬å¸ƒäº†å®ƒä¸ HP å…¶å®ƒ UNIX æœåŠ¡å™¨çš„ç›¸å¯¹æ€§èƒ½å€¼ï¼Œç»“æœå‘ç°ï¼Œ 64 è·¯ CPU çš„ Superdome (NUMA ç»“æ„ ) çš„ç›¸å¯¹æ€§èƒ½å€¼æ˜¯ 20 ï¼Œè€Œ 8 è·¯ N4000( å…±äº«çš„ SMP ç»“æ„ ) çš„ç›¸å¯¹æ€§èƒ½å€¼æ˜¯ 6.3 ã€‚ä»è¿™ä¸ªç»“æœå¯ä»¥çœ‹åˆ°ï¼Œ 8 å€æ•°é‡çš„ CPU æ¢æ¥çš„åªæ˜¯ 3 å€æ€§èƒ½çš„æå‡ã€‚</p></blockquote><ul><li>MPP(Massive Parallel Processing)</li></ul><blockquote><p>ã€€ã€€å’Œ NUMA ä¸åŒï¼Œ MPP æä¾›äº†å¦å¤–ä¸€ç§è¿›è¡Œç³»ç»Ÿæ‰©å±•çš„æ–¹å¼ï¼Œå®ƒç”±å¤šä¸ª SMP æœåŠ¡å™¨é€šè¿‡ä¸€å®šçš„èŠ‚ç‚¹äº’è”ç½‘ç»œè¿›è¡Œè¿æ¥ï¼ŒååŒå·¥ä½œï¼Œå®Œæˆç›¸åŒçš„ä»»åŠ¡ï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç³»ç»Ÿã€‚å…¶åŸºæœ¬ç‰¹å¾æ˜¯ç”±å¤šä¸ª SMP æœåŠ¡å™¨ ( æ¯ä¸ª SMP æœåŠ¡å™¨ç§°èŠ‚ç‚¹ ) é€šè¿‡èŠ‚ç‚¹äº’è”ç½‘ç»œè¿æ¥è€Œæˆï¼Œæ¯ä¸ªèŠ‚ç‚¹åªè®¿é—®è‡ªå·±çš„æœ¬åœ°èµ„æº ( å†…å­˜ã€å­˜å‚¨ç­‰ ) ï¼Œæ˜¯ä¸€ç§å®Œå…¨æ— å…±äº« (Share Nothing) ç»“æ„ï¼Œå› è€Œæ‰©å±•èƒ½åŠ›æœ€å¥½ï¼Œç†è®ºä¸Šå…¶æ‰©å±•æ— é™åˆ¶ï¼Œç›®å‰çš„æŠ€æœ¯å¯å®ç° 512 ä¸ªèŠ‚ç‚¹äº’è”ï¼Œæ•°åƒä¸ª CPU ã€‚ç›®å‰ä¸šç•Œå¯¹èŠ‚ç‚¹äº’è”ç½‘ç»œæš‚æ— æ ‡å‡†ï¼Œå¦‚ NCR çš„ Bynet ï¼Œ IBM çš„ SPSwitch ï¼Œå®ƒä»¬éƒ½é‡‡ç”¨äº†ä¸åŒçš„å†…éƒ¨å®ç°æœºåˆ¶ã€‚ä½†èŠ‚ç‚¹äº’è”ç½‘ä»…ä¾› MPP æœåŠ¡å™¨å†…éƒ¨ä½¿ç”¨ï¼Œå¯¹ç”¨æˆ·è€Œè¨€æ˜¯é€æ˜çš„ã€‚</p><p>ã€€ã€€åœ¨ MPP ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ª SMP èŠ‚ç‚¹ä¹Ÿå¯ä»¥è¿è¡Œè‡ªå·±çš„æ“ä½œç³»ç»Ÿã€æ•°æ®åº“ç­‰ã€‚ä½†å’Œ NUMA ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸å­˜åœ¨å¼‚åœ°å†…å­˜è®¿é—®çš„é—®é¢˜ã€‚æ¢è¨€ä¹‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å†…çš„ CPU ä¸èƒ½è®¿é—®å¦ä¸€ä¸ªèŠ‚ç‚¹çš„å†…å­˜ã€‚èŠ‚ç‚¹ä¹‹é—´çš„ä¿¡æ¯äº¤äº’æ˜¯é€šè¿‡èŠ‚ç‚¹äº’è”ç½‘ç»œå®ç°çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸€èˆ¬ç§°ä¸ºæ•°æ®é‡åˆ†é… (Data Redistribution) ã€‚</p><p>ä½†æ˜¯ MPP æœåŠ¡å™¨éœ€è¦ä¸€ç§å¤æ‚çš„æœºåˆ¶æ¥è°ƒåº¦å’Œå¹³è¡¡å„ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½å’Œå¹¶è¡Œå¤„ç†è¿‡ç¨‹ã€‚ç›®å‰ä¸€äº›åŸºäº MPP æŠ€æœ¯çš„æœåŠ¡å™¨å¾€å¾€é€šè¿‡ç³»ç»Ÿçº§è½¯ä»¶ ( å¦‚æ•°æ®åº“ ) æ¥å±è”½è¿™ç§å¤æ‚æ€§ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ NCR çš„ Teradata å°±æ˜¯åŸºäº MPP æŠ€æœ¯çš„ä¸€ä¸ªå…³ç³»æ•°æ®åº“è½¯ä»¶ï¼ŒåŸºäºæ­¤æ•°æ®åº“æ¥å¼€å‘åº”ç”¨æ—¶ï¼Œä¸ç®¡åå°æœåŠ¡å™¨ç”±å¤šå°‘ä¸ªèŠ‚ç‚¹ç»„æˆï¼Œå¼€å‘äººå‘˜æ‰€é¢å¯¹çš„éƒ½æ˜¯åŒä¸€ä¸ªæ•°æ®åº“ç³»ç»Ÿï¼Œè€Œä¸éœ€è¦è€ƒè™‘å¦‚ä½•è°ƒåº¦å…¶ä¸­æŸå‡ ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½ã€‚</p><p>MPP (Massively Parallel Processing)ï¼Œå¤§è§„æ¨¡å¹¶è¡Œå¤„ç†ç³»ç»Ÿï¼Œè¿™æ ·çš„ç³»ç»Ÿæ˜¯ç”±è®¸å¤šæ¾è€¦åˆçš„å¤„ç†å•å…ƒç»„æˆçš„ï¼Œè¦æ³¨æ„çš„æ˜¯è¿™é‡ŒæŒ‡çš„æ˜¯å¤„ç†å•å…ƒè€Œä¸æ˜¯å¤„ç†å™¨ã€‚æ¯ä¸ªå•å…ƒå†…çš„CPUéƒ½æœ‰è‡ªå·±ç§æœ‰çš„èµ„æºï¼Œå¦‚æ€»çº¿ï¼Œå†…å­˜ï¼Œç¡¬ç›˜ç­‰ã€‚åœ¨æ¯ä¸ªå•å…ƒå†…éƒ½æœ‰æ“ä½œç³»ç»Ÿå’Œç®¡ç†æ•°æ®åº“çš„å®ä¾‹å¤æœ¬ã€‚è¿™ç§ç»“æ„æœ€å¤§çš„ç‰¹ç‚¹åœ¨äºä¸å…±äº«èµ„æºã€‚</p></blockquote><h4 id="NUMAç»“æ„ä¸‹çš„ç¼“å­˜ä¸€è‡´æ€§"><a href="#NUMAç»“æ„ä¸‹çš„ç¼“å­˜ä¸€è‡´æ€§" class="headerlink" title="NUMAç»“æ„ä¸‹çš„ç¼“å­˜ä¸€è‡´æ€§"></a>NUMAç»“æ„ä¸‹çš„ç¼“å­˜ä¸€è‡´æ€§</h4><p>è¦çŸ¥é“ï¼ŒMESIåè®®è§£å†³çš„æ˜¯ä¼ ç»ŸSMPç»“æ„ä¸‹ç¼“å­˜çš„ä¸€è‡´æ€§ï¼Œä¸ºäº†åœ¨NUMAæ¶æ„ä¹Ÿå®ç°ç¼“å­˜ä¸€è‡´æ€§ï¼Œintelå¼•å…¥äº†MESIçš„ä¸€ä¸ªæ‹“å±•åè®®â€“MESIFï¼Œä½†æ˜¯ç›®å‰å¹¶æ²¡æœ‰ä»€ä¹ˆèµ„æ–™ï¼Œä¹Ÿæ²¡æ³•ç ”ç©¶ï¼Œæ›´å¤šæ¶ˆæ¯è¯·æŸ¥é˜…intelçš„wikiã€‚</p><h2 id="Javaå†…å­˜æ¨¡å‹"><a href="#Javaå†…å­˜æ¨¡å‹" class="headerlink" title="Javaå†…å­˜æ¨¡å‹"></a>Javaå†…å­˜æ¨¡å‹</h2><h3 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h3><p>æˆ‘ä»¬å†™ç¨‹åºï¼Œä¸ºä»€ä¹ˆè¦è€ƒè™‘å†…å­˜æ¨¡å‹å‘¢ï¼Œæˆ‘ä»¬å‰é¢è¯´äº†ï¼Œç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€å†…å­˜ä¸€è‡´é—®é¢˜æ˜¯ç¡¬ä»¶çš„ä¸æ–­å‡çº§å¯¼è‡´çš„ã€‚è§£å†³é—®é¢˜ï¼Œæœ€ç®€å•ç›´æ¥çš„åšæ³•å°±æ˜¯åºŸé™¤CPUç¼“å­˜ï¼Œè®©CPUç›´æ¥å’Œä¸»å­˜äº¤äº’ã€‚ä½†æ˜¯ï¼Œè¿™ä¹ˆåšè™½ç„¶å¯ä»¥ä¿è¯å¤šçº¿ç¨‹ä¸‹çš„å¹¶å‘é—®é¢˜ã€‚ä½†æ˜¯ï¼Œè¿™å°±æœ‰ç‚¹æ—¶ä»£å€’é€€äº†ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯å¹¶å‘ç¼–ç¨‹ä¸­å¯ä»¥æ»¡è¶³åŸå­æ€§ã€å¯è§æ€§åŠæœ‰åºæ€§ã€‚æœ‰ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œé‚£å°±æ˜¯â€”â€”å†…å­˜æ¨¡å‹ã€‚</p><p>å³ä¸ºäº†ä¿è¯å…±äº«å†…å­˜çš„æ­£ç¡®æ€§ï¼ˆå¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§ï¼‰ï¼Œéœ€è¦å†…å­˜æ¨¡å‹æ¥å®šä¹‰äº†å…±äº«å†…å­˜ç³»ç»Ÿä¸­å¤šçº¿ç¨‹ç¨‹åºè¯»å†™æ“ä½œè¡Œä¸ºçš„ç›¸åº”è§„èŒƒ~</p><h3 id="JMM"><a href="#JMM" class="headerlink" title="JMM"></a>JMM</h3><p>Javaå†…å­˜æ¨¡å‹æ˜¯æ ¹æ®è‹±æ–‡Java Memory Modelï¼ˆJMMï¼‰ç¿»è¯‘è¿‡æ¥çš„ã€‚å…¶å®JMMå¹¶ä¸åƒJVMå†…å­˜ç»“æ„ä¸€æ ·æ˜¯çœŸå®å­˜åœ¨çš„ã€‚å®ƒ<strong>æ˜¯ä¸€ç§ç¬¦åˆå†…å­˜æ¨¡å‹è§„èŒƒçš„ï¼Œå±è”½äº†å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„è®¿é—®å·®å¼‚çš„ï¼Œä¿è¯äº†Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹å¯¹å†…å­˜çš„è®¿é—®éƒ½èƒ½ä¿è¯æ•ˆæœä¸€è‡´çš„æœºåˆ¶åŠè§„èŒƒ</strong>ã€‚å°±åƒJSR-133: Java Memory Model and Thread Specification ä¸­æè¿°äº†ï¼ŒJMMæ˜¯å’Œå¤šçº¿ç¨‹ç›¸å…³çš„ï¼Œä»–æè¿°äº†ä¸€ç»„è§„åˆ™æˆ–è§„èŒƒï¼Œè¿™ä¸ªè§„èŒƒå®šä¹‰äº†ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹æ˜¯å¯è§çš„ã€‚</p><p><img src="/2018/09/30/Javaä¸å†…å­˜/7.png" alt="æŠ½è±¡å›¾"></p><p>Javaçš„å¤šçº¿ç¨‹ä¹‹é—´æ˜¯é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡çš„ï¼Œè€Œç”±äºé‡‡ç”¨å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡ï¼Œåœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä¼šå­˜åœ¨ä¸€ç³»åˆ—å¦‚å¯è§æ€§ã€åŸå­æ€§ã€é¡ºåºæ€§ç­‰é—®é¢˜ï¼Œè€ŒJMMå°±æ˜¯å›´ç»•ç€å¤šçº¿ç¨‹é€šä¿¡ä»¥åŠä¸å…¶ç›¸å…³çš„ä¸€ç³»åˆ—ç‰¹æ€§è€Œå»ºç«‹çš„æ¨¡å‹ã€‚JMMå®šä¹‰äº†ä¸€äº›è¯­æ³•é›†ï¼Œè¿™äº›è¯­æ³•é›†æ˜ å°„åˆ°Javaè¯­è¨€ä¸­å°±æ˜¯<code>volatile</code>ã€<code>synchronized</code>ç­‰å…³é”®å­—ã€‚</p><p>åœ¨JMMä¸­ï¼Œæˆ‘ä»¬æŠŠå¤šä¸ªçº¿ç¨‹é—´é€šä¿¡çš„å…±äº«å†…å­˜ç§°ä¹‹ä¸ºä¸»å†…å­˜ï¼Œè€Œåœ¨å¹¶å‘ç¼–ç¨‹ä¸­å¤šä¸ªçº¿ç¨‹éƒ½ç»´æŠ¤äº†ä¸€ä¸ªè‡ªå·±çš„æœ¬åœ°å†…å­˜ï¼ˆè¿™æ˜¯ä¸ªæŠ½è±¡æ¦‚å¿µï¼‰ï¼Œå…¶ä¸­ä¿å­˜çš„æ•°æ®æ˜¯ä¸»å†…å­˜ä¸­çš„æ•°æ®æ‹·è´ã€‚è€Œ<strong>JMMä¸»è¦æ˜¯æ§åˆ¶æœ¬åœ°å†…å­˜å’Œä¸»å†…å­˜ä¹‹é—´çš„æ•°æ®äº¤äº’çš„</strong>ã€‚</p><p>ä¸‹é¢çœ‹çœ‹Javaå†…å­˜æ¨¡å‹æŠ½è±¡å›¾ï¼š</p><p><img src="/2018/09/30/Javaä¸å†…å­˜/5.png" alt="æŠ½è±¡å›¾"></p><p>åœ¨Javaä¸­ï¼ŒJMMæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œæ­£æ˜¯ç”±äºæœ‰äº†JMMï¼ŒJavaçš„å¹¶å‘ç¼–ç¨‹æ‰èƒ½é¿å…å¾ˆå¤šé—®é¢˜ã€‚</p><h3 id="JMMåŒæ­¥å…«ç§æ“ä½œ"><a href="#JMMåŒæ­¥å…«ç§æ“ä½œ" class="headerlink" title="JMMåŒæ­¥å…«ç§æ“ä½œ"></a>JMMåŒæ­¥å…«ç§æ“ä½œ</h3><p>JMMè§„å®šäº†ä¸€ç³»åˆ—æ“ä½œï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„æ“ä½œçš„ä¸€è‡´æ•°æ®çš„ä¸€è‡´ã€‚</p><p>ï¼ˆ1ï¼‰lock(é”å®š)ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡æ ‡è®°ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çŠ¶æ€</p><p>ï¼ˆ2ï¼‰unlock(è§£é”)ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®š</p><p>ï¼ˆ3ï¼‰read(è¯»å–)ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨</p><p>ï¼ˆ4ï¼‰load(è½½å…¥)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­</p><p>ï¼ˆ5ï¼‰use(ä½¿ç”¨)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“</p><p>ï¼ˆ6ï¼‰assign(èµ‹å€¼)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡</p><p>ï¼ˆ7ï¼‰store(å­˜å‚¨)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„writeçš„æ“ä½œ</p><p>ï¼ˆ8ï¼‰write(å†™å…¥)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜çš„å˜é‡ä¸­</p><p>æŒ‰ç…§é¡ºåºå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="/2018/09/30/Javaä¸å†…å­˜/8.png" alt="JMMåŒæ­¥å…«ç§æ“ä½œ"></p><h4 id="åŒæ­¥è§„åˆ™"><a href="#åŒæ­¥è§„åˆ™" class="headerlink" title="åŒæ­¥è§„åˆ™"></a>åŒæ­¥è§„åˆ™</h4><p>åŒæ­¥è§„åˆ™åˆ†æï¼š</p><ol><li>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› åœ°ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•assignæ“ä½œï¼‰æŠŠæ•°æ®ä»å·¥ä½œå†…å­˜åŒæ­¥ä¼šä¸»å†…å­˜ä¸­</li><li>ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­è¯ç”Ÿï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆloadæˆ–è€…assignï¼‰çš„å˜é‡ã€‚å³å°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½useå’Œstoreæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆè‡ªè¡Œassignå’Œloadæ“ä½œã€‚</li><li>ä¸€ä¸ªå˜é‡åœ¨åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œï¼Œä½†lockæ“ä½œå¯ä»¥è¢«åŒä¸€çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œlockåï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ“ä½œï¼Œå˜é‡æ‰ä¼šè¢«è§£é”ã€‚lockå’Œunlockå¿…é¡»æˆå¯¹å‡ºç°ã€‚</li><li>å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œlockæ“ä½œï¼Œå°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡ä¹‹å‰éœ€è¦é‡æ–°æ‰§è¡Œloadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ã€‚</li><li>å¦‚æœä¸€ä¸ªå˜é‡äº‹å…ˆæ²¡æœ‰è¢«lockæ“ä½œé”å®šï¼Œåˆ™ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œunlockæ“ä½œï¼›ä¹Ÿä¸å…è®¸å»unlockä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”å®šçš„å˜é‡ã€‚</li><li>å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼ˆæ‰§è¡Œstoreå’Œwriteæ“ä½œï¼‰</li></ol><h3 id="JMMåº”ç”¨"><a href="#JMMåº”ç”¨" class="headerlink" title="JMMåº”ç”¨"></a>JMMåº”ç”¨</h3><p>äº†è§£Javaå¤šçº¿ç¨‹çš„æœ‹å‹éƒ½çŸ¥é“ï¼Œåœ¨Javaä¸­æä¾›äº†ä¸€ç³»åˆ—å’Œå¹¶å‘å¤„ç†ç›¸å…³çš„å…³é”®å­—ï¼Œæ¯”å¦‚<code>volatile</code>ã€<code>synchronized</code>ã€<code>final</code>ã€<code>concurrent</code>åŒ…ç­‰ã€‚å…¶å®è¿™äº›å°±æ˜¯Javaå†…å­˜æ¨¡å‹å°è£…äº†åº•å±‚çš„å®ç°åæä¾›ç»™æˆ‘ä»¬ä½¿ç”¨çš„ä¸€äº›å…³é”®å­—ã€‚</p><p>åœ¨å¼€å‘å¤šçº¿ç¨‹çš„ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨<code>synchronized</code>ç­‰å…³é”®å­—æ¥æ§åˆ¶å¹¶å‘ï¼Œä»æ¥å°±ä¸éœ€è¦å…³å¿ƒåº•å±‚çš„ç¼–è¯‘å™¨ä¼˜åŒ–ã€ç¼“å­˜ä¸€è‡´æ€§ç­‰é—®é¢˜ã€‚æ‰€ä»¥ï¼Œ<strong>Javaå†…å­˜æ¨¡å‹ï¼Œé™¤äº†å®šä¹‰äº†ä¸€å¥—è§„èŒƒï¼Œè¿˜æä¾›äº†ä¸€ç³»åˆ—åŸè¯­ï¼Œå°è£…äº†åº•å±‚å®ç°åï¼Œä¾›å¼€å‘è€…ç›´æ¥ä½¿ç”¨ã€‚</strong></p><p>å¹¶å‘ç¼–ç¨‹è¦è§£å†³åŸå­æ€§ã€æœ‰åºæ€§å’Œå¯è§æ€§çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±å†æ¥çœ‹ä¸‹ï¼Œåœ¨Javaä¸­ï¼Œåˆ†åˆ«ä½¿ç”¨ä»€ä¹ˆæ–¹å¼æ¥ä¿è¯ã€‚</p><h4 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h4><p><strong>åŸå­æ€§</strong>æ˜¯æŒ‡åœ¨ä¸€ä¸ªæ“ä½œä¸­å°±æ˜¯cpuä¸å¯ä»¥åœ¨ä¸­é€”æš‚åœç„¶åå†è°ƒåº¦ï¼Œæ—¢ä¸è¢«ä¸­æ–­æ“ä½œï¼Œè¦ä¸æ‰§è¡Œå®Œæˆï¼Œè¦ä¸å°±ä¸æ‰§è¡Œã€‚</p><p>JMMæä¾›ä¿è¯äº†è®¿é—®åŸºæœ¬æ•°æ®ç±»å‹çš„åŸå­æ€§ï¼ˆå…¶å®åœ¨å†™ä¸€ä¸ªå·¥ä½œå†…å­˜å˜é‡åˆ°ä¸»å†…å­˜æ˜¯åˆ†ä¸»è¦ä¸¤æ­¥ï¼šstoreã€writeï¼‰ï¼Œä½†æ˜¯å®é™…ä¸šåŠ¡å¤„ç†åœºæ™¯å¾€å¾€æ˜¯éœ€è¦æ›´å¤§çš„èŒƒå›´çš„åŸå­æ€§ä¿è¯ã€‚</p><p>åœ¨Javaä¸­ï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæä¾›äº†ä¸¤ä¸ªé«˜çº§çš„å­—èŠ‚ç æŒ‡ä»¤<code>monitorenter</code>å’Œ<code>monitorexit</code>ï¼Œè€Œè¿™ä¸¤ä¸ªå­—èŠ‚ç ï¼Œåœ¨Javaä¸­å¯¹åº”çš„å…³é”®å­—å°±æ˜¯<code>synchronized</code>ã€‚</p><p>å› æ­¤ï¼Œåœ¨Javaä¸­å¯ä»¥ä½¿ç”¨<code>synchronized</code>æ¥ä¿è¯æ–¹æ³•å’Œä»£ç å—å†…çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚è¿™é‡Œæ¨èä¸€ç¯‡æ–‡ç« <a href="https://blog.csdn.net/javazejian/article/details/72828483" target="_blank" rel="noopener">æ·±å…¥ç†è§£Javaå¹¶å‘ä¹‹synchronizedå®ç°åŸç†</a>ã€‚</p><h4 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h4><p><strong>å¯è§æ€§</strong>æ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼ã€‚</p><p>Javaå†…å­˜æ¨¡å‹æ˜¯é€šè¿‡åœ¨å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜ï¼Œåœ¨å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼çš„è¿™ç§ä¾èµ–ä¸»å†…å­˜ä½œä¸ºä¼ é€’åª’ä»‹çš„æ–¹å¼æ¥å®ç°çš„ã€‚</p><p>Javaä¸­çš„<code>volatile</code>å…³é”®å­—æä¾›äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯è¢«å…¶ä¿®é¥°çš„å˜é‡åœ¨è¢«ä¿®æ”¹åå¯ä»¥ç«‹å³åŒæ­¥åˆ°<strong>ä¸»å†…å­˜</strong>ï¼Œè¢«å…¶ä¿®é¥°çš„å˜é‡åœ¨æ¯æ¬¡æ˜¯ç”¨ä¹‹å‰éƒ½ä»ä¸»å†…å­˜åˆ·æ–°ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨<code>volatile</code>æ¥ä¿è¯å¤šçº¿ç¨‹æ“ä½œæ—¶å˜é‡çš„å¯è§æ€§ã€‚</p><p>é™¤äº†<code>volatile</code>ï¼ŒJavaä¸­çš„<code>synchronized</code>å’Œ<code>final</code>ã€<code>static</code>ä¸‰ä¸ªå…³é”®å­—ä¹Ÿå¯ä»¥å®ç°å¯è§æ€§ã€‚ä¸‹é¢åˆ†äº«ä¸€ä¸‹æˆ‘çš„è¯»ä¹¦ç¬”è®°ï¼š</p><p><img src="/2018/09/30/Javaä¸å†…å­˜/6.png" alt="1538374970743"></p><h4 id="æœ‰åºæ€§"><a href="#æœ‰åºæ€§" class="headerlink" title="æœ‰åºæ€§"></a>æœ‰åºæ€§</h4><p><strong>æœ‰åºæ€§</strong>å³ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚</p><p>åœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>synchronized</code>å’Œ<code>volatile</code>æ¥ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´æ“ä½œçš„æœ‰åºæ€§ã€‚å®ç°æ–¹å¼æœ‰æ‰€åŒºåˆ«ï¼š</p><p><code>volatile</code>å…³é”®å­—ä¼šç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚<code>synchronized</code>å…³é”®å­—ä¿è¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹æ“ä½œã€‚</p><p>å¥½äº†ï¼Œè¿™é‡Œç®€å•çš„ä»‹ç»å®Œäº†Javaå¹¶å‘ç¼–ç¨‹ä¸­è§£å†³åŸå­æ€§ã€å¯è§æ€§ä»¥åŠæœ‰åºæ€§å¯ä»¥ä½¿ç”¨çš„å…³é”®å­—ã€‚è¯»è€…å¯èƒ½å‘ç°äº†ï¼Œå¥½åƒ<code>synchronized</code>å…³é”®å­—æ˜¯ä¸‡èƒ½çš„ï¼Œä»–å¯ä»¥åŒæ—¶æ»¡è¶³ä»¥ä¸Šä¸‰ç§ç‰¹æ€§ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯å¾ˆå¤šäººæ»¥ç”¨<code>synchronized</code>çš„åŸå› ã€‚</p><p>ä½†æ˜¯<code>synchronized</code>æ˜¯æ¯”è¾ƒå½±å“æ€§èƒ½çš„ï¼Œè™½ç„¶ç¼–è¯‘å™¨æä¾›äº†å¾ˆå¤šé”ä¼˜åŒ–æŠ€æœ¯ï¼Œä½†æ˜¯ä¹Ÿä¸å»ºè®®è¿‡åº¦ä½¿ç”¨ã€‚</p><h2 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJavaä»£ç æ˜¯è¦è¿è¡Œåœ¨è™šæ‹Ÿæœºä¸Šçš„ï¼Œè€Œè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒJavaç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸï¼Œè¿™äº›åŒºåŸŸéƒ½æœ‰å„è‡ªçš„ç”¨é€”ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è¯´è¯´JVMè¿è¡Œæ—¶å†…å­˜åŒºåŸŸç»“æ„</p><h3 id="JVMè¿è¡Œæ—¶å†…å­˜åŒºåŸŸç»“æ„"><a href="#JVMè¿è¡Œæ—¶å†…å­˜åŒºåŸŸç»“æ„" class="headerlink" title="JVMè¿è¡Œæ—¶å†…å­˜åŒºåŸŸç»“æ„"></a>JVMè¿è¡Œæ—¶å†…å­˜åŒºåŸŸç»“æ„</h3><p>åœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava SE 8ï¼‰ã€‹ä¸­æè¿°äº†JVMè¿è¡Œæ—¶å†…å­˜åŒºåŸŸç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/2018/09/30/Javaä¸å†…å­˜/3.png" alt="JVM"></p><p> 1.<strong>ç¨‹åºè®¡æ•°å™¨</strong></p><p>ã€€ã€€ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼Œä¹Ÿæœ‰ç§°ä½œä¸ºPCå¯„å­˜å™¨ã€‚æƒ³å¿…å­¦è¿‡æ±‡ç¼–è¯­è¨€çš„æœ‹å‹å¯¹ç¨‹åºè®¡æ•°å™¨è¿™ä¸ªæ¦‚å¿µå¹¶ä¸é™Œç”Ÿï¼Œåœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œç¨‹åºè®¡æ•°å™¨æ˜¯æŒ‡CPUä¸­çš„å¯„å­˜å™¨ï¼Œå®ƒä¿å­˜çš„æ˜¯ç¨‹åºå½“å‰æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€ï¼ˆä¹Ÿå¯ä»¥è¯´ä¿å­˜ä¸‹ä¸€æ¡æŒ‡ä»¤çš„æ‰€åœ¨å­˜å‚¨å•å…ƒçš„åœ°å€ï¼‰ï¼Œå½“CPUéœ€è¦æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼Œéœ€è¦ä»ç¨‹åºè®¡æ•°å™¨ä¸­å¾—åˆ°å½“å‰éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤æ‰€åœ¨å­˜å‚¨å•å…ƒçš„åœ°å€ï¼Œç„¶åæ ¹æ®å¾—åˆ°çš„åœ°å€è·å–åˆ°æŒ‡ä»¤ï¼Œåœ¨å¾—åˆ°æŒ‡ä»¤ä¹‹åï¼Œç¨‹åºè®¡æ•°å™¨ä¾¿è‡ªåŠ¨åŠ 1æˆ–è€…æ ¹æ®è½¬ç§»æŒ‡é’ˆå¾—åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œç›´è‡³æ‰§è¡Œå®Œæ‰€æœ‰çš„æŒ‡ä»¤ã€‚</p><p>ã€€ã€€è™½ç„¶JVMä¸­çš„ç¨‹åºè®¡æ•°å™¨å¹¶ä¸åƒæ±‡ç¼–è¯­è¨€ä¸­çš„ç¨‹åºè®¡æ•°å™¨ä¸€æ ·æ˜¯ç‰©ç†æ¦‚å¿µä¸Šçš„CPUå¯„å­˜å™¨ï¼Œä½†æ˜¯JVMä¸­çš„ç¨‹åºè®¡æ•°å™¨çš„åŠŸèƒ½è·Ÿæ±‡ç¼–è¯­è¨€ä¸­çš„ç¨‹åºè®¡æ•°å™¨çš„åŠŸèƒ½åœ¨é€»è¾‘ä¸Šæ˜¯ç­‰åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯ç”¨æ¥æŒ‡ç¤º æ‰§è¡Œå“ªæ¡æŒ‡ä»¤çš„ã€‚</p><p>ã€€ã€€ç”±äºåœ¨JVMä¸­ï¼Œå¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢æ¥è·å¾—CPUæ‰§è¡Œæ—¶é—´çš„ï¼Œå› æ­¤ï¼Œåœ¨ä»»ä¸€å…·ä½“æ—¶åˆ»ï¼Œä¸€ä¸ªCPUçš„å†…æ ¸åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤ï¼Œå› æ­¤ï¼Œä¸ºäº†èƒ½å¤Ÿä½¿å¾—æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨çº¿ç¨‹åˆ‡æ¢åèƒ½å¤Ÿæ¢å¤åœ¨åˆ‡æ¢ä¹‹å‰çš„ç¨‹åºæ‰§è¡Œä½ç½®ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦æœ‰è‡ªå·±ç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå¹¶ä¸”ä¸èƒ½äº’ç›¸è¢«å¹²æ‰°ï¼Œå¦åˆ™å°±ä¼šå½±å“åˆ°ç¨‹åºçš„æ­£å¸¸æ‰§è¡Œæ¬¡åºã€‚å› æ­¤ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼Œç¨‹åºè®¡æ•°å™¨æ˜¯æ¯ä¸ªçº¿ç¨‹æ‰€ç§æœ‰çš„ã€‚</p><p>ã€€ã€€åœ¨JVMè§„èŒƒä¸­è§„å®šï¼Œå¦‚æœçº¿ç¨‹æ‰§è¡Œçš„æ˜¯énativeæ–¹æ³•ï¼Œåˆ™ç¨‹åºè®¡æ•°å™¨ä¸­ä¿å­˜çš„æ˜¯å½“å‰éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æœçº¿ç¨‹æ‰§è¡Œçš„æ˜¯nativeæ–¹æ³•ï¼Œåˆ™ç¨‹åºè®¡æ•°å™¨ä¸­çš„å€¼æ˜¯undefinedã€‚</p><p>ã€€ã€€ç”±äºç¨‹åºè®¡æ•°å™¨ä¸­å­˜å‚¨çš„æ•°æ®æ‰€å ç©ºé—´çš„å¤§å°ä¸ä¼šéšç¨‹åºçš„æ‰§è¡Œè€Œå‘ç”Ÿæ”¹å˜ï¼Œå› æ­¤ï¼Œå¯¹äºç¨‹åºè®¡æ•°å™¨æ˜¯ä¸ä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºç°è±¡(OutOfMemory)çš„ã€‚</p><p> 2.<strong>Javaæ ˆ</strong></p><p>ã€€ã€€Javaæ ˆä¹Ÿç§°ä½œè™šæ‹Ÿæœºæ ˆï¼ˆJava Vitual Machine Stackï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸å¸¸æ‰€è¯´çš„æ ˆï¼Œè·ŸCè¯­è¨€çš„æ•°æ®æ®µä¸­çš„æ ˆç±»ä¼¼ã€‚äº‹å®ä¸Šï¼ŒJavaæ ˆæ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿä¸‹é¢å°±æ¥è§£é‡Šä¸€ä¸‹å…¶ä¸­çš„åŸå› ã€‚</p><p>ã€€ã€€Javaæ ˆä¸­å­˜æ”¾çš„æ˜¯ä¸€ä¸ªä¸ªçš„æ ˆå¸§ï¼Œæ¯ä¸ªæ ˆå¸§å¯¹åº”ä¸€ä¸ªè¢«è°ƒç”¨çš„æ–¹æ³•ï¼Œåœ¨æ ˆå¸§ä¸­åŒ…æ‹¬å±€éƒ¨å˜é‡è¡¨(Local Variables)ã€æ“ä½œæ•°æ ˆ(Operand Stack)ã€æŒ‡å‘å½“å‰æ–¹æ³•æ‰€å±çš„ç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆè¿è¡Œæ—¶å¸¸é‡æ± çš„æ¦‚å¿µåœ¨æ–¹æ³•åŒºéƒ¨åˆ†ä¼šè°ˆåˆ°ï¼‰çš„å¼•ç”¨(Reference to runtime constant pool)ã€æ–¹æ³•è¿”å›åœ°å€(Return Address)å’Œä¸€äº›é¢å¤–çš„é™„åŠ ä¿¡æ¯ã€‚å½“çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå°±ä¼šéšä¹‹åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æ ˆå¸§ï¼Œå¹¶å°†å»ºç«‹çš„æ ˆå¸§å‹æ ˆã€‚å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¾¿ä¼šå°†æ ˆå¸§å‡ºæ ˆã€‚å› æ­¤å¯çŸ¥ï¼Œçº¿ç¨‹å½“å‰æ‰§è¡Œçš„æ–¹æ³•æ‰€å¯¹åº”çš„æ ˆå¸§å¿…å®šä½äºJavaæ ˆçš„é¡¶éƒ¨ã€‚è®²åˆ°è¿™é‡Œï¼Œå¤§å®¶å°±åº”è¯¥ä¼šæ˜ç™½ä¸ºä»€ä¹ˆ åœ¨ ä½¿ç”¨ é€’å½’æ–¹æ³•çš„æ—¶å€™å®¹æ˜“å¯¼è‡´æ ˆå†…å­˜æº¢å‡ºçš„ç°è±¡äº†ä»¥åŠä¸ºä»€ä¹ˆæ ˆåŒºçš„ç©ºé—´ä¸ç”¨ç¨‹åºå‘˜å»ç®¡ç†äº†ï¼ˆå½“ç„¶åœ¨Javaä¸­ï¼Œç¨‹åºå‘˜åŸºæœ¬ä¸ç”¨å…³ç³»åˆ°å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„äº‹æƒ…ï¼Œå› ä¸ºJavaæœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼‰ï¼Œè¿™éƒ¨åˆ†ç©ºé—´çš„åˆ†é…å’Œé‡Šæ”¾éƒ½æ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨å®æ–½çš„ã€‚å¯¹äºæ‰€æœ‰çš„ç¨‹åºè®¾è®¡è¯­è¨€æ¥è¯´ï¼Œæ ˆè¿™éƒ¨åˆ†ç©ºé—´å¯¹ç¨‹åºå‘˜æ¥è¯´æ˜¯ä¸é€æ˜çš„ã€‚ä¸‹å›¾è¡¨ç¤ºäº†ä¸€ä¸ªJavaæ ˆçš„æ¨¡å‹ï¼š</p><p><img src="/2018/09/30/Javaä¸å†…å­˜/4.png" alt="img"></p><p>ã€€ã€€<strong>å±€éƒ¨å˜é‡è¡¨</strong>ï¼Œé¡¾åæ€ä¹‰ï¼Œæƒ³å¿…ä¸ç”¨è§£é‡Šå¤§å®¶åº”è¯¥æ˜ç™½å®ƒçš„ä½œç”¨äº†å§ã€‚å°±æ˜¯ç”¨æ¥å­˜å‚¨æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬åœ¨æ–¹æ³•ä¸­å£°æ˜çš„éé™æ€å˜é‡ä»¥åŠå‡½æ•°å½¢å‚ï¼‰ã€‚å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œåˆ™ç›´æ¥å­˜å‚¨å®ƒçš„å€¼ï¼Œå¯¹äºå¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œåˆ™å­˜çš„æ˜¯æŒ‡å‘å¯¹è±¡çš„å¼•ç”¨ã€‚å±€éƒ¨å˜é‡è¡¨çš„å¤§å°åœ¨ç¼–è¯‘å™¨å°±å¯ä»¥ç¡®å®šå…¶å¤§å°äº†ï¼Œå› æ­¤åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´å±€éƒ¨å˜é‡è¡¨çš„å¤§å°æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚</p><p>ã€€ã€€<strong>æ“ä½œæ•°æ ˆ</strong>ï¼Œæƒ³å¿…å­¦è¿‡æ•°æ®ç»“æ„ä¸­çš„æ ˆçš„æœ‹å‹æƒ³å¿…å¯¹è¡¨è¾¾å¼æ±‚å€¼é—®é¢˜ä¸ä¼šé™Œç”Ÿï¼Œæ ˆæœ€å…¸å‹çš„ä¸€ä¸ªåº”ç”¨å°±æ˜¯ç”¨æ¥å¯¹è¡¨è¾¾å¼æ±‚å€¼ã€‚æƒ³æƒ³ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸æ–­æ‰§è¡Œè¯­å¥çš„è¿‡ç¨‹ï¼Œè€Œå½’æ ¹åˆ°åº•å°±æ˜¯è¿›è¡Œè®¡ç®—çš„è¿‡ç¨‹ã€‚å› æ­¤å¯ä»¥è¿™ä¹ˆè¯´ï¼Œç¨‹åºä¸­çš„æ‰€æœ‰è®¡ç®—è¿‡ç¨‹éƒ½æ˜¯åœ¨å€ŸåŠ©äºæ“ä½œæ•°æ ˆæ¥å®Œæˆçš„ã€‚</p><p>ã€€ã€€<strong>æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„å¼•ç”¨</strong>ï¼Œå› ä¸ºåœ¨æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½éœ€è¦ç”¨åˆ°ç±»ä¸­çš„å¸¸é‡ï¼Œæ‰€ä»¥å¿…é¡»è¦æœ‰ä¸€ä¸ªå¼•ç”¨æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡ã€‚</p><p>ã€€ã€€<strong>æ–¹æ³•è¿”å›åœ°å€</strong>ï¼Œå½“ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œè¦è¿”å›ä¹‹å‰è°ƒç”¨å®ƒçš„åœ°æ–¹ï¼Œå› æ­¤åœ¨æ ˆå¸§ä¸­å¿…é¡»ä¿å­˜ä¸€ä¸ªæ–¹æ³•è¿”å›åœ°å€ã€‚</p><p>ã€€ã€€ç”±äºæ¯ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å¯èƒ½ä¸åŒï¼Œå› æ­¤æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„Javaæ ˆï¼Œäº’ä¸å¹²æ‰°ã€‚</p><p> 3.<strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong></p><p>ã€€ã€€æœ¬åœ°æ–¹æ³•æ ˆä¸Javaæ ˆçš„ä½œç”¨å’ŒåŸç†éå¸¸ç›¸ä¼¼ã€‚åŒºåˆ«åªä¸è¿‡æ˜¯Javaæ ˆæ˜¯ä¸ºæ‰§è¡ŒJavaæ–¹æ³•æœåŠ¡çš„ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™æ˜¯ä¸ºæ‰§è¡Œæœ¬åœ°æ–¹æ³•ï¼ˆNative Methodï¼‰æœåŠ¡çš„ã€‚åœ¨JVMè§„èŒƒä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹æœ¬åœ°æ–¹å‘å±•çš„å…·ä½“å®ç°æ–¹æ³•ä»¥åŠæ•°æ®ç»“æ„ä½œå¼ºåˆ¶è§„å®šï¼Œè™šæ‹Ÿæœºå¯ä»¥è‡ªç”±å®ç°å®ƒã€‚åœ¨HotSoptè™šæ‹Ÿæœºä¸­ç›´æ¥å°±æŠŠæœ¬åœ°æ–¹æ³•æ ˆå’ŒJavaæ ˆåˆäºŒä¸ºä¸€ã€‚</p><p>4.<strong>å †</strong></p><p>ã€€ã€€åœ¨Cè¯­è¨€ä¸­ï¼Œå †è¿™éƒ¨åˆ†ç©ºé—´æ˜¯å”¯ä¸€ä¸€ä¸ªç¨‹åºå‘˜å¯ä»¥ç®¡ç†çš„å†…å­˜åŒºåŸŸã€‚ç¨‹åºå‘˜å¯ä»¥é€šè¿‡mallocå‡½æ•°å’Œfreeå‡½æ•°åœ¨å †ä¸Šç”³è¯·å’Œé‡Šæ”¾ç©ºé—´ã€‚é‚£ä¹ˆåœ¨Javaä¸­æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><p>ã€€ã€€Javaä¸­çš„å †æ˜¯ç”¨æ¥å­˜å‚¨å¯¹è±¡æœ¬èº«çš„ä»¥åŠæ•°ç»„ï¼ˆå½“ç„¶ï¼Œæ•°ç»„å¼•ç”¨æ˜¯å­˜æ”¾åœ¨Javaæ ˆä¸­çš„ï¼‰ã€‚åªä¸è¿‡å’ŒCè¯­è¨€ä¸­çš„ä¸åŒï¼Œåœ¨Javaä¸­ï¼Œç¨‹åºå‘˜åŸºæœ¬ä¸ç”¨å»å…³å¿ƒç©ºé—´é‡Šæ”¾çš„é—®é¢˜ï¼ŒJavaçš„åƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨è¿›è¡Œå¤„ç†ã€‚å› æ­¤è¿™éƒ¨åˆ†ç©ºé—´ä¹Ÿæ˜¯Javaåƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚å¦å¤–ï¼Œå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ï¼Œåœ¨JVMä¸­åªæœ‰ä¸€ä¸ªå †ã€‚</p><p> 5.<strong>æ–¹æ³•åŒº</strong></p><p>ã€€ã€€æ–¹æ³•åŒºåœ¨JVMä¸­ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„åŒºåŸŸï¼Œå®ƒä¸å †ä¸€æ ·ï¼Œæ˜¯è¢«çº¿ç¨‹å…±äº«çš„åŒºåŸŸã€‚åœ¨æ–¹æ³•åŒºä¸­ï¼Œå­˜å‚¨äº†æ¯ä¸ªç±»çš„ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç±»çš„åç§°ã€æ–¹æ³•ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ï¼‰ã€é™æ€å˜é‡ã€å¸¸é‡ä»¥åŠç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰ã€‚</p><p>ã€€ã€€åœ¨Classæ–‡ä»¶ä¸­é™¤äº†ç±»çš„å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼Œç”¨æ¥å­˜å‚¨ç¼–è¯‘æœŸé—´ç”Ÿæˆçš„å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚</p><p>ã€€ã€€åœ¨æ–¹æ³•åŒºä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„éƒ¨åˆ†å°±æ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå®ƒæ˜¯æ¯ä¸€ä¸ªç±»æˆ–æ¥å£çš„å¸¸é‡æ± çš„è¿è¡Œæ—¶è¡¨ç¤ºå½¢å¼ï¼Œåœ¨ç±»å’Œæ¥å£è¢«åŠ è½½åˆ°JVMåï¼Œå¯¹åº”çš„è¿è¡Œæ—¶å¸¸é‡æ± å°±è¢«åˆ›å»ºå‡ºæ¥ã€‚å½“ç„¶å¹¶éClassæ–‡ä»¶å¸¸é‡æ± ä¸­çš„å†…å®¹æ‰èƒ½è¿›å…¥è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œåœ¨è¿è¡ŒæœŸé—´ä¹Ÿå¯å°†æ–°çš„å¸¸é‡æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œæ¯”å¦‚Stringçš„internæ–¹æ³•ã€‚</p><p>ã€€ã€€åœ¨JVMè§„èŒƒä¸­ï¼Œæ²¡æœ‰å¼ºåˆ¶è¦æ±‚æ–¹æ³•åŒºå¿…é¡»å®ç°åƒåœ¾å›æ”¶ã€‚å¾ˆå¤šäººä¹ æƒ¯å°†æ–¹æ³•åŒºç§°ä¸ºâ€œæ°¸ä¹…ä»£â€ï¼Œæ˜¯å› ä¸ºHotSpotè™šæ‹Ÿæœºä»¥æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºï¼Œä»è€ŒJVMçš„åƒåœ¾æ”¶é›†å™¨å¯ä»¥åƒç®¡ç†å †åŒºä¸€æ ·ç®¡ç†è¿™éƒ¨åˆ†åŒºåŸŸï¼Œä»è€Œä¸éœ€è¦ä¸“é—¨ä¸ºè¿™éƒ¨åˆ†è®¾è®¡åƒåœ¾å›æ”¶æœºåˆ¶ã€‚ä¸è¿‡è‡ªä»JDK7ä¹‹åï¼ŒHotspotè™šæ‹Ÿæœºä¾¿å°†è¿è¡Œæ—¶å¸¸é‡æ± ä»æ°¸ä¹…ä»£ç§»é™¤äº†ã€‚</p><h3 id="Javaå¯¹è±¡æ¨¡å‹çš„å†…å­˜å¸ƒå±€"><a href="#Javaå¯¹è±¡æ¨¡å‹çš„å†…å­˜å¸ƒå±€" class="headerlink" title="Javaå¯¹è±¡æ¨¡å‹çš„å†…å­˜å¸ƒå±€"></a>Javaå¯¹è±¡æ¨¡å‹çš„å†…å­˜å¸ƒå±€</h3><p>javaæ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œè€ŒJavaå¯¹è±¡åœ¨JVMä¸­çš„å­˜å‚¨ä¹Ÿæ˜¯æœ‰ä¸€å®šçš„ç»“æ„çš„ã€‚è€Œè¿™ä¸ªå…³äºJavaå¯¹è±¡è‡ªèº«çš„å­˜å‚¨æ¨¡å‹ç§°ä¹‹ä¸ºJavaå¯¹è±¡æ¨¡å‹ã€‚</p><p>HotSpotè™šæ‹Ÿæœºä¸­ï¼Œè®¾è®¡äº†ä¸€ä¸ªOOP-Klass Modelã€‚OOPï¼ˆOrdinary Object Pointerï¼‰æŒ‡çš„æ˜¯æ™®é€šå¯¹è±¡æŒ‡é’ˆï¼Œè€ŒKlassç”¨æ¥æè¿°å¯¹è±¡å®ä¾‹çš„å…·ä½“ç±»å‹ã€‚</p><p>æ¯ä¸€ä¸ªJavaç±»ï¼Œåœ¨è¢«JVMåŠ è½½çš„æ—¶å€™ï¼ŒJVMä¼šç»™è¿™ä¸ªç±»åˆ›å»ºä¸€ä¸ª<code>instanceKlass</code>ï¼Œä¿å­˜åœ¨æ–¹æ³•åŒºï¼Œç”¨æ¥åœ¨JVMå±‚è¡¨ç¤ºè¯¥Javaç±»ã€‚å½“æˆ‘ä»¬åœ¨Javaä»£ç ä¸­ï¼Œä½¿ç”¨newåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼ŒJVMä¼šåˆ›å»ºä¸€ä¸ª<code>instanceOopDesc</code>å¯¹è±¡ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º3å—åŒºåŸŸï¼šå¯¹è±¡å¤´ï¼ˆHeaderï¼‰ã€ å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å’Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰ã€‚ </p><ol><li>å¯¹è±¡å¤´ï¼šæ ‡è®°å­—ï¼ˆ32ä½è™šæ‹Ÿæœº4Bï¼Œ64ä½è™šæ‹Ÿæœº8Bï¼‰ + ç±»å‹æŒ‡é’ˆï¼ˆ32ä½è™šæ‹Ÿæœº4Bï¼Œ64ä½è™šæ‹Ÿæœº8Bï¼‰+ [æ•°ç»„é•¿ï¼ˆå¯¹äºæ•°ç»„å¯¹è±¡æ‰éœ€è¦æ­¤éƒ¨åˆ†ä¿¡æ¯ï¼‰]</li><li>å®ä¾‹æ•°æ®ï¼šå­˜å‚¨çš„æ˜¯çœŸæ­£æœ‰æ•ˆæ•°æ®ï¼Œå¦‚å„ç§å­—æ®µå†…å®¹ï¼Œå„å­—æ®µçš„åˆ†é…ç­–ç•¥ä¸ºlongs/doublesã€intsã€shorts/charsã€bytes/booleanã€oops(ordinary object pointers)ï¼Œç›¸åŒå®½åº¦çš„å­—æ®µæ€»æ˜¯è¢«åˆ†é…åˆ°ä¸€èµ·ï¼Œä¾¿äºä¹‹åå–æ•°æ®ã€‚çˆ¶ç±»å®šä¹‰çš„å˜é‡ä¼šå‡ºç°åœ¨å­ç±»å®šä¹‰çš„å˜é‡çš„å‰é¢ã€‚</li><li>å¯¹é½å¡«å……ï¼šå¯¹äº64ä½è™šæ‹Ÿæœºæ¥è¯´ï¼Œå¯¹è±¡å¤§å°å¿…é¡»æ˜¯8Bçš„æ•´æ•°å€ï¼Œä¸å¤Ÿçš„è¯éœ€è¦å ä½å¡«å……</li></ol><h3 id="JVMå†…å­˜åƒåœ¾æ”¶é›†å™¨"><a href="#JVMå†…å­˜åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="JVMå†…å­˜åƒåœ¾æ”¶é›†å™¨"></a>JVMå†…å­˜åƒåœ¾æ”¶é›†å™¨</h3><p>ä¸ºäº†ç†è§£ç°æœ‰æ”¶é›†å™¨ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›æœ¯è¯­ã€‚æœ€åŸºæœ¬çš„åƒåœ¾æ”¶é›†æ¶‰åŠè¯†åˆ«ä¸å†ä½¿ç”¨çš„å†…å­˜å¹¶ä½¿å…¶å¯é‡ç”¨ã€‚ç°ä»£æ”¶é›†å™¨åœ¨å‡ ä¸ªé˜¶æ®µè¿›è¡Œè¿™ä¸€è¿‡ç¨‹ï¼Œå¯¹äºè¿™äº›é˜¶æ®µæˆ‘ä»¬å¾€å¾€æœ‰å¦‚ä¸‹æè¿°ï¼š</p><ul><li>å¹¶è¡Œ- åœ¨JVMè¿è¡Œæ—¶ï¼ŒåŒæ—¶å­˜åœ¨åº”ç”¨ç¨‹åºçº¿ç¨‹å’Œåƒåœ¾æ”¶é›†å™¨çº¿ç¨‹ã€‚ å¹¶è¡Œé˜¶æ®µæ˜¯ç”±å¤šä¸ªgcçº¿ç¨‹æ‰§è¡Œï¼Œå³gcå·¥ä½œåœ¨å®ƒä»¬ä¹‹é—´åˆ†é…ã€‚ ä¸æ¶‰åŠGCçº¿ç¨‹æ˜¯å¦éœ€è¦æš‚åœåº”ç”¨ç¨‹åºçº¿ç¨‹ã€‚</li><li>ä¸²è¡Œ- ä¸²è¡Œé˜¶æ®µä»…åœ¨å•ä¸ªgcçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚ä¸ä¹‹å‰ä¸€æ ·ï¼Œå®ƒä¹Ÿæ²¡æœ‰è¯´æ˜GCçº¿ç¨‹æ˜¯å¦éœ€è¦æš‚åœåº”ç”¨ç¨‹åºçº¿ç¨‹ã€‚</li><li>STW - STWé˜¶æ®µï¼Œåº”ç”¨ç¨‹åºçº¿ç¨‹è¢«æš‚åœï¼Œä»¥ä¾¿gcæ‰§è¡Œå…¶å·¥ä½œã€‚ å½“åº”ç”¨ç¨‹åºå› ä¸ºGCæš‚åœæ—¶ï¼Œè¿™é€šå¸¸æ˜¯ç”±äºStop The Worldé˜¶æ®µã€‚</li><li>å¹¶å‘ -å¦‚æœä¸€ä¸ªé˜¶æ®µæ˜¯å¹¶å‘çš„ï¼Œé‚£ä¹ˆGCçº¿ç¨‹å¯ä»¥å’Œåº”ç”¨ç¨‹åºçº¿ç¨‹åŒæ—¶è¿›è¡Œã€‚ å¹¶å‘é˜¶æ®µå¾ˆå¤æ‚ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦åœ¨é˜¶æ®µå®Œæˆä¹‹å‰å¤„ç†å¯èƒ½ä½¿å·¥ä½œæ— æ•ˆï¼ˆè¯‘è€…æ³¨ï¼šå› ä¸ºæ˜¯å¹¶å‘è¿›è¡Œçš„ï¼ŒGCçº¿ç¨‹åœ¨å®Œæˆä¸€é˜¶æ®µçš„åŒæ—¶ï¼Œåº”ç”¨çº¿ç¨‹ä¹Ÿåœ¨å·¥ä½œäº§ç”Ÿæ“ä½œå†…å­˜ï¼Œæ‰€ä»¥éœ€è¦é¢å¤–å¤„ç†ï¼‰çš„åº”ç”¨ç¨‹åºçº¿ç¨‹ã€‚</li><li>å¢é‡ -å¦‚æœä¸€ä¸ªé˜¶æ®µæ˜¯å¢é‡çš„ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¿è¡Œä¸€æ®µæ—¶é—´ä¹‹åç”±äºæŸäº›æ¡ä»¶æå‰ç»ˆæ­¢ï¼Œä¾‹å¦‚éœ€è¦æ‰§è¡Œæ›´é«˜ä¼˜å…ˆçº§çš„gcé˜¶æ®µï¼ŒåŒæ—¶ä»ç„¶å®Œæˆç”Ÿäº§æ€§å·¥ä½œã€‚ å¢é‡é˜¶æ®µä¸éœ€è¦å®Œå…¨å®Œæˆçš„é˜¶æ®µå½¢æˆé²œæ˜å¯¹æ¯”ã€‚</li></ul><h4 id="Serialæ”¶é›†å™¨"><a href="#Serialæ”¶é›†å™¨" class="headerlink" title="Serialæ”¶é›†å™¨"></a>Serialæ”¶é›†å™¨</h4><p>Serialæ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬çš„æ”¶é›†å™¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œå®ƒä»ç„¶æ˜¯JVMåœ¨Clientæ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚å®ƒæœ‰ç€ä¼˜äºå…¶ä»–æ”¶é›†å™¨çš„åœ°æ–¹ï¼šç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹æ¯”è¾ƒï¼‰ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåªåšåƒåœ¾æ”¶é›†è‡ªç„¶ä¹Ÿè·å¾—æœ€é«˜çš„æ•ˆç‡ã€‚åœ¨ç”¨æˆ·æ¡Œé¢åœºæ™¯ä¸‹ï¼Œåˆ†é…ç»™JVMçš„å†…å­˜ä¸ä¼šå¤ªå¤šï¼Œåœé¡¿æ—¶é—´å®Œå…¨å¯ä»¥åœ¨å‡ ååˆ°ä¸€ç™¾å¤šæ¯«ç§’ä¹‹é—´ï¼Œåªè¦æ”¶é›†ä¸é¢‘ç¹ï¼Œè¿™æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚</p><h4 id="ParNewæ”¶é›†å™¨"><a href="#ParNewæ”¶é›†å™¨" class="headerlink" title="ParNewæ”¶é›†å™¨"></a>ParNewæ”¶é›†å™¨</h4><p>ParNewæ˜¯Serialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œåœ¨å›æ”¶ç®—æ³•ã€å¯¹è±¡åˆ†é…åŸåˆ™ä¸Šéƒ½æ˜¯ä¸€è‡´çš„ã€‚ParNewæ”¶é›†å™¨æ˜¯è®¸å¤šè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ï¼Œå…¶ä¸»è¦åœ¨äºé™¤äº†Serialæ”¶é›†å™¨ï¼Œç›®å‰åªæœ‰ParNewæ”¶é›†å™¨èƒ½å¤Ÿä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œã€‚</p><h4 id="Parallel-Scavengeæ”¶é›†å™¨"><a href="#Parallel-Scavengeæ”¶é›†å™¨" class="headerlink" title="Parallel Scavengeæ”¶é›†å™¨"></a>Parallel Scavengeæ”¶é›†å™¨</h4><p>Parallel Scavengeæ”¶é›†å™¨æ˜¯ä¸€ä¸ªæ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ï¼Œå…¶ä½¿ç”¨çš„ç®—æ³•æ˜¯å¤åˆ¶ç®—æ³•ï¼Œä¹Ÿæ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚</p><p>Parallel Scavenge æ”¶é›†å™¨æ›´å…³æ³¨å¯æ§åˆ¶çš„ååé‡ï¼Œååé‡ç­‰äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´/(è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´)ã€‚ç›´è§‚ä¸Šï¼Œåªè¦æœ€å¤§çš„åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´è¶Šå°ï¼Œååé‡æ˜¯è¶Šé«˜çš„ï¼Œä½†æ˜¯GCåœé¡¿æ—¶é—´çš„ç¼©çŸ­æ˜¯ä»¥ç‰ºç‰²ååé‡å’Œæ–°ç”Ÿä»£ç©ºé—´ä½œä¸ºä»£ä»·çš„ã€‚æ¯”å¦‚åŸæ¥10ç§’æ”¶é›†ä¸€æ¬¡ï¼Œæ¯æ¬¡åœé¡¿100æ¯«ç§’ï¼Œç°åœ¨å˜æˆ5ç§’æ”¶é›†ä¸€æ¬¡ï¼Œæ¯æ¬¡åœé¡¿70æ¯«ç§’ã€‚åœé¡¿æ—¶é—´ä¸‹é™çš„åŒæ—¶ï¼Œååé‡ä¹Ÿä¸‹é™äº†ã€‚</p><p>åœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼›è€Œé«˜ååé‡åˆ™å¯ä»¥æœ€é«˜æ•ˆçš„åˆ©ç”¨CPUçš„æ—¶é—´ï¼Œå°½å¿«çš„å®Œæˆè®¡ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚ç”¨äºåå°è¿ç®—ã€‚</p><h4 id="Serial-Oldæ”¶é›†å™¨"><a href="#Serial-Oldæ”¶é›†å™¨" class="headerlink" title="Serial Oldæ”¶é›†å™¨"></a>Serial Oldæ”¶é›†å™¨</h4><p>Serial Oldæ”¶é›†å™¨æ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œé‡‡ç”¨â€œæ ‡è®°-æ•´ç†ç®—æ³•â€è¿›è¡Œå›æ”¶ã€‚å…¶è¿è¡Œè¿‡ç¨‹ä¸Serialæ”¶é›†å™¨ä¸€æ ·ã€‚</p><h4 id="Parallel-Oldæ”¶é›†å™¨"><a href="#Parallel-Oldæ”¶é›†å™¨" class="headerlink" title="Parallel Oldæ”¶é›†å™¨"></a>Parallel Oldæ”¶é›†å™¨</h4><p>Parallel Oldæ”¶é›†å™¨æ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å’Œæ ‡è®°-æ•´ç†ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å…¶é€šå¸¸ä¸Parallel Scavengeæ”¶é›†å™¨é…åˆä½¿ç”¨ï¼Œâ€œååé‡ä¼˜å…ˆâ€æ”¶é›†å™¨æ˜¯è¿™ä¸ªç»„åˆçš„ç‰¹ç‚¹ï¼Œåœ¨æ³¨é‡ååé‡å’ŒCPUèµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªç»„åˆã€‚</p><h4 id="CMS-æ”¶é›†å™¨"><a href="#CMS-æ”¶é›†å™¨" class="headerlink" title="CMS æ”¶é›†å™¨"></a>CMS æ”¶é›†å™¨</h4><p>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼ŒCMSæ”¶é›†å™¨é‡‡ç”¨æ ‡è®°â€“æ¸…é™¤ç®—æ³•ï¼Œè¿è¡Œåœ¨è€å¹´ä»£ã€‚ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆå§‹æ ‡è®°</li><li>å¹¶å‘æ ‡è®°</li><li>é‡æ–°æ ‡è®°</li><li>å¹¶å‘æ¸…é™¤</li></ul><p>å…¶ä¸­åˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°ä»ç„¶éœ€è¦â€œStop the worldâ€ã€‚åˆå§‹æ ‡è®°ä»…ä»…æ ‡è®°GC Rootèƒ½ç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œå¹¶å‘æ ‡è®°å°±æ˜¯è¿›è¡ŒGC Root Tracingè¿‡ç¨‹ï¼Œè€Œé‡æ–°æ ‡è®°åˆ™æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°å˜åŠ¨çš„é‚£éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚</p><p>ç”±äºæ•´ä¸ªè¿‡ç¨‹ä¸­æœ€è€—æ—¶çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤ï¼Œæ”¶é›†çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œæ‰€ä»¥æ€»ä½“ä¸Šæ¥è¯´ï¼ŒCMSæ”¶é›†å™¨å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„ã€‚è™½ç„¶CMSä¼˜ç‚¹æ˜¯å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå·²ç»æ˜¯ä¸€ä¸ªä¸é”™çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸‰ä¸ªæ˜¾è‘—çš„ç¼ºç‚¹ï¼š</p><ol><li>CMSæ”¶é›†å™¨å¯¹CPUèµ„æºå¾ˆæ•æ„Ÿã€‚åœ¨å¹¶å‘é˜¶æ®µï¼Œè™½ç„¶å®ƒä¸ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åœé¡¿ï¼Œä½†æ˜¯ä¼šå› ä¸ºå ç”¨ä¸€éƒ¨åˆ†çº¿ç¨‹ï¼ˆCPUèµ„æºï¼‰è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ã€‚</li><li>CMSæ”¶é›†å™¨ä¸èƒ½å¤„ç†æµ®åŠ¨åƒåœ¾ã€‚æ‰€è°“çš„â€œæµ®åŠ¨åƒåœ¾â€ï¼Œå°±æ˜¯åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œç”±äºç”¨æˆ·ç¨‹åºåœ¨è¿è¡Œï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¼šæœ‰æ–°çš„åƒåœ¾äº§ç”Ÿï¼Œè¿™éƒ¨åˆ†åƒåœ¾è¢«æ ‡è®°è¿‡åï¼ŒCMSæ— æ³•åœ¨å½“æ¬¡é›†ä¸­å¤„ç†å®ƒä»¬ï¼Œåªå¥½åœ¨ä¸‹ä¸€æ¬¡GCçš„æ—¶å€™å¤„ç†ï¼Œè¿™éƒ¨åˆ†æœªå¤„ç†çš„åƒåœ¾å°±ç§°ä¸ºâ€œæµ®åŠ¨åƒåœ¾â€ã€‚ä¹Ÿæ˜¯ç”±äºåœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç¨‹åºè¿˜éœ€è¦è¿è¡Œï¼Œå³è¿˜éœ€è¦é¢„ç•™è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ä¾›ç”¨æˆ·ä½¿ç”¨ï¼Œå› æ­¤CMSæ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰åˆ°è€å¹´ä»£å‡ ä¹å¡«æ»¡æ‰è¿›è¡Œæ”¶é›†ï¼Œéœ€è¦é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´æä¾›å¹¶å‘æ”¶é›†æ—¶ç¨‹åºè¿ä½œä½¿ç”¨ã€‚è¦æ˜¯CMSé¢„ç•™çš„å†…å­˜ç©ºé—´ä¸èƒ½æ»¡è¶³ç¨‹åºçš„è¦æ±‚ï¼Œè¿™æ˜¯JVMå°±ä¼šå¯åŠ¨é¢„å¤‡æ–¹æ¡ˆï¼šä¸´æ—¶å¯åŠ¨Serial Oldæ”¶é›†å™¨æ¥æ”¶é›†è€å¹´ä»£ï¼Œè¿™æ ·åœé¡¿çš„æ—¶é—´å°±ä¼šå¾ˆé•¿ã€‚</li><li>ç”±äºCMSä½¿ç”¨æ ‡è®°â€“æ¸…é™¤ç®—æ³•ï¼Œæ‰€ä»¥åœ¨æ”¶é›†ä¹‹åä¼šäº§ç”Ÿå¤§é‡å†…å­˜ç¢ç‰‡ã€‚å½“å†…å­˜ç¢ç‰‡è¿‡å¤šæ—¶ï¼Œå°†ä¼šç»™åˆ†é…å¤§å¯¹è±¡å¸¦æ¥å›°éš¾ï¼Œè¿™æ˜¯å°±ä¼šè¿›è¡ŒFull GCã€‚</li></ol><h4 id="G1æ”¶é›†å™¨"><a href="#G1æ”¶é›†å™¨" class="headerlink" title="G1æ”¶é›†å™¨"></a>G1æ”¶é›†å™¨</h4><p>G1æ”¶é›†å™¨ä¸CMSç›¸æ¯”æœ‰å¾ˆå¤§çš„æ”¹è¿›ï¼š</p><p>Â· G1æ”¶é›†å™¨é‡‡ç”¨æ ‡è®°â€“æ•´ç†ç®—æ³•å®ç°ã€‚</p><p>Â· å¯ä»¥éå¸¸ç²¾ç¡®åœ°æ§åˆ¶åœé¡¿ã€‚</p><p>â€‹    G1æ”¶é›†å™¨å¯ä»¥å®ç°åœ¨åŸºæœ¬ä¸ç‰ºç‰²ååé‡çš„æƒ…å†µä¸‹å®Œæˆä½åœé¡¿çš„å†…å­˜å›æ”¶ï¼Œè¿™æ˜¯ç”±äºå®ƒæåŠ›çš„é¿å…å…¨åŒºåŸŸçš„å›æ”¶ï¼ŒG1æ”¶é›†å™¨å°†Javaå †ï¼ˆåŒ…æ‹¬æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼‰åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼ˆRegionï¼‰ï¼Œå¹¶åœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„åŒºåŸŸ ã€‚</p><h4 id="ZGCæ”¶é›†å™¨"><a href="#ZGCæ”¶é›†å™¨" class="headerlink" title="ZGCæ”¶é›†å™¨"></a>ZGCæ”¶é›†å™¨</h4><p>Java 11 æ–°åŠ å…¥çš„ZGCåƒåœ¾æ”¶é›†å™¨å·ç§°å¯ä»¥è¾¾åˆ°10ms ä»¥ä¸‹çš„ GC åœé¡¿ï¼ŒZGCç»™Hotspot Garbage Collectorså¢åŠ äº†ä¸¤ç§æ–°æŠ€æœ¯ï¼šç€è‰²æŒ‡é’ˆå’Œè¯»å±éšœã€‚ä¸‹é¢å¼•ç”¨å›½å¤–æ–‡ç« è¯´çš„å†…å®¹ï¼š</p><blockquote><h5 id="ç€è‰²æŒ‡é’ˆ"><a href="#ç€è‰²æŒ‡é’ˆ" class="headerlink" title="ç€è‰²æŒ‡é’ˆ"></a><strong>ç€è‰²æŒ‡é’ˆ</strong></h5><p>ç€è‰²æŒ‡é’ˆæ˜¯ä¸€ç§å°†ä¿¡æ¯å­˜å‚¨åœ¨æŒ‡é’ˆï¼ˆæˆ–ä½¿ç”¨Javaæœ¯è¯­å¼•ç”¨ï¼‰ä¸­çš„æŠ€æœ¯ã€‚å› ä¸ºåœ¨64ä½å¹³å°ä¸Šï¼ˆZGCä»…æ”¯æŒ64ä½å¹³å°ï¼‰ï¼ŒæŒ‡é’ˆå¯ä»¥å¤„ç†æ›´å¤šçš„å†…å­˜ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä¸€äº›ä½æ¥å­˜å‚¨çŠ¶æ€ã€‚ ZGCå°†é™åˆ¶æœ€å¤§æ”¯æŒ4Tbå †ï¼ˆ42-bitsï¼‰ï¼Œé‚£ä¹ˆä¼šå‰©ä¸‹22ä½å¯ç”¨ï¼Œå®ƒç›®å‰ä½¿ç”¨äº†4ä½ï¼š <code>finalizable</code>ï¼Œ <code>remap</code>ï¼Œ <code>mark0</code>å’Œ<code>mark1</code>ã€‚ æˆ‘ä»¬ç¨åè§£é‡Šå®ƒä»¬çš„ç”¨é€”ã€‚</p><p>ç€è‰²æŒ‡é’ˆçš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå½“æ‚¨éœ€è¦å–æ¶ˆç€è‰²æ—¶ï¼Œå®ƒéœ€è¦é¢å¤–çš„å·¥ä½œï¼ˆå› ä¸ºéœ€è¦å±è”½ä¿¡æ¯ä½ï¼‰ã€‚ åƒSPARCè¿™æ ·çš„å¹³å°æœ‰å†…ç½®ç¡¬ä»¶æ”¯æŒæŒ‡é’ˆå±è”½æ‰€ä»¥ä¸æ˜¯é—®é¢˜ï¼Œè€Œå¯¹äºx86å¹³å°æ¥è¯´ï¼ŒZGCå›¢é˜Ÿä½¿ç”¨äº†ç®€æ´çš„å¤šé‡æ˜ å°„æŠ€å·§ã€‚</p><h5 id="å¤šé‡æ˜ å°„"><a href="#å¤šé‡æ˜ å°„" class="headerlink" title="å¤šé‡æ˜ å°„"></a><strong>å¤šé‡æ˜ å°„</strong></h5><p>è¦äº†è§£å¤šé‡æ˜ å°„çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬éœ€è¦ç®€è¦è§£é‡Šè™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜ä¹‹é—´çš„åŒºåˆ«ã€‚ ç‰©ç†å†…å­˜æ˜¯ç³»ç»Ÿå¯ç”¨çš„å®é™…å†…å­˜ï¼Œé€šå¸¸æ˜¯å®‰è£…çš„DRAMèŠ¯ç‰‡çš„å®¹é‡ã€‚ è™šæ‹Ÿå†…å­˜æ˜¯æŠ½è±¡çš„ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºå¯¹ï¼ˆé€šå¸¸æ˜¯éš”ç¦»çš„ï¼‰ç‰©ç†å†…å­˜æœ‰è‡ªå·±çš„è§†å›¾ã€‚ æ“ä½œç³»ç»Ÿè´Ÿè´£ç»´æŠ¤è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜èŒƒå›´ä¹‹é—´çš„æ˜ å°„ï¼Œå®ƒé€šè¿‡ä½¿ç”¨é¡µè¡¨å’Œå¤„ç†å™¨çš„å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰å’Œè½¬æ¢æŸ¥æ‰¾ç¼“å†²å™¨ï¼ˆTLBï¼‰æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œåè€…è½¬æ¢åº”ç”¨ç¨‹åºè¯·æ±‚çš„åœ°å€ã€‚</p><p>å¤šé‡æ˜ å°„æ¶‰åŠå°†ä¸åŒèŒƒå›´çš„è™šæ‹Ÿå†…å­˜æ˜ å°„åˆ°åŒä¸€ç‰©ç†å†…å­˜ã€‚ ç”±äºè®¾è®¡ä¸­åªæœ‰ä¸€ä¸ª<code>remap</code>ï¼Œ<code>mark0</code>å’Œ<code>mark1</code>åœ¨ä»»ä½•æ—¶é—´ç‚¹éƒ½å¯ä»¥ä¸º1ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä¸‰ä¸ªæ˜ å°„æ¥å®Œæˆæ­¤æ“ä½œã€‚ ZGCæºä»£ç ä¸­æœ‰ä¸€ä¸ªå¾ˆå¥½çš„å›¾è¡¨å¯ä»¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚</p><h5 id="è¯»å±éšœ"><a href="#è¯»å±éšœ" class="headerlink" title="è¯»å±éšœ"></a><strong>è¯»å±éšœ</strong></h5><p>è¯»å±éšœæ˜¯æ¯å½“åº”ç”¨ç¨‹åºçº¿ç¨‹ä»å †åŠ è½½å¼•ç”¨æ—¶è¿è¡Œçš„ä»£ç ç‰‡æ®µï¼ˆå³è®¿é—®å¯¹è±¡ä¸Šçš„éåŸç”Ÿå­—æ®µnon-primitive fieldï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="function"><span class="keyword">void</span> <span class="title">printName</span><span class="params">( Person person )</span> </span>&#123;</span><br><span class="line">&gt;     String name = person.name;  <span class="comment">// è¿™é‡Œè§¦å‘è¯»å±éšœ</span></span><br><span class="line">&gt;                                 <span class="comment">// å› ä¸ºéœ€è¦ä»heapè¯»å–å¼•ç”¨ </span></span><br><span class="line">&gt;                                 <span class="comment">// </span></span><br><span class="line">&gt;     System.out.println(name);   <span class="comment">// è¿™é‡Œæ²¡æœ‰ç›´æ¥è§¦å‘è¯»å±éšœ</span></span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒString name = person.name è®¿é—®äº†å †ä¸Šçš„personå¼•ç”¨ï¼Œç„¶åå°†å¼•ç”¨åŠ è½½åˆ°æœ¬åœ°çš„nameå˜é‡ã€‚æ­¤æ—¶è§¦å‘è¯»å±éšœã€‚ Systemt.outé‚£è¡Œä¸ä¼šç›´æ¥è§¦å‘è¯»å±éšœï¼Œå› ä¸ºæ²¡æœ‰æ¥è‡ªå †çš„å¼•ç”¨åŠ è½½ï¼ˆnameæ˜¯å±€éƒ¨å˜é‡ï¼Œå› æ­¤æ²¡æœ‰ä»å †åŠ è½½å¼•ç”¨ï¼‰ã€‚ ä½†æ˜¯Systemå’Œoutï¼Œæˆ–è€…printlnå†…éƒ¨å¯èƒ½ä¼šè§¦å‘å…¶ä»–è¯»å±éšœã€‚</p><p>è¿™ä¸å…¶ä»–GCä½¿ç”¨çš„å†™å±éšœå½¢æˆå¯¹æ¯”ï¼Œä¾‹å¦‚G1ã€‚è¯»å±éšœçš„å·¥ä½œæ˜¯æ£€æŸ¥å¼•ç”¨çš„çŠ¶æ€ï¼Œå¹¶åœ¨å°†å¼•ç”¨ï¼ˆæˆ–è€…ç”šè‡³æ˜¯ä¸åŒçš„å¼•ç”¨ï¼‰è¿”å›ç»™åº”ç”¨ç¨‹åºä¹‹å‰æ‰§è¡Œä¸€äº›å·¥ä½œã€‚ åœ¨ZGCä¸­ï¼Œå®ƒé€šè¿‡æµ‹è¯•åŠ è½½çš„å¼•ç”¨æ¥æ‰§è¡Œæ­¤ä»»åŠ¡ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦è®¾ç½®äº†æŸäº›ä½ã€‚ å¦‚æœé€šè¿‡äº†æµ‹è¯•ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•å…¶ä»–å·¥ä½œï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™åœ¨å°†å¼•ç”¨è¿”å›ç»™åº”ç”¨ç¨‹åºä¹‹å‰æ‰§è¡ŒæŸäº›ç‰¹å®šäºé˜¶æ®µçš„ä»»åŠ¡ã€‚</p><h5 id="æ ‡è®°"><a href="#æ ‡è®°" class="headerlink" title="æ ‡è®°"></a><strong>æ ‡è®°</strong></h5><p>ç°åœ¨æˆ‘ä»¬äº†è§£äº†è¿™ä¸¤ç§æ–°æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ZGçš„GCå¾ªç¯ã€‚</p><p>GCå¾ªç¯çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯æ ‡è®°ã€‚æ ‡è®°åŒ…æ‹¬æŸ¥æ‰¾å’Œæ ‡è®°è¿è¡Œä¸­çš„åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®çš„æ‰€æœ‰å †å¯¹è±¡ï¼Œæ¢å¥è¯è¯´ï¼ŒæŸ¥æ‰¾ä¸æ˜¯åƒåœ¾çš„å¯¹è±¡ã€‚</p><p>ZGCçš„æ ‡è®°åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µã€‚ ç¬¬ä¸€é˜¶æ®µæ˜¯STWï¼Œå…¶ä¸­GC rootsè¢«æ ‡è®°ä¸ºæ´»å¯¹è±¡ã€‚ GC rootsç±»ä¼¼äºå±€éƒ¨å˜é‡ï¼Œé€šè¿‡å®ƒå¯ä»¥è®¿é—®å †ä¸Šå…¶ä»–å¯¹è±¡ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸èƒ½é€šè¿‡éå†ä»rootså¼€å§‹çš„å¯¹è±¡å›¾æ¥è®¿é—®ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºä¹Ÿå°±æ— æ³•è®¿é—®å®ƒï¼Œåˆ™è¯¥å¯¹è±¡è¢«è®¤ä¸ºæ˜¯åƒåœ¾ã€‚ä»rootsè®¿é—®çš„å¯¹è±¡é›†åˆç§°ä¸ºLiveé›†ã€‚GC rootsæ ‡è®°æ­¥éª¤éå¸¸çŸ­ï¼Œå› ä¸ºrootsçš„æ€»æ•°é€šå¸¸æ¯”è¾ƒå°ã€‚</p><p>è¯¥é˜¶æ®µå®Œæˆåï¼Œåº”ç”¨ç¨‹åºæ¢å¤æ‰§è¡Œï¼ŒZGCå¼€å§‹ä¸‹ä¸€é˜¶æ®µï¼Œè¯¥é˜¶æ®µåŒæ—¶éå†å¯¹è±¡å›¾å¹¶æ ‡è®°æ‰€æœ‰å¯è®¿é—®çš„å¯¹è±¡ã€‚ åœ¨æ­¤é˜¶æ®µæœŸé—´ï¼Œè¯»å±éšœé’ˆä½¿ç”¨æ©ç æµ‹è¯•æ‰€æœ‰å·²åŠ è½½çš„å¼•ç”¨ï¼Œè¯¥æ©ç ç¡®å®šå®ƒä»¬æ˜¯å¦å·²æ ‡è®°æˆ–å°šæœªæ ‡è®°ï¼Œå¦‚æœå°šæœªæ ‡è®°å¼•ç”¨ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°é˜Ÿåˆ—ä»¥è¿›è¡Œæ ‡è®°ã€‚</p><p>åœ¨éå†å®Œæˆä¹‹åï¼Œæœ‰ä¸€ä¸ªæœ€ç»ˆçš„ï¼Œæ—¶é—´å¾ˆçŸ­çš„çš„Stop The Worldé˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µå¤„ç†ä¸€äº›è¾¹ç¼˜æƒ…å†µï¼ˆæˆ‘ä»¬ç°åœ¨å°†å®ƒå¿½ç•¥ï¼‰ï¼Œè¯¥é˜¶æ®µå®Œæˆä¹‹åæ ‡è®°é˜¶æ®µå°±å®Œæˆäº†ã€‚</p><h5 id="é‡å®šä½"><a href="#é‡å®šä½" class="headerlink" title="é‡å®šä½"></a><strong>é‡å®šä½</strong></h5><p>GCå¾ªç¯çš„ä¸‹ä¸€ä¸ªä¸»è¦éƒ¨åˆ†æ˜¯é‡å®šä½ã€‚é‡å®šä½æ¶‰åŠç§»åŠ¨æ´»åŠ¨å¯¹è±¡ä»¥é‡Šæ”¾éƒ¨åˆ†å †å†…å­˜ã€‚ ä¸ºä»€ä¹ˆè¦ç§»åŠ¨å¯¹è±¡è€Œä¸æ˜¯å¡«è¡¥ç©ºéš™ï¼Ÿ æœ‰äº›GCå®é™…æ˜¯è¿™æ ·åšçš„ï¼Œä½†æ˜¯å®ƒå¯¼è‡´äº†ä¸€ä¸ªä¸å¹¸çš„åæœï¼Œå³åˆ†é…å†…å­˜å˜å¾—æ›´åŠ æ˜‚è´µï¼Œå› ä¸ºå½“éœ€è¦åˆ†é…å†…å­˜æ—¶ï¼Œå†…å­˜åˆ†é…å™¨éœ€è¦æ‰¾åˆ°å¯ä»¥æ”¾ç½®å¯¹è±¡çš„ç©ºé—²ç©ºé—´ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¦‚æœå¯ä»¥é‡Šæ”¾å¤§å—å†…å­˜ï¼Œé‚£ä¹ˆåˆ†é…å†…å­˜å°±å¾ˆç®€å•ï¼Œåªéœ€è¦å°†æŒ‡é’ˆé€’å¢æ–°å¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°å³å¯ã€‚</p><p>ZGCå°†å †åˆ†æˆè®¸å¤šé¡µé¢ï¼Œåœ¨æ­¤é˜¶æ®µå¼€å§‹æ—¶ï¼Œå®ƒåŒæ—¶é€‰æ‹©ä¸€ç»„éœ€è¦é‡å®šä½æ´»åŠ¨å¯¹è±¡çš„é¡µé¢ã€‚é€‰æ‹©é‡å®šä½é›†åï¼Œä¼šå‡ºç°ä¸€ä¸ªStop The Worldæš‚åœï¼Œå…¶ä¸­ZGCé‡å®šä½è¯¥é›†åˆä¸­rootå¯¹è±¡ï¼Œå¹¶å°†ä»–ä»¬çš„å¼•ç”¨æ˜ å°„åˆ°æ–°ä½ç½®ã€‚ä¸ä¹‹å‰çš„Stop The Worldæ­¥éª¤ä¸€æ ·ï¼Œæ­¤å¤„æ¶‰åŠçš„æš‚åœæ—¶é—´ä»…å–å†³äºrootçš„æ•°é‡ä»¥åŠé‡å®šä½é›†çš„å¤§å°ä¸å¯¹è±¡çš„æ€»æ´»åŠ¨é›†çš„æ¯”ç‡ï¼Œè¿™é€šå¸¸ç›¸å½“å°ã€‚æ‰€ä»¥ä¸åƒå¾ˆå¤šæ”¶é›†å™¨é‚£æ ·ï¼Œæš‚åœæ—¶é—´éšå †å¢åŠ è€Œå¢åŠ ã€‚</p><p>ç§»åŠ¨rootåï¼Œä¸‹ä¸€é˜¶æ®µæ˜¯å¹¶å‘é‡å®šä½ã€‚ åœ¨æ­¤é˜¶æ®µï¼ŒGCçº¿ç¨‹éå†é‡å®šä½é›†å¹¶é‡æ–°å®šä½å…¶åŒ…å«çš„é¡µä¸­æ‰€æœ‰å¯¹è±¡ã€‚ å¦‚æœåº”ç”¨ç¨‹åºçº¿ç¨‹è¯•å›¾åœ¨GCé‡æ–°å®šä½å¯¹è±¡ä¹‹å‰åŠ è½½å®ƒä»¬ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºçº¿ç¨‹ä¹Ÿå¯ä»¥é‡å®šä½è¯¥å¯¹è±¡ï¼Œè¿™å¯ä»¥é€šè¿‡è¯»å±éšœï¼ˆåœ¨ä»å †åŠ è½½å¼•ç”¨æ—¶è§¦å‘ï¼‰</p><p>è¿™å¯ç¡®ä¿åº”ç”¨ç¨‹åºçœ‹åˆ°çš„æ‰€æœ‰å¼•ç”¨éƒ½å·²æ›´æ–°ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºä¸å¯èƒ½åŒæ—¶å¯¹é‡å®šä½çš„å¯¹è±¡è¿›è¡Œæ“ä½œã€‚</p><p>GCçº¿ç¨‹æœ€ç»ˆå°†å¯¹é‡å®šä½é›†ä¸­çš„æ‰€æœ‰å¯¹è±¡é‡å®šä½ï¼Œç„¶è€Œå¯èƒ½ä»æœ‰å¼•ç”¨æŒ‡å‘è¿™äº›å¯¹è±¡çš„æ—§ä½ç½®ã€‚ GCå¯ä»¥éå†å¯¹è±¡å›¾å¹¶é‡æ–°æ˜ å°„è¿™äº›å¼•ç”¨åˆ°æ–°ä½ç½®ï¼Œä½†æ˜¯è¿™ä¸€æ­¥ä»£ä»·å¾ˆé«˜æ˜‚ã€‚ å› æ­¤è¿™ä¸€æ­¥ä¸ä¸‹ä¸€ä¸ªæ ‡è®°é˜¶æ®µåˆå¹¶åœ¨ä¸€èµ·ã€‚åœ¨ä¸‹ä¸€ä¸ªGCå‘¨æœŸçš„æ ‡è®°é˜¶æ®µéå†å¯¹è±¡å¯¹è±¡å›¾çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æœªé‡æ˜ å°„çš„å¼•ç”¨ï¼Œåˆ™å°†å…¶é‡æ–°æ˜ å°„ï¼Œç„¶åæ ‡è®°ä¸ºæ´»åŠ¨çŠ¶æ€ã€‚</p></blockquote><h3 id="JVMå†…å­˜ä¼˜åŒ–"><a href="#JVMå†…å­˜ä¼˜åŒ–" class="headerlink" title="JVMå†…å­˜ä¼˜åŒ–"></a>JVMå†…å­˜ä¼˜åŒ–</h3><p>åœ¨ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸€ä¹¦ä¸­è®²äº†å¾ˆå¤šjvmä¼˜åŒ–æ€è·¯ï¼Œä¸‹é¢æˆ‘æ¥ç®€å•è¯´è¯´ã€‚</p><h4 id="javaå†…å­˜æŠ–åŠ¨"><a href="#javaå†…å­˜æŠ–åŠ¨" class="headerlink" title="javaå†…å­˜æŠ–åŠ¨"></a>javaå†…å­˜æŠ–åŠ¨</h4><p>å †å†…å­˜éƒ½æœ‰ä¸€å®šçš„å¤§å°ï¼Œèƒ½å®¹çº³çš„æ•°æ®æ˜¯æœ‰é™åˆ¶çš„ï¼Œå½“Javaå †çš„å¤§å°å¤ªå¤§æ—¶ï¼Œåƒåœ¾æ”¶é›†ä¼šå¯åŠ¨åœæ­¢å †ä¸­ä¸å†åº”ç”¨çš„å¯¹è±¡ï¼Œæ¥é‡Šæ”¾å†…å­˜ã€‚ç°åœ¨ï¼Œå†…å­˜æŠ–åŠ¨è¿™ä¸ªæœ¯è¯­å¯ç”¨äºæè¿°åœ¨æçŸ­æ—¶é—´å†…åˆ†é…ç»™å¯¹è±¡çš„è¿‡ç¨‹ã€‚ å…·ä½“å¦‚ä½•ä¼˜åŒ–è¯·è°·æ­ŒæŸ¥è¯¢~</p><h4 id="jvmå¤§é¡µå†…å­˜"><a href="#jvmå¤§é¡µå†…å­˜" class="headerlink" title="jvmå¤§é¡µå†…å­˜"></a>jvmå¤§é¡µå†…å­˜</h4><h5 id="ä»€ä¹ˆæ˜¯å†…å­˜åˆ†é¡µï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å†…å­˜åˆ†é¡µï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å†…å­˜åˆ†é¡µï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å†…å­˜åˆ†é¡µï¼Ÿ</h5><p>CPUæ˜¯é€šè¿‡å¯»å€æ¥è®¿é—®å†…å­˜çš„ã€‚32ä½CPUçš„å¯»å€å®½åº¦æ˜¯ 0~0xFFFFFFFFï¼Œå³4Gï¼Œä¹Ÿå°±æ˜¯è¯´å¯æ”¯æŒçš„ç‰©ç†å†…å­˜æœ€å¤§æ˜¯4Gã€‚ä½†åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œç¨‹åºéœ€è¦ä½¿ç”¨4Gå†…å­˜ï¼Œè€Œå¯ç”¨ç‰©ç†å†…å­˜å°äº4Gï¼Œå¯¼è‡´ç¨‹åºä¸å¾—ä¸é™ä½å†…å­˜å ç”¨ã€‚ä¸ºäº†è§£å†³æ­¤ç±»é—®é¢˜ï¼Œç°ä»£CPUå¼•å…¥äº†<code>MMU</code>ï¼ˆMemory Management Unitï¼Œå†…å­˜ç®¡ç†å•å…ƒï¼‰ã€‚       </p><p><code>MMU</code> çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨è™šæ‹Ÿåœ°å€æ›¿ä»£ç‰©ç†åœ°å€ï¼Œå³CPUå¯»å€æ—¶ä½¿ç”¨è™šå€ï¼Œç”±MMUè´Ÿè´£å°†è™šå€æ˜ å°„ä¸ºç‰©ç†åœ°å€ã€‚MMUçš„å¼•å…¥ï¼Œè§£å†³äº†å¯¹ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œå¯¹ç¨‹åºæ¥è¯´ï¼Œå°±åƒè‡ªå·±åœ¨ä½¿ç”¨4Gå†…å­˜ä¸€æ ·ã€‚       </p><p><strong>å†…å­˜åˆ†é¡µ</strong>(Paging)æ˜¯åœ¨ä½¿ç”¨MMUçš„åŸºç¡€ä¸Šï¼Œæå‡ºçš„ä¸€ç§å†…å­˜ç®¡ç†æœºåˆ¶ã€‚å®ƒå°†è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€æŒ‰å›ºå®šå¤§å°ï¼ˆ4Kï¼‰åˆ†å‰²æˆé¡µ(page)å’Œé¡µå¸§(page frame)ï¼Œå¹¶ä¿è¯é¡µä¸é¡µå¸§çš„å¤§å°ç›¸åŒã€‚è¿™ç§æœºåˆ¶ï¼Œä»æ•°æ®ç»“æ„ä¸Šï¼Œä¿è¯äº†è®¿é—®å†…å­˜çš„é«˜æ•ˆï¼Œå¹¶ä½¿OSèƒ½æ”¯æŒéè¿ç»­æ€§çš„å†…å­˜åˆ†é…ã€‚åœ¨ç¨‹åºå†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œè¿˜å¯ä»¥å°†ä¸å¸¸ç”¨çš„ç‰©ç†å†…å­˜é¡µè½¬ç§»åˆ°å…¶ä»–å­˜å‚¨è®¾å¤‡ä¸Šï¼Œæ¯”å¦‚ç£ç›˜ï¼Œè¿™å°±æ˜¯è™šæ‹Ÿå†…å­˜ã€‚    </p><p>è¦çŸ¥é“ï¼Œè™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€éœ€è¦é€šè¿‡æ˜ å°„ï¼Œæ‰èƒ½ä½¿CPUæ­£å¸¸å·¥ä½œã€‚è€Œæ˜ å°„å°±éœ€è¦å­˜å‚¨æ˜ å°„è¡¨ã€‚åœ¨ç°ä»£CPUæ¶æ„ä¸­ï¼Œæ˜ å°„å…³ç³»é€šå¸¸è¢«å­˜å‚¨åœ¨ç‰©ç†å†…å­˜ä¸Šä¸€ä¸ªè¢«ç§°ä¹‹ä¸ºé¡µè¡¨(page table)çš„åœ°æ–¹ã€‚ é¡µè¡¨æ˜¯è¢«å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼ŒCPUé€šè¿‡æ€»çº¿è®¿é—®å†…å­˜ï¼Œè‚¯å®šæ…¢äºç›´æ¥è®¿é—®å¯„å­˜å™¨çš„ã€‚ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ï¼Œç°ä»£CPUæ¶æ„å¼•å…¥äº†<code>TLB</code>ï¼ˆTranslation lookaside bufferï¼Œé¡µè¡¨å¯„å­˜å™¨ç¼“å†²ï¼‰ï¼Œç”¨æ¥ç¼“å­˜ä¸€éƒ¨åˆ†ç»å¸¸è®¿é—®çš„é¡µè¡¨å†…å®¹ ã€‚</p><h5 id="ä¸ºä»€ä¹ˆè¦æ”¯æŒå¤§å†…å­˜åˆ†é¡µï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æ”¯æŒå¤§å†…å­˜åˆ†é¡µï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æ”¯æŒå¤§å†…å­˜åˆ†é¡µï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æ”¯æŒå¤§å†…å­˜åˆ†é¡µï¼Ÿ</h5><p>TLBæ˜¯æœ‰é™çš„ï¼Œè¿™ç‚¹æ¯«æ— ç–‘é—®ã€‚å½“è¶…å‡ºTLBçš„å­˜å‚¨æé™æ—¶ï¼Œå°±ä¼šå‘ç”Ÿ TLB missï¼Œäºæ˜¯OSå°±ä¼šå‘½ä»¤CPUå»è®¿é—®å†…å­˜ä¸Šçš„é¡µè¡¨ã€‚å¦‚æœé¢‘ç¹çš„å‡ºç°TLB missï¼Œç¨‹åºçš„æ€§èƒ½ä¼šä¸‹é™åœ°å¾ˆå¿«ã€‚</p><p>ä¸ºäº†è®©TLBå¯ä»¥å­˜å‚¨æ›´å¤šçš„é¡µåœ°å€æ˜ å°„å…³ç³»ï¼Œæˆ‘ä»¬çš„åšæ³•æ˜¯è°ƒå¤§å†…å­˜åˆ†é¡µå¤§å°ã€‚</p><p>å¦‚æœä¸€ä¸ªé¡µ4Mï¼Œå¯¹æ¯”ä¸€ä¸ªé¡µ4Kï¼Œå‰è€…å¯ä»¥è®©TLBå¤šå­˜å‚¨1000ä¸ªé¡µåœ°å€æ˜ å°„å…³ç³»ï¼Œæ€§èƒ½çš„æå‡æ˜¯æ¯”è¾ƒå¯è§‚çš„ã€‚</p><h5 id="å¼€å¯JVMå¤§é¡µå†…å­˜"><a href="#å¼€å¯JVMå¤§é¡µå†…å­˜" class="headerlink" title="å¼€å¯JVMå¤§é¡µå†…å­˜"></a>å¼€å¯JVMå¤§é¡µå†…å­˜</h5><p>JVMå¯ç”¨æ—¶åŠ å‚æ•° -XX:LargePageSizeInBytes=10m å¦‚æœJDKæ˜¯åœ¨1.5 update5ä»¥å‰çš„ï¼Œè¿˜éœ€è¦åŠ  -XX:+UseLargePagesï¼Œä½œç”¨æ˜¯å¯ç”¨å¤§å†…å­˜é¡µæ”¯æŒã€‚ </p><h4 id="é€šè¿‡è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨æå‡JVMå†…å­˜ä½¿ç”¨æ€§èƒ½"><a href="#é€šè¿‡è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨æå‡JVMå†…å­˜ä½¿ç”¨æ€§èƒ½" class="headerlink" title="é€šè¿‡è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨æå‡JVMå†…å­˜ä½¿ç”¨æ€§èƒ½"></a>é€šè¿‡è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨æå‡JVMå†…å­˜ä½¿ç”¨æ€§èƒ½</h4><h5 id="å¼ºè½¯å¼±è™š"><a href="#å¼ºè½¯å¼±è™š" class="headerlink" title="å¼ºè½¯å¼±è™š"></a>å¼ºè½¯å¼±è™š</h5><ol><li>å¼ºå¼•ç”¨ï¼š</li></ol><p>åªè¦å¼•ç”¨å­˜åœ¨ï¼Œåƒåœ¾å›æ”¶å™¨æ°¸è¿œä¸ä¼šå›æ”¶</p><p>Object obj = new Object();</p><p>//å¯ç›´æ¥é€šè¿‡objå–å¾—å¯¹åº”çš„å¯¹è±¡ å¦‚obj.equels(new Object());</p><p>è€Œè¿™æ · objå¯¹è±¡å¯¹åé¢new Objectçš„ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œåªæœ‰å½“objè¿™ä¸ªå¼•ç”¨è¢«é‡Šæ”¾ä¹‹åï¼Œå¯¹è±¡æ‰ä¼šè¢«é‡Šæ”¾æ‰ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸æ‰€ç”¨åˆ°çš„ç¼–ç å½¢å¼ã€‚</p><ol start="2"><li>è½¯å¼•ç”¨ï¼ˆå¯ä»¥å®ç°ç¼“å­˜ï¼‰ï¼š</li></ol><p>éå¿…é¡»å¼•ç”¨ï¼Œå†…å­˜æº¢å‡ºä¹‹å‰è¿›è¡Œå›æ”¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç å®ç°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">SoftReference&lt;Object&gt; sf = <span class="keyword">new</span> SoftReference&lt;Object&gt;(obj);</span><br><span class="line"></span><br><span class="line">obj = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">sf.get();<span class="comment">//æœ‰æ—¶å€™ä¼šè¿”å›null</span></span><br></pre></td></tr></table></figure></p><p>è¿™æ—¶å€™sfæ˜¯å¯¹objçš„ä¸€ä¸ªè½¯å¼•ç”¨ï¼Œé€šè¿‡sf.get()æ–¹æ³•å¯ä»¥å–åˆ°è¿™ä¸ªå¯¹è±¡ï¼Œå½“ç„¶ï¼Œå½“è¿™ä¸ªå¯¹è±¡è¢«æ ‡è®°ä¸ºéœ€è¦å›æ”¶çš„å¯¹è±¡æ—¶ï¼Œåˆ™è¿”å›nullï¼›è½¯å¼•ç”¨ä¸»è¦ç”¨æˆ·å®ç°ç±»ä¼¼ç¼“å­˜çš„åŠŸèƒ½ï¼Œåœ¨å†…å­˜è¶³å¤Ÿçš„æƒ…å†µä¸‹ç›´æ¥é€šè¿‡è½¯å¼•ç”¨å–å€¼ï¼Œæ— éœ€ä»ç¹å¿™çš„çœŸå®æ¥æºæŸ¥è¯¢æ•°æ®ï¼Œæå‡é€Ÿåº¦ï¼›å½“å†…å­˜ä¸è¶³æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤è¿™éƒ¨åˆ†ç¼“å­˜æ•°æ®ï¼Œä»çœŸæ­£çš„æ¥æºæŸ¥è¯¢è¿™äº›æ•°æ®ã€‚</p><ol start="3"><li>å¼±å¼•ç”¨ï¼ˆç”¨æ¥åœ¨å›è°ƒå‡½æ•°ä¸­é˜²æ­¢å†…å­˜æ³„éœ²ï¼‰ï¼š</li></ol><p>ç¬¬äºŒæ¬¡åƒåœ¾å›æ”¶æ—¶å›æ”¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç å®ç°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">WeakReference&lt;Object&gt; wf = <span class="keyword">new</span> WeakReference&lt;Object&gt;(obj);</span><br><span class="line"></span><br><span class="line">obj = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">wf.get();<span class="comment">//æœ‰æ—¶å€™ä¼šè¿”å›null</span></span><br><span class="line"></span><br><span class="line">wf.isEnQueued();<span class="comment">//è¿”å›æ˜¯å¦è¢«åƒåœ¾å›æ”¶å™¨æ ‡è®°ä¸ºå³å°†å›æ”¶çš„åƒåœ¾</span></span><br></pre></td></tr></table></figure></p><p>å¼±å¼•ç”¨æ˜¯åœ¨ç¬¬äºŒæ¬¡åƒåœ¾å›æ”¶æ—¶å›æ”¶ï¼ŒçŸ­æ—¶é—´å†…é€šè¿‡å¼±å¼•ç”¨å–å¯¹åº”çš„æ•°æ®ï¼Œå¯ä»¥å–åˆ°ï¼Œå½“æ‰§è¡Œè¿‡ç¬¬äºŒæ¬¡åƒåœ¾å›æ”¶æ—¶ï¼Œå°†è¿”å›nullã€‚å¼±å¼•ç”¨ä¸»è¦ç”¨äºç›‘æ§å¯¹è±¡æ˜¯å¦å·²ç»è¢«åƒåœ¾å›æ”¶å™¨æ ‡è®°ä¸ºå³å°†å›æ”¶çš„åƒåœ¾ï¼Œå¯ä»¥é€šè¿‡å¼±å¼•ç”¨çš„isEnQueuedæ–¹æ³•è¿”å›å¯¹è±¡æ˜¯å¦è¢«åƒåœ¾å›æ”¶å™¨æ ‡è®°ã€‚</p><ol start="4"><li>è™šå¼•ç”¨ï¼š</li></ol><p>åƒåœ¾å›æ”¶æ—¶å›æ”¶ï¼Œæ— æ³•é€šè¿‡å¼•ç”¨å–åˆ°å¯¹è±¡å€¼ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">PhantomReference&lt;Object&gt; pf = <span class="keyword">new</span> PhantomReference&lt;Object&gt;(obj);</span><br><span class="line">obj=<span class="keyword">null</span>;</span><br><span class="line">pf.get();<span class="comment">//æ°¸è¿œè¿”å›null</span></span><br><span class="line">pf.isEnQueued();<span class="comment">//è¿”å›æ˜¯å¦ä»å†…å­˜ä¸­å·²ç»åˆ é™¤</span></span><br></pre></td></tr></table></figure><p>è™šå¼•ç”¨æ˜¯æ¯æ¬¡åƒåœ¾å›æ”¶çš„æ—¶å€™éƒ½ä¼šè¢«å›æ”¶ï¼Œé€šè¿‡è™šå¼•ç”¨çš„getæ–¹æ³•æ°¸è¿œè·å–åˆ°çš„æ•°æ®ä¸ºnullï¼Œå› æ­¤ä¹Ÿè¢«æˆä¸ºå¹½çµå¼•ç”¨ã€‚è™šå¼•ç”¨ä¸»è¦ç”¨äºæ£€æµ‹å¯¹è±¡æ˜¯å¦å·²ç»ä»å†…å­˜ä¸­åˆ é™¤ã€‚</p><h5 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h5><p>ç®€å•æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨è½¯å¼•ç”¨è¿˜å¼•ç”¨æ•°é‡å·¨å¤§çš„å¯¹è±¡ï¼Œè¯¦æƒ…è¯·å‚è€ƒ<a href="http://www.cnblogs.com/JavaArchitect/p/8685993.html" target="_blank" rel="noopener">http://www.cnblogs.com/JavaArchitect/p/8685993.html</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ­¤ç¯‡æ–‡ç« æ€»å…±1.5Wå­—ï¼Œæˆ‘ä»è®¡ç®—æœºç‰©ç†å†…å­˜ä½“ç³»è®²åˆ°äº†javaå†…å­˜æ¨¡å‹ï¼Œåœ¨é€šè¿‡javaå†…å­˜æ¨¡å‹å¼•å‡ºäº†JVMå†…å­˜çš„ç›¸å…³çŸ¥è¯†ç‚¹ã€‚è§‰å¾—å†™çš„å¥½çš„è¯·ç»™ä¸ªèµã€‚æœ¬ç¯‡æ–‡ç« æˆ‘ä¼šç‡å…ˆå‘å¸ƒåœ¨æˆ‘çš„ä¸ªäººåšå®¢ï¼Œéšåä¼šåœ¨æ˜é‡‘ç­‰å¹³å°ç›¸ç»§å‘å‡ºã€‚æœ€åï¼Œéå¸¸æ„Ÿè°¢ä½ çš„é˜…è¯»~</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p>æ–‡ä¸­çš„å„ç§è¶…é“¾æ¥</p><p>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹</p><p>ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹</p><p>ã€Šæ¶æ„è§£å¯†ä»åˆ†å¸ƒå¼åˆ°å¾®æœåŠ¡ã€‹</p><p><a href="https://www.cnblogs.com/yubo/archive/2010/04/23/1718810.html" target="_blank" rel="noopener">SMPã€NUMAã€MPPä½“ç³»ç»“æ„ä»‹ç»</a></p><p><a href="https://medium.com/airbnb-engineering/nebula-as-a-storage-platform-to-build-airbnbs-search-backends-ecc577b05f06" target="_blank" rel="noopener">ZGCåŸç†ï¼ˆè¯·ç”¨æ­£ç¡®çš„å§¿åŠ¿é­”æ³•ä¸Šç½‘è§‚çœ‹ï¼‰</a></p><p><a href="https://www.youtube.com/watch?v=tShc0dyFtgw" target="_blank" rel="noopener">Stefan Karlssonå’ŒPerLiden Jfokusçš„æ¼”è®²ï¼ˆè¯·ç”¨æ­£ç¡®çš„å§¿åŠ¿é­”æ³•ä¸Šç½‘ï¼‰</a></p><h3 id="å£°æ˜"><a href="#å£°æ˜" class="headerlink" title="å£°æ˜"></a>å£°æ˜</h3><p>ã€ç‰ˆæƒç”³æ˜ã€‘æ­¤ç‰‡ä¸ºåŸåˆ›å†…å®¹ï¼Œä½¿ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank" rel="noopener">CC BY-NC-SA 3.0</a>æˆæƒæ¡æ¬¾ï¼Œè¯·éµå®ˆå¯¹åº”çš„ä¹‰åŠ¡ï¼Œå³è¢«æˆæƒäººæœ‰ä¹‰åŠ¡åœ¨æ‰€æœ‰å‰¯æœ¬ä¸­éƒ½å¿…é¡»åŒ…å«ç‰ˆæƒå£°æ˜ã€‚è°¢è°¢åˆä½œ~</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢<a href="https://blog.tengshe789.tech/ï¼ˆğŸ˜˜" target="_blank" rel="noopener">https://blog.tengshe789.tech/ï¼ˆğŸ˜˜</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åˆæ˜¯ä¸€å¹´ç§‹æ‹›å­£ï¼Œå“å‘€å¦ˆå‘€æˆ‘è¢«è™çš„æƒ¨æ¥~è¿™ä¸ï¼Œå‰å‡ é˜µå¤±è¸ªæ²¡æ›´æ–°åšå®¢ï¼Œå…¶å®æ˜¯æˆ‘å·å·æŠŠæ—¶é—´ç”¨åœ¨å¤ä¹ è¯¾æœ¬äº†ï¼ˆé›¾&lt;/p&gt;
&lt;p&gt;åšæŒåœ¨ç¤¾åŒºåˆ†äº«åšå®¢ä¹Ÿå¾ˆä¹…äº†ï¼Œç”±äºè¿‡å»çš„æ–‡ç« æœ‰å¾ˆå¤šç–æ¼ä¹‹å¤„ï¼Œå¾ˆå¤šå¤§ä½¬éƒ½åœ¨è¯„è®ºæŒ‡å‡ºæˆ‘çš„è¿‡é”™ï¼Œæˆ‘å¾ˆå¼€å¿ƒä¹Ÿå¾ˆå¤±æœ›ï¼Œå¼€å¿ƒçš„æ˜¯æœ‰å¤§å®¶å¸®æˆ‘æŒ‡å‡ºé”™è¯¯ï¼Œå¤±æœ›çš„é„™äººå­¦è¯†æµ…è–„æ€»æ²¡
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="å¹¶å‘" scheme="https://tengshe789.github.io/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡ä¸ç»æ€è€ƒçš„æ¶ˆè´¹(AppStoreé€€æ¬¾)</title>
    <link href="https://tengshe789.github.io/2018/09/03/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%B8%8D%E7%BB%8F%E6%80%9D%E8%80%83%E7%9A%84%E6%B6%88%E8%B4%B9-AppStore%E9%80%80%E6%AC%BE/"/>
    <id>https://tengshe789.github.io/2018/09/03/è®°ä¸€æ¬¡ä¸ç»æ€è€ƒçš„æ¶ˆè´¹-AppStoreé€€æ¬¾/</id>
    <published>2018-09-02T23:54:54.000Z</published>
    <updated>2019-11-20T13:39:41.553Z</updated>
    
    <content type="html"><![CDATA[<p>æ˜¨å¤©æ™šä¸Šï¼Œæˆ‘åšäº†ä¸€ä¸ªæƒŠå¤©åœ°æ³£é¬¼ç¥çš„äº‹æƒ…</p><p>å¸®åª³å¦‡æ”¹å®Œè®ºæ–‡ï¼Œçªç„¶æŠ–äº†ä¸€ä¸ªæœºçµâ€œæ¯å¤©éƒ½ç”¨ç”µè„‘ï¼Œæˆ‘éš¾é“æ°¸è¿œçš„è„±ç¦»ä½¿ç”¨çº¸å’Œç¬”ä¹ˆï¼Ÿâ€</p><p>æˆ‘è¿˜æ˜¯ä¸ªå­©å­ï¼</p><p>è¯´ç½¢ï¼Œæ‰“å¼€AppStoreï¼Œå°±æ˜¯ä¸€å †ç¿»ã€‚æ²¡é”™ï¼Œä¸Šä¸ªæœˆæˆ‘å…¥äº†ä¸€ä¸ªapple pencilï¼Œå‡ ä¹æ²¡æ€ä¹ˆç”¨ã€‚æˆ‘ç°åœ¨çš„æ‰€æœ‰æ€ç»´éƒ½æ˜¯ç»™æˆ‘çš„apple pencilæ‰¾è€å©†</p><p><img src="/2018/09/03/è®°ä¸€æ¬¡ä¸ç»æ€è€ƒçš„æ¶ˆè´¹-AppStoreé€€æ¬¾/1535933495124.png" alt="1535933495124"></p><p>ä¸€çœ¼å°±çœ‹åˆ°äº†è¿™ä¸ªappï¼Œæ”¯æŒæ‰‹å†™ç¬”ï¼Œè‡ªåŠ¨è°·æ­ŒåŒæ­¥ï¼Œå¯ä»¥OCRï¼Œé‚£ä¸ªçœ¼é¦‹å•Š    </p><p>çº ç»“äº†ä¸€é˜µï¼Œ</p><p><img src="/2018/09/03/è®°ä¸€æ¬¡ä¸ç»æ€è€ƒçš„æ¶ˆè´¹-AppStoreé€€æ¬¾/44ce5968103f417bb5d9f7fc61b7fa7d.jpg" alt="img"></p><p>ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><p>ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><p>ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><p><img src="/2018/09/03/è®°ä¸€æ¬¡ä¸ç»æ€è€ƒçš„æ¶ˆè´¹-AppStoreé€€æ¬¾/1535933671318.png" alt="1535933671318"></p><p>ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><p>ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><p>ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><p><img src="/2018/09/03/è®°ä¸€æ¬¡ä¸ç»æ€è€ƒçš„æ¶ˆè´¹-AppStoreé€€æ¬¾/timg.jpg" alt="img"></p><p>ç„¶åæˆ‘å°±ä¹°äº†ã€‚ã€‚</p><p>æ‰“å¼€appä»¥åï¼Œ<img src="/2018/09/03/è®°ä¸€æ¬¡ä¸ç»æ€è€ƒçš„æ¶ˆè´¹-AppStoreé€€æ¬¾/1535933810115.png" alt="1535933810115"></p><p>è¿™å•¥å•Šï¼Œé•¿å¾—å’ŒOneNoteä¸€æ¯›ä¸€æ ·ï¼Œç«Ÿç„¶æ”¶50å¤§æ´‹</p><p>é€€é€€é€€ï¼<img src="/2018/09/03/è®°ä¸€æ¬¡ä¸ç»æ€è€ƒçš„æ¶ˆè´¹-AppStoreé€€æ¬¾/1535933853422.png" alt="1535933853422"></p><p>æœæ–­æ‰“å¼€æœå­å®˜æ–¹ç½‘æ‰¾é€€æ¬¾é€šé“</p><p>ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨ğŸ¤¨</p><p>ä¸€å°æ—¶è¿‡å»äº†</p><p>ğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µğŸ˜µ</p><p>å¤œè¿˜æ˜¯è¾£ä¹ˆé»‘ï¼Œæˆ‘çš„é’±åŒ…è¿˜æ˜¯è¾£ä¹ˆç˜ª</p><p>æ³•å…‹QğŸ™‚æœå­</p><p>æˆ‘å¿ƒé‡Œå’†å“®ç€</p><p>æ²¡åŠæ³•ï¼Œç™¾åº¦å§ï¼Œä»¥ä¸‹æ˜¯æ­£æ–‡</p><h2 id="é€€æ¬¾"><a href="#é€€æ¬¾" class="headerlink" title="é€€æ¬¾"></a>é€€æ¬¾</h2><p>è¦çŸ¥é“ï¼Œåœ¨è‹¹æœçœ¼ä¸­ï¼Œé€€æ¬¾æ˜¯åˆ†ä¸ºä¸¤ç§çš„ï¼Œè¶…è¿‡90å¤©å’Œæ²¡æœ‰è¶…è¿‡90å¤©ã€‚è¦é˜…è¯»æœ¬ç‰‡æ–‡ç« ï¼Œä½ è¦çŸ¥é“ï¼Œç”¨äº†è¶…è¿‡90å¤©çš„appæ˜¯éå¸¸éš¾é€€æ¬¾çš„ã€‚ä¸‹é¢æˆ‘æ¥ä»‹ç»è‹¹æœå®¶æ²¡æœ‰è¶…è¿‡90å¤©é€€æ¬¾appçš„æ–¹æ³•</p><h3 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h3><p>æ‰“å¼€ <a href="https://reportaproblem.apple.com/" target="_blank" rel="noopener">https://reportaproblem.apple.com/</a> ï¼Œå¹¶ç™»é™†ä½ çš„æœå­è´¦å·</p><h3 id="â€»ç¬¬äºŒæ­¥â€»"><a href="#â€»ç¬¬äºŒæ­¥â€»" class="headerlink" title="â€»ç¬¬äºŒæ­¥â€»"></a>â€»ç¬¬äºŒæ­¥â€»</h3><p><img src="/2018/09/03/è®°ä¸€æ¬¡ä¸ç»æ€è€ƒçš„æ¶ˆè´¹-AppStoreé€€æ¬¾/1535934396968.png" alt="1535934396968"></p><p>å¯»æ‰¾ä½ ä¹°è¿‡çš„çˆ±å•ªå•ªï¼Œç‚¹å‡»æŠ¥å‘Šé—®é¢˜ï¼Œé€‰æ‹©éœ€è¦æŠ¥å‘Šçš„é—®é¢˜ã€‚</p><p>è¿™å…¶ä¸­æœ‰â€œæˆ‘æ²¡æœ‰æˆæƒæ­¤é¡¹è´­ä¹°â€ã€â€œå¹¶ä¸åƒè´­ä¹°æ­¤é¡¹ç›®â€ã€â€œåŸæœ¬æ‰“ç®—è´­ä¹°å¦ä¸€ä¸ªé¡¹ç›®â€ã€â€œæœªä¸‹è½½é¡¹ç›®æˆ–è€…æ— æ³•æ‰¾åˆ°é¡¹ç›®â€ã€â€œé¡¹ç›®æ— æ³•å®‰è£…æˆ–ä¸‹è½½å¤ªæ…¢â€ã€â€œé¡¹ç›®å¯æ‰“å¼€ï¼Œä½†æ˜¯æœªèµ·åˆ°é¢„æœŸçš„ä½œç”¨â€ã€â€œæ²¡æœ‰åˆ—å‡ºæˆ‘çš„é—®é¢˜â€ç­‰å¤šä¸ªé€‰é¡¹å„é€‰ã€‚</p><p>ç”±è¿™äº›é€‰é¡¹æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè‹¹æœå¯¹é€€æ¬¾åŸå› çš„æ¥å—åº¦è¿˜æ˜¯æŒºå¹¿çš„ï¼Œè¿™äº›é€‰é¡¹å‡ ä¹åŒ…å«äº†æ‰€æœ‰çš„åŸå› ï¼Œå°¤å…¶æ˜¯â€œå¹¶ä¸æƒ³è´­ä¹°æ­¤é¡¹ç›®â€æ˜¾å¾—æ ¼å¤–ä»»æ€§ã€‚</p><p>ä¸‹é¢ç»™å¤§å®¶ä¸€ä¸ªé—®é¢˜æè¿°çš„èŒƒæ–‡ï¼š</p><p>I have downloaded a XXXXï¼ˆè¦é€€è´¹ç¨‹åºçš„åç§°ï¼‰program for iPhone ï¼ˆæˆ– iPadï¼‰ from the App Storeï¼Œ  but this item dose not meet my expectation. </p><p>Would you please help me refund my payment ï¼Ÿ </p><p>Thank you very much.</p><h3 id="ç¬¬ä¸‰æ­¥"><a href="#ç¬¬ä¸‰æ­¥" class="headerlink" title="ç¬¬ä¸‰æ­¥"></a>ç¬¬ä¸‰æ­¥</h3><p>æ…¢æ…¢ç­‰é‚®ä»¶ä¹ˆï¼Œæˆ‘æ˜¯æ™šä¸Š12ç‚¹é€€çš„ï¼Œç¬¬äºŒå¤©é†’æ¥å°±æ”¶åˆ°é€€æ¬¾å’Œé€€æ¬¾é‚®ä»¶äº†~</p><h2 id="å¦‚ä½•ç†æ€§æ¶ˆè´¹"><a href="#å¦‚ä½•ç†æ€§æ¶ˆè´¹" class="headerlink" title="å¦‚ä½•ç†æ€§æ¶ˆè´¹"></a>å¦‚ä½•ç†æ€§æ¶ˆè´¹</h2><p><br></p><p><br></p><p><br></p><p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></p><p><strong>ç†æ€§ï¼ ä¸å¯èƒ½çš„ï¼è¿™è¾ˆå­éƒ½æ— æ³•ç†æ€§ï¼</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ˜¨å¤©æ™šä¸Šï¼Œæˆ‘åšäº†ä¸€ä¸ªæƒŠå¤©åœ°æ³£é¬¼ç¥çš„äº‹æƒ…&lt;/p&gt;
&lt;p&gt;å¸®åª³å¦‡æ”¹å®Œè®ºæ–‡ï¼Œçªç„¶æŠ–äº†ä¸€ä¸ªæœºçµâ€œæ¯å¤©éƒ½ç”¨ç”µè„‘ï¼Œæˆ‘éš¾é“æ°¸è¿œçš„è„±ç¦»ä½¿ç”¨çº¸å’Œç¬”ä¹ˆï¼Ÿâ€&lt;/p&gt;
&lt;p&gt;æˆ‘è¿˜æ˜¯ä¸ªå­©å­ï¼&lt;/p&gt;
&lt;p&gt;è¯´ç½¢ï¼Œæ‰“å¼€AppStoreï¼Œå°±æ˜¯ä¸€å †ç¿»ã€‚æ²¡é”™ï¼Œä¸Šä¸ªæœˆæˆ‘å…¥äº†ä¸€ä¸ªapple pencilï¼Œå‡ ä¹æ²¡
      
    
    </summary>
    
    
      <category term="çªé—¨" scheme="https://tengshe789.github.io/tags/%E7%AA%8D%E9%97%A8/"/>
    
      <category term="ç”Ÿæ´»" scheme="https://tengshe789.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ç”¨Javaä¸pythonä»£ç è§£é‡ŠIOæ¨¡å‹</title>
    <link href="https://tengshe789.github.io/2018/08/25/IO%E6%A8%A1%E5%9E%8B/"/>
    <id>https://tengshe789.github.io/2018/08/25/IOæ¨¡å‹/</id>
    <published>2018-08-25T11:39:12.000Z</published>
    <updated>2019-11-20T13:39:40.564Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘çˆ·çˆ·ç”Ÿç—…ï¼Œæˆ‘ä¸€ç›´åœ¨é™ªåºŠã€‚é™ªåºŠç©ºéš™ï¼Œå¶è€Œç ”ç©¶ä¸€ä¼šèµ„æ–™ã€‚å‰å¤©åˆšå¥½çœ‹äº†ç‚¹ã€ŠUNIXç½‘ç»œç¼–ç¨‹ã€‹ï¼Œæ¯”è¾ƒå¤´å¤§ã€‚ç°åœ¨æˆ‘æ¥æ•´ç†ä¸€ä¸‹æ‰€å­¦æ‰€å¾—ï¼Œå¹¶ç”¨äºä¸ªäººå¤‡å¿˜ã€‚å¦‚æœæœ‰ä¸å¯¹ï¼Œè¯·æ‰¹è¯„ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">https://blog.tengshe789.tech/</a></p><h1 id="IOæ¨¡å‹ä»‹ç»"><a href="#IOæ¨¡å‹ä»‹ç»" class="headerlink" title="IOæ¨¡å‹ä»‹ç»"></a>IOæ¨¡å‹ä»‹ç»</h1><p>IOæ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿå¾ˆå¤šä¹¦ç±æˆ–è€…ç™¾åº¦ç™¾åº¦ç™¾ç§‘ï¼Œéƒ½æ²¡æœ‰ç»™å‡ºæ˜ç¡®çš„è§£é‡Šï¼Œæˆ‘ä¹Ÿä¸æ•¢ä¹±ä¸‹å®šä¹‰ã€‚ä»¥æˆ‘æ„šè§ï¼ŒIOæ¨¡å‹ï¼Œæ˜¯é€šè¿‡æ ¹æ®å‰äººä¸»è§‚æ„è¯†çš„æ€è€ƒè€Œæ„æˆå®¢è§‚é˜è¿°IOå¤æ‚æ“ä½œé€»è¾‘çš„ç‰©ä»¶ã€‚</p><p>è¦çŸ¥é“ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨ç³»ç»Ÿèµ„æºçš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œ<strong>è¿›ç¨‹æ— æ³•ç›´æ¥æ“ä½œIOè®¾å¤‡çš„</strong>ï¼Œå› ä¸ºç”¨æˆ·è¿›ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®ç£ç›˜ï¼Œæ‰€ä»¥è¦é€šè¿‡å†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨è¯»å–ï¼Œè¿™ä¸ªå†…æ ¸è¯»å–çš„è¿‡ç¨‹å°±æ˜¯ç”¨æˆ·è¿›ç¨‹ç­‰å¾…çš„è¿‡ç¨‹ï¼Œç­‰å¾…å†…æ ¸è¯»å–åå°†æ•°æ®ä»å†…æ ¸å†…å­˜å¤åˆ¶åˆ°è¿›ç¨‹å†…å­˜ã€‚å› æ­¤æ“ä½œç³»ç»Ÿè®¾ç«‹ä¸€ä¸ªIOæ¨¡å‹è¿›è¡Œè§„èŒƒï¼Œå°±éå¸¸æœ‰å¿…è¦äº†ã€‚</p><p><img src="/2018/08/25/IOæ¨¡å‹/831179-20160814120934953-1360584282.png" alt="åº”ç”¨ç¨‹åºä½¿ç”¨ç³»ç»Ÿèµ„æº"></p><p>ä¸ºäº†æ›´å¥½åœ°äº†è§£IOæ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦äº‹å…ˆå›é¡¾ä¸‹ï¼šåŒæ­¥ã€å¼‚æ­¥ã€é˜»å¡ã€éé˜»å¡</p><p><strong>åŒæ­¥ä¸å¼‚æ­¥</strong>ï¼šæè¿°çš„æ˜¯ç”¨æˆ·çº¿ç¨‹ä¸å†…æ ¸çš„äº¤äº’æ–¹å¼ï¼ŒåŒæ­¥æŒ‡ç”¨æˆ·çº¿ç¨‹å‘èµ·IOè¯·æ±‚åéœ€è¦ç­‰å¾…æˆ–è€…è½®è¯¢å†…æ ¸IOæ“ä½œå®Œæˆåæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼›è€Œå¼‚æ­¥æ˜¯æŒ‡ç”¨æˆ·çº¿ç¨‹å‘èµ·IOè¯·æ±‚åä»ç„¶ç»§ç»­æ‰§è¡Œï¼Œå½“å†…æ ¸IOæ“ä½œå®Œæˆåä¼šé€šçŸ¥ç”¨æˆ·çº¿ç¨‹ï¼Œæˆ–è€…è°ƒç”¨ç”¨æˆ·çº¿ç¨‹æ³¨å†Œçš„å›è°ƒå‡½æ•°ã€‚</p><p><strong>é˜»å¡ä¸éé˜»å¡</strong>ï¼šæè¿°æ˜¯ç”¨æˆ·çº¿ç¨‹è°ƒç”¨å†…æ ¸IOæ“ä½œçš„æ–¹å¼ï¼Œé˜»å¡æ˜¯æŒ‡IOæ“ä½œéœ€è¦å½»åº•å®Œæˆåæ‰è¿”å›åˆ°ç”¨æˆ·ç©ºé—´ï¼›è€Œéé˜»å¡æ˜¯æŒ‡IOæ“ä½œè¢«è°ƒç”¨åç«‹å³è¿”å›ç»™ç”¨æˆ·ä¸€ä¸ªçŠ¶æ€å€¼ï¼Œæ— éœ€ç­‰åˆ°IOæ“ä½œå½»åº•å®Œæˆã€‚</p><p>IOæ¨¡å‹ä¸€å…±æœ‰5ç±»ï¼š</p><ul><li><p>blocking-IO           BIOï¼ˆé˜»å¡IOï¼‰</p></li><li><p>non-blocking IO      NIOï¼ˆéé˜»å¡IOï¼‰</p></li><li><p>IO multiplexing      IOå¤šè·¯å¤ç”¨</p></li><li><p>signal driven IO     ä¿¡å·é©±åŠ¨IO</p></li><li><p>asynchronous IO    AIOï¼ˆå¼‚æ­¥IOï¼‰</p><p>ç”±äºsignal driven IOï¼ˆä¿¡å·é©±åŠ¨IOï¼‰åœ¨å®é™…ä¸­å¹¶ä¸å¸¸ç”¨ï¼Œæ‰€ä»¥ä¸»è¦ä»‹ç»å…¶ä½™å››ç§IO Modelã€‚</p></li></ul><h1 id="BIOï¼ˆblocking-ioï¼‰"><a href="#BIOï¼ˆblocking-ioï¼‰" class="headerlink" title="BIOï¼ˆblocking ioï¼‰"></a>BIOï¼ˆblocking ioï¼‰</h1><p>å…ˆæ¥çœ‹çœ‹è¯»æ“ä½œæµç¨‹</p><p><img src="/2018/08/25/IOæ¨¡å‹/1535200521414.png" alt="1535200521414"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†recvfromè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œkernelå°±å¼€å§‹äº†IOçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼šå‡†å¤‡æ•°æ®ã€‚</p><p>å¯¹äºnetwork ioæ¥è¯´ï¼Œå¾ˆå¤šæ—¶å€™æ•°æ®åœ¨ä¸€å¼€å§‹è¿˜æ²¡æœ‰åˆ°è¾¾ï¼ˆæ¯”å¦‚ï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„UDPåŒ…ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™kernelå°±è¦ç­‰å¾…è¶³å¤Ÿçš„æ•°æ®åˆ°æ¥ã€‚</p><p>è€Œåœ¨ç”¨æˆ·è¿›ç¨‹è¿™è¾¹ï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šè¢«é˜»å¡ã€‚å½“kernelä¸€ç›´ç­‰åˆ°æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»kernelä¸­æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œç„¶åkernelè¿”å›ç»“æœï¼Œç”¨æˆ·è¿›ç¨‹æ‰è§£é™¤blockçš„çŠ¶æ€ï¼Œé‡æ–°è¿è¡Œèµ·æ¥ã€‚</p><p><strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œblocking IOçš„ç‰¹ç‚¹å°±æ˜¯åœ¨IOæ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µï¼ˆç­‰å¾…æ•°æ®å’Œæ‹·è´æ•°æ®ä¸¤ä¸ªé˜¶æ®µï¼‰éƒ½è¢«blockäº†ã€‚</strong></p><h2 id="JAVA-é˜»å¡-demo"><a href="#JAVA-é˜»å¡-demo" class="headerlink" title="JAVA é˜»å¡ demo"></a>JAVA é˜»å¡ demo</h2><p>ä¸‹é¢çš„ä¾‹å­ä¸»è¦ä½¿ç”¨Socketé€šé“è¿›è¡Œç¼–ç¨‹ã€‚æœåŠ¡ç«¯å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: socketTest</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: one thread demo for bio version</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: tEngSHe789</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2018-08-26 21:17</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ServerSocket serverSocket=<span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</span><br><span class="line">            System.out.println(<span class="string">"æœåŠ¡ç«¯Start...."</span>);</span><br><span class="line">            <span class="comment">//ç­‰å¾…å®¢æˆ·ç«¯å°±ç»ª -&gt; å µå¡</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">                Socket socket = serverSocket.accept();</span><br><span class="line">                System.out.println(<span class="string">"å‘ç°å®¢æˆ·ç«¯è¿æ¥"</span>);</span><br><span class="line">                InputStream is=socket.getInputStream();</span><br><span class="line">                <span class="keyword">byte</span>[] b =<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="comment">//ç­‰å¾…å®¢æˆ·ç«¯å‘é€è¯·æ±‚ -&gt; å µå¡</span></span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                    <span class="keyword">int</span> data = is.read(b);</span><br><span class="line">                    String info=<span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">if</span> (data!=-<span class="number">1</span>)&#123;</span><br><span class="line">                        info=<span class="keyword">new</span> String(b,<span class="number">0</span>,data,<span class="string">"GBK"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(info);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: socketTest</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: one thread demo for bio version</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: tEngSHe789</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Socket socket=<span class="keyword">new</span> Socket(<span class="string">"127.0.0.1"</span>,<span class="number">8888</span>);</span><br><span class="line">            OutputStream os = socket.getOutputStream();</span><br><span class="line">            System.out.println(<span class="string">"æ­£åœ¨å‘é€æ•°æ®"</span>);</span><br><span class="line">            os.write(<span class="string">"è¿™æ˜¯æ¥è‡ªå®¢æˆ·ç«¯çš„ä¿¡æ¯"</span>.getBytes());</span><br><span class="line">            os.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="PY-é˜»å¡-demo"><a href="#PY-é˜»å¡-demo" class="headerlink" title="PY é˜»å¡ demo"></a>PY é˜»å¡ demo</h2><p>æœåŠ¡ç«¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket()</span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8888</span>))</span><br><span class="line">print(<span class="string">'æœåŠ¡ç«¯å¯åŠ¨....'</span>)</span><br><span class="line"><span class="comment"># ç­‰å¾…å®¢æˆ·ç«¯å°±ç»ª -&gt; å µå¡</span></span><br><span class="line">s.listen()</span><br><span class="line"><span class="comment"># ç­‰å¾…å®¢æˆ·ç«¯å‘é€è¯·æ±‚ -&gt; å µå¡</span></span><br><span class="line">conn,addr = s.accept()</span><br><span class="line">msg = conn.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">print(msg)</span><br><span class="line">conn.close()</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket()</span><br><span class="line">s.connect((<span class="string">'127.0.0.1'</span>,<span class="number">8888</span>))</span><br><span class="line">print(<span class="string">'å®¢æˆ·ç«¯å·²å¯åŠ¨....'</span>)</span><br><span class="line">s.send(<span class="string">'æ­£åœ¨å‘é€æ•°æ®'</span>.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure><h1 id="NIOï¼ˆnon-blocking-ioï¼‰"><a href="#NIOï¼ˆnon-blocking-ioï¼‰" class="headerlink" title="NIOï¼ˆnon blocking ioï¼‰"></a>NIOï¼ˆnon blocking ioï¼‰</h1><p>NIOå°±ä¸ä¸€æ ·äº†ï¼Œrecvformç³»ç»Ÿè°ƒç”¨è°ƒç”¨ä¹‹åï¼Œè¿›ç¨‹å¹¶æ²¡æœ‰è¢«é˜»å¡ï¼Œå†…æ ¸é©¬ä¸Šè¿”å›ç»™è¿›ç¨‹ï¼Œå¦‚æœæ•°æ®è¿˜æ²¡å‡†å¤‡å¥½ï¼Œæ­¤æ—¶ä¼šè¿”å›ä¸€ä¸ªerrorã€‚è¿›ç¨‹åœ¨è¿”å›ä¹‹åï¼Œå¯ä»¥å¹²ç‚¹åˆ«çš„äº‹æƒ…ï¼Œç„¶åå†å‘èµ·recvformç³»ç»Ÿè°ƒç”¨ã€‚é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œå¾ªç¯å¾€å¤çš„è¿›è¡Œrecvformç³»ç»Ÿè°ƒç”¨ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸è¢«ç§°ä¹‹ä¸ºè½®è¯¢ã€‚</p><p>è½®è¯¢æ£€æŸ¥å†…æ ¸æ•°æ®ï¼Œç›´åˆ°æ•°æ®å‡†å¤‡å¥½ï¼Œå†æ‹·è´æ•°æ®åˆ°è¿›ç¨‹ï¼Œè¿›è¡Œæ•°æ®å¤„ç†ã€‚éœ€è¦æ³¨æ„ï¼Œæ‹·è´æ•°æ®æ•´ä¸ªè¿‡ç¨‹ï¼Œè¿›ç¨‹ä»ç„¶æ˜¯å±äºé˜»å¡çš„çŠ¶æ€ã€‚</p><p><img src="/2018/08/25/IOæ¨¡å‹/1535201598609.png" alt="1535201598609"></p><h2 id="JAVA-ä¸NIO"><a href="#JAVA-ä¸NIO" class="headerlink" title="JAVA ä¸NIO"></a>JAVA ä¸NIO</h2><p>Java NIO(New IO)æ˜¯ä¸€ä¸ªå¯ä»¥æ›¿ä»£æ ‡å‡†Java IO APIçš„IO APIï¼ˆä»Java 1.4å¼€å§‹)ï¼ŒJava NIOæä¾›äº†ä¸æ ‡å‡†IOä¸åŒçš„IOå·¥ä½œæ–¹å¼ã€‚</p><p>åœ¨javaä¸­ï¼Œæ ‡å‡†çš„IOåŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµè¿›è¡Œæ“ä½œçš„ï¼Œè€ŒNIOæ˜¯åŸºäºé€šé“ï¼ˆChannelï¼‰å’Œç¼“å†²åŒºï¼ˆBufferï¼‰è¿›è¡Œæ“ä½œï¼Œæ•°æ®æ€»æ˜¯ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–è€…ä»ç¼“å†²åŒºå†™å…¥åˆ°é€šé“ä¸­ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹Bufferç±»</p><h3 id="Bufferç±»"><a href="#Bufferç±»" class="headerlink" title="Bufferç±»"></a>Bufferç±»</h3><p>Java NIOä¸­çš„Bufferä¸»è¦ç”¨äºä¸NIOé€šé“è¿›è¡Œäº¤äº’ï¼Œæ•°æ®æ˜¯ä»é€šé“è¯»å…¥åˆ°ç¼“å†²åŒºï¼Œä»ç¼“å†²åŒºå†™å…¥é€šé“ä¸­çš„ã€‚æ¦‚å¿µä¸Šï¼Œç¼“å†²åŒºå¯ä»¥çœ‹æˆåŒ…åœ¨ä¸€ä¸ªå¯¹è±¡å†…çš„æ•°ç»„ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªå›¾</p><p><img src="/2018/08/25/IOæ¨¡å‹/1535619881305.png" alt="æ–°åˆ›å»ºçš„ByteBuffer"></p><p>è¿™æ˜¯ä¸€ä¸ªæ–°åˆ›å»ºçš„å®¹é‡ä¸º10çš„ByteBufferé€»è¾‘å›¾ï¼Œä»–æœ‰å››ä¸ªå±æ€§æ¥æä¾›å…³äºå…¶åŒ…å«çš„æ•°æ®å…ƒç´ ä¿¡æ¯ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><p>1ï¼‰å®¹é‡ï¼ˆcapacityï¼‰ï¼šè¡¨ç¤ºBufferæœ€å¤§æ•°æ®å®¹é‡ï¼Œç¼“å†²åŒºå®¹é‡ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”å»ºç«‹åä¸èƒ½ä¿®æ”¹ã€‚</p><p>2ï¼‰é™åˆ¶ï¼ˆlimitï¼‰ï¼šä¹Ÿå«ä¸Šç•Œã€‚<strong>ç¬¬ä¸€ä¸ªä¸åº”è¯¥è¯»å–æˆ–è€…å†™å…¥çš„æ•°æ®çš„ç´¢å¼•</strong>ï¼Œå³ä½äºlimitåçš„æ•°æ®ä¸å¯ä»¥è¯»å†™ã€‚ç¼“å†²åŒºçš„é™åˆ¶ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶å®¹é‡ï¼ˆcapacityï¼‰ã€‚</p><p>3ï¼‰ä½ç½®ï¼ˆpositionï¼‰ï¼šä¸‹ä¸€ä¸ªè¦è¯»å–æˆ–å†™å…¥çš„æ•°æ®çš„ç´¢å¼•ã€‚ç¼“å†²åŒºçš„ä½ç½®ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶é™åˆ¶ï¼ˆlimitï¼‰ã€‚</p><p>4ï¼‰æ ‡è®°ï¼ˆmarkï¼‰ä¸é‡ç½®ï¼ˆresetï¼‰ï¼šæ ‡è®°æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œé€šè¿‡Bufferä¸­çš„mark()æ–¹æ³•æŒ‡å®šBufferä¸­ä¸€ä¸ªç‰¹å®šçš„positionï¼Œä¹‹åå¯ä»¥é€šè¿‡è°ƒç”¨reset()æ–¹æ³•æ¢å¤åˆ°è¿™ä¸ªpositionã€‚</p><p>ä»è¿™å¹…å›¾å¯ä»¥çœ‹åˆ°ï¼Œä»–çš„å®¹é‡ï¼ˆcapacityï¼‰å’Œé™åˆ¶ï¼ˆlimitï¼‰è®¾ç½®ä¸º10ï¼Œä½ç½®è®¾ç½®ä¸º0ï¼Œæ¯ä¸ªç¼“å†²åŒºå®¹é‡æ˜¯å›ºå®šçš„ï¼Œæ ‡è®°æ˜¯æœªå®šä¹‰çš„ï¼Œå…¶ä»–ä¸‰ä¸ªå±æ€§å¯ä»¥é€šè¿‡ä½¿ç”¨ç¼“å†²åŒºè§£å†³ã€‚</p><h4 id="ç¼“å†²åŒºå­˜å‚¨æ•°æ®æ”¯æŒçš„æ•°æ®ç±»å‹"><a href="#ç¼“å†²åŒºå­˜å‚¨æ•°æ®æ”¯æŒçš„æ•°æ®ç±»å‹" class="headerlink" title="ç¼“å†²åŒºå­˜å‚¨æ•°æ®æ”¯æŒçš„æ•°æ®ç±»å‹"></a>ç¼“å†²åŒºå­˜å‚¨æ•°æ®æ”¯æŒçš„æ•°æ®ç±»å‹</h4><p>æ”¯æŒä¸ƒç§æ•°æ®ç±»å‹ï¼Œä»–ä»¬æ˜¯ï¼š<br>1.byteBuffer<br>2.charBuffer<br>3.shortBuffer<br>4.IntBuffer<br>5.LongBuffer<br>6.FloatBuffer<br>7.DubooBuffer</p><h4 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h4><p>ä½¿ç”¨Bufferè¯»å†™æ•°æ®ä¸€èˆ¬éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><p>(1) å†™å…¥æ•°æ®åˆ°Bufferï¼Œä¸€èˆ¬æœ‰å¯ä»¥ä»Channelè¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨putæ–¹æ³•å†™å…¥ã€‚</p><p>(2) è°ƒç”¨flip()æ–¹æ³•ï¼Œåˆ‡æ¢æ•°æ®æ¨¡å¼ã€‚</p><p>(3) ä»Bufferä¸­è¯»å–æ•°æ®ï¼Œä¸€èˆ¬ä»ç¼“å†²åŒºè¯»å–æ•°æ®å†™å…¥åˆ°é€šé“ä¸­ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨getæ–¹æ³•è¯»å–ã€‚</p><p>(4) è°ƒç”¨clear()æ–¹æ³•æˆ–è€…compact()æ–¹æ³•ã€‚</p><h4 id="ç¼“å†²åŒºAPI"><a href="#ç¼“å†²åŒºAPI" class="headerlink" title="ç¼“å†²åŒºAPI"></a>ç¼“å†²åŒºAPI</h4><p>é¦–å…ˆï¼Œç”¨allocate æŒ‡å®šç¼“å†²åŒºå¤§å°1024</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer byteBuffer=ByteBuffer.allocate(<span class="number">1024</span>);</span><br></pre></td></tr></table></figure><h5 id="å­˜å‚¨æˆ–å¡«å……"><a href="#å­˜å‚¨æˆ–å¡«å……" class="headerlink" title="å­˜å‚¨æˆ–å¡«å……"></a>å­˜å‚¨æˆ–å¡«å……</h5><p>æˆ‘ä»¬å¯ä»¥ç”¨put å­˜å…¥æ•°æ®åˆ°ç¼“å†²åŒº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">byteBuffer.put(<span class="string">"tengshe789"</span>.getBytes());</span><br></pre></td></tr></table></figure><p>å½“è°ƒç”¨putæ—¶ï¼Œä¼šæŒ‡å‡ºä¸‹ä¸€ä¸ªå…ƒç´ åº”å½“è¢«æ’å…¥çš„ä½ç½®ï¼Œä½ç½®ï¼ˆpositionï¼‰æŒ‡å‘çš„æ˜¯ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæŒ‡å‘çš„ä½ç½®è¶…è¿‡é™åˆ¶ï¼ˆlimitï¼‰ï¼Œåˆ™æŠ›å‡º<code>BufferOverFlowException</code>å¼‚å¸¸ã€‚</p><h5 id="ç¿»è½¬"><a href="#ç¿»è½¬" class="headerlink" title="ç¿»è½¬"></a>ç¿»è½¬</h5><p>Flipå°†ä¸€ä¸ªèƒ½å¤Ÿç»§ç»­æ·»åŠ æ•°æ®å…ƒç´ çš„å¡«å……çŠ¶æ€çš„ç¼“å†²åŒºç¿»è½¬æˆä¸€ä¸ªå‡†å¤‡è¯»å‡ºå…ƒç´ çš„é‡Šæ”¾çŠ¶æ€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">byteBuffer.flip();</span><br></pre></td></tr></table></figure><p>å…·ä½“æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><p>å¯¹äºå·²ç»å†™æ»¡äº†ç¼“å†²åŒºï¼Œå¦‚æœå°†ç¼“å†²åŒºå†…å®¹ä¼ é€’ç»™ä¸€ä¸ªé€šé“ï¼Œä»¥ä½¿å†…å®¹èƒ½è¢«å…¨éƒ¨å†™å‡ºã€‚</p><p>ä½†å¦‚æœé€šé“ç°åœ¨åœ¨ç¼“å†²åŒºä¸Šæ‰§è¡Œgetï¼Œé‚£ä¹ˆå®ƒå°†ä»æˆ‘ä»¬åˆšåˆšæ’å…¥çš„æœ‰ç”¨æ•°æ®ä¹‹å¤–å–å‡ºæœªå®šä¹‰æ•°æ®ã€‚é€šè¿‡ç¿»è½¬å°†ä½ç½®å€¼é‡æ–°è®¾ä¸º 0ï¼Œé€šé“å°±ä¼šä»æ­£ç¡®ä½ç½®å¼€å§‹è·å–ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå®¹é‡æ˜¯10çš„bufferï¼Œå¹¶å¡«å…¥helloï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º  </p><p><img src="/2018/08/25/IOæ¨¡å‹/1535636182144.png" alt="1535636182144"></p><p>ç¿»è½¬åå¦‚ä¸‹å›¾æ‰€ç¤º </p><p><img src="/2018/08/25/IOæ¨¡å‹/1535636206735.png" alt="1535636206735"></p><h5 id="é‡è¯»"><a href="#é‡è¯»" class="headerlink" title="é‡è¯»"></a>é‡è¯»</h5><p>Rewindä¸ flipç›¸ä¼¼ï¼Œä½†ä¸å½±å“ä¸Šç•Œå±æ€§ã€‚å®ƒåªæ˜¯å°†ä½ç½®å€¼è®¾å› 0ã€‚å¯ä»¥ä½¿ç”¨ rewind()åé€€ï¼Œé‡è¯»å·²ç»è¢«ç¿»è½¬çš„ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">byteBuffer.rewind();</span><br></pre></td></tr></table></figure><h5 id="è·å–"><a href="#è·å–" class="headerlink" title="è·å–"></a>è·å–</h5><p>ç¿»è½¬å®Œäº†ï¼Œå°±å¯ä»¥ç”¨getè·å–ç¼“å†²åŒºæ•°æ®äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] b= <span class="keyword">new</span> <span class="keyword">byte</span>[byteBuffer.limit()];</span><br><span class="line">byteBuffer.get(b);</span><br></pre></td></tr></table></figure><p>å½“è°ƒç”¨getæ—¶ï¼Œä¼šæŒ‡å‡ºä¸‹ä¸€ä¸ªå…ƒç´ åº”å½“è¢«ç´¢å¼•çš„ä½ç½®ï¼Œä½ç½®ï¼ˆpositionï¼‰è¿”å›æ—¶ä¼š+1sã€‚å¦‚æœæŒ‡å‘çš„ä½ç½®è¶…è¿‡é™åˆ¶ï¼ˆlimitï¼‰ï¼Œåˆ™æŠ›å‡º<code>BufferUnderFlowException</code>å¼‚å¸¸ã€‚å¦‚æœæä¾›çš„ç´¢å¼•è¶…è¿‡èŒƒå›´ï¼Œä¹Ÿä¼šæŠ›å‡º<code>IndexOutOfBoundsException</code>å¼‚å¸¸</p><h5 id="é‡Šæ”¾"><a href="#é‡Šæ”¾" class="headerlink" title="é‡Šæ”¾"></a>é‡Šæ”¾</h5><p>remainingå¯ä»¥å‘Šè¯‰ä½ ä»å½“å‰ä½ç½®ï¼ˆpositionï¼‰åˆ°é™åˆ¶ï¼ˆlimitï¼‰è¿˜å‰©çš„å…ƒç´ æ•°ç›®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = byteBuffer.remaining();</span><br></pre></td></tr></table></figure><p>clearå°†ç¼“å†²åŒºé‡ç½®ä¸ºç©ºçŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">byteBuffer.clear();</span><br></pre></td></tr></table></figure><h5 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h5><p>å¦‚æœæˆ‘ä»¬åªæƒ³ä»ç¼“å†²åŒºä¸­é‡Šæ”¾ä¸€éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ï¼Œç„¶åé‡æ–°å¡«å……ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæœªè¯»çš„æ•°æ®å…ƒç´ éœ€è¦ä¸‹ç§»ä»¥ä½¿ç¬¬ä¸€ä¸ªå…ƒç´ ç´¢å¼•ä¸º 0ã€‚å°½ç®¡é‡å¤è¿™æ ·åšä¼šæ•ˆç‡ä½ä¸‹ï¼Œä½†è¿™æœ‰æ—¶éå¸¸å¿…è¦ï¼Œè€Œ API å¯¹æ­¤ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ª compact()å‡½æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">byteBuffer.compact();</span><br></pre></td></tr></table></figure><h5 id="æ ‡è®°ä¸é‡ç½®"><a href="#æ ‡è®°ä¸é‡ç½®" class="headerlink" title="æ ‡è®°ä¸é‡ç½®"></a>æ ‡è®°ä¸é‡ç½®</h5><p>æ ‡è®°æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œé€šè¿‡Bufferä¸­çš„mark()æ–¹æ³•æŒ‡å®šBufferä¸­ä¸€ä¸ªç‰¹å®šçš„positionï¼Œä¹‹åå¯ä»¥é€šè¿‡è°ƒç”¨reset()æ–¹æ³•æ¢å¤åˆ°è¿™ä¸ªpositionã€‚è¦çŸ¥é“ç¼“å†²åŒºçš„æ ‡è®°åœ¨mark()å‡½æ•°è¢«è°ƒç”¨å‰æ—¶æœªå®šä¹‰çš„ï¼Œå¦‚æœæ ‡è®°æœªå®šä¹‰ï¼Œè°ƒç”¨reset()ä¼šå¯¼è‡´<code>InvalidMarkException</code>å¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">byteBuffer.position(<span class="number">2</span>).mark().position(<span class="number">4</span>).reset();</span><br></pre></td></tr></table></figure><p>è¦æ³¨æ„ï¼Œjava.nioä¸­çš„ç±»ç‰¹æ„è¢«è®¾è®¡ä¸ºæ”¯æŒçº§è”è°ƒç”¨ï¼Œä¼˜é›…çš„ä½¿ç”¨çº§è”è°ƒç”¨ï¼Œå¯ä»¥äº§ç”Ÿä¼˜ç¾æ˜“è¯»çš„ä»£ç ã€‚</p><h4 id="ç›´æ¥ç¼“å†²åŒºä¸éç›´æ¥ç¼“å†²åŒº"><a href="#ç›´æ¥ç¼“å†²åŒºä¸éç›´æ¥ç¼“å†²åŒº" class="headerlink" title="ç›´æ¥ç¼“å†²åŒºä¸éç›´æ¥ç¼“å†²åŒº"></a>ç›´æ¥ç¼“å†²åŒºä¸éç›´æ¥ç¼“å†²åŒº</h4><h5 id="éç›´æ¥ç¼“å†²åŒº"><a href="#éç›´æ¥ç¼“å†²åŒº" class="headerlink" title="éç›´æ¥ç¼“å†²åŒº"></a>éç›´æ¥ç¼“å†²åŒº</h5><p>ä¸Šé¢æˆ‘ä»¬è¯´äº†ByteBufferï¼Œä¹Ÿå°±æ˜¯ç¼“å†²åŒºçš„ç”¨æ³•ï¼Œè­¬å¦‚ç”¨<code>allocate()</code> æ–¹æ³•æŒ‡å®šç¼“å†²åŒºå¤§å°ï¼Œç„¶åè¿›è¡Œå¡«å……æˆ–ç¿»è½¬æ“ä½œç­‰ç­‰ç­‰ã€‚æˆ‘ä»¬æ‰€åˆ›å»ºçš„ç¼“å†²åŒºï¼Œéƒ½å±äºç›´æ¥ç¼“å†²åŒºã€‚ä»–ä»¬éƒ½æ˜¯åœ¨JVM<strong>ä¸­</strong>å†…å­˜ä¸­åˆ›å»ºï¼Œåœ¨æ¯æ¬¡è°ƒç”¨åŸºç¡€æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªæœ¬æœºIOä¹‹å‰æˆ–è€…ä¹‹åï¼Œè™šæ‹Ÿæœºéƒ½ä¼šå°†ç¼“å†²åŒºçš„å†…å®¹å¤åˆ¶åˆ°ä¸­é—´ç¼“å†²åŒºï¼ˆæˆ–è€…ä»ä¸­é—´ç¼“å†²åŒºå¤åˆ¶å†…å®¹ï¼‰ï¼Œç¼“å†²åŒºçš„å†…å®¹é©»ç•™åœ¨JVMå†…ï¼Œå› æ­¤é”€æ¯å®¹æ˜“ï¼Œä½†æ˜¯å ç”¨JVMå†…å­˜å¼€é”€ï¼Œå¤„ç†è¿‡ç¨‹ä¸­æœ‰å¤åˆ¶æ“ä½œã€‚ </p><p>éç›´æ¥ç¼“å†²åŒºå†™å…¥æ­¥éª¤ï¼š</p><p>1.åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ç›´æ¥ByteBufferå¯¹è±¡ã€‚<br>2.å°†éç›´æ¥ç¼“å†²åŒºçš„å†…å®¹å¤åˆ¶åˆ°ä¸´æ—¶ç¼“å†²ä¸­ã€‚<br>3.ä½¿ç”¨ä¸´æ—¶ç¼“å†²åŒºæ‰§è¡Œä½å±‚æ¬¡I/Oæ“ä½œã€‚<br>4.ä¸´æ—¶ç¼“å†²åŒºå¯¹è±¡ç¦»å¼€ä½œç”¨åŸŸï¼Œå¹¶æœ€ç»ˆæˆä¸ºè¢«å›æ”¶çš„æ— ç”¨æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: UndirectBuffer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: åˆ©ç”¨é€šé“å®Œæˆæ–‡ä»¶çš„å¤åˆ¶(éç›´æ¥ç¼“å†²åŒº)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: tEngSHe789</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UndirectBuffer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæµ</span></span><br><span class="line">        FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">"d://blog.md"</span>);</span><br><span class="line">        FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">"d://blog.md"</span>);</span><br><span class="line">        <span class="comment">//è·å–ç®¡é“</span></span><br><span class="line">        FileChannel in = fis.getChannel();</span><br><span class="line">        FileChannel out = fos.getChannel();</span><br><span class="line">        <span class="comment">// åˆ†é…æŒ‡å®šå¤§å°çš„ç¼“å†²åŒº</span></span><br><span class="line">        ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">while</span> (in.read(buffer) !=-<span class="number">1</span>)&#123;</span><br><span class="line">            buffer.flip();<span class="comment">// å‡†å¤‡è¯»æ•°æ®äº†</span></span><br><span class="line">            out.write(buffer);</span><br><span class="line">            buffer.clear();</span><br><span class="line">        &#125;</span><br><span class="line">        out.close();</span><br><span class="line">        in.close();</span><br><span class="line">        fis.close();</span><br><span class="line">        fos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç›´æ¥ç¼“å†²åŒº"><a href="#ç›´æ¥ç¼“å†²åŒº" class="headerlink" title="ç›´æ¥ç¼“å†²åŒº"></a>ç›´æ¥ç¼“å†²åŒº</h5><p>ç›´æ¥ç¼“å†²åŒºï¼Œæ˜¯é€šè¿‡ <code>allocateDirect()</code> æ–¹æ³•åœ¨JVMå†…å­˜<strong>å¤–</strong>å¼€è¾Ÿå†…å­˜ï¼Œåœ¨æ¯æ¬¡è°ƒç”¨åŸºç¡€<strong>æ“ä½œç³»ç»Ÿ</strong>çš„ä¸€ä¸ªæœ¬æœºIOä¹‹å‰æˆ–è€…ä¹‹åï¼Œè™šæ‹Ÿæœºéƒ½ä¼šé¿å…å°†ç¼“å†²åŒºçš„å†…å®¹å¤åˆ¶åˆ°ä¸­é—´ç¼“å†²åŒºï¼ˆæˆ–è€…ä»ä¸­é—´ç¼“å†²åŒºå¤åˆ¶å†…å®¹ï¼‰ï¼Œç¼“å†²åŒºçš„å†…å®¹é©»ç•™åœ¨<strong>ç‰©ç†å†…å­˜</strong>å†…ï¼Œä¼šå°‘ä¸€æ¬¡å¤åˆ¶è¿‡ç¨‹ï¼Œå¦‚æœéœ€è¦å¾ªç¯ä½¿ç”¨ç¼“å†²åŒºï¼Œç”¨ç›´æ¥ç¼“å†²åŒºå¯ä»¥å¾ˆå¤§åœ°æé«˜æ€§èƒ½ã€‚</p><p>è™½ç„¶ç›´æ¥ç¼“å†²åŒºä½¿JVMå¯ä»¥è¿›è¡Œé«˜æ•ˆçš„I/Oæ“ä½œï¼Œä½†å®ƒä½¿ç”¨çš„å†…å­˜æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…çš„ï¼Œç»•è¿‡äº†JVMå †æ ˆï¼Œå»ºç«‹å’Œé”€æ¯æ¯”å †æ ˆä¸Šçš„ç¼“å†²åŒºè¦æ›´å¤§çš„å¼€é”€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: DirectBuffer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: ä½¿ç”¨ç›´æ¥ç¼“å†²åŒºå®Œæˆæ–‡ä»¶çš„å¤åˆ¶(å†…å­˜æ˜ å°„æ–‡ä»¶)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: tEngSHe789</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DirectBuffer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºç®¡é“</span></span><br><span class="line">        FileChannel in=FileChannel.open(Paths.get(<span class="string">"d://blog.md"</span>),StandardOpenOption.READ);</span><br><span class="line">        FileChannel out=FileChannel.open(Paths.get(<span class="string">"d://blog.md"</span>),StandardOpenOption.WRITE</span><br><span class="line">                        ,StandardOpenOption.READ,StandardOpenOption.CREATE);</span><br><span class="line">        <span class="comment">// æ‹¿åˆ°å°†ç®¡é“å†…å®¹æ˜ å°„åˆ°å†…å­˜çš„ç›´æ¥ç¼“å†²åŒºæ˜ å°„æ–‡ä»¶ï¼ˆä¸€ä¸ªä½ç½®åœ¨ç¡¬ç›˜çš„åŸºäºå†…å­˜çš„ç¼“å†²åŒºï¼‰</span></span><br><span class="line">        MappedByteBuffer inMappedByteBuffer = in.map(FileChannel.MapMode.READ_ONLY, <span class="number">0</span>, in.size());</span><br><span class="line">        MappedByteBuffer outMappedByteBuffer = out.map(FileChannel.MapMode.READ_WRITE, <span class="number">0</span>, in.size());</span><br><span class="line">        <span class="comment">// å¯¹ç›´æ¥ç¼“å†²åŒºè¿›è¡Œæ•°æ®è¯»å†™æ“ä½œ</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes=<span class="keyword">new</span> <span class="keyword">byte</span>[inMappedByteBuffer.limit()];</span><br><span class="line">        inMappedByteBuffer.get(bytes);</span><br><span class="line">        outMappedByteBuffer.put(bytes);</span><br><span class="line">        in.close();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç›´æ¥ç¼“å†²åŒºä¸éç›´æ¥ç¼“å†²åŒºçš„åŒºåˆ«"><a href="#ç›´æ¥ç¼“å†²åŒºä¸éç›´æ¥ç¼“å†²åŒºçš„åŒºåˆ«" class="headerlink" title="ç›´æ¥ç¼“å†²åŒºä¸éç›´æ¥ç¼“å†²åŒºçš„åŒºåˆ«"></a>ç›´æ¥ç¼“å†²åŒºä¸éç›´æ¥ç¼“å†²åŒºçš„åŒºåˆ«</h5><ol><li>å­—èŠ‚ç¼“å†²åŒºè¦ä¹ˆæ˜¯ç›´æ¥çš„ï¼Œè¦ä¹ˆæ˜¯éç›´æ¥çš„ã€‚å¦‚æœä¸ºç›´æ¥å­—èŠ‚ç¼“å†²åŒºï¼Œåˆ™ Java è™šæ‹Ÿæœºä¼šå°½æœ€å¤§åŠªåŠ›ç›´æ¥åœ¨æ­¤ç¼“å†²åŒºä¸Šæ‰§è¡Œæœ¬æœº I/O æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ¯æ¬¡è°ƒç”¨åŸºç¡€æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªæœ¬æœº I/O æ“ä½œä¹‹å‰ï¼ˆæˆ–ä¹‹åï¼‰ï¼Œè™šæ‹Ÿæœºéƒ½ä¼šå°½é‡é¿å…å°†ç¼“å†²åŒºçš„å†…å®¹å¤åˆ¶åˆ°ä¸­é—´ç¼“å†²åŒºä¸­ï¼ˆæˆ–ä»ä¸­é—´ç¼“å†²åŒºä¸­å¤åˆ¶å†…å®¹ï¼‰ã€‚</li><li>ç›´æ¥å­—èŠ‚ç¼“å†²åŒºå¯ä»¥é€šè¿‡è°ƒç”¨æ­¤ç±»çš„ <code>allocateDirect()</code> å·¥å‚æ–¹æ³•æ¥åˆ›å»ºã€‚æ­¤æ–¹æ³•è¿”å›çš„ç¼“å†²åŒºè¿›è¡Œåˆ†é…å’Œå–æ¶ˆåˆ†é…æ‰€éœ€æˆæœ¬é€šå¸¸é«˜äºéç›´æ¥ç¼“å†²åŒºã€‚ç›´æ¥ç¼“å†²åŒºçš„å†…å®¹å¯ä»¥é©»ç•™åœ¨å¸¸è§„çš„åƒåœ¾å›æ”¶å †ä¹‹å¤–ï¼Œå› æ­¤ï¼Œå®ƒä»¬å¯¹åº”ç”¨ç¨‹åºçš„å†…å­˜éœ€æ±‚é‡é€ æˆçš„å½±å“å¯èƒ½å¹¶ä¸æ˜æ˜¾ã€‚æ‰€ä»¥ï¼Œå»ºè®®å°†ç›´æ¥ç¼“å†²åŒºä¸»è¦åˆ†é…ç»™é‚£äº›æ˜“å—åŸºç¡€ç³»ç»Ÿçš„æœ¬æœº I/O æ“ä½œå½±å“çš„å¤§å‹ã€æŒä¹…çš„ç¼“å†²åŒºã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæœ€å¥½ä»…åœ¨ç›´æ¥ç¼“å†²åŒºèƒ½åœ¨ç¨‹åºæ€§èƒ½æ–¹é¢å¸¦æ¥æ˜æ˜¾å¥½å¤„æ—¶åˆ†é…å®ƒä»¬ã€‚</li><li>ç›´æ¥å­—èŠ‚ç¼“å†²åŒºè¿˜å¯ä»¥é€šè¿‡ <code>FileChannel</code> çš„ <code>map()</code> æ–¹æ³• å°†æ–‡ä»¶åŒºåŸŸç›´æ¥æ˜ å°„åˆ°å†…å­˜ä¸­æ¥åˆ›å»ºã€‚è¯¥æ–¹æ³•è¿”å›<code>MappedByteBuffer</code> ã€‚ Java å¹³å°çš„å®ç°æœ‰åŠ©äºé€šè¿‡ JNI ä»æœ¬æœºä»£ç åˆ›å»ºç›´æ¥å­—èŠ‚ç¼“å†²åŒºã€‚å¦‚æœä»¥ä¸Šè¿™äº›ç¼“å†²åŒºä¸­çš„æŸä¸ªç¼“å†²åŒºå®ä¾‹æŒ‡çš„æ˜¯ä¸å¯è®¿é—®çš„å†…å­˜åŒºåŸŸï¼Œåˆ™è¯•å›¾è®¿é—®è¯¥åŒºåŸŸä¸ä¼šæ›´æ”¹è¯¥ç¼“å†²åŒºçš„å†…å®¹ï¼Œå¹¶ä¸”å°†ä¼šåœ¨è®¿é—®æœŸé—´æˆ–ç¨åçš„æŸä¸ªæ—¶é—´å¯¼è‡´æŠ›å‡ºä¸ç¡®å®šçš„å¼‚å¸¸ã€‚</li><li>å­—èŠ‚ç¼“å†²åŒºæ˜¯ç›´æ¥ç¼“å†²åŒºè¿˜æ˜¯éç›´æ¥ç¼“å†²åŒºå¯é€šè¿‡è°ƒç”¨å…¶ <code>isDirect()</code> æ–¹æ³•æ¥ç¡®å®šã€‚æä¾›æ­¤æ–¹æ³•æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨æ€§èƒ½å…³é”®å‹ä»£ç ä¸­æ‰§è¡Œæ˜¾å¼ç¼“å†²åŒºç®¡ç†ã€‚</li></ol><h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><p>é€šé“æ˜¯java.nioçš„ç¬¬äºŒä¸ªåˆ›æ–°ï¼Œè¡¨ç¤ºæä¾› IO è®¾å¤‡(ä¾‹å¦‚ï¼šæ–‡ä»¶ã€å¥—æ¥å­—)çš„ç›´æ¥è¿æ¥ã€‚</p><p>è‹¥éœ€è¦ä½¿ç”¨ NIO ç³»ç»Ÿï¼Œéœ€è¦è·å–ç”¨äºè¿æ¥ IO è®¾å¤‡çš„é€šé“ä»¥åŠç”¨äºå®¹çº³æ•°æ®çš„ç¼“å†²åŒºã€‚ç„¶åæ“ä½œç¼“å†²åŒºï¼Œå¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚è¿™å…¶ä¸­ï¼ŒChannelè´Ÿè´£ä¼ è¾“ï¼Œ Buffer è´Ÿè´£å­˜å‚¨ã€‚</p><p>é€šé“æ˜¯ç”±java.nio.channels åŒ…å®šä¹‰çš„ï¼ŒChannel è¡¨ç¤º IO æºä¸ç›®æ ‡æ‰“å¼€çš„è¿æ¥ã€‚Channel ç±»ä¼¼äºä¼ ç»Ÿçš„â€œæµâ€ã€‚åªä¸è¿‡ Channelæœ¬èº«ä¸èƒ½ç›´æ¥è®¿é—®æ•°æ®ï¼Œ <strong>Channel åªèƒ½ä¸Buffer è¿›è¡Œäº¤äº’</strong>ã€‚</p><h4 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h4><p>java.nio.channels.Channel æ¥å£ï¼š</p><ul><li>FileChannel</li><li>SocketChannel</li><li>ServerSocketChannel</li><li>DatagramChannel</li></ul><p>ä¸ç¼“å†²åŒºä¸åŒï¼Œé€šé“APIä¸»è¦ç”±æ¥å£æŒ‡å®šï¼Œä¸åŒæ“ä½œç³»ç»Ÿä¸Šé€šé“çš„å®ç°ä¼šä¸ä¸€æ ·</p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>ç›´æ¥ç¼“å†²åŒºä¸éç›´æ¥ç¼“å†²åŒºçš„æ —å­</p><h4 id="åˆ†æ•£è¯»å–ä¸èšé›†å†™å…¥"><a href="#åˆ†æ•£è¯»å–ä¸èšé›†å†™å…¥" class="headerlink" title="åˆ†æ•£è¯»å–ä¸èšé›†å†™å…¥"></a>åˆ†æ•£è¯»å–ä¸èšé›†å†™å…¥</h4><p>é€šé“å¯ä»¥æœ‰é€‰æ‹©åœ°å®ç°ä¸¤ä¸ªæ–°çš„æ¥å£ï¼š <code>ScatteringByteChannel</code> å’Œ <code>GatheringByteChannel</code>ã€‚</p><p><img src="/2018/08/25/IOæ¨¡å‹/1535700194601.png" alt="1535700194601"></p><p><code>ScatteringByteChannel</code> æœ‰2ä¸ªreadæ–¹æ³•ï¼Œæˆ‘ä»¬éƒ½å«å¥¹åˆ†æ•£è¯»å–(scattering Reads)ï¼Œåˆ†æ•£è¯»å–ä¸­ï¼Œé€šé“ä¾æ¬¡å¡«å……æ¯ä¸ªç¼“å†²åŒºã€‚å¡«æ»¡ä¸€ä¸ªç¼“å†²åŒºåï¼Œå®ƒå°±å¼€å§‹å¡«å……ä¸‹ä¸€ä¸ªã€‚åœ¨æŸç§æ„ä¹‰ä¸Šï¼Œç¼“å†²åŒºæ•°ç»„å°±åƒä¸€ä¸ªå¤§ç¼“å†²åŒºã€‚</p><p><img src="/2018/08/25/IOæ¨¡å‹/1535700216940.png" alt="1535700216940"></p><p><code>GatheringByteChannel</code>ä¸­æœ‰2ä¸ªwirteæ–¹æ³•ï¼Œæˆ‘ä»¬éƒ½å«å¥¹èšé›†å†™å…¥(gathering Writes)ï¼Œä»–å¯ä»¥å°†å¤šä¸ªç¼“å†²åŒºçš„æ•°æ®èšé›†åˆ°é€šé“ä¸­</p><h5 id="åˆ†æ•£è¯»å–ä¸èšé›†å†™å…¥çš„åº”ç”¨"><a href="#åˆ†æ•£è¯»å–ä¸èšé›†å†™å…¥çš„åº”ç”¨" class="headerlink" title="åˆ†æ•£è¯»å–ä¸èšé›†å†™å…¥çš„åº”ç”¨"></a>åˆ†æ•£è¯»å–ä¸èšé›†å†™å…¥çš„åº”ç”¨</h5><p>åˆ†æ•£è¯»å–/èšé›†å†™å…¥å¯¹äºå°†æ•°æ®åˆ’åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½åœ¨ç¼–å†™ä¸€ä¸ªä½¿ç”¨æ¶ˆæ¯å¯¹è±¡çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæ¯ä¸€ä¸ªæ¶ˆæ¯è¢«åˆ’åˆ†ä¸ºå›ºå®šé•¿åº¦çš„å¤´éƒ¨å’Œå›ºå®šé•¿åº¦çš„æ­£æ–‡ã€‚æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåˆšå¥½å¯ä»¥å®¹çº³å¤´éƒ¨çš„ç¼“å†²åŒºå’Œå¦ä¸€ä¸ªåˆšå¥½å¯ä»¥å®¹éš¾æ­£æ–‡çš„ç¼“å†²åŒºã€‚å½“æ‚¨å°†å®ƒä»¬æ”¾å…¥ä¸€ä¸ªæ•°ç»„ä¸­å¹¶ä½¿ç”¨åˆ†æ•£è¯»å–æ¥å‘å®ƒä»¬è¯»å…¥æ¶ˆæ¯æ—¶ï¼Œå¤´éƒ¨å’Œæ­£æ–‡å°†æ•´é½åœ°åˆ’åˆ†åˆ°è¿™ä¸¤ä¸ªç¼“å†²åŒºä¸­ã€‚</p><p>æˆ‘ä»¬ä»ç¼“å†²åŒºæ‰€å¾—åˆ°çš„æ–¹ä¾¿æ€§å¯¹äºç¼“å†²åŒºæ•°ç»„åŒæ ·æœ‰æ•ˆã€‚å› ä¸ºæ¯ä¸€ä¸ªç¼“å†²åŒºéƒ½è·Ÿè¸ªè‡ªå·±è¿˜å¯ä»¥æ¥å—å¤šå°‘æ•°æ®ï¼Œæ‰€ä»¥åˆ†æ•£è¯»å–ä¼šè‡ªåŠ¨æ‰¾åˆ°æœ‰ç©ºé—´æ¥å—æ•°æ®çš„ç¬¬ä¸€ä¸ªç¼“å†²åŒºã€‚åœ¨è¿™ä¸ªç¼“å†²åŒºå¡«æ»¡åï¼Œå®ƒå°±ä¼šç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç¼“å†²åŒºã€‚</p><h2 id="Pythonä¸NIO"><a href="#Pythonä¸NIO" class="headerlink" title="Pythonä¸NIO"></a>Pythonä¸NIO</h2><p>æœåŠ¡ç«¯ï¼ˆå…·ä½“è§æ³¨é‡Šï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">s=socket(AF_INET,SOCK_STREAM)</span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8888</span>))</span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line">s.setblocking(<span class="keyword">False</span>) <span class="comment">#è®¾ç½®socketçš„æ¥å£ä¸ºéé˜»å¡</span></span><br><span class="line">conn_l=[] <span class="comment"># å­˜å‚¨å’Œserverçš„è¿æ¥ çš„ è¿æ¥</span></span><br><span class="line">del_l=[] <span class="comment"># å­˜å‚¨å’Œå’Œserverçš„æ–­å¼€ çš„ è¿æ¥</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸é˜»å¡çš„</span></span><br><span class="line">        conn,addr=s.accept() <span class="comment"># å½“æ²¡äººè¿æ¥çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œèµ°exceptionï¼ˆ&lt;- pyä¸­æ˜¯exceptï¼‰</span></span><br><span class="line">        conn_l.append(conn)</span><br><span class="line">    <span class="keyword">except</span> BlockingIOError:</span><br><span class="line">        print(conn_l)</span><br><span class="line">        <span class="keyword">for</span> conn <span class="keyword">in</span> conn_l:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data=conn.recv(<span class="number">1024</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                    del_l.append(conn)</span><br><span class="line">                <span class="comment"># è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸é˜»å¡çš„</span></span><br><span class="line">                data=conn.recv(<span class="number">1024</span>) <span class="comment"># ä¸é˜»å¡</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> data: <span class="comment"># å¦‚æœæ‹¿ä¸åˆ°data</span></span><br><span class="line">                    del_l.append(conn) <span class="comment"># åœ¨åºŸå¼ƒåˆ—è¡¨ä¸­æ·»åŠ conn</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                conn.send(data.upper())</span><br><span class="line">            <span class="keyword">except</span> BlockingIOError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">except</span> ConnectionResetError:</span><br><span class="line">                del_l.append(conn)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> conn <span class="keyword">in</span> del_l:</span><br><span class="line">            conn_l.remove(conn)</span><br><span class="line">            conn.close()</span><br><span class="line">        del_l=[]</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line">c=socket(AF_INET,SOCK_STREAM)</span><br><span class="line">c.connect((<span class="string">'127.0.0.1'</span>,<span class="number">8888</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    msg=input(<span class="string">'&gt;&gt;: '</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> msg:<span class="keyword">continue</span></span><br><span class="line">    c.send(msg.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    data=c.recv(<span class="number">1024</span>)</span><br><span class="line">    print(data.decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure><h1 id="IOå¤ç”¨-IO-multiplexing"><a href="#IOå¤ç”¨-IO-multiplexing" class="headerlink" title="IOå¤ç”¨(IO multiplexing)"></a>IOå¤ç”¨(IO multiplexing)</h1><p>I/Oå¤šè·¯å¤ç”¨å®é™…ä¸Šå°±æ˜¯ç”¨select, poll, epollç›‘å¬å¤šä¸ªioå¯¹è±¡ï¼Œå½“ioå¯¹è±¡æœ‰å˜åŒ–ï¼ˆæœ‰æ•°æ®ï¼‰çš„æ—¶å€™å°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚æœ‰äº›åœ°æ–¹ä¹Ÿç§°è¿™ç§IOæ–¹å¼ä¸º<strong>äº‹ä»¶é©±åŠ¨IO</strong>(event driven IO)ã€‚ä¸å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æŠ€æœ¯ç›¸æ¯”ï¼ŒI/Oå¤šè·¯å¤ç”¨æŠ€æœ¯çš„æœ€å¤§ä¼˜åŠ¿æ˜¯ç³»ç»Ÿå¼€é”€å°ï¼Œç³»ç»Ÿä¸å¿…åˆ›å»ºè¿›ç¨‹/çº¿ç¨‹ï¼Œä¹Ÿä¸å¿…ç»´æŠ¤è¿™äº›è¿›ç¨‹/çº¿ç¨‹ï¼Œä»è€Œå¤§å¤§å‡å°äº†ç³»ç»Ÿçš„å¼€é”€ã€‚å½“ç„¶å…·ä½“çš„å¯ä»¥çœ‹çœ‹è¿™ç¯‡<a href="https://www.cnblogs.com/jeakeven/p/5435916.html" target="_blank" rel="noopener">åšå®¢</a>ï¼Œç°åœ¨å…ˆæ¥çœ‹ä¸‹I/Oå¤šè·¯å¤ç”¨çš„æµç¨‹ï¼š</p><p><img src="/2018/08/25/IOæ¨¡å‹/1535201615305.png" alt="1535201615305"></p><p>ï¼ˆ1ï¼‰å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†selectï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹ä¼šè¢«blockï¼›</p><p>ï¼ˆ2ï¼‰è€ŒåŒæ—¶ï¼Œkernelä¼šâ€œç›‘è§†â€æ‰€æœ‰selectè´Ÿè´£çš„socketï¼›</p><p>ï¼ˆ3ï¼‰å½“ä»»ä½•ä¸€ä¸ªsocketä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œselectå°±ä¼šè¿”å›ï¼›</p><p>ï¼ˆ4ï¼‰è¿™ä¸ªæ—¶å€™ç”¨æˆ·è¿›ç¨‹å†è°ƒç”¨readæ“ä½œï¼Œå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ã€‚</p><p>è¿™ä¸ªå›¾å’ŒBIOçš„å›¾å…¶å®å¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒï¼Œäº‹å®ä¸Šè¿˜æ›´å·®ä¸€äº›ã€‚å› ä¸ºè¿™é‡Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨(selectå’Œrecvfrom)ï¼Œè€ŒBIOåªè°ƒç”¨äº†ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨(recvfrom)ã€‚ä½†æ˜¯ï¼Œç”¨selectçš„ä¼˜åŠ¿åœ¨äºå®ƒå¯ä»¥<strong>åŒæ—¶å¤„ç†å¤šä¸ªconnection</strong>ã€‚</p><h2 id="JAVAå®ç°IOå¤ç”¨"><a href="#JAVAå®ç°IOå¤ç”¨" class="headerlink" title="JAVAå®ç°IOå¤ç”¨"></a>JAVAå®ç°IOå¤ç”¨</h2><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯java.nioä¸‹æ¨¡å—æ¥å®ŒæˆI/Oå¤šè·¯å¤ç”¨çš„ä¾‹å­ã€‚æˆ‘ç”¨åˆ°çš„Selectorï¼ˆé€‰æ‹©å™¨ï¼‰ï¼Œæ˜¯Java NIOä¸­èƒ½å¤Ÿæ£€æµ‹ä¸€åˆ°å¤šä¸ªNIOé€šé“ï¼Œå¹¶èƒ½å¤ŸçŸ¥æ™“é€šé“æ˜¯å¦ä¸ºè¯¸å¦‚è¯»å†™äº‹ä»¶åšå¥½å‡†å¤‡çš„ç»„ä»¶ã€‚è¿™æ ·ï¼Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªchannelï¼Œä»è€Œç®¡ç†å¤šä¸ªç½‘ç»œè¿æ¥ã€‚</p><h3 id="Selectorçš„ä½¿ç”¨"><a href="#Selectorçš„ä½¿ç”¨" class="headerlink" title="Selectorçš„ä½¿ç”¨"></a>Selectorçš„ä½¿ç”¨</h3><h4 id="Selectorçš„åˆ›å»º"><a href="#Selectorçš„åˆ›å»º" class="headerlink" title="Selectorçš„åˆ›å»º"></a>Selectorçš„åˆ›å»º</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Selector selector = Selector.open();</span><br></pre></td></tr></table></figure><h4 id="å‘Selectoræ³¨å†Œé€šé“"><a href="#å‘Selectoræ³¨å†Œé€šé“" class="headerlink" title="å‘Selectoræ³¨å†Œé€šé“"></a>å‘Selectoræ³¨å†Œé€šé“</h4><p>ä¸ºäº†å°†Channelå’ŒSelectoré…åˆä½¿ç”¨ï¼Œå¿…é¡»å°†channelæ³¨å†Œåˆ°selectorä¸Šã€‚é€šè¿‡SelectableChannel.register()æ–¹æ³•æ¥å®ç°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">SelectionKey key = channel.register(selector,Selectionkey.OP_READ);</span><br></pre></td></tr></table></figure><p>register()æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªâ€œinteresté›†åˆâ€ï¼Œæ„æ€æ˜¯åœ¨é€šè¿‡Selectorç›‘å¬Channelæ—¶å¯¹ä»€ä¹ˆäº‹ä»¶æ„Ÿå…´è¶£ã€‚å¯ä»¥ç›‘å¬å››ç§ä¸åŒç±»å‹çš„äº‹ä»¶ï¼šConnectã€Acceptã€Readã€Write</p><p>é€šé“è§¦å‘äº†ä¸€ä¸ªäº‹ä»¶æ„æ€æ˜¯è¯¥äº‹ä»¶å·²ç»å°±ç»ªã€‚æ‰€ä»¥ï¼ŒæŸä¸ªchannelæˆåŠŸè¿æ¥åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ç§°ä¸ºâ€œè¿æ¥å°±ç»ªâ€ã€‚ä¸€ä¸ªserver socket channelå‡†å¤‡å¥½æ¥æ”¶æ–°è¿›å…¥çš„è¿æ¥ç§°ä¸ºâ€œæ¥æ”¶å°±ç»ªâ€ã€‚ä¸€ä¸ªæœ‰æ•°æ®å¯è¯»çš„é€šé“å¯ä»¥è¯´æ˜¯â€œè¯»å°±ç»ªâ€ã€‚ç­‰å¾…å†™æ•°æ®çš„é€šé“å¯ä»¥è¯´æ˜¯â€œå†™å°±ç»ªâ€ã€‚</p><p>è¿™å››ç§äº‹ä»¶ç”¨SelectionKeyçš„å››ä¸ªå¸¸é‡æ¥è¡¨ç¤ºï¼š</p><ol><li>SelectionKey.OP_CONNECTå¯è¿æ¥</li><li>SelectionKey.OP_ACCEPTå¯æ¥å—è¿æ¥</li><li>SelectionKey.OP_READå¯è¯»</li><li>SelectionKey.OP_WRITEå¯å†™</li></ol><h4 id="SelectionKey"><a href="#SelectionKey" class="headerlink" title="SelectionKey"></a>SelectionKey</h4><p>å½“å‘Selectoræ³¨å†ŒChannelæ—¶ï¼Œregister()æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªSelectionKeyå¯¹è±¡ã€‚å®ƒåŒ…å«äº†ï¼š</p><ul><li>interesté›†åˆ</li><li>readyé›†åˆ</li><li>Channel</li><li>Selector</li><li>é™„åŠ çš„å¯¹è±¡ï¼ˆå¯é€‰ï¼‰</li></ul><h5 id="interesté›†åˆ"><a href="#interesté›†åˆ" class="headerlink" title="interesté›†åˆ"></a>interesté›†åˆ</h5><p>interesté›†åˆæ˜¯ä½ æ‰€é€‰æ‹©çš„æ„Ÿå…´è¶£çš„äº‹ä»¶é›†åˆã€‚å¯ä»¥é€šè¿‡SelectionKeyè¯»å†™interesté›†åˆï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> interestSet = selectionKey.interestOps();</span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> isInterestedInAccept  = (interestSet &amp; SelectionKey.OP_ACCEPT) == SelectionKey.OP_ACCEPTï¼›</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInConnect = interestSet &amp; SelectionKey.OP_CONNECT;</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInRead    = interestSet &amp; SelectionKey.OP_READ;</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInWrite   = interestSet &amp; SelectionKey.OP_WRITE;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œç”¨â€œä½ä¸â€æ“ä½œinterest é›†åˆå’Œç»™å®šçš„SelectionKeyå¸¸é‡ï¼Œå¯ä»¥ç¡®å®šæŸä¸ªç¡®å®šçš„äº‹ä»¶æ˜¯å¦åœ¨interest é›†åˆä¸­ã€‚</p><h5 id="readyé›†åˆ"><a href="#readyé›†åˆ" class="headerlink" title="readyé›†åˆ"></a>readyé›†åˆ</h5><p>ready é›†åˆæ˜¯é€šé“å·²ç»å‡†å¤‡å°±ç»ªçš„æ“ä½œçš„é›†åˆã€‚åœ¨ä¸€æ¬¡é€‰æ‹©(Selection)ä¹‹åï¼Œä½ ä¼šé¦–å…ˆè®¿é—®è¿™ä¸ªready setã€‚Selectionå°†åœ¨ä¸‹ä¸€å°èŠ‚è¿›è¡Œè§£é‡Šã€‚å¯ä»¥è¿™æ ·è®¿é—®readyé›†åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> readySet = selectionKey.readyOps();</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨åƒæ£€æµ‹interesté›†åˆé‚£æ ·çš„æ–¹æ³•ï¼Œæ¥æ£€æµ‹channelä¸­ä»€ä¹ˆäº‹ä»¶æˆ–æ“ä½œå·²ç»å°±ç»ªã€‚ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å››ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬éƒ½ä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">selectionKey.isAcceptable();</span><br><span class="line">selectionKey.isConnectable();</span><br><span class="line">selectionKey.isReadable();</span><br><span class="line">selectionKey.isWritable();</span><br></pre></td></tr></table></figure><h4 id="ä»SelectionKeyè®¿é—®Channelå’ŒSelector"><a href="#ä»SelectionKeyè®¿é—®Channelå’ŒSelector" class="headerlink" title="ä»SelectionKeyè®¿é—®Channelå’ŒSelector"></a>ä»SelectionKeyè®¿é—®Channelå’ŒSelector</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Channel  channel  = selectionKey.channel();</span><br><span class="line">Selector selector = selectionKey.selector();</span><br></pre></td></tr></table></figure><h3 id="javaä»£ç "><a href="#javaä»£ç " class="headerlink" title="javaä»£ç "></a>javaä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: NIOServer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æœåŠ¡ç«¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: tEngSHe789</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NIOServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æœåŠ¡ç«¯Start...."</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºé€šé“</span></span><br><span class="line">        ServerSocketChannel serverSocketChannel=ServerSocketChannel.open();</span><br><span class="line">        <span class="comment">// è®¾ç½®éé˜»å¡</span></span><br><span class="line">        serverSocketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// ç»‘å®šè¿æ¥</span></span><br><span class="line">        serverSocketChannel.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8888</span>));</span><br><span class="line">        <span class="comment">// è·å–é€‰æ‹©å™¨</span></span><br><span class="line">        Selector selector=Selector.open();</span><br><span class="line">        <span class="comment">// å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨</span></span><br><span class="line">        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">        <span class="comment">// è½®è°ƒå¼è·å–é€‰æ‹©â€œå·²ç»å‡†å¤‡å°±ç»ªâ€çš„äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">while</span> (selector.select() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">// è·å–å½“å‰é€‰æ‹©å™¨çš„å·¦å³å·²ç»å‡†å¤‡å°±ç»ªçš„ç›‘å¬äº‹ä»¶ï¼ˆé€‰æ‹©keyï¼‰</span></span><br><span class="line">            Iterator&lt;SelectionKey&gt; iterator=selector.selectedKeys().iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">                <span class="comment">// è·å–å‡†å¤‡å°±ç»ªäº‹ä»¶</span></span><br><span class="line">                SelectionKey selectionKey=iterator.next();</span><br><span class="line">                <span class="comment">// åˆ¤æ–­å…·ä½“æ˜¯ä»€ä¹ˆäº‹ä»¶</span></span><br><span class="line">                <span class="keyword">if</span> (selectionKey.isAcceptable())&#123;<span class="comment">//å¦‚æœæ˜¯â€œæ¥å—å°±ç»ªâ€</span></span><br><span class="line">                    SocketChannel socketChannel=serverSocketChannel.accept();<span class="comment">// è·å–è¿æ¥</span></span><br><span class="line">                    socketChannel.configureBlocking(<span class="keyword">false</span>); <span class="comment">// è®¾ç½®éé˜»å¡</span></span><br><span class="line">                    <span class="comment">//å°†è¯¥é€šé“æ³¨å†Œåˆ°æœåŠ¡å™¨ä¸Š</span></span><br><span class="line">                    socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (selectionKey.isReadable())&#123;<span class="comment">//å¦‚æ˜¯â€œå·²ç»å°±ç»ªâ€</span></span><br><span class="line">                    SocketChannel socketChannel= (SocketChannel) selectionKey.channel();<span class="comment">//è·å–è¿æ¥</span></span><br><span class="line">                    <span class="comment">//è¯»æ•°æ®</span></span><br><span class="line">                    ByteBuffer buffer=ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">                    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">                    <span class="comment">//åˆ†æ•£è¯»å–</span></span><br><span class="line">                    len=socketChannel.read(buffer);</span><br><span class="line">                    <span class="keyword">while</span> (len &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                        buffer.flip();</span><br><span class="line">                        System.out.println(<span class="keyword">new</span> String(buffer.array(),<span class="number">0</span>,len));</span><br><span class="line">                        buffer.clear();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                iterator.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®¢æˆ·ç«¯ï¼š"><a href="#å®¢æˆ·ç«¯ï¼š" class="headerlink" title="å®¢æˆ·ç«¯ï¼š"></a>å®¢æˆ·ç«¯ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: NIOClient</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: tEngSHe789</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NIOClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å®¢æˆ·ç«¯Start...."</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºé€šé“</span></span><br><span class="line">        SocketChannel socketChannel=SocketChannel.open(<span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>,<span class="number">8888</span>));</span><br><span class="line">        <span class="comment">// è®¾ç½®SocketChannelæ¥å£ä¸ºéé˜»å¡</span></span><br><span class="line">        socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//æŒ‡å®šç¼“å†²åŒºå¤§å°</span></span><br><span class="line">        ByteBuffer buffer=ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        Scanner scanner=<span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext())&#123;</span><br><span class="line">            String msg = scanner.next();</span><br><span class="line">            <span class="comment">// å­˜å‚¨</span></span><br><span class="line">            buffer.put((<span class="keyword">new</span> Date().toString()+<span class="string">"\n"</span>+msg).getBytes());</span><br><span class="line">            <span class="comment">// ç¿»è½¬</span></span><br><span class="line">            buffer.flip();</span><br><span class="line">            <span class="comment">// èšé›†å†™å…¥</span></span><br><span class="line">            socketChannel.write(buffer);</span><br><span class="line">            <span class="comment">// é‡Šæ”¾</span></span><br><span class="line">            buffer.clear();</span><br><span class="line">        &#125;</span><br><span class="line">        socketChannel.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pythonå®ç°IOå¤ç”¨"><a href="#pythonå®ç°IOå¤ç”¨" class="headerlink" title="pythonå®ç°IOå¤ç”¨"></a>pythonå®ç°IOå¤ç”¨</h2><p>å¯¹æ¯”javaç”¨çš„æ˜¯Selectorï¼Œå¯ä»¥å¸®æˆ‘ä»¬åœ¨é»˜è®¤æ“ä½œç³»ç»Ÿä¸‹é€‰æ‹©æœ€åˆé€‚çš„select, poll, epollè¿™ä¸‰ç§å¤šè·¯å¤åˆæ¨¡å‹ï¼Œpythonæ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ä¸€ä¸ªè¿›ç¨‹èƒ½åŒæ—¶ç­‰å¾…å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥—æ¥å­—æè¿°ç¬¦ï¼‰å…¶ä¸­çš„<strong>ä»»æ„ä¸€ä¸ªè¿›å…¥è¯»å°±ç»ªçŠ¶æ€</strong>ï¼Œselect()<strong>å‡½æ•°å°±å¯ä»¥è¿”å›</strong>ã€‚</p><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line">s=socket(AF_INET,SOCK_STREAM)</span><br><span class="line">s.setsockopt(SOL_SOCKET,SO_REUSEADDR,<span class="number">1</span>)</span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8888</span>))</span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line">s.setblocking(<span class="keyword">False</span>) <span class="comment">#è®¾ç½®socketçš„æ¥å£ä¸ºéé˜»å¡</span></span><br><span class="line">read_l=[s,] <span class="comment"># æ•°æ®å¯è¯»é€šé“çš„åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="comment"># ç›‘å¬çš„read_lä¸­çš„socketå¯¹è±¡å†…éƒ¨å¦‚æœæœ‰å˜åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¼šåœ¨r_l</span></span><br><span class="line">    <span class="comment"># ç¬¬äºŒä¸ªå‚æ•°é‡Œæœ‰ä»€ä¹ˆå¯¹è±¡ï¼Œw_lä¸­å°±æœ‰ä»€ä¹ˆå¯¹è±¡</span></span><br><span class="line">    <span class="comment"># ç¬¬ä¸‰ä¸ªå‚æ•° å¦‚æœè¿™é‡Œçš„å¯¹è±¡å†…éƒ¨å‡ºé”™ï¼Œé‚£ä¼šæŠŠè¿™äº›å¯¹è±¡åŠ åˆ°x_lä¸­</span></span><br><span class="line">    <span class="comment"># 1 æ˜¯è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    r_l,w_l,x_l=select.select(read_l,[],[],<span class="number">1</span>)</span><br><span class="line">    print(r_l)</span><br><span class="line">    <span class="keyword">for</span> ready_obj <span class="keyword">in</span> r_l:</span><br><span class="line">        <span class="keyword">if</span> ready_obj == s:</span><br><span class="line">            conn,addr=ready_obj.accept() <span class="comment">#æ­¤æ—¶çš„ready_objç­‰äºs</span></span><br><span class="line">            read_l.append(conn)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data=ready_obj.recv(<span class="number">1024</span>) <span class="comment">#æ­¤æ—¶çš„ready_objç­‰äºconn</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                    ready_obj.close()</span><br><span class="line">                    read_l.remove(ready_obj)</span><br><span class="line">                    <span class="keyword">raise</span> Exception(<span class="string">'è¿æ¥æ–­å¼€'</span>)</span><br><span class="line">                ready_obj.send(data.upper())</span><br><span class="line">            <span class="keyword">except</span> ConnectionResetError:</span><br><span class="line">                ready_obj.close()</span><br><span class="line">                read_l.remove(ready_obj)</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line">c=socket(AF_INET,SOCK_STREAM)</span><br><span class="line">c.connect((<span class="string">'127.0.0.1'</span>,<span class="number">8888</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    msg=input(<span class="string">'&gt;&gt;&gt;: '</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> msg:<span class="keyword">continue</span></span><br><span class="line">    c.send(msg.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    data=c.recv(<span class="number">1024</span>)</span><br><span class="line">    print(data.decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure><h1 id="AIOï¼ˆasynchronous-ioï¼‰"><a href="#AIOï¼ˆasynchronous-ioï¼‰" class="headerlink" title="AIOï¼ˆasynchronous ioï¼‰"></a>AIOï¼ˆasynchronous ioï¼‰</h1><p>çœŸæ­£çš„å¼‚æ­¥I/Oå¾ˆç‰›é€¼ï¼Œæµç¨‹å¤§æ¦‚å¦‚ä¸‹ï¼š</p><p><img src="/2018/08/25/IOæ¨¡å‹/1535201637209.png" alt="1535201637209"></p><p>ï¼ˆ1ï¼‰ç”¨æˆ·è¿›ç¨‹å‘èµ·readæ“ä½œä¹‹åï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ã€‚</p><p>ï¼ˆ2ï¼‰è€Œå¦ä¸€æ–¹é¢ï¼Œä»kernelçš„è§’åº¦ï¼Œå½“å®ƒå—åˆ°ä¸€ä¸ªasynchronous readä¹‹åï¼Œé¦–å…ˆå®ƒä¼šç«‹åˆ»è¿”å›ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿä»»ä½•blockã€‚</p><p>ï¼ˆ3ï¼‰ç„¶åï¼Œkernelä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œå½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åï¼Œkernelä¼šç»™ç”¨æˆ·è¿›ç¨‹å‘é€ä¸€ä¸ªsignalï¼Œå‘Šè¯‰å®ƒreadæ“ä½œå®Œæˆäº†ã€‚</p><h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><p>Javaä¸­ä½¿ç”¨AIOéœ€è¦ç”¨åˆ°java.nio.channels.AsynchronousChannelGroupå’Œjava.nio.channels.AsynchronousServerSocketChannelçš„åŒ…ï¼Œç”±äºå®é™…é¡¹ç›®é²œæœ‰äººç”¨ï¼Œå°±ä¸æ¼”ç¤ºäº†</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p> å›é¡¾ä¸€ä¸‹å„ä¸ªIO Modelçš„æ¯”è¾ƒï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="/2018/08/25/IOæ¨¡å‹/1535764374640.png" alt="1535764374640"></p><ul><li>blocking io ï¼šé˜»å¡å‹ioï¼Œå†ç†Ÿæ‚‰ä¸è¿‡ï¼Œå¤„ç†acceptã€readã€writeéƒ½ä¼šé˜»å¡ç”¨æˆ·è¿›ç¨‹</li><li>non blocking ioï¼šå½“é€šè¿‡ç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰è¿æ¥æˆ–è€…æ•°æ®åˆ°è¾¾å°±ç›´æ¥è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œç”¨æˆ·è¿›ç¨‹ä¸é˜»å¡ä½†æ˜¯ä¸æ–­çš„è½®è¯¢ã€‚æ³¨æ„è¿™ä¸ªä¸æ˜¯java nioæ¡†æ¶ä¸­å¯¹åº”çš„ç½‘ç»œæ¨¡å‹</li><li>io multiplexingï¼šioå¤šè·¯å¤ç”¨æ‰æ˜¯nioå¯¹åº”çš„ç½‘ç»œioæ¨¡å‹ã€‚è¯¥æ¨¡å‹å¯¹äºç”¨æˆ·è¿›ç¨‹ä¹Ÿæ˜¯é˜»å¡çš„ï¼Œä¼˜ç‚¹æ˜¯å¯ä»¥åŒæ—¶æ”¯æŒå¤šä¸ªconnetciotnã€‚å‰ä¸‰ç§éƒ½å±äºåŒæ­¥æ¨¡å¼ï¼Œæ—¢ç„¶éƒ½æ˜¯åŒæ­¥çš„ï¼Œå¦‚æœè¦åšåˆ°çœ‹ä¼¼éé˜»å¡ï¼Œé‚£ä¹ˆå°±éœ€è¦è½®è¯¢æœºåˆ¶ã€‚ç›¸å¯¹äºä¸Šä¸€ç§æ¨¡å‹ï¼Œè¿™ç§åªæ˜¯å°†è½®è¯¢ä»ç”¨æˆ·è¿›ç¨‹è½¬ç§»åˆ°äº†æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œé€šè¿‡è°ƒç”¨selectå‡½æ•°ï¼Œä¸æ–­è½®è¯¢å¤šä¸ªconnectionæ˜¯å¦readyï¼Œå¦‚æœæœ‰ä¸€ç§readyå¥½çš„ï¼Œå°±é€šè¿‡äº‹ä»¶é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ï¼Œç”¨æˆ·è¿›ç¨‹å†é€šè¿‡äº‹ä»¶æ¥å¤„ç†ã€‚æ‰€ä»¥åœ¨javaçš„nioä¸­ä¼šçœ‹åˆ°ä¸€å¤§å †äº‹ä»¶å¤„ç†ã€‚è¿™ç§æ¨¡å‹çš„é˜»å¡ä¸æ˜¯åœ¨socketå±‚é¢çš„é˜»å¡ï¼Œè€Œæ˜¯åœ¨è°ƒåŠ¨selectå‡½æ•°çš„é˜»å¡ã€‚è€Œä¸”ç›¸å¯¹äºblocking ioï¼Œè¿˜å¤šäº†ä¸€æ¬¡selectçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶å®æ€§èƒ½ä¼šæ›´ä½ï¼Œæ‰€ä»¥åœ¨ä½ååé‡ä¸‹ï¼Œè¿™ç§ioä¸è§å¾—æ¯”bio+çº¿ç¨‹æ± çš„æ¨¡å‹ä¼˜è¶Šã€‚</li><li>sign drivenï¼šæå°‘ä½¿ç”¨ï¼Œä¸çŸ¥é“</li><li>async io ï¼šjava7æ—¶å€™å¼€å§‹å‡çº§ï¼Œä¹Ÿæˆä¸ºnio2ã€‚å®ç°äº†å¼‚æ­¥çš„ioã€‚å‰ä¸‰ç§éƒ½æ˜¯é€šè¿‡ç”¨æˆ·è¿›ç¨‹åœ¨ä¸»åŠ¨è·å–ï¼ˆbioçš„é˜»å¡ï¼Œnbioçš„è½®è¯¢å’Œiomultçš„æŒ‰äº‹ä»¶è·å–ï¼‰ï¼Œè€Œaioäº¤äº’å¾ˆç®€å•ï¼Œç”¨æˆ·è¿›ç¨‹è°ƒç”¨åç«‹å³è¿”å›ï¼Œç”¨æˆ·è¿›ç¨‹ä¸é˜»å¡ï¼Œå†…æ ¸å½“å®Œæˆç½‘ç»œioå’Œæ•°æ®å¤åˆ¶åï¼Œä¸»åŠ¨é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚å‰é¢è¯´åˆ°çš„ç³»ç»Ÿå†…æ ¸åšçš„æ“ä½œï¼Œé™¤äº†ç­‰å¾…ç½‘ç»œioå°±ç»ªæ•°æ®åˆ°è¾¾å†…æ ¸ï¼Œè¿˜æœ‰ä»ç³»ç»Ÿå†…æ ¸å¤åˆ¶ç”¨æˆ·ç©ºé—´å»çš„è¿‡ç¨‹ï¼Œå¼‚æ­¥ioè¿™ä¸¤è€…å¯¹äºç”¨æˆ·è¿›ç¨‹è€Œè¨€éƒ½æ˜¯éé˜»å¡çš„ï¼Œè€Œå‰ä¸‰ç§ï¼Œåœ¨æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´è¿™ä¸ªè¿‡ç¨‹ï¼Œéƒ½æ˜¯é˜»å¡çš„ã€‚</li></ul><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p>å‰è¨€è¯´çš„é‚£æœ¬ä¹¦</p><p>Ron Hitchensäº2002å¹´ è‘—çš„ã€Šjava nioã€‹</p><p><a href="https://www.cnblogs.com/findumars/p/6361627.html" target="_blank" rel="noopener">findumars</a></p><p><a href="https://www.cnblogs.com/dongguacai/p/5770287.html" target="_blank" rel="noopener">å†¬ç“œè”¡</a></p><p><a href="https://www.cnblogs.com/otherside/p/5605471.html" target="_blank" rel="noopener">å½¼å²¸èˆ¹å¤« </a></p><p><a href="https://blog.csdn.net/qq_33804730/article/details/79171188" target="_blank" rel="noopener">NIOçš„/åˆ†æ•£è¯»å–å’Œèšé›†å†™å…¥</a></p><p><a href="https://ifeve.com/selectors/" target="_blank" rel="noopener">å¹¶å‘ç¼–ç¨‹ç½‘</a></p><p>æ„Ÿè°¢</p><h3 id="ç»­1sæ—¶é—´"><a href="#ç»­1sæ—¶é—´" class="headerlink" title="ç»­1sæ—¶é—´"></a>ç»­1sæ—¶é—´</h3><p>å…¨ç‰‡ç»“æŸï¼Œè§‰å¾—æˆ‘å†™çš„ä¸é”™ï¼Ÿæƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿèµ¶å¿«æ‰“å¼€æˆ‘çš„ğŸ‘‰ä¸ªäºº<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">åšå®¢</a> ğŸ‘ˆå§ï¼</p><p>æœ¬æ–‡åœ°å€<a href="https://blog.tengshe789.tech/2018/08/25/IO%E6%A8%A1%E5%9E%8B/#moreï¼Œéƒ¨åˆ†è§‰å¾—æ¯”è¾ƒç”¨å¿ƒçš„ä¼šåŒæ­¥åˆ°æ˜é‡‘ï¼Œç®€ä¹¦ï¼Œè°¢è°¢ä½ é‚£ä¹ˆå¯çˆ±ï¼Œè¿˜ä¸€ç›´å…³æ³¨ç€æˆ‘~â¤ğŸ˜" target="_blank" rel="noopener">https://blog.tengshe789.tech/2018/08/25/IO%E6%A8%A1%E5%9E%8B/#moreï¼Œéƒ¨åˆ†è§‰å¾—æ¯”è¾ƒç”¨å¿ƒçš„ä¼šåŒæ­¥åˆ°æ˜é‡‘ï¼Œç®€ä¹¦ï¼Œè°¢è°¢ä½ é‚£ä¹ˆå¯çˆ±ï¼Œè¿˜ä¸€ç›´å…³æ³¨ç€æˆ‘~â¤ğŸ˜</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘çˆ·çˆ·ç”Ÿç—…ï¼Œæˆ‘ä¸€ç›´åœ¨é™ªåºŠã€‚é™ªåºŠç©ºéš™ï¼Œå¶è€Œç ”ç©¶ä¸€ä¼šèµ„æ–™ã€‚å‰å¤©åˆšå¥½çœ‹äº†ç‚¹ã€ŠUNIXç½‘ç»œç¼–ç¨‹ã€‹ï¼Œæ¯”è¾ƒå¤´å¤§ã€‚ç°åœ¨æˆ‘æ¥æ•´ç†ä¸€ä¸‹æ‰€å­¦æ‰€å¾—ï¼Œå¹¶ç”¨äºä¸ªäººå¤‡å¿˜ã€‚å¦‚æœæœ‰ä¸å¯¹ï¼Œè¯·æ‰¹è¯„ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.t
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="python" scheme="https://tengshe789.github.io/tags/python/"/>
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://tengshe789.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>è§£é‡Šæ€§è¯­è¨€&amp;ç¼–è¯‘æ€§è¯­è¨€ï¼ŒåŠ¨æ€&amp;é™æ€è¯­è¨€?</title>
    <link href="https://tengshe789.github.io/2018/08/21/%E8%A7%A3%E9%87%8A%E6%80%A7%E8%AF%AD%E8%A8%80-%E7%BC%96%E8%AF%91%E6%80%A7%E8%AF%AD%E8%A8%80%EF%BC%8C%E5%8A%A8%E6%80%81-%E9%9D%99%E6%80%81%E8%AF%AD%E8%A8%80/"/>
    <id>https://tengshe789.github.io/2018/08/21/è§£é‡Šæ€§è¯­è¨€-ç¼–è¯‘æ€§è¯­è¨€ï¼ŒåŠ¨æ€-é™æ€è¯­è¨€/</id>
    <published>2018-08-21T13:16:10.000Z</published>
    <updated>2019-11-20T13:39:41.553Z</updated>
    
    <content type="html"><![CDATA[<p>ä½ æ˜¯ä¸æ˜¯æ¯ä¸€æ¬¡å†™å®Œjavaï¼Œå†™å®Œpythonï¼Œéƒ½æœ‰è®¸äº›ç–‘æƒ‘~</p><p>ä¸ºä»€ä¹ˆæ¯æ¬¡æ–°å»ºä¸€ä¸ªpythoné¡¹ç›®ï¼ŒJetBrains PyCharm éƒ½ä¼šè®©ä½ é€‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œä»€ä¹ˆæ˜¯è§£é‡Šå™¨å‘¢ï¼Ÿ</p><p>ä¸ºä»€ä¹ˆç¼–å†™Javaä¸éœ€è¦è§£é‡Šå™¨å‘¢ï¼Ÿä»Šå¤©å°±ç»™ä½ ä»¬å¸¦æ¥ç­”æ¡ˆ~</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">https://blog.tengshe789.tech/</a></p><h2 id="ç¼–è¯‘å‹å’Œè§£é‡Šå‹çš„åŒºåˆ«"><a href="#ç¼–è¯‘å‹å’Œè§£é‡Šå‹çš„åŒºåˆ«" class="headerlink" title="ç¼–è¯‘å‹å’Œè§£é‡Šå‹çš„åŒºåˆ«"></a>ç¼–è¯‘å‹å’Œè§£é‡Šå‹çš„åŒºåˆ«</h2><h3 id="ç¼–è¯‘å‹è¯­è¨€"><a href="#ç¼–è¯‘å‹è¯­è¨€" class="headerlink" title="ç¼–è¯‘å‹è¯­è¨€"></a>ç¼–è¯‘å‹è¯­è¨€</h3><p><strong>å…ˆæ¥çœ‹çœ‹ç¼–è¯‘å‹è¯­è¨€å®šä¹‰ï¼š</strong></p><blockquote><p>ç¼–è¯‘å‹è¯­è¨€é¦–å…ˆæ˜¯å°†æºä»£ç ç¼–è¯‘ç”Ÿæˆæœºå™¨æŒ‡ä»¤ï¼Œå†ç”±æœºå™¨è¿è¡Œæœºå™¨ç (äºŒè¿›åˆ¶)ã€‚</p></blockquote><p>å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œç¼–è¯‘å‹ç›¸å½“äºç”¨ä¸­è‹±æ–‡è¯å…¸ï¼ˆç¿»è¯‘å™¨ï¼‰å°†ä¸€æœ¬è‹±æ–‡ä¹¦ä¸€æ¬¡æ€§ç¿»è¯‘<strong>ï¼ˆç¼–è¯‘ï¼‰</strong>æˆä¸€æœ¬ä¸­æ–‡ä¹¦ã€‚ä»¥åæŸ¥çœ‹ç›´æ¥å°±æ˜¯ä¸­æ–‡äº†ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œä»¥åè¯»ä¹¦<strong>ï¼ˆæ‰§è¡Œï¼‰</strong>ä¼šéå¸¸éå¸¸æ–¹ä¾¿ã€‚</p><p>æ‰€ä»¥ï¼Œç”±äºç¨‹åºæ‰§è¡Œ<strong>é€Ÿåº¦å¿«</strong>ï¼ŒåŒç­‰æ¡ä»¶ä¸‹å¯¹ç³»ç»Ÿè¦æ±‚è¾ƒä½ï¼Œå› æ­¤åƒå¼€å‘æ“ä½œç³»ç»Ÿã€å¤§å‹åº”ç”¨ç¨‹åºã€æ•°æ®åº“ç³»ç»Ÿç­‰æ—¶éƒ½é‡‡ç”¨å®ƒï¼ŒåƒC/C++ã€Pascal/Object Pascalï¼ˆDelphiï¼‰ç­‰éƒ½æ˜¯ç¼–è¯‘è¯­è¨€</p><p>ç”¨cè¯­è¨€å¼€å‘äº†ç¨‹åºåï¼Œéœ€è¦é€šè¿‡ç¼–è¯‘å™¨æŠŠç¨‹åºç¼–è¯‘æˆæœºå™¨è¯­è¨€ï¼ˆå³è®¡ç®—æœºè¯†åˆ«çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› ä¸ºä¸åŒçš„æ“ä½œç³»ç»Ÿè®¡ç®—æœºè¯†åˆ«çš„äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯ä¸åŒçš„ï¼‰ï¼Œæ‰€ä»¥cè¯­è¨€ç¨‹åºè¿›è¡Œç§»æ¤åï¼Œè¦é‡æ–°ç¼–è¯‘ã€‚ï¼ˆå¦‚windowsç¼–è¯‘æˆextæ–‡ä»¶ï¼Œlinuxç¼–è¯‘æˆerpæ–‡ä»¶ï¼‰</p><h3 id="è§£é‡Šå‹è¯­è¨€"><a href="#è§£é‡Šå‹è¯­è¨€" class="headerlink" title="è§£é‡Šå‹è¯­è¨€"></a>è§£é‡Šå‹è¯­è¨€</h3><p><strong>å†æ¥çœ‹çœ‹è§£é‡Šå‹è¯­è¨€çš„å®šä¹‰ï¼š</strong></p><blockquote><p>è§£é‡Šå‹è¯­è¨€çš„æºä»£ç ä¸æ˜¯ç›´æ¥ç¿»è¯‘æˆæœºå™¨æŒ‡ä»¤ï¼Œè€Œæ˜¯å…ˆç¿»è¯‘æˆä¸­é—´ä»£ç ï¼Œå†ç”±è§£é‡Šå™¨å¯¹ä¸­é—´ä»£ç è¿›è¡Œè§£é‡Šè¿è¡Œã€‚</p></blockquote><p>è€Œè§£é‡Šå‹ç›¸å½“äºç”¨ä¸­è‹±æ–‡è¯å…¸<strong>ï¼ˆç¿»è¯‘å™¨ï¼‰</strong>å°†ä¸€æœ¬è‹±æ–‡ä¹¦è¯»ä¸€æ®µç¿»è¯‘ä¸€æ®µ<strong>ï¼ˆè§£é‡Šï¼‰</strong>ä¸­æ–‡ã€‚ä»¥åæŸ¥çœ‹æ—¶è¿˜æ˜¯éœ€è¦é‡æ–°ç¿»è¯‘ã€‚è¿™æ ·æ•ˆç‡ä¼šä½ä¸€äº›ï¼Œå¿…é¡»ä¾èµ–è§£é‡Šå™¨ï¼Œä½†æ˜¯è·¨å¹³å°æ€§å¥½ã€‚</p><p>æ‰€ä»¥ï¼Œä¸€äº›ç½‘é¡µè„šæœ¬ã€æœåŠ¡å™¨è„šæœ¬åŠè¾…åŠ©å¼€å‘æ¥å£è¿™æ ·çš„å¯¹é€Ÿåº¦è¦æ±‚ä¸é«˜ã€å¯¹ä¸åŒç³»ç»Ÿå¹³å°é—´çš„å…¼å®¹æ€§æœ‰ä¸€å®šè¦æ±‚çš„ç¨‹åºåˆ™é€šå¸¸ä½¿ç”¨è§£é‡Šæ€§è¯­è¨€ï¼Œå¦‚JavaScriptã€VBScriptã€Perlã€Pythonã€Rubyã€MATLAB ç­‰ç­‰</p><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><p>ç¼–è¯‘å‹å’Œè§£é‡Šå‹çš„å®šä¹‰æ˜¯å¯¹ç«‹å­˜åœ¨çš„ï¼Œä½†ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªè¯­è¨€ä¸­åŒæ—¶å­˜åœ¨ã€‚</p><p>ä¸ºä»€ä¹ˆæˆ‘æŠŠ java è¯­è¨€å•ç‹¬æ”¾å‡ºæ¥å‘¢ï¼Ÿå› ä¸ºå®ƒåŒæ—¶å…¼æœ‰ç¼–è¯‘å‹å’Œè§£é‡Šå‹ç‰¹ç‚¹ã€‚</p><p>æ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š</p><p>æˆ‘ä»¬ç¼–å¥½æºä»£ç ï¼ˆ.java æ–‡ä»¶ï¼‰ï¼Œç¼–è¯‘ç”Ÿæˆå­—èŠ‚ç ï¼ˆ.class æ–‡ä»¶ï¼‰ï¼Œå†é€šè¿‡ JVMï¼ˆjava è™šæ‹Ÿæœºï¼‰è¿è¡Œç”Ÿæˆæœºå™¨æŒ‡ä»¤ï¼Œç”±æœºå™¨è¿è¡Œæœºå™¨ç ã€‚<strong>æ³¨æ„ï¼Œæ­¤å¤„ç”Ÿæˆæœºå™¨è¯­è¨€å‰çš„æ“ä½œæ˜¯è§£é‡Šå‹ï¼Œæ¯æ¬¡è¿è¡Œéƒ½è¦é‡æ–°è§£é‡Šã€‚å› æ­¤ï¼Œæ­¤å¤„è¡¨æ˜ java æ˜¯è§£é‡Šå‹</strong>ã€‚</p><p>ä½†æ˜¯ï¼Œéƒ¨åˆ† JVMï¼ˆjava è™šæ‹Ÿæœºï¼‰æœ‰ä¸€ç§ JITï¼ˆJust in timeï¼‰æœºåˆ¶ï¼Œèƒ½å¤Ÿå°†éƒ¨åˆ†å·²ç»è§£é‡Šç¿»è¯‘çš„å¸¸ç”¨æœºå™¨æŒ‡ä»¤ä¿å­˜ã€‚ä¸‹æ¬¡ä¸éœ€è¦è§£é‡Šï¼Œç›´æ¥è¿è¡Œå³å¯ã€‚<strong>æ­¤æ—¶ java æ˜¯ç¼–è¯‘å‹</strong>ã€‚</p><h2 id="åŠ¨æ€è¯­è¨€å’Œé™æ€è¯­è¨€"><a href="#åŠ¨æ€è¯­è¨€å’Œé™æ€è¯­è¨€" class="headerlink" title="åŠ¨æ€è¯­è¨€å’Œé™æ€è¯­è¨€"></a>åŠ¨æ€è¯­è¨€å’Œé™æ€è¯­è¨€</h2><p>æˆ‘ä»¬å¸¸è¯´çš„åŠ¨æ€è¯­è¨€å’Œé™æ€è¯­è¨€ï¼Œå…¶å®æ˜¯æŒ‡åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€ã€‚å…ˆæ¥çœ‹çœ‹åŠ¨æ€ç±»å‹è¯­è¨€ï¼š</p><blockquote><p>åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œæ˜¯æŒ‡æ•°æ®ç±»å‹çš„æ£€æŸ¥æ˜¯åœ¨è¿è¡Œæ—¶åšçš„ã€‚ç”¨åŠ¨æ€ç±»å‹è¯­è¨€ç¼–ç¨‹æ—¶ï¼Œä¸ç”¨ç»™å˜é‡æŒ‡å®šæ•°æ®ç±»å‹ï¼Œè¯¥è¯­è¨€ä¼šåœ¨ä½ ç¬¬ä¸€æ¬¡èµ‹å€¼ç»™å˜é‡æ—¶ï¼Œåœ¨å†…éƒ¨è®°å½•æ•°æ®ç±»å‹ã€‚</p></blockquote><p><strong>åŠ¨æ€ç±»å‹è¯­è¨€</strong>çš„ä¼˜ç‚¹æ˜¯ä¸éœ€è¦å†™å¤šç§æ•°æ®ç±»å‹çš„ä»£ç ï¼Œä»£ç ç›¸å¯¹ç®€æ´ä¸€äº›ï¼Œæ–¹ä¾¿ä»£ç é˜…è¯»ã€‚ç¼ºç‚¹æ˜¯ä¸æ–¹ä¾¿è°ƒè¯•ï¼Œä»£ç å‘½åä¹Ÿå®¹æ˜“æ··æ·†ï¼›</p><p>å†æ¥çœ‹çœ‹é™æ€ç±»å‹è¯­è¨€çš„å®šä¹‰ï¼š</p><blockquote><p>é™æ€ç±»å‹è¯­è¨€ï¼Œæ˜¯æŒ‡æ•°æ®ç±»å‹çš„æ£€æŸ¥æ˜¯åœ¨è¿è¡Œå‰ï¼ˆå¦‚ç¼–è¯‘é˜¶æ®µï¼‰åšçš„ã€‚</p></blockquote><p><strong>é™æ€ç±»å‹è¯­è¨€</strong>çš„ä¼˜ç‚¹æ˜¯æ–¹ä¾¿è°ƒè¯•ï¼Œä»£ç ç›¸å¯¹è§„èŒƒã€‚ç¼ºç‚¹æ˜¯éœ€è¦å†™å¾ˆå¤šæ•°æ®ç±»å‹ç›¸å…³çš„ä»£ç ï¼Œä»£ç ä¸å¤Ÿç®€æ´ã€‚</p><h2 id="å®Œ"><a href="#å®Œ" class="headerlink" title="å®Œ"></a>å®Œ</h2><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œç¼˜åˆ†å‘¢å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹~  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä½ æ˜¯ä¸æ˜¯æ¯ä¸€æ¬¡å†™å®Œjavaï¼Œå†™å®Œpythonï¼Œéƒ½æœ‰è®¸äº›ç–‘æƒ‘~&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæ¯æ¬¡æ–°å»ºä¸€ä¸ªpythoné¡¹ç›®ï¼ŒJetBrains PyCharm éƒ½ä¼šè®©ä½ é€‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œä»€ä¹ˆæ˜¯è§£é‡Šå™¨å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆç¼–å†™Javaä¸éœ€è¦è§£é‡Šå™¨å‘¢ï¼Ÿä»Šå¤©å°±ç»™ä½ ä»¬å¸¦æ¥ç­”æ¡ˆ~&lt;/p&gt;
&lt;p&gt;
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª</title>
    <link href="https://tengshe789.github.io/2018/08/19/%E4%B8%80%E6%88%98%E4%B8%AD%E7%9A%84%E5%88%B6%E5%BC%8F%E6%AD%A5%E6%9E%AA/"/>
    <id>https://tengshe789.github.io/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/</id>
    <published>2018-08-19T13:22:41.000Z</published>
    <updated>2019-11-20T13:39:40.744Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æˆ‘ä»¬ä¸èŠæŠ€æœ¯äº†ï¼ŒèŠä¸€èŠæªæ”¯ã€‚æˆ‘æœ¬äººæ˜¯ä¸ªç‹‚çƒ­çš„å†›äº‹è¿·ï¼Œè€Œæ°å¥½æœ€è¿‘æ‰¾åˆ°ä¸€æ¬¾æ¸¸æˆï¼Œæ˜¯ä¸€æˆ˜é¢˜æçš„ï¼Œå«â€˜æˆ˜åœ°1â€™ï¼ŒåŸæ±åŸå‘³çš„ä¸€æˆ˜æ­¦å™¨çš„åŠ å…¥ï¼Œè®©è¿™ä¸ªæœ¬æ¥å°±å¾ˆå¼ºåŠ¿çš„ç¬¬ä¸€äººç§°å°„å‡»æ¸¸æˆå¢æ·»äº†ç‹¬ç‰¹é­…åŠ›ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œä»Šå¤©æˆ‘ä»¥è¿™ä¸ªæ¸¸æˆä¸­çš„ä¸€æˆ˜è§†è§’ï¼Œæ¥ä»‹ç»ä»¥ä¸‹ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¦å™¨ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h2 id="ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜"><a href="#ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜" class="headerlink" title="ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜"></a>ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜</h2><p>ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜ï¼ˆè‹±è¯­ï¼šWorld War Iã€First World Waræˆ–Great Warï¼Œç®€ç§°WWIæˆ–WW1ï¼‰ï¼Œç®€ç§°ä¸€æˆ˜ï¼Œæ˜¯åœ¨19ä¸–çºªæœ«20ä¸–çºªåˆï¼Œèµ„æœ¬ä¸»ä¹‰å›½å®¶å‘å…¶ç»ˆæé˜¶æ®µï¼Œå³å¸å›½ä¸»ä¹‰è¿‡æ¸¡æ—¶äº§ç”Ÿçš„å¹¿æ³›çš„ä¸å¯è°ƒå’ŒçŸ›ç›¾ã€äºšæ´²ï¼Œéæ´²ï¼Œæ‹‰ä¸ç¾æ´²æ®–æ°‘åœ°å’ŒåŠæ®–æ°‘åœ°åŸºæœ¬ä¸Šè¢«åˆ—å¼ºç“œåˆ†å®Œæ¯•ï¼Œæ–°æ—§æ®–æ°‘ä¸»ä¹‰çŸ›ç›¾æ¿€åŒ–ã€å„å¸å›½ä¸»ä¹‰ç»æµå‘å±•ä¸å¹³è¡¡ï¼Œç§©åºåˆ’åˆ†ä¸å¯¹ç­‰çš„èƒŒæ™¯ä¸‹ï¼Œä¸ºé‡æ–°ç“œåˆ†ä¸–ç•Œå’Œäº‰å¤ºå…¨çƒéœ¸æƒè€Œçˆ†å‘çš„ä¸€åœºä¸–ç•Œçº§å¸å›½ä¸»ä¹‰æˆ˜äº‰ã€‚<br>æˆ˜äº‰è¿‡ç¨‹ä¸»è¦æ˜¯åŒç›Ÿå›½å’Œåçº¦å›½ä¹‹é—´çš„æˆ˜æ–—ã€‚</p><p>å¾·æ„å¿—å¸å›½ã€å¥¥åŒˆå¸å›½ã€å¥¥æ–¯æ›¼å¸å›½ã€ä¿åŠ åˆ©äºšç‹å›½å±åŒç›Ÿå›½é˜µè¥</p><p>å¤§è‹±å¸å›½ã€æ³•å…°è¥¿ç¬¬ä¸‰å…±å’Œå›½ã€ä¿„ç½—æ–¯å¸å›½ã€æ„å¤§åˆ©ç‹å›½å’Œç¾åˆ©åšåˆä¼—å›½åˆ™å±åçº¦å›½é˜µè¥ã€‚</p><p>è¿™åœºæˆ˜äº‰æ˜¯æ¬§æ´²å†å²ä¸Šç ´åæ€§æœ€å¼ºçš„æˆ˜äº‰ä¹‹ä¸€ã€‚å¤§çº¦æœ‰6500ä¸‡äººå‚æˆ˜ï¼Œ1000å¤šä¸‡äººä¸§ç”Ÿï¼Œ2000ä¸‡äººå—ä¼¤ã€‚æˆ˜äº‰é€ æˆäº†ä¸¥é‡çš„ç»æµæŸå¤±ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯åˆ¶å¼æ­¦å™¨"><a href="#ä»€ä¹ˆæ˜¯åˆ¶å¼æ­¦å™¨" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ¶å¼æ­¦å™¨"></a>ä»€ä¹ˆæ˜¯åˆ¶å¼æ­¦å™¨</h2><p>é¦–å…ˆæˆ‘è¿™ä¸ªé¢˜ç›®å«â€˜ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æªâ€™ï¼Œä»€ä¹ˆæ˜¯åˆ¶å¼æ­¥æªï¼ˆæ­¦å™¨ï¼‰å‘¢ï¼Ÿåˆ¶å¼æ­¦å™¨å³åŒä¸€ç§å…µå™¨çš„å„ç§æŠ€æœ¯å‚æ•°ç›¸åŒçš„æ­¦å™¨è£…å¤‡ï¼Œå¹¶ä¸”ç»éƒ¨é˜Ÿæ­¦å™¨è£…å¤‡éƒ¨é—¨æ‰¹å‡†å¤‡æ¡ˆï¼Œæœ‰æ­£å¼å‹å·ç¼–å·ï¼Œæ­£å¼æ‰¹é‡åˆ—è£…éƒ¨é˜Ÿä½¿ç”¨çš„æ­£è§„çš„æ ‡å‡†æ­¦å™¨ã€‚å°±åƒå’±ä»¬ä¸­å›½PLAï¼Œæ­¥å…µæ ‡é…çš„95å¼çªå‡»æ­¥æªï¼ˆType 95ï¼‰ï¼Œè¿™ä¸ª95å¼å°±æ˜¯åˆ¶å¼æ­¥æªã€‚å®ƒçš„å‡ºç°ä½¿å¾—å†›è­¦éƒ¨é˜Ÿçš„æ­¦å™¨ç®¡ç†ï¼Œä½¿ç”¨å¾—ä»¥æ ‡å‡†åŒ–ï¼Œç»Ÿä¸€åŒ–ã€‚åŠ å¼ºäº†æ­¦è£…éƒ¨é—¨çš„æ­£è§„åŒ–ã€‚</p><h3 id="WWIåˆ¶å¼æ­¥æª"><a href="#WWIåˆ¶å¼æ­¥æª" class="headerlink" title="WWIåˆ¶å¼æ­¥æª"></a>WWIåˆ¶å¼æ­¥æª</h3><h4 id="Winchester-1895-Russian"><a href="#Winchester-1895-Russian" class="headerlink" title="Winchester 1895 (Russian)"></a>Winchester 1895 (Russian)</h4><p>æ¸©å½»æ–¯ç‰¹M1894æ æ†æ­¥æªç”±ä¼ å¥‡æ€§äººç‰©çº¦ç¿°Â·æ‘©è¥¿Â·å‹ƒæœ—å®è®¾è®¡çš„M1894æ æ†æ­¥æªï¼Œæ˜¯ç¾å›½å†å²ä¸Šç¬¬ä¸€æ”¯ä½¿ç”¨æ— çƒŸå‘å°„è¯æªå¼¹ï¼Œå¹¶ä¸”ä¸ºç‹©çŒè€Œä¸“é—¨è®¾è®¡çš„æ æ†æ­¥æªã€‚</p><p>M1895æ­¥æªé‡‡ç”¨æ æ†æªæœºå¼ç»“æ„ï¼Œå…¶æ æ†å¼æªæœºçš„åŸºæœ¬åŸç†ä¸M1873æ­¥æªçš„ç›¸åŒï¼Œåªæ˜¯ç»“æ„æœ‰æ‰€ä¸åŒè€Œå·²ã€‚M1873æ­¥æªé€šè¿‡æ‰³æœºæŠ¤åœˆæ æ†çš„å‰åæ—‹è½¬ï¼Œå¸¦åŠ¨è‚˜èŠ‚æ‘†åŠ¨ï¼Œä»è€Œå¸¦åŠ¨æªæœºå‰åè¿åŠ¨ã€‚è€Œåœ¨M1895æ­¥æªä¸Šï¼Œæ‰³æœºæŠ¤åœˆæ æ†ä¸æ‰³æœºåº§ç›´æ¥ç»„æˆäº†è‚˜èŠ‚ç»“æ„ï¼Œå…¶ç»“æ„æ›´ä¸ºç®€å•ã€‚M1895æ­¥æªçš„æ‰³æœºåº§å°¾ç«¯å›ºå®šåœ¨æœºåŒ£ä¸Šï¼Œå…¶å‰ç«¯ä¸æ‰³æœºæŠ¤åœˆæ æ†ä¸­éƒ¨ç»æ¥åœ¨ä¸€èµ·ï¼Œè€Œæ‰³æœºæŠ¤åœˆæ æ†ä¸Šéƒ¨ä¸æªæœºå‰ç«¯ç»æ¥åœ¨ä¸€èµ·ï¼Œå½“æ‰³æœºæŠ¤åœˆæ æ†æ‘†åŠ¨æ—¶ï¼Œé€šè¿‡å…¶ä¸Šéƒ¨å¸¦åŠ¨æªæœºå‰åè¿åŠ¨ã€‚å¦å¤–ï¼ŒM1873æ­¥æªæ‰³æœºæŠ¤åœˆæ æ†çš„æ—‹è½¬è½´å›ºå®šåœ¨æœºåŒ£ä¸Šï¼Œè€ŒM1895æ­¥æªçš„æ‰³æœºæŠ¤åœˆæ æ†åˆ™æ²¡æœ‰å›ºå®šçš„æ—‹è½¬è½´ï¼Œå®ƒçš„è¿åŠ¨è½¨è¿¹æ¯”è¾ƒå¤æ‚ï¼Œä¸æ˜¯ç®€å•çš„æ—‹è½¬è¿åŠ¨ã€‚å‰æ¨æ‰³æœºæŠ¤åœˆæ æ†æ—¶ï¼Œå…¶å°¾ç«¯å…ˆå‘å‰ä¸‹æ–¹æ‘†åŠ¨ï¼Œæ‹‰æ‰³æœºåº§å‰ç«¯å‘ä¸‹ï¼Œä½¿è‚˜èŠ‚ç»“æ„å¼¯æ›²ã€‚å½“æ‰³æœºåº§å‰ç«¯å‘ä¸‹æ‘†åŠ¨åˆ°ä¸€å®šä½ç½®æ—¶ï¼Œæ‰³æœºæŠ¤åœˆæ æ†å‰ç«¯ä¾¿å¸¦åŠ¨æªæœºå‘åã€‚ç»§ç»­å‘ä¸‹æ¨æ‰³æœºæŠ¤åœˆæ æ†ï¼Œä¾¿ä½¿è‚˜èŠ‚ç»“æ„è¿›ä¸€æ­¥å¼¯æ›²ï¼Œæ‰³æœºæŠ¤åœˆæ æ†ä¸Šç«¯å¸¦åŠ¨æªæœºè¿›ä¸€æ­¥å‘åï¼Œç›´è‡³å°†å…¶å‘åæ¨åˆ°ä½ã€‚å› æ­¤ï¼Œæ‰³æœºæŠ¤åœˆæ æ†æ—¢æœ‰æ—‹è½¬è¿åŠ¨ï¼Œåˆæœ‰ä¸Šä¸‹æ–¹å‘çš„ç›´çº¿è¿åŠ¨ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-35-30-022.png" alt="1895"></p><p>M1895æ­¥æªçš„ç‰¹è‰²è¡¨ç°åœ¨ä¸‰ä¸ªæ–¹é¢ã€‚</p><p>ä¸€æ˜¯é‡‡ç”¨äº†ç›’å¼å¼¹ä»“ã€‚è¿™ç§å¼¹ä»“æ¯”ç°åœ¨æªæ¢°ä¸Šé‡‡ç”¨çš„å›ºå®šå¼å¼¹ä»“å¤æ‚å¾—å¤šã€‚ç›®å‰çš„å›ºå®šå¼å¼¹ä»“å¤šé‡‡ç”¨èºæ—‹å¼¹ç°§ åšæ‰˜å¼¹æ¿ç°§ï¼Œå¹¶ç›´æ¥ç½®äºæ‰˜å¼¹æ¿ä¹‹ä¸‹ï¼Œé ç°§åŠ›å°†å¼¹å‘ä¸ŠæŠ¬èµ·ã€‚è€ŒM1895æ­¥æªé‡‡ ç”¨äº†å½“æ—¶å¸¸ç”¨çš„ç‰‡ç°§åšæ‰˜å¼¹æ¿ç°§ï¼Œå…¶æ‰˜å¼¹æ¿å‘ˆâ€œVâ€å½¢ï¼Œä¸Šç«¯å¡åœ¨æªç®¡ä¸‹æ–¹çš„å›ºå®šæ§½å†…ï¼Œä¸‹æ–¹å¡åœ¨æ‰˜å¼¹æ†å°¾ç«¯çš„å‡¹æ§½å†…ï¼Œé ç°§åŠ›é©±åŠ¨æ‰˜å¼¹æ†é€†æ—¶é’ˆæ—‹è½¬ï¼Œå¸¦åŠ¨æ‰˜å¼¹æ¿å‘ä¸Šè¿åŠ¨ï¼Œä½¿å¼¹ä»“å†…çš„æªå¼¹è¿›å…¥å¾…è¿›è†›ä½ç½®ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-49-25-817.png" alt=""></p><p>å…¶äºŒï¼Œé‡‡ç”¨äº†é—­é”æ¥”é“ã€‚å‰æ¨æ‰³æœºæŠ¤åœˆæ æ†ï¼Œå…¶å‘å‰ä¸‹æ–¹è½¬åŠ¨ï¼Œä½¿æ‰³æœºåº§å‘ä¸‹æ–¹æ‘†åŠ¨ï¼Œæ‰³æœºåº§å‰ç«¯é’©ä½é—­é”æ¥”é“ä¸‹ç«¯ä½¿ä¹‹ä¸€èµ·å‘ä¸‹è¿åŠ¨ï¼Œé—­é”æ¥”é“ä¸Šç«¯ç¦»å¼€æªæœºå°¾éƒ¨çš„å‡¹æ§½è€Œä½¿æªæœºå¼€é”ã€‚ç»§ç»­å‰æ¨æ‰³æœºæŠ¤åœˆæ æ†ï¼Œåˆ™å¸¦åŠ¨æªæœºåé€€ï¼Œå¹¶å‹å€’å‡»é”¤ï¼›åæ‹‰æ‰³æœºæŠ¤åœˆæ æ†æ—¶ï¼Œåˆ™å…ˆå¸¦åŠ¨æªæœºå¤è¿›ã€‚æªæœºå¤è¿›åˆ°ä½æ—¶ï¼Œç»§ç»­åæ‹‰æ‰³æœºæŠ¤åœˆæ æ†ï¼Œå…¶å‘åä¸Šæ–¹è½¬åŠ¨ï¼Œå¸¦åŠ¨æ‰³æœºåº§å‘ä¸Šæ‘†åŠ¨ï¼Œæ¨åŠ¨é—­é”æ¥”é“å‘ä¸Šï¼Œå…¶ä¸Šç«¯è¿›å…¥æªæœºå°¾éƒ¨çš„å‡¹æ§½è€Œä½¿æªæœºé—­é”ã€‚è¿™ä¸ªé—­é”æ¥”é“çš„è®¾è®¡ä½¿æªæœºé—­é”æ›´åŠ ç¡®å®ï¼Œä¿è¯äº†å°„å‡»æ—¶çš„å®‰å…¨æ€§ã€‚<br>å…¶ä¸‰ï¼ŒæŠ›å£³æŒºå…¼ä½œæ¨å¼¹é½¿ã€‚æ¸©å½»æ–¯ç‰¹M1873åŠM1890æ­¥æªå‡ä¾é å–å¼¹å™¨å°†å¼¹å£³æŠ›å‡ºï¼Œä½†ç”±äºé…åˆåŠ¨ä½œæœ‰æ—¶ä¸å¤ªä¸€è‡´ï¼Œä½¿å¾—æŠ›å£³åŠ›åº¦ä¸åŒï¼Œå› è€Œæ˜“å‡ºç°é—®é¢˜ã€‚M1895æ­¥æªåˆ™ä¸“é—¨è®¾è®¡äº†æŠ›å£³æŒºï¼Œä»è€Œè§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚åœ¨æªæœºå‰ç«¯é¢ï¼ŒæŠ½å£³é’©åœ¨ä¸Šï¼ŒæŠ›å£³æŒºåœ¨ä¸‹ï¼Œç”±äºæŠ›å£³æŒºçªå‡ºäºæª æœºä¸‹ç¼˜ï¼Œæ•…å…¶å…¼å…·æ¨å¼¹é½¿çš„åŠŸèƒ½ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/1534687524672.png" alt="1534687524672"></p><p>ä¸€æˆ˜ä¸­W 1895ä¸ºä»€ä¹ˆæ ‡æ³¨çš„å›½ç±æ˜¯Russianå‘¢ï¼Ÿ</p><p>å› ä¸ºæ¨¡å‹ç‰ˆçš„W 1895 ä¸­ï¼Œ.35 WCFï¼Œ.405 WCFï¼Œ.30-03å’Œ.30-06å£å¾„çš„ç”¨äºç¾å›½ä½“è‚²å¸‚åœºï¼Œ é”€å”®é¢åœ¨30%-40%ã€‚ å…¶ä»–å¤§éƒ¨åˆ†æ˜¯ä¸ä¿„ç½—æ–¯å¸å›½å†›æ–¹ç­¾è®¢çš„åˆåŒä¸­å–çš„ã€‚ 1915å¹´ï¼Œä¿„ç½—æ–¯æ€¥éœ€å°å‹æ­¦å™¨ï¼Œå¹¶ä¸è®¸å¤šç¾å›½ä¸»è¦å·¥å‚æ¥æ´½ã€‚ é›·æ˜é¡¿å’Œæ–°è‹±æ ¼å…°è¥¿å±‹å…¬å¸éƒ½ç­¾è®¢äº†åˆ¶é€ Mosin-Nagantæ­¥æªçš„åˆåŒï¼Œæ¸©å½»æ–¯ç‰¹è¾¾æˆåè®®ï¼Œç”¨æ ‡å‡†çš„ä¿„ç½—æ–¯å†›ç”¨7.62x54Rå¼¹è¯ç­’ç”Ÿäº§30ä¸‡åª1895å‹æ­¥æªã€‚ ä¸Mosin-Nagantå‘½ä»¤ä¸åŒï¼Œæ‰€æœ‰æ¸©å½»æ–¯ç‰¹æ­¥æªéƒ½æ˜¯åœ¨ä¿„å›½é©å‘½ä¹‹å‰äº¤ä»˜çš„ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-49-17-463.png" alt=""></p><h3 id="Gewehr-M-95"><a href="#Gewehr-M-95" class="headerlink" title="Gewehr M.95"></a>Gewehr M.95</h3><p>Gewehr M1895 æ˜¯æ ‡å‡†åæ‹‰å¼æªæœºæ­¥æªï¼ŒæœåŠ¡å¥¥åŒˆå†›é˜Ÿåœ¨ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜ã€‚é™¤äº†å…¶ä»–ä¸€äº›ä¸œæ¬§å’Œå·´å°”å¹²å›½å®¶ä¹‹å¤–ï¼Œè¿™ç§æ­¦å™¨å¤§é‡åˆ¶é€ ï¼Œåœ¨åœæˆ˜åè¿˜ä¸å¥¥åœ°åˆ©å’ŒåŒˆç‰™åˆ©çš„ç»§æ‰¿å›½ä¸€èµ·æœå½¹ã€‚</p><p>è¯¥æ­¦å™¨é‡‡ç”¨é©å‘½æ€§çš„ç›´æ‹‰åŠ¨ä½œèºæ “ï¼Œä½¿ç‹¬ç‰¹çš„æ­¦å™¨å…·æœ‰è¾ƒé«˜çš„å°„é€Ÿï¼Œè¡¥å……äº†å…¶è‰¯å¥½çš„å¯é æ€§ã€‚é€šè¿‡ä¸€ä¸ª5è½®æ•´ä½“å¤¹å­ï¼ˆä¸å¾·å›½Gewehr 98ä½¿ç”¨çš„å‰¥ç¦»å¤¹å­ç›¸åï¼‰ï¼ŒM1895æœ€åˆç”¨äºåœ†å¤´8x50mmR Mannlicherï¼Œå¹¶åœ¨ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜æœŸé—´ä½¿ç”¨è¯¥å¼¹è¯ç­’ã€‚ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜ï¼Œæ­¥æªè¢«è½¬æ¢æˆæ›´å¼ºå¤§çš„å°–å¤´â€œæ–¯çš®ç­–â€å­å¼¹ï¼Œå¦‚8x56mmRã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-36-21-216.png" alt="Gewehr.95"></p><h3 id="Gew-98å¼"><a href="#Gew-98å¼" class="headerlink" title="Gew.98å¼"></a>Gew.98å¼</h3><p>98æ­¥æªï¼Œå¾·å›½æœ‰ä¸¤ä¸ª98å¼ï¼Œä¸€ä¸ªæ˜¯Gew.98ä¸€ä¸ªæ˜¯Kar98ï¼Œ G98è£…å¤‡åˆ°35å¹´ï¼Œä¹‹åæ˜¯K98ã€‚æ¯›ç‘Ÿ98kå¡å®¾æªæ˜¯äºŒæˆ˜ä¸­å¾·å›½ç‹™å‡»æ‰‹çš„åˆ¶å¼æ­¦å™¨ã€‚ä¸ºäº†é¿å…åœ¨å–ä¸‹ç„å‡†é•œåä¸è‡´å¤±å»æŠµæŠ—èƒ½åŠ›ï¼Œæªä¸Šè¿˜å¤‡æœ‰æœºæ¢°ç„å…·ã€‚åœ¨ç”Ÿäº§ä¸­ï¼ŒæŒ‘é€‰æœ€å¥½çš„æªç®¡ç”¨äºè£…ç„å‡†é•œçš„æ­¥æªã€‚è¿™äº›æ­¥æªçš„æ‰³æœºæ˜¯ç»è¿‡ä¿®æ”¹çš„ï¼Œå…¶æ‰³æœºåŠ›è¾¾1.8kgã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-35-40-611.png" alt=""></p><p>Gew.98å¼æ­¥æªä¸ºæ¯›ç‘Ÿæ­¥æªçš„æ”¹è¿›å‹å·ï¼Œä¸ä»…å¸æ”¶äº†æ—©æœŸæ¯›ç‘Ÿå‹å·ä¸Šçš„æ‰€æœ‰æ”¹è¿›ï¼Œä¸»è¦ç‰¹å¾æ˜¯å›ºå®šå¼åŒæ’å¼¹ä»“å’Œæ—‹è½¬åæ‹‰å¼æªæœºã€‚å¼¹ä»“ä¸ºåŒæ’ã€å›ºå®šå¼ï¼Œå…¶åº•æ¿å¯ä»¥æ‹†å¸å‡ºæ¥ã€‚è£…å¡«æ—¶å¯ä»¥ä»é¡¶éƒ¨çš„æŠ›å£³å£ä¸€å‘ä¸€å‘åœ°è£…å…¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¼¹å¤¹ä¸€æ¬¡è£…å¡«æ»¡5å‘ã€‚æ¯ä¸ªæ¡¥å¤¹è£…5å‘å¼¹ï¼Œè¶³å¤Ÿè£…æ»¡ä¸€ä¸ªå¼¹ä»“ï¼Œåœ¨æœºåŒ£åæ¡¥ä¸Šæœ‰æœºå™¨åŠ å·¥å‡ºæ¥çš„æ¡¥å¤¹å¯¼æ§½ã€‚åœ¨è£…å¡«åï¼Œå½“æªæœºå…³é—­æ—¶ï¼Œç©ºçš„æ¡¥å¤¹ä¼šè¢«è‡ªåŠ¨æŠ›å‡ºã€‚å¼¹ä»“å¯ä»¥æ‰“å¼€æªæœºæ¸…ç©ºæˆ–é€šè¿‡æ‹†å¸å¼¹ä»“åº•æ¿è¿›è¡Œï¼Œä½†ä¸€èˆ¬ä¸æ¨èé‡‡ç”¨åä¸€ç§æ–¹æ³•ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-21-14-07-497.bmp" alt=""></p><h3 id="SMLE-MKIII"><a href="#SMLE-MKIII" class="headerlink" title="SMLE MKIII"></a>SMLE MKIII</h3><p>The Short Magazine Lee-Enfield Mk IIIï¼Œæˆ–ç®€ç§°ä¸ºSMLE MkIIIï¼Œæ˜¯ä¸€ç§è‹±å¼èºæ “å¼æ­¥æªã€‚Mark IIIæ˜¯Lee-Enfieldçš„æ¼”å˜ï¼Œé¡¾åæ€ä¹‰å®ƒç¼©çŸ­äº†å¤§çº¦5è‹±å¯¸æˆ–13å˜ç±³ï¼Œå¹¶äº1907å¹´æ¨å‡ºã€‚åˆ¶é€ çš„å¤æ‚æ€§æ„å‘³ç€ä¸€ä¸ªç®€åŒ–çš„å˜ä½“ï¼ŒSMLE MkIII äº1915å¹´æ¨å‡ºã€‚ä¸€ä¸ªå¼¹åŒ£ä¸­æœ‰10å‘.303 Britishï¼Œå®ƒçš„å®¹é‡æ˜¯å…¶ä»–å¤§å¤šæ•°å›½å®¶æ­¥æªçš„ä¸¤å€ã€‚æŒ¥èˆç€æ­¥æªçš„è‹±å›½æ­¥å…µä¹Ÿå› â€œmad minuteâ€è€Œé—»åï¼Œåœ¨æ­¤æœŸé—´ä»–ä»¬å¯ä»¥è¾¾åˆ°æ¯åˆ†é’Ÿ30å‘ä»¥ä¸Šçš„é€Ÿåº¦ã€‚</p><p>è¿™ç§æ­¦å™¨åœ¨è‹±è”é‚¦å›½å®¶éå¸¸æ™®éï¼Œè¢«åŠ æ‹¿å¤§ï¼Œæ‹‰å‰å’Œæ¾³æ–°å†›å›¢ä»¥åŠè‹±å›½æœ¬èº«ä½¿ç”¨; å¼€å‘äº†è®¸å¤šå˜ä½“ï¼ŒåŒ…æ‹¬æˆ˜åœ°1942å¹´å‡ºç°çš„ç¬¬4å·ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-35-55-747.png" alt="SMLE MKIII"></p><h3 id="æ˜¥ç”°M1903"><a href="#æ˜¥ç”°M1903" class="headerlink" title="æ˜¥ç”°M1903"></a>æ˜¥ç”°M1903</h3><p>M1903æ˜¥ç”°æ­¥æª (M1903 Springfield rifle)æ˜¯ä¸€ç§æ—‹è½¬åæ‹‰å¼æªæœºæ­¥æªï¼Œç”±æ˜¥ç”°å…µå·¥å‚ç”Ÿäº§ï¼Œæ˜¯ç¾å†›åœ¨ä¸€æˆ˜åŠäºŒæˆ˜çš„åˆ¶å¼æ­¥æªï¼Œæ˜¯æ˜¥ç”°å…µå·¥å‚åœ¨æ¯›ç‘Ÿå…µå·¥å‚çš„ç‰¹è®¸ä¸‹ç ”åˆ¶çš„ï¼Œæ—‹è½¬åæ‹‰å¼æªæœºä»¿è‡ªå¾·å›½m1898ï¼Œå¯ä»¥ç®—æ˜¯ä»¥æ¯›ç‘Ÿæ­¥æªä¸ºåŸºç¡€çš„å˜å‹æªã€‚</p><p>M1903å› ä¸ºç¼©çŸ­äº†æªç®¡ï¼Œæ‰€ä»¥é•¿åº¦æ¯”æ¯›ç‘Ÿæ­¥æªçŸ­ï¼Œæ‹‰æœºæŸ„æ”¹ä¸ºå‘ä¸‹å¼¯æ›²ä¾¿äºæºè¡Œã€‚ç”±å®¹é‡5å‘å­å¼¹çš„å¼¹ä»“ä¾›å¼¹ï¼Œç”¨5å‘åˆ†ç¦»å¼å¼¹å¤¹è£…å¼¹ã€‚M1903æ­¥æªé…ç”¨çš„M1906æ­¥æªå¼¹ï¼ˆ.30-06æ­¥æªå¼¹ï¼‰æ˜¯åœ¨æ¯›ç‘Ÿå¼æ— åº•ç¼˜å¼¹çš„åŸºç¡€ä¸Šæ”¹è¿›è€Œæˆçš„ï¼Œæ—©æœŸçš„M1903æ­¥æªè¿˜é…æœ‰æ†å¼åˆºåˆ€ï¼Œåæ”¹ç”¨äº†åŒ•é¦–å‹åˆºåˆ€ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-36-41-656.png" alt="æ˜¥ç”°M1903"></p><p>ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜æœŸé—´ï¼Œå½“ç¾å›½å‚æˆ˜æ—¶ï¼ŒM1903æ­¥æªæ•°é‡ä¸è¶³ï¼Œç¾å›½å°†åŒæ ·ä»¿è‡ªå¾·å›½æ¯›ç‘Ÿæ­¥æªæªæœºçš„ä¸€ç§æ©è²å°”å¾·M1917å‘½åä¸ºâ€œM1917æ­¥æªâ€ä½œè¡¥å……è£…å¤‡ï¼Œç”šè‡³ä¸€åº¦åœ¨å‰çº¿ç¾å›½å†›é˜Ÿä½¿ç”¨çš„M1917æ¯”M1903è¿˜å¤šã€‚ä¸€æˆ˜ç»“æŸåï¼Œç¾å›½å†›é˜Ÿåªä¿ç•™M1903ä½œä¸ºåˆ¶å¼æ­¥æªï¼ŒM1917å…¨éƒ¨æ’¤è£…ä½œå‚¨å¤‡ã€‚<br>1938å¹´ï¼Œå–ä»£M1903æ­¥æªçš„åŠè‡ªåŠ¨M1åŠ å…°å¾·æ­¥æªäº§é‡ä¸è¶³ï¼Œå› æ­¤M1903æ­¥æªä»ç„¶æ˜¯ç¾å›½å†›é˜Ÿè£…å¤‡çš„ä¸»è¦æ­¥æªï¼Œåœ¨ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜ä¸­ï¼Œç¾å›½å†›é˜Ÿä»ç„¶å¤§é‡è£…å¤‡ã€‚å‰©ä½™çš„M1903æ˜¥ç”°æ­¥æªè¢«èµ‹äºˆäº†æ–°çš„ä½¿å‘½ï¼ŒåŒ…æ‹¬æ”¹è£…æˆç‹™å‡»æ­¥æªï¼Œç‹™å‡»æ­¥æªç‰ˆæœ¬åŠ è£…å…‰å­¦ç„å‡†é•œï¼Œå…·æœ‰ç²¾åº¦ä¸Šçš„ä¼˜åŠ¿ï¼Œè€Œä¸ºä¸å¦¨ç¢ç„å‡†é•œçš„ä½¿ç”¨ï¼Œæ‰€ä»¥æ‹†é™¤äº†æœºæ¢°ç„å…·ã€‚<br>ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜æœŸé—´ï¼Œæ ¹æ®æ´åŠ©æ³•æ¡ˆå¤§é‡çš„M1903æ­¥æªè£…å¤‡ä¸­å›½å†›é˜Ÿï¼Œåœ¨ä¸­å›½æŠ—æˆ˜æ—¶æœŸä»¥åŠè§£æ”¾æˆ˜äº‰æ—¶æœŸå¹¿æ³›ä½¿ç”¨ã€‚ç”±äºè¯¥æªå¤–å½¢ã€é•¿çŸ­å‡ä¸å½“æ—¶ä¸­å›½å†›é˜Ÿè£…å¤‡çš„ä¸­æ­£å¼æ­¥æªï¼ˆä»¿æ¯›ç‘Ÿ1924ï¼‰ç›¸ä¼¼ï¼Œè¢«ä¸­å›½å£«å…µç§°ä¸ºâ€œèŠ±æ——ä¸­æ­£å¼â€ã€‚<br>M1903æ­¥æªæˆä¸ºç¾å†›åˆ¶å¼è£…å¤‡100å¹´åï¼Œä»ç„¶åœ¨ç¾å›½å†›é˜Ÿä¸­å°‘é‡å‡ºç°ã€‚å¹¶å°†æªèº«é‡‘å±éƒ¨ä»¶é•€é“¬å¤„ç†ï¼Œé…ç™½è‰²èƒŒå¸¦ï¼Œä¾›è®­ç»ƒä¸æ£€é˜…ä½¿ç”¨ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-52-19-720.png" alt=""></p><h3 id="Martini-Henry-é©¬è’‚å°¼-äº¨åˆ©æ­¥æª"><a href="#Martini-Henry-é©¬è’‚å°¼-äº¨åˆ©æ­¥æª" class="headerlink" title="Martini Henry é©¬è’‚å°¼-äº¨åˆ©æ­¥æª"></a>Martini Henry é©¬è’‚å°¼-äº¨åˆ©æ­¥æª</h3><p>çºµè§‚19ä¸–çºªåæœŸçš„å†›ç”¨æ­¦å™¨ï¼Œè‹±å›½çš„é©¬è’‚å°¼-äº¨åˆ©æ­¥æªæ˜¯ä¸å¯ä¸æçš„ã€‚å®ƒä¸ºè‹±å›½å‘å…¨ä¸–ç•Œæ‰©å¼ å…¶å¸å›½é¢†åœŸï¼Œå‘æŒ¥äº†éå‡¡çš„ä½œç”¨ã€‚ä»å†°é›ªè¦†ç›–çš„åŠ æ‹¿å¤§åˆ°ä½äºæ’’å“ˆæ‹‰æ²™æ¼ è¾¹ç¼˜çš„è‹ä¸¹ï¼Œå†åˆ°ç¾¤å±±ä¹‹ä¸­çš„é˜¿å¯Œæ±—ï¼Œåˆ°å¤„éƒ½ç•™ä¸‹äº†å®ƒçš„è¶³è¿¹ã€‚å†å²ä¸Šè®¸å¤šå‹‡çŒ›çš„å°šæ­¦æ°‘æ—éƒ½è¢«æ‰‹æŒå°„ç¨‹è¿œã€å°„é€Ÿé«˜çš„é©¬è’‚å°¼-äº¨åˆ©æ­¥æªçš„è‹±å›½å£«å…µé•‡å‹äº†ã€‚</p><p>é©¬è’‚å°¼-äº¨åˆ©æ­¥æªçš„ä¼ å¥‡å†å²å§‹äºç¾å›½é©¬è¨è¯¸å¡å·çš„æªç‚®å•†äº¨åˆ©Â·çš®åšè¿ªã€‚ 1862å¹´ï¼Œçš®åšè¿ªè·å¾—äº†åè†›è£…å¡«æ­¥æªçš„ä¸“åˆ©æƒï¼Œè¿™ç§æ­¥æªé‡‡ç”¨èµ·è½å¼æªæœºï¼Œæªæœºä¸‹é™æ—¶å¼¹å£³å¯ä»¥è‡ªåŠ¨æŠ›å‡ºï¼Œå¹¶ä¸”èƒ½å¤Ÿä½¿ä¸‹ä¸€å‘æªå¼¹å¿«é€Ÿå…¥è†›ã€‚è¯¥æªé‡‡ç”¨ç®€å•çš„ç«æªå¼å‡»é”¤å‡»å‘æ–¹å¼è€Œä¸”å¿…é¡»æ‰‹åŠ¨å¾…å‡»ã€‚<br>1860å¹´ä»£æœ«è‡³1870å¹´ä»£åˆï¼Œè¿™ç§åè†›è£…å¡«æ­¥æªå—åˆ°äº†è¥¿ç­ç‰™ã€åŠ æ‹¿å¤§ã€åœŸè€³å…¶ã€ç½—é©¬å°¼äºšã€æ–°è¥¿å…°å’Œå¢¨è¥¿å“¥ç­‰å›½çš„é’çï¼Œå¹¶è´­ä¹°äº†æ•°ä¸‡æ”¯ã€‚<br>1866å¹´ï¼Œä¸€ä½å±…ä½åœ¨ç‘å£«çš„å¥¥åœ°åˆ©ç±è®¾è®¡å¸ˆå¼—é›·å¾·é‡Œå…‹Â·å†¯Â·é©¬è’‚å°¼ä¿®æ”¹äº†çš®åšè¿ªçš„è®¾è®¡ï¼Œç”¨å®‰è£…åœ¨æªæœºå†…éƒ¨ã€ç”±å¼¹ç°§æ§åˆ¶çš„å‡»é’ˆä»£æ›¿äº†ç¬¨é‡çš„å¤–ç½®å‡»é”¤ï¼Œå¹¶ä¸”è¿˜é‡æ–°è®¾è®¡äº†æœºåŒ£ã€åŠ å›ºäº†æŠ½å£³é’©ã€‚è¿™äº›æ”¹è¿›ä½¿å¾—è¯¥æªçš„å‡»å‘æ—¶é—´å˜å¾—æ›´çŸ­ (å‡»å‘æ—¶é—´å³ä¸ºæ‰£åŠ¨æ‰³æœºå®Œæˆç¬é—´è‡³åº•ç«å‘ç«çš„æ—¶é—´é—´éš”)ã€‚<br>æ”¹è¿›åçš„æ­¥æªä¸ä½†æ¯”çš®åšè¿ªçš„åŸå‹æªæ›´åšå›ºï¼Œè€Œä¸”åœ¨å°„é€Ÿä¸Šä¹Ÿæœ‰å¾ˆå¤§æé«˜ã€‚<br>ä½†ç‘å£«é™†å†›è¿˜æ˜¯å†³å®šé‡‡ç”¨æ—‹è½¬åæ‹‰å¼æªæœºçš„å•å‘æ­¥æªï¼Œé©¬è’‚å°¼åªå¾—æŠŠä»–çš„è®¾è®¡æä¾›ç»™äº†å…¶ä»–å›½å®¶ã€‚<br>1867å¹´ï¼Œè‹±å›½é™†å†›å¯¹å¤–å®£å¸ƒè¦å¯»æ‰¾ä¸€ç§æ­¥æªæ¥æ›¿ä»£å…¶0.577è‹±å¯¸ï¼ˆ14. 66mmï¼‰å£å¾„çš„æ–¯å¥ˆå¾·æ­¥æªã€‚é©¬è’‚å°¼æºå¸¦ä»–çš„æ­¥æªå‚åŠ äº†è‹±å†›çš„è¯•éªŒï¼Œå°½ç®¡æœ‰å¾ˆå¤šåƒäº¨åˆ©è¿™æ ·çš„çŸ¥åæªç‚®å•†å‚ä¸ç«äº‰ï¼Œä½†ä»–çš„æ­¥æªå´æŠ€å‹ç¾¤é›„ã€‚1868å¹´ï¼Œåè½åœ¨æ©è²å°”å¾·çš„è‹±å›½çš‡å®¶è½»æ­¦å™¨åˆ¶é€ å‚æ¥åˆ°ç”Ÿäº§å‡ æ”¯é©¬è’‚å°¼æ­¥æªç”¨äºè¿›è¡Œè¿›ä¸€æ­¥é‡å¤–è¯•éªŒçš„å‘½ä»¤ã€‚ç»è¿‡å¤§é‡çš„é‡å¤–è¯•éªŒï¼Œ1871å¹´7æœˆ3æ—¥ï¼Œé©¬è’‚å°¼æ­¥æªè¢«è‹±å†›æ­£å¼é‡‡ç”¨ã€‚ç”±äºè¯¥æªé‡‡ç”¨äº†äº¨åˆ©è®¾è®¡çš„å¸¦æœ‰è†›çº¿çš„æªç®¡ï¼Œå› æ­¤è‹±å›½é™†å†›å®˜æ–¹å°†å…¶å‘½åä¸ºé©¬è’‚å°¼-äº¨åˆ©MKâ… æ­¥æªã€‚<br>è¯¥æªæ˜¯ä¸€ç§å¾ˆå®ç”¨çš„æ­¦å™¨ï¼Œç›’å­çŠ¶çš„æœºåŒ£ä½¿å¾—æ‰³æœºæŠ¤åœˆä½ç½®å‘å‰äº†ï¼Œå¹¶ä¸”æ æ†ä¸€ç›´å»¶ä¼¸åˆ°æªæ‰˜ä¸Šã€‚é‡‡ç”¨èƒ¡æ¡ƒæœ¨æªæ‰˜å’ŒæŠ¤æœ¨ï¼ŒæŠ¤æœ¨ç”¨ä¸¤ä¸ªå¥—ç®å›ºå®šåœ¨æªèº«ä¸Šï¼Œå¹¶ä¸”æœ‰ä¸€åœ†æ†é€šè¿‡æ²Ÿæ§½é•¶åµŒåœ¨ä¸‹æŠ¤æœ¨çš„åº•éƒ¨ï¼Œæªç®¡å³ä¾§å®‰è£…äº†ä¸€æŠŠéª‘å…µåˆºåˆ€ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-36-55-815.png" alt="é©¬è’‚å°¼-äº¨åˆ©æ­¥æª"></p><p>é©¬è’‚å°¼-äº¨åˆ©MKâ… æ­¥æªæ“ä½œèµ·æ¥éå¸¸ç®€ä¾¿ï¼Œå°„æ‰‹åªéœ€å‘ä¸‹æ‹‰åŠ¨æ æ†ï¼Œå°±ä¼šå®Œæˆå¦‚ä¸‹çš„åŠ¨ä½œï¼šå‡»é’ˆç¼©è¿›æªæœºçš„å‰éƒ¨ï¼›<br>æªæœºå›è½¬ï¼Œéœ²å‡ºå¼¹è†›ï¼›æ‰³æœºåµŒå…¥é˜»é“æ§½ï¼›è¯¥æªä»…æœ‰çš„ä¿é™©è£…ç½®æ˜¯ä½äºæœºåŒ£å³ä¾§çš„æ°´æ»´çŠ¶å¾…å‡»æŒ‡ç¤ºå™¨ï¼Œå¾…å‡»æ—¶å…¶æŒ‡åœ¨åç‚¹é’Ÿçš„ä½ç½®ä¸Šï¼Œå‡»å‘åæŒ‡åœ¨åäºŒç‚¹é’Ÿçš„ä½ç½®ã€‚æœºåŒ£å³ä¾§é¡¶éƒ¨åˆ»æœ‰V.Rå­—æ ·ï¼Œå³ç»´å¤šåˆ©äºšç‹å† æ ‡å¿—ï¼Œå…¶å³ä¸‹ä¾§ä¸ºå†›é˜Ÿåˆ¶å¼æ ‡å¿—ã€‚ç½—é©¬æ•°å­—â… åˆ»åœ¨æœºåŒ£å³ä¾§é è¿‘åˆ¶é€ å•†æ ‡å¿—å¤„ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-53-06-436.png" alt=""></p><p>é©¬è’‚å°¼-äº¨åˆ©æ­¥æªæœ€åˆä½¿ç”¨çš„æªå¼¹å£å¾„ä¸º0.450è‹±å¯¸ï¼Œé‡‡ç”¨åšå…‹èµ›å¼åº•ç«ï¼Œå·åˆ¶é»„é“œå¼¹å£³ã€‚åæ¥ï¼Œè¯¥æªå¼¹æ”¹ä¸ºé‡‡ç”¨å‡ å±‚å¸¦çº¸å«çš„å·åˆ¶è–„é“œçš®å¼¹å£³èº«å¹¶é…ä»¥é“åˆ¶å¼¹å£³åº•éƒ¨çš„å¼¹å£³ã€‚</p><p>ä½¿ç”¨å·åˆ¶é»„é“œçš®å¼¹å£³çš„æªå¼¹çœ‹èµ·æ¥å¾ˆé€‚ç”¨ï¼Œä½†åœ¨å®æˆ˜ä¸­ç”¨è–„ææ–™åˆ¶æˆçš„å¼¹å£³æ˜“äºå˜å½¢ã€æ’•è£‚ã€å—æ½®ï¼Œè€Œä¸”å½“æ­¦å™¨è¿ç»­å‘å°„æ¸©åº¦è¾ƒé«˜æ—¶ï¼Œè–„é“œçš®æ˜“ç²˜ç€åœ¨å¼¹è†›ä¸Šï¼Œé˜»ç¢æŠ½å£³ã€‚è¿™æ ·å£«å…µä»¬åªå¥½å¼ºè¡Œä»å¼¹è†›é‡Œæ’¬å‡ºç©ºå¼¹å£³ï¼Œå¯¼è‡´é“åˆ¶å¼¹å£³åº•éƒ¨æ’•è£‚ï¼Œè€Œå·åˆ¶é»„é“œçš®å¼¹å£³ç•™åœ¨å¼¹è†›å†…ï¼Œä½¿å¾—ä¸€æ”¯å¾ˆå¥½çš„æ­¥æªä¹Ÿæ— ç”¨æ­¦ä¹‹åœ°äº†ã€‚<br>1885å¹´ï¼Œä¸ºäº†å¯¹ä»˜ç¾¤ä½“çŠ¯ç½ªï¼Œè‹±å›½é™†å†›å‘æ˜äº†è£…å¡«é¹¿å¼¹çš„æªå¼¹é…å¤‡é©¬è’‚å°¼-äº¨åˆ©æ­¥æªä½¿ç”¨ã€‚å®ƒæ˜¯ä¸€ç§è£…æœ‰11ä¸ªå°çƒçš„å¸¦æœ‰åšå…‹èµ›å¼åº•ç«çš„æªå¼¹ï¼Œç›´å¾„ä¸º7mmï¼Œå†…è£…é»‘ç«è¯ã€‚æ­¤å¤–ï¼Œä¸ºäº†é˜²æ­¢å¼¹å†…å°çƒç›¸äº’ç¢°æ’å‘å‡ºå“å£°ï¼ŒæŸåé‡‘å±è–„ç‰‡çš„å¼¹å£³ï¼Œå¼¹å£³ä¸­çš„ç©ºéš™ç”¨éª¨ç²‰å¡«å……ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-53-00-279.png" alt=""></p><h3 id="FusilModele1886-å‹’è´å°”M1886"><a href="#FusilModele1886-å‹’è´å°”M1886" class="headerlink" title="FusilModÃ¨le1886 å‹’è´å°”M1886"></a>FusilModÃ¨le1886 å‹’è´å°”M1886</h3><p>å‹’è´å°”M1886ï¼ˆæ³•è¯­ï¼šFusilModÃ¨le1886ï¼‰æˆ–å‹’è´å°”æ­¥æªï¼ˆæ³•è¯­ï¼šFusilLebelï¼‰æ˜¯æ³•å›½äº1886å¹´æ¨å‡ºçš„æ‰‹åŠ¨æªæœºå¼æ­¥æªï¼Œç”±å°¼å¤æ‹‰æ–¯.å‹’è´å°”ä¸Šæ ¡ç ”åˆ¶ã€‚è¯¥æªè¿ç”¨äº†ç”±ä¿ç½—.ç»´åŸƒé‚£å¼€å‘çš„ç«è¯Bï¼Œäº¦æ˜¯å²ä¸Šç¬¬ä¸€ç§æœ€æˆåŠŸçš„æ— çƒŸç«è¯æªæ¢°ã€‚å‹’è´å°”æ­¥æªçš„å‡ºç°æ„å‘³ç€é‚£äº›ä½¿ç”¨é»‘ç«è¯çš„æªæ¢°å·²è¿‡æ—¶ï¼Œå„å›½äº¦å¼€å§‹æ”¹ä¸ºä¸“æ³¨äºç ”åˆ¶å’Œé‡‡è´­å‘å°„æ— çƒŸç«è¯çš„æªæ¢°ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-37-06-868.png" alt=""></p><p>å‹’è´å°”æ­¥æªå‘å°„8Ã—50æ¯«ç±³çš„å…¨å…¨å±å¤–å£³æ­¥æªå­å¼¹ï¼Œè½½å¼¹é‡ä¸º8å‘ï¼Œå¹¶ä»¥å†…ç½®å¼¹ä»“ä¾›å¼¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜å¯é…å¤‡ä¸€ç§é•¿é’ˆå‹çš„é‡å‰‘å¼åˆºåˆ€ä»¥åº”ä»˜ç™½åˆƒæˆ˜ã€‚åœ¨1887å¹´ï¼Œå‹’è´å°”æ­¥æªè¢«æ³•å›½å†›é˜Ÿåˆ—è£…ä¸ºåˆ¶å¼æ­¥æªï¼Œå¹¶å‚ä¸äº†å¤šæ¬¡å¯¹å¤–æˆ˜äº‰ï¼Œå½“ä¸­æ›´åŒ…æ‹¬ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜åŠç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜ã€‚<br>åœ¨ä¸€æˆ˜æœŸé—´ï¼Œæ³•å†›æ›¾æ‰“ç®—ä»¥Mle1917åŠè‡ªåŠ¨æ­¥æªå¤§é‡å–ä»£å‹’è´å°”æ­¥æªã€‚ç„¶è€Œï¼Œå£«å…µä»¬å´æ™®éè®¤ä¸ºæ­¤æªè¿‡äºç¬¨é‡å’Œå¤ªé•¿ï¼Œå› æ­¤å¹¶ä¸å®¹æ˜“åœ¨æˆ˜å£•å†…æ“ä½œå’Œä¿å…»ã€‚åŸºäºè¿™äº›é—®é¢˜ï¼Œæ³•å†›ä¸€ç›´éƒ½æœªèƒ½æ‰¾åˆ°åˆé€‚çš„æ›¿ä»£å“ä»¥å–ä»£å‹’è´å°”æ­¥æªã€‚è€Œåœ¨1936å¹´æ¨å‡ºçš„MAS36æ­¥æªäº¦å› ç”Ÿäº§è¿›åº¦å¤ªæ…¢å¹¶ä¸èƒ½æ»¡è¶³å†›é˜Ÿï¼Œæ‰€ä»¥ç›´è‡³æ³•å›½è¢«çº³ç²¹å¾·å›½å é¢†ä¹‹å‰ï¼Œå‹’è´å°”æ­¥æªä»æ—§ä¸ºæ³•å†›çš„ä¸»åŠ›æ­¥æªã€‚å½“ä¸­æœ‰å°‘é‡çš„æ­¥æªæ›´è¢«çº³ç²¹å¾·å†›ç¼´è·ä½¿ç”¨ï¼Œå¹¶ä»¥Gewehr301(f)çš„åä¹‰åœ¨å†›ä¸­æœå½¹ã€‚<br>ç›´è‡³1920å¹´åœäº§å‰ï¼Œå‹’è´å°”æ­¥æªä¸€å…±è¢«æ³•å›½çš„å›½è¥å…µå·¥å‚ç”Ÿäº§äº†çº¦2,880,000æ”¯ã€‚è€Œåœ¨äºŒæˆ˜è¿‡åçš„ä¸€äº›å†²çªä¸­ä»èƒ½æ‰¾åˆ°å‹’è´å°”æ­¥æªçš„èº«å½±ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-53-36-183.png" alt=""></p><h3 id="è«è¾›-çº³ç”˜æ­¥æª"><a href="#è«è¾›-çº³ç”˜æ­¥æª" class="headerlink" title="è«è¾›-çº³ç”˜æ­¥æª"></a>è«è¾›-çº³ç”˜æ­¥æª</h3><p>è«è¾›-çº³ç”˜æ­¥æªï¼ˆè«è¾›çº³å¹²ç³»åˆ—ä¿„æ–‡Ğ’Ğ¸Ğ½Ñ‚Ğ¾Ğ²ĞºĞ° ĞœĞ¾ÑĞ¸Ğ½Ğ°ï¼Œè‹±æ–‡Mosin-Nagant,åˆç§°è«è¾›-çº³å¹²ï¼‰ï¼Œå³M1891è«è¾›-çº³ç”˜æ­¥æªï¼Œåœ¨ä¿„å›½è¢«ç§°ä¸ºâ€œVintovka Mosinaâ€ï¼ˆè«è¾›æ­¥æªï¼‰ï¼Œæ˜¯åœ¨ä¿„å›½æ”¿åºœå§”æ‰˜ä¸‹åœ¨1880å¹´ä»£åæœŸè‡³1890å¹´ä»£æ—©æœŸç ”åˆ¶çš„æ­¥æªã€‚<br>è¯¥æªç”±ä¿„å›½å†›é˜Ÿåœ¨1891å¹´æ­£å¼é‡‡ç”¨ï¼Œå®šå‹ä¸º1891å‹3çº¿å£å¾„(7.62x54mmR)æ­¥æªã€‚M1891æ­¥æªåœ¨æ‹›æ ‡è¿‡ç¨‹ä¸­å‡ºç°äº†äº‰è®®ï¼Œæœ‰ä¸¤ä¸ªè®¾è®¡èƒ½å¤Ÿè¿›å…¥å®˜æ–¹è¯„å®¡çš„æœ€åé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯ä¿„å›½é™†å†›ä¸Šå°‰è°¢å°”ç›–Â·ä¼Šå‡¡è¯ºç»´å¥‡Â·è«è¾›ï¼ˆSergei Ivanovich Mosinï¼‰çš„æ ·æªï¼Œå¦ä¸€ä¸ªæ˜¯æ¯”åˆ©æ—¶çš„è‰¾ç±³å°”Â·çº³ç”˜å’Œææ˜‚Â·çº³ç”˜ä¸¤å…„å¼Ÿï¼ˆEmil Nagantå’ŒLeon Nagantï¼‰è®¾è®¡çš„æ ·æªã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-37-18-225.png" alt="è«è¾›-çº³ç”˜æ­¥æª"></p><h4 id="å†å²"><a href="#å†å²" class="headerlink" title="å†å²"></a>å†å²</h4><p>è«è¾›å‡ºç”Ÿäº1849å¹´5æœˆ5æ—¥ï¼Œ12å²æ—¶è¿›å…¥ä¸€å®¶å†›äº‹å­¦é™¢å¹¶åœ¨é‚£é‡Œå‚äº†å†›ï¼Œåœ¨1867å¹´ä»–è¿›å…¥è«æ–¯ç§‘Alexandrovskoyeå†›äº‹ä¸­å­¦ï¼ˆAlexandrovskoye Military High Schoolï¼‰ï¼Œåœ¨1870å¹´ç¦»å¼€å†›äº‹ä¸­å­¦æ—¶ï¼Œä»–ä¸ºäº†èƒ½å¤Ÿè°ƒå»ç‚®å…µéƒ¨é—¨è€Œè½¬å…¥å¼€ä¾æ´›å¤«æ–¯ç§‘ä¼Šç‚®å…µå­¦é™¢ï¼ˆMikhailovskoye Artillery Academyï¼‰ã€‚ä»–åœ¨1875å¹´æ¯•ä¸šåè¢«è°ƒåˆ°å›¾æ‹‰å…µå·¥å‚ã€‚è«è¾›å½“ä¸Šæ­¦å™¨è®¾è®¡å¸ˆåçš„ç¬¬ä¸€ä¸ªå·¥ä½œå°±æ˜¯å¯¹ä¼¯ä¸¹IIæ­¥æªçš„æ”¹è¿›ï¼Œè«è¾›-çº³ç”˜æ­¥æªç®—æ˜¯ä»–çš„ç¬¬äºŒä¸ªè®¾è®¡ï¼Œè™½ç„¶å®šå‹çš„è«è¾›-çº³ç”˜æ­¥æªå¹¶æ²¡æœ‰å®Œå…¨é‡‡ç”¨ä»–çš„è®¾è®¡ã€‚è«è¾›æ˜¯åœ¨1883å¹´å¼€å§‹è®¾è®¡è¿å‘æ­¥æªçš„è®¾è®¡å·¥ä½œï¼Œä»–åœ¨1884å¹´å’Œ1885å¹´åˆ†åˆ«æä¾›äº†å‡ ç§å†…ç½®å¼¹ä»“ä¾›å¼¹çš„æ­¥æªè®¾è®¡ç»™è´Ÿè´£æ‹›æ ‡çš„å§”å‘˜ä¼šï¼Œæœ€åˆçš„è®¾è®¡æ˜¯10.6mmå£å¾„ã€‚ä½†è«è¾›çš„åŠªåŠ›æˆæœæ²¡æœ‰å—åˆ°ä¿„ç½—æ–¯å†›é˜Ÿçš„é‡è§†ã€‚<br>åœ¨1886å¹´æ³•å›½é‡‡ç”¨8mmå£å¾„M1886å‹’è´å°”æ­¥æªåï¼ˆè¿™æ˜¯ç¬¬ä¸€ç§é‡‡ç”¨æ— çƒŸç«è¯çš„å°å£å¾„æªå¼¹çš„å†›ç”¨æ­¦å™¨ï¼‰ï¼Œæ­¤ä¸¾åœ¨ä¸–ç•Œå„å›½å¼•èµ·äº†ä¸€åœºä½¿ç”¨æ— çƒŸå‘å°„è¯å°å£å¾„æªå¼¹ï¼ˆç›¸å¯¹ä¹‹å‰çš„å¼¹è¯ï¼‰çš„è½»æ­¦å™¨å†›å¤‡å˜é©ï¼Œåœ¨1887å¹´è‡³1889å¹´é—´ï¼Œå¤§å¤šæ•°æ¬§æ´²å›½å®¶çš„å†›é˜Ÿéƒ½é‡‡ç”¨äº†ç±»ä¼¼çš„æ­¦å™¨ï¼Œä¿„å›½æ”¿åºœä¹Ÿå†³å®šé‡‡ç”¨ä¸€ç§ç±»ä¼¼çš„æ–°å‹è¿å‘æ­¥æªï¼Œä»£æ›¿ç°å½¹çš„ä¼¯ä¸¹æ­¥æªï¼ˆç±»ä¼¼äºè‹±å›½é©¬è’‚å°¼-äº¨åˆ©æ­¥æªçš„é»‘ç«è¯æªå¼¹å•å‘åè£…æªï¼‰ã€‚ä¸ºæ­¤ä¿„ç½—æ–¯æ”¿åºœç»„ç»‡äº†ä¸€ä¸ªå§”å‘˜ä¼šï¼Œä»ç°æœ‰çš„æ¯›ç‘Ÿã€å‹’è´å°”ã€æ-æ¢…ç‰¹ç¦ã€æ›¼åˆ©å¤ã€æ–½å¯†ç‰¹-é²å®¾å’Œå…‹æ‹‰æ ¼-çº¦æ ¹æ£®ç­‰è®¾è®¡ä¸­è¿›è¡Œé€‰æ‹©ã€‚è«è¾›ä¹Ÿæ¥å—å§”æ‰˜è®¾è®¡äº†ä¸€ç§5å‘å•æ’å¼¹ä»“çš„7.62mmå£å¾„æ­¥æªå‚ä¸æ‹›æ ‡ã€‚æ ¹æ®å¤è€çš„ä¿„ç½—æ–¯åº¦é‡è¡¡ç§°ä¸º3çº¿å£å¾„ã€æ³¨ï¼šliniyaï¼Œè‹±æ–‡ä¸ºlineï¼Œæ—§ä¿„ç½—æ–¯åº¦é‡è¡¡ï¼Œ1çº¿ç­‰äº0.1è‹±å¯¸æˆ–2.54mmï¼Œå› æ­¤ï¼Œ3çº¿ç­‰äº7.62mmæˆ–0.3è‹±å¯¸ã€‘ã€‚è€Œæ¯”åˆ©æ—¶æ­¦å™¨è®¾è®¡å¸ˆææ˜‚Â·çº³ç”˜åˆ™å‘ä¿„ç½—æ–¯å†›é˜Ÿæäº¤äº†ä¸€ç§3.5çº¿å£å¾„ï¼ˆ8.89mmï¼‰æ­¥æªå’Œ500å‘æªå¼¹è¿›è¡Œæµ‹è¯•ã€‚<br>è«è¾›çº³å¹²1891æ­¥æªæ—©æœŸå‹<br>è«è¾›çº³å¹²1891æ­¥æªæ—©æœŸå‹<br>æ‰€æœ‰å‚ä¸æŠ•æ ‡çš„æ­¦å™¨éƒ½åœ¨1890å¹´è‡³1891å¹´é—´ç”±ä¿„ç½—æ–¯å†›é˜Ÿè¿›è¡Œæµ‹è¯•ï¼Œä¿„ç½—æ–¯å†›é˜Ÿåçˆ±çº³ç”˜çš„è®¾è®¡ã€‚åŸæœ¬å¯¹çº³ç”˜çš„è®¾è®¡æœ‰åˆ©ï¼Œä½†å‡ºäºä¿„ç½—æ–¯å›½å®¶å°Šä¸¥çš„è€ƒè™‘ï¼Œæ”¿åºœå¯¹è«è¾›çš„æ­¥æªå¾ˆæ„Ÿå…´è¶£ã€‚ç”±äºæ”¿åºœå’Œå†›é˜Ÿçš„æ„è§åˆ†æ­§ï¼Œäº’ä¸ç›¸è®©ï¼Œæœ€åå§”å‘˜ä¼šç”¨äº†æŠ˜è¡·çš„æ–¹æ³•ï¼šæŠŠè¿™ä¸¤ç§è®¾è®¡åˆå¹¶åœ¨ä¸€ç§æ­¥æªä¸Šï¼Œç»“æœæ˜¯æŠŠçº³ç”˜å…„å¼Ÿè®¾è®¡çš„ä¾›å¼¹ç³»ç»Ÿè£…åœ¨è«è¾›è®¾è®¡çš„æ­¥æªä¸Šï¼Œå› æ­¤è¿™ç§æ­¥æªç³»ç»Ÿè¢«ç§°ä¸ºè«è¾›-çº³å¹²æ­¥æªã€‚è€Œå‚ä¸ç«äº‰çš„åŒæ–¹éƒ½è·å¾—è¡¥å¿ï¼šçº³ç”˜å…„å¼Ÿå¾—åˆ°é…¬é‡‘ï¼ˆåæ¥çº³ç”˜å…„å¼Ÿè®¾è®¡çš„M1895æ‰‹æªä¹Ÿè¢«ä¿„ç½—æ–¯å†›é˜Ÿé‡‡ç”¨ï¼‰ï¼Œè€Œè«è¾›åˆ™æ™‹å‡æˆä¸Šæ ¡å¹¶è¢«ä»»å‘½ä¸ºè°¢æ–¯ç‰¹ç½—åˆ—èŒ¨å…‹å…µå·¥å‚çš„ä¸»ç®¡ï¼Œç»§ç»­æ”¹è¿›å’Œç”Ÿäº§è¿™ç§æ­¥æªï¼Œè«è¾›ä¸Šæ ¡äº1902å¹´2æœˆ8æ—¥å»ä¸–ï¼Œå®‰è‘¬åœ¨å›¾æ‹‰ã€‚åœ¨1960å¹´ï¼Œè‹è”è®¾ç«‹äº†ä¸€ä¸ªS.I.è«è¾›ç‰¹åˆ«å¥–ï¼Œå¥–åŠ±å„ä¸ªé˜²åŠ¡ä¼ä¸šç³»ç»Ÿå†…çš„ä¸“å®¶ã€‚<br>è«è¾›-çº³ç”˜æ­¥æªè¢«é‡‡ç”¨æ—¶ä¿„å›½çš„è½»æ­¦å™¨ä¼ä¸šè¿˜æ²¡æœ‰åšå¥½ç”Ÿäº§å‡†å¤‡ï¼Œæ‰€ä»¥ç¬¬ä¸€æ‰¹M1891è«è¾›-çº³ç”˜æ­¥æªæ˜¯æ³•å›½çš„å¤ç‰¹ç½—è½»æ­¦å™¨å‚ç”Ÿäº§çš„ã€‚è«è¾›-çº³ç”˜æ­¥æªæ˜¯ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜ä¸­ä¿„å›½å†›é˜Ÿçš„ä¸»è¦è£…å¤‡ã€‚åœ¨ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜æœŸé—´ï¼Œå¤–å›½çš„æ‰¿åŒ…å•†å†ä¸€æ¬¡è¢«ç”¨æ¥ç”Ÿäº§è¿™ç§æ­¥æªï¼Œå½“æ—¶ä¿„å›½éå¸¸ç¼ºä¹æ­¥æªï¼Œæ‰€ä»¥ä¸ä¸¤å®¶ç¾å›½å…¬å¸ç­¾è®¢ç”Ÿäº§åˆåŒï¼Œä½†è¿™æ‰¹æ­¥æªç”±äº1917å¹´çš„åæœˆé©å‘½è€Œæ²¡æœ‰äº¤ç»™åæ¥çš„è‹ç»´åŸƒæ”¿æƒï¼Œåœ¨ç¾å›½ç”¨äºè®­ç»ƒå’Œæ°‘é—´é”€å”®ã€‚<br>M1891æ­¥æªæœ€åˆæœ‰ä¸‰ç§å‹å·ï¼šæ­¥å…µæ­¥æªã€é¾™éª‘å…µæ­¥æªå’Œå“¥è¨å…‹æ­¥æªï¼Œæ­¥å…µæ­¥æªå°±æ˜¯æ ‡å‡†å‹é•¿æ­¥æªï¼Œåä¸¤ç§æ˜¯é…å‘ç»™éª‘å…µéƒ¨é˜Ÿä½¿ç”¨çš„éª‘æªï¼ˆå¡å®¾æªï¼‰ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-55-36-242.png" alt=""></p><h4 id="ç»“æ„ç‰¹ç‚¹"><a href="#ç»“æ„ç‰¹ç‚¹" class="headerlink" title="ç»“æ„ç‰¹ç‚¹"></a>ç»“æ„ç‰¹ç‚¹</h4><p>è«è¾›-çº³ç”˜æ˜¯æœ€æ—©çš„æ— çƒŸå‘å°„è¯å†›ç”¨æ­¥æªä¹‹ä¸€ï¼Œæªå£°æ¸…è„†, æœ‰å¦‚æ°´ç æº…è½, å› æ­¤æˆ‘ä»¬ä¸­å›½äººä¸ºè«è¾›-çº³ç”˜èµ·äº†ä¸€ä¸ªé¢‡å…·è¯—æ„çš„ç»°å·â€æ°´è¿ç â€ã€‚è«è¾›-çº³ç”˜ç³»åˆ—æ­¥æªä¸æ¯›ç‘Ÿæ­¥æªç³»åˆ—ã€æ-æ©è²å°”å¾·æ­¥æªç³»åˆ—ç­‰å…¶ä»–åŒæ—¶ä»£åŒç±»å†›ç”¨æ­¥æªç›¸æ¯”ï¼Œå…¶æªæœºè®¾è®¡æ˜¾å¾—è¾ƒä¸ºå¤æ‚ï¼Œå®ƒçš„è®¾è®¡ç²—ç³™è€Œä¸”è¿‡æ—¶ï¼Œæ•´ä½“çš„æ“ä½œæ„Ÿè§‰ä¹Ÿæ¯”è¿™äº›æ­¥æªç¬¨æ‹™ã€‚ä½†è«è¾›-çº³ç”˜æ­¥æªçš„ä¼˜ç‚¹æ˜¯æ˜“äºç”Ÿäº§å’Œä½¿ç”¨ç®€å•å¯é â€”â€”è¿™ç›¸å¯¹äºå·¥ä¸šåŸºç¡€ä½ã€å£«å…µæ•™è‚²ç¨‹åº¦ä½çš„è‹/ä¿„å†›é˜Ÿæ¥è¯´æ˜¯æå…¶é‡è¦çš„ï¼Œå°¤å…¶æ˜¯æ¶åŠ£çš„æˆ˜äº‰æ—¶æœŸåŒ…éœ€æé«˜æ­¦å™¨äº§é‡ä»¥æ»¡è¶³å‰çº¿éœ€è¦ï¼Œè€Œå¤§é‡è¡¥å……çš„æˆ˜æ–—äººå‘˜å¾€å¾€è®­ç»ƒæ—¶é—´ä¸è¶³ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-55-39-549.png" alt=""></p><p>è«è¾›-çº³ç”˜æ­¥æªæ˜¯ä¸€ç§æ—‹è½¬åæ‹‰å¼æªæœºã€å¼¹ä»“å¼ä¾›å¼¹çš„æ‰‹åŠ¨æ­¥æªï¼Œæ˜¯ä¿„ç½—æ–¯å†›é˜Ÿé‡‡ç”¨çš„ç¬¬ä¸€ç§æ— çƒŸå‘å°„è¯æ­¥æªã€‚å®ƒé‡‡ç”¨æ•´ä½“å¼çš„å¼¹ä»“ï¼Œé€šè¿‡æœºåŒ£é¡¶éƒ¨çš„æŠ›å£³å£å•å‘æˆ–ç”¨å¼¹å¤¹è£…å¡«ã€‚å¼¹ä»“ä½äºæªæ‰˜ä¸‹çš„æ‰³æœºæŠ¤åœˆå‰æ–¹ï¼Œå¼¹ä»“å®¹å¼¹é‡5å‘ï¼Œæœ‰é“°é“¾å¼åº•ç›–ï¼Œå¯æ‰“å¼€åº•ç›–ä»¥ä¾¿æ¸…ç©ºå¼¹ä»“æˆ–æ¸…æ´ç»´æŠ¤ã€‚ç”±äºæ˜¯å•æ’è®¾è®¡è€Œæ²¡æœ‰æŠ±å¼¹å£ï¼Œå› æ­¤å¼¹ä»“å£éƒ¨æœ‰ä¸€ä¸ªéš”æ–­é¢å™¨ï¼Œä¸Šè†›æ—¶éš”å¼€ç¬¬äºŒå‘å¼¹ï¼Œé¿å…å‡ºç°ä¸ŠåŒå¼¹çš„æ•…éšœã€‚åœ¨æ—©æœŸçš„æªå‹ä¸­ï¼Œè¿™ä¸ªè£…ç½®ä¹Ÿå…¼å…·æŠ›å£³æŒºçš„ä½œç”¨ï¼Œä½†è‡ªM1891/30å‹å¼€å§‹ï¼Œä»¥åçš„æªå‹éƒ½å¢åŠ äº†ä¸€ä¸ªç‹¬ç«‹çš„æŠ›å£³æŒºã€‚æªè†›å†…æœ‰4æ¡å³æ—‹è½¬è†›çº¿ã€‚å½“æªæœºé—­é”æ—¶ï¼Œå›è½¬å¼æªæœºå‰é¢çš„ä¸¤ä¸ªé—­é”å‡¸ç¬‹å‘ˆæ°´å¹³çŠ¶æ€ã€‚æ­¥æªæ˜¯å‡»é’ˆå¼å‡»å‘ï¼Œå‡»é’ˆåœ¨æ‰“å¼€æªæœºçš„è¿‡ç¨‹ä¸­è¿›å…¥å¾…å‘çŠ¶æ€ã€‚æ‰‹åŠ¨ä¿é™©è£…ç½®æ˜¯åœ¨æªæœºå°¾éƒ¨å‡¸å‡ºçš„ä¸€ä¸ªâ€œå°å¸½â€ï¼Œå‘åæ‹‰æ—¶ä¼šé”ä½å‡»é’ˆï¼Œè€Œå‘å‰æ¨æ—¶ä¼šè§£è„±ä¿é™©çŠ¶æ€ï¼Œæ“ä½œæ—¶ä¸å¤ªæ–¹ä¾¿è€Œä¸”è´¹åŠ›ã€‚æ°´å¹³ä¼¸å‡ºçš„æ‹‰æœºæŸ„åŠ›è‡‚è¾ƒçŸ­ï¼Œå› æ­¤æ“ä½œæ—¶éœ€è¦èŠ±è¾ƒå¤§çš„åŠ›æ°”ï¼Œè€Œä¸”æ¯”èµ·ä¸‹å¼¯å¼æ‹‰æœºæŸ„åœ¨æºè¡Œæ–¹é¢æ—¶è¾ƒä¸æ–¹ä¾¿ï¼Œè€Œä¸‹å¼¯å¼æ‹‰æœºæŸ„åªæœ‰ç‹™å‡»å‹æ‰æœ‰ã€‚ä»æ­¥æªä¸Šåˆ†è§£å‡ºæªæœºæ—¶ä¸éœ€è¦ä¸“é—¨å·¥å…·ï¼Œåªè¦æ‹‰å¼€æªæœºï¼Œç„¶åæ‰£ä¸‹æ¿æœºå°±èƒ½å–å‡ºæªæœºã€‚åœ¨æ²¡æœ‰å·¥å…·çš„æ¡ä»¶ä¸‹è¿˜å¯ä»¥è¿›ä¸€æ­¥åˆ†è§£å…¶ä»–å‡ ä¸ªä¸»è¦éƒ¨ä»¶ã€‚æ—©æœŸçš„æ£±å½¢åˆºåˆ€çš„æˆªé¢ä¸ºçŸ©å½¢ï¼Œåæ”¹ä¸ºä¸€å­—èºä¸èµ·å­å½¢ï¼Œå¹¶åœ¨åˆ†è§£æ­¥æªæ—¶å……å½“åˆ†è§£å·¥å…·ã€‚æ—©æœŸçš„åˆºåˆ€æ˜¯å¯æ‹†å¸çš„å››æ£±åˆºåˆ€é€šè¿‡ç”¨ç®¡çŠ¶æ’åº§å¥—åœ¨æªå£ä¸Šï¼ŒåæœŸä¸ºä¸å¯å¸çš„æŠ˜å å¼ï¼Œè€Œä¸”åˆºåˆ€åº§å…¼ä½œå‡†æ˜Ÿåº§ã€‚æªæ‰˜é€šå¸¸ç”¨æ¡¦æœ¨ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/6159252dd42a28344c98d8095bb5c9ea15cebff2.jpg" alt="img"></p><h4 id="å¼¹è¯"><a href="#å¼¹è¯" class="headerlink" title="å¼¹è¯"></a>å¼¹è¯</h4><p>ä¸M1891æ­¥æªä¸€èµ·è¿˜æœ‰ä¸€ç§æ–°çš„å°å£å¾„æªå¼¹è¢«é‡‡ç”¨ï¼ˆç¡®å®æ˜¯é‚£ä¸ªå¹´ä»£é‡Œçš„å°å£å¾„æªå¼¹ï¼‰ï¼Œç›´åˆ°ä»Šå¤©ï¼Œ7.62Ã—54mmRæªå¼¹åœ¨ä¿„å›½å†›é˜Ÿæœå½¹å·²ç»è¶…è¿‡äº†ä¸€ä¸ªä¸–çºªã€‚è¯¥æªå¼¹é‡‡ç”¨çªåº•ç¼˜é”¥å½¢å¼¹å£³ï¼Œçªåº•ç¼˜å¼¹å£³çš„è®¾è®¡åœ¨19ä¸–çºªæœ«ä¹Ÿå·²ç»å¼€å§‹æ˜¾å¾—å¼€å§‹è¿‡æ—¶äº†ï¼Œä½†å´é€‚åˆåŸºç¡€è¾ƒä½çš„ä¿„ç½—æ–¯è½»æ­¦å™¨å·¥ä¸šï¼Œå› ä¸ºçªåº•ç¼˜å¼¹å£³å¯¹å¼¹è†›å°ºå¯¸çš„è¦æ±‚ç›¸å¯¹å®½æ¾ä¸€ç‚¹ï¼Œè¿™æ ·åœ¨æœºå™¨åŠ å·¥æ—¶å…è®¸æœ‰è¾ƒå¤§çš„ç”Ÿäº§å…¬å·®ï¼Œæ—¢èŠ‚çœäº†å·¥æ—¶åˆèŠ‚çº¦äº†é’±ã€‚M1891å¼æªå¼¹çš„å¼¹å¤´æ˜¯é‡210æ ¼ä»¤ã€é“œé•åˆé‡‘è¢«ç”²ã€é“…èŠ¯çš„é’åœ†å¤´å½¢å¼¹å¤´ï¼Œåœ¨å¾·å›½é‡‡ç”¨äº†å°–å¤´å¼¹åï¼Œä¿„ç½—æ–¯ä¹Ÿå¼€å§‹ç ”åˆ¶å°–å¤´å¼¹ï¼Œç»è¿‡å¹¿æ³›æµ‹è¯•åï¼Œåœ¨1908å¹´é‡‡ç”¨äº†ä¸€ç§é‡148æ ¼ä»¤ã€é“œé•è¢«ç”²çš„é“…èŠ¯å°–å¤´å¼¹ï¼ˆæˆ˜äº‰æ—¶æœŸé‡‡ç”¨è¦†é“œé’¢è¢«ç”²ï¼‰ã€‚åœ¨äºŒæˆ˜ç»“æŸåï¼Œè‹è”çš„åˆ¶å¼æ­¥æªå…ˆåé‡‡ç”¨äº†ä¸­é—´å¨åŠ›å‹æªå¼¹å’Œ5.45mmå°å£å¾„æ­¥æªå¼¹ï¼Œä½†ç›´åˆ°ç°åœ¨M1908å¼æªå¼¹ç³»åˆ—ä»ç„¶è¢«ç”¨ä½œæœºæªå’Œç‹™å‡»æ­¥æªçš„å¼¹è¯ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-55-41-642.png" alt=""></p><h3 id="ä¸‰å…«å¼æ­©å…µé“³"><a href="#ä¸‰å…«å¼æ­©å…µé“³" class="headerlink" title="ä¸‰å…«å¼æ­©å…µé“³"></a>ä¸‰å…«å¼æ­©å…µé“³</h3><p>å…«å¼æ­¥æªï¼ˆæ—¥è¯­ï¼šä¸‰å…«å¼æ­©å…µé“³ï¼›ã•ã‚“ã±ã¡ã—ãã»ã¸ã„ã˜ã‚…ã†ï¼Œè‹±æ–‡ï¼šSanpachi-shiki hohei-juï¼‰ä¸ºæ‰‹åŠ¨æ­¥æªï¼Œæ—¥æœ¬é™†å†›äºæ—¥ä¿„æˆ˜äº‰å1907å¹´æ­£å¼é‡‡ç”¨ä¸ºåˆ¶å¼æ­¦å™¨ï¼Œä¸‰å…«å¼æ­¥æªæ˜¯ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜ä¸­æ—¥æœ¬æ³•è¥¿æ–¯é™†ã€æµ·å†›æœ€ä¸»è¦ã€æœ€åŸºæœ¬çš„æ­¦å™¨ï¼Œä¸€ç›´ä½¿ç”¨åˆ°äºŒæˆ˜ç»“æŸï¼ˆæ—¥æœ¬æˆ˜è´¥ï¼‰ï¼Œç”¨äº†æ•´æ•´40å¹´ã€‚<br>ä¸‰å…«å¼æ­¥æªåœ¨ä¸­å›½ä¸€å‘ä¿—ç§°ä¸ºä¸‰å…«å¤§ç›–ï¼Œç”±äºå…¶æªæœºä¸Šæœ‰ä¸€ä¸ªéšæªæœºè¿åŠ¨çš„é˜²å°˜ç›–ä»¥åŠæœºåŒ£ä¸Šåˆ»æœ‰â€œä¸‰å…«å¼â€å­—æ ·è€Œå¾—åã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-37-35-897.png" alt=""></p><h4 id="å†å²-1"><a href="#å†å²-1" class="headerlink" title="å†å²"></a>å†å²</h4><p>ä¸‰å…«å¼æ­¥æªçš„åŸå‹æ˜¯ä¸‰åå¹´å¼æ­¥æªå’Œä¸‰äº”å¼æµ·å†›æ­¥æªã€‚ä¸‰åå¹´å¼æ­¥æªä»¿é€ è‡ªå¾·å›½æ¯›ç‘Ÿæ­¥æªï¼Œè®¾è®¡å¸ˆæ˜¯æœ‰å‚æˆç« å¤§ä½ï¼Œä»¥å–ä»£ä»ç”²åˆæˆ˜äº‰ä»¥æ¥ï¼Œä»¥æ³•å›½M1874æ­¥æªä»¿é€ ä½†æ˜¯ä¸å¯é ä¹Ÿæ‰“ä¸å‡†çš„æ‘ç”°æªã€‚ è¿™ä¸¤ç§æ­¥æªä¹Ÿå› å…¶å‘æ˜è€…æœ‰å‚æˆç« è€Œå¾—åæœ‰å‚æ­¥æªã€‚<br>æœ‰å‚åœ¨è®¾è®¡ä¸‰åå¹´å¼æ­¥æªæ—¶èµ·åˆè®¾å®šäº†ä¸‰ç§å£å¾„ä½œä¸ºç ”å‘æ–¹å‘ï¼š6æ¯«ç±³ã€6.5æ¯«ç±³ä»¥åŠ7æ¯«ç±³ã€‚ä¸‰åå¹´å¼æ­¥æªï¼ˆä¸‰åå¹´å¼æ­©å…µé“³ï¼‰äº1897å¹´è¿›è¡Œåˆ¶å¼åŒ–ç”Ÿäº§ï¼Œå¹¶äº1903å¹´å®Œæˆæ—¥æœ¬å…¨å†›æ›´æ¢æ•´è£…ã€‚æ—¥æœ¬é™†å†›æ¢å‘ä¸‰åå¹´å¼æ­¥æªåï¼Œæ—¥æœ¬æµ·å†›é™†æˆ˜é˜Ÿä¹Ÿè·Ÿç€æ¢æªï¼Œæœ‰å‚æˆç« å°†è®¾è®¡æ¡ˆè½¬å°†ç»™éƒ¨å±å—éƒ¨éº’æ¬¡éƒä¸Šå°‰è´Ÿè´£è¿›è¡Œæ”¹è¿›ã€‚å—éƒ¨éº’æ¬¡éƒåªè¿›è¡Œäº†å°æ”¹è‰¯ï¼Œå°†è¡¨å°ºæ”¹ä¸ºç›´ç«‹å¼ï¼Œå¹¶ä¸”åŠ ä¸Šæªæœºç›–ï¼Œå¹¶å‘½åä¸ºä¸‰äº”å¼æµ·å†›æ­¥æªï¼ˆä¸‰åäº”å¹´å¼æµ·å†›é“³ï¼‰ã€‚<br>1904å¹´è‡³1905å¹´æ—¥å†›åœ¨ä¸­å›½ä¸œåŒ—æˆ˜åœºä¸Šä½¿ç”¨çš„ä¸‰åå¹´å¼æ­¥æªè¡¨éœ²å‡ºæœ‰ä¸€ç§ç»†å°çš„æ²™å°˜è¿›å…¥æ“ä½œæœºå…³å†…ï¼Œå¯¼è‡´æ“ä½œä¸è‰¯ï¼Œä¸‰åå¹´å¼æ­¥æªå¦å¤–æœ‰æ ¹å¾ˆå®¹æ˜“æŠ˜æ–­çš„æ’é’ˆã€‚ä¸Šè¿°çš„æƒ…å½¢åœ¨æ—¥ä¿„æˆ˜äº‰åæœ‰äººæå‡ºè®¨è®ºä¸è¿›è¡Œæ”¹å–„ï¼Œè¿™æ—¶å€™å·²ç»å‡ä»»å°çŸ³å·ç‚®å…µå·¥å‚ç ”ç©¶æ‰€æ‰€é•¿çš„å—éƒ¨éº’æ¬¡éƒå› æ­¤å°†æªæœºé‡æ–°è¿›è¡Œç®€åŒ–ï¼ŒåŒæ—¶åœ¨æªæœºè¡¨é¢å¢åŠ äº†ä¸€ä¸ªéšæªæœºè¿åŠ¨çš„é˜²å°˜ç›–ã€‚ç„¶è€Œå¢åŠ é˜²å°˜ç›–çš„ç«‹æ„è™½ç„¶è‰¯å¥½ï¼Œä¸è¿‡å´åˆä¸ºæ“ä½œæ—¶å¢åŠ äº†ç‹¬ç‰¹çš„é‡‘å±å™ªéŸ³ã€‚å…¶ä»–æ”¹è¿›åŒ…æ‹¬åœ¨å‡†æ˜Ÿä¸¤ä¾§å¢åŠ æŠ¤ç¿¼ï¼Œä¸‰å…«å¼æ­¥æªæœºæ¢°ç„å‡†å…·æ—©æœŸé‡‡ç”¨Vå‹ç¼ºå£ç…§é—¨ï¼ŒåæœŸé‡‡ç”¨è§‡å­”å¼ç…§é—¨ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-56-23-046.png" alt=""></p><p>å—éƒ¨å¾ˆå¿«åœ°å®Œæˆä¸‰åå¼æ­¥æªçš„æ”¹è‰¯åï¼Œäºæ˜æ²»å››åå¹´ï¼ˆ1907å¹´ï¼‰5æœˆå¼€å§‹åˆ¶å¼åŒ–åœ¨ä¸œäº¬å°çŸ³å·ç‚®å…µå·¥å‚è¿›è¡Œç”Ÿäº§ã€‚è™½ç„¶æ­£å¼çš„åˆ¶å¼åŒ–é‡äº§ä»1907å¹´å¼€å§‹ï¼Œä¸è¿‡å—éƒ¨éº’æ¬¡éƒå°†æ–°æ”¹è‰¯å¼€å‘çš„æ­¥æªä»ç„¶ä»¥æ˜æ²»å¤©çš‡å¹´å·ç¬¬ä¸‰åå…«å¹´ï¼ˆ1905å¹´ï¼‰å‘½åï¼›æ˜æ²»41å¹´3æœˆå¼€å§‹ï¼Œæ–°å¼çš„ä¸‰å…«å¼æ­©æªé€æ¸æˆä¸ºéƒ¨é˜Ÿçš„æ ‡å‡†é…å¤‡ï¼›åˆ°äº†æ˜æ²»43å¹´ï¼ˆ1910å¹´ï¼‰ï¼Œéƒ¨é˜Ÿä¸­çš„ä¸‰åå¹´å¼æ­¥æªå°±å…¨é¢è¢«ä¸‰å…«å¼æ­¥æªå–ä»£äº†ã€‚</p><h4 id="ç»“æ„ç‰¹ç‚¹-1"><a href="#ç»“æ„ç‰¹ç‚¹-1" class="headerlink" title="ç»“æ„ç‰¹ç‚¹"></a>ç»“æ„ç‰¹ç‚¹</h4><p>ä¸‰å…«å¼æ­¥æªé‡3.73åƒå…‹ï¼ŒåŠ ä¸Š30å¹´å¼åˆºåˆ€ä¸º4.1åƒå…‹ã€‚æªèº«å…¨é•¿127.6å˜ç±³ï¼Œå†åŠ ä¸Š30å¼å•åˆƒåˆºåˆ€åå°±å¯è¾¾166.3å˜ç±³ï¼Œè¯¥æªä¸€å¤§ç‰¹å¾å°±æ˜¯å®ƒçš„é•¿åº¦ã€‚<br>ä¸‰å…«å¼æ­¥æªçš„æœºåŒ£åˆ¶ä½œå…¬å·®å°ï¼Œè¡¨é¢ç»è¿‡é˜²è…å¤„ç†ï¼Œæªæœºåœ¨æœºåŒ£å†…è¿è¡Œé¡ºç•…ï¼ŒæœºåŒ£ä¸Šé¢æœ‰ä¸¤ä¸ªæ’æ°”å°å­”ï¼Œä¿è¯å°„å‡»æ—¶çš„å®‰å…¨ï¼Œæªæœºä¸Šæ–¹æ˜¯æˆªé¢ä¸ºéšç€æªæœºå‰åæ»‘åŠ¨çš„â€œnâ€å‹çš„é˜²å°˜ç›–ï¼Œé˜²å°˜ç›–ä¸Šæœ‰å¼€å£ä¾›ç›´å¼æ‹‰æœºæŸ„ä¼¸å‡ºï¼Œæªæœºå°¾éƒ¨æœ‰åœ†å¸½å‹çš„è½¬åŠ¨ä¿é™©è£…ç½®ã€‚<br>æªæœºç»„ä»¶çš„è®¾è®¡å…¶éƒ¨ä»¶æ•°é‡æ¯”æ¯›ç‘Ÿæªè¿˜å°‘3ä¸ªé›¶ä»¶ï¼Œä»…æœ‰5ä¸ªé›¶ä»¶ï¼Œæ˜¯å½“å¹´æ—‹è½¬åæ‹‰å¼æªæœºæ­¥æªä¸­ç»“æ„ç®€å•çš„ï¼Œæé«˜å¯é æ€§å’Œå‡ä½ç»´æŠ¤ä¿éšœéš¾åº¦ï¼Œä¸è¿‡é›¶ä»¶å¤–å½¢å¤æ‚å¢åŠ äº†åŠ å·¥éš¾åº¦ã€‚<br>ä¸‰å…«å¼æ­¥æªçš„å¼¹ä»“é•¶åµŒåœ¨æªèº«å†…ï¼Œå®¹é‡5å‘å­å¼¹ï¼Œä¸‰å…«å¼æ­¥æªçš„å¼¹ä»“è¿˜æœ‰ç©ºä»“æç¤ºåŠŸèƒ½ï¼Œå½“å¼¹ä»“å†…æœ€åä¸€å‘æªå¼¹å°„å‡ºåï¼Œæªæœºåæ‹‰åˆ°ä½æ—¶æ‰˜å¼¹æ¿å°±ä¼šé¡¶ä½æªæœºå¤´æ— æ³•å‘å‰è¿åŠ¨æé†’å°„æ‰‹è£…å¼¹ã€‚<br>ä¸‰å…«å¼æ­¥æªçš„æªæ‰˜åŠ å·¥æ–¹å¼ä¸çš„ä¸€èˆ¬å¼æ­¥æªæªæ‰˜åŠ å·¥æ–¹å¼ä¸åŒï¼Œä¸€èˆ¬å¼æ­¥æªçš„æªæ‰˜æ˜¯ç”¨ä¸€æ•´å—æœ¨æ–™åˆ‡å‰Šè€Œæˆï¼Œä¸‰å…«å¼æ­¥æªçš„æªæ‰˜æ˜¯ç”¨ä¸¤å—æœ¨æ–™æ‹¼æ¥è€Œæˆçš„ï¼Œæ­¤ç§æ–¹å¼è™½ç„¶æ—¥ä¹…å®¹æ˜“å¼€è£‚ä½†å¯èŠ‚çœæœ¨æã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-56-16-228.png" alt=""></p><table><thead><tr><th>ä¸‰å…«å¼æ­¥æªå‚è€ƒæ•°æ®</th><th></th></tr></thead><tbody><tr><td>ç±»åˆ«</td><td>æ—‹è½¬åæ‹‰å¼æªæœºï¼Œå¼¹ä»“ä¾›å¼¹</td></tr><tr><td>å£å¾„</td><td>6.5æ¯«ç±³</td></tr><tr><td>å…¨æªé•¿</td><td>1275æ¯«ç±³</td></tr><tr><td>æªç®¡é•¿åº¦</td><td>797æ¯«ç±³</td></tr><tr><td>åŠ è£…åˆºåˆ€æ€»é•¿</td><td>æ¥è¿‘1700æ¯«ç±³</td></tr><tr><td>å…¨æªé‡</td><td>4.1åƒå…‹</td></tr><tr><td>å¼¹åŒ£å®¹å¼¹é‡</td><td>5å‘</td></tr><tr><td>å°„ç¨‹</td><td>460ç±³</td></tr><tr><td>å¼¹è¯</td><td>6.5Ã—50mm æ­¥æªå¼¹</td></tr><tr><td>åˆé€Ÿ</td><td>765ç±³/ç§’</td></tr></tbody></table><h3 id="å¡çˆ¾å¡è«¾M91-38"><a href="#å¡çˆ¾å¡è«¾M91-38" class="headerlink" title="å¡çˆ¾å¡è«¾M91/38"></a>å¡çˆ¾å¡è«¾M91/38</h3><p>å¡å°”å¡è¯ºæ˜¯è¿‡å»æ„å¤§åˆ©å¸¸ç”¨çš„æ‰‹åŠ¨æªæœºæ“ä½œå¼ä¸€ç³»åˆ—å†›ç”¨æ­¥æªå’Œå¡å®¾æªï¼Œæœ€åˆäº1891å¹´æ¨å‡ºæ—¶ï¼Œå‘å°„çš„æ˜¯6.5Ã—52æ¯«ç±³æ›¼åˆ©å½»-å¡å°”å¡è¯ºå£å¾„æ— ç¼˜å¼æ­¥æªå­å¼¹ï¼ˆCartuccia Modello 1895ï¼‰ã€‚è¿™ææ­¥æªæ˜¯ç”±é¦–å¸­æŠ€å¸ˆè¨å°”ç“¦å¤šÂ·å¡å°”å¡è¯ºåœ¨éƒ½çµå†›å…µå·¥å‚äº1890å¹´ç ”å‘ï¼Œå¹¶ä¸”ç§°ä¸ºM91ã€‚å®ƒå…ˆåå–ä»£äº†ä»¥å¾€çš„10.35Ã—47æ¯«ç±³RVetterli-ç»´å¡”åˆ©æ­¥æªå’Œå¡å®¾æªä»¥ï¼Œåœ¨1892å¹´åˆ°1945å¹´ä¹‹é—´ç”Ÿäº§ã€‚åœ¨ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜æœŸé—´çš„å¤§å¤šæ•°æ„å¤§åˆ©éƒ¨é˜Ÿå’Œç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜ä¸­çš„æ„å¤§åˆ©ä»¥åŠå¾·å›½å†›é˜Ÿä¹‹ä¸­ä¸€äº›éƒ¨é˜Ÿé‡Œï¼Œé‡‡ç”¨äº†M91çš„æ­¥æªï¼ˆfucile, sing.ï¼›fucili, pl.ï¼‰å’Œå¡å®¾æªï¼ˆmoschetto, sing.ï¼›moschetti, pl.ï¼‰å„ä¸¤ç§çš„å‹å·ã€‚åœ¨è¿‡ç¨‹ä¸­ï¼Œæ­¥æªä¹Ÿè¢«èŠ¬å…°äºå†¬å­£æˆ˜äº‰ä¸­ä½¿ç”¨ï¼Œä»¥ååˆåœ¨å™åˆ©äºšã€åˆ©æ¯”äºšã€çªå°¼æ–¯å’Œé˜¿å°”åŠåˆ©äºšè¿™äº›å›½å®¶æˆ˜åçš„å„ç§å†²çªä¸­è¢«æ­£è§„å’Œéæ­£è§„éƒ¨é˜Ÿä½¿ç”¨ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-37-47-677.png" alt="å¡çˆ¾å¡è«¾M91/38"></p><p>è™½ç„¶è¿™ç§æ­¥æªç»å¸¸è¢«ç§°ä¸ºâ€œæ›¼åˆ©å½»-å¡å°”å¡è¯ºâ€ï¼ˆç‰¹åˆ«æ˜¯åœ¨ç¾å›½çš„è¯´æ³•ï¼‰ï¼Œä½†ä¸è®ºæ˜¯è¯¥å‘½åè¿˜æ˜¯â€œæ¯›ç‘Ÿ-å¸•æ‹‰ç»´è¥¿å°¼â€ï¼ˆMauser-Parravicinoï¼‰ä¹Ÿä¸æ˜¯æ­£ç¡®çš„ã€‚è¯¥æªåœ¨æ„å¤§åˆ©çš„æ­£å¼åç§°æ˜¯Modello 1891ï¼Œæˆ–æ˜¯M91ï¼ˆâ€œil novantunoâ€ï¼‰ã€‚è¯¥æªçš„å¼¹åŒ£ç³»ç»Ÿä½¿ç”¨æ•´ä½“æ¼å¤¹å¼å¼¹å¤¹æ¡æ¥è£…å¡«ï¼Œè™½ç„¶æœ€åˆæ˜¯ç”±è´¹è¿ªå—å¾·Â·æ›¼åˆ©å½»ç ”å‘å¹¶è·å¾—äº†ä¸“åˆ©ï¼Œä½†äº‹å®ä¸Šå¡å°”å¡è¯ºæ­¥æªçš„å¼¹å¤¹æ¡çš„å®é™…å½¢çŠ¶å’Œè®¾è®¡æ˜¯ç”±å¾·å›½1888å¼å§”å‘˜ä¼šæ­¥æªæ‰€å¾—å‡ºçš„ã€‚</p><p>ç›´åˆ°1938å¹´ï¼Œæ‰€æœ‰çš„M91æ­¥æªå’Œå¡å®¾æªéƒ½æ”¹ä¸ºå‘å°„çš„æ˜¯6.5Ã—52æ¯«ç±³æ›¼åˆ©å½»-å¡å°”å¡è¯ºå£å¾„æ— ç¼˜å¼Modello 1895æ­¥æªå­å¼¹ï¼Œé‡‡ç”¨é‡é‡ä¸º160æ ¼ä»¤çš„åœ†å¤´é‡‘å±å¼¹å£³å­å¼¹ï¼Œè§†ä¹æªç®¡é•¿åº¦è€Œä»¤æªå£åˆé€Ÿåœ¨609.6â€”755 ç±³ï¼ç§’ï¼ˆ2,000â€”2,477.03 è‹±å°ºï¼ç§’ï¼‰ä¹‹é—´ã€‚ç”±äºé‡‡ç”¨æ¸è¿›è†›çº¿ï¼ˆè†›çº¿è¶Šæ¥è¿‘æªå£ç¼ è·è¶ŠçŸ­ï¼Œæ•ˆæœæ˜¯å¼¹å¤´è½¬é€Ÿè¶Šæ¥è¶Šå¿«ï¼‰ï¼Œè¯¥æªç²¾åº¦è‰¯å¥½ã€‚ä¸è¿‡ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªè½»æ­¦å™¨çš„æƒå¨æŒ‡å‡ºï¼Œä¸€äº›æ‰¹å·çš„6.5Ã—52 æ¯«ç±³å†›ç”¨å¼¹è¯è£…è½½çš„æ˜¯å¹¶éä¸€è‡´çš„ç«è¯ç±»å‹ï¼Œç»å¸¸å°†ä¸åŒçš„ç«è¯ç±»å‹å’Œå¼¹è¯æ‰¹å·æ··åˆå¹¶ä¸”åˆ¶ä½œæˆä¸ºå•ä¸€çš„å¼¹è¯ï¼ˆå¯èƒ½æ˜¯å‡ºäºæˆ˜æ—¶æˆæœ¬æ§åˆ¶çš„åŸå› ï¼Œäº¦å¯èƒ½æ˜¯ç”Ÿäº§æ··ä¹±æ‰€å¯¼è‡´ï¼‰ã€‚[1]åœ¨ç»è¿‡ä¿®æ”¹çš„æ­¥æªå¼¹è¯ä¸Šæ··ç”¨ç«è¯ç±»å‹å’Œå¼¹è¯æ‰¹å·çš„åšæ³•ä¸ºæ™®éå…¶ä»–å›½å®¶çš„å…µå·¥å‚æ‰€æåŠ›é¿å…çš„äº‹ï¼Œå› ä¸ºè¿™ç§ç²—åŠ£æ‰‹æ³•é€šå¸¸ä¼šå¯¼è‡´å­å¼¹åˆé€Ÿä¸åŒå’Œå­å¼¹ä¸ç›®æ ‡è¿‡åº¦åˆ†æ•£ã€‚</p><p>æˆ˜äº‰æµ·æŠ¥ä¸­çš„å¦‡å¥³æ‰‹ä¸­çš„å°±æ˜¯ä¸€æŠŠå¡å°”å¡è¯ºm1938æŠ˜å åˆºåˆ€å‹ï¼š</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/257e852f07082838f137e094be99a9014c08f17d.jpg" alt="æˆ˜äº‰æµ·æŠ¥ä¸­çš„å¦‡å¥³æ‰‹ä¸­çš„å°±æ˜¯ä¸€æŠŠå¡å°”å¡è¯ºm1938æŠ˜å åˆºåˆ€å‹"></p><h3 id="ç½—æ–¯Mk-3"><a href="#ç½—æ–¯Mk-3" class="headerlink" title="ç½—æ–¯Mk-3"></a>ç½—æ–¯Mk-3</h3><p>ç½—æ–¯Mk-3æ˜¯åŠ æ‹¿å¤§è¿œå¾å†›çš„æ­¦å™¨ï¼Œç¬¬ä¸€æ”¯ç½—æ–¯æ­¥æªå‡ºç°äº1896å¹´ï¼Œå®ƒåœ¨é£å’Œæ—¥ä¸½çš„åŠ æ‹¿å¤§è¡¨ç°å¾ˆå¥½ï¼Œä»¥ç²¾åº¦è€Œé—»åï¼Œå®ƒçš„è®¾è®¡è€…ç½—æ–¯çˆµå£«æ˜¯ä¸€ä¸ªç¥å°„æ‰‹ï¼Œå®ƒå¯¹è‡ªå·±çš„æªè¦æ±‚å¾ˆé«˜ï¼Œè¦æœ‰ä¼˜ç§€çš„ç²¾åº¦å’Œå¿«é€Ÿçš„å°„é€Ÿï¼Œè€Œä¸”ä¸¥æ ¼æ§åˆ¶å…¬å·®ï¼Œäºæ˜¯è¿™æŠŠæªé‡‡ç”¨äº†ç›´æ‹‰æŸ„è®¾è®¡ï¼Œä¸ä¼ ç»Ÿçš„æ‰‹æ‹‰æ—‹è½¬å¼æ­¥æªæ­¥æªï¼Œè¿™æŠŠæªä»…ä»…éœ€è¦ä¸€å‰ä¸€åå°±å¯ä»¥å®ŒæˆæŠ›å£³ï¼Œé€€å¼¹ï¼Œé—­é”çš„æ­¥éª¤ï¼Œå°„é€Ÿè¾ƒå½“æ—¶çš„æ­¥æªæ›´å¿«</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-38-00-214.png" alt="ç½—æ–¯Mk-3"></p><h3 id="M1917-Enfield"><a href="#M1917-Enfield" class="headerlink" title="M1917 Enfield"></a>M1917 Enfield</h3><p>æ©è²å°”å¾·M1917ï¼ˆM1917 Enfieldï¼ŒåˆåP17ã€P1917æˆ–Pattern 1917ï¼‰æ˜¯â€œç¾å›½æ©è²å°”å¾·â€ï¼ˆAmerican Enfieldï¼‰äº1917è‡³1918å¹´é—´ç”Ÿäº§çš„.30-06å£å¾„æ‰‹åŠ¨æ­¥æªï¼Œè£…å¤‡ä¸€æˆ˜æ—¶æœŸçš„ç¾å›½å†›é˜Ÿï¼Œç¾å›½å½“æ—¶å‘½åä¸ºUnited States Rifle, cal .30, Model of 1917ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-20-38-09-586.png" alt="M1917 Enfield"></p><h4 id="å†å²-2"><a href="#å†å²-2" class="headerlink" title="å†å²"></a>å†å²</h4><p>å½“è‹±å›½åŠ å…¥ä¸€æˆ˜æ—¶ï¼Œå…¶ç›Ÿå‹ç¾å›½æ€¥éœ€æœ¬åœŸç”Ÿäº§çš„æ­¥æªä½œå†›å¤‡ï¼Œå½“æ—¶çš„æ¸©å½»æ–¯ç‰¹åŠé›·æ˜ç™»è·é€‰å¹¶ç”Ÿäº§M1914æ­¥æªï¼ˆP14ï¼‰ã€‚å…¶åï¼Œç¾å›½å‚æˆ˜åéœ€è¦æ›´å¤šæ­¥æªï¼Œç¾å›½å†›æ¢°ç½²æå‡ºé‡‡ç”¨.30-06å£ä¿“å¼¹è¯çš„æ–°å‹æ­¥æªM1917ï¼ˆP17ï¼‰ï¼Œå¹¶ç”±ä½äºåº·ä¹ƒç‹„å…‹å·çº½é»‘æ–‡çš„æ¸©å½»æ–¯ç‰¹å·¥å‚åŠä½äºåº·ä¹ƒè¿ªå…‹å·Eddystoneå’Œçº½çº¦Ilionçš„é›·æ˜ç™»å·¥å‚ç”Ÿäº§ï¼Œè€Œä¸“ç”¨çš„M1917åˆºåˆ€ç”±å…¶ä»–å¤šé—´å°å‚ç”Ÿäº§ã€‚ </p><p>M1917åŠM1903æ˜¥ç”°æ­¥æªä½œä¸ºä¸€æˆ˜æ—¶ç¾å†›çš„ä¸»è¦åˆ¶å¼æ­¥æªæœå½¹ã€‚åœ¨1918å¹´11æœˆ11æ—¥ï¼Œçº¦75%çš„ç¾å›½è¿œå¾å†›ï¼ˆAmerican Expeditionary Forceï¼‰éƒ½è£…å¤‡äº†M1917ã€‚åœæˆ˜åï¼Œç¾å†›æŠŠM1917ä½œå‚¨å¤‡å‚¨èµ·ã€‚<br>åœ¨äºŒæˆ˜å¼€å§‹åˆæœŸï¼Œç¾å›½æŠŠå‚¨å¤‡èµ·æ¥çš„M1917é‡æ–°æ”¹é€ ï¼Œå¹¶ä½œè®­ç»ƒç”¨é€”åŠé€šè¿‡ç§Ÿå€Ÿæ³•æ¡ˆå‘å¤šä¸ªå›½å®¶ä½œå‡ºæ´åŠ©ï¼ˆåŒ…æ‹¬è‹±å›½ã€è²å¾‹å®¾ã€æ³•å›½åŠä¸­å›½ï¼‰ï¼Œè¿™æ‰¹M1917æ­¥æªä½œå–·æ²™åŠçƒ˜ç£·é…¸ç›å¤„ç†ï¼Œéƒ¨ä»½æ›´æ”¹ç”¨æ¡¦æœ¨åˆ¶çš„æŠ¤æœ¨ï¼Œå…¶ä¸­é€äº¤è‹±å›½çš„å›½åœŸé˜²å«å†›ï¼ˆBritish Home Guardï¼‰çš„M1917å°æœ‰çº¢è‰²è®°å·ä»¥é¿å…å£«å…µè£…ä¸ŠP14çš„å¼¹è¯ã€‚</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/bf1-19-21-05-48-076.png" alt="M1917 Enfield"></p><h4 id="ç»“æ„è®¾è®¡"><a href="#ç»“æ„è®¾è®¡" class="headerlink" title="ç»“æ„è®¾è®¡"></a>ç»“æ„è®¾è®¡</h4><p>M1917ä¸æ-æ©è²å°”å¾·åŒç”±ä½äºè‹±å›½æ©è²å°”å¾·çš„è‹±å›½çš‡å®¶è½»å…µå™¨å·¥å‚ç”Ÿäº§ï¼Œä½†æ-æ©è²å°”å¾·ï¼ˆå¦‚SMLEï¼‰é‡‡ç”¨.303 Britishå£ä¿“å¼¹è¯ï¼Œè€ŒM1917é‡‡ç”¨æ¯›ç‘Ÿ98æªæœºåŠç¾å›½çš„.30-06å¼¹è¯ï¼Œç”±äº.30-06å¼¹è¯çš„ç›´å¾„è¾ƒç»†ï¼Œå› æ­¤å†…ç½®å¼¹ä»“å¯æ”¾6å‘å­å¼¹ï¼Œä½†å¼¹å¤¹ä»ç„¶åªæœ‰5å‘ã€‚<br>ç”±äºä¸¤æˆ˜ä¹‹é—´å‚¨å¤‡è¿‡å‰©ï¼Œæœ‰äº›æªåŒ ä»¥M1917çš„æªæœºè£…ä¸Šé›·æ˜ç™»M30ç³»åˆ—ä¸Šä½œè¿åŠ¨æ­¥æªå‘å”®ï¼Œçº¦3000æŠŠ7æ¯«ç±³å£å¾„çš„M1917åœ¨1930å¹´å–ç»™æ´ªéƒ½æ‹‰æ–¯ã€‚</p><h3 id="1-59-inch-Breech-Loading-Vickers-Q-F-Gun-Mk-II"><a href="#1-59-inch-Breech-Loading-Vickers-Q-F-Gun-Mk-II" class="headerlink" title="1.59-inch Breech-Loading Vickers Q.F. Gun, Mk II"></a>1.59-inch Breech-Loading Vickers Q.F. Gun, Mk II</h3><p>1.59-inch Breech-Loading Vickers Q.F. Gun, Mk IIæ˜¯è‹±å›½è®¾è®¡åœ¨ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜çš„è½»ç«ç‚®ï¼ˆè¶…é‡å‹ç‹™å‡»æªï¼‰ã€‚æœ€åˆçš„ç›®çš„æ˜¯ç”¨äºå ‘å£•æˆ˜ï¼Œè€Œæ˜¯å¯¹é£æœºçš„ç©ºå¯¹ç©ºå’Œç©ºå¯¹åœ°ä½¿ç”¨è¿›è¡Œäº†æµ‹è¯•ã€‚è™½ç„¶å®ƒå‘å°„ç‚®å¼¹å¹¶ä¸”æ— æ³•å‘å°„ç«ç®­å¼¹ï¼Œä½†å®ƒè¢«å¹¿æ³›ä½†è¯¯å¯¼åœ°ç§°ä¸ºâ€œ ç»´å…‹æ–¯ - å…‹é›·ç¦å¾·ç«ç®­ç‚® â€ã€‚</p><p>ï¼ˆæ¸¸æˆä¸­æœªå‡ºç°ï¼Œæ— å›¾ï¼‰</p><h3 id="Mauser-1918-T-Gewehr"><a href="#Mauser-1918-T-Gewehr" class="headerlink" title="Mauser 1918 T-Gewehr"></a>Mauser 1918 T-Gewehr</h3><p>æ¯›ç‘Ÿ13æ¯«ç±³åå¦å…‹æ­¥æªï¼ˆå¾·è¯­ï¼šTankgewehr M1918ï¼Œé€šå¸¸ç®€å†™T-Gewehr M1918ï¼‰æ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªåå¦å…‹æ­¥æªï¼Œå®ƒè®¾è®¡ç”¨äºç ´åè£…ç”²ç›®æ ‡ã€‚ç”Ÿäº§äº†å¤§çº¦15,800ä¸ªã€‚</p><p>M1918å’ŒçœŸäººæ¯”ä½ å°±ä¼šå‘ç°å®ƒéå¸¸éå¸¸å¤§ï¼</p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/f64bd0d3572c11dfea79a28d6b2762d0f603c202.jpg" alt="M1918å’ŒçœŸäººæ¯”ä½ å°±ä¼šå‘ç°å®ƒéå¸¸éå¸¸å¤§"></p><p>è¿™æŠŠæ¥è‡ªé»‘ç§‘æŠ€åˆé›†ä½“ç¬¬äºŒå¸å›½çš„T-Gewehr M1918 åå¦å…‹æ­¥æªå½“æ—¶è®©è‹±å†›å¦å…‹éƒ¨é˜Ÿèº²åœ¨è§’è½ç‘Ÿç‘Ÿå‘æŠ–ï¼Œåœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ç”šè‡³å¯ä»¥è½»æ¾ç©¿é€100må¤–çš„MK-IVå¦å…‹çš„é˜²æŠ¤è£…ç”²ï¼ŒåŒæ—¶è¿™æŠŠæ­¦å™¨åªæ˜¯æ¯”æ™®é€šçš„æ¯›ç‘Ÿæ­¥æªç¨å¾®å¤§ä¸€ç‚¹ï¼Œæ‰€ä»¥ä¸€ä¸ªäººä¹Ÿå¯ä»¥æ‹¿ç€åˆ°å¤„èµ°ï¼Œåªæ˜¯æ¯”å…¶ä»–äººä¼šç¼“æ…¢ä¸€äº›ã€‚ </p><p><img src="/2018/08/19/ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¥æª/6641752c11dfa9ecce864bb96ad0f703908fc102.jpg" alt="T-Gewehr M1918"></p><h4 id="å†å²-3"><a href="#å†å²-3" class="headerlink" title="å†å²"></a>å†å²</h4><p>åœ¨ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜æœŸé—´ï¼Œé™æ€å ‘å£•æˆ˜çš„å¼€å§‹å‡ºç°äº†ä½¿ç”¨è£…ç”²æ¿è¿›è¡Œäººèº«é˜²å¾¡çš„å…´èµ·ï¼Œä»¥åŠå¼€å‘å’Œä½¿ç”¨ç©¿ç”²å¼¹è¯æ¥å¯¹æŠ—è¿™ç§æƒ…å†µã€‚ä¸ºæ­¤ï¼Œè‹±å›½å’Œå¾·å›½éƒ½ä½¿ç”¨é«˜èƒ½æ­¥æªï¼Œä¾‹å¦‚æ¥è‡ªéæ´²æ®–æ°‘åœ°çš„å¤§è±¡æªã€‚è‹±å›½äººåœ¨1916å¹´9æœˆçš„Flers-Courceletteæˆ˜å½¹ä¸­é¦–æ¬¡ä½¿ç”¨è£…ç”²æˆ˜è½¦ï¼ˆå¦å…‹ï¼‰ï¼Œéšåæ˜¯æ³•å›½äººã€‚åˆ°1917å¹´6æœˆï¼Œå¾·å›½é™†å†›é¢å¯¹é©¬å…‹å››ä¸–å¦å…‹ï¼Œå‘ç°æ ‡å‡†ç©¿ç”²7.92æ¯«ç±³Kå­å¼¹ä¸å†æœ‰æ•ˆã€‚è¿™ä¿ƒä½¿å¾·å›½äººå¼€å‘å‡ºä¸€ç§å¤§å£å¾„å’Œé«˜é€Ÿæ­¥æªä½œä¸ºåå¦å…‹æ­¦å™¨ã€‚è¯¥æ¯›ç‘Ÿå…¬å¸å›åº”ä¸13æ¯«ç±³T-æ ¼éŸ¦å°”å¹¶å¼€å§‹æ‰¹é‡ç”Ÿäº§çš„å†…å¡æ²³ç•”å¥¥ä¼¯æ©å¤šå¤«äº1918å¹´äº”æœˆå…³é—­è¿›è¡Œé¢å‘çš„ç”Ÿäº§çº¿ä¸“é—¨æå‡ºåå¦å…‹åˆ†é˜Ÿçš„ç¬¬ä¸€é¡¹ã€‚</p><h4 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h4><p>è¯¥æ­¥æªæ˜¯ä¸€ç§å•å‘èºæ “åŠ¨ä½œæ­¥æªï¼Œä½¿ç”¨æ”¹è¿›çš„æ¯›ç‘ŸåŠ¨ä½œï¼Œæ‰‹åŠ¨å°†åœ†å½¢ç‰©è£…å…¥è…”å®¤ã€‚æ­¦å™¨æœ‰ä¸€ä¸ªæ‰‹æªå¼æ¡æŠŠå’Œä¸¤è„šæ¶ï¼Œä½†æ²¡æœ‰å‡å°‘åååŠ›çš„æ–¹æ³•ï¼Œä¾‹å¦‚æŸ”è½¯çš„è‡€éƒ¨æˆ–æªå£åˆ¶åŠ¨å™¨ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´é‡å¤å°„å‡»å°„æ‰‹çš„é—®é¢˜ã€‚åœ¨é“çš„æ™¯ç‚¹æ˜¯ç”±å‰ç‰‡å’Œååˆ‡çº¿çš„ï¼Œåœ¨100ç±³çš„å¢é‡ä»100ç±³åˆ°500ç±³æ¯•ä¸šã€‚è¿™æ”¯æ­¥æªç”±ä¸¤åæŒæªæ‰‹å’Œå¼¹è¯çš„æœºç»„äººå‘˜æ“ä½œæŒç¥¨äººï¼Œä»–ä»¬éƒ½å—è¿‡è®­ç»ƒï¼Œå¯ä»¥å¼€ç«ã€‚ç”±äºåå†²çš„å·¨å¤§é’åŠ›ï¼Œå®ƒè¢«è®¾è®¡æˆåœ¨é™æ­¢ä½ç½®æ‹æ‘„ï¼Œæ— è®ºæ˜¯ä¿¯å§è¿˜æ˜¯ä»æ²Ÿå†…ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.forgottenweapons.com/rifles/winchester-1895-russian/" target="_blank" rel="noopener">Winchester 1895 (Russian)</a></p><p><a href="http://battlefield.wikia.com/wiki/Gewehr_M._95" target="_blank" rel="noopener">Gewehr M.95</a></p><p><a href="https://tieba.baidu.com/p/4111204618?red_tag=2660865922" target="_blank" rel="noopener">å¡å°”å¡è¯º</a></p><p><a href="https://en.wikipedia.org/wiki/1.59-inch_Breech-Loading_Vickers_Q.F._Gun,_Mk_II" target="_blank" rel="noopener">1.59-inch Breech-Loading Vickers Q.F. Gun, Mk II</a></p><p><a href="https://en.wikipedia.org/wiki/Mauser_1918_T-Gewehr" target="_blank" rel="noopener">Mauser 1918 T-Gewehr</a></p><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©æˆ‘ä»¬ä¸èŠæŠ€æœ¯äº†ï¼ŒèŠä¸€èŠæªæ”¯ã€‚æˆ‘æœ¬äººæ˜¯ä¸ªç‹‚çƒ­çš„å†›äº‹è¿·ï¼Œè€Œæ°å¥½æœ€è¿‘æ‰¾åˆ°ä¸€æ¬¾æ¸¸æˆï¼Œæ˜¯ä¸€æˆ˜é¢˜æçš„ï¼Œå«â€˜æˆ˜åœ°1â€™ï¼ŒåŸæ±åŸå‘³çš„ä¸€æˆ˜æ­¦å™¨çš„åŠ å…¥ï¼Œè®©è¿™ä¸ªæœ¬æ¥å°±å¾ˆå¼ºåŠ¿çš„ç¬¬ä¸€äººç§°å°„å‡»æ¸¸æˆå¢æ·»äº†ç‹¬ç‰¹é­…åŠ›ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œä»Šå¤©æˆ‘ä»¥è¿™ä¸ªæ¸¸æˆä¸­çš„ä¸€æˆ˜è§†è§’ï¼Œæ¥ä»‹ç»ä»¥ä¸‹ä¸€æˆ˜ä¸­çš„åˆ¶å¼æ­¦å™¨ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³
      
    
    </summary>
    
    
      <category term="å†›äº‹" scheme="https://tengshe789.github.io/tags/%E5%86%9B%E4%BA%8B/"/>
    
  </entry>
  
  <entry>
    <title>python-å¸¸ç”¨æ¨¡å—</title>
    <link href="https://tengshe789.github.io/2018/08/19/python-%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/"/>
    <id>https://tengshe789.github.io/2018/08/19/python-å¸¸ç”¨æ¨¡å—/</id>
    <published>2018-08-19T08:12:18.000Z</published>
    <updated>2019-11-20T13:39:40.737Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å­¦ä¹ pythonå…¨æ ˆç›¸å…³çš„å†…å®¹ï¼Œéƒ¨åˆ†çŸ¥è¯†ç‚¹ç€å®éœ€è¦è®°å¿†ï¼Œç´¢æ€§å†™ä¸ªblogè®°å½•ä¸€ä¸‹ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h3 id="ä»€ä¹ˆæ˜¯æ¨¡å—"><a href="#ä»€ä¹ˆæ˜¯æ¨¡å—" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¨¡å—"></a>ä»€ä¹ˆæ˜¯æ¨¡å—</h3><p>ä¸€ä¸ªæ¨¡å—å°±æ˜¯ä¸€ä¸ªåŒ…å«äº†pythonå®šä¹‰å’Œå£°æ˜çš„æ–‡ä»¶ï¼Œæ–‡ä»¶åå°±æ˜¯æ¨¡å—åå­—åŠ ä¸Š<code>.py</code>çš„åç¼€ã€‚ </p><h2 id="å¸¸ç”¨æ¨¡å—"><a href="#å¸¸ç”¨æ¨¡å—" class="headerlink" title="å¸¸ç”¨æ¨¡å—"></a>å¸¸ç”¨æ¨¡å—</h2><h3 id="collectionsæ¨¡å—"><a href="#collectionsæ¨¡å—" class="headerlink" title="collectionsæ¨¡å—"></a>collectionsæ¨¡å—</h3><p>åœ¨å†…ç½®æ•°æ®ç±»å‹ï¼ˆdictã€listã€setã€tupleï¼‰çš„åŸºç¡€ä¸Šï¼Œcollectionsæ¨¡å—è¿˜æä¾›äº†å‡ ä¸ªé¢å¤–çš„æ•°æ®ç±»å‹ï¼šCounterã€dequeã€defaultdictã€namedtupleå’ŒOrderedDictç­‰ã€‚</p><h4 id="namedtuple"><a href="#namedtuple" class="headerlink" title="namedtuple"></a>namedtuple</h4><p>ç”Ÿæˆå¯ä»¥ä½¿ç”¨åå­—æ¥è®¿é—®å…ƒç´ å†…å®¹çš„tuple</p><p>ä½¿ç”¨è¿™ä¸ªå¯ä»¥å¾ˆæ–¹ä¾¿çš„è¡¨ç¤ºä¸€ä¸ªç‚¹çš„äºŒç»´åæ ‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Point = namedtuple(<span class="string">'Point'</span>,[<span class="string">'x'</span>,<span class="string">'y'</span>]) <span class="comment">#namedtuple('åç§°', [å±æ€§list])</span></span><br><span class="line">p = Point(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">print(p.x)</span><br><span class="line">print(p.y)</span><br></pre></td></tr></table></figure><h4 id="deque"><a href="#deque" class="headerlink" title="deque:"></a>deque:</h4><p>dequeæ˜¯ä¸ºäº†é«˜æ•ˆå®ç°æ’å…¥å’Œåˆ é™¤æ“ä½œçš„åŒå‘åˆ—è¡¨ï¼Œé€‚åˆç”¨äºé˜Ÿåˆ—å’Œæ ˆ</p><p>å®ƒå¯ä»¥å®ç°æ·»åŠ æ“ä½œ<code>append()</code> å’Œåˆ é™¤æ“ä½œ<code>pop()</code>ï¼Œå¾€å¤´éƒ¨æ·»åŠ æ“ä½œ<code>appendleft()</code>å¾€å¤´éƒ¨åˆ é™¤<code>popleft()</code></p><h4 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h4><p>Counterç±»çš„ç›®çš„æ˜¯ç”¨æ¥è·Ÿè¸ªå€¼å‡ºç°çš„æ¬¡æ•°ã€‚</p><p>å®ƒæ˜¯ä¸€ä¸ªæ— åºçš„å®¹å™¨ç±»å‹ï¼Œ<strong>ä»¥å­—å…¸çš„é”®å€¼å¯¹å½¢å¼å­˜å‚¨</strong>ï¼Œå…¶ä¸­å…ƒç´ ä½œä¸ºkeyï¼Œå…¶è®¡æ•°ä½œä¸ºvalueã€‚è®¡æ•°å€¼å¯ä»¥æ˜¯ä»»æ„çš„Intergerï¼ˆåŒ…æ‹¬0å’Œè´Ÿæ•°ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="comment"># åˆ›å»º</span></span><br><span class="line">c = Counter(&#123;<span class="number">1</span>:<span class="string">'p'</span>,<span class="number">2</span>:<span class="string">'y'</span>&#125;)</span><br><span class="line"><span class="comment"># è®¿é—® å½“æ‰€è®¿é—®çš„é”®ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›0ï¼Œè€Œä¸æ˜¯KeyErrorï¼›å¦åˆ™è¿”å›å®ƒçš„è®¡æ•°ã€‚</span></span><br><span class="line">c[<span class="number">1</span>] <span class="comment"># p</span></span><br></pre></td></tr></table></figure><h4 id="OrderedDict"><a href="#OrderedDict" class="headerlink" title="OrderedDict"></a>OrderedDict</h4><p>æœ‰åºå­—å…¸</p><h4 id="defaultdict"><a href="#defaultdict" class="headerlink" title="defaultdict"></a>defaultdict</h4><p>å¸¦æœ‰é»˜è®¤å€¼çš„å­—å…¸</p><p>æœ‰å¦‚ä¸‹å€¼é›†åˆ [11,22,33,44,55,66,77,88,99,90â€¦]ï¼Œå°†æ‰€æœ‰å¤§äº 66 çš„å€¼ä¿å­˜è‡³å­—å…¸çš„ç¬¬ä¸€ä¸ªkeyä¸­ï¼Œå°†å°äº 66 çš„å€¼ä¿å­˜è‡³ç¬¬äºŒä¸ªkeyçš„å€¼ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">values = [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>,<span class="number">77</span>,<span class="number">88</span>,<span class="number">99</span>,<span class="number">90</span>]</span><br><span class="line">defaultdict = defaultdict(list)</span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> values:</span><br><span class="line">    <span class="keyword">if</span> value &gt; <span class="number">66</span>:</span><br><span class="line">        defaultdict[<span class="string">'k1'</span>].append(value)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        defaultdict[<span class="string">'k2'</span>].append(value)</span><br></pre></td></tr></table></figure><h3 id="timeæ¨¡å—"><a href="#timeæ¨¡å—" class="headerlink" title="timeæ¨¡å—"></a>timeæ¨¡å—</h3><p>åœ¨Pythonä¸­ï¼Œé€šå¸¸æœ‰è¿™ä¸‰ç§æ–¹å¼æ¥è¡¨ç¤ºæ—¶é—´ï¼šæ—¶é—´æˆ³ã€å…ƒç»„(struct_time)ã€æ ¼å¼åŒ–çš„æ—¶é—´å­—ç¬¦ä¸²ï¼š</p><p>(1)æ—¶é—´æˆ³(timestamp) ï¼šé€šå¸¸æ¥è¯´ï¼Œæ—¶é—´æˆ³è¡¨ç¤ºçš„æ˜¯ä»1970å¹´1æœˆ1æ—¥00:00:00å¼€å§‹æŒ‰ç§’è®¡ç®—çš„åç§»é‡ã€‚æˆ‘ä»¬è¿è¡Œâ€œtype(time.time())â€ï¼Œè¿”å›çš„æ˜¯floatç±»å‹ã€‚</p><p>(2)æ ¼å¼åŒ–çš„æ—¶é—´å­—ç¬¦ä¸²(Format String)ï¼š â€˜1999-12-06â€™</p><p>pythonä¸­æ—¶é—´æ—¥æœŸæ ¼å¼åŒ–ç¬¦å·ï¼š</p><p>%y ä¸¤ä½æ•°çš„å¹´ä»½è¡¨ç¤ºï¼ˆ00-99ï¼‰<br>%Y å››ä½æ•°çš„å¹´ä»½è¡¨ç¤ºï¼ˆ000-9999ï¼‰<br>%m æœˆä»½ï¼ˆ01-12ï¼‰<br>%d æœˆå†…ä¸­çš„ä¸€å¤©ï¼ˆ0-31ï¼‰<br>%H 24å°æ—¶åˆ¶å°æ—¶æ•°ï¼ˆ0-23ï¼‰<br>%I 12å°æ—¶åˆ¶å°æ—¶æ•°ï¼ˆ01-12ï¼‰<br>%M åˆ†é’Ÿæ•°ï¼ˆ00=59ï¼‰<br>%S ç§’ï¼ˆ00-59ï¼‰<br>%a æœ¬åœ°ç®€åŒ–æ˜ŸæœŸåç§°<br>%A æœ¬åœ°å®Œæ•´æ˜ŸæœŸåç§°<br>%b æœ¬åœ°ç®€åŒ–çš„æœˆä»½åç§°<br>%B æœ¬åœ°å®Œæ•´çš„æœˆä»½åç§°<br>%c æœ¬åœ°ç›¸åº”çš„æ—¥æœŸè¡¨ç¤ºå’Œæ—¶é—´è¡¨ç¤º<br>%j å¹´å†…çš„ä¸€å¤©ï¼ˆ001-366ï¼‰<br>%p æœ¬åœ°A.M.æˆ–P.M.çš„ç­‰ä»·ç¬¦<br>%U ä¸€å¹´ä¸­çš„æ˜ŸæœŸæ•°ï¼ˆ00-53ï¼‰æ˜ŸæœŸå¤©ä¸ºæ˜ŸæœŸçš„å¼€å§‹<br>%w æ˜ŸæœŸï¼ˆ0-6ï¼‰ï¼Œæ˜ŸæœŸå¤©ä¸ºæ˜ŸæœŸçš„å¼€å§‹<br>%W ä¸€å¹´ä¸­çš„æ˜ŸæœŸæ•°ï¼ˆ00-53ï¼‰æ˜ŸæœŸä¸€ä¸ºæ˜ŸæœŸçš„å¼€å§‹<br>%x æœ¬åœ°ç›¸åº”çš„æ—¥æœŸè¡¨ç¤º<br>%X æœ¬åœ°ç›¸åº”çš„æ—¶é—´è¡¨ç¤º<br>%Z å½“å‰æ—¶åŒºçš„åç§°<br>%% %å·æœ¬èº«</p><p>(3)å…ƒç»„(struct_time) ï¼šstruct_timeå…ƒç»„å…±æœ‰9ä¸ªå…ƒç´ å…±ä¹ä¸ªå…ƒç´ :(å¹´ï¼Œæœˆï¼Œæ—¥ï¼Œæ—¶ï¼Œåˆ†ï¼Œç§’ï¼Œä¸€å¹´ä¸­ç¬¬å‡ å‘¨ï¼Œä¸€å¹´ä¸­ç¬¬å‡ å¤©ç­‰ï¼‰</p><table><thead><tr><th>ç´¢å¼•ï¼ˆIndexï¼‰</th><th>å±æ€§ï¼ˆAttributeï¼‰</th><th>å€¼ï¼ˆValuesï¼‰</th></tr></thead><tbody><tr><td>0</td><td>tm_yearï¼ˆå¹´ï¼‰</td><td>æ¯”å¦‚2011</td></tr><tr><td>1</td><td>tm_monï¼ˆæœˆï¼‰</td><td>1 - 12</td></tr><tr><td>2</td><td>tm_mdayï¼ˆæ—¥ï¼‰</td><td>1 - 31</td></tr><tr><td>3</td><td>tm_hourï¼ˆæ—¶ï¼‰</td><td>0 - 23</td></tr><tr><td>4</td><td>tm_minï¼ˆåˆ†ï¼‰</td><td>0 - 59</td></tr><tr><td>5</td><td>tm_secï¼ˆç§’ï¼‰</td><td>0 - 60</td></tr><tr><td>6</td><td>tm_wdayï¼ˆweekdayï¼‰</td><td>0 - 6ï¼ˆ0è¡¨ç¤ºå‘¨ä¸€ï¼‰</td></tr><tr><td>7</td><td>tm_ydayï¼ˆä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼‰</td><td>1 - 366</td></tr><tr><td>8</td><td>tm_isdstï¼ˆæ˜¯å¦æ˜¯å¤ä»¤æ—¶ï¼‰</td><td>é»˜è®¤ä¸º0</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯¼å…¥æ—¶é—´æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># (çº¿ç¨‹)æ¨è¿ŸæŒ‡å®šçš„æ—¶é—´è¿è¡Œã€‚å•ä½ä¸ºç§’ã€‚</span></span><br><span class="line">secs = <span class="number">0.1</span></span><br><span class="line">time.sleep(secs)</span><br><span class="line"><span class="comment"># æ—¶é—´æˆ³</span></span><br><span class="line">time.time()</span><br><span class="line"><span class="comment"># æ—¶é—´å­—ç¬¦ä¸²</span></span><br><span class="line">time.strftime(<span class="string">"%Y-%m-%d %X"</span>)</span><br><span class="line">&gt;&gt;&gt;time.strftime(<span class="string">"%Y-%m-%d %H-%M-%S"</span>)</span><br><span class="line"><span class="comment"># æ—¶é—´å…ƒç»„:localtimeå°†ä¸€ä¸ªæ—¶é—´æˆ³è½¬æ¢ä¸ºå½“å‰æ—¶åŒºçš„struct_time</span></span><br><span class="line">time.localtime()</span><br><span class="line">time.struct_time(tm_year=<span class="number">2018</span>, tm_mon=<span class="number">8</span>, tm_mday=<span class="number">19</span>,tm_hour=<span class="number">13</span>, tm_min=<span class="number">59</span>, tm_sec=<span class="number">37</span>,tm_wday=<span class="number">0</span>, tm_yday=<span class="number">205</span>, tm_isdst=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="randomæ¨¡å—"><a href="#randomæ¨¡å—" class="headerlink" title="randomæ¨¡å—"></a>randomæ¨¡å—</h3><p>å¸¸ç”¨æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> random</span><br><span class="line"><span class="comment">#éšæœºå°æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.random()      <span class="comment"># å¤§äº0ä¸”å°äº1ä¹‹é—´çš„å°æ•°</span></span><br><span class="line"><span class="number">0.7664338663654585</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.uniform(<span class="number">1</span>,<span class="number">3</span>) <span class="comment">#å¤§äº1å°äº3çš„å°æ•°</span></span><br><span class="line"><span class="number">1.6270147180533838</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#éšæœºæ•´æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.randint(<span class="number">1</span>,<span class="number">5</span>)  <span class="comment"># å¤§äºç­‰äº1ä¸”å°äºç­‰äº5ä¹‹é—´çš„æ•´æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.randrange(<span class="number">1</span>,<span class="number">10</span>,<span class="number">2</span>) <span class="comment"># å¤§äºç­‰äº1ä¸”å°äº10ä¹‹é—´çš„å¥‡æ•°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#éšæœºé€‰æ‹©ä¸€ä¸ªè¿”å›</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.choice([<span class="number">1</span>,<span class="string">'23'</span>,[<span class="number">4</span>,<span class="number">5</span>]])  <span class="comment"># #1æˆ–è€…23æˆ–è€…[4,5]</span></span><br><span class="line"><span class="comment">#éšæœºé€‰æ‹©å¤šä¸ªè¿”å›ï¼Œè¿”å›çš„ä¸ªæ•°ä¸ºå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.sample([<span class="number">1</span>,<span class="string">'23'</span>,[<span class="number">4</span>,<span class="number">5</span>]],<span class="number">2</span>) <span class="comment"># #åˆ—è¡¨å…ƒç´ ä»»æ„2ä¸ªç»„åˆ</span></span><br><span class="line">[[<span class="number">4</span>, <span class="number">5</span>], <span class="string">'23'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰“ä¹±åˆ—è¡¨é¡ºåº</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>item=[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.shuffle(item) <span class="comment"># æ‰“ä¹±æ¬¡åº</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>item</span><br><span class="line">[<span class="number">5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.shuffle(item)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>item</span><br><span class="line">[<span class="number">5</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªç®€å•çš„ç”ŸæˆéªŒè¯ç åŠŸèƒ½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="comment"># éšæœºç”Ÿæˆ6ä½éªŒè¯ç </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Identifying_code</span><span class="params">()</span>:</span></span><br><span class="line">    code = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">        num=random.randint(<span class="number">0</span>,<span class="number">9</span>) <span class="comment"># å¤§äºç­‰äº0ä¸”å°äºç­‰äº9ä¹‹é—´çš„æ•´æ•°</span></span><br><span class="line">        alf=chr(random.randint(<span class="number">65</span>,<span class="number">90</span>)) <span class="comment"># éšæœºå¤§å†™å­—æ¯ï¼Œæ•°å­—å¯¹åº”é˜¿æ–¯å…‹ç </span></span><br><span class="line">        add=random.choice([num,alf]) <span class="comment">#éšæœºé€‰æ‹©ä¸€ä¸ªè¿”å›</span></span><br><span class="line">        code=<span class="string">""</span>.join([code,str(add)])</span><br><span class="line">    <span class="keyword">return</span> code</span><br></pre></td></tr></table></figure><h3 id="osæ¨¡å—"><a href="#osæ¨¡å—" class="headerlink" title="osæ¨¡å—"></a>osæ¨¡å—</h3><h4 id="å¸¸ç”¨å’Œä¸å¸¸ç”¨çš„æ–¹æ³•"><a href="#å¸¸ç”¨å’Œä¸å¸¸ç”¨çš„æ–¹æ³•" class="headerlink" title="å¸¸ç”¨å’Œä¸å¸¸ç”¨çš„æ–¹æ³•"></a>å¸¸ç”¨å’Œä¸å¸¸ç”¨çš„æ–¹æ³•</h4><p><code>os.getcwd()</code>è·å–å½“å‰å·¥ä½œç›®å½•ï¼Œå³å½“å‰pythonè„šæœ¬å·¥ä½œçš„ç›®å½•è·¯å¾„<br><code>os.chdir(&quot;dirname&quot;)</code>  æ”¹å˜å½“å‰è„šæœ¬å·¥ä½œç›®å½•ï¼›ç›¸å½“äºshellä¸‹cd<br><code>os.curdir</code>è¿”å›å½“å‰ç›®å½•: (â€˜.â€™)<br><code>os.pardir</code> è·å–å½“å‰ç›®å½•çš„çˆ¶ç›®å½•å­—ç¬¦ä¸²åï¼š(â€˜..â€™)<br><code>os.makedirs(&#39;dirname1/dirname2&#39;)</code>å¯ç”Ÿæˆå¤šå±‚é€’å½’ç›®å½•<br><code>os.removedirs(&#39;dirname1&#39;)</code> è‹¥ç›®å½•ä¸ºç©ºï¼Œåˆ™åˆ é™¤ï¼Œå¹¶é€’å½’åˆ°ä¸Šä¸€çº§ç›®å½•ï¼Œå¦‚è‹¥ä¹Ÿä¸ºç©ºï¼Œåˆ™åˆ é™¤ï¼Œä¾æ­¤ç±»æ¨<br><code>os.mkdir(&#39;dirname&#39;)</code>   ç”Ÿæˆå•çº§ç›®å½•ï¼›ç›¸å½“äºshellä¸­mkdir dirname<br><code>os.rmdir(&#39;dirname&#39;)</code>  åˆ é™¤å•çº§ç©ºç›®å½•ï¼Œè‹¥ç›®å½•ä¸ä¸ºç©ºåˆ™æ— æ³•åˆ é™¤ï¼ŒæŠ¥é”™ï¼›ç›¸å½“äºshellä¸­rmdir dirname<br><code>os.listdir(&#39;dirname&#39;)</code>   åˆ—å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ï¼Œå¹¶ä»¥åˆ—è¡¨æ–¹å¼æ‰“å°<br><code>os.remove()</code> åˆ é™¤ä¸€ä¸ªæ–‡ä»¶<br><code>os.rename(&quot;oldname&quot;,&quot;newname&quot;)</code>é‡å‘½åæ–‡ä»¶/ç›®å½•<br><code>os.stat(&#39;path/filename&#39;)</code> è·å–æ–‡ä»¶/ç›®å½•ä¿¡æ¯<br><code>os.sep</code>    è¾“å‡ºæ“ä½œç³»ç»Ÿç‰¹å®šçš„è·¯å¾„åˆ†éš”ç¬¦ï¼Œwinä¸‹ä¸ºâ€\â€œ,Linuxä¸‹ä¸ºâ€/â€œ<br><code>os.linesep</code>  è¾“å‡ºå½“å‰å¹³å°ä½¿ç”¨çš„è¡Œç»ˆæ­¢ç¬¦ï¼Œwinä¸‹ä¸ºâ€\t\nâ€,Linuxä¸‹ä¸ºâ€\nâ€<br><code>os.pathsep</code>    è¾“å‡ºç”¨äºåˆ†å‰²æ–‡ä»¶è·¯å¾„çš„å­—ç¬¦ä¸² winä¸‹ä¸º;,Linuxä¸‹ä¸º:<br><code>os.name</code>   è¾“å‡ºå­—ç¬¦ä¸²æŒ‡ç¤ºå½“å‰ä½¿ç”¨å¹³å°ã€‚win-&gt;â€™ntâ€™; Linux-&gt;â€™posixâ€™<br><code>os.system(&quot;bash command&quot;)</code>  è¿è¡Œshellå‘½ä»¤ï¼Œç›´æ¥æ˜¾ç¤º<br><code>os.popen(&quot;bash command).read()</code>  è¿è¡Œshellå‘½ä»¤ï¼Œè·å–æ‰§è¡Œç»“æœ<br><code>os.environ</code> è·å–ç³»ç»Ÿç¯å¢ƒå˜é‡</p><p><strong>os.path</strong><br><code>os.path.abspath(path)</code> è¿”å›pathè§„èŒƒåŒ–çš„ç»å¯¹è·¯å¾„ os.path.split(path) å°†pathåˆ†å‰²æˆç›®å½•å’Œæ–‡ä»¶åäºŒå…ƒç»„è¿”å› <code>os.path.dirname(path)</code>è¿”å›pathçš„ç›®å½•ã€‚å…¶å®å°±æ˜¯os.path.split(path)çš„ç¬¬ä¸€ä¸ªå…ƒç´  </p><p><code>os.path.basename(path)</code> è¿”å›pathæœ€åçš„æ–‡ä»¶åã€‚å¦‚ä½•pathä»¥/æˆ–\ç»“å°¾ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›ç©ºå€¼ã€‚å³os.path.split(path)çš„ç¬¬äºŒä¸ªå…ƒç´ <br><code>os.path.exists(path)</code> å¦‚æœpathå­˜åœ¨ï¼Œè¿”å›Trueï¼›å¦‚æœpathä¸å­˜åœ¨ï¼Œè¿”å›False<br><code>os.path.isabs(path)</code> å¦‚æœpathæ˜¯ç»å¯¹è·¯å¾„ï¼Œè¿”å›True<br><code>os.path.isfile(path)</code>  å¦‚æœpathæ˜¯ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œè¿”å›Trueã€‚å¦åˆ™è¿”å›False<br><code>os.path.isdir(path)</code> å¦‚æœpathæ˜¯ä¸€ä¸ªå­˜åœ¨çš„ç›®å½•ï¼Œåˆ™è¿”å›Trueã€‚å¦åˆ™è¿”å›False<br><code>os.path.join(path1[, path2[, ...]])</code> å°†å¤šä¸ªè·¯å¾„ç»„åˆåè¿”å›ï¼Œç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„ä¹‹å‰çš„å‚æ•°å°†è¢«å¿½ç•¥<br><code>os.path.getatime(path)</code>  è¿”å›pathæ‰€æŒ‡å‘çš„æ–‡ä»¶æˆ–è€…ç›®å½•çš„æœ€åè®¿é—®æ—¶é—´<br><code>os.path.getmtime(path)</code>  è¿”å›pathæ‰€æŒ‡å‘çš„æ–‡ä»¶æˆ–è€…ç›®å½•çš„æœ€åä¿®æ”¹æ—¶é—´<br><code>os.path.getsize(path)</code> è¿”å›pathçš„å¤§å°</p><h3 id="sysæ¨¡å—"><a href="#sysæ¨¡å—" class="headerlink" title="sysæ¨¡å—"></a>sysæ¨¡å—</h3><p>sysæ¨¡å—æ˜¯ä¸pythonè§£é‡Šå™¨äº¤äº’çš„ä¸€ä¸ªæ¥å£</p><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><p> <code>sys.argv</code>           å‘½ä»¤è¡Œå‚æ•°Listï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ç¨‹åºæœ¬èº«è·¯å¾„<br> <code>sys.exit(n)</code>        é€€å‡ºç¨‹åºï¼Œæ­£å¸¸é€€å‡ºæ—¶exit(0),é”™è¯¯é€€å‡ºsys.exit(1)<br> <code>sys.version</code>        è·å–Pythonè§£é‡Šç¨‹åºçš„ç‰ˆæœ¬ä¿¡æ¯<br> <code>sys.path</code>           è¿”å›æ¨¡å—çš„æœç´¢è·¯å¾„ï¼Œåˆå§‹åŒ–æ—¶ä½¿ç”¨PYTHONPATHç¯å¢ƒå˜é‡çš„å€¼<br> <code>sys.platform</code>       è¿”å›æ“ä½œç³»ç»Ÿå¹³å°åç§°</p><h3 id="åºåˆ—åŒ–æ¨¡å—"><a href="#åºåˆ—åŒ–æ¨¡å—" class="headerlink" title="åºåˆ—åŒ–æ¨¡å—"></a>åºåˆ—åŒ–æ¨¡å—</h3><p>ç”¨äºåºåˆ—åŒ–çš„ä¸¤ä¸ªæ¨¡å—</p><ul><li>jsonï¼Œç”¨äºå­—ç¬¦ä¸² å’Œ pythonæ•°æ®ç±»å‹é—´è¿›è¡Œè½¬æ¢</li><li>pickleï¼Œç”¨äºpythonç‰¹æœ‰çš„ç±»å‹ å’Œ pythonçš„æ•°æ®ç±»å‹é—´è¿›è¡Œè½¬æ¢</li></ul><h4 id="Json"><a href="#Json" class="headerlink" title="Json"></a>Json</h4><p>loadså’Œdumps</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">dic = &#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>,<span class="string">'k3'</span>:<span class="string">'v3'</span>&#125;</span><br><span class="line">str_dic = json.dumps(dic)  <span class="comment">#åºåˆ—åŒ–ï¼šå°†ä¸€ä¸ªå­—å…¸è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">print(type(str_dic),str_dic)  <span class="comment">#&lt;class 'str'&gt; &#123;"k3": "v3", "k1": "v1", "k2": "v2"&#125;</span></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼Œjsonè½¬æ¢å®Œçš„å­—ç¬¦ä¸²ç±»å‹çš„å­—å…¸ä¸­çš„å­—ç¬¦ä¸²æ˜¯ç”±""è¡¨ç¤ºçš„</span></span><br><span class="line"></span><br><span class="line">dic2 = json.loads(str_dic)  <span class="comment">#ååºåˆ—åŒ–ï¼šå°†ä¸€ä¸ªå­—ç¬¦ä¸²æ ¼å¼çš„å­—å…¸è½¬æ¢æˆä¸€ä¸ªå­—å…¸</span></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼Œè¦ç”¨jsonçš„loadsåŠŸèƒ½å¤„ç†çš„å­—ç¬¦ä¸²ç±»å‹çš„å­—å…¸ä¸­çš„å­—ç¬¦ä¸²å¿…é¡»ç”±""è¡¨ç¤º</span></span><br><span class="line">print(type(dic2),dic2)  <span class="comment">#&lt;class 'dict'&gt; &#123;'k1': 'v1', 'k2': 'v2', 'k3': 'v3'&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">list_dic = [<span class="number">1</span>,[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>],<span class="number">3</span>,&#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>&#125;]</span><br><span class="line">str_dic = json.dumps(list_dic) <span class="comment">#ä¹Ÿå¯ä»¥å¤„ç†åµŒå¥—çš„æ•°æ®ç±»å‹ </span></span><br><span class="line">print(type(str_dic),str_dic) <span class="comment">#&lt;class 'str'&gt; [1, ["a", "b", "c"], 3, &#123;"k1": "v1", "k2": "v2"&#125;]</span></span><br><span class="line">list_dic2 = json.loads(str_dic)</span><br><span class="line">print(type(list_dic2),list_dic2) <span class="comment">#&lt;class 'list'&gt; [1, ['a', 'b', 'c'], 3, &#123;'k1': 'v1', 'k2': 'v2'&#125;]</span></span><br></pre></td></tr></table></figure><p>loadå’Œdump</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">f = open(<span class="string">'json_file'</span>,<span class="string">'w'</span>)</span><br><span class="line">dic = &#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>,<span class="string">'k3'</span>:<span class="string">'v3'</span>&#125;</span><br><span class="line">json.dump(dic,f)  <span class="comment">#dumpæ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œç›´æ¥å°†å­—å…¸è½¬æ¢æˆjsonå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶</span></span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'json_file'</span>)</span><br><span class="line">dic2 = json.load(f)  <span class="comment">#loadæ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œç›´æ¥å°†æ–‡ä»¶ä¸­çš„jsonå­—ç¬¦ä¸²è½¬æ¢æˆæ•°æ®ç»“æ„è¿”å›</span></span><br><span class="line">f.close()</span><br><span class="line">print(type(dic2),dic2)</span><br></pre></td></tr></table></figure><h4 id="shelve"><a href="#shelve" class="headerlink" title="shelve"></a>shelve</h4><p>shelveä¹Ÿæ˜¯pythonæä¾›ç»™æˆ‘ä»¬çš„åºåˆ—åŒ–å·¥å…·ï¼Œæ¯”pickleç”¨èµ·æ¥æ›´ç®€å•ä¸€äº›ã€‚ shelveåªæä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªopenæ–¹æ³•ï¼Œæ˜¯ç”¨keyæ¥è®¿é—®çš„ï¼Œä½¿ç”¨èµ·æ¥å’Œå­—å…¸ç±»ä¼¼ã€‚</p><h3 id="reæ¨¡å—"><a href="#reæ¨¡å—" class="headerlink" title="reæ¨¡å—"></a>reæ¨¡å—</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ret = re.findall(<span class="string">'s'</span>, <span class="string">'sadsadsa ssadsadsa sdadsadasd'</span>)  <span class="comment"># è¿”å›æ‰€æœ‰æ»¡è¶³åŒ¹é…æ¡ä»¶çš„ç»“æœ,æ”¾åœ¨åˆ—è¡¨é‡Œ</span></span><br><span class="line">print(ret) <span class="comment">#ç»“æœ : ['s', 's', 's', 's', 's', 's', 's', 's', 's', 's']</span></span><br><span class="line"></span><br><span class="line">ret = re.search(<span class="string">'s'</span>, <span class="string">'sadsadsa ssadsadsa sdadsadasd'</span>).group()</span><br><span class="line">print(ret) <span class="comment"># ç»“æœ : s</span></span><br><span class="line"><span class="comment"># å‡½æ•°ä¼šåœ¨å­—ç¬¦ä¸²å†…æŸ¥æ‰¾æ¨¡å¼åŒ¹é…,åªåˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…ç„¶åè¿”å›ä¸€ä¸ªåŒ…å«åŒ¹é…ä¿¡æ¯çš„å¯¹è±¡,è¯¥å¯¹è±¡å¯ä»¥</span></span><br><span class="line"><span class="comment"># é€šè¿‡è°ƒç”¨group()æ–¹æ³•å¾—åˆ°åŒ¹é…çš„å­—ç¬¦ä¸²,å¦‚æœå­—ç¬¦ä¸²æ²¡æœ‰åŒ¹é…ï¼Œåˆ™è¿”å›Noneã€‚</span></span><br><span class="line"></span><br><span class="line">ret = re.match(<span class="string">'a'</span>, <span class="string">'abc'</span>).group()  <span class="comment"># åŒsearch,ä¸è¿‡å°½åœ¨å­—ç¬¦ä¸²å¼€å§‹å¤„è¿›è¡ŒåŒ¹é…</span></span><br><span class="line">print(ret)</span><br><span class="line"><span class="comment">#ç»“æœ : 'a'</span></span><br><span class="line"></span><br><span class="line">ret = re.split(<span class="string">'[ab]'</span>, <span class="string">'abcd'</span>)  <span class="comment"># å…ˆæŒ‰'a'åˆ†å‰²å¾—åˆ°''å’Œ'bcd',åœ¨å¯¹''å’Œ'bcd'åˆ†åˆ«æŒ‰'b'åˆ†å‰²</span></span><br><span class="line">print(ret)  <span class="comment"># ['', '', 'cd']</span></span><br><span class="line"></span><br><span class="line">ret = re.sub(<span class="string">'\d'</span>, <span class="string">'H'</span>, <span class="string">'teng she 789'</span>, <span class="number">1</span>)<span class="comment">#å°†æ•°å­—æ›¿æ¢æˆ'H'ï¼Œå‚æ•°1è¡¨ç¤ºåªæ›¿æ¢1ä¸ª</span></span><br><span class="line">print(ret) <span class="comment"># teng she H89</span></span><br><span class="line"></span><br><span class="line">ret = re.subn(<span class="string">'\d'</span>, <span class="string">'H'</span>, <span class="string">'teng she 789'</span>)<span class="comment">#å°†æ•°å­—æ›¿æ¢æˆ'H'ï¼Œè¿”å›å…ƒç»„(æ›¿æ¢çš„ç»“æœ,æ›¿æ¢äº†å¤šå°‘æ¬¡)</span></span><br><span class="line">print(ret) <span class="comment">#('teng she HHH', 3)</span></span><br><span class="line"></span><br><span class="line">obj = re.compile(<span class="string">'\d&#123;3&#125;'</span>)  <span class="comment">#å°†æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘æˆä¸ºä¸€ä¸ª æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œè§„åˆ™è¦åŒ¹é…çš„æ˜¯3ä¸ªæ•°å­—</span></span><br><span class="line">ret = obj.search(<span class="string">'abc123eeee'</span>) <span class="comment">#æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡è°ƒç”¨searchï¼Œå‚æ•°ä¸ºå¾…åŒ¹é…çš„å­—ç¬¦ä¸²</span></span><br><span class="line">print(ret.group())  <span class="comment">#ç»“æœ ï¼š 123</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.finditer(<span class="string">'\d'</span>, <span class="string">'ds3sy4784a'</span>)   <span class="comment">#finditerè¿”å›ä¸€ä¸ªå­˜æ”¾åŒ¹é…ç»“æœçš„è¿­ä»£å™¨</span></span><br><span class="line">print(ret)  <span class="comment"># &lt;callable_iterator object at 0x000001B84AADC7F0&gt;</span></span><br><span class="line">print(next(ret).group())  <span class="comment">#æŸ¥çœ‹ç¬¬ä¸€ä¸ªç»“æœ 3</span></span><br><span class="line">print(next(ret).group())  <span class="comment">#æŸ¥çœ‹ç¬¬äºŒä¸ªç»“æœ 4</span></span><br><span class="line">print([i.group() <span class="keyword">for</span> i <span class="keyword">in</span> ret])  <span class="comment">#æŸ¥çœ‹å‰©ä½™çš„å·¦å³ç»“æœ ['7', '8', '4']</span></span><br></pre></td></tr></table></figure><h3 id="hashlibæ¨¡å—"><a href="#hashlibæ¨¡å—" class="headerlink" title="hashlibæ¨¡å—"></a>hashlibæ¨¡å—</h3><p>Pythonçš„hashlibæä¾›äº†å¸¸è§çš„hashç®—æ³•</p><p>æˆ‘ä»¬ä»¥å¸¸è§çš„æ‘˜è¦ç®—æ³•MD5ä¸ºä¾‹ï¼Œè®¡ç®—å‡ºä¸€ä¸ªå­—ç¬¦ä¸²çš„MD5å€¼ï¼š </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">md5 = hashlib.md5()</span><br><span class="line">md5.update(<span class="string">'how to use md5 in python hashlib?'</span>.encode(<span class="string">"gb2312"</span>))</span><br><span class="line">print(md5.hexdigest())</span><br></pre></td></tr></table></figure><p>è®¡ç®—ç»“æœå¦‚ä¸‹ï¼š<br>d26a53750bc40b38b65a520292f69306</p><h3 id="configparseræ¨¡å—"><a href="#configparseræ¨¡å—" class="headerlink" title="configparseræ¨¡å—"></a>configparseræ¨¡å—</h3><p>è¯¥æ¨¡å—é€‚ç”¨äºé…ç½®æ–‡ä»¶çš„æ ¼å¼ä¸windows iniæ–‡ä»¶ç±»ä¼¼ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ï¼ˆsectionï¼‰ï¼Œæ¯ä¸ªèŠ‚å¯ä»¥æœ‰å¤šä¸ªå‚æ•°ï¼ˆé”®=å€¼ï¼‰ã€‚</p><h3 id="loggingæ¨¡å—"><a href="#loggingæ¨¡å—" class="headerlink" title="loggingæ¨¡å—"></a>loggingæ¨¡å—</h3><p>é»˜è®¤æƒ…å†µä¸‹Pythonçš„loggingæ¨¡å—å°†æ—¥å¿—æ‰“å°åˆ°äº†æ ‡å‡†è¾“å‡ºä¸­ï¼Œä¸”åªæ˜¾ç¤ºäº†å¤§äºç­‰äºWARNINGçº§åˆ«çš„æ—¥å¿—ï¼Œè¿™è¯´æ˜é»˜è®¤çš„æ—¥å¿—çº§åˆ«è®¾ç½®ä¸ºWARNINGï¼ˆæ—¥å¿—çº§åˆ«ç­‰çº§CRITICAL &gt; ERROR &gt; WARNING &gt; INFO &gt; DEBUGï¼‰ï¼Œé»˜è®¤çš„æ—¥å¿—æ ¼å¼ä¸ºæ—¥å¿—çº§åˆ«ï¼šLoggeråç§°ï¼šç”¨æˆ·è¾“å‡ºæ¶ˆæ¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging  </span><br><span class="line">logging.debug(<span class="string">'debug message'</span>)  </span><br><span class="line">logging.info(<span class="string">'info message'</span>)  </span><br><span class="line">logging.warning(<span class="string">'warning message'</span>)  </span><br><span class="line">logging.error(<span class="string">'error message'</span>)  </span><br><span class="line">logging.critical(<span class="string">'critical message'</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘åœ¨å­¦ä¹ pythonå…¨æ ˆç›¸å…³çš„å†…å®¹ï¼Œéƒ¨åˆ†çŸ¥è¯†ç‚¹ç€å®éœ€è¦è®°å¿†ï¼Œç´¢æ€§å†™ä¸ªblogè®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.tech/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æˆ‘
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="python" scheme="https://tengshe789.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>åº”ç”¨è½¯ä»¶è£…åœ¨Cç›˜é‡Œä¼šè®©ç³»ç»Ÿå˜æ…¢ä¹ˆï¼Ÿ</title>
    <link href="https://tengshe789.github.io/2018/08/16/%E5%BA%94%E7%94%A8%E8%BD%AF%E4%BB%B6%E8%A3%85%E5%9C%A8C%E7%9B%98%E9%87%8C%E4%BC%9A%E8%AE%A9%E7%B3%BB%E7%BB%9F%E5%8F%98%E6%85%A2%E4%B9%88%EF%BC%9F/"/>
    <id>https://tengshe789.github.io/2018/08/16/åº”ç”¨è½¯ä»¶è£…åœ¨Cç›˜é‡Œä¼šè®©ç³»ç»Ÿå˜æ…¢ä¹ˆï¼Ÿ/</id>
    <published>2018-08-16T11:31:27.000Z</published>
    <updated>2019-11-20T13:39:41.268Z</updated>
    
    <content type="html"><![CDATA[<p>8012å¹´äº†ï¼ŒğŸŒè¿˜åœ¨è½¬ï¼Œä½†æ˜¯å¥½å¤šé¡½å›ºçš„äººğŸ§ ä¸è½¬äº†ï¼Œæ‰€ä»¥ä»Šå¤©å°±æœ‰äº†â€œåº”ç”¨è½¯ä»¶è£…åœ¨Cç›˜é‡Œä¼šè®©ç³»ç»Ÿå˜æ…¢ä¹ˆâ€è¿™ä¸ªè¯é¢˜ã€‚</p><h3 id="ä¸ºå•¥äººä»¬æœ‰æŠŠè½¯ä»¶è£…åœ¨Cç›˜ä¹‹å¤–çš„ä¹ æƒ¯ï¼Ÿ"><a href="#ä¸ºå•¥äººä»¬æœ‰æŠŠè½¯ä»¶è£…åœ¨Cç›˜ä¹‹å¤–çš„ä¹ æƒ¯ï¼Ÿ" class="headerlink" title="ä¸ºå•¥äººä»¬æœ‰æŠŠè½¯ä»¶è£…åœ¨Cç›˜ä¹‹å¤–çš„ä¹ æƒ¯ï¼Ÿ"></a>ä¸ºå•¥äººä»¬æœ‰æŠŠè½¯ä»¶è£…åœ¨Cç›˜ä¹‹å¤–çš„ä¹ æƒ¯ï¼Ÿ</h3><p>è¿™çœŸçš„æ˜¯ä¸€ä¸ªè¿œå¤æ—¶ä»£é—ç•™ä¸‹æ¥çš„ä¹ æƒ¯ã€‚</p><p>è¿‡å»çš„ç”µè„‘çš„ç¡¬ä»¶é…ç½®å¯ä¸å¦‚ç°åœ¨çš„è¿™ä¹ˆå¥½ï¼Œå½“æ—¶çš„ç¡¬ç›˜å¯èƒ½åªæœ‰10Gï¼Œå†…å­˜åˆ™å¯èƒ½åªæœ‰128Mï¼ŒæŠŠ10Gçš„ç¡¬ç›˜åˆ’ä¸ºCç›˜ï¼Œè£…è¿›å»ä¸€ä¸ªç³»ç»Ÿï¼Œå‰©ä¸‹çš„ç©ºé—´å°±ä¸å¤ªå¤šäº†ï¼Œæ‰€ä»¥å°±æœ‰äº†æŠŠè½¯ä»¶æ”¾åœ¨åˆ«çš„ç£ç›˜é‡Œé¢çš„ä¹ æƒ¯</p><p>å†åŠ ä¸Šè¿‡å»çš„ç”µè„‘æ€§èƒ½æ¯”è¾ƒå·®ï¼ŒæŠ€æœ¯è½åï¼Œæ…¢æ…¢å°±æœ‰æŠŠè½¯ä»¶è£…åœ¨cç›˜ä¼šå¡è¿™ç§è¯¯åŒº</p><h3 id="åº”ç”¨è½¯ä»¶è£…åœ¨Cç›˜é‡Œä¼šè®©ç³»ç»Ÿå˜æ…¢ä¹ˆï¼Ÿ"><a href="#åº”ç”¨è½¯ä»¶è£…åœ¨Cç›˜é‡Œä¼šè®©ç³»ç»Ÿå˜æ…¢ä¹ˆï¼Ÿ" class="headerlink" title="åº”ç”¨è½¯ä»¶è£…åœ¨Cç›˜é‡Œä¼šè®©ç³»ç»Ÿå˜æ…¢ä¹ˆï¼Ÿ"></a>åº”ç”¨è½¯ä»¶è£…åœ¨Cç›˜é‡Œä¼šè®©ç³»ç»Ÿå˜æ…¢ä¹ˆï¼Ÿ</h3><p>ä¸ä¼šçš„ï¼Œå…„å¼Ÿï¼Œå¤§æ›¼ã€‚</p><p>ç°åœ¨å¤§éƒ¨åˆ†äººç”¨çš„æœºæ¢°ç¡¬ç›˜HDDæ˜¯è¿™æ ·çš„ğŸ‘‡</p><p><img src="/2018/08/16/åº”ç”¨è½¯ä»¶è£…åœ¨Cç›˜é‡Œä¼šè®©ç³»ç»Ÿå˜æ…¢ä¹ˆï¼Ÿ/0fae02e21e8919383d2bf56fe5a18dba.jpg" alt="img"> </p><p> ç¡¬ç›˜æœ€æ ¸å¿ƒçš„éƒ¨ä»¶æ˜¯åƒå…‰ç›˜é‚£æ ·çš„ç£ç›˜å’Œè¿ç€å…‰ç›˜çš„ç£å¤´</p><p>å…¶ä¸­ï¼Œç£ç›˜æ˜¯ç”¨æ¥å­˜æ”¾æ•°æ®çš„ï¼Œç£å¤´æ˜¯ç”¨æ¥è¯»å–æ•°æ®çš„ã€‚</p><p>å†è¯´è¯´ç³»ç»Ÿåˆ†åŒºï¼Œæ­£å¸¸çš„æ–¹æ³•åˆ†åŒºçš„è¯ï¼ŒCç›˜åœ¨ç£ç›˜ç›˜ç‰‡ä¸Šçš„ä½ç½®åº”è¯¥æ˜¯é è¿‘å¤–åœˆçš„ï¼Œå¤–åœˆå› ä¸ºå‘¨é•¿æ¯”è¾ƒå¤§ï¼Œè¿™å°±å¯¼è‡´äº†ç£å¤´åœ¨ç›¸åŒæ—¶é—´å†…ï¼Œè¯»å–çš„æ•°æ®çš„æ€§èƒ½ä¹Ÿå¾ˆé«˜ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>å¯¹æœºæ¢°ç¡¬ç›˜æ¥è¯´ï¼ŒæŠŠåº”ç”¨è½¯ä»¶è£…åœ¨Cç›˜ï¼Œéä½†ä¸ä¼šè®©ç³»ç»Ÿå˜å¡ï¼Œåè€Œä¼šè®©åº”ç”¨è½¯ä»¶è¿è¡Œå¾—æ›´å¿«ã€‚</strong> </p><p>è¿˜æœ‰å¾ˆå¤šå°ä¼™ä¼´ç”¨å›ºæ€ç¡¬ç›˜SSDï¼ŒæŠŠåº”ç”¨è½¯ä»¶è£…åœ¨å“ªä¸ªåˆ†åŒºè¿è¡Œé€Ÿåº¦éƒ½å·®ä¸å¤šã€‚ </p><h3 id="å¦‚ä½•è®©ç¬”è®°æœ¬å¼€æœºä¸å†å¡é¡¿"><a href="#å¦‚ä½•è®©ç¬”è®°æœ¬å¼€æœºä¸å†å¡é¡¿" class="headerlink" title="å¦‚ä½•è®©ç¬”è®°æœ¬å¼€æœºä¸å†å¡é¡¿"></a>å¦‚ä½•è®©ç¬”è®°æœ¬å¼€æœºä¸å†å¡é¡¿</h3><p>è¯·çœ‹è¿™é‡Œ<a href="https://blog.tengshe789.tech/2018/08/16/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%BC%80%E6%9C%BA%E4%B8%8D%E5%9C%A8%E5%8D%A1%E9%A1%BF/#more" target="_blank" rel="noopener">https://blog.tengshe789.tech/2018/08/16/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%BC%80%E6%9C%BA%E4%B8%8D%E5%9C%A8%E5%8D%A1%E9%A1%BF/#more</a></p><h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><p>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;8012å¹´äº†ï¼ŒğŸŒè¿˜åœ¨è½¬ï¼Œä½†æ˜¯å¥½å¤šé¡½å›ºçš„äººğŸ§ ä¸è½¬äº†ï¼Œæ‰€ä»¥ä»Šå¤©å°±æœ‰äº†â€œåº”ç”¨è½¯ä»¶è£…åœ¨Cç›˜é‡Œä¼šè®©ç³»ç»Ÿå˜æ…¢ä¹ˆâ€è¿™ä¸ªè¯é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä¸ºå•¥äººä»¬æœ‰æŠŠè½¯ä»¶è£…åœ¨Cç›˜ä¹‹å¤–çš„ä¹ æƒ¯ï¼Ÿ&quot;&gt;&lt;a href=&quot;#ä¸ºå•¥äººä»¬æœ‰æŠŠè½¯ä»¶è£…åœ¨Cç›˜ä¹‹å¤–çš„ä¹ æƒ¯ï¼Ÿ&quot; class=&quot;headerlink
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="ç¡¬ä»¶" scheme="https://tengshe789.github.io/tags/%E7%A1%AC%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•è®©ç¬”è®°æœ¬å¼€æœºä¸å†å¡é¡¿</title>
    <link href="https://tengshe789.github.io/2018/08/16/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%BC%80%E6%9C%BA%E4%B8%8D%E5%9C%A8%E5%8D%A1%E9%A1%BF/"/>
    <id>https://tengshe789.github.io/2018/08/16/å¦‚ä½•è®©å¼€æœºä¸åœ¨å¡é¡¿/</id>
    <published>2018-08-16T11:09:58.000Z</published>
    <updated>2019-11-20T13:39:41.256Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘è€æœ‰å°ä¼™ä¼´QQç§èŠæˆ‘ï¼šâ€œç„¶å“¥ç„¶å“¥ï¼Œæˆ‘ç”µè„‘å¡ï¼Œæ€ä¹ˆåŠï¼Ÿâ€</p><p>æˆ‘å°±å›å¤ï¼Œè¿˜èƒ½æ€ä¹ˆåŠå•Šï¼Œç™¾åº¦å»</p><p>ç„¶åå¯¹é¢åˆæ¥è¯äº†ï¼Œâ€œç„¶å“¥ç„¶å“¥ï¼Œæˆ‘ä¸ä¼šæœï¼Œå’‹åŠå•Šï¼Ÿâ€</p><p>æˆ‘ï¼š</p><p><img src="/2018/08/16/å¦‚ä½•è®©å¼€æœºä¸åœ¨å¡é¡¿/1534417908608.png" alt="1534417908608"></p><p>é‚£ä¹ˆå‡ å¤©æˆ‘å°±åˆ†äº«ä¸€ä¸‹ï¼Œæˆ‘è®¾ç½®win10 PCçš„å°çªé—¨</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h3 id="é™ä½æ˜¾ç¤ºæ•ˆæœ"><a href="#é™ä½æ˜¾ç¤ºæ•ˆæœ" class="headerlink" title="é™ä½æ˜¾ç¤ºæ•ˆæœ"></a>é™ä½æ˜¾ç¤ºæ•ˆæœ</h3><p>é¦–å…ˆï¼Œå³é”®å•å‡»æˆ‘çš„ç”µè„‘ï¼Œé€‰æ‹©å±æ€§ï¼Œæ‰¾åˆ°é«˜çº§ç³»ç»Ÿè®¾ç½®ï¼Œè¿›å…¥ååˆ‡æ¢é€‰é¡¹å¡åˆ°é«˜çº§ï¼Œåœ¨è§†è§‰æ•ˆæœä¸­ï¼Œé€‰ä¸­â€œè°ƒæ•´ä¸ºæœ€ä½³æ€§èƒ½â€ï¼Œç„¶åç‚¹å‡»åº”ç”¨ã€‚</p><p><img src="/2018/08/16/å¦‚ä½•è®©å¼€æœºä¸åœ¨å¡é¡¿/1534418046279.png" alt="1534418046279"></p><h3 id="åˆ é™¤ç³»ç»Ÿé—ç•™çš„æ— ç”¨æ–‡ä»¶"><a href="#åˆ é™¤ç³»ç»Ÿé—ç•™çš„æ— ç”¨æ–‡ä»¶" class="headerlink" title="åˆ é™¤ç³»ç»Ÿé—ç•™çš„æ— ç”¨æ–‡ä»¶"></a>åˆ é™¤ç³»ç»Ÿé—ç•™çš„æ— ç”¨æ–‡ä»¶</h3><p>ç„¶åï¼Œåœ¨å¼€å§‹èœå•è¾“å…¥cmdï¼Œé€‰æ‹©å‘½ä»¤æç¤ºç¬¦ï¼Œè¿›å…¥åè¾“å…¥å‘½ä»¤<code>rd C:windows.old /s</code>ï¼Œåˆ é™¤ç³»ç»Ÿé—ç•™çš„æ— ç”¨æ–‡ä»¶ï¼Œå¢åŠ Cç›˜ç©ºé—´ã€‚å…³äºCç›˜çš„ç©ºé—´ï¼Œæˆ‘å»ºè®®è‡³å°‘è¦ä¿ç•™20%çš„å®¹é‡ï¼ˆå¹¶ä¸”ä¸å°äº10GBï¼‰ï¼Œç”¨æ¥ç»™ç³»ç»Ÿäº¤æ¢æ–‡ä»¶ä½¿ç”¨ã€‚ </p><p><img src="/2018/08/16/å¦‚ä½•è®©å¼€æœºä¸åœ¨å¡é¡¿/1534418288792.png" alt="1534418288792"></p><h3 id="å–æ¶ˆWin10çš„å¯åŠ¨ç”»é¢"><a href="#å–æ¶ˆWin10çš„å¯åŠ¨ç”»é¢" class="headerlink" title="å–æ¶ˆWin10çš„å¯åŠ¨ç”»é¢"></a>å–æ¶ˆWin10çš„å¯åŠ¨ç”»é¢</h3><p> åœ¨å¼€å§‹èœå•è¾“å…¥<code>msconfig</code>ï¼Œ</p><p><img src="/2018/08/16/å¦‚ä½•è®©å¼€æœºä¸åœ¨å¡é¡¿/1534418333759.png" alt="1534418333759"></p><p>ç„¶ååˆ‡æ¢é€‰é¡¹å¡åˆ°å¼•å¯¼ï¼Œå‹¾é€‰â€œæ— GUIå¼•å¯¼â€å°±å¯ä»¥äº† </p><p><img src="/2018/08/16/å¦‚ä½•è®©å¼€æœºä¸åœ¨å¡é¡¿/1534418382192.png" alt="1534418382192"></p><h3 id="ç¦ç”¨éšç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½çš„æœåŠ¡"><a href="#ç¦ç”¨éšç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½çš„æœåŠ¡" class="headerlink" title="ç¦ç”¨éšç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½çš„æœåŠ¡"></a>ç¦ç”¨éšç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½çš„æœåŠ¡</h3><p>è¿˜æ˜¯åœ¨åˆšæ‰çš„<code>msconfig</code>ç³»ç»Ÿé…ç½®ä¸­ï¼Œåˆ‡æ¢åˆ°æœåŠ¡é€‰é¡¹å¡ï¼Œè¿™æ—¶æ‰€æœ‰éšç³»ç»Ÿå¯åŠ¨çš„åŠ è½½æœåŠ¡éƒ½ä¼šåˆ—è¡¨æ˜¾ç¤ºï¼Œå…ˆå‹¾é€‰â€œéšè—æ‰€æœ‰MicrosoftæœåŠ¡â€ï¼Œç„¶åæŸ¥çœ‹åˆ—è¡¨ä¸­å‰©ä½™çš„åŠ è½½æœåŠ¡é¡¹ï¼ŒæŠŠä½ è®¤ä¸ºä¸éœ€è¦çš„åº”ç”¨æœåŠ¡å–æ¶ˆå‹¾é€‰å³å¯</p><p><img src="/2018/08/16/å¦‚ä½•è®©å¼€æœºä¸åœ¨å¡é¡¿/1534418479791.png" alt="1534418479791"></p><h3 id="æœ€æœ‰æ•ˆçš„åŠæ³•"><a href="#æœ€æœ‰æ•ˆçš„åŠæ³•" class="headerlink" title="æœ€æœ‰æ•ˆçš„åŠæ³•"></a>æœ€æœ‰æ•ˆçš„åŠæ³•</h3><p>éªšå¹´ï¼Œæ¢ä¸ªSSDå§</p><h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><p>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> </p><p>ç°åœ¨ç™¾åº¦win10ä¼˜åŒ–ï¼Œè¿˜æœ‰å¾ˆå¤šå°æŠ€å·§ï¼Œæˆ‘å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œè¯¦æƒ…è¯·çœ‹çœ‹ç™¾åº¦ç¬¬ä¸€æ¡<a href="https://jingyan.baidu.com/article/c843ea0ba3d01377931e4a3d.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/c843ea0ba3d01377931e4a3d.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘è€æœ‰å°ä¼™ä¼´QQç§èŠæˆ‘ï¼šâ€œç„¶å“¥ç„¶å“¥ï¼Œæˆ‘ç”µè„‘å¡ï¼Œæ€ä¹ˆåŠï¼Ÿâ€&lt;/p&gt;
&lt;p&gt;æˆ‘å°±å›å¤ï¼Œè¿˜èƒ½æ€ä¹ˆåŠå•Šï¼Œç™¾åº¦å»&lt;/p&gt;
&lt;p&gt;ç„¶åå¯¹é¢åˆæ¥è¯äº†ï¼Œâ€œç„¶å“¥ç„¶å“¥ï¼Œæˆ‘ä¸ä¼šæœï¼Œå’‹åŠå•Šï¼Ÿâ€&lt;/p&gt;
&lt;p&gt;æˆ‘ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2018/08/16/å¦‚ä½•è®©å¼€æœºä¸åœ¨å¡é¡¿/15
      
    
    </summary>
    
    
      <category term="Windows10" scheme="https://tengshe789.github.io/tags/Windows10/"/>
    
      <category term="çªé—¨" scheme="https://tengshe789.github.io/tags/%E7%AA%8D%E9%97%A8/"/>
    
  </entry>
  
  <entry>
    <title>è®ºè‡ªåŠ¨ä¸‹è½½BingèƒŒæ™¯çš„å°æŠ€å·§</title>
    <link href="https://tengshe789.github.io/2018/08/16/%E8%87%AA%E5%8A%A8%E4%B8%8B%E8%BD%BDBing%E8%83%8C%E6%99%AF/"/>
    <id>https://tengshe789.github.io/2018/08/16/è‡ªåŠ¨ä¸‹è½½BingèƒŒæ™¯/</id>
    <published>2018-08-16T10:43:42.000Z</published>
    <updated>2019-11-20T13:39:41.543Z</updated>
    
    <content type="html"><![CDATA[<p>Bingï¼Œå…„å¼Ÿä»¬æ‡‚å§ğŸ¤ è™½ç„¶Bingçš„æœç´¢å¼•æ“è¿˜å·®ç‚¹æ„æ€ï¼Œä¸è¿‡æ¯æ¬¡å¯åŠ¨å®ƒçš„æ—¶å€™ï¼Œæ€»æ˜¯è¢«å®ƒçš„èƒŒæ™¯éœ‡æ’¼åˆ°ï¼Œç”šè‡³å¾ˆå¤šäººéƒ½æŠŠå®ƒå½“ä½œç¾å›¾ç½‘</p><p><img src="/2018/08/16/è‡ªåŠ¨ä¸‹è½½BingèƒŒæ™¯/1534416347191.png" alt="1534416347191"> </p><p>è¯ºï¼Œå°±æ˜¯è¿™ç§èƒŒæ™¯ï¼Œæ¯å¤©éƒ½ä¼šæ¢1å¼ ï¼Œè¿˜ä¸é‡å¤</p><p>æ˜¯ä¸æ˜¯æƒ³è¦æŠŠå®ƒè®¾ç½®æˆå£çº¸ï¼Ÿæ¯æ¬¡éƒ½è¦è‡ªå·±æ‰‹åŠ¨æ“ä½œå¯¹æ‡’ç™Œæ‚£è€…å®åœ¨æ˜¯ä¸å¤Ÿå‹å¥½ï¼Œæ—¢ç„¶ç°åœ¨ä»€ä¹ˆéƒ½è®²ç©¶AIï¼Œå’±ä»¬ä¹Ÿå°±æ¥ç‚¹æ™ºèƒ½åŒ–çš„Bingå£çº¸ä¸‹è½½æ“ä½œå§ã€‚ </p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a>ã€‚</p><h3 id="ç¬¬ä¸€æ­¥â€“coding"><a href="#ç¬¬ä¸€æ­¥â€“coding" class="headerlink" title="ç¬¬ä¸€æ­¥â€“coding"></a>ç¬¬ä¸€æ­¥â€“coding</h3><p>å…ˆå‡†å¤‡ä¸€ä¸ªtxtï¼Œå°†ä¸‹åˆ—ä»£ç ç²˜è´´è¿›å»</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$x</span> = <span class="built_in">Split-Path</span> -Parent <span class="variable">$MyInvocation</span>.MyCommand.Definition</span><br><span class="line"></span><br><span class="line">cd <span class="variable">$x</span></span><br><span class="line"></span><br><span class="line">mkdir images</span><br><span class="line"></span><br><span class="line">cd images</span><br><span class="line"></span><br><span class="line">mkdir jsons</span><br><span class="line"></span><br><span class="line">cd jsons</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="string">"http://www.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=10"</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$time</span> = <span class="built_in">Get-Date</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="built_in">Invoke-WebRequest</span> <span class="variable">$url</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span>.Content | <span class="built_in">Out-File</span> <span class="variable">$time</span>.DayOfYear</span><br><span class="line"></span><br><span class="line"><span class="variable">$decode</span> = <span class="built_in">ConvertFrom-Json</span>(<span class="variable">$data</span>)</span><br><span class="line"></span><br><span class="line">cd ..</span><br><span class="line"></span><br><span class="line"><span class="variable">$range</span> = <span class="number">1</span>..<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$count</span> = <span class="variable">$range</span>.Count</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> <span class="nomarkup">-lt</span> <span class="variable">$count</span>; <span class="variable">$i</span>++)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$temp</span> = <span class="variable">$decode</span>.images.Get(<span class="variable">$i</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable">$urlsplit</span> = -Join(<span class="string">"http://www.bing.com"</span>,<span class="variable">$temp</span>.url)</span><br><span class="line"></span><br><span class="line">echo <span class="variable">$urlsplit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Invoke-WebRequest</span> <span class="variable">$urlsplit</span> -OutFile (<span class="variable">$temp</span>.hsh + <span class="string">".jpg"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo ok!</span><br><span class="line"></span><br><span class="line">pause</span><br></pre></td></tr></table></figure><p>ç„¶åå°†æ–‡ä»¶åç¼€åæ”¹æˆ<code>.ps1</code>ï¼Œå­˜æ”¾åˆ°é¢„å…ˆæ‰¾åˆ°çš„å£çº¸æ–‡ä»¶å¤¹ä¸­ã€‚ </p><h3 id="ç¬¬äºŒæ­¥â€“running"><a href="#ç¬¬äºŒæ­¥â€“running" class="headerlink" title="ç¬¬äºŒæ­¥â€“running"></a>ç¬¬äºŒæ­¥â€“running</h3><p>ç”¨é¼ æ ‡å³é”®é€‰æ‹©â€œä½¿ç”¨PowerShellè¿è¡Œâ€ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸ªåä¸ºâ€œimagesâ€çš„æ–‡ä»¶å¤¹ï¼Œä¸‹è½½æœ€è¿‘å‡ å¤©æ˜¾ç¤ºçš„8å¼ Bingå£çº¸ã€‚ </p><p><img src="/2018/08/16/è‡ªåŠ¨ä¸‹è½½BingèƒŒæ™¯/1534416669261.png" alt="1534416669261"></p><p>æ•ˆæœå°±æ˜¯è¿™æ ·ï¼š</p><p><img src="/2018/08/16/è‡ªåŠ¨ä¸‹è½½BingèƒŒæ™¯/1534416736052.png" alt="1534416736052"></p><h4 id="å‡ºé”™æ€ä¹ˆåŠï¼Ÿâ€“exception"><a href="#å‡ºé”™æ€ä¹ˆåŠï¼Ÿâ€“exception" class="headerlink" title="å‡ºé”™æ€ä¹ˆåŠï¼Ÿâ€“exception"></a>å‡ºé”™æ€ä¹ˆåŠï¼Ÿâ€“exception</h4><p>æ³¨æ„äº†ï¼Œé‚£äº›å·²ç»ä¸ç”¨IEæµè§ˆå™¨çš„å°ä¼™ä¼´ï¼Œåœ¨ä½¿ç”¨ä»£ç å‰ä¸€å®šè¦æŠŠIEçš„å¯åŠ¨è®¾ç½®é€‰é¡¹ä¼˜å…ˆå®Œæˆäº†ï¼Œä¸ç„¶é“å®šä¼šæŠ¥é”™çš„ã€‚</p><h3 id="ç¬¬ä¸‰æ­¥â€“è‡ªåŠ¨åŒ–"><a href="#ç¬¬ä¸‰æ­¥â€“è‡ªåŠ¨åŒ–" class="headerlink" title="ç¬¬ä¸‰æ­¥â€“è‡ªåŠ¨åŒ–"></a>ç¬¬ä¸‰æ­¥â€“è‡ªåŠ¨åŒ–</h3><p>è¦æ˜¯è§‰å¾—æ¯å¤©éƒ½è¦æ‰‹åŠ¨ä¸€ä¸‹ä¸‹éå¸¸éº»çƒ¦ï¼Œè¿˜æœ‰ä¸ªå…¨å¥—è‡ªåŠ¨åŒ–ä¸‹è½½çš„æ–¹å¼ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•æŠŠä¸‹é¢åšæˆ<code>.ps1</code>æ–‡ä»¶ã€‚ </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$x</span> = <span class="built_in">Split-Path</span> -Parent <span class="variable">$MyInvocation</span>.MyCommand.Definition</span><br><span class="line"></span><br><span class="line">cd <span class="variable">$x</span></span><br><span class="line"></span><br><span class="line">mkdir images</span><br><span class="line"></span><br><span class="line">cd images</span><br><span class="line"></span><br><span class="line">mkdir jsons</span><br><span class="line"></span><br><span class="line">cd jsons</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="string">"http://www.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=10"</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$time</span> = <span class="built_in">Get-Date</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="built_in">Invoke-WebRequest</span> <span class="variable">$url</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span>.Content | <span class="built_in">Out-File</span> <span class="variable">$time</span>.DayOfYear</span><br><span class="line"></span><br><span class="line"><span class="variable">$decode</span> = <span class="built_in">ConvertFrom-Json</span>(<span class="variable">$data</span>)</span><br><span class="line"></span><br><span class="line">cd ..</span><br><span class="line"></span><br><span class="line"><span class="variable">$temp</span> = <span class="variable">$decode</span>.images.Get(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable">$urlsplit</span> = -Join(<span class="string">"http://www.bing.com"</span>,<span class="variable">$temp</span>.url)</span><br><span class="line"></span><br><span class="line">echo <span class="variable">$urlsplit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Invoke-WebRequest</span> <span class="variable">$urlsplit</span> -OutFile (<span class="variable">$temp</span>.hsh + <span class="string">".jpg"</span>)</span><br><span class="line"></span><br><span class="line">echo ok!</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›å…¥â€œæ§åˆ¶é¢æ¿-ç®¡ç†å·¥å…·-ä»»åŠ¡è®¡åˆ’ç¨‹åºâ€ï¼Œé€‰æ‹©å³ä¾§çš„â€œåˆ›å»ºä»»åŠ¡â€ã€‚ </p><p><img src="/2018/08/16/è‡ªåŠ¨ä¸‹è½½BingèƒŒæ™¯/1534417104262.png" alt="1534417104262"></p><p>åˆ‡æ¢åˆ°â€œæ“ä½œâ€é€‰é¡¹å¡ä¸‹ï¼Œç‚¹å‡»â€œæ–°å»ºâ€ï¼Œ </p><p><img src="/2018/08/16/è‡ªåŠ¨ä¸‹è½½BingèƒŒæ™¯/1534417241512.png" alt="1534417241512"></p><p>åœ¨â€œç¨‹åºæˆ–è„šæœ¬â€ä¸€æ ä¸­ï¼Œå¡«å…¥ä¸‹é¢è¿™è¡Œå†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe</span><br></pre></td></tr></table></figure><p>â€œæ·»åŠ å‚æ•°ï¼ˆå¯é€‰ï¼‰â€å†…ï¼Œå¤§å®¶åˆ™éœ€è¦æŠŠè„šæœ¬çš„ä¿å­˜è·¯å¾„å¡«è¿›å»ã€‚</p><p><img src="/2018/08/16/è‡ªåŠ¨ä¸‹è½½BingèƒŒæ™¯/1534417253558.png" alt="1534417253558"></p><p>ç‚¹å‡»ç¡®å®šåï¼Œåˆ‡æ¢åˆ°â€œè§¦å‘å™¨â€é€‰é¡¹å¡ï¼ŒåŒæ ·ç‚¹å‡»æ–°å»ºï¼Œé€‰æ‹©â€œæ¯å¤©â€ï¼Œç‚¹å‡»ç¡®å®šï¼Œä¿å­˜ä»»åŠ¡ã€‚ </p><p><img src="/2018/08/16/è‡ªåŠ¨ä¸‹è½½BingèƒŒæ™¯/1534417283593.png" alt="1534417283593"></p><p>è¿™æ ·æ¯å¤©å›ºå®šçš„æ—¶é—´ç‚¹å°±ä¼šè‡ªåŠ¨ä¸‹è½½ä¸€å¼ å¿…åº”å£çº¸äº†ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œå£çº¸åº“ä¸å°±æœ‰äº†ä¹ˆï¼Ÿ</p><h3 id="å®Œç»“"><a href="#å®Œç»“" class="headerlink" title="å®Œç»“"></a>å®Œç»“</h3><p>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œ<strong>ç¼˜åˆ†å‘¢</strong>å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹ï¼Œå’±ä»¬ä¸¤ä¸ªæƒ³ä¸ªå·ç ï¼Œ ä¹°ä¸ªå½©ç¥¨ï¼Œå…ˆæŒ£ä»–ä¸ªå‡ ç™¾ä¸‡ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Bingï¼Œå…„å¼Ÿä»¬æ‡‚å§ğŸ¤ è™½ç„¶Bingçš„æœç´¢å¼•æ“è¿˜å·®ç‚¹æ„æ€ï¼Œä¸è¿‡æ¯æ¬¡å¯åŠ¨å®ƒçš„æ—¶å€™ï¼Œæ€»æ˜¯è¢«å®ƒçš„èƒŒæ™¯éœ‡æ’¼åˆ°ï¼Œç”šè‡³å¾ˆå¤šäººéƒ½æŠŠå®ƒå½“ä½œç¾å›¾ç½‘&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2018/08/16/è‡ªåŠ¨ä¸‹è½½BingèƒŒæ™¯/1534416347191.png&quot; alt=&quot;15344163
      
    
    </summary>
    
    
      <category term="Windows10" scheme="https://tengshe789.github.io/tags/Windows10/"/>
    
      <category term="çªé—¨" scheme="https://tengshe789.github.io/tags/%E7%AA%8D%E9%97%A8/"/>
    
  </entry>
  
  <entry>
    <title>å­¦å¥½åˆ†å¸ƒå¼æ¶æ„=2=-é€šä¿¡åè®®HTTP</title>
    <link href="https://tengshe789.github.io/2018/08/16/%E5%88%86%E4%BA%AB%E4%B8%80%E4%B8%8B%E6%88%91%E5%AF%B9%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AEHTTP%E7%9A%84%E7%90%86%E8%A7%A3/"/>
    <id>https://tengshe789.github.io/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/</id>
    <published>2018-08-16T07:11:39.000Z</published>
    <updated>2019-11-20T13:39:41.190Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘ä¸ºä»€ä¹ˆä¸æ–­çš„æ›´æ–°åšå®¢å‘¢ï¼Ÿè¿™æ˜¯ä¸€æ¬¡å¾ˆå¥½çš„æå‡æœºä¼šã€‚  å¹³æ—¶è§£å†³é—®é¢˜çš„æ—¶å€™å¯èƒ½è€ƒè™‘è¿›åº¦é—®é¢˜æ²¡æœ‰æ›´æ·±åˆ»åœ°å»ç†è§£ï¼Œä½†æ˜¯åœ¨å†™åšå®¢çš„æ—¶å€™ï¼Œä½ ä¼šä¸çŸ¥ä¸è§‰ä¸­å¯¹ä¸€äº›å†…å®¹è¿›è¡Œæ€è€ƒï¼Œå¹¶æœ‰å¯èƒ½å’Œè¯„è®ºè€…ä¸€èµ·æ·±å…¥ï¼Œè¿™äº›éƒ½æ˜¯éš¾å¾—çš„æœºä¼šã€‚ </p><p>å¯èƒ½æœ‰äººä¼šé—®æˆ‘ï¼Œæˆ‘ä¸ºä»€ä¹ˆä¸æ–­çš„æ›´æ–°åšå®¢å‘¢ï¼Ÿ</p><p>æˆ‘è§‰å¾—å§ï¼Œ<strong>è¿™æ˜¯ä¸€æ¬¡å¾ˆå¥½çš„æå‡æœºä¼š</strong>ã€‚  å¹³æ—¶è§£å†³é—®é¢˜çš„æ—¶å€™å¯èƒ½è€ƒè™‘è¿›åº¦é—®é¢˜æ²¡æœ‰æ›´æ·±åˆ»åœ°å»ç†è§£ï¼Œä½†æ˜¯åœ¨å†™åšå®¢çš„æ—¶å€™ï¼Œæˆ‘ä¼šä¸çŸ¥ä¸è§‰ä¸­å¯¹ä¸€äº›å†…å®¹è¿›è¡Œæ€è€ƒï¼Œå¯ä»¥æ›´æ·±å…¥çš„ç†è§£é—®é¢˜ã€‚åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œä¸æ–­çš„æ€»ç»“ï¼Œä¸æ–­çš„æ€è€ƒï¼Œä¸æ–­è®°å¿†ï¼Œæ…¢æ…¢çŸ¥è¯†å°±å·©å›ºäº†ã€‚</p><p>æˆ‘æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ…¢çƒ­çš„äººï¼Œå¸Œæœ›æˆ‘å¯ä»¥ç”¨è¿™ä¸ªæ–¹å¼ä¸æ–­æé«˜è‡ªå·±~</p><p>å…±åŒåŠ æ²¹ï¼</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h2 id="HTTPåè®®æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#HTTPåè®®æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="HTTPåè®®æ˜¯ä»€ä¹ˆï¼Ÿ"></a>HTTPåè®®æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>HTTPåè®®ï¼ˆHyperText Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰:æ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨æˆ–å…¶ä»–ç¨‹åºä¸WebæœåŠ¡å™¨ä¹‹é—´çš„åº”ç”¨å±‚é€šä¿¡åè®® ï¼Œæ˜¯åŸºäºè¯·æ±‚/å“åº”èŒƒå¼çš„ã€‚</p><p>ä¸€ä¸ªå®¢æˆ·æœºä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼Œå‘é€ä¸€ä¸ªè¯·æ±‚ç»™æœåŠ¡å™¨ï¼Œè¯·æ±‚æ–¹å¼çš„æ ¼å¼ä¸ºï¼Œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ã€åè®®ç‰ˆæœ¬å·ï¼Œåè¾¹æ˜¯MIMEä¿¡æ¯åŒ…æ‹¬è¯·æ±‚ä¿®é¥°ç¬¦ã€å®¢æˆ·æœºä¿¡æ¯å’Œå¯èƒ½çš„å†…å®¹ã€‚</p><p>æœåŠ¡å™¨æ¥åˆ°è¯·æ±‚åï¼Œç»™äºˆç›¸åº”çš„å“åº”ä¿¡æ¯ï¼Œå…¶æ ¼å¼ä¸ºä¸€ä¸ªçŠ¶æ€è¡ŒåŒ…æ‹¬ä¿¡æ¯çš„åè®®ç‰ˆæœ¬å·ã€ä¸€ä¸ªæˆåŠŸæˆ–é”™è¯¯çš„ä»£ç ï¼Œåè¾¹æ˜¯MIMEä¿¡æ¯åŒ…æ‹¬æœåŠ¡å™¨ä¿¡æ¯ã€å®ä½“ä¿¡æ¯å’Œå¯èƒ½çš„å†…å®¹ã€‚</p><ol><li><p>å®ƒåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œç›¸åº”</p><p>RT</p></li></ol><p><img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/0.png" alt="img"></p><ol start="2"><li>ä¼ è¾“èµ„æº</li></ol><p>é€šè¿‡htmlä¼ è¾“ ï¼šæ–‡æœ¬ã€wordã€aviç”µå½±ã€å…¶ä»–èµ„æº</p><ol start="3"><li>ä¼ è¾“çš„åª’ä½“ç±»å‹</li></ol><p>æœåŠ¡ç«¯å‘æµè§ˆå™¨ä¼ è¾“MIMEç±»å‹çš„æ–‡ä»¶ï¼Œæµè§ˆå™¨æ‹¿åˆ°MIMEç±»å‹çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥è§£æäº† ã€‚  è­¬å¦‚text/htmlã€ image/jpeg ã€application/xmlï¼Œjsonæ ¼å¼ï¼Œéƒ½å±äºMIMEç±»å‹</p><ol start="4"><li>URIå’ŒURL</li></ol><p>è¦äº†è§£httpçš„ä¼ è¾“ï¼Œé¦–å…ˆè¦çŸ¥é“ä¼ è¾“çš„å¯¹è±¡æ˜¯ä»€ä¹ˆã€‚</p><p>URI:webæœåŠ¡å™¨ä¸­æŸä¸ªèµ„æºçš„åå­—ã€‚  è­¬å¦‚index.html</p><p>URL:ç½‘ç»œèµ„æºæè¿° </p><p>ä¸¾ä¸ªæ —å­ï¼š</p><pre><code>( http://)[resume.tengshe789.tech][:80]/java/index.html[?query-string] #location</code></pre><p>è¿™æ—¶ä¸ªå…¸å‹çš„urlï¼Œurlé‡Œé¢æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p>  schema(åè®®): http/https/ftp.</p><p>  host: webæœåŠ¡å™¨çš„ipåœ°å€æˆ–è€…åŸŸå</p><p>  port: æœåŠ¡ç«¯ç«¯å£ï¼Œ httpé»˜è®¤è®¿é—®çš„ç«¯å£æ˜¯80</p><p>  path: èµ„æºè®¿é—®è·¯å¾„#location</p><p>  query-string: æŸ¥è¯¢å‚æ•°[?query-string]</p><ol start="5"><li>æ–¹æ³•</li></ol><p>æ¯ä¸ªè¯·æ±‚éƒ½ä¼šæºå¸¦GET/PUT/DELETE/POST/HEADè¿™æ ·çš„ä¸€ä¸ªæ–¹æ³•ï¼ŒæœåŠ¡å™¨æ‹¿åˆ°æ–¹æ³•å°±çŸ¥é“è‡ªå·±è¯¥åšä»€ä¹ˆäº†ã€‚</p><p>é‚£javaä¸­æœ‰doGet()doPost()æ–¹æ³•ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><p>doGetï¼šGETæ–¹æ³•ä¼šæŠŠåå€¼å¯¹è¿½åŠ åœ¨è¯·æ±‚çš„URLåé¢ã€‚å› ä¸ºURLå¯¹å­—ç¬¦æ•°ç›®æœ‰é™åˆ¶ï¼Œè¿›è€Œé™åˆ¶äº†ç”¨åœ¨å®¢æˆ·ç«¯è¯·æ±‚çš„å‚æ•°å€¼çš„æ•°ç›®ã€‚å¹¶ä¸”è¯·æ±‚ä¸­çš„å‚æ•°å€¼æ˜¯å¯è§çš„ï¼Œå› æ­¤ï¼Œæ•æ„Ÿä¿¡æ¯ä¸èƒ½ç”¨è¿™ç§æ–¹å¼ä¼ é€’ã€‚ </p><p>doPOSTï¼šPOSTæ–¹æ³•é€šè¿‡æŠŠè¯·æ±‚å‚æ•°å€¼æ”¾åœ¨è¯·æ±‚ä½“ä¸­æ¥å…‹æœGETæ–¹æ³•çš„é™åˆ¶ï¼Œå› æ­¤ï¼Œå¯ä»¥å‘é€çš„å‚æ•°çš„æ•°ç›®æ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚æœ€åï¼Œé€šè¿‡POSTè¯·æ±‚ä¼ é€’çš„æ•æ„Ÿä¿¡æ¯å¯¹å¤–éƒ¨å®¢æˆ·ç«¯æ˜¯ä¸å¯è§çš„ã€‚ </p><table><thead><tr><th>æ–¹æ³•</th><th>GET</th><th>POST</th></tr></thead><tbody><tr><td>ç¼“å­˜</td><td>èƒ½è¢«ç¼“å­˜</td><td>ä¸èƒ½ç¼“å­˜</td></tr><tr><td>ç¼–ç ç±»å‹</td><td>application/x-www-form-urlencoded</td><td>application/x-www-form-urlencoded æˆ– multipart/form-dataã€‚ä¸ºäºŒè¿›åˆ¶æ•°æ®ä½¿ç”¨å¤šé‡ç¼–ç ã€‚</td></tr><tr><td>å¯¹æ•°æ®é•¿åº¦çš„é™åˆ¶</td><td>æ˜¯çš„ã€‚å½“å‘é€æ•°æ®æ—¶ï¼ŒGET æ–¹æ³•å‘ URL æ·»åŠ æ•°æ®ï¼›URL çš„é•¿åº¦æ˜¯å—é™åˆ¶çš„ï¼ˆURL çš„æœ€å¤§é•¿åº¦æ˜¯ 2048 ä¸ªå­—ç¬¦ï¼‰</td><td>æ— é™åˆ¶ã€‚</td></tr><tr><td>å¯¹æ•°æ®ç±»å‹çš„é™åˆ¶</td><td>åªå…è®¸ ASCII å­—ç¬¦</td><td>æ²¡æœ‰é™åˆ¶ã€‚ä¹Ÿå…è®¸äºŒè¿›åˆ¶æ•°æ®ã€‚</td></tr><tr><td>å®‰å…¨æ€§</td><td>ä¸ POST ç›¸æ¯”ï¼ŒGET çš„å®‰å…¨æ€§è¾ƒå·®ï¼Œå› ä¸ºæ‰€å‘é€çš„æ•°æ®æ˜¯ URL çš„ä¸€éƒ¨åˆ†ã€‚åœ¨å‘é€å¯†ç æˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯æ—¶ç»ä¸è¦ä½¿ç”¨ GET</td><td>POST æ¯” GET æ›´å®‰å…¨ï¼Œå› ä¸ºå‚æ•°ä¸ä¼šè¢«ä¿å­˜åœ¨æµè§ˆå™¨å†å²æˆ– web æœåŠ¡å™¨æ—¥å¿—ä¸­ã€‚</td></tr><tr><td>å¯è§æ€§</td><td>æ•°æ®åœ¨ URL ä¸­å¯¹æ‰€æœ‰äººéƒ½æ˜¯å¯è§çš„ã€‚</td><td>æ•°æ®ä¸ä¼šæ˜¾ç¤ºåœ¨ URL ä¸­ã€‚</td></tr></tbody></table><h3 id="æŠ¥æ–‡"><a href="#æŠ¥æ–‡" class="headerlink" title="æŠ¥æ–‡"></a>æŠ¥æ–‡</h3><p>httpäº¤æ¢ä¸ä¼ è¾“çš„æ•°æ®å•å…ƒæ˜¯æŠ¥æ–‡ã€‚æŠ¥æ–‡ç”±ä»å®¢æˆ·æœºåˆ°æœåŠ¡å™¨çš„è¯·æ±‚å’Œä»æœåŠ¡å™¨åˆ°å®¢æˆ·æœºçš„å“åº”æ„æˆã€‚</p><p>åº”ç­”æŠ¥æ–‡æ ¼å¼å¦‚ä¸‹ï¼š</p><p>çŠ¶æ€è¡Œ ï¼ é€šç”¨ä¿¡æ¯å¤´ ï¼ å“åº”å¤´ ï¼ å®ä½“å¤´ ï¼ æŠ¥æ–‡ä¸»ä½“</p><p>çŠ¶æ€ç å…ƒç”±3ä½æ•°å­—ç»„æˆï¼Œè¡¨ç¤ºè¯·æ±‚æ˜¯å¦è¢«ç†è§£æˆ–è¢«æ»¡è¶³ã€‚åŸå› åˆ†ææ˜¯å¯¹åŸæ–‡çš„çŠ¶æ€ç ä½œç®€çŸ­çš„æè¿°ï¼ŒçŠ¶æ€ç ç”¨æ¥æ”¯æŒè‡ªåŠ¨æ“ä½œï¼Œè€ŒåŸå› åˆ†æç”¨æ¥ä¾›ç”¨æˆ·ä½¿ç”¨ã€‚å®¢æˆ·æœºæ— éœ€ç”¨æ¥æ£€æŸ¥æˆ–æ˜¾ç¤ºè¯­æ³•ã€‚æœ‰å…³é€šç”¨ä¿¡æ¯å¤´ï¼Œå“åº”å¤´å’Œå®ä½“å¤´æ–¹é¢çš„å…·ä½“å†…å®¹å¯ä»¥å‚ç…§ç›¸å…³æ–‡ä»¶ã€‚</p><h4 id="request"><a href="#request" class="headerlink" title="request"></a>request</h4><p>requestæŠ¥æ–‡æ ¼å¼å¦‚ä¸‹ï¼š</p><p>è¯·æ±‚è¡Œ ï¼ é€šç”¨ä¿¡æ¯å¤´ ï¼ è¯·æ±‚å¤´ ï¼ å®ä½“å¤´ ï¼ æŠ¥æ–‡ä¸»ä½“</p><p>requestæ¶ˆæ¯ç»“æ„åŒ…å«ä¸‰éƒ¨åˆ†ï¼š ï¼ˆèµ·å§‹è¡Œã€é¦–éƒ¨å­—æ®µã€ä¸»ä½“ï¼‰ </p><p>ä¸‹é¢æŠ“åŒ…éªŒè¯ï¼ŒæŠ“åŒ…ä½¿ç”¨çš„æ˜¯<code>Charles</code>è¿™ä¸ªè½¯ä»¶ã€‚</p><p><img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/1.png" alt="img"></p><p><img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/2.png" alt="img"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œèµ·å§‹è¡Œï¼š METHOD /path / http/version-number</p><p>é¦–éƒ¨å­—æ®µï¼š å¤´ä¿¡æ¯Header-Name:value</p><p>ä¸»ä½“ è¿”å›å†…å®¹optional request body</p><p>è¯·æ±‚è¡Œä»¥æ–¹æ³•å­—æ®µå¼€å§‹ï¼Œåé¢åˆ†åˆ«æ˜¯ URL å­—æ®µå’Œ HTTP åè®®ç‰ˆæœ¬å­—æ®µï¼Œå¹¶ä»¥ CRLF ç»“å°¾ã€‚SP æ˜¯åˆ†éš”ç¬¦ã€‚é™¤äº†åœ¨æœ€åçš„ CRLF åºåˆ—ä¸­ CF å’Œ LF æ˜¯å¿…éœ€çš„ä¹‹å¤–ï¼Œå…¶ä»–éƒ½å¯ä»¥ä¸è¦ã€‚æœ‰å…³é€šç”¨ä¿¡æ¯å¤´ï¼Œè¯·æ±‚å¤´å’Œå®ä½“å¤´æ–¹é¢çš„å…·ä½“å†…å®¹å¯ä»¥å‚ç…§ç›¸å…³æ–‡ä»¶ã€‚</p><h4 id="response"><a href="#response" class="headerlink" title="response"></a>response</h4><p>responseæŠ¥æ–‡æ ¼å¼å¦‚ä¸‹ï¼š</p><p>çŠ¶æ€è¡Œ ï¼ é€šç”¨ä¿¡æ¯å¤´ ï¼ å“åº”å¤´ ï¼ å®ä½“å¤´ ï¼ æŠ¥æ–‡ä¸»ä½“</p><p>ç¬¬ä¸€éƒ¨åˆ† åŒ…æ‹¬ åè®®ç‰ˆæœ¬http/version-number   çŠ¶æ€status code message</p><p>ç¬¬äºŒéƒ¨åˆ† å¤´ä¿¡æ¯header-name:value</p><p>ç¬¬ä¸‰éƒ¨åˆ† body</p><p><img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/3.png" alt="imgã€‚"></p><p>çŠ¶æ€ç å…ƒç”±3ä½æ•°å­—ç»„æˆï¼Œè¡¨ç¤ºè¯·æ±‚æ˜¯å¦è¢«ç†è§£æˆ–è¢«æ»¡è¶³ã€‚åŸå› åˆ†ææ˜¯å¯¹åŸæ–‡çš„çŠ¶æ€ç ä½œç®€çŸ­çš„æè¿°ï¼ŒçŠ¶æ€ç ç”¨æ¥æ”¯æŒè‡ªåŠ¨æ“ä½œï¼Œè€ŒåŸå› åˆ†æç”¨æ¥ä¾›ç”¨æˆ·ä½¿ç”¨ã€‚å®¢æˆ·æœºæ— éœ€ç”¨æ¥æ£€æŸ¥æˆ–æ˜¾ç¤ºè¯­æ³•ã€‚æœ‰å…³é€šç”¨ä¿¡æ¯å¤´ï¼Œå“åº”å¤´å’Œå®ä½“å¤´æ–¹é¢çš„å…·ä½“å†…å®¹å¯ä»¥å‚ç…§ç›¸å…³æ–‡ä»¶ã€‚</p><h4 id="å¸¸è§çŠ¶æ€ç "><a href="#å¸¸è§çŠ¶æ€ç " class="headerlink" title="å¸¸è§çŠ¶æ€ç "></a>å¸¸è§çŠ¶æ€ç </h4><p>http/1.1ç‰ˆæœ¬çš„åè®®é‡Œé¢å®šä¹‰äº†äº”ç§ç±»å‹çš„çŠ¶æ€ç ï¼š</p><p>1XX    æç¤ºä¿¡æ¯</p><p>2XX    æˆåŠŸ</p><p>3XX    é‡å®šå‘</p><p>4XX    å®¢æˆ·ç«¯é”™è¯¯</p><p>5XX    æœåŠ¡å™¨ç«¯çš„é”™è¯¯ </p><table><thead><tr><th>æ¶ˆæ¯</th><th>æè¿°</th></tr></thead><tbody><tr><td>100 Continue</td><td>æœåŠ¡å™¨ä»…æ¥æ”¶åˆ°éƒ¨åˆ†è¯·æ±‚ï¼Œä½†æ˜¯ä¸€æ—¦æœåŠ¡å™¨å¹¶æ²¡æœ‰æ‹’ç»è¯¥è¯·æ±‚ï¼Œå®¢æˆ·ç«¯åº”è¯¥ç»§ç»­å‘é€å…¶ä½™çš„è¯·æ±‚ã€‚</td></tr><tr><td>101 Switching Protocols</td><td>æœåŠ¡å™¨è½¬æ¢åè®®ï¼šæœåŠ¡å™¨å°†éµä»å®¢æˆ·çš„è¯·æ±‚è½¬æ¢åˆ°å¦å¤–ä¸€ç§åè®®ã€‚</td></tr></tbody></table><table><thead><tr><th>æ¶ˆæ¯</th><th>æè¿°</th></tr></thead><tbody><tr><td>200 OK</td><td>è¯·æ±‚æˆåŠŸï¼ˆå…¶åæ˜¯å¯¹GETå’ŒPOSTè¯·æ±‚çš„åº”ç­”æ–‡æ¡£ã€‚ï¼‰</td></tr><tr><td>201 Created</td><td>è¯·æ±‚è¢«åˆ›å»ºå®Œæˆï¼ŒåŒæ—¶æ–°çš„èµ„æºè¢«åˆ›å»ºã€‚</td></tr><tr><td>202 Accepted</td><td>ä¾›å¤„ç†çš„è¯·æ±‚å·²è¢«æ¥å—ï¼Œä½†æ˜¯å¤„ç†æœªå®Œæˆã€‚</td></tr><tr><td>203 Non-authoritative Information</td><td>æ–‡æ¡£å·²ç»æ­£å¸¸åœ°è¿”å›ï¼Œä½†ä¸€äº›åº”ç­”å¤´å¯èƒ½ä¸æ­£ç¡®ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯æ–‡æ¡£çš„æ‹·è´ã€‚</td></tr><tr><td>204 No Content</td><td>æ²¡æœ‰æ–°æ–‡æ¡£ã€‚æµè§ˆå™¨åº”è¯¥ç»§ç»­æ˜¾ç¤ºåŸæ¥çš„æ–‡æ¡£ã€‚å¦‚æœç”¨æˆ·å®šæœŸåœ°åˆ·æ–°é¡µé¢ï¼Œè€ŒServletå¯ä»¥ç¡®å®šç”¨æˆ·æ–‡æ¡£è¶³å¤Ÿæ–°ï¼Œè¿™ä¸ªçŠ¶æ€ä»£ç æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</td></tr><tr><td>205 Reset Content</td><td>æ²¡æœ‰æ–°æ–‡æ¡£ã€‚ä½†æµè§ˆå™¨åº”è¯¥é‡ç½®å®ƒæ‰€æ˜¾ç¤ºçš„å†…å®¹ã€‚ç”¨æ¥å¼ºåˆ¶æµè§ˆå™¨æ¸…é™¤è¡¨å•è¾“å…¥å†…å®¹ã€‚</td></tr><tr><td>206 Partial Content</td><td>å®¢æˆ·å‘é€äº†ä¸€ä¸ªå¸¦æœ‰Rangeå¤´çš„GETè¯·æ±‚ï¼ŒæœåŠ¡å™¨å®Œæˆäº†å®ƒã€‚</td></tr></tbody></table><table><thead><tr><th>æ¶ˆæ¯</th><th>æè¿°</th></tr></thead><tbody><tr><td>300 Multiple Choices</td><td>å¤šé‡é€‰æ‹©ã€‚é“¾æ¥åˆ—è¡¨ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©æŸé“¾æ¥åˆ°è¾¾ç›®çš„åœ°ã€‚æœ€å¤šå…è®¸äº”ä¸ªåœ°å€ã€‚</td></tr><tr><td>301 Moved Permanently</td><td>æ‰€è¯·æ±‚çš„é¡µé¢å·²ç»è½¬ç§»è‡³æ–°çš„urlã€‚</td></tr><tr><td>302 Found</td><td>æ‰€è¯·æ±‚çš„é¡µé¢å·²ç»ä¸´æ—¶è½¬ç§»è‡³æ–°çš„urlã€‚</td></tr><tr><td>303 See Other</td><td>æ‰€è¯·æ±‚çš„é¡µé¢å¯åœ¨åˆ«çš„urlä¸‹è¢«æ‰¾åˆ°ã€‚</td></tr><tr><td>304 Not Modified</td><td>æœªæŒ‰é¢„æœŸä¿®æ”¹æ–‡æ¡£ã€‚å®¢æˆ·ç«¯æœ‰ç¼“å†²çš„æ–‡æ¡£å¹¶å‘å‡ºäº†ä¸€ä¸ªæ¡ä»¶æ€§çš„è¯·æ±‚ï¼ˆä¸€èˆ¬æ˜¯æä¾›If-Modified-Sinceå¤´è¡¨ç¤ºå®¢æˆ·åªæƒ³æ¯”æŒ‡å®šæ—¥æœŸæ›´æ–°çš„æ–‡æ¡£ï¼‰ã€‚æœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ï¼ŒåŸæ¥ç¼“å†²çš„æ–‡æ¡£è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚</td></tr><tr><td>305 Use Proxy</td><td>å®¢æˆ·è¯·æ±‚çš„æ–‡æ¡£åº”è¯¥é€šè¿‡Locationå¤´æ‰€æŒ‡æ˜çš„ä»£ç†æœåŠ¡å™¨æå–ã€‚</td></tr><tr><td>306 <em>Unused</em></td><td>æ­¤ä»£ç è¢«ç”¨äºå‰ä¸€ç‰ˆæœ¬ã€‚ç›®å‰å·²ä¸å†ä½¿ç”¨ï¼Œä½†æ˜¯ä»£ç ä¾ç„¶è¢«ä¿ç•™ã€‚</td></tr><tr><td>307 Temporary Redirect</td><td>è¢«è¯·æ±‚çš„é¡µé¢å·²ç»ä¸´æ—¶ç§»è‡³æ–°çš„urlã€‚</td></tr></tbody></table><table><thead><tr><th>æ¶ˆæ¯</th><th>æè¿°</th></tr></thead><tbody><tr><td>400 Bad Request</td><td>æœåŠ¡å™¨æœªèƒ½ç†è§£è¯·æ±‚ã€‚</td></tr><tr><td>401 Unauthorized</td><td>è¢«è¯·æ±‚çš„é¡µé¢éœ€è¦ç”¨æˆ·åå’Œå¯†ç ã€‚</td></tr><tr><td>401.1</td><td>ç™»å½•å¤±è´¥ã€‚</td></tr><tr><td>401.2</td><td>æœåŠ¡å™¨é…ç½®å¯¼è‡´ç™»å½•å¤±è´¥ã€‚</td></tr><tr><td>401.3</td><td>ç”±äº ACL å¯¹èµ„æºçš„é™åˆ¶è€Œæœªè·å¾—æˆæƒã€‚</td></tr><tr><td>401.4</td><td>ç­›é€‰å™¨æˆæƒå¤±è´¥ã€‚</td></tr><tr><td>401.5</td><td>ISAPI/CGI åº”ç”¨ç¨‹åºæˆæƒå¤±è´¥ã€‚</td></tr><tr><td>401.7</td><td>è®¿é—®è¢« Web æœåŠ¡å™¨ä¸Šçš„ URL æˆæƒç­–ç•¥æ‹’ç»ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º IIS 6.0 æ‰€ä¸“ç”¨ã€‚</td></tr><tr><td>402 Payment Required</td><td>æ­¤ä»£ç å°šæ— æ³•ä½¿ç”¨ã€‚</td></tr><tr><td>403 Forbidden</td><td>å¯¹è¢«è¯·æ±‚é¡µé¢çš„è®¿é—®è¢«ç¦æ­¢ã€‚</td></tr><tr><td>403.1</td><td>æ‰§è¡Œè®¿é—®è¢«ç¦æ­¢ã€‚</td></tr><tr><td>403.2</td><td>è¯»è®¿é—®è¢«ç¦æ­¢ã€‚</td></tr><tr><td>403.3</td><td>å†™è®¿é—®è¢«ç¦æ­¢ã€‚</td></tr><tr><td>403.4</td><td>è¦æ±‚ SSLã€‚</td></tr><tr><td>403.5</td><td>è¦æ±‚ SSL 128ã€‚</td></tr><tr><td>403.6</td><td>IP åœ°å€è¢«æ‹’ç»ã€‚</td></tr><tr><td>403.7</td><td>è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ã€‚</td></tr><tr><td>403.8</td><td>ç«™ç‚¹è®¿é—®è¢«æ‹’ç»ã€‚</td></tr><tr><td>403.9</td><td>ç”¨æˆ·æ•°è¿‡å¤šã€‚</td></tr><tr><td>403.10</td><td>é…ç½®æ— æ•ˆã€‚</td></tr><tr><td>403.11</td><td>å¯†ç æ›´æ”¹ã€‚</td></tr><tr><td>403.12</td><td>æ‹’ç»è®¿é—®æ˜ å°„è¡¨ã€‚</td></tr><tr><td>403.13</td><td>å®¢æˆ·ç«¯è¯ä¹¦è¢«åŠé”€ã€‚</td></tr><tr><td>403.14</td><td>æ‹’ç»ç›®å½•åˆ—è¡¨ã€‚</td></tr><tr><td>403.15</td><td>è¶…å‡ºå®¢æˆ·ç«¯è®¿é—®è®¸å¯ã€‚</td></tr><tr><td>403.16</td><td>å®¢æˆ·ç«¯è¯ä¹¦ä¸å—ä¿¡ä»»æˆ–æ— æ•ˆã€‚</td></tr><tr><td>403.17</td><td>å®¢æˆ·ç«¯è¯ä¹¦å·²è¿‡æœŸæˆ–å°šæœªç”Ÿæ•ˆã€‚</td></tr><tr><td>403.18</td><td>åœ¨å½“å‰çš„åº”ç”¨ç¨‹åºæ± ä¸­ä¸èƒ½æ‰§è¡Œæ‰€è¯·æ±‚çš„ URLã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º IIS 6.0 æ‰€ä¸“ç”¨ã€‚</td></tr><tr><td>403.19</td><td>ä¸èƒ½ä¸ºè¿™ä¸ªåº”ç”¨ç¨‹åºæ± ä¸­çš„å®¢æˆ·ç«¯æ‰§è¡Œ CGIã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º IIS 6.0 æ‰€ä¸“ç”¨ã€‚</td></tr><tr><td>403.20</td><td>Passport ç™»å½•å¤±è´¥ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º IIS 6.0 æ‰€ä¸“ç”¨ã€‚</td></tr><tr><td>404 Not Found</td><td>æœåŠ¡å™¨æ— æ³•æ‰¾åˆ°è¢«è¯·æ±‚çš„é¡µé¢ã€‚</td></tr><tr><td>404.0</td><td>ï¼ˆæ— ï¼‰â€“æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶æˆ–ç›®å½•ã€‚</td></tr><tr><td>404.1</td><td>æ— æ³•åœ¨æ‰€è¯·æ±‚çš„ç«¯å£ä¸Šè®¿é—® Web ç«™ç‚¹ã€‚</td></tr><tr><td>404.2</td><td>Web æœåŠ¡æ‰©å±•é”å®šç­–ç•¥é˜»æ­¢æœ¬è¯·æ±‚ã€‚</td></tr><tr><td>404.3</td><td>MIME æ˜ å°„ç­–ç•¥é˜»æ­¢æœ¬è¯·æ±‚ã€‚</td></tr><tr><td>405 Method Not Allowed</td><td>è¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹æ³•ä¸è¢«å…è®¸ã€‚</td></tr><tr><td>406 Not Acceptable</td><td>æœåŠ¡å™¨ç”Ÿæˆçš„å“åº”æ— æ³•è¢«å®¢æˆ·ç«¯æ‰€æ¥å—ã€‚</td></tr><tr><td>407 Proxy Authentication Required</td><td>ç”¨æˆ·å¿…é¡»é¦–å…ˆä½¿ç”¨ä»£ç†æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼Œè¿™æ ·è¯·æ±‚æ‰ä¼šè¢«å¤„ç†ã€‚</td></tr><tr><td>408 Request Timeout</td><td>è¯·æ±‚è¶…å‡ºäº†æœåŠ¡å™¨çš„ç­‰å¾…æ—¶é—´ã€‚</td></tr><tr><td>409 Conflict</td><td>ç”±äºå†²çªï¼Œè¯·æ±‚æ— æ³•è¢«å®Œæˆã€‚</td></tr><tr><td>410 Gone</td><td>è¢«è¯·æ±‚çš„é¡µé¢ä¸å¯ç”¨ã€‚</td></tr><tr><td>411 Length Required</td><td>â€œContent-Lengthâ€ æœªè¢«å®šä¹‰ã€‚å¦‚æœæ— æ­¤å†…å®¹ï¼ŒæœåŠ¡å™¨ä¸ä¼šæ¥å—è¯·æ±‚ã€‚</td></tr><tr><td>412 Precondition Failed</td><td>è¯·æ±‚ä¸­çš„å‰ææ¡ä»¶è¢«æœåŠ¡å™¨è¯„ä¼°ä¸ºå¤±è´¥ã€‚</td></tr><tr><td>413 Request Entity Too Large</td><td>ç”±äºæ‰€è¯·æ±‚çš„å®ä½“çš„å¤ªå¤§ï¼ŒæœåŠ¡å™¨ä¸ä¼šæ¥å—è¯·æ±‚ã€‚</td></tr><tr><td>414 Request-url Too Long</td><td>ç”±äºurlå¤ªé•¿ï¼ŒæœåŠ¡å™¨ä¸ä¼šæ¥å—è¯·æ±‚ã€‚å½“postè¯·æ±‚è¢«è½¬æ¢ä¸ºå¸¦æœ‰å¾ˆé•¿çš„æŸ¥è¯¢ä¿¡æ¯çš„getè¯·æ±‚æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</td></tr><tr><td>415 Unsupported Media Type</td><td>ç”±äºåª’ä»‹ç±»å‹ä¸è¢«æ”¯æŒï¼ŒæœåŠ¡å™¨ä¸ä¼šæ¥å—è¯·æ±‚ã€‚</td></tr><tr><td>416 Requested Range Not Satisfiable</td><td>æœåŠ¡å™¨ä¸èƒ½æ»¡è¶³å®¢æˆ·åœ¨è¯·æ±‚ä¸­æŒ‡å®šçš„Rangeå¤´ã€‚</td></tr><tr><td>417 Expectation Failed</td><td>æ‰§è¡Œå¤±è´¥ã€‚</td></tr><tr><td>423</td><td>é”å®šçš„é”™è¯¯ã€‚</td></tr></tbody></table><table><thead><tr><th>æ¶ˆæ¯</th><th>æè¿°</th></tr></thead><tbody><tr><td>500 Internal Server Error</td><td>è¯·æ±‚æœªå®Œæˆã€‚æœåŠ¡å™¨é‡åˆ°ä¸å¯é¢„çŸ¥çš„æƒ…å†µã€‚</td></tr><tr><td>500.12</td><td>åº”ç”¨ç¨‹åºæ­£å¿™äºåœ¨ Web æœåŠ¡å™¨ä¸Šé‡æ–°å¯åŠ¨ã€‚</td></tr><tr><td>500.13</td><td>Web æœåŠ¡å™¨å¤ªå¿™ã€‚</td></tr><tr><td>500.15</td><td>ä¸å…è®¸ç›´æ¥è¯·æ±‚ Global.asaã€‚</td></tr><tr><td>500.16</td><td>UNC æˆæƒå‡­æ®ä¸æ­£ç¡®ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º IIS 6.0 æ‰€ä¸“ç”¨ã€‚</td></tr><tr><td>500.18</td><td>URL æˆæƒå­˜å‚¨ä¸èƒ½æ‰“å¼€ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º IIS 6.0 æ‰€ä¸“ç”¨ã€‚</td></tr><tr><td>500.100</td><td>å†…éƒ¨ ASP é”™è¯¯ã€‚</td></tr><tr><td>501 Not Implemented</td><td>è¯·æ±‚æœªå®Œæˆã€‚æœåŠ¡å™¨ä¸æ”¯æŒæ‰€è¯·æ±‚çš„åŠŸèƒ½ã€‚</td></tr><tr><td>502 Bad Gateway</td><td>è¯·æ±‚æœªå®Œæˆã€‚æœåŠ¡å™¨ä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªæ— æ•ˆçš„å“åº”ã€‚</td></tr><tr><td>502.1</td><td>CGI åº”ç”¨ç¨‹åºè¶…æ—¶ã€‚ã€€Â·</td></tr><tr><td>502.2</td><td>CGI åº”ç”¨ç¨‹åºå‡ºé”™ã€‚</td></tr><tr><td>503 Service Unavailable</td><td>è¯·æ±‚æœªå®Œæˆã€‚æœåŠ¡å™¨ä¸´æ—¶è¿‡è½½æˆ–å½“æœºã€‚</td></tr><tr><td>504 Gateway Timeout</td><td>ç½‘å…³è¶…æ—¶ã€‚</td></tr><tr><td>505 HTTP Version Not Supported</td><td>æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚ä¸­æŒ‡æ˜çš„HTTPåè®®ç‰ˆæœ¬ã€‚</td></tr></tbody></table><h4 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h4><p>ä½œç”¨æœ‰ä¸‰ï¼Œå‡å°‘å®¢æˆ·ç«¯è¯·æ±‚é¢‘ç‡ï¼Œå¢åŠ å®¢æˆ·ç«¯å“åº”é€Ÿåº¦ï¼Œå‡å°‘å†—ä½™æ•°æ®çš„ä¼ è¾“</p><p>ä¸‹å›¾æ˜¯è°·æ­Œæµè§ˆå™¨è°ƒè¯•æ¨¡å¼ç•Œé¢ï¼Œåœ¨headeræ ä¸­æ¸…æ™°çš„æ˜¾ç¤ºäº†ç¼“å­˜çš„æœ€å¤§ä¿æŒæ—¶é—´</p><p> <img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/4.png" alt="4.png"></p><h3 id="HTTPåè®®çš„ç‰¹ç‚¹"><a href="#HTTPåè®®çš„ç‰¹ç‚¹" class="headerlink" title="HTTPåè®®çš„ç‰¹ç‚¹"></a>HTTPåè®®çš„ç‰¹ç‚¹</h3><ol><li>æ— çŠ¶æ€ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼‰</li></ol><p>é€šè¿‡cookie+sessionçš„æœºåˆ¶ï¼Œå®Œæˆå®ƒçš„æ— çŠ¶æ€ç‰¹ç‚¹</p><ol start="2"><li>å¤šæ¬¡è¯·æ±‚</li><li>åŸºäºTCPåè®®</li></ol><h3 id="åè®®ç‰ˆæœ¬å·"><a href="#åè®®ç‰ˆæœ¬å·" class="headerlink" title="åè®®ç‰ˆæœ¬å·"></a>åè®®ç‰ˆæœ¬å·</h3><h4 id="Http1-1å’ŒHttp1-0çš„åŒºåˆ«"><a href="#Http1-1å’ŒHttp1-0çš„åŒºåˆ«" class="headerlink" title="Http1.1å’ŒHttp1.0çš„åŒºåˆ«"></a>Http1.1å’ŒHttp1.0çš„åŒºåˆ«</h4><ol><li>HTTP/1.0åè®®ä½¿ç”¨éæŒä¹…è¿æ¥,å³åœ¨éæŒä¹…è¿æ¥ä¸‹,ä¸€ä¸ªtcpè¿æ¥åªä¼ è¾“ä¸€ä¸ªWebå¯¹è±¡ï¼›</li><li>HTTP/1.1é»˜è®¤ä½¿ç”¨æŒä¹…è¿æ¥(ç„¶è€Œ,HTTP/1.1åè®®çš„å®¢æˆ·æœºå’ŒæœåŠ¡å™¨å¯ä»¥é…ç½®æˆä½¿ç”¨éæŒä¹…è¿æ¥)ã€‚</li></ol><h4 id="HTTP2-0ä¸HTTP1-0çš„åŒºåˆ«"><a href="#HTTP2-0ä¸HTTP1-0çš„åŒºåˆ«" class="headerlink" title="HTTP2.0ä¸HTTP1.0çš„åŒºåˆ«"></a>HTTP2.0ä¸HTTP1.0çš„åŒºåˆ«</h4><ol><li><p>HTTP2.0çš„å¤šè·¯å¤ç”¨</p><p> æµè§ˆå™¨å¯¹åŒä¸€åŸŸåä¸‹çš„å¹¶å‘è¿æ¥æ•°é‡æœ‰é™åˆ¶ï¼Œä¸€èˆ¬ä¸º6ä¸ªï¼ŒHTTP1ä¸­çš„Keep-Aliveç”¨äºé•¿è¿æ¥è€Œä¸å¿…é‡æ–°å»ºç«‹è¿æ¥ï¼Œç„¶è€Œkeep-aliveå¿…é¡»ç­‰æœ¬æ¬¡è¯·æ±‚å½»åº•å®Œæˆåæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œè€ŒHTTP2çš„è¯·æ±‚ä¸å“åº”ä»¥äºŒè¿›åˆ¶å¸§çš„å½¢å¼äº¤é”™è¿›è¡Œï¼Œåªéœ€å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œå³ä¸€è½®ä¸‰æ¬¡æ¡æ‰‹ï¼Œå®ç°å¤šè·¯å¤ç”¨ã€‚</p></li><li><p>HTTP2.0å‹ç¼©æ¶ˆæ¯å¤´</p><p> HTTP1çš„æ¶ˆæ¯å¤´å¾ˆå¤§å†—ä½™ï¼Œè€ŒHTTP2.0åˆ©ç”¨HPACKå¯¹æ¶ˆæ¯å¤´è¿›è¡Œå‹ç¼©ä¼ è¾“ï¼Œå‡è®¾å°†å¸¸ç”¨çš„è¯·æ±‚GET/index.htmlç”¨1è¡¨ç¤ºï¼ŒPOST/index.htmlç”¨2è¡¨ç¤ºï¼Œå³æ˜¯å°†æ¶ˆæ¯å¤´ä¸­çš„ä¸åŒçš„éƒ¨åˆ†åˆ†åˆ«ç”¨ä¸ç”¨çš„ç´¢å¼•è¿›è¡Œè¡¨ç¤ºï¼Œä¸”ä¼šç”¨å“ˆå¤«æ›¼ç¼–ç å‹ç¼©å­—ç¬¦ä¸²ï¼Œæœ€åå°è£…æˆframeã€‚ç´¢å¼•è¡¨åˆ†ä¸ºåŠ¨æ€ç´¢å¼•å’Œé™æ€ç´¢å¼•ï¼ŒåŠ¨æ€ç´¢å¼•è¡¨åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å…±åŒç»´æŠ¤ï¼Œé™æ€ç´¢å¼•é‡‡ç”¨ç¡¬ç¼–ç å½¢å¼ã€‚</p></li><li><p>HTTP2.0æœåŠ¡ç«¯æ¨é€</p><p> HTTP2.0ä¸­æœåŠ¡å™¨ä¼šä¸»åŠ¨å°†èµ„æºæ¨é€ç»™å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚æŠŠjså’Œcssæ–‡ä»¶ä¸»åŠ¨æ¨é€ç»™å®¢æˆ·ç«¯è€Œä¸ç”¨å®¢æˆ·ç«¯è§£æHTMLåè¯·æ±‚å†å“åº”ã€‚</p></li></ol><h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>HTTPè¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´æ²¡æœ‰ä»»ä½•èº«ä»½ç¡®è®¤çš„è¿‡ç¨‹ï¼Œæ•°æ®å…¨éƒ¨æ˜æ–‡ä¼ è¾“ï¼Œâ€œè£¸å¥”â€åœ¨äº’è”ç½‘ä¸Šï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“é­åˆ°é»‘å®¢çš„æ”»å‡»åŠ«æŒè®©ç³»ç»Ÿç˜«ç—ªï¼Œå½“å®¢æˆ·ç«¯å‘é€è¯·æ±‚å¾ˆå®¹æ˜“è¢«é»‘å®¢æˆªè·ï¼Œå¦‚æœé»‘å®¢å†’å……ç›®æ ‡æœåŠ¡å™¨ï¼Œåˆ™å¯è¿”å›ä»»æ„ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œä¸è¢«å®¢æˆ·ç«¯æ‰€å¯Ÿè§‰ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå¬åˆ°â€œåŠ«æŒâ€ä¸€è¯ï¼Œæ‰€ä»¥ä½¿ç”¨ç›´æ¥ä½¿ç”¨HTTPä¼ è¾“æ˜¯æœ‰é£é™©çš„ã€‚ </p><p>HTTPSåè®®ï¼ˆHyperText Transfer Protocol over Secure Socket Layerï¼‰ï¼šå¯ä»¥ç†è§£ä¸ºHTTP+SSL/TLSï¼Œå³HTTPä¸‹åŠ å…¥SSLå±‚ï¼ŒHTTPSçš„å®‰å…¨åŸºç¡€æ˜¯ SSLï¼Œå› æ­¤åŠ å¯†çš„è¯¦ç»†å†…å®¹å°±éœ€è¦SSLï¼Œç”¨äºå®‰å…¨çš„HTTPæ•°æ®ä¼ è¾“ã€‚  </p><h3 id="å†å²"><a href="#å†å²" class="headerlink" title="å†å²"></a>å†å²</h3><ol><li>ç½‘è­¦å…¬å¸çš„SSL3.0 </li></ol><blockquote><pre><code>SSLï¼ˆSecure Socket Layerï¼Œå®‰å…¨å¥—æ¥å­—å±‚ï¼‰ï¼š1994å¹´ä¸ºç½‘æ™¯æ‰€ç ”å‘ï¼ŒSSLåè®®ä½äºTCP/IPåè®®ä¸å„ç§åº”ç”¨å±‚åè®®ä¹‹é—´ï¼Œä¸ºæ•°æ®é€šè®¯æä¾›å®‰å…¨æ”¯æŒã€‚ </code></pre></blockquote><ol start="2"><li>ISOCè¿™ä¸ªç»„ç»‡  åœ¨SSLçš„åŸºç¡€ä¸Šå‘å¸ƒäº†å‡çº§ç‰ˆæœ¬ TLS1.2</li></ol><blockquote><p>  TLSï¼ˆTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨ï¼‰ï¼šå…¶å‰èº«æ˜¯SSLï¼Œå®ƒæœ€åˆçš„å‡ ä¸ªç‰ˆæœ¬ï¼ˆSSL 1.0ã€SSL 2.0ã€SSL 3.0ï¼‰ç”±ç½‘æ™¯å…¬å¸å¼€å‘ï¼Œ1999å¹´ä»3.1 å¼€å§‹è¢«IETFæ ‡å‡†åŒ–å¹¶æ”¹åï¼Œå‘å±•è‡³ä»Šå·²ç»æœ‰ TLS 1.0ã€TLS 1.1ã€TLS 1.2 ä¸‰ä¸ªç‰ˆæœ¬ã€‚SSL3.0å’ŒTLS1.0ç”±äºå­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå·²ç»å¾ˆå°‘è¢«ä½¿ç”¨åˆ°ã€‚ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯TLS 1.1ã€TLS 1.2ã€‚ </p></blockquote><h3 id="HTTPSçš„å·¥ä½œåŸç†"><a href="#HTTPSçš„å·¥ä½œåŸç†" class="headerlink" title="HTTPSçš„å·¥ä½œåŸç†"></a>HTTPSçš„å·¥ä½œåŸç†</h3><p>å‡è®¾Aè¦ç»™Bå‘â€œæˆ‘çˆ±ä½ â€</p><p><img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/5.png" alt="HTTPSçš„å·¥ä½œåŸç†1"></p><h4 id="å¯¹ç§°åŠ è§£å¯†"><a href="#å¯¹ç§°åŠ è§£å¯†" class="headerlink" title="å¯¹ç§°åŠ è§£å¯†"></a>å¯¹ç§°åŠ è§£å¯†</h4><p>å¦‚æœä½¿ç”¨å¯¹ç§°åŠ è§£å¯†</p><p>Bæœ‰å¯†é’¥ï¼Œå¯ä»¥è¿›è¡Œç›¸åº”çš„è§£å¯†ã€‚ç”±äºå¯†é’¥æ˜¯å…¬å¼€çš„ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯éƒ½å¯ä»¥æ‹¿åˆ°ï¼Œå¦‚å›¾ï¼š</p><p><img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/6.png" alt="img"></p><p>è‹¥ï¼Œé’ˆå¯¹ä¸åŒçš„å®¢æˆ·ç«¯ä½¿ç”¨ä¸åŒçš„å¯†é’¥</p><p><img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/7.png" alt="img"></p><p>åˆä¼šå‡ºç°åå•†é—®é¢˜ï¼šç”±äºæ²¡æœ‰å…¬å…±çš„å¯†é’¥äº†ï¼ŒæœåŠ¡ç«¯è¦ç»™æ¯ä¸ªå®¢æˆ·ç«¯å‘å¯†é’¥ï¼Œä½†åå•†è¿‡ç¨‹æ˜¯æ²¡æœ‰åŠ å¯†çš„ï¼Œæ‰€ä»¥è¿˜ä¼šå‡ºç°è¢«æˆªæ–­çš„é—®é¢˜</p><h4 id="éå¯¹ç§°åŠ è§£å¯†"><a href="#éå¯¹ç§°åŠ è§£å¯†" class="headerlink" title="éå¯¹ç§°åŠ è§£å¯†"></a>éå¯¹ç§°åŠ è§£å¯†</h4><p>éå¯¹ç§°ï¼šå…¬é’¥å’Œç§é’¥çš„æ¦‚å¿µ </p><p><img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/8.png" alt="img"></p><p>é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼š å®¢æˆ·ç«¯å¦‚ä½•æ‹¿åˆ°å…¬é’¥ï¼Ÿ</p><p>æ–¹æ¡ˆï¼š</p><ol><li>æœåŠ¡å™¨ç«¯æŠŠå…¬é’¥å‘é€ç»™æ¯ä¸€ä¸ªå®¢æˆ·ç«¯</li><li>æœåŠ¡å™¨ç«¯æŠŠå…¬é’¥æ”¾åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥è¯·æ±‚åˆ°</li><li><p>è®©æµè§ˆå™¨ä¿å­˜æ‰€æœ‰çš„å…¬é’¥ï¼ˆä¸ç°å®ï¼‰</p><p>ç»“è®ºï¼š <strong>å…¬é’¥è¢«è°ƒåŒ…çš„é—®é¢˜æŒ‰ç…§ä¸Šé¢çš„æ–¹æ¡ˆï¼Œæ°¸è¿œå­˜åœ¨</strong>ã€‚</p></li></ol><p><img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/9.png" alt="img"></p><h4 id="ç¬¬ä¸‰æ–¹æœºæ„ä¸æ•°å­—è¯ä¹¦"><a href="#ç¬¬ä¸‰æ–¹æœºæ„ä¸æ•°å­—è¯ä¹¦" class="headerlink" title="ç¬¬ä¸‰æ–¹æœºæ„ä¸æ•°å­—è¯ä¹¦"></a>ç¬¬ä¸‰æ–¹æœºæ„ä¸æ•°å­—è¯ä¹¦</h4><p>è¿™æ—¶å€™å‡ºç°äº†é€šè¿‡ç¬¬ä¸‰æ–¹æœºæ„ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹æœºæ„çš„ç§é’¥å¯¹æˆ‘ä»¬éœ€è¦ä¼ è¾“çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ã€‚</p><p>æ•°å­—è¯ä¹¦æ˜¯ä¸€ä¸ªç»è¯ä¹¦æˆæƒä¸­å¿ƒæ•°å­—ç­¾åçš„åŒ…å«å…¬å¼€å¯†é’¥æ‹¥æœ‰è€…ä¿¡æ¯ä»¥åŠå…¬å¼€å¯†é’¥çš„æ–‡ä»¶ã€‚ </p><p>æ•°å­—è¯ä¹¦é‡Œé¢åŒ…å«çš„å†…å®¹ï¼š</p><p>å…¬å¸ä¿¡æ¯ã€ç½‘ç«™ä¿¡æ¯ã€æ•°å­—è¯ä¹¦çš„ç®—æ³•ã€å…¬é’¥</p><p>è¿æ¥è¿‡ç¨‹</p><p><img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/10.png" alt="img"></p><p> å¦‚ä½•æŸ¥çœ‹å…¬é’¥ï¼Ÿæµè§ˆå™¨æœ‰å…¥å£ç›´æ¥æ‰“å¼€ã€‚<img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/11.png" alt="1532596718384"></p><p><code>Charles</code>ä¹Ÿå¯ä»¥æ›´æ”¹æ·»åŠ SSL</p><p><img src="/2018/08/16/åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹é€šä¿¡åè®®HTTPçš„ç†è§£/12.png" alt="1532596877173"></p><h3 id="æ€»ä½“æµç¨‹"><a href="#æ€»ä½“æµç¨‹" class="headerlink" title="æ€»ä½“æµç¨‹"></a>æ€»ä½“æµç¨‹</h3><ol><li><p>å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªhttpsè¯·æ±‚</p><p>a)    å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†æ–¹å¼</p><p>b)   å®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºæ•°ï¼ˆç¬¬ä¸€ä¸ªéšæœºæ•°ï¼‰</p></li><li><p>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œæ‹¿åˆ°éšæœºæ•°ï¼Œè¿”å›</p><p>a)    è¯ä¹¦ï¼ˆé¢å‘æœºæ„ï¼ˆCAï¼‰ã€è¯ä¹¦å†…å®¹æœ¬èº«çš„æ•°å­—ç­¾åï¼ˆä½¿ç”¨ç¬¬ä¸‰æ–¹æœºæ„çš„ç§é’¥åŠ å¯†ï¼‰ã€è¯ä¹¦æŒæœ‰è€…çš„å…¬é’¥ã€è¯ä¹¦ç­¾åç”¨åˆ°çš„hashç®—æ³•ï¼‰</p><p>b)   ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼ˆç¬¬äºŒä¸ªéšæœºæ•°ï¼‰</p></li><li><p>å®¢æˆ·ç«¯æ‹¿åˆ°è¯ä¹¦ä»¥ååšéªŒè¯</p><p>a)    æ ¹æ®é¢å‘æœºæ„æ‰¾åˆ°æœ¬åœ°çš„è·Ÿè¯ä¹¦</p><p>b)   æ ¹æ®CAå¾—åˆ°æ ¹è¯ä¹¦çš„å…¬é’¥ï¼Œé€šè¿‡å…¬é’¥å¯¹æ•°å­—ç­¾åè§£å¯†ï¼Œå¾—åˆ°è¯ä¹¦çš„å†…å®¹æ‘˜è¦ A</p><p>c)    ç”¨è¯ä¹¦æä¾›çš„ç®—æ³•å¯¹è¯ä¹¦å†…å®¹è¿›è¡Œæ‘˜è¦ï¼Œå¾—åˆ°æ‘˜è¦ B</p><p>d)   é€šè¿‡Aå’ŒBçš„å¯¹æ¯”ï¼Œä¹Ÿå°±æ˜¯éªŒè¯æ•°å­—ç­¾å</p></li><li><p>éªŒè¯é€šè¿‡ä»¥åï¼Œç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼ˆç¬¬ä¸‰ä¸ªéšæœºæ•°ï¼‰ï¼Œé€šè¿‡è¯ä¹¦å†…çš„å…¬é’¥å¯¹è¿™ä¸ªéšæœºæ•°åŠ å¯†ï¼Œå‘é€ç»™æœåŠ¡å™¨ç«¯</p></li><li><p>ï¼ˆéšæœºæ•°1+2+3ï¼‰é€šè¿‡å¯¹ç§°åŠ å¯†å¾—åˆ°ä¸€ä¸ªå¯†é’¥ã€‚ï¼ˆä¼šè¯å¯†é’¥ï¼‰</p></li><li><p>é€šè¿‡ä¼šè¯å¯†é’¥å¯¹å†…å®¹è¿›è¡Œå¯¹ç§°åŠ å¯†ä¼ è¾“</p></li></ol><h3 id="HTTPSçš„ä¼˜ç‚¹"><a href="#HTTPSçš„ä¼˜ç‚¹" class="headerlink" title="HTTPSçš„ä¼˜ç‚¹"></a>HTTPSçš„ä¼˜ç‚¹</h3><p>1ã€SEOæ–¹é¢</p><p>è°·æ­Œæ›¾åœ¨2014å¹´8æœˆä»½è°ƒæ•´æœç´¢å¼•æ“ç®—æ³•ï¼Œå¹¶ç§°â€œæ¯”èµ·åŒç­‰HTTPç½‘ç«™ï¼Œé‡‡ç”¨HTTPSåŠ å¯†çš„ç½‘ç«™åœ¨æœç´¢ç»“æœä¸­çš„æ’åå°†ä¼šæ›´é«˜â€ã€‚</p><p>2ã€å®‰å…¨æ€§</p><p>å°½ç®¡HTTPSå¹¶éç»å¯¹å®‰å…¨ï¼ŒæŒæ¡æ ¹è¯ä¹¦çš„æœºæ„ã€æŒæ¡åŠ å¯†ç®—æ³•çš„ç»„ç»‡åŒæ ·å¯ä»¥è¿›è¡Œä¸­é—´äººå½¢å¼çš„æ”»å‡»ï¼Œä½†HTTPSä»æ˜¯ç°è¡Œæ¶æ„ä¸‹æœ€å®‰å…¨çš„è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š</p><p>ï¼ˆ1ï¼‰ä½¿ç”¨HTTPSåè®®å¯è®¤è¯ç”¨æˆ·å’ŒæœåŠ¡å™¨ï¼Œç¡®ä¿æ•°æ®å‘é€åˆ°æ­£ç¡®çš„å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ï¼›</p><p>ï¼ˆ2ï¼‰HTTPSåè®®æ˜¯ç”±SSL+HTTPåè®®æ„å»ºçš„å¯è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€èº«ä»½è®¤è¯çš„ç½‘ç»œåè®®ï¼Œè¦æ¯”httpåè®®å®‰å…¨ï¼Œå¯é˜²æ­¢æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«çªƒå–ã€æ”¹å˜ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><p>ï¼ˆ3ï¼‰HTTPSæ˜¯ç°è¡Œæ¶æ„ä¸‹æœ€å®‰å…¨çš„è§£å†³æ–¹æ¡ˆï¼Œè™½ç„¶ä¸æ˜¯ç»å¯¹å®‰å…¨ï¼Œä½†å®ƒå¤§å¹…å¢åŠ äº†ä¸­é—´äººæ”»å‡»çš„æˆæœ¬ã€‚</p><h3 id="HTTPSçš„ç¼ºç‚¹"><a href="#HTTPSçš„ç¼ºç‚¹" class="headerlink" title="HTTPSçš„ç¼ºç‚¹"></a>HTTPSçš„ç¼ºç‚¹</h3><p>ï¼ˆ1ï¼‰SSLè¯ä¹¦è´¹ç”¨å¾ˆé«˜ï¼Œä»¥åŠå…¶åœ¨æœåŠ¡å™¨ä¸Šçš„éƒ¨ç½²ã€æ›´æ–°ç»´æŠ¤éå¸¸ç¹ç</p><p>ï¼ˆ2ï¼‰HTTPSé™ä½ç”¨æˆ·è®¿é—®é€Ÿåº¦ï¼ˆå¤šæ¬¡æ¡æ‰‹ï¼‰</p><p>ï¼ˆ3ï¼‰ç½‘ç«™æ”¹ç”¨HTTPSä»¥åï¼Œç”±HTTPè·³è½¬åˆ°HTTPSçš„æ–¹å¼å¢åŠ äº†ç”¨æˆ·è®¿é—®è€—æ—¶ï¼ˆå¤šæ•°ç½‘ç«™é‡‡ç”¨302è·³è½¬ï¼‰</p><p>ï¼ˆ4ï¼‰HTTPSæ¶‰åŠåˆ°çš„å®‰å…¨ç®—æ³•ä¼šæ¶ˆè€—CPUèµ„æºï¼Œéœ€è¦å¢åŠ å¤§é‡æœºå™¨ï¼ˆhttpsè®¿é—®)</p><p>ï¼ˆ5ï¼‰HTTPSåè®®çš„åŠ å¯†èŒƒå›´ä¹Ÿæ¯”è¾ƒæœ‰é™ï¼Œåœ¨é»‘å®¢æ”»å‡»ã€æ‹’ç»æœåŠ¡æ”»å‡»ã€æœåŠ¡å™¨åŠ«æŒç­‰æ–¹é¢å‡ ä¹èµ·ä¸åˆ°ä»€ä¹ˆä½œç”¨ã€‚</p><h3 id="httpä¸httpsçš„åŒºåˆ«"><a href="#httpä¸httpsçš„åŒºåˆ«" class="headerlink" title="httpä¸httpsçš„åŒºåˆ«"></a>httpä¸httpsçš„åŒºåˆ«</h3><p>HTTPçš„URLä»¥ http://å¼€å¤´ï¼Œè€ŒHTTPSçš„URLä»¥https://å¼€å¤´ã€‚</p><p>HTTPæ˜¯ä¸å®‰å…¨çš„ï¼Œè€ŒHTTPSæ˜¯å®‰å…¨çš„ã€‚</p><p>HTTPæ ‡å‡†ç«¯å£æ˜¯80 ï¼Œè€ŒHTTPSçš„æ ‡å‡†ç«¯å£æ˜¯443ã€‚</p><p>åœ¨OSIç½‘ç»œæ¨¡å‹ä¸­ï¼ŒHTTPå·¥ä½œäºåº”ç”¨å±‚ï¼Œè€ŒHTTPSå·¥ä½œåœ¨ä¼ è¾“å±‚ã€‚</p><p>HTTPæ— éœ€åŠ å¯†ï¼Œè€ŒHTTPSå¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚</p><p>HTTPæ— éœ€è¯ä¹¦ï¼Œè€ŒHTTPSéœ€è¦è®¤è¯è¯ä¹¦ã€‚</p><h2 id="RESTful"><a href="#RESTful" class="headerlink" title="RESTful"></a>RESTful</h2><p>REST  ï¼šè¡¨è¿°æ€§çŠ¶æ€è½¬ç§»</p><p>RESTfulæ˜¯ä½¿ç”¨WEBæ ‡å‡†æ¥åšä¸€äº›å‡†åˆ™å’Œçº¦æŸã€‚</p><h3 id="RESTfulçš„åŸºæœ¬æ¦‚å¿µï¼š"><a href="#RESTfulçš„åŸºæœ¬æ¦‚å¿µï¼š" class="headerlink" title="RESTfulçš„åŸºæœ¬æ¦‚å¿µï¼š"></a>RESTfulçš„åŸºæœ¬æ¦‚å¿µï¼š</h3><ol><li><p>åœ¨RESTä¸­ï¼Œä¸€åˆ‡çš„å†…å®¹éƒ½è¢«è®¤ä¸ºæ˜¯ä¸€ç§<strong>èµ„æº</strong></p></li><li><p>æ¯ä¸ªèµ„æºéƒ½ç”±URIå”¯ä¸€æ ‡è¯†</p></li><li><p>ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£å¤„ç†èµ„æºè¯·æ±‚ï¼ˆPOST/GET/PUT/DELETE/HEADï¼‰</p></li><li><p>æ— çŠ¶æ€</p></li></ol><h3 id="èµ„æºå’ŒURI"><a href="#èµ„æºå’ŒURI" class="headerlink" title="èµ„æºå’ŒURI"></a>èµ„æºå’ŒURI</h3><ol><li><p>[/]è¡¨ç¤ºèµ„æºçš„å±‚çº§å…³ç³»</p></li><li><p>ï¼Ÿè¿‡æ»¤èµ„æº</p></li><li><p>ä½¿ç”¨_æˆ–è€…-è®©URIçš„å¯è¯»æ€§æ›´å¥½</p></li></ol><h3 id="ç»Ÿä¸€æ¥å£"><a href="#ç»Ÿä¸€æ¥å£" class="headerlink" title="ç»Ÿä¸€æ¥å£"></a>ç»Ÿä¸€æ¥å£</h3><p> GET  è·å–æŸä¸ªèµ„æºã€‚ å¹‚ç­‰</p><p> POST åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æº</p><p> PUT æ›¿æ¢æŸä¸ªå·²æœ‰çš„èµ„æºï¼ˆæ›´æ–°æ“ä½œï¼‰ ï¼Œ å¹‚ç­‰</p><p> DELETE åˆ é™¤æŸä¸ªèµ„æº</p><p> PATCH/HEAD æ›´æ–°éƒ¨åˆ†èµ„æº</p><h3 id="èµ„æºè¡¨è¿°"><a href="#èµ„æºè¡¨è¿°" class="headerlink" title="èµ„æºè¡¨è¿°"></a>èµ„æºè¡¨è¿°</h3><p>å®¢æˆ·ç«¯é€šè¿‡HTTPè·å–èµ„æº</p><p>MIME ç±»å‹ï¼ˆï¼‰</p><p>accept: text/xml   htmlæ–‡ä»¶</p><p>Content-Typeå‘Šè¯‰å®¢æˆ·ç«¯èµ„æºçš„è¡¨è¿°å½¢å¼</p><h3 id="èµ„æºé“¾æ¥"><a href="#èµ„æºé“¾æ¥" class="headerlink" title="èµ„æºé“¾æ¥"></a>èµ„æºé“¾æ¥</h3><p> è¶…åª’ä½“å³åº”ç”¨çŠ¶æ€å¼•æ“</p><h3 id="çŠ¶æ€è½¬ç§»"><a href="#çŠ¶æ€è½¬ç§»" class="headerlink" title="çŠ¶æ€è½¬ç§»"></a>çŠ¶æ€è½¬ç§»</h3><p>æœåŠ¡å™¨ç«¯ä¸åº”è¯¥ä¿å­˜å®¢æˆ·ç«¯çŠ¶æ€ã€‚</p><p>åº”ç”¨çŠ¶æ€-  &gt;æœåŠ¡å™¨ç«¯ä¸ä¿å­˜åº”ç”¨çŠ¶æ€</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a href="https://baike.baidu.com/item/http/243074" target="_blank" rel="noopener">ç™¾åº¦ç™¾ç§‘</a></p><p>æ„Ÿè°¢ï¼</p><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œç¼˜åˆ†å‘¢å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹~  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æˆ‘ä¸ºä»€ä¹ˆä¸æ–­çš„æ›´æ–°åšå®¢å‘¢ï¼Ÿè¿™æ˜¯ä¸€æ¬¡å¾ˆå¥½çš„æå‡æœºä¼šã€‚  å¹³æ—¶è§£å†³é—®é¢˜çš„æ—¶å€™å¯èƒ½è€ƒè™‘è¿›åº¦é—®é¢˜æ²¡æœ‰æ›´æ·±åˆ»åœ°å»ç†è§£ï¼Œä½†æ˜¯åœ¨å†™åšå®¢çš„æ—¶å€™ï¼Œä½ ä¼šä¸çŸ¥ä¸è§‰ä¸­å¯¹ä¸€äº›å†…å®¹è¿›è¡Œæ€è€ƒï¼Œå¹¶æœ‰å¯èƒ½å’Œè¯„è®ºè€…ä¸€èµ·æ·±å…¥ï¼Œè¿™äº›éƒ½æ˜¯éš¾å¾—çš„æœºä¼šã€‚ &lt;/p&gt;
&lt;p&gt;å¯èƒ½æœ‰äººä¼šé—®æˆ‘ï¼Œæˆ‘ä¸ºä»€ä¹ˆä¸æ–­çš„æ›´æ–°åšå®¢å‘¢ï¼Ÿ&lt;/p
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="å­¦å¥½åˆ†å¸ƒå¼æ¶æ„" scheme="https://tengshe789.github.io/tags/%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/"/>
    
      <category term="ç½‘ç»œ" scheme="https://tengshe789.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>å­¦å¥½åˆ†å¸ƒå¼æ¶æ„=3=-åˆ†å¸ƒå¼äº‹åŠ¡</title>
    <link href="https://tengshe789.github.io/2018/08/16/%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    <id>https://tengshe789.github.io/2018/08/16/å­¦å¥½åˆ†å¸ƒå¼æ¶æ„-åˆ†å¸ƒå¼äº‹åŠ¡/</id>
    <published>2018-08-16T04:05:30.000Z</published>
    <updated>2019-11-20T13:39:41.261Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ç¬¬äº”æœŸæ–‡ç« ã€‚è¿™ä¸€æœŸæˆ‘ä»¬èŠèŠåˆ†å¸ƒå¼äº‹åŠ¡</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h3 id="æ•°æ®åº“å•æœºäº‹åŠ¡"><a href="#æ•°æ®åº“å•æœºäº‹åŠ¡" class="headerlink" title="æ•°æ®åº“å•æœºäº‹åŠ¡"></a>æ•°æ®åº“å•æœºäº‹åŠ¡</h3><p>è¦äº†è§£åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé¦–å…ˆè¦æ˜ç™½ä»€ä¹ˆæ˜¯â€œäº‹åŠ¡â€ã€‚ã€‚</p><p>å¯ä»¥å‚è€ƒäº‹åŠ¡çš„å®šä¹‰ï¼š</p><blockquote><p>äº‹åŠ¡æ—¶æ•°æ®åº“è¿è¡Œä¸­çš„ä¸€ä¸ªé€»è¾‘å·¥ä½œå•å…ƒï¼Œå·¥ä½œå•å…ƒå†…çš„ä¸€ç³»åˆ—SQLå‘½ä»¤å…·æœ‰åŸå­æ€§æ“ä½œçš„ç‰¹ç‚¹ï¼Œè¿™äº›å‘½ä»¤è¦ä¹ˆå®Œå…¨æˆåŠŸè¿è¡Œï¼Œè¦ä¹ˆå®Œå…¨æ’¤é”€æˆ–è€…ä¸æ‰§è¡Œï¼Œå¦‚æœæ—¶åè€…ï¼Œåˆ™è¡¨ç°ä¸ºæ•°æ®åº“å†…çš„æœ€ç»ˆæ•°æ®æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚</p></blockquote><p>æ•°æ®åº“äº‹åŠ¡æ»¡è¶³4ä¸ªè¦æ±‚ï¼š</p><ol><li>åŸå­æ€§ï¼šäº‹åŠ¡å¿…é¡»æ—¶åŸå­å·¥ä½œå•å…ƒï¼Œå¯¹å…¶è¿›è¡Œæ•°æ®ä¿®æ”¹ï¼Œè¦ä¹ˆå…¨éƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</li><li>ä¸€è‡´æ€§ï¼šäº‹åŠ¡åœ¨å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰æ•°æ®éƒ½ä¿æŒä¸€è‡´çš„çŠ¶æ€ï¼Œäº‹åŠ¡ç»“æŸæ—¶ï¼Œæ‰€æœ‰å†…éƒ¨æ•°æ®ç»“æ„éƒ½å¿…é¡»æ—¶æ­£ç¡®çš„</li><li>éš”ç¦»æ€§ï¼šç”±å¹¶å‘äº‹åŠ¡åšå‡ºçš„ä¿®æ”¹å¿…é¡»å’Œå…¶ä»–å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹éš”ç¦»</li><li>æŒä¹…æ€§ï¼šäº‹åŠ¡å®Œæˆåï¼Œå¯¹ç³»ç»Ÿçš„å½±å“æ—¶æ°¸ä¹…çš„</li></ol><p>è¿™å…¶ä¸­åŸå­æ€§ï¼Œéœ€è¦è®°å½•æ“ä½œè¿‡ç¨‹å’Œå¯¹åº”ç»“æœï¼Œä»¥ä¾¿äºå›é€€ï¼›è€Œéš”ç¦»æ€§ï¼Œéœ€è¦äº§ç”Ÿé”ï¼›è¿™ä¸¤ç§è¦æ±‚ï¼Œå¯¼è‡´æ•°æ®åº“äº‹åŠ¡æ‰§è¡Œä»£ä»·è¦è¿œé«˜äºéäº‹åŠ¡æ€§æ“ä½œ</p><h4 id="MySQLæ‰§è¡Œäº‹åŠ¡"><a href="#MySQLæ‰§è¡Œäº‹åŠ¡" class="headerlink" title="MySQLæ‰§è¡Œäº‹åŠ¡"></a>MySQLæ‰§è¡Œäº‹åŠ¡</h4><p>åœ¨MySQLé‡Œï¼Œäº‹åŠ¡ç›¸å…³çš„æ—¥å¿—ä¸ºredoå’Œundoä¸¤ä¸ªæ–‡ä»¶ï¼Œredo logè®°å½•äº‹åŠ¡ä¿®æ”¹åçš„æ•°æ®ï¼Œundo logè®°å½•äº‹åŠ¡å‰çš„æ•°æ®</p><p>ä¸‹é¢æ—¶MySQLæ‰§è¡Œäº‹åŠ¡çš„ç®€åŒ–æµç¨‹ï¼š</p><ol><li>å…ˆè®°å½•undo/redo log ï¼Œç¡®ä¿æ—¥å¿—å†™å…¥ç¡¬ç›˜</li><li>æ›´æ–°æ•°æ®è®°å½•ï¼Œç¼“å­˜æ“ä½œå¹¶å¼‚æ­¥åˆ·æ–°ç¡¬ç›˜</li><li>commitäº‹åŠ¡æ“ä½œã€‚å…ˆæ¸…ç†undoä¿¡æ¯ï¼Œç„¶åé‡Šæ”¾é”èµ„æºï¼Œåœ¨redoä¸­å†™å…¥commitæ“ä½œï¼Œåˆ·æ–°åç¡®ä¿redoå®Œæˆå¹¶å­˜åœ¨ç¡¬ç›˜ä¸­ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ•°æ®åº“çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œå¾ˆå¤šæ“ä½œï¼Œè­¬å¦‚å†™æ—¥å¿—ä»¥é˜²å›æ»šï¼Œéƒ½æ˜¯åœ¨å†™commitä¹‹å‰å®Œæˆçš„ã€‚commitæŒ‡ä»¤åœ¨äº‹åŠ¡ä¸­æ‰€å æ—¶é—´éå¸¸å°‘ï¼Œè¿™å°±æ—¶äº‹åŠ¡çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹ã€‚</p><h3 id="X-OpenDTPäº‹åŠ¡æ¨¡å‹"><a href="#X-OpenDTPäº‹åŠ¡æ¨¡å‹" class="headerlink" title="X/OpenDTPäº‹åŠ¡æ¨¡å‹"></a>X/OpenDTPäº‹åŠ¡æ¨¡å‹</h3><p>åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡å†…çš„SQLå¾€å¾€æ“ä½œå¾ˆå¤šæ•°æ®åº“ï¼Œä¹Ÿè¦ä¿è¯äº‹åŠ¡çš„4ä¸ªè¦æ±‚ã€‚æ‰€ä»¥å°±æœ‰X/OpenDTPè¿™ä¸ªè§„èŒƒäº†</p><p>X/Open DTP å®šä¹‰äº†ä¸‰ä¸ªè§’è‰²ï¼š APï¼ŒTMï¼ŒRM</p><ul><li>AP(Application Program)ï¼šä¹Ÿå°±æ˜¯åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ç†è§£ä¸ºä½¿ç”¨DTPçš„ç¨‹åºï¼Œæˆ‘ä»¬crudçš„ä»£ç å°±æ˜¯è¿™ä¸ª</li><li>RM(Resource Manager)ï¼šèµ„æºç®¡ç†å™¨ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªDBMSç³»ç»Ÿï¼Œæˆ–è€…æ¶ˆæ¯æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿï¼Œåº”ç”¨ç¨‹åºé€šè¿‡èµ„æºç®¡ç†å™¨å¯¹èµ„æºè¿›è¡Œæ§åˆ¶ã€‚èµ„æºå¿…é¡»å®ç°XAå®šä¹‰çš„æ¥å£</li><li>TM(Transaction Manager)ï¼šäº‹åŠ¡ç®¡ç†å™¨ï¼Œè´Ÿè´£åè°ƒå’Œç®¡ç†äº‹åŠ¡ï¼Œæä¾›ç»™APåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ä»¥åŠç®¡ç†èµ„æºç®¡ç†å™¨</li></ul><p>å…¶ä¸­ï¼ŒAP å¯ä»¥å’ŒTM ä»¥åŠ RM é€šä¿¡ï¼ŒTM å’Œ RM äº’ç›¸ä¹‹é—´å¯ä»¥é€šä¿¡ï¼ŒDTPæ¨¡å‹é‡Œé¢å®šä¹‰äº†XAæ¥å£ï¼ŒTM å’Œ RM é€šè¿‡XAæ¥å£è¿›è¡ŒåŒå‘é€šä¿¡ï¼Œä¾‹å¦‚:TMé€šçŸ¥RMæäº¤äº‹åŠ¡æˆ–è€…å›æ»šäº‹åŠ¡ï¼ŒRMæŠŠæäº¤ç»“æœé€šçŸ¥ç»™TMã€‚APå’ŒRMä¹‹é—´åˆ™é€šè¿‡RMæä¾›çš„Native API è¿›è¡Œèµ„æºæ§åˆ¶ï¼Œè¿™ä¸ªæ²¡æœ‰è¿›è¡Œçº¦APIå’Œè§„èŒƒï¼Œå„ä¸ªå‚å•†è‡ªå·±å®ç°è‡ªå·±çš„èµ„æºæ§åˆ¶ï¼Œæ¯”å¦‚Oracleè‡ªå·±çš„æ•°æ®åº“é©±åŠ¨ç¨‹åºã€‚</p><p><img src="/2018/08/16/å­¦å¥½åˆ†å¸ƒå¼æ¶æ„-åˆ†å¸ƒå¼äº‹åŠ¡/\2012101111283859.jpg" alt="img"> </p><p>å…¶ä¸­åœ¨DTPå®šäº†ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š</p><p>äº‹åŠ¡ï¼šä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªå®Œæ•´çš„å·¥ä½œå•å…ƒï¼Œç”±å¤šä¸ªç‹¬ç«‹çš„è®¡ç®—ä»»åŠ¡ç»„æˆï¼Œè¿™å¤šä¸ªä»»åŠ¡åœ¨é€»è¾‘ä¸Šæ˜¯åŸå­çš„ã€‚</p><p>å…¨å±€äº‹åŠ¡ï¼šå¯¹äºä¸€æ¬¡æ€§æ“ä½œå¤šä¸ªèµ„æºç®¡ç†å™¨çš„äº‹åŠ¡ï¼Œå°±æ˜¯å…¨å±€äº‹åŠ¡</p><p>åˆ†æ”¯äº‹åŠ¡ï¼šåœ¨å…¨å±€äº‹åŠ¡ä¸­ï¼ŒæŸä¸€ä¸ªèµ„æºç®¡ç†å™¨æœ‰è‡ªå·±ç‹¬ç«‹çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡çš„é›†åˆä½œä¸ºè¿™ä¸ªèµ„æºç®¡ç†å™¨çš„åˆ†æ”¯ä»»åŠ¡</p><p>æ§åˆ¶çº¿ç¨‹ï¼šç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œä¸»è¦æ˜¯å…³è”AP,TM,RMä¸‰è€…çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯éœ€è¦æ ‡è¯†ä¸€ä¸ªå…¨å±€äº‹åŠ¡ä»¥åŠåˆ†æ”¯äº‹åŠ¡çš„å…³ç³»ã€‚</p><h4 id="ä¸¤é˜¶æ®µæäº¤åè®®"><a href="#ä¸¤é˜¶æ®µæäº¤åè®®" class="headerlink" title="ä¸¤é˜¶æ®µæäº¤åè®®"></a>ä¸¤é˜¶æ®µæäº¤åè®®</h4><p>ä¸‹é¢è¯´è¯´è¿™ä¸ªæ¨¡å‹ä¸­æœ€è‘—åçš„äºŒé˜¶æ®µæäº¤åè®®</p><p>å½“ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡æ‰€è®¾è®¡çš„SQLéƒ½æ‰§è¡Œå®Œæˆï¼Œæ‰“äº†RMæœ€åæäº¤äº‹åŠ¡çš„æ—¶å€™ï¼Œä¸ºäº†é¿å…åˆ†å¸ƒå¼ç³»ç»Ÿæ‰€å›ºæœ‰çš„ä¸å¯é æ€§å¯¼è‡´æäº¤äº‹åŠ¡å¤±è´¥ï¼ŒTMè¿™æ—¶å€™ä¼šèµ°äºŒé˜¶æ®µæäº¤åè®®</p><p><strong>ä¸¤é˜¶æ®µæäº¤åè®®</strong>ï¼šå¦‚æœä¸€ä¸ªäº‹åŠ¡ç®¡ç†å™¨ç®¡ç†ç€å¤šä¸ªèµ„æºç®¡ç†å™¨ï¼Œå¦‚æœæ§åˆ¶å…¨å±€äº‹åŠ¡å’Œåˆ†æ”¯äº‹åŠ¡ï¼Œåœ¨DTPé‡Œé¢è¯´æ˜ä¸¤é˜¶æ®µæäº¤çš„åè®®</p><p>ç¬¬ä¸€é˜¶æ®µï¼šå‘èµ·æŠ•ç¥¨è¡¨å†³</p><p>é€šçŸ¥æ‰€æœ‰RMå…ˆå®Œæˆäº‹åŠ¡æäº¤æ¶‰åŠçš„å¤æ‚å‡†å¤‡å·¥ä½œï¼Œè­¬å¦‚ä¸Šæ–‡æåˆ°çš„redoæ—¥å¿—ï¼Œå°½é‡æŠŠæäº¤è¿‡ç¨‹ä¸­æ‰€æœ‰æ¶ˆè€—æ—¶é—´çš„å·¥ä½œæå‰å®Œæˆï¼Œç¡®ä¿åé¢äº‹åŠ¡100%æˆåŠŸ</p><p>ç¬¬äºŒé˜¶æ®µï¼šæ­£å¼æäº¤</p><p>TMå°†ç¬¬ä¸€é˜¶æ®µçš„ç»“æœè¿›è¡Œå†³ç­–ï¼Œå³æäº¤æˆ–å–æ¶ˆäº‹åŠ¡ã€‚å½“ä¸”ä»…å½“æ‰€æœ‰å‚ä¸çš„RMåŒæ„æäº¤æ—¶ï¼ŒTMæ‰é€šçŸ¥æ‰€æœ‰RMæ­£å¼æäº¤äº‹åŠ¡ï¼Œå¦åˆ™åˆ™å–æ¶ˆäº‹åŠ¡ã€‚</p><p>ä¸‹é¢å¼•ç”¨å‚è€ƒæ–‡çŒ®çš„ä¸€å¹…å›¾ï¼Œè¯¦ç»†æ¼”ç¤ºäº†æ­£å¸¸æƒ…å†µä¸‹çš„ä¸¤é˜¶æ®µæäº¤ï¼Œ</p><p><img src="/2018/08/16/å­¦å¥½åˆ†å¸ƒå¼æ¶æ„-åˆ†å¸ƒå¼äº‹åŠ¡/2012101113135081.jpg" alt="img"></p><p>å¦‚æœç¬¬ä¸€é˜¶æ®µæŸä¸€ä¸ªèµ„æºé¢„æäº¤å¤±è´¥ï¼Œç¬¬äºŒé˜¶æ®µå°±å›æ»šç¬¬ä¸€é˜¶æ®µå·²ç»é¢„æäº¤æˆåŠŸçš„èµ„æº</p><p><img src="/2018/08/16/å­¦å¥½åˆ†å¸ƒå¼æ¶æ„-åˆ†å¸ƒå¼äº‹åŠ¡/2012101113140066.jpg" alt="img"></p><p> ä»¥ä¸Šæ˜¯æ¯”è¾ƒæ­£å¸¸çš„æƒ…å†µï¼Œä½†æ˜¯ç”±äºRMæœ‰æƒåˆ©è‡ªå·±æ ¹æ®æƒ…å†µæäº¤æˆ–è€…å›æ»šè‡ªå·±çš„åˆ†æ”¯äº‹åŠ¡ï¼ˆå®˜æ–¹è¯´æ³•æ˜¯ï¼š<strong>Heuristic Decision</strong>ï¼‰é‚£ä¸‰ä¹ˆå°±å¯èƒ½å‡ºç°ä»¥ä¸‹ç§æƒ…å†µï¼š</p><p>1 åœ¨TMé€šçŸ¥RMæäº¤äº‹åŠ¡ä¹‹å‰ï¼ŒRMåˆ†æ”¯äº‹åŠ¡å·²ç»æäº¤</p><p><img src="/2018/08/16/å­¦å¥½åˆ†å¸ƒå¼æ¶æ„-åˆ†å¸ƒå¼äº‹åŠ¡/2012101112573888.jpg" alt="img"></p><p>2 åœ¨TMé€šçŸ¥RMæäº¤äº‹åŠ¡ä¹‹å‰ï¼ŒRMåˆ†æ”¯äº‹åŠ¡å…¨éƒ¨å›æ»š</p><p><img src="/2018/08/16/å­¦å¥½åˆ†å¸ƒå¼æ¶æ„-åˆ†å¸ƒå¼äº‹åŠ¡/2012101112574795.jpg" alt="img"></p><p>3 åœ¨TMé€šçŸ¥RMæäº¤äº‹åŠ¡ä¹‹å‰ï¼ŒRMåˆ†æ”¯äº‹åŠ¡éƒ¨åˆ†å›æ»š</p><p><img src="/2018/08/16/å­¦å¥½åˆ†å¸ƒå¼æ¶æ„-åˆ†å¸ƒå¼äº‹åŠ¡/2012101112575470.jpg" alt="img"></p><h3 id="äº’è”ç½‘ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"><a href="#äº’è”ç½‘ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ" class="headerlink" title="äº’è”ç½‘ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"></a>äº’è”ç½‘ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</h3><p>ä¸‹é¢ä»‹ç»ä¸‰ç§äº’è”ç½‘ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</p><h4 id="ç¬¬ä¸€ç§ï¼šä¸ç”¨åˆ†å¸ƒå¼"><a href="#ç¬¬ä¸€ç§ï¼šä¸ç”¨åˆ†å¸ƒå¼" class="headerlink" title="ç¬¬ä¸€ç§ï¼šä¸ç”¨åˆ†å¸ƒå¼"></a>ç¬¬ä¸€ç§ï¼šä¸ç”¨åˆ†å¸ƒå¼</h4><p>è¿™ä¸ªæ–¹æ¡ˆæ—¶å°†ä¸€ä¸ªä¸šåŠ¡æµç¨‹ä¸­éœ€è¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œå¤šä¸ªç›¸å…³ä¸šåŠ¡æ¥å£åŒ…è£…åˆ°ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä»è€Œé¿å…åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><h4 id="ç¬¬äºŒç§ï¼šeBayæ–¹æ¡ˆ"><a href="#ç¬¬äºŒç§ï¼šeBayæ–¹æ¡ˆ" class="headerlink" title="ç¬¬äºŒç§ï¼šeBayæ–¹æ¡ˆ"></a>ç¬¬äºŒç§ï¼šeBayæ–¹æ¡ˆ</h4><h4 id="ç¬¬ä¸‰ç§ï¼š-æ”¯ä»˜å®DTSæ¡†æ¶"><a href="#ç¬¬ä¸‰ç§ï¼š-æ”¯ä»˜å®DTSæ¡†æ¶" class="headerlink" title="ç¬¬ä¸‰ç§ï¼š æ”¯ä»˜å®DTSæ¡†æ¶"></a>ç¬¬ä¸‰ç§ï¼š æ”¯ä»˜å®DTSæ¡†æ¶</h4><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://www.cnblogs.com/aigongsi/archive/2012/10/11/2718313.html" target="_blank" rel="noopener">X/Open DTP(X/Open Distributed Transaction Processing Reference Model) </a></p><p>æ„Ÿè°¢</p><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œ<strong>ç¼˜åˆ†å‘¢</strong>å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹ï¼Œå’±ä»¬ä¸¤ä¸ªæƒ³ä¸ªå·ç ï¼Œ ä¹°ä¸ªå½©ç¥¨ï¼Œå…ˆæŒ£ä»–ä¸ªå‡ ç™¾ä¸‡ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™æ˜¯ç¬¬äº”æœŸæ–‡ç« ã€‚è¿™ä¸€æœŸæˆ‘ä»¬èŠèŠåˆ†å¸ƒå¼äº‹åŠ¡&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.tech/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æˆ‘çš„åšå®¢&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;æ•°æ®åº“å•
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="å­¦å¥½åˆ†å¸ƒå¼æ¶æ„" scheme="https://tengshe789.github.io/tags/%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>å­¦å¥½åˆ†å¸ƒå¼æ¶æ„=1=-TCP/IP</title>
    <link href="https://tengshe789.github.io/2018/08/16/%E6%88%91%E8%A6%81%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F-TCP-IP/"/>
    <id>https://tengshe789.github.io/2018/08/16/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-TCP-IP/</id>
    <published>2018-08-15T23:10:25.000Z</published>
    <updated>2019-11-20T13:39:41.390Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ†å¸ƒå¼ä¸ç½‘ç»œäº’è”å°¤ä¸ºå¯†åˆ‡ï¼Œè€ŒTCP/IPï¼ˆä¼ è¾“æ§åˆ¶åè®®/äº’è”ç½‘ç»œåè®®ï¼‰æ˜¯ç½‘ç»œä¸­æœ€åŸºæœ¬çš„åè®®ã€‚TCP/IPç»“åˆDNSã€è·¯ç”±ç›¸å…³çš„åè®®æœ€ç»ˆå®ç°çš„äº†ç½‘ç»œçš„ä»»æ„ä¸¤ç‚¹çš„æ•°æ®é€šä¿¡é—®é¢˜ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a>ã€‚</p><h3 id="åè®®æ€ä¹ˆåˆ†å±‚çš„å‘¢ï¼Ÿ"><a href="#åè®®æ€ä¹ˆåˆ†å±‚çš„å‘¢ï¼Ÿ" class="headerlink" title="åè®®æ€ä¹ˆåˆ†å±‚çš„å‘¢ï¼Ÿ"></a>åè®®æ€ä¹ˆåˆ†å±‚çš„å‘¢ï¼Ÿ</h3><p>æåˆ°åè®®åˆ†å±‚ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“è”æƒ³åˆ°ISO-OSIçš„ä¸ƒå±‚åè®®ç»å…¸æ¶æ„ï¼Œä½†æ˜¯TCP/IPåè®®æ—çš„ç»“æ„åˆ™ç¨æœ‰ä¸åŒã€‚ </p><table><thead><tr><th>OSIä¸ƒå±‚ç½‘ç»œæ¨¡å‹</th><th>TCP/IPå››å±‚æ¦‚å¿µæ¨¡å‹</th><th>å¯¹åº”ç½‘ç»œåè®®</th></tr></thead><tbody><tr><td>åº”ç”¨å±‚ï¼ˆApplicationï¼‰</td><td>åº”ç”¨å±‚</td><td>HTTPã€TFTP, FTP, NFS, WAISã€SMTP</td></tr><tr><td>è¡¨ç¤ºå±‚ï¼ˆPresentationï¼‰</td><td>Telnet, Rlogin, SNMP, Gopher</td><td></td></tr><tr><td>ä¼šè¯å±‚ï¼ˆSessionï¼‰</td><td>SMTP, DNS</td><td></td></tr><tr><td>ä¼ è¾“å±‚ï¼ˆTransportï¼‰</td><td>ä¼ è¾“å±‚</td><td>TCP, UDP</td></tr><tr><td>ç½‘ç»œå±‚ï¼ˆNetworkï¼‰</td><td>ç½‘ç»œå±‚</td><td>IP, ICMP, ARP, RARP, AKP, UUCP</td></tr><tr><td>æ•°æ®é“¾è·¯å±‚ï¼ˆData Linkï¼‰</td><td>æ•°æ®é“¾è·¯å±‚</td><td>FDDI, Ethernet, Arpanet, PDN, SLIP, PPP</td></tr><tr><td>ç‰©ç†å±‚ï¼ˆPhysicalï¼‰</td><td>IEEE 802.1A, IEEE 802.2åˆ°IEEE 802.11</td></tr></tbody></table><p>TCP/IPåè®®æ—æŒ‰ç…§å±‚æ¬¡ç”±ä¸Šåˆ°ä¸‹ï¼Œå±‚å±‚åŒ…è£…ã€‚</p><p><img src="/2018/08/16/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-TCP-IP/å¾®ä¿¡å›¾ç‰‡_20180908211733.jpg" alt="img"></p><p>æœ€ä¸Šé¢çš„å°±æ˜¯åº”ç”¨å±‚äº†ï¼Œè¿™é‡Œé¢æœ‰httpï¼Œftp,ç­‰ç­‰æˆ‘ä»¬ç†Ÿæ‚‰çš„åè®®ã€‚</p><p>ç¬¬äºŒå±‚åˆ™æ˜¯ä¼ è¾“å±‚ï¼Œè‘—åçš„TCPå’ŒUDPåè®®å°±åœ¨è¿™ä¸ªå±‚æ¬¡ï¼Œæˆ‘ä»¬ç†ŸçŸ¥çš„ç½‘é¡µå¤§éƒ¨åˆ†æ˜¯ç”±TCPä¼ è¾“çš„ï¼Œè€Œç©çš„æ¸¸æˆå¤§éƒ¨åˆ†æ˜¯ç”±UDPä¼ è¾“çš„ã€‚</p><p>ç¬¬ä¸‰å±‚æ˜¯ç½‘ç»œå±‚ï¼ŒIPåè®®å°±åœ¨è¿™é‡Œï¼Œå®ƒè´Ÿè´£å¯¹æ•°æ®åŠ ä¸ŠIPåœ°å€å’Œå…¶ä»–çš„æ•°æ®ä»¥ç¡®å®šä¼ è¾“çš„ç›®æ ‡ã€‚</p><p>ç¬¬å››å±‚æ˜¯å«æ•°æ®é“¾è·¯å±‚ï¼Œè¿™ä¸ªå±‚æ¬¡ä¸ºå¾…ä¼ é€çš„æ•°æ®åŠ å…¥ä¸€ä¸ªä»¥å¤ªç½‘åè®®å¤´ï¼Œå¹¶è¿›è¡ŒCRCç¼–ç ï¼Œä¸ºæœ€åçš„æ•°æ®ä¼ è¾“åšå‡†å¤‡ã€‚</p><p>TCP/IPå››å±‚åè®®ä¸OSIä¸ƒå±‚ç½‘ç»œæ¨¡å‹å±‚å±‚ç›¸å¯¹ï¼Œç»“æ„åˆ†æ˜ã€‚</p><h3 id="åè®®æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ"><a href="#åè®®æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ" class="headerlink" title="åè®®æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ"></a>åè®®æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ</h3><p>æ‰“å¼€cmdï¼ˆæœ¬äººwindowså¹³å°ï¼‰ï¼Œè¾“å…¥è¿è¡Œ<code>ipconfig/all</code></p><p><img src="/2018/08/16/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-TCP-IP/1534376209389.png" alt="ipconfig/all"></p><p>è¿™é‡Œå°±å¯ä»¥æ¸…æ¥šçš„æ˜¾ç¤ºå‡ºæ¥æˆ‘PCçš„å„ç§ç½‘è·¯ä¿¡æ¯ï¼Œç”šè‡³æˆ‘PCå‡ ä¸ªç½‘å¡éƒ½èƒ½çœ‹çš„ä¸€æ¸…äºŒæ¥šã€‚</p><h3 id="ä¼ è¾“è¿‡ç¨‹"><a href="#ä¼ è¾“è¿‡ç¨‹" class="headerlink" title="ä¼ è¾“è¿‡ç¨‹"></a>ä¼ è¾“è¿‡ç¨‹</h3><h4 id="æœ¬åœ°ä¼ è¾“"><a href="#æœ¬åœ°ä¼ è¾“" class="headerlink" title="æœ¬åœ°ä¼ è¾“"></a>æœ¬åœ°ä¼ è¾“</h4><p>å¦‚æœæˆ‘ä»¬æµè§ˆç½‘é¡µï¼Œé€šå¸¸ä¼šåœ¨æµè§ˆå™¨åœ°å€æ ä¸­æ‰“ä¸Š3ä¸ªwå’Œç½‘ç«™çš„åå­—ï¼Œå°±è­¬å¦‚æ‰“å¼€ç™¾åº¦éœ€è¦è¾“å…¥WWW.BAIDU.COMï¼Œè¿™ä¸ªåå­—å°±å«åŸŸåã€‚æˆ‘ä»¬çš„æµè§ˆå™¨ä¼šå‘ç°urlä¸­ç½‘ç«™çš„åŸŸåï¼Œç„¶åæŸ¥æ‰¾æœ¬åœ°çš„hostæ–‡ä»¶ï¼Œæ ¹æ®hostæ–‡ä»¶æŸ¥æ‰¾å“åº”çš„dnsæœåŠ¡å™¨ipåœ°å€ï¼Œç”¨UDPåè®®å‘dnsæœåŠ¡å™¨å‘é€dnsæŸ¥è¯¢å‘½ä»¤ï¼ŒdnsæœåŠ¡å™¨è·å–åˆ°æŸ¥è¯¢å‘½ä»¤å¹¶ä»ç¼“å­˜æˆ–è€…æ•°æ®åº“ä¸­æŸ¥è¯¢æ”¹åŸŸåå¯¹åº”ä¸»æœºçš„ipåœ°å€ï¼Œå†å°†è¿™ä¸ªipåœ°å€å‘åˆ°ä½ æµè§ˆå™¨ä¸Šã€‚</p><p>æœ‰ç‚¹ç»•å£ï¼Œå®é™…ä½ å¯ä»¥ä½¿ç”¨cmdçš„<code>nslookup</code>æ¥è·Ÿè¸ªè¿™ä¸ªè¿‡ç¨‹ã€‚</p><p><img src="/2018/08/16/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-TCP-IP/1534377034171.png" alt="nslookup"></p><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œä½¿ç”¨å¤šæ¬¡å‘½ä»¤æŸ¥è¯¢ï¼Œå¾—åˆ°çš„ipç»“æœæ€»æ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™æ˜¯å› ä¸ºdnsæœ‰è´Ÿè½½å‡è¡¡æœºåˆ¶ï¼ŒæœåŠ¡å™¨ä¼šæŸ¥è¯¢å¹¶è¿”å›å¤šä¸ªipåœ°å€ï¼Œæ¯æ¬¡æŸ¥è¯¢è¿”å›çš„ipåœ°å€å¯èƒ½æœ‰æ‰€ä¸åŒã€‚</p><p>æ¥ç€å¾€ä¸‹è¯´ï¼Œå½“æˆ‘ä»¬æµè§ˆå™¨è·çŸ¥è¿™ä¸ªipåœ°å€çš„æ—¶å€™ï¼Œå°±å‘è¿™ä¸ªipåœ°å€çš„80ç«¯å£ï¼ˆHTTPæ ‡å‡†ç«¯å£æ˜¯80 ï¼Œè€ŒHTTPSçš„æ ‡å‡†ç«¯å£æ˜¯443ï¼‰å‘èµ·TCPè¿æ¥ï¼Œä½†å…¶å®è¿™ä¸ªipåœ°å€å¹¶ä¸æ˜¯è®¡ç®—æœºæ‰€åœ¨çš„å±€åŸŸç½‘ï¼Œè€Œæ˜¯ä¸€ä¸ªå¹¿åŸŸç½‘åœ°å€ï¼Œæ‰€ä»¥å­ç½‘çš„ç½‘å…³å°±éœ€è¦é€šè¿‡è·¯ç”±è½¬å‘äº†</p><h4 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h4><p>äº’è”ç½‘æ˜¯ç”±å¾ˆå¤šç›¸äº’éš”ç¦»çš„å°ç½‘ç»œæ— é™å»¶ä¼¸è€Œæˆçš„ä¸€ä¸ªå¤§ç½‘ç»œï¼Œè·¯ç”±å™¨è´Ÿè´£å°†å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œå¹¶äº¤æ¢è·¯ç”±è¡¨ä¿¡æ¯æ¥ç¡®å®šä¸€ä¸ªIPæŠ¥æ–‡è¦ç»è¿‡å“ªä¸ªè·¯ç”±å™¨çš„å“ªä¸ªç«¯å£å‘ç»™å“ªä¸ªäº’è”çš„å­ç½‘ã€‚</p><p>ä¸ºäº†é˜²æ­¢ä¸€ä¸ªæ•°æ®åŒ…åœ¨å‘é€è¿‡ç¨‹ä¸­å½¢æˆæ­»å¾ªç¯ï¼ŒipåŒ…ä¸­çš„TTLå­—æ®µæ¯ç»è¿‡è·¯ç”±å™¨è½¬å‘ä¸€æ¬¡ï¼Œå°±ä¼š-1ã€‚å½“TTLä¸º0æ—¶åˆ™è¢«ä¸¢å¼ƒï¼Œè®¤ä¸ºç½‘ç»œä¸å¯è¾¾ï¼Œä¸€èˆ¬é»˜è®¤çš„æœ€å¤§TTLæ˜¯30</p><p>åŒæ ·æˆ‘ä»¬å¯ä»¥ä½¿ç”¨tracertæ¥è·Ÿè¸ªè¿™ä¸ªè¿‡ç¨‹ã€‚tacertæ˜¯æ ¹æ®ICMPåè®®æ¥ç¡®å®šä¸€ä¸ªipæŠ¥æ–‡åˆ°è¾¾ç›®æ ‡åœ°å€æ‰€ç»è¿‡çš„è·¯ç”±å™¨èŠ‚ç‚¹</p><p><img src="/2018/08/16/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-TCP-IP/1534378012831.png" alt="1534378012831"></p><h3 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h3><p>socketæ—¶ä¸€ä¸ªipåœ°å€ä¸ç«¯å£çš„ç»„åˆï¼Œæ˜¯è®¡ç®—æœºçš„è¿œç¨‹é€šä¿¡æ¥å£ï¼Œæœ¬åœ°ä¸€ä¸ªsocketä¸è¿œç¨‹socketè¿æ¥çš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚</p><h4 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h4><p><img src="/2018/08/16/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-TCP-IP/1159846-20170605223656153-365910138.png" alt="img"> </p><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘é€synåŒ…(SYN = 1ï¼Œåºåˆ—å·seq = xï¼ŒSYNæŠ¥æ–‡æ®µä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†è¦æ¶ˆè€—ä¸€ä¸ªåˆå§‹åºå·)åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥SYN_SENDçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ã€‚</p><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨æ”¶åˆ°synåŒ…ï¼Œå¿…é¡»ç¡®è®¤å®¢æˆ·çš„SYNï¼ˆack=x+1ï¼‰ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªSYNåŒ…ï¼ˆSYN=1 ACK=1 seq=yï¼ŒåŒæ ·æ¶ˆè€—ä¸€ä¸ªåºå·ï¼‰ï¼Œå³SYN+ACKåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVçŠ¶æ€ã€‚</p><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYNï¼‹ACKåŒ… ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤åŒ…ACK(ACK = 1 seq = x + 1 ack = y + 1ï¼ŒACKæŠ¥æ–‡æ®µå¯ä»¥æºå¸¦æ•°æ®ï¼Œä½†å¦‚æœä¸æºå¸¦æ•°æ®åˆ™ä¸æ¶ˆè€—åºå·ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¸‹ä¸€ä¸ªæ•°æ®æŠ¥æ–‡æ®µçš„åºå·ä»æ˜¯seq=x+1)ï¼Œæ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚</p><blockquote><p>å„ä¸ªçŠ¶æ€åç§°ä¸å«ä¹‰<br>CLOSED: è¡¨ç¤ºåˆå§‹çŠ¶æ€ã€‚<br>LISTEN: æœåŠ¡å™¨ç«¯å¤„äºç›‘å¬çŠ¶æ€ï¼Œå¯ä»¥æ¥å—è¿æ¥ã€‚<br>SYN_RECV: å½“æ”¶åˆ°å®¢æˆ·ç«¯çš„ACKæŠ¥æ–‡åï¼ŒæœåŠ¡å™¨ä¼šè¿›å…¥åˆ°ESTABLISHEDçŠ¶æ€ã€‚<br>SYN_SENT: å½“å®¢æˆ·ç«¯å‘é€SYNæŠ¥æ–‡ï¼Œéšå³å®ƒä¼šè¿›å…¥åˆ°äº†SYN_SENTçŠ¶æ€ï¼Œå¹¶ç­‰å¾…æœåŠ¡ç«¯çš„å‘é€ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ç¬¬2ä¸ªæŠ¥æ–‡ã€‚<br>ESTABLISHEDï¼šè¡¨ç¤ºè¿æ¥å·²ç»å»ºç«‹äº†ã€‚</p></blockquote><h4 id="å››æ¬¡æŒ¥æ‰‹"><a href="#å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹"></a>å››æ¬¡æŒ¥æ‰‹</h4><p><img src="/2018/08/16/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-TCP-IP/1159846-20170605225514606-1138877138.png" alt="img"> </p><p>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šä¸»åŠ¨å…³é—­æ–¹å‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­ä¸»åŠ¨æ–¹åˆ°è¢«åŠ¨å…³é—­æ–¹çš„æ•°æ®ä¼ é€ï¼Œä¹Ÿå°±æ˜¯ä¸»åŠ¨å…³é—­æ–¹å‘Šè¯‰è¢«åŠ¨å…³é—­æ–¹ï¼šæˆ‘å·²ç»ä¸ä¼šå†ç»™ä½ å‘æ•°æ®äº†(å½“ç„¶ï¼Œåœ¨finåŒ…ä¹‹å‰å‘é€å‡ºå»çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°å¯¹åº”çš„ackç¡®è®¤æŠ¥æ–‡ï¼Œä¸»åŠ¨å…³é—­æ–¹ä¾ç„¶ä¼šé‡å‘è¿™äº›æ•°æ®)ï¼Œä½†æ˜¯ï¼Œæ­¤æ—¶ä¸»åŠ¨å…³é—­æ–¹è¿˜å¯ä»¥æ¥å—æ•°æ®ã€‚</p><p>ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šè¢«åŠ¨å…³é—­æ–¹æ”¶åˆ°FINåŒ…åï¼Œå‘é€ä¸€ä¸ªACKç»™å¯¹æ–¹ï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°åºå·+1ï¼ˆä¸SYNç›¸åŒï¼Œä¸€ä¸ªFINå ç”¨ä¸€ä¸ªåºå·ï¼‰ã€‚</p><p>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šè¢«åŠ¨å…³é—­æ–¹å‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­è¢«åŠ¨å…³é—­æ–¹åˆ°ä¸»åŠ¨å…³é—­æ–¹çš„æ•°æ®ä¼ é€ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰ä¸»åŠ¨å…³é—­æ–¹ï¼Œæˆ‘çš„æ•°æ®ä¹Ÿå‘é€å®Œäº†ï¼Œä¸ä¼šå†ç»™ä½ å‘æ•°æ®äº†ã€‚</p><p>ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šä¸»åŠ¨å…³é—­æ–¹æ”¶åˆ°FINåï¼Œå‘é€ä¸€ä¸ªACKç»™è¢«åŠ¨å…³é—­æ–¹ï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°åºå·+1ï¼Œè‡³æ­¤ï¼Œå®Œæˆå››æ¬¡æŒ¥æ‰‹ã€‚</p><blockquote><p> å„ä¸ªçŠ¶æ€åç§°ä¸å«ä¹‰</p><p>FIN-WAIT-1ï¼šç­‰å¾…è¿œç¨‹TCPçš„è¿æ¥ä¸­æ–­è¯·æ±‚ã€‚</p><p>FIN-WAIT-2ï¼šä»è¿œç¨‹TCPç­‰å¾…è¿æ¥ä¸­æ–­è¯·æ±‚ã€‚</p><p>CLOSE-WAITï¼šç­‰å¾…ä»æœ¬åœ°ç”¨æˆ·å‘æ¥çš„è¿æ¥ä¸­æ–­è¯·æ±‚ã€‚ </p><p>CLOSINGï¼šç­‰å¾…è¿œç¨‹TCPå¯¹è¿æ¥ä¸­æ–­çš„ç¡®è®¤ã€‚</p><p>LAST-ACKï¼šç­‰å¾…åŸæ¥å‘å‘è¿œç¨‹TCPçš„è¿æ¥ä¸­æ–­è¯·æ±‚çš„ç¡®è®¤ï¼› </p><p>TIME-WAITï¼šç­‰å¾…è¶³å¤Ÿçš„æ—¶é—´ä»¥ç¡®ä¿è¿œç¨‹TCPæ¥æ”¶åˆ°è¿æ¥ä¸­æ–­è¯·æ±‚çš„ç¡®è®¤</p></blockquote><h3 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h3><h4 id="å¸¸è§ç«¯å£"><a href="#å¸¸è§ç«¯å£" class="headerlink" title="å¸¸è§ç«¯å£"></a>å¸¸è§ç«¯å£</h4><blockquote><p>FTP 21</p><p>telnet 23</p><p>åŸŸåæœåŠ¡å™¨ 53</p><p>POP3 110</p><p>MySQL 3306</p><p>POP-2 109</p><p>SNMP 161</p><p>SSH 22</p><p>SMTP 25</p><p>HTTP 80</p><p>NTP 123</p><p>shellæˆ–è€…cmd 514</p><p>SQL Server 1433</p></blockquote><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œ<strong>ç¼˜åˆ†å‘¢</strong>å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹ï¼Œå’±ä»¬ä¸¤ä¸ªæƒ³ä¸ªå·ç ï¼Œ ä¹°ä¸ªå½©ç¥¨ï¼Œå…ˆæŒ£ä»–ä¸ªå‡ ç™¾ä¸‡ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åˆ†å¸ƒå¼ä¸ç½‘ç»œäº’è”å°¤ä¸ºå¯†åˆ‡ï¼Œè€ŒTCP/IPï¼ˆä¼ è¾“æ§åˆ¶åè®®/äº’è”ç½‘ç»œåè®®ï¼‰æ˜¯ç½‘ç»œä¸­æœ€åŸºæœ¬çš„åè®®ã€‚TCP/IPç»“åˆDNSã€è·¯ç”±ç›¸å…³çš„åè®®æœ€ç»ˆå®ç°çš„äº†ç½‘ç»œçš„ä»»æ„ä¸¤ç‚¹çš„æ•°æ®é€šä¿¡é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe7
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="å­¦å¥½åˆ†å¸ƒå¼æ¶æ„" scheme="https://tengshe789.github.io/tags/%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/"/>
    
      <category term="ç½‘ç»œ" scheme="https://tengshe789.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>æ”¶åˆ°ä¸€ä¸ªä»¤æˆ‘æ‚²ä¼¤çš„æ¶ˆæ¯</title>
    <link href="https://tengshe789.github.io/2018/08/06/%E6%94%B6%E5%88%B0%E4%B8%80%E4%B8%AA%E4%BB%A4%E6%88%91%E6%82%B2%E4%BC%A4%E7%9A%84%E6%B6%88%E6%81%AF/"/>
    <id>https://tengshe789.github.io/2018/08/06/æ”¶åˆ°ä¸€ä¸ªä»¤æˆ‘æ‚²ä¼¤çš„æ¶ˆæ¯/</id>
    <published>2018-08-06T09:02:28.000Z</published>
    <updated>2019-11-20T13:39:41.532Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘çš„è¯¥æ­»çš„VPSæä¾›å•†åˆè¦ç ´paoäº§luäº†ï¼Œæ°”æ­»æˆ‘ä¹Ÿã€‚æœ€è¿‘çš„vpsæœåŠ¡éƒ½ä¸èƒ½ç”¨äº†ï¼ŒMySQLä¸€è¿ä¸€ä¸ªå¤±è´¥ã€‚åæ¥ä»–ä»¬ç»™æˆ‘å‘äº†ä¸€å°é‚®ä»¶</p><p>ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><p><img src="/2018/08/06/æ”¶åˆ°ä¸€ä¸ªä»¤æˆ‘æ‚²ä¼¤çš„æ¶ˆæ¯/1533546896065.png" alt="1533546896065"></p><p>ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†</p><p>å¤§æ¦‚æ„æ€æ˜¯ä»–ä»¬å®Œäº†ï¼Œè¦æŠŠæœºå™¨æœåŠ¡è½¬ç»™æˆ‘çš„å¦ä¸€ä¸ªè€ä¸œå®¶NFHostingï¼Œå¯¹ï¼Œæ²¡é”™ã€‚å°±æ˜¯ç»™æˆ‘æä¾›ä¸Šä¸€ä¸ªåšå®¢æœåŠ¡çš„æ•°æ®ä¸­å¿ƒã€‚</p><p>è¯¥æ­»çš„ï¼Œæˆ‘ä¸Šä¸€ä¸ªåšå®¢çš„æ•°æ®è‡³ä»Šæ²¡æ‰¾å›æ¥ï¼</p><p>è¡Œå§ï¼Œæˆ‘å·²ç»æ— æ‰€è°“äº†ã€‚å°±å½“è€ƒéªŒæˆ‘çš„è¿ç»´æ°´å¹³äº†ï¼Œæ­å»ºä¸ªRabbitMQï¼ŒMySQLï¼Œredisï¼Œé˜¿å¸•å¥‡ï¼Œå¯¹è¿™ç§å•æ ¸VPSï¼Œä¸å°±ä¸€ä¸Šåˆä¹ˆï¼Ÿæˆ‘å¹²è¿˜ä¸è¡Œä¹ˆï¼Ÿ</p><p>äºæ˜¯ä¹ï¼Œæˆ‘æŒ‰ç…§ä»–ä»¬çš„æµç¨‹å›å¤äº†é‚®ä»¶ã€‚</p><p><img src="/2018/08/06/æ”¶åˆ°ä¸€ä¸ªä»¤æˆ‘æ‚²ä¼¤çš„æ¶ˆæ¯/1533547252189.png" alt="1533547252189"></p><p>ç„¶åï¼Œå°±æ²¡æœ‰ç„¶åäº†ã€‚è¿™å®¶å…¬å¸çš„å·¥ç¨‹å¸ˆæ²¡ä¸€ä¸ªç†æˆ‘çš„ğŸ™ƒ</p><p>ä¸èƒ½è‡ªç”˜å •è½å•Šï¼æˆ‘å¿ƒä¸­ç‡ƒæ°”äº†é›„å‡¶å¤§ç«ï¼</p><p>äºæ˜¯ä¹ï¼Œç»æœ›çš„å‘äº†ä¸ªrepost</p><p><img src="/2018/08/06/æ”¶åˆ°ä¸€ä¸ªä»¤æˆ‘æ‚²ä¼¤çš„æ¶ˆæ¯/1533547176317.png" alt="1533547176317"></p><p>å¸Œæœ›ç¥ä¸æˆ‘åŒåœ¨å§ã€‚ã€‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æˆ‘çš„è¯¥æ­»çš„VPSæä¾›å•†åˆè¦ç ´paoäº§luäº†ï¼Œæ°”æ­»æˆ‘ä¹Ÿã€‚æœ€è¿‘çš„vpsæœåŠ¡éƒ½ä¸èƒ½ç”¨äº†ï¼ŒMySQLä¸€è¿ä¸€ä¸ªå¤±è´¥ã€‚åæ¥ä»–ä»¬ç»™æˆ‘å‘äº†ä¸€å°é‚®ä»¶&lt;/p&gt;
&lt;p&gt;ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡
      
    
    </summary>
    
    
      <category term="æ—¥å¸¸" scheme="https://tengshe789.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>ä¸è¦æ‡’æƒ°ï¼ŒåŠ æ²¹</title>
    <link href="https://tengshe789.github.io/2018/08/04/%E5%8A%A0%E6%B2%B9/"/>
    <id>https://tengshe789.github.io/2018/08/04/åŠ æ²¹/</id>
    <published>2018-08-04T14:30:11.000Z</published>
    <updated>2019-11-20T13:39:41.235Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æ¯äº²è¦å»æœé²œæ—…æ¸¸ï¼Œå¿ƒç³»æ¯äº²ï¼Œæœ‰ç‚¹ç•¥å¾®æµ®èºã€‚å¥½ä¹…æ²¡æŒç»­å­¦ä¹ äº†ï¼Œç½ªè¿‡ç½ªè¿‡ã€‚</p><p>ç”¨å±±æœ¬è€€å¸çš„è¯ç»™è‡ªå·±æ‰“é¸¡è¡€ï¼š</p><blockquote><p>æˆ‘ä»ä¸ç›¸ä¿¡ä»€ä¹ˆæ‡’æ´‹æ´‹çš„è‡ªç”±ï¼Œæˆ‘å‘å¾€çš„è‡ªç”±æ˜¯é€šè¿‡å‹¤å¥‹å’ŒåŠªåŠ›å®ç°æ›´å¹¿é˜”çš„äººç”Ÿï¼Œé‚£æ ·çš„è‡ªç”±æ‰æ˜¯çè´µçš„ã€æœ‰ä»·å€¼çš„ã€‚æˆ‘ç›¸ä¿¡ä¸€ä¸‡å°æ—¶å®šå¾‹ï¼Œæˆ‘ä»æ¥ä¸ç›¸ä¿¡å¤©ä¸Šæ‰é¦…é¥¼çš„çµæ„Ÿå’Œåç­‰çš„æˆå°±ã€‚åšä¸€ä¸ªè‡ªç”±åˆè‡ªå¾‹çš„äººï¼Œé åŠ¿å¿…å®ç°çš„å†³å¿ƒè®¤çœŸåœ°æ´»ç€ã€‚</p></blockquote><p>æ²¡æœ‰ç»å¯¹æ­£ç¡®çš„äº‹æƒ…ï¼Œä½ èƒ½åšçš„å°±æ˜¯æ›´åŠ åŠªåŠ›ï¼Œè¿™æ ·æ‰èƒ½è®©ä¸€åˆ‡å˜å¾—éƒ½æ˜¯æœ€å¥½çš„å®‰æ’ï¼è‡ªå·±å•Šï¼Œä¸€å®šè¦åŠ æ²¹ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘æ¯äº²è¦å»æœé²œæ—…æ¸¸ï¼Œå¿ƒç³»æ¯äº²ï¼Œæœ‰ç‚¹ç•¥å¾®æµ®èºã€‚å¥½ä¹…æ²¡æŒç»­å­¦ä¹ äº†ï¼Œç½ªè¿‡ç½ªè¿‡ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨å±±æœ¬è€€å¸çš„è¯ç»™è‡ªå·±æ‰“é¸¡è¡€ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä»ä¸ç›¸ä¿¡ä»€ä¹ˆæ‡’æ´‹æ´‹çš„è‡ªç”±ï¼Œæˆ‘å‘å¾€çš„è‡ªç”±æ˜¯é€šè¿‡å‹¤å¥‹å’ŒåŠªåŠ›å®ç°æ›´å¹¿é˜”çš„äººç”Ÿï¼Œé‚£æ ·çš„è‡ªç”±æ‰æ˜¯çè´µçš„ã€æœ‰ä»·å€¼çš„ã€‚æˆ‘ç›¸ä¿¡ä¸€
      
    
    </summary>
    
    
      <category term="æ—¥å¸¸" scheme="https://tengshe789.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
      <category term="ç”Ÿæ´»" scheme="https://tengshe789.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
      <category term="åæ§½" scheme="https://tengshe789.github.io/tags/%E5%90%90%E6%A7%BD/"/>
    
  </entry>
  
  <entry>
    <title>è¿™æ˜¯ä¸€ç¯‡ä¼˜é›…çš„Springboot2.0ä½¿ç”¨æ‰‹å†Œ</title>
    <link href="https://tengshe789.github.io/2018/08/04/springboot/"/>
    <id>https://tengshe789.github.io/2018/08/04/springboot/</id>
    <published>2018-08-04T13:58:47.000Z</published>
    <updated>2021-06-06T09:10:07.894Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å†ç ”ç©¶springbootçš„åŸç†ğŸ˜‹é¢‡æœ‰æ”¶è·ï¼Œç°åœ¨è®©æˆ‘åˆ†äº«ä¸€ä¸‹springbootå¦‚ä½•ä½¿ç”¨å§~</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h2 id="å•¥æ˜¯Springboot"><a href="#å•¥æ˜¯Springboot" class="headerlink" title="å•¥æ˜¯Springboot"></a>å•¥æ˜¯Springboot</h2><p>å’Œä¹¦ä¸Šç†è§£çš„ä¸åŒï¼Œæˆ‘è®¤ä¸ºSpringbootæ˜¯ä¸€ä¸ªä¼˜ç§€çš„å¿«é€Ÿæ­å»ºæ¡†æ¶ï¼Œä»–é€šè¿‡mavenç»§æ‰¿æ–¹å¼æ·»åŠ ä¾èµ–æ¥æ•´åˆå¾ˆå¤šç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå¯ä»¥é¿å…å„ç§éº»çƒ¦çš„é…ç½®ï¼Œæœ‰å„ç§å†…åµŒå®¹å™¨ç®€åŒ–Webé¡¹ç›®ï¼Œè¿˜èƒ½é¿å…ä¾èµ–çš„å¹²æ‰°ï¼Œå®ƒå†…ç½®tomcatï¼Œjettyå®¹å™¨ï¼Œä½¿ç”¨çš„æ˜¯java appè¿è¡Œç¨‹åºï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„ç”¨æŠŠwaræ”¾åœ¨tomcatç­‰å®¹å™¨ä¸­è¿è¡Œ</p><h3 id="å’ŒJFinalçš„åŒºåˆ«"><a href="#å’ŒJFinalçš„åŒºåˆ«" class="headerlink" title="å’ŒJFinalçš„åŒºåˆ«"></a>å’ŒJFinalçš„åŒºåˆ«</h3><p>JFinalæ˜¯å›½äººå‡ºå“çš„ä¸€ä¸ªweb + orm æ¡†æ¶ ï¼Œ<a href="http://www.jfinal.com/" target="_blank" rel="noopener">JFinal</a>ï¼Œä¼˜ç‚¹æ˜¯å¼€å‘è¿…é€Ÿã€ä»£ç é‡å°‘ã€å­¦ä¹ ç®€å•ã€åŠŸèƒ½å¼ºå¤§ã€è½»é‡çº§ã€æ˜“æ‰©å±•ã€‚æ ¸å¿ƒå°±æ˜¯æè‡´ç®€æ´ã€‚ä»–æ²¡æœ‰å•†ä¸šæœºæ„çš„æ”¯æŒï¼Œæ‰€ä»¥å®£ä¼ ä¸åˆ°ä½ï¼Œå°‘æœ‰äººçŸ¥ã€‚</p><p>Springbootç›¸æ¯”ä¸JFinalæœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯æ”¯æŒçš„åŠŸèƒ½éå¸¸å¤šï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„å°†springçš„å„ç§æ¡†æ¶å¦‚springframework , spring-mvc, spring-security, spring-data-jpa, spring-cacheç­‰ç­‰é›†æˆèµ·æ¥è¿›è¡Œè‡ªåŠ¨åŒ–é…ç½® ï¼Œè€Œä¸”ç”Ÿæ€ æ¯”è¾ƒå¥½ï¼Œå¾ˆå¤šäº§å“éƒ½å¯¹Springbootåšå‡ºä¸€å®šæ”¯æŒã€‚</p><h3 id="ä¸Springcloudçš„åŒºåˆ«"><a href="#ä¸Springcloudçš„åŒºåˆ«" class="headerlink" title="ä¸Springcloudçš„åŒºåˆ«"></a>ä¸Springcloudçš„åŒºåˆ«</h3><p>å¯ä»¥è¿™ä¹ˆç†è§£ï¼ŒSpringbooté‡Œé¢åŒ…å«äº†Springcloudï¼ŒSpringcloudåªæ˜¯Springbooté‡Œé¢çš„ä¸€ä¸ªç»„ä»¶è€Œå·²ã€‚</p><p>Springcloudæä¾›äº†ç›¸å½“å®Œæ•´çš„å¾®æœåŠ¡æ¶æ„ã€‚è€Œå¾®æœåŠ¡æ¶æ„ï¼Œæœ¬è´¨æ¥è¯´å°±æ˜¯åˆ†å¸ƒå¼æ¶æ„ï¼Œæ„å‘³ç€ä½ è¦å°†åŸæ¥æ˜¯ä¸€ä¸ªæ•´ä½“çš„é¡¹ç›®æ‹†åˆ†æˆä¸€ä¸ªä¸ªçš„å°å‹é¡¹ç›®ï¼Œç„¶ååˆ©ç”¨æŸç§æœºåˆ¶å°†å…¶è”åˆèµ·æ¥ï¼Œä¾‹å¦‚æœåŠ¡æ²»ç†ã€é€šä¿¡æ¡†æ¶ç­‰åŸºç¡€è®¾æ–½ã€‚</p><h3 id="SpringBootå’ŒSpringMVCåŒºåˆ«"><a href="#SpringBootå’ŒSpringMVCåŒºåˆ«" class="headerlink" title="SpringBootå’ŒSpringMVCåŒºåˆ«"></a>SpringBootå’ŒSpringMVCåŒºåˆ«</h3><p>SpringBootçš„Webç»„ä»¶ï¼Œé»˜è®¤é›†æˆçš„æ˜¯SpringMVCæ¡†æ¶ã€‚</p><h2 id="å¿«é€Ÿä½¿ç”¨"><a href="#å¿«é€Ÿä½¿ç”¨" class="headerlink" title="å¿«é€Ÿä½¿ç”¨"></a>å¿«é€Ÿä½¿ç”¨</h2><p>è¦å¾€ä¸‹çœ‹çš„è¯ï¼Œæ³¨æ„äº†ğŸ‘‡</p><ul><li>Springboot 2.x è¦æ±‚ JDK 1.8 ç¯å¢ƒåŠä»¥ä¸Šç‰ˆæœ¬ã€‚å¦å¤–ï¼ŒSpringboot  2.x åªå…¼å®¹ Spring Framework 5.0 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚</li><li>ä¸º Springboot 2.x æä¾›äº†ç›¸å…³ä¾èµ–æ„å»ºå·¥å…·æ˜¯ Mavenï¼Œç‰ˆæœ¬éœ€è¦ 3.2 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚ä½¿ç”¨ Gradle åˆ™éœ€è¦ 1.12 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚</li><li>å»ºè®®ç”¨IntelliJ IDEA IntelliJ IDEA ï¼ˆç®€ç§° IDEAï¼‰</li></ul><h3 id="å»ºç«‹é¡¹ç›®"><a href="#å»ºç«‹é¡¹ç›®" class="headerlink" title="å»ºç«‹é¡¹ç›®"></a>å»ºç«‹é¡¹ç›®</h3><p>æˆ‘å·²ç»å¥½ä¹…æ²¡ç”¨Eclipseäº†ï¼Œè¦çŸ¥é“Eclipseæ˜¯åˆ›å»ºä¸€ä¸ªmavené¡¹ç›®åœ¨å¼•å…¥Springbootä¾èµ–åˆ›å»ºçš„ã€‚</p><p>ä¸‹é¢æˆ‘åˆ†äº«ä¸€ä¸‹ç”¨IDEAåˆ›å»ºSpringbootçš„æ–¹æ³•ã€‚</p><p><img src="/2018/08/04/springboot/1.png" alt="1533536250534"></p><p>å¾ˆç®€å•ï¼Œåœ¨è¿™ä¸ªç•Œé¢é‡Œé¢å°±å¯ä»¥åˆ›å»ºSpringbootäº†ã€‚æ¥ä¸‹æ¥åœ¨æ·»åŠ ä¸€äº›ç»„ä»¶ã€‚</p><p><img src="/2018/08/04/springboot/2.png" alt="1533536423232"></p><p>å¤§åŠŸå‘Šæˆï¼</p><h3 id="å†™ä¸€ä¸ªDEMO"><a href="#å†™ä¸€ä¸ªDEMO" class="headerlink" title="å†™ä¸€ä¸ªDEMO"></a>å†™ä¸€ä¸ªDEMO</h3><p>è¿™é‡Œç”¨æˆ‘å†™çš„ä¸€ä¸ªç§’æ€é¡¹ç›®ä½œä¸ºå‚è€ƒæ —å­ã€‚<a href="https://github.com/tengshe789/-miaosha" target="_blank" rel="noopener">ç§’æ€å•†åŸ</a></p><p>åˆ›å»ºä¸€ä¸ªconntrolleråŒ…ï¼Œç¼–å†™ä¸€ä¸ªæ ·åˆ—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.tengshe789.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/demo"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åœ¨ä»–<strong>åŒçº§åŒ…</strong>æˆ–è€…<strong>ä¸Šä¸€çº§çš„åŒ…</strong>å†…ï¼Œåˆ›å»ºä¸€ä¸ªä¸»æ–¹æ³•<code>MainApplication</code>ã€‚æ–¹æ³•å†…å®¹;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="comment">//@ComponentScan("cn.tengshe789.controller")</span></span><br><span class="line"><span class="comment">//@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MainApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æµè§ˆå™¨è¾“å…¥<a href="http://127.0.0.1:8080/demo/hello/ï¼Œå°±å¯ä»¥å¯åŠ¨äº†ï¼" target="_blank" rel="noopener">http://127.0.0.1:8080/demo/hello/ï¼Œå°±å¯ä»¥å¯åŠ¨äº†ï¼</a></p><h4 id="SpringApplication-run"><a href="#SpringApplication-run" class="headerlink" title="SpringApplication.run"></a>SpringApplication.<em>run</em></h4><p>Springbootå°†ä»–æ ‡è¯†ä¸ºå¯åŠ¨ç±»ï¼Œç”¨å®ƒå¯åŠ¨Springbooté¡¹ç›®</p><h3 id="åŸºç¡€æ³¨è§£è§£é‡Š"><a href="#åŸºç¡€æ³¨è§£è§£é‡Š" class="headerlink" title="åŸºç¡€æ³¨è§£è§£é‡Š"></a>åŸºç¡€æ³¨è§£è§£é‡Š</h3><h4 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h4><p>åœ¨ä¸ŠåŠ ä¸ŠRestController è¡¨ç¤ºä¿®é¥°è¯¥Controlleræ‰€æœ‰çš„æ–¹æ³•è¿”å›JSONæ ¼å¼,ç›´æ¥å¯ä»¥ç¼–å†™Restfulæ¥å£ã€‚å°±ç›¸å½“äº<code>@Controller</code>+<code>@ResponseBody</code>è¿™ç§å®ç°</p><h4 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h4><p>ç”¨åœ¨å¯åŠ¨Springbootä¸­ï¼Œç›¸å½“äº<code>@ComponentScan</code>+<code>@EnableAutoConfiguration</code>+<code>@Configuration</code></p><h4 id="ComponentScan-â€œcn-tengshe789-controllerâ€"><a href="#ComponentScan-â€œcn-tengshe789-controllerâ€" class="headerlink" title="@ComponentScan(â€œcn.tengshe789.controllerâ€)"></a>@ComponentScan(â€œcn.tengshe789.controllerâ€)</h4><p>æ§åˆ¶å™¨æ‰«åŒ…èŒƒå›´ã€‚</p><h4 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h4><p>ä»–è®© Spring Boot æ ¹æ®å’±åº”ç”¨æ‰€å£°æ˜çš„ä¾èµ–æ¥å¯¹ Spring æ¡†æ¶è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚æ„æ€æ˜¯ï¼Œåˆ›å»ºé¡¹ç›®æ—¶æ·»åŠ çš„spring-boot-starter-webæ·»åŠ äº†Tomcatå’ŒSpring MVCï¼Œæ‰€ä»¥auto-configurationå°†å‡å®šä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªwebåº”ç”¨å¹¶ç›¸åº”åœ°å¯¹Springè¿›è¡Œè®¾ç½®ã€‚</p><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><h3 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h3><p>è§„åˆ™ï¼š</p><p>1ã€åç”¨å¤§å†™æ¯”è¾ƒè§„èŒƒ</p><p>2ã€=ä¸¤è¾¹åˆ«æ‰“ç©ºæ ¼</p><p>3ã€åå€¼å¯¹å†™å®Œååˆ«æ‰“åˆ†å·</p><h4 id="è‡ªå®šä¹‰å‚æ•°"><a href="#è‡ªå®šä¹‰å‚æ•°" class="headerlink" title="è‡ªå®šä¹‰å‚æ•°"></a>è‡ªå®šä¹‰å‚æ•°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=tengshe789</span><br></pre></td></tr></table></figure><h4 id="å¤šç¯å¢ƒé…ç½®"><a href="#å¤šç¯å¢ƒé…ç½®" class="headerlink" title="å¤šç¯å¢ƒé…ç½®"></a>å¤šç¯å¢ƒé…ç½®</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.profiles.active=pre</span><br><span class="line"></span><br><span class="line">application-dev.propertiesï¼šå¼€å‘ç¯å¢ƒ</span><br><span class="line">application-test.propertiesï¼šæµ‹è¯•ç¯å¢ƒ</span><br><span class="line">application-prod.propertiesï¼šç”Ÿäº§ç¯å¢ƒ</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹ç«¯å£å·"><a href="#ä¿®æ”¹ç«¯å£å·" class="headerlink" title="ä¿®æ”¹ç«¯å£å·"></a>ä¿®æ”¹ç«¯å£å·</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server.port=8888 </span><br><span class="line">server.context-path=/tengshe789</span><br></pre></td></tr></table></figure><h3 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h3><p>è§„åˆ™ï¼š</p><ol><li>ä½¿ç”¨ç©ºæ ¼ Space ç¼©è¿›è¡¨ç¤ºåˆ†å±‚ï¼Œä¸åŒå±‚æ¬¡ä¹‹é—´çš„ç¼©è¿›å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç©ºæ ¼æ•°ç›®ï¼Œä½†æ˜¯åŒå±‚å…ƒç´ ä¸€å®šå·¦å¯¹é½ï¼Œå³å‰é¢ç©ºæ ¼æ•°ç›®ç›¸åŒï¼ˆä¸èƒ½ä½¿ç”¨ Tabï¼Œå„ä¸ªç³»ç»Ÿ Tabå¯¹åº”çš„ Space æ•°ç›®å¯èƒ½ä¸åŒï¼Œå¯¼è‡´å±‚æ¬¡æ··ä¹±ï¼‰</li><li>â€˜#â€™è¡¨ç¤ºæ³¨é‡Šï¼Œåªèƒ½å•è¡Œæ³¨é‡Šï¼Œä»#å¼€å§‹å¤„åˆ°è¡Œå°¾</li><li>ç ´æŠ˜å·åé¢è·Ÿä¸€ä¸ªç©ºæ ¼ï¼ˆa dash and spaceï¼‰è¡¨ç¤ºåˆ—è¡¨</li><li>ç”¨å†’å·å’Œç©ºæ ¼è¡¨ç¤ºé”®å€¼å¯¹ key: value</li><li>ç®€å•æ•°æ®ï¼ˆscalarsï¼Œæ ‡é‡æ•°æ®ï¼‰å¯ä»¥ä¸ä½¿ç”¨å¼•å·æ‹¬èµ·æ¥ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²æ•°æ®ã€‚ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·æ‹¬èµ·æ¥çš„è¢«å½“ä½œå­—ç¬¦ä¸²æ•°æ®ï¼Œåœ¨å•å¼•å·æˆ–åŒå¼•å·ä¸­ä½¿ç”¨Cé£æ ¼çš„è½¬ä¹‰å­—ç¬¦</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span>  <span class="number">8080</span></span><br><span class="line"><span class="attr">  context-path:</span> <span class="string">/springboot</span></span><br></pre></td></tr></table></figure><h3 id="xml"><a href="#xml" class="headerlink" title="xml"></a>xml</h3><p>Springbootå®˜æ–¹ä¸æ¨èxmlï¼Œç•¥</p><h2 id="Webå¼€å‘"><a href="#Webå¼€å‘" class="headerlink" title="Webå¼€å‘"></a>Webå¼€å‘</h2><p>ä¸€ä¸ªé¡¹ç›®ç”¨Springbootï¼Œåæœ‰å…«ä¹å°±æ˜¯ç”¨äºWebå¼€å‘ã€‚é¦–å…ˆè®©æˆ‘ä»¬çœ‹çœ‹Springbootæ€ä¹ˆå¿«é€Ÿå¼€å‘WebæŠŠ</p><h3 id="å¦‚ä½•è®¿é—®é™æ€èµ„æº"><a href="#å¦‚ä½•è®¿é—®é™æ€èµ„æº" class="headerlink" title="å¦‚ä½•è®¿é—®é™æ€èµ„æº"></a>å¦‚ä½•è®¿é—®é™æ€èµ„æº</h3><p>è¯·åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºstaticæ–‡ä»¶å¤¹ï¼Œåœ¨è¯¥ä½ç½®æ”¾ç½®ä¸€ä¸ªé™æ€èµ„æºã€‚</p><p>ç›®å½•ï¼šsrc/main/resources/static</p><p><img src="/2018/08/04/springboot/3.png" alt="1533537772267"></p><p>å¯åŠ¨ç¨‹åºåï¼Œå°è¯•è®¿é—®<a href="http://localhost:8080/img.xxx/ã€‚å°±å¯ä»¥è®¿é—®äº†ã€‚" target="_blank" rel="noopener">http://localhost:8080/img.xxx/ã€‚å°±å¯ä»¥è®¿é—®äº†ã€‚</a></p><h3 id="å…³äºæ¸²æŸ“Webé¡µé¢"><a href="#å…³äºæ¸²æŸ“Webé¡µé¢" class="headerlink" title="å…³äºæ¸²æŸ“Webé¡µé¢"></a>å…³äºæ¸²æŸ“Webé¡µé¢</h3><p>åœ¨ä¹‹å‰çš„å¿«é€Ÿä½¿ç”¨çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡æ·»åŠ <code>@RestController</code>æ¥å¤„ç†è¯·æ±‚ï¼Œæ‰€ä»¥è¿”å›çš„å†…å®¹ä¸º<code>json</code>å¯¹è±¡ã€‚é‚£ä¹ˆå¦‚æœéœ€è¦æ¸²æŸ“htmlé¡µé¢çš„æ—¶å€™ï¼Œè¦å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p><h4 id="æ¨¡æ¿å¼•æ“æ–¹æ³•"><a href="#æ¨¡æ¿å¼•æ“æ–¹æ³•" class="headerlink" title="æ¨¡æ¿å¼•æ“æ–¹æ³•"></a>æ¨¡æ¿å¼•æ“æ–¹æ³•</h4><p>Springbootä¾ç„¶å¯ä»¥å®ç°åŠ¨æ€HTMLï¼Œå¹¶ä¸”æä¾›äº†å¤šç§æ¨¡æ¿å¼•æ“çš„é»˜è®¤é…ç½®æ”¯æŒï¼ŒSpringbootå®˜æ–¹æ–‡æ¡£æœ‰å¦‚ä¸‹æ¨èçš„æ¨¡æ¿å¼•æ“ï¼š</p><p>Â·         Thymeleaf</p><p>Â·         FreeMarker</p><p>Â·         Velocity</p><p>Â·         Groovy</p><p>Â·         Mustache</p><p>Springbootå®˜æ–¹å»ºè®®é¿å…ä½¿ç”¨JSPï¼Œè‹¥ä¸€å®šè¦ä½¿ç”¨JSPå°†æ— æ³•å®ç°Spring Bootçš„å¤šç§ç‰¹æ€§ã€‚</p><p>åœ¨Springbootä¸­ï¼Œé»˜è®¤çš„æ¨¡æ¿é…ç½®è·¯å¾„éƒ½æ—¶ï¼šsrc/main/resources/templatesã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä¿®æ”¹è¿™ä¸ªè·¯å¾„ï¼Œå…·ä½“å¦‚ä½•ä¿®æ”¹ï¼Œå¯åœ¨å„æ¨¡æ¿å¼•æ“çš„é…ç½®å±æ€§ä¸­æŸ¥è¯¢å¹¶ä¿®æ”¹ã€‚</p><h3 id="Thymeleafï¼ˆèƒ¸è…ºï¼‰"><a href="#Thymeleafï¼ˆèƒ¸è…ºï¼‰" class="headerlink" title="Thymeleafï¼ˆèƒ¸è…ºï¼‰"></a>Thymeleafï¼ˆèƒ¸è…ºï¼‰</h3><p>è¿™é‡Œè¿˜æ˜¯ç”¨æˆ‘å†™çš„ä¸€ä¸ªç§’æ€é¡¹ç›®ä½œä¸ºå‚è€ƒæ —å­ã€‚<a href="https://github.com/tengshe789/-miaosha" target="_blank" rel="noopener">ç§’æ€å•†åŸ</a></p><h4 id="POM"><a href="#POM" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶-1"><a href="#é…ç½®æ–‡ä»¶-1" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>åœ¨<code>application.properties</code>ä¸­æ·»åŠ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#thymeleaf</span><br><span class="line">spring.thymeleaf.prefix=classpath:/templates/</span><br><span class="line">spring.thymeleaf.suffix=.html</span><br><span class="line">spring.thymeleaf.cache=false</span><br><span class="line">spring.thymeleaf.servlet.content-type=text/html</span><br><span class="line">spring.thymeleaf.enabled=true</span><br><span class="line">spring.thymeleaf.encoding=UTF-8</span><br><span class="line"># ä¸€ä»£å¡« spring.thymeleaf.mode=HTML5</span><br><span class="line">spring.thymeleaf.mode=HTML</span><br></pre></td></tr></table></figure><h4 id="åå°"><a href="#åå°" class="headerlink" title="åå°"></a>åå°</h4><p>åœ¨src/main/resources/åˆ›å»ºä¸€ä¸ªtemplatesæ–‡ä»¶å¤¹,æ–°ç½‘é¡µåç¼€ä¸º*.html</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/to_list"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(Model model,MiaoshaUser user)</span> </span>&#123;</span><br><span class="line">   model.addAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">   <span class="comment">//æŸ¥è¯¢å•†å“åˆ—è¡¨</span></span><br><span class="line">   List&lt;GoodsVo&gt; goodsList = goodsService.listGoodsVo();</span><br><span class="line">   model.addAttribute(<span class="string">"goodsList"</span>, goodsList);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"goods_list"</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="å‰å°"><a href="#å‰å°" class="headerlink" title="å‰å°"></a>å‰å°</h4><p>è¿™é‡Œæ³¨æ„Thymeleafè¯­æ³•ï¼ŒThymeleafå¾ˆåƒHTMLï¼Œä¸åŒä¹‹å¤„åœ¨æ ‡ç­¾åŠ äº†ä¸€ä¸ªthå‰ç¼€</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>å•†å“åˆ—è¡¨<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- jquery --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/js/jquery.min.js&#125;"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span>ç§’æ€å•†å“åˆ—è¡¨<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table"</span> <span class="attr">id</span>=<span class="string">"goodslist"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>å•†å“åç§°<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>å•†å“å›¾ç‰‡<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>å•†å“åŸä»·<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>ç§’æ€ä»·<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>åº“å­˜æ•°é‡<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>è¯¦æƒ…<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">th:each</span>=<span class="string">"goods,goodsStat : $&#123;goodsList&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;goods.goodsName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> &gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">"@&#123;$&#123;goods.goodsImg&#125;&#125;"</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"100"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;goods.goodsPrice&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;goods.miaoshaPrice&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;goods.stockCount&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"'/goods_detail.htm?goodsId='+$&#123;goods.id&#125;"</span>&gt;</span>è¯¦æƒ…<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Freemarker-è‡ªç”±æ ‡è®°"><a href="#Freemarker-è‡ªç”±æ ‡è®°" class="headerlink" title="Freemarker(è‡ªç”±æ ‡è®°)"></a>Freemarker(è‡ªç”±æ ‡è®°)</h3><h4 id="POM-1"><a href="#POM-1" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶-2"><a href="#é…ç½®æ–‡ä»¶-2" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>åœ¨<code>application.properties</code>ä¸­æ·»åŠ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#Freemarker</span><br><span class="line">spring.freemarker.allow-request-override=false</span><br><span class="line">spring.freemarker.cache=true</span><br><span class="line">spring.freemarker.check-template-location=true</span><br><span class="line">spring.freemarker.charset=UTF-8</span><br><span class="line">spring.freemarker.content-type=text/html</span><br><span class="line">spring.freemarker.expose-request-attributes=false</span><br><span class="line">spring.freemarker.expose-session-attributes=false</span><br><span class="line">spring.freemarker.expose-spring-macro-helpers=false</span><br><span class="line">#spring.freemarker.prefix=</span><br><span class="line">#spring.freemarker.request-context-attribute=</span><br><span class="line">#spring.freemarker.settings.*=</span><br><span class="line">spring.freemarker.suffix=.ftl</span><br><span class="line">spring.freemarker.template-loader-path=classpath:/templates/</span><br><span class="line">#comma-separated list</span><br><span class="line">#spring.freemarker.view-names= # whitelist of view names that can be resolved</span><br></pre></td></tr></table></figure><h4 id="åå°-1"><a href="#åå°-1" class="headerlink" title="åå°"></a>åå°</h4><p>åœ¨src/main/resources/åˆ›å»ºä¸€ä¸ªtemplatesæ–‡ä»¶å¤¹,æ–°ç½‘é¡µåç¼€ä¸º*.ftl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/freemarkerIndex"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(Map&lt;String, Object&gt; result)</span> </span>&#123;</span><br><span class="line">result.put(<span class="string">"nickname"</span>, <span class="string">"tEngSHe789"</span>);</span><br><span class="line">        result.put(<span class="string">"old"</span>, <span class="string">"18"</span>);</span><br><span class="line">result.put(<span class="string">"my Blog"</span>, <span class="string">"HTTPS://blog.tengshe789.tech/"</span>);</span><br><span class="line">List&lt;String&gt; listResult = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">listResult.add(<span class="string">"guanyu"</span>);</span><br><span class="line">listResult.add(<span class="string">"zhugeliang"</span>);</span><br><span class="line">result.put(<span class="string">"listResult"</span>, listResult);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‰å°-1"><a href="#å‰å°-1" class="headerlink" title="å‰å°"></a>å‰å°</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  $&#123;nickname&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">#if</span> <span class="attr">old</span>==<span class="string">"18"</span>&gt;</span></span><br><span class="line">            å¤ªå‡äº†å§å“¥ä»¬</span><br><span class="line">      <span class="tag">&lt;<span class="name">#elseif</span> <span class="attr">old</span>==<span class="string">"21"</span>&gt;</span></span><br><span class="line">            ä½ æ˜¯çœŸçš„21å²</span><br><span class="line">     <span class="tag">&lt;<span class="name">#else</span>&gt;</span></span><br><span class="line">        å…¶ä»–      </span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">#if</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">#list</span> <span class="attr">userlist</span> <span class="attr">as</span> <span class="attr">user</span>&gt;</span></span><br><span class="line">   $&#123;user&#125;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h3><p>ä¸å»ºè®®ç”¨Springbootæ•´åˆJSPï¼Œè¦çš„è¯ä¸€å®šè¦ä¸ºwarç±»å‹ï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ°é¡µé¢.,è€Œä¸”ä¸è¦æŠŠJSPé¡µé¢å­˜æ”¾åœ¨resources// jsp ä¸èƒ½è¢«è®¿é—®åˆ°</p><h4 id="POM-2"><a href="#POM-2" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- SpringBoot web æ ¸å¿ƒç»„ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- SpringBoot å¤–éƒ¨tomcatæ”¯æŒ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶-3"><a href="#é…ç½®æ–‡ä»¶-3" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>åœ¨<code>application.properties</code>ä¸­æ·»åŠ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.view.prefix=/WEB-INF/jsp/</span><br><span class="line">spring.mvc.view.suffix=.jsp</span><br></pre></td></tr></table></figure><h4 id="åå°-2"><a href="#åå°-2" class="headerlink" title="åå°"></a>åå°</h4><p>åœ¨src/main/resources/åˆ›å»ºä¸€ä¸ªtemplatesæ–‡ä»¶å¤¹,æ–°ç½‘é¡µåç¼€ä¸º*.jsp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‰å°-2"><a href="#å‰å°-2" class="headerlink" title="å‰å°"></a>å‰å°</h3><p>ç•¥ç•¥ç•¥ğŸ˜</p><h2 id="é¢å‘æµç¼–ç¨‹"><a href="#é¢å‘æµç¼–ç¨‹" class="headerlink" title="é¢å‘æµç¼–ç¨‹"></a>é¢å‘æµç¼–ç¨‹</h2><p>è¦äº†è§£ WebFlux ,é¦–å…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯Reactiveå“åº”å¼(ååº”å¼ã€å¼‚æ­¥ã€é¢å‘æµ)ç¼–ç¨‹ ï¼Œä»–æ˜¯ä¸€ç§æ–°çš„ç¼–ç¨‹é£æ ¼ï¼Œå…¶ç‰¹ç‚¹æ˜¯å¼‚æ­¥æˆ–å¹¶å‘ã€äº‹ä»¶é©±åŠ¨ã€æ¨é€PUSHæœºåˆ¶ä»¥åŠè§‚å¯Ÿè€…æ¨¡å¼çš„è¡ç”Ÿã€‚reactiveåº”ç”¨(å“åº”å¼åº”ç”¨)å…è®¸å¼€å‘äººå‘˜æ„å»ºäº‹ä»¶é©±åŠ¨ï¼ˆevent-drivenï¼‰ï¼Œå¯æ‰©å±•æ€§ï¼Œå¼¹æ€§çš„ååº”ç³»ç»Ÿï¼šæä¾›é«˜åº¦æ•æ„Ÿçš„å®æ—¶çš„ç”¨æˆ·ä½“éªŒæ„Ÿè§‰ï¼Œå¯ä¼¸ç¼©æ€§å’Œå¼¹æ€§çš„åº”ç”¨ç¨‹åºæ ˆçš„æ”¯æŒï¼Œéšæ—¶å¯ä»¥éƒ¨ç½²åœ¨å¤šæ ¸å’Œäº‘è®¡ç®—æ¶æ„ã€‚</p><h3 id="Spring-Webflux"><a href="#Spring-Webflux" class="headerlink" title="Spring Webflux"></a>Spring Webflux</h3><p>Spring Boot Webflux å°±æ˜¯åŸºäº Reactor å®ç°çš„ã€‚Spring Boot 2.0 åŒ…æ‹¬ä¸€ä¸ªæ–°çš„ spring-webflux æ¨¡å—ã€‚è¯¥æ¨¡å—åŒ…å«å¯¹å“åº”å¼ HTTP å’Œ WebSocket å®¢æˆ·ç«¯çš„æ”¯æŒï¼Œä»¥åŠå¯¹ RESTï¼ŒHTML å’Œ WebSocket äº¤äº’ç­‰ç¨‹åºçš„æ”¯æŒã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒSpring MVC ç”¨äºåŒæ­¥å¤„ç†ï¼ŒSpring Webflux ç”¨äºå¼‚æ­¥å¤„ç†ã€‚ </p><p>Spring Boot Webflux æœ‰ä¸¤ç§ç¼–ç¨‹æ¨¡å‹å®ç°ï¼Œä¸€ç§ç±»ä¼¼ Spring MVC æ³¨è§£æ–¹å¼ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨å…¶åŠŸèƒ½æ€§ç«¯ç‚¹æ–¹å¼ã€‚ </p><p><img src="/2018/08/04/springboot/8.jpg" alt="img"> </p><p>WebFlux æ”¯æŒçš„å®¹å™¨æœ‰ Tomcatã€Jettyï¼ˆNon-Blocking IO APIï¼‰ ï¼Œä¹Ÿå¯ä»¥åƒ Netty å’Œ Undertow çš„æœ¬èº«å°±æ”¯æŒå¼‚æ­¥å®¹å™¨ã€‚åœ¨å®¹å™¨ä¸­ Spring WebFlux ä¼šå°†è¾“å…¥æµé€‚é…æˆ Mono æˆ–è€… Flux æ ¼å¼è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚ </p><h4 id="POM-3"><a href="#POM-3" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å®˜æ–¹å®ä¾‹"><a href="#å®˜æ–¹å®ä¾‹" class="headerlink" title="å®˜æ–¹å®ä¾‹"></a>å®˜æ–¹å®ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonController</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> PersonRepository repository;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonController</span><span class="params">(PersonRepository repository)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.repository = repository;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/person"</span>)</span><br><span class="line">    <span class="function">Mono&lt;Void&gt; <span class="title">create</span><span class="params">(@RequestBody Publisher&lt;Person&gt; personStream)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.repository.save(personStream).then();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/person"</span>)</span><br><span class="line">    <span class="function">Flux&lt;Person&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.repository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/person/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function">Mono&lt;Person&gt; <span class="title">findById</span><span class="params">(@PathVariable String id)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.repository.findOne(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerå±‚"><a href="#Controllerå±‚" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><p>Spring Boot 2.0 è¿™é‡Œæœ‰ä¸¤æ¡ä¸åŒçš„çº¿åˆ†åˆ«æ˜¯ï¼š</p><ol><li>Spring Web MVC -&gt; Spring Data</li><li>Spring WebFlux -&gt; Spring Data Reactive</li></ol><p>å¦‚æœä½¿ç”¨ Spring Data Reactive ï¼ŒåŸæ¥çš„ Spring é’ˆå¯¹ Spring Data ï¼ˆJDBCç­‰ï¼‰çš„äº‹åŠ¡ç®¡ç†ä¼šä¸èµ·ä½œç”¨ã€‚å› ä¸ºåŸæ¥çš„ Spring äº‹åŠ¡ç®¡ç†ï¼ˆSpring Data JPAï¼‰éƒ½æ˜¯åŸºäº ThreadLocal ä¼ é€’äº‹åŠ¡çš„ï¼Œå…¶æœ¬è´¨æ˜¯åŸºäº é˜»å¡ IO æ¨¡å‹ï¼Œä¸æ˜¯å¼‚æ­¥çš„ã€‚</p><p>ä½† Reactive æ˜¯è¦æ±‚å¼‚æ­¥çš„ï¼Œä¸åŒçº¿ç¨‹é‡Œé¢ ThreadLocal è‚¯å®šå–ä¸åˆ°å€¼äº†ã€‚è‡ªç„¶ï¼Œæˆ‘ä»¬å¾—æƒ³æƒ³å¦‚ä½•åœ¨ä½¿ç”¨ Reactive ç¼–ç¨‹æ˜¯åšåˆ°äº‹åŠ¡ï¼Œæœ‰ä¸€ç§æ–¹å¼æ˜¯ å›è°ƒ æ–¹å¼ï¼Œä¸€ç›´ä¼ é€’ <code>conn ï¼šnewTransaction(conn -&gt;{})</code></p><p>å› ä¸ºæ¯æ¬¡æ“ä½œæ•°æ®åº“ä¹Ÿæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥ connection åœ¨ Reactive ç¼–ç¨‹ä¸­æ— æ³•é  ThreadLocal ä¼ é€’äº†ï¼Œåªèƒ½æ”¾åœ¨å‚æ•°ä¸Šé¢ä¼ é€’ã€‚è™½ç„¶ä¼šæœ‰ä¸€å®šçš„ä»£ç ä¾µå…¥è¡Œã€‚è¿›ä¸€æ­¥ï¼Œä¹Ÿå¯ä»¥ kotlin åç¨‹ï¼Œå»åšåˆ°é€æ˜çš„äº‹åŠ¡ç®¡ç†ï¼Œå³æŠŠ conn æ”¾åˆ° åç¨‹çš„å±€éƒ¨å˜é‡ä¸­å»ã€‚<br>é‚£ Spring Data Reactive Repositories ä¸æ”¯æŒ MySQLï¼Œè¿›ä¸€æ­¥ä¹Ÿä¸æ”¯æŒ MySQL äº‹åŠ¡ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œè¿™ä¸ªé—®é¢˜å…¶å®å’Œç¬¬ä¸€ä¸ªé—®é¢˜ä¹Ÿç›¸å…³ã€‚ ä¸ºå•¥ä¸æ”¯æŒ MySQLï¼Œå³ JDBC ä¸æ”¯æŒã€‚å¤§å®¶å¯ä»¥çœ‹åˆ° JDBC æ˜¯æ‰€å± Spring Data çš„ã€‚æ‰€ä»¥å¯ä»¥ç­‰å¾… Spring Data Reactive Repositories å‡çº§ IO æ¨¡å‹ï¼Œå»æ”¯æŒ MySQLã€‚ä¹Ÿå¯ä»¥å’Œä¸Šé¢ä¹Ÿè®²åˆ°äº†ï¼Œå¦‚ä½•ä½¿ç”¨ Reactive ç¼–ç¨‹æ”¯æŒäº‹åŠ¡ã€‚</p><p>å¦‚æœåº”ç”¨åªèƒ½ä½¿ç”¨ä¸å¼ºä¾èµ–æ•°æ®äº‹åŠ¡ï¼Œä¾æ—§ä½¿ç”¨ MySQL ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Service-å±‚"><a href="#Service-å±‚" class="headerlink" title="Service å±‚"></a>Service å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CityService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–åŸå¸‚ä¿¡æ¯åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;City&gt; <span class="title">findAllCity</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åŸå¸‚ ID,æŸ¥è¯¢åŸå¸‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">City <span class="title">findCityById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢åŸå¸‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> city</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">saveCity</span><span class="params">(City city)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°åŸå¸‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> city</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">updateCity</span><span class="params">(City city)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åŸå¸‚ ID,åˆ é™¤åŸå¸‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">deleteCity</span><span class="params">(Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“æ¡ˆä¾‹åœ¨æˆ‘å‚è€ƒåšä¸»çš„<a href="https://github.com/JeffLi1993/springboot-learning-example" target="_blank" rel="noopener"> Github</a> </p><h4 id="è·¯ç”±å™¨ç±»-Router"><a href="#è·¯ç”±å™¨ç±»-Router" class="headerlink" title="è·¯ç”±å™¨ç±» Router"></a>è·¯ç”±å™¨ç±» Router</h4><p>åˆ›å»ºä¸€ä¸ª Route ç±»æ¥å®šä¹‰ RESTful HTTP è·¯ç”± </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¯·å‚è€ƒ<a href="https://gitbook.cn/gitchat/activity/59e09f788c3a1a4f21a5b445" target="_blank" rel="noopener">èŠèŠ Spring Boot 2.x é‚£äº›äº‹å„¿</a></p><h3 id="Async"><a href="#Async" class="headerlink" title="@Async"></a>@Async</h3><p>éœ€è¦æ‰§è¡Œå¼‚æ­¥æ–¹æ³•æ—¶ï¼Œåœ¨æ–¹æ³•ä¸ŠåŠ ä¸Š<code>@Async</code>ä¹‹åï¼Œåº•å±‚ä½¿ç”¨å¤šçº¿ç¨‹æŠ€æœ¯ ã€‚å¯åŠ¨åŠ ä¸Šéœ€è¦<code>@EnableAsync</code> </p><h2 id="æ•°æ®è®¿é—®"><a href="#æ•°æ®è®¿é—®" class="headerlink" title="æ•°æ®è®¿é—®"></a>æ•°æ®è®¿é—®</h2><h3 id="æ•´åˆJdbcTemplate"><a href="#æ•´åˆJdbcTemplate" class="headerlink" title="æ•´åˆJdbcTemplate"></a>æ•´åˆJdbcTemplate</h3><p>ä½¿ç”¨è¿™ä¸ªéœ€è¦spring-boot-starter-parentç‰ˆæœ¬è¦åœ¨1.5ä»¥ä¸Š</p><h4 id="POM-4"><a href="#POM-4" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶-4"><a href="#é…ç½®æ–‡ä»¶-4" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>åœ¨<code>application.properties</code>ä¸­æ·»åŠ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># jdbcæ¨¡æ¿</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost:3306/test</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123456</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure><h4 id="åå°-3"><a href="#åå°-3" class="headerlink" title="åå°"></a>åå°</h4><p>åˆ›å»ºä¸€ä¸ªService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createUser</span><span class="params">(String name, Integer age)</span> </span>&#123;</span><br><span class="line">jdbcTemplate.update(<span class="string">"insert into users values(null,?,?);"</span>, name, age);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•´åˆMybatis"><a href="#æ•´åˆMybatis" class="headerlink" title="æ•´åˆMybatis"></a>æ•´åˆMybatis</h3><p>è¿™é‡Œç”¨æˆ‘å†™çš„ä¸€ä¸ªç§’æ€é¡¹ç›®ä½œä¸ºå‚è€ƒæ —å­ã€‚<a href="https://github.com/tengshe789/-miaosha" target="_blank" rel="noopener">ç§’æ€å•†åŸ</a></p><h4 id="POM-5"><a href="#POM-5" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶-5"><a href="#é…ç½®æ–‡ä»¶-5" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>åœ¨<code>application.properties</code>ä¸­æ·»åŠ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#mybatis</span><br><span class="line">mybatis.type-aliases-package=cn.tengshe789.domain</span><br><span class="line">mybatis.configuration.map-underscore-to-camel-case=true</span><br><span class="line">mybatis.configuration.default-fetch-size=100</span><br><span class="line">mybatis.configuration.default-statement-timeout=3000</span><br><span class="line">mybatis.mapperLocations = classpath:cn/tengshe789/dao/*.xml</span><br></pre></td></tr></table></figure><h4 id="åå°-4"><a href="#åå°-4" class="headerlink" title="åå°"></a>åå°</h4><p>åˆ›å»ºä¸€ä¸ªDaoï¼ˆMapper ä»£ç ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GoodsDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select g.*,mg.stock_count, mg.start_date, mg.end_date,mg.miaosha_price from miaosha_goods mg left join goods g on mg.goods_id = g.id"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;GoodsVo&gt; <span class="title">listGoodsVo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºservice</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    GoodsDao goodsDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * å±•ç¤ºå•†å“åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;GoodsVo&gt; <span class="title">listGoodsVo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> goodsDao.listGoodsVo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Mybatisæ•´åˆåˆ†é¡µæ’ä»¶PageHelper"><a href="#Mybatisæ•´åˆåˆ†é¡µæ’ä»¶PageHelper" class="headerlink" title="Mybatisæ•´åˆåˆ†é¡µæ’ä»¶PageHelper"></a>Mybatisæ•´åˆåˆ†é¡µæ’ä»¶PageHelper</h3><p>PageHelper æ˜¯ä¸€æ¬¾å¥½ç”¨çš„å¼€æºå…è´¹çš„ Mybatis ç¬¬ä¸‰æ–¹ç‰©ç†åˆ†é¡µæ’ä»¶</p><h4 id="POM-6"><a href="#POM-6" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶-6"><a href="#é…ç½®æ–‡ä»¶-6" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>åœ¨<code>application.properties</code>ä¸­æ·»åŠ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># é…ç½®æ—¥å¿—</span><br><span class="line">logging.level.cn.tengshe789.dao=DEBUG</span><br><span class="line"># Pagehelper</span><br><span class="line">pagehelper.helperDialect=mysql</span><br><span class="line">pagehelper.reasonable=true</span><br><span class="line">pagehelper.supportMethodsArguments=true</span><br><span class="line">pagehelper.params=count=countSql</span><br><span class="line">pagehelper.page-size-zero=true</span><br></pre></td></tr></table></figure><p>æˆ–è€…åœ¨<code>application.yml</code>ä¸­æ·»åŠ ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸mybatisæ•´åˆ</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line"><span class="attr">  config-location:</span> <span class="attr">classpath:mybatis.xml</span></span><br><span class="line"><span class="attr">  mapper-locations:</span></span><br><span class="line"><span class="attr">  - classpath:</span><span class="string">cn/tengshe789/dao/*.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†é¡µé…ç½®</span></span><br><span class="line"><span class="attr">pagehelper:</span></span><br><span class="line"><span class="attr">  helper-dialect:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">  reasonable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  support-methods-arguments:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  params:</span> <span class="string">count=countSql</span></span><br></pre></td></tr></table></figure><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><h5 id="å®ä½“å±‚é¢"><a href="#å®ä½“å±‚é¢" class="headerlink" title="å®ä½“å±‚é¢"></a>å®ä½“å±‚é¢</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Daoå±‚"><a href="#Daoå±‚" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"><span class="meta">@Select</span>(<span class="string">"SELECT * FROM USERS "</span>)</span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">findUserList</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Serviceå±‚"><a href="#Serviceå±‚" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserMapper userDao;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * page å½“å‰é¡µæ•°&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * size å½“å‰å±•ç¤ºçš„æ•°æ®&lt;br&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageInfo&lt;User&gt; <span class="title">findUserList</span><span class="params">(<span class="keyword">int</span> page, <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line"><span class="comment">// å¼€å¯åˆ†é¡µæ’ä»¶,æ”¾åœ¨æŸ¥è¯¢è¯­å¥ä¸Šé¢</span></span><br><span class="line">PageHelper.startPage(page, size);</span><br><span class="line">List&lt;User&gt; listUser = userDao.findUserList();</span><br><span class="line"><span class="comment">// å°è£…åˆ†é¡µä¹‹åçš„æ•°æ®</span></span><br><span class="line">PageInfo&lt;User&gt; pageInfoUser = <span class="keyword">new</span> PageInfo&lt;User&gt;(listUser);</span><br><span class="line"><span class="keyword">return</span> pageInfoUser;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•´åˆSpringJPA"><a href="#æ•´åˆSpringJPA" class="headerlink" title="æ•´åˆSpringJPA"></a>æ•´åˆSpringJPA</h3><p>spring-data-jpaä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>å£°æ˜æŒä¹…å±‚çš„æ¥å£ï¼Œè¯¥æ¥å£ç»§æ‰¿ Repositoryï¼ˆæˆ–Repositoryçš„å­æ¥å£ï¼Œå…¶ä¸­å®šä¹‰äº†ä¸€äº›å¸¸ç”¨çš„å¢åˆ æ”¹æŸ¥ï¼Œä»¥åŠåˆ†é¡µç›¸å…³çš„æ–¹æ³•ï¼‰ã€‚</li><li>åœ¨æ¥å£ä¸­å£°æ˜éœ€è¦çš„ä¸šåŠ¡æ–¹æ³•ã€‚Spring Data å°†æ ¹æ®ç»™å®šçš„ç­–ç•¥ç”Ÿæˆå®ç°ä»£ç ã€‚</li><li>åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­å¢åŠ ä¸€è¡Œå£°æ˜ï¼Œè®© Spring ä¸ºå£°æ˜çš„æ¥å£åˆ›å»ºä»£ç†å¯¹è±¡ã€‚é…ç½®äº† <a href="jpa:repositories" target="_blank" rel="noopener">jpa:repositories</a> åï¼ŒSpring åˆå§‹åŒ–å®¹å™¨æ—¶å°†ä¼šæ‰«æ base-package æŒ‡å®šçš„åŒ…ç›®å½•åŠå…¶å­ç›®å½•ï¼Œä¸ºç»§æ‰¿ Repository æˆ–å…¶å­æ¥å£çš„æ¥å£åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¹¶å°†ä»£ç†å¯¹è±¡æ³¨å†Œä¸º Spring Beanï¼Œä¸šåŠ¡å±‚ä¾¿å¯ä»¥é€šè¿‡ Spring è‡ªåŠ¨å°è£…çš„ç‰¹æ€§æ¥ç›´æ¥ä½¿ç”¨è¯¥å¯¹è±¡ã€‚</li></ol><p>è¯¦æƒ…ï¼š<a href="http://projects.spring.io/spring-data-jpa/" target="_blank" rel="noopener">JPAå®˜æ–¹ç½‘ç«™</a></p><h4 id="POM-7"><a href="#POM-7" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶-7"><a href="#é…ç½®æ–‡ä»¶-7" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>Springboot é»˜è®¤ä½¿ç”¨hibernateä½œä¸ºJPAçš„å®ç° ã€‚éœ€è¦åœ¨<code>application.properties</code>ä¸­æ·»åŠ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># hibernate</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost:3306/test?useSSL=false</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=root</span><br><span class="line">spring.datasource.tomcat.max-active=100</span><br><span class="line">spring.datasource.tomcat.max-idle=200</span><br><span class="line">spring.datasource.tomcat.initialSize=20</span><br><span class="line">spring.jpa.database-platform=org.hibernate.dialect.MySQL5Dialect</span><br></pre></td></tr></table></figure><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><h5 id="Domain"><a href="#Domain" class="headerlink" title="Domain"></a>Domain</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span>(name = <span class="string">"users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserEntity</span> </span>&#123;</span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="meta">@Column</span>(name = <span class="string">"name"</span>)</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="meta">@Column</span>(name = <span class="string">"age"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  æ³¨è§£çš„æ„æ€ï¼š</p><p><code>@Entity</code>ä¼šè¢«springæ‰«æå¹¶åŠ è½½ï¼Œ</p><p><code>@Id</code>æ³¨è§£åœ¨ä¸»é”®ä¸Š</p><p><code>@Column name=&quot;call_phone&quot;</code> æŒ‡è¯¥å­—æ®µå¯¹åº”çš„æ•°æ®åº“çš„å­—æ®µåï¼Œå¦‚æœç›¸åŒå°±ä¸éœ€è¦å®šä¹‰ã€‚æ•°æ®åº“ä¸‹åˆ’çº¿é—´éš”å’Œä»£ç ä¸­çš„é©¼å³°æ³•è§†ä¸ºç›¸åŒï¼Œå¦‚æ•°æ®åº“å­—æ®µcreate_timeç­‰ä»·äºJavaç±»ä¸­çš„createTimeï¼Œå› æ­¤ä¸éœ€è¦ç”¨@Columnæ³¨è§£ã€‚</p><h5 id="Daoå±‚-1"><a href="#Daoå±‚-1" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h5><p>æ­¤æ—¶éœ€è¦ç»§æ‰¿Repositoryæ¥å£~</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/jpaFindUser"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">jpaIndex</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">Optional&lt;User&gt; userOptional = userDao.findById(user.getId());</span><br><span class="line">User result = userOptional.get();</span><br><span class="line"><span class="keyword">return</span> reusltUser == <span class="keyword">null</span> ? <span class="string">"æ²¡æœ‰æŸ¥è¯¢åˆ°æ•°æ®"</span> : result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤šæ•°æ®æº"><a href="#å¤šæ•°æ®æº" class="headerlink" title="å¤šæ•°æ®æº"></a>å¤šæ•°æ®æº</h3><p>å¾ˆå¤šå…¬å¸éƒ½ä¼šä½¿ç”¨å¤šæ•°æ®åº“ï¼Œä¸€ä¸ªæ•°æ®åº“å­˜æ”¾å…±åŒçš„é…ç½®æˆ–æ–‡ä»¶ï¼Œå¦ä¸€ä¸ªæ•°æ®åº“æ˜¯æ”¾å‚ç›´ä¸šåŠ¡çš„æ•°æ®ã€‚æ‰€ä»¥è¯´éœ€è¦ä¸€ä¸ªé¡¹ç›®ä¸­æœ‰å¤šä¸ªæ•°æ®æº</p><p>è¿™ç©æ„åŸç†å¾ˆç®€å•ï¼Œæ ¹æ®ä¸åŒåŒ…åï¼ŒåŠ è½½ä¸åŒæ•°æ®æºã€‚</p><h4 id="é…ç½®æ–‡ä»¶-8"><a href="#é…ç½®æ–‡ä»¶-8" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>åœ¨<code>application.properties</code>ä¸­æ·»åŠ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># datasource1</span><br><span class="line">spring.datasource.test1.driver-class-name = com.mysql.jdbc.Driver</span><br><span class="line">spring.datasource.test1.jdbc-url =jdbc:mysql://localhost:3306/test01?useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">spring.datasource.test1.username = root</span><br><span class="line">spring.datasource.test1.password = 123456</span><br><span class="line"># datasource2</span><br><span class="line">spring.datasource.test2.driver-class-name = com.mysql.jdbc.Driver</span><br><span class="line">spring.datasource.test2.jdbc-url =jdbc:mysql://localhost:3306/test02?useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">spring.datasource.test2.username = root</span><br><span class="line">spring.datasource.test2.password = 123456</span><br></pre></td></tr></table></figure><h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><h5 id="æ·»åŠ é…ç½®"><a href="#æ·»åŠ é…ç½®" class="headerlink" title="æ·»åŠ é…ç½®"></a>æ·»åŠ é…ç½®</h5><p>æ•°æ®åº“1çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DataSource01</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">// æ³¨å†Œåˆ°springbootå®¹å™¨ä¸­</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = <span class="string">"tech.tengshe789.test01"</span>, sqlSessionFactoryRef = <span class="string">"test1SqlSessionFactory"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSource1Config</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@methodDesc</span>: åŠŸèƒ½æè¿°:(é…ç½®test1æ•°æ®åº“)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: tEngSHe789</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"test1DataSource"</span>)</span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.test1"</span>)</span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">testDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@methodDesc</span>: åŠŸèƒ½æè¿°:(test1 sqlä¼šè¯å·¥å‚)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"test1SqlSessionFactory"</span>)</span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">testSqlSessionFactory</span><span class="params">(@Qualifier(<span class="string">"test1DataSource"</span>)</span> DataSource dataSource)</span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">SqlSessionFactoryBean bean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">bean.setDataSource(dataSource);</span><br><span class="line">        <span class="comment">//åŠ è½½mapperï¼ˆä¸éœ€è¦ï¼‰</span></span><br><span class="line">bean.setMapperLocations(</span><br><span class="line"> <span class="keyword">new</span> PathMatchingResourcePatternResolver().getResources(<span class="string">"classpath:mybatis/mapper/test1/*.xml"</span>));</span><br><span class="line"><span class="keyword">return</span> bean.getObject();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@methodDesc</span>: åŠŸèƒ½æè¿°:(test1 äº‹ç‰©ç®¡ç†)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"test1TransactionManager"</span>)</span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSourceTransactionManager <span class="title">testTransactionManager</span><span class="params">(@Qualifier(<span class="string">"test1DataSource"</span>)</span> DataSource dataSource) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"test1SqlSessionTemplate"</span>)</span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionTemplate <span class="title">testSqlSessionTemplate</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">@Qualifier(<span class="string">"test1SqlSessionFactory"</span>)</span> SqlSessionFactory sqlSessionFactory) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•°æ®åº“2çš„åŒç†ã€‚</p><h5 id="Dao"><a href="#Dao" class="headerlink" title="Dao"></a>Dao</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">User1Dao</span> </span>&#123;</span><br><span class="line"><span class="meta">@Insert</span>(<span class="string">"insert into users values(null,#&#123;name&#125;,#&#123;age&#125;);"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addUser</span><span class="params">(@Param(<span class="string">"name"</span>)</span> String name, @<span class="title">Param</span><span class="params">(<span class="string">"age"</span>)</span> Integer age)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><p>åœ¨å¤šæ•°æ®æºçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>@Transactional</code>æ³¨è§£æ—¶ï¼Œåº”è¯¥æŒ‡å®šäº‹åŠ¡ç®¡ç†è€…<code>@Transactional(transactionManager = &quot;test1TransactionManager&quot;)</code></p><h2 id="äº‹ç‰©ç®¡ç†"><a href="#äº‹ç‰©ç®¡ç†" class="headerlink" title="äº‹ç‰©ç®¡ç†"></a>äº‹ç‰©ç®¡ç†</h2><p>æ€ä¹ˆè¿›è¡Œäº‹ç‰©ç®¡ç†å‘¢ï¼Œç®€å•ï¼Œå¾€ä¸‹çœ‹ã€‚</p><h3 id="å£°æ˜å¼äº‹åŠ¡"><a href="#å£°æ˜å¼äº‹åŠ¡" class="headerlink" title="å£°æ˜å¼äº‹åŠ¡"></a><strong>å£°æ˜å¼äº‹åŠ¡</strong></h3><p>æ‰¾åˆ°serviceå®ç°ç±»ï¼ŒåŠ ä¸Š<code>@Transactional</code> æ³¨è§£å°±è¡Œï¼Œæ­¤<code>@Transactional</code>æ³¨è§£æ¥è‡ª<code>org.springframework.transaction.annotation</code>åŒ… ï¼Œä¸æ˜¯æ¥è‡ª<code>javax.transaction</code> ã€‚è€Œä¸”<code>@Transactional</code>ä¸ä»…å¯ä»¥æ³¨è§£åœ¨æ–¹æ³•ä¸Šï¼Œä¹Ÿå¯ä»¥æ³¨è§£åœ¨ç±»ä¸Šã€‚å½“æ³¨è§£åœ¨ç±»ä¸Šçš„æ—¶å€™æ„å‘³ç€æ­¤ç±»çš„æ‰€æœ‰publicæ–¹æ³•éƒ½æ˜¯å¼€å¯äº‹åŠ¡çš„ã€‚å¦‚æœç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«åŒæ—¶ä½¿ç”¨äº†<code>@Transactional</code>æ³¨è§£ï¼Œåˆ™ä½¿ç”¨åœ¨ç±»çº§åˆ«çš„æ³¨è§£ä¼šé‡è½½æ–¹æ³•çº§åˆ«çš„æ³¨è§£ã€‚ </p><p>æ³¨æ„ï¼šSpringbootæä¾›äº†ä¸€ä¸ª<code>@EnableTransactionManagement</code>æ³¨è§£åœ¨é…ç½®ç±»ä¸Šæ¥å¼€å¯å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒã€‚æ³¨è§£<code>@EnableTransactionManagement</code>æ˜¯é»˜è®¤æ‰“å¼€çš„ï¼Œæƒ³è¦å…³é—­äº‹åŠ¡ç®¡ç†ï¼Œæƒ³è¦åœ¨ç¨‹åºå…¥å£å°†è¿™ä¸ªæ³¨è§£æ”¹ä¸ºfalse</p><h3 id="åˆ†å¸ƒå¼äº‹ç‰©ç®¡ç†"><a href="#åˆ†å¸ƒå¼äº‹ç‰©ç®¡ç†" class="headerlink" title="åˆ†å¸ƒå¼äº‹ç‰©ç®¡ç†"></a>åˆ†å¸ƒå¼äº‹ç‰©ç®¡ç†</h3><p>å•¥æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡å‘¢ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨æ‰§è¡Œä¸€ä¸ªä¸šåŠ¡é€»è¾‘çš„æ—¶å€™æœ‰ä¸¤æ­¥åˆ†åˆ«æ“ä½œAæ•°æ®æºå’ŒBæ•°æ®æºï¼Œå½“æˆ‘ä»¬åœ¨Aæ•°æ®æºæ‰§è¡Œæ•°æ®æ›´æ”¹åï¼Œåœ¨Bæ•°æ®æºæ‰§è¡Œæ—¶å‡ºç°è¿è¡Œæ—¶å¼‚å¸¸ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»è¦è®©Bæ•°æ®æºçš„æ“ä½œå›æ»šï¼Œå¹¶å›æ»šå¯¹Aæ•°æ®æºçš„æ“ä½œã€‚è¿™ç§æƒ…å†µåœ¨æ”¯ä»˜ä¸šåŠ¡æ—¶å¸¸å¸¸å‡ºç°ï¼Œæ¯”å¦‚ä¹°ç¥¨ä¸šåŠ¡åœ¨æœ€åæ”¯ä»˜å¤±è´¥ï¼Œé‚£ä¹‹å‰çš„æ“ä½œå¿…é¡»å…¨éƒ¨å›æ»šï¼Œå¦‚æœä¹‹å‰çš„æ“ä½œåˆ†å¸ƒåœ¨å¤šä¸ªæ•°æ®æºä¸­ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯å…¸å‹çš„åˆ†å¸ƒå¼äº‹åŠ¡å›æ»š</p><p>äº†è§£äº†ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé‚£åˆ†å¸ƒå¼äº‹åŠ¡åœ¨javaçš„è§£å†³æ–¹æ¡ˆå°±æ˜¯JTA(å³Java Transaction API)ã€‚</p><p>springbootå®˜æ–¹æä¾›äº† <a href="http://www.atomikos.com/" target="_blank" rel="noopener">Atomikos</a> ï¼Œ <a href="https://github.com/bitronix/btm" target="_blank" rel="noopener">Bitronix</a> ï¼Œ<a href="http://www.narayana.io/" target="_blank" rel="noopener">Narayana</a> çš„<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-jta.html" target="_blank" rel="noopener">ç±»äº‹åŠ¡ç®¡ç†å™¨ </a></p><h4 id="ç±»äº‹åŠ¡ç®¡ç†å™¨Atomikos"><a href="#ç±»äº‹åŠ¡ç®¡ç†å™¨Atomikos" class="headerlink" title="ç±»äº‹åŠ¡ç®¡ç†å™¨Atomikos"></a>ç±»äº‹åŠ¡ç®¡ç†å™¨Atomikos</h4><h5 id="POM-8"><a href="#POM-8" class="headerlink" title="POM"></a>POM</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jta-atomikos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="é…ç½®æ–‡ä»¶-9"><a href="#é…ç½®æ–‡ä»¶-9" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># Mysql 1</span><br><span class="line">mysql.datasource.test1.url = jdbc:mysql://localhost:3306/test01?useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">mysql.datasource.test1.username = root</span><br><span class="line">mysql.datasource.test1.password = 123456</span><br><span class="line"></span><br><span class="line">mysql.datasource.test1.minPoolSize = 3</span><br><span class="line">mysql.datasource.test1.maxPoolSize = 25</span><br><span class="line">mysql.datasource.test1.maxLifetime = 20000</span><br><span class="line">mysql.datasource.test1.borrowConnectionTimeout = 30</span><br><span class="line">mysql.datasource.test1.loginTimeout = 30</span><br><span class="line">mysql.datasource.test1.maintenanceInterval = 60</span><br><span class="line">mysql.datasource.test1.maxIdleTime = 60</span><br><span class="line"></span><br><span class="line"># Mysql 2</span><br><span class="line">mysql.datasource.test2.url =jdbc:mysql://localhost:3306/test02?useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">mysql.datasource.test2.username =root</span><br><span class="line">mysql.datasource.test2.password =123456</span><br><span class="line"></span><br><span class="line">mysql.datasource.test2.minPoolSize = 3</span><br><span class="line">mysql.datasource.test2.maxPoolSize = 25</span><br><span class="line">mysql.datasource.test2.maxLifetime = 20000</span><br><span class="line">mysql.datasource.test2.borrowConnectionTimeout = 30</span><br><span class="line">mysql.datasource.test2.loginTimeout = 30</span><br><span class="line">mysql.datasource.test2.maintenanceInterval = 60</span><br><span class="line">mysql.datasource.test2.maxIdleTime = 60</span><br></pre></td></tr></table></figure><h5 id="è¯»å–é…ç½®æ–‡ä»¶ä¿¡æ¯"><a href="#è¯»å–é…ç½®æ–‡ä»¶ä¿¡æ¯" class="headerlink" title="è¯»å–é…ç½®æ–‡ä»¶ä¿¡æ¯"></a>è¯»å–é…ç½®æ–‡ä»¶ä¿¡æ¯</h5><p>ä»¥ä¸‹æ˜¯è¯»å–æ•°æ®åº“1çš„é…ç½®æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"mysql.datasource.test1"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBConfig1</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String url;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> minPoolSize;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxPoolSize;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxLifetime;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> borrowConnectionTimeout;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> loginTimeout;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maintenanceInterval;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxIdleTime;</span><br><span class="line"><span class="keyword">private</span> String testQuery;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯»å–æ•°æ®åº“2çš„é…ç½®æ–‡ä»¶ç•¥</p><h5 id="åˆ›å»ºæ•°æ®æº"><a href="#åˆ›å»ºæ•°æ®æº" class="headerlink" title="åˆ›å»ºæ•°æ®æº"></a>åˆ›å»ºæ•°æ®æº</h5><p>æ•°æ®æº1ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// basePackages æœ€å¥½åˆ†å¼€é…ç½® å¦‚æœæ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹å¯èƒ½ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = <span class="string">"tech.tengshe789.test01"</span>, sqlSessionTemplateRef = <span class="string">"testSqlSessionTemplate"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é…ç½®æ•°æ®æº</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"testDataSource"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">testDataSource</span><span class="params">(DBConfig1 testConfig)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">MysqlXADataSource mysqlXaDataSource = <span class="keyword">new</span> MysqlXADataSource();</span><br><span class="line">mysqlXaDataSource.setUrl(testConfig.getUrl());</span><br><span class="line">mysqlXaDataSource.setPinGlobalTxToPhysicalConnection(<span class="keyword">true</span>);</span><br><span class="line">mysqlXaDataSource.setPassword(testConfig.getPassword());</span><br><span class="line">mysqlXaDataSource.setUser(testConfig.getUsername());</span><br><span class="line">mysqlXaDataSource.setPinGlobalTxToPhysicalConnection(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">AtomikosDataSourceBean xaDataSource = <span class="keyword">new</span> AtomikosDataSourceBean();</span><br><span class="line">xaDataSource.setXaDataSource(mysqlXaDataSource);</span><br><span class="line">xaDataSource.setUniqueResourceName(<span class="string">"testDataSource"</span>);</span><br><span class="line"></span><br><span class="line">xaDataSource.setMinPoolSize(testConfig.getMinPoolSize());</span><br><span class="line">xaDataSource.setMaxPoolSize(testConfig.getMaxPoolSize());</span><br><span class="line">xaDataSource.setMaxLifetime(testConfig.getMaxLifetime());</span><br><span class="line">xaDataSource.setBorrowConnectionTimeout(testConfig.getBorrowConnectionTimeout());</span><br><span class="line">xaDataSource.setLoginTimeout(testConfig.getLoginTimeout());</span><br><span class="line">xaDataSource.setMaintenanceInterval(testConfig.getMaintenanceInterval());</span><br><span class="line">xaDataSource.setMaxIdleTime(testConfig.getMaxIdleTime());</span><br><span class="line">xaDataSource.setTestQuery(testConfig.getTestQuery());</span><br><span class="line"><span class="keyword">return</span> xaDataSource;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"testSqlSessionFactory"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">testSqlSessionFactory</span><span class="params">(@Qualifier(<span class="string">"testDataSource"</span>)</span> DataSource dataSource)</span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">SqlSessionFactoryBean bean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">bean.setDataSource(dataSource);</span><br><span class="line"><span class="keyword">return</span> bean.getObject();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"testSqlSessionTemplate"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionTemplate <span class="title">testSqlSessionTemplate</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">@Qualifier(<span class="string">"testSqlSessionFactory"</span>)</span> SqlSessionFactory sqlSessionFactory) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•°æ®åº“2ç•¥</p><h5 id="å¦‚ä½•å¯åŠ¨"><a href="#å¦‚ä½•å¯åŠ¨" class="headerlink" title="å¦‚ä½•å¯åŠ¨"></a>å¦‚ä½•å¯åŠ¨</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties</span>(value = &#123; DBConfig1.class, DBConfig2.class &#125;)</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MainApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="å®šæ—¶ä»»åŠ¡"><a href="#å®šæ—¶ä»»åŠ¡" class="headerlink" title="å®šæ—¶ä»»åŠ¡"></a>å®šæ—¶ä»»åŠ¡</h2><p>åœ¨åšé¡¹ç›®æ—¶æœ‰æ—¶å€™ä¼šæœ‰å®šæ—¶å™¨ä»»åŠ¡çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æŸæŸæ—¶é—´åº”è¯¥åšä»€ä¹ˆï¼Œå¤šå°‘ç§’åº”è¯¥æ€ä¹ˆæ ·ä¹‹ç±»çš„ã€‚</p><p>springæ”¯æŒå¤šç§å®šæ—¶ä»»åŠ¡çš„å®ç°ã€‚æˆ‘ä»¬æ¥ä»‹ç»ä¸‹ä½¿ç”¨Quartz å’ŒScheduler</p><h3 id="Spring-Schedule"><a href="#Spring-Schedule" class="headerlink" title="Spring Schedule"></a>Spring Schedule</h3><p>Spring Schedule å®ç°å®šæ—¶ä»»åŠ¡æœ‰ä¸¤ç§æ–¹å¼ 1. ä½¿ç”¨XMLé…ç½®å®šæ—¶ä»»åŠ¡ï¼Œ 2. ä½¿ç”¨ @Scheduled æ³¨è§£ã€‚ </p><h4 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>å›ºå®šç­‰å¾…æ—¶é—´ <code>@Scheduled(fixedDelay = æ—¶é—´é—´éš” )</code></p><p>å›ºå®šé—´éš”æ—¶é—´ <code>@Scheduled(fixedRate = æ—¶é—´é—´éš” )</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleJobs</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> SECOND = <span class="number">1</span> * <span class="number">1000</span>;</span><br><span class="line">    FastDateFormat fdf = FastDateFormat.getInstance(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedDelay = SECOND * <span class="number">2</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fixedDelayJob</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">"[FixedDelayJob Execute]"</span>+fdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Cornè¡¨è¾¾å¼ <code>@Scheduled(cron = Cornè¡¨è¾¾å¼)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleJobs</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> SECOND = <span class="number">1</span> * <span class="number">1000</span>;</span><br><span class="line">    FastDateFormat fdf = FastDateFormat.getInstance(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(cron = <span class="string">"0/4 * * * * ?"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cronJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"[CronJob Execute]"</span>+fdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><p>è¦åœ¨ä¸»æ–¹æ³•ä¸ŠåŠ ä¸Š<code>@EnableScheduling</code></p><h3 id="Quartz"><a href="#Quartz" class="headerlink" title="Quartz"></a>Quartz</h3><h4 id="POM-9"><a href="#POM-9" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶-10"><a href="#é…ç½®æ–‡ä»¶-10" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># spring boot 2.x å·²é›†æˆQuartzï¼Œæ— éœ€è‡ªå·±é…ç½®</span><br><span class="line">spring.quartz.job-store-type=jdbc</span><br><span class="line">spring.quartz.properties.org.quartz.scheduler.instanceName=clusteredScheduler</span><br><span class="line">spring.quartz.properties.org.quartz.scheduler.instanceId=AUTO</span><br><span class="line">spring.quartz.properties.org.quartz.jobStore.class=org.quartz.impl.jdbcjobstore.JobStoreTX</span><br><span class="line">spring.quartz.properties.org.quartz.jobStore.driverDelegateClass=org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span><br><span class="line">spring.quartz.properties.org.quartz.jobStore.tablePrefix=QRTZ_</span><br><span class="line">spring.quartz.properties.org.quartz.jobStore.isClustered=true</span><br><span class="line">spring.quartz.properties.org.quartz.jobStore.clusterCheckinInterval=10000</span><br><span class="line">spring.quartz.properties.org.quartz.jobStore.useProperties=false</span><br><span class="line">spring.quartz.properties.org.quartz.threadPool.class=org.quartz.simpl.SimpleThreadPool</span><br><span class="line">spring.quartz.properties.org.quartz.threadPool.threadCount=10</span><br><span class="line">spring.quartz.properties.org.quartz.threadPool.threadPriority=5</span><br><span class="line">spring.quartz.properties.org.quartz.threadPool.threadsInheritContextClassLoaderOfInitializingThread=true</span><br></pre></td></tr></table></figure><h4 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JobDetail <span class="title">uploadTaskDetail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JobBuilder.newJob(UploadTask.class).withIdentity(<span class="string">"uploadTask"</span>).storeDurably().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Trigger <span class="title">uploadTaskTrigger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CronScheduleBuilder scheduleBuilder = CronScheduleBuilder.cronSchedule(<span class="string">"*/5 * * * * ?"</span>);</span><br><span class="line">        <span class="keyword">return</span> TriggerBuilder.newTrigger().forJob(uploadTaskDetail())</span><br><span class="line">                .withIdentity(<span class="string">"uploadTask"</span>)</span><br><span class="line">                .withSchedule(scheduleBuilder)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®ç°ç±»"><a href="#å®ç°ç±»" class="headerlink" title="å®ç°ç±»"></a>å®ç°ç±»</h4><p>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œåˆ†åˆ«åˆ¶å®šå…·ä½“ä»»åŠ¡ç±»å’Œè§¦å‘çš„è§„åˆ™ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@DisallowConcurrentExecution</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadTask</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TencentYunService tencentYunService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext jobExecutionContext)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ä»»åŠ¡å¼€å§‹"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">6000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"ä»»åŠ¡ç»“æŸ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@DisallowConcurrentExecution</code>ç¦æ­¢å¹¶å‘æ‰§è¡Œ </p><p>å¹¶å‘æ‰§è¡Œæ–¹é¢ï¼Œç³»ç»Ÿé»˜è®¤ä¸ºtrue,å³ç¬¬ä¸€ä¸ªä»»åŠ¡è¿˜æœªæ‰§è¡Œå®Œæ•´ï¼Œç¬¬äºŒä¸ªä»»åŠ¡å¦‚æœåˆ°äº†æ‰§è¡Œæ—¶é—´ï¼Œåˆ™ä¼šç«‹é©¬å¼€å¯æ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·å¦‚æœæˆ‘ä»¬æ˜¯ä»æ•°æ®åº“è¯»å–ä¿¡æ¯ï¼Œä¸¤æ¬¡é‡å¤è¯»å–å¯èƒ½å‡ºç°é‡å¤æ‰§è¡Œä»»åŠ¡çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªå€¼è®¾ç½®ä¸ºfalseï¼Œè¿™æ ·ç¬¬äºŒä¸ªä»»åŠ¡ä¼šå¾€åæ¨è¿Ÿï¼Œåªæœ‰åœ¨ç¬¬ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆåæ‰ä¼šæ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡ </p><h2 id="æ—¥å¿—ç®¡ç†"><a href="#æ—¥å¿—ç®¡ç†" class="headerlink" title="æ—¥å¿—ç®¡ç†"></a>æ—¥å¿—ç®¡ç†</h2><h3 id="log4j"><a href="#log4j" class="headerlink" title="log4j"></a>log4j</h3><h4 id="POM-10"><a href="#POM-10" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring boot start --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æ’é™¤è‡ªå¸¦çš„logbackä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- springboot-log4j --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶-11"><a href="#é…ç½®æ–‡ä»¶-11" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>æ–‡ä»¶åç§°<code>log4j.properties</code> </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#log4j.rootLogger=CONSOLE,info,error,DEBUG</span></span><br><span class="line"><span class="string">log4j.rootLogger=info,error,CONSOLE,DEBUG</span></span><br><span class="line"><span class="string">log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender</span>     </span><br><span class="line"><span class="string">log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout</span>     </span><br><span class="line"><span class="string">log4j.appender.CONSOLE.layout.ConversionPattern=%d&#123;yyyy-MM-dd-HH-mm&#125;</span> <span class="string">[%t]</span> <span class="string">[%c]</span> <span class="string">[%p]</span> <span class="bullet">-</span> <span class="string">%m%n</span>     </span><br><span class="line"><span class="string">log4j.logger.info=info</span></span><br><span class="line"><span class="string">log4j.appender.info=org.apache.log4j.DailyRollingFileAppender</span></span><br><span class="line"><span class="string">log4j.appender.info.layout=org.apache.log4j.PatternLayout</span>     </span><br><span class="line"><span class="string">log4j.appender.info.layout.ConversionPattern=%d&#123;yyyy-MM-dd-HH-mm&#125;</span> <span class="string">[%t]</span> <span class="string">[%c]</span> <span class="string">[%p]</span> <span class="bullet">-</span> <span class="string">%m%n</span>  </span><br><span class="line"><span class="string">log4j.appender.info.datePattern='.'yyyy-MM-dd</span></span><br><span class="line"><span class="string">log4j.appender.info.Threshold</span> <span class="string">=</span> <span class="string">info</span>   </span><br><span class="line"><span class="string">log4j.appender.info.append=true</span>   </span><br><span class="line"><span class="comment">#log4j.appender.info.File=/home/admin/pms-api-services/logs/info/api_services_info</span></span><br><span class="line"><span class="string">log4j.appender.info.File=/Users/dddd/Documents/testspace/pms-api-services/logs/info/api_services_info</span></span><br><span class="line"><span class="string">log4j.logger.error=error</span>  </span><br><span class="line"><span class="string">log4j.appender.error=org.apache.log4j.DailyRollingFileAppender</span></span><br><span class="line"><span class="string">log4j.appender.error.layout=org.apache.log4j.PatternLayout</span>     </span><br><span class="line"><span class="string">log4j.appender.error.layout.ConversionPattern=%d&#123;yyyy-MM-dd-HH-mm&#125;</span> <span class="string">[%t]</span> <span class="string">[%c]</span> <span class="string">[%p]</span> <span class="bullet">-</span> <span class="string">%m%n</span>  </span><br><span class="line"><span class="string">log4j.appender.error.datePattern='.'yyyy-MM-dd</span></span><br><span class="line"><span class="string">log4j.appender.error.Threshold</span> <span class="string">=</span> <span class="string">error</span>   </span><br><span class="line"><span class="string">log4j.appender.error.append=true</span>   </span><br><span class="line"><span class="comment">#log4j.appender.error.File=/home/admin/pms-api-services/logs/error/api_services_error</span></span><br><span class="line"><span class="string">log4j.appender.error.File=/Users/dddd/Documents/testspace/pms-api-services/logs/error/api_services_error</span></span><br><span class="line"><span class="string">log4j.logger.DEBUG=DEBUG</span></span><br><span class="line"><span class="string">log4j.appender.DEBUG=org.apache.log4j.DailyRollingFileAppender</span></span><br><span class="line"><span class="string">log4j.appender.DEBUG.layout=org.apache.log4j.PatternLayout</span>     </span><br><span class="line"><span class="string">log4j.appender.DEBUG.layout.ConversionPattern=%d&#123;yyyy-MM-dd-HH-mm&#125;</span> <span class="string">[%t]</span> <span class="string">[%c]</span> <span class="string">[%p]</span> <span class="bullet">-</span> <span class="string">%m%n</span>  </span><br><span class="line"><span class="string">log4j.appender.DEBUG.datePattern='.'yyyy-MM-dd</span></span><br><span class="line"><span class="string">log4j.appender.DEBUG.Threshold</span> <span class="string">=</span> <span class="string">DEBUG</span>   </span><br><span class="line"><span class="string">log4j.appender.DEBUG.append=true</span>   </span><br><span class="line"><span class="comment">#log4j.appender.DEBUG.File=/home/admin/pms-api-services/logs/debug/api_services_debug</span></span><br><span class="line"><span class="string">log4j.appender.DEBUG.File=/Users/dddd/Documents/testspace/pms-api-services/logs/debug/api_services_debug</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(IndexController.class);</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨AOPç»Ÿä¸€å¤„ç†Webè¯·æ±‚æ—¥å¿—"><a href="#ä½¿ç”¨AOPç»Ÿä¸€å¤„ç†Webè¯·æ±‚æ—¥å¿—" class="headerlink" title="ä½¿ç”¨AOPç»Ÿä¸€å¤„ç†Webè¯·æ±‚æ—¥å¿—"></a>ä½¿ç”¨AOPç»Ÿä¸€å¤„ç†Webè¯·æ±‚æ—¥å¿—</h3><h4 id="POM-11"><a href="#POM-11" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä»£ç -4"><a href="#ä»£ç -4" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebLogAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(WebLogAspect.class);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"execution(public * tech.tengshe789.controller.*.*(..))"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">webLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span>(<span class="string">"webLog()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"><span class="comment">// æ¥æ”¶åˆ°è¯·æ±‚ï¼Œè®°å½•è¯·æ±‚å†…å®¹</span></span><br><span class="line">ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">HttpServletRequest request = attributes.getRequest();</span><br><span class="line"><span class="comment">// è®°å½•ä¸‹è¯·æ±‚å†…å®¹</span></span><br><span class="line">logger.info(<span class="string">"URL : "</span> + request.getRequestURL().toString());</span><br><span class="line">logger.info(<span class="string">"HTTP_METHOD : "</span> + request.getMethod());</span><br><span class="line">logger.info(<span class="string">"IP : "</span> + request.getRemoteAddr());</span><br><span class="line">Enumeration&lt;String&gt; enu = request.getParameterNames();</span><br><span class="line"><span class="keyword">while</span> (enu.hasMoreElements()) &#123;</span><br><span class="line">String name = (String) enu.nextElement();</span><br><span class="line">logger.info(<span class="string">"name:&#123;&#125;,value:&#123;&#125;"</span>, name, request.getParameter(name));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterReturning</span>(returning = <span class="string">"ret"</span>, pointcut = <span class="string">"webLog()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">(Object ret)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"><span class="comment">// å¤„ç†å®Œè¯·æ±‚ï¼Œè¿”å›å†…å®¹</span></span><br><span class="line">logger.info(<span class="string">"RESPONSE : "</span> + ret);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="lombok-æ’ä»¶"><a href="#lombok-æ’ä»¶" class="headerlink" title="lombok æ’ä»¶"></a>lombok æ’ä»¶</h3><p>éå¸¸ç®€å•çš„åŠæ³•</p><h4 id="POM-12"><a href="#POM-12" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä»£ç -5"><a href="#ä»£ç -5" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>ç±»ä¸­æ·»åŠ <code>@Slf4j</code> æ³¨è§£å³å¯ã€‚ä½¿ç”¨æ˜¯ç›´æ¥è¾“å…¥logå…¨å±€å˜é‡</p><h4 id="Lombokçš„å…¶ä»–ç”¨æ³•"><a href="#Lombokçš„å…¶ä»–ç”¨æ³•" class="headerlink" title="Lombokçš„å…¶ä»–ç”¨æ³•"></a>Lombokçš„å…¶ä»–ç”¨æ³•</h4><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Data æ ‡ç­¾ï¼Œç”Ÿæˆgetter/setter toString()ç­‰æ–¹æ³• </span><br><span class="line">@NonNull : <span class="type"></span>è®©ä½ ä¸åœ¨æ‹…å¿§å¹¶ä¸”çˆ±ä¸ŠNullPointerException </span><br><span class="line">@CleanUp : <span class="type"></span>è‡ªåŠ¨èµ„æºç®¡ç†ï¼šä¸ç”¨å†åœ¨finallyä¸­æ·»åŠ èµ„æºçš„closeæ–¹æ³• </span><br><span class="line">@Setter/@Getter : <span class="type"></span>è‡ªåŠ¨ç”Ÿæˆ<span class="keyword">set</span>å’Œ<span class="keyword">get</span>æ–¹æ³• </span><br><span class="line">@ToString : <span class="type"></span>è‡ªåŠ¨ç”ŸæˆtoStringæ–¹æ³• </span><br><span class="line">@EqualsAndHashcode : <span class="type"></span>ä»å¯¹è±¡çš„å­—æ®µä¸­ç”ŸæˆhashCodeå’Œequalsçš„å®ç° </span><br><span class="line">@NoArgsConstructor/@RequiredArgsConstructor/@AllArgsConstructor </span><br><span class="line">è‡ªåŠ¨ç”Ÿæˆæ„é€ æ–¹æ³• </span><br><span class="line">@Data : <span class="type"></span>è‡ªåŠ¨ç”Ÿæˆ<span class="keyword">set</span>/<span class="keyword">get</span>æ–¹æ³•ï¼ŒtoStringæ–¹æ³•ï¼Œequalsæ–¹æ³•ï¼ŒhashCodeæ–¹æ³•ï¼Œä¸å¸¦å‚æ•°çš„æ„é€ æ–¹æ³• </span><br><span class="line">@Value : <span class="type"></span>ç”¨äºæ³¨è§£finalç±» </span><br><span class="line">@Builder : <span class="type"></span>äº§ç”Ÿå¤æ‚çš„æ„å»ºå™¨apiç±»</span><br><span class="line">@SneakyThrows : <span class="type"></span>å¼‚å¸¸å¤„ç†ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ </span><br><span class="line">@Synchronized : <span class="type"></span>åŒæ­¥æ–¹æ³•å®‰å…¨çš„è½¬åŒ– </span><br><span class="line">@Getter(lazy=<span class="literal">true</span>) : <span class="type"></span></span><br><span class="line"><span class="type"></span>@Log : <span class="type"></span>æ”¯æŒå„ç§loggerå¯¹è±¡ï¼Œä½¿ç”¨æ—¶ç”¨å¯¹åº”çš„æ³¨è§£ï¼Œå¦‚ï¼š@Log4</span><br></pre></td></tr></table></figure><h2 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h2><p>æ‹¦æˆªå™¨ï¼Œåœ¨AOP(Aspect-Oriented Programming)ä¸­ç”¨äºåœ¨æŸä¸ªæ–¹æ³•æˆ–å­—æ®µè¢«è®¿é—®ä¹‹å‰ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œç„¶ååœ¨ä¹‹å‰æˆ–ä¹‹ååŠ å…¥æŸäº›æ“ä½œã€‚æ‹¦æˆªæ˜¯AOPçš„ä¸€ç§å®ç°ç­–ç•¥ã€‚ </p><p>ï¼ˆ1ï¼‰æ‹¦æˆªå™¨æ˜¯åŸºäºjavaçš„åå°„æœºåˆ¶çš„ï¼Œè€Œè¿‡æ»¤å™¨æ˜¯åŸºäºå‡½æ•°å›è°ƒã€‚</p><p>ï¼ˆ2ï¼‰æ‹¦æˆªå™¨ä¸ä¾èµ–äºservletå®¹å™¨ï¼Œè€Œè¿‡æ»¤å™¨ä¾èµ–äºservletå®¹å™¨ã€‚</p><p>ï¼ˆ3ï¼‰æ‹¦æˆªå™¨åªèƒ½å¯¹Controllerè¯·æ±‚èµ·ä½œç”¨ï¼Œè€Œè¿‡æ»¤å™¨åˆ™å¯ä»¥å¯¹å‡ ä¹æ‰€æœ‰çš„è¯·æ±‚èµ·ä½œç”¨ã€‚</p><p>ï¼ˆ4ï¼‰åœ¨Controllerçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæ‹¦æˆªå™¨å¯ä»¥å¤šæ¬¡è¢«è°ƒç”¨ï¼Œè€Œè¿‡æ»¤å™¨åªèƒ½åœ¨å®¹å™¨åˆå§‹åŒ–æ—¶è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p><p>è¿‡æ»¤å™¨ï¼ˆfilterï¼‰å’Œæ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰æ˜¯æœ‰åŒºåˆ«çš„ï¼Œ<a href="http://blog.csdn.net/xiaodanjava/article/details/32125687" target="_blank" rel="noopener">è¯¦æƒ…</a> ï¼Œä»–ä»¬çš„æ‰§è¡Œé¡ºåºï¼š å…ˆfilter å interceptor</p><p>-&gt;è¿‡æ»¤å™¨åº”ç”¨åœºæ™¯:è®¾ç½®ç¼–ç å­—ç¬¦ã€è¿‡æ»¤é“­æ„Ÿå­—ç¬¦</p><p>-&gt;æ‹¦æˆªå™¨åº”ç”¨åœºæ™¯:æ‹¦æˆªæœªç™»é™†ç”¨æˆ·ã€å®¡è®¡æ—¥å¿—</p><h3 id="è‡ªå®šä¹‰æ‹¦æˆªå™¨"><a href="#è‡ªå®šä¹‰æ‹¦æˆªå™¨" class="headerlink" title="è‡ªå®šä¹‰æ‹¦æˆªå™¨"></a>è‡ªå®šä¹‰æ‹¦æˆªå™¨</h3><h4 id="ä»£ç -6"><a href="#ä»£ç -6" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>æ³¨å†Œæ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebAppConfig</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> LoginIntercept loginIntercept;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">WebMvcConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">registry.addInterceptor(loginIntercept).addPathPatterns(<span class="string">"/*"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ¨¡æ‹Ÿç™»å½•æ‹¦æˆªå™¨ï¼ŒéªŒè¯è¯·æ±‚æ˜¯å¦æœ‰tokenå‚æ•° </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginIntercept</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">log.info(<span class="string">"å¼€å§‹æ‹¦æˆªç™»å½•è¯·æ±‚...."</span>);</span><br><span class="line">String token = request.getParameter(<span class="string">"token"</span>);</span><br><span class="line"><span class="keyword">if</span> (StringUtils.isEmpty(token)) &#123;</span><br><span class="line">response.getWriter().println(<span class="string">"not found token"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><p>åœ¨ Spring Bootä¸­ï¼Œé€šè¿‡<code>@EnableCaching</code>æ³¨è§£è‡ªåŠ¨åŒ–é…ç½®åˆé€‚çš„ç¼“å­˜ç®¡ç†å™¨ï¼ˆCacheManagerï¼‰ï¼ŒSpring Bootæ ¹æ®ä¸‹é¢çš„é¡ºåºå»ä¾¦æµ‹ç¼“å­˜æä¾›è€…ï¼š  Generic  ï¼Œ JCache (JSR-107)ï¼Œ EhCache 2.x  ï¼ŒHazelcast  ï¼Œ Infinispan  ï¼ŒRedis  ï¼ŒGuava ï¼Œ Simple </p><h3 id="EhCache"><a href="#EhCache" class="headerlink" title="EhCache"></a>EhCache</h3><h4 id="POM-13"><a href="#POM-13" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ–°å»ºehcache-xml-æ–‡ä»¶"><a href="#æ–°å»ºehcache-xml-æ–‡ä»¶" class="headerlink" title="æ–°å»ºehcache.xml æ–‡ä»¶"></a>æ–°å»ºehcache.xml æ–‡ä»¶</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"http://ehcache.org/ehcache.xsd"</span></span></span><br><span class="line"><span class="tag"><span class="attr">updateCheck</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">"java.io.tmpdir/Tmp_EhCache"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é»˜è®¤é…ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">defaultCache</span> <span class="attr">maxElementsInMemory</span>=<span class="string">"5000"</span> <span class="attr">eternal</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag"><span class="attr">timeToIdleSeconds</span>=<span class="string">"120"</span> <span class="attr">timeToLiveSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag"><span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">"LRU"</span> <span class="attr">overflowToDisk</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">"baseCache"</span> <span class="attr">maxElementsInMemory</span>=<span class="string">"10000"</span></span></span><br><span class="line"><span class="tag"><span class="attr">maxElementsOnDisk</span>=<span class="string">"100000"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®ä¿¡æ¯ä»‹ç»</p><p><code>name</code>:ç¼“å­˜åç§°ã€‚  </p><p><code>maxElementsInMemory</code>ï¼šç¼“å­˜æœ€å¤§ä¸ªæ•°ã€‚  </p><p><code>eternal</code>:å¯¹è±¡æ˜¯å¦æ°¸ä¹…æœ‰æ•ˆï¼Œä¸€ä½†è®¾ç½®äº†ï¼Œtimeoutå°†ä¸èµ·ä½œç”¨ã€‚  </p><p><code>timeToIdleSeconds</code>ï¼šè®¾ç½®å¯¹è±¡åœ¨å¤±æ•ˆå‰çš„å…è®¸é—²ç½®æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚ä»…å½“eternal=<strong>false</strong>å¯¹è±¡ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆæ—¶ä½¿ç”¨ï¼Œå¯é€‰å±æ€§ï¼Œé»˜è®¤å€¼æ˜¯0ï¼Œä¹Ÿå°±æ˜¯å¯é—²ç½®æ—¶é—´æ— ç©·å¤§ã€‚  </p><p><code>timeToLiveSeconds</code>ï¼šè®¾ç½®å¯¹è±¡åœ¨å¤±æ•ˆå‰å…è®¸å­˜æ´»æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚æœ€å¤§æ—¶é—´ä»‹äºåˆ›å»ºæ—¶é—´å’Œå¤±æ•ˆæ—¶é—´ä¹‹é—´ã€‚ä»…å½“eternal=<strong>false</strong>å¯¹è±¡ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆæ—¶ä½¿ç”¨ï¼Œé»˜è®¤æ˜¯0.ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡å­˜æ´»æ—¶é—´æ— ç©·å¤§ã€‚  </p><p><code>overflowToDisk</code>ï¼šå½“å†…å­˜ä¸­å¯¹è±¡æ•°é‡è¾¾åˆ°maxElementsInMemoryæ—¶ï¼ŒEhcacheå°†ä¼šå¯¹è±¡å†™åˆ°ç£ç›˜ä¸­ã€‚  </p><p><code>diskSpoolBufferSizeMB</code>ï¼šè¿™ä¸ªå‚æ•°è®¾ç½®DiskStoreï¼ˆç£ç›˜ç¼“å­˜ï¼‰çš„ç¼“å­˜åŒºå¤§å°ã€‚é»˜è®¤æ˜¯30MBã€‚æ¯ä¸ªCacheéƒ½åº”è¯¥æœ‰è‡ªå·±çš„ä¸€ä¸ªç¼“å†²åŒºã€‚  </p><p><code>maxElementsOnDisk</code>ï¼šç¡¬ç›˜æœ€å¤§ç¼“å­˜ä¸ªæ•°ã€‚  </p><p><code>diskPersistent</code>ï¼šæ˜¯å¦ç¼“å­˜è™šæ‹Ÿæœºé‡å¯æœŸæ•°æ® Whether the disk store persists between restarts of the Virtual Machine. The <strong>default</strong> value is <strong>false</strong>.  </p><p><code>diskExpiryThreadIntervalSeconds</code>ï¼šç£ç›˜å¤±æ•ˆçº¿ç¨‹è¿è¡Œæ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯120ç§’ã€‚  </p><p><code>memoryStoreEvictionPolicy</code>ï¼šå½“è¾¾åˆ°maxElementsInMemoryé™åˆ¶æ—¶ï¼ŒEhcacheå°†ä¼šæ ¹æ®æŒ‡å®šçš„ç­–ç•¥å»æ¸…ç†å†…å­˜ã€‚é»˜è®¤ç­–ç•¥æ˜¯LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ã€‚ä½ å¯ä»¥è®¾ç½®ä¸ºFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰æˆ–æ˜¯LFUï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰ã€‚  </p><p><code>clearOnFlush</code>ï¼šå†…å­˜æ•°é‡æœ€å¤§æ—¶æ˜¯å¦æ¸…é™¤ã€‚  </p><h4 id="å…³äºæ³¨è§£å’Œä»£ç ä½¿ç”¨"><a href="#å…³äºæ³¨è§£å’Œä»£ç ä½¿ç”¨" class="headerlink" title="å…³äºæ³¨è§£å’Œä»£ç ä½¿ç”¨"></a>å…³äºæ³¨è§£å’Œä»£ç ä½¿ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheConfig</span>(cacheNames = <span class="string">"baseCache"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"><span class="meta">@Select</span>(<span class="string">"select * from users where name=#&#123;name&#125;"</span>)</span><br><span class="line"><span class="meta">@Cacheable</span></span><br><span class="line"><span class="function">UserEntity <span class="title">findName</span><span class="params">(@Param(<span class="string">"name"</span>)</span> String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¸…é™¤ç¼“å­˜"><a href="#æ¸…é™¤ç¼“å­˜" class="headerlink" title="æ¸…é™¤ç¼“å­˜"></a>æ¸…é™¤ç¼“å­˜</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> CacheManager cacheManager;</span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/remoKey"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remoKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">cacheManager.getCache(<span class="string">"baseCache"</span>).clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨-1"><a href="#å¯åŠ¨-1" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><p>ä¸»æ–¹æ³•å¯åŠ¨æ—¶åŠ ä¸Š<code>@EnableCaching</code>å³å¯</p><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><h4 id="ä½¿ç”¨è‡ªå¸¦é©±åŠ¨å™¨è¿æ¥"><a href="#ä½¿ç”¨è‡ªå¸¦é©±åŠ¨å™¨è¿æ¥" class="headerlink" title="ä½¿ç”¨è‡ªå¸¦é©±åŠ¨å™¨è¿æ¥"></a>ä½¿ç”¨è‡ªå¸¦é©±åŠ¨å™¨è¿æ¥</h4><p>ä½¿ç”¨RedisTemplate è¿æ¥</p><h5 id="POM-14"><a href="#POM-14" class="headerlink" title="POM"></a>POM</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="é…ç½®æ–‡ä»¶-12"><a href="#é…ç½®æ–‡ä»¶-12" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><p>å•æœº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#redis</span><br><span class="line"># Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span><br><span class="line">spring.redis.database=0</span><br><span class="line"># RedisæœåŠ¡å™¨åœ°å€</span><br><span class="line">spring.redis.host=127.0.0.1</span><br><span class="line"># RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span><br><span class="line">spring.redis.port=6379</span><br><span class="line"># RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰</span><br><span class="line">spring.redis.password=</span><br><span class="line"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span><br><span class="line">spring.redis.pool.max-active=8</span><br><span class="line"># è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span><br><span class="line">spring.redis.pool.max-wait=-1</span><br><span class="line"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span><br><span class="line">spring.redis.pool.max-idle=8</span><br><span class="line"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span><br><span class="line">spring.redis.pool.min-idle=0</span><br><span class="line"># è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span><br><span class="line">spring.redis.timeout=0</span><br></pre></td></tr></table></figure><p>é›†ç¾¤æˆ–å“¨å…µæ¨¡å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#Matserçš„ipåœ°å€  </span><br><span class="line">redis.hostName=192.168.177.128</span><br><span class="line">#ç«¯å£å·  </span><br><span class="line">redis.port=6382</span><br><span class="line">#å¦‚æœæœ‰å¯†ç   </span><br><span class="line">redis.password=</span><br><span class="line">#å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´å•ä½æ˜¯æ¯«ç§’ é»˜è®¤æ˜¯2000 </span><br><span class="line">redis.timeout=10000  </span><br><span class="line"></span><br><span class="line">#æœ€å¤§ç©ºé—²æ•°  </span><br><span class="line">redis.maxIdle=300  </span><br><span class="line">#è¿æ¥æ± çš„æœ€å¤§æ•°æ®åº“è¿æ¥æ•°ã€‚è®¾ä¸º0è¡¨ç¤ºæ— é™åˆ¶,å¦‚æœæ˜¯jedis 2.4ä»¥åç”¨redis.maxTotal  </span><br><span class="line">#redis.maxActive=600  </span><br><span class="line">#æ§åˆ¶ä¸€ä¸ªpoolå¯åˆ†é…å¤šå°‘ä¸ªjediså®ä¾‹,ç”¨æ¥æ›¿æ¢ä¸Šé¢çš„redis.maxActive,å¦‚æœæ˜¯jedis 2.4ä»¥åç”¨è¯¥å±æ€§  </span><br><span class="line">redis.maxTotal=1000  </span><br><span class="line">#æœ€å¤§å»ºç«‹è¿æ¥ç­‰å¾…æ—¶é—´ã€‚å¦‚æœè¶…è¿‡æ­¤æ—¶é—´å°†æ¥åˆ°å¼‚å¸¸ã€‚è®¾ä¸º-1è¡¨ç¤ºæ— é™åˆ¶ã€‚  </span><br><span class="line">redis.maxWaitMillis=1000  </span><br><span class="line">#è¿æ¥çš„æœ€å°ç©ºé—²æ—¶é—´ é»˜è®¤1800000æ¯«ç§’(30åˆ†é’Ÿ)  </span><br><span class="line">redis.minEvictableIdleTimeMillis=300000  </span><br><span class="line">#æ¯æ¬¡é‡Šæ”¾è¿æ¥çš„æœ€å¤§æ•°ç›®,é»˜è®¤3  </span><br><span class="line">redis.numTestsPerEvictionRun=1024  </span><br><span class="line">#é€å‡ºæ‰«æçš„æ—¶é—´é—´éš”(æ¯«ç§’) å¦‚æœä¸ºè´Ÿæ•°,åˆ™ä¸è¿è¡Œé€å‡ºçº¿ç¨‹, é»˜è®¤-1  </span><br><span class="line">redis.timeBetweenEvictionRunsMillis=30000  </span><br><span class="line">#æ˜¯å¦åœ¨ä»æ± ä¸­å–å‡ºè¿æ¥å‰è¿›è¡Œæ£€éªŒ,å¦‚æœæ£€éªŒå¤±è´¥,åˆ™ä»æ± ä¸­å»é™¤è¿æ¥å¹¶å°è¯•å–å‡ºå¦ä¸€ä¸ª  </span><br><span class="line">redis.testOnBorrow=true  </span><br><span class="line">#åœ¨ç©ºé—²æ—¶æ£€æŸ¥æœ‰æ•ˆæ€§, é»˜è®¤false  </span><br><span class="line">redis.testWhileIdle=true  </span><br><span class="line"></span><br><span class="line">#redisé›†ç¾¤é…ç½®      </span><br><span class="line">spring.redis.cluster.nodes=192.168.177.128:7001,192.168.177.128:7002,192.168.177.128:7003,192.168.177.128:7004,192.168.177.128:7005,192.168.177.128:7006</span><br><span class="line">spring.redis.cluster.max-redirects=3</span><br><span class="line"></span><br><span class="line">#å“¨å…µæ¨¡å¼</span><br><span class="line">#redis.sentinel.host1=192.168.177.128</span><br><span class="line">#redis.sentinel.port1=26379</span><br><span class="line"></span><br><span class="line">#redis.sentinel.host2=172.20.1.231  </span><br><span class="line">#redis.sentinel.port2=26379</span><br></pre></td></tr></table></figure><h5 id="é…ç½®ç±»-1"><a href="#é…ç½®ç±»-1" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> <span class="keyword">extends</span> <span class="title">CachingConfigurerSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.redis.host&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.redis.port&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.redis.timeout&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> timeout;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰ç¼“å­˜keyç”Ÿæˆç­–ç•¥</span></span><br><span class="line"><span class="comment">//    @Bean</span></span><br><span class="line"><span class="comment">//    public KeyGenerator keyGenerator() &#123;</span></span><br><span class="line"><span class="comment">//        return new KeyGenerator()&#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public Object generate(Object target, java.lang.reflect.Method method, Object... params) &#123;</span></span><br><span class="line"><span class="comment">//                StringBuffer sb = new StringBuffer();</span></span><br><span class="line"><span class="comment">//                sb.append(target.getClass().getName());</span></span><br><span class="line"><span class="comment">//                sb.append(method.getName());</span></span><br><span class="line"><span class="comment">//                for(Object obj:params)&#123;</span></span><br><span class="line"><span class="comment">//                    sb.append(obj.toString());</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//                return sb.toString();</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    <span class="comment">//ç¼“å­˜ç®¡ç†å™¨</span></span><br><span class="line">    <span class="meta">@Bean</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(@SuppressWarnings(<span class="string">"rawtypes"</span>)</span> RedisTemplate redisTemplate) </span>&#123;</span><br><span class="line">        RedisCacheManager cacheManager = <span class="keyword">new</span> RedisCacheManager(redisTemplate);</span><br><span class="line">        <span class="comment">//è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ </span></span><br><span class="line">        cacheManager.setDefaultExpiration(<span class="number">10000</span>);</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, String&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span></span>&#123;</span><br><span class="line">        StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate(factory);</span><br><span class="line">        setSerializer(template);<span class="comment">//è®¾ç½®åºåˆ—åŒ–å·¥å…·</span></span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setSerializer</span><span class="params">(StringRedisTemplate template)</span></span>&#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(&#123; <span class="string">"rawtypes"</span>, <span class="string">"unchecked"</span> &#125;)</span><br><span class="line">            Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">            ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">            om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">            om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">            jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">            template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Dao-1"><a href="#Dao-1" class="headerlink" title="Dao"></a>Dao</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@CacheConfig</span>(cacheNames = <span class="string">"users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into user(name,age) values(#&#123;name&#125;,#&#123;age&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">addUser</span><span class="params">(@Param(<span class="string">"name"</span>)</span>String name,@<span class="title">Param</span><span class="params">(<span class="string">"age"</span>)</span>String age)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user where id =#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="meta">@Cacheable</span>(key =<span class="string">"#p0"</span>) </span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(@Param(<span class="string">"id"</span>)</span> String id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CachePut</span>(key = <span class="string">"#p0"</span>)</span><br><span class="line">    <span class="meta">@Update</span>(<span class="string">"update user set name=#&#123;name&#125; where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updataById</span><span class="params">(@Param(<span class="string">"id"</span>)</span>String id,@<span class="title">Param</span><span class="params">(<span class="string">"name"</span>)</span>String name)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å¦‚æœæŒ‡å®šä¸º trueï¼Œåˆ™æ–¹æ³•è°ƒç”¨åå°†ç«‹å³æ¸…ç©ºæ‰€æœ‰ç¼“å­˜</span></span><br><span class="line">    <span class="meta">@CacheEvict</span>(key =<span class="string">"#p0"</span>,allEntries=<span class="keyword">true</span>)</span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from user where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(@Param(<span class="string">"id"</span>)</span>String id)</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@Cacheable</code>å°†æŸ¥è¯¢ç»“æœç¼“å­˜åˆ°redisä¸­ï¼Œï¼ˆkey=â€#p0â€ï¼‰æŒ‡å®šä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºredisçš„keyã€‚</p><p><code>@CachePut</code>ï¼ŒæŒ‡å®škeyï¼Œå°†æ›´æ–°çš„ç»“æœåŒæ­¥åˆ°redisä¸­</p><p><code>@CacheEvict</code>ï¼ŒæŒ‡å®škeyï¼Œåˆ é™¤ç¼“å­˜æ•°æ®ï¼ŒallEntries=true,æ–¹æ³•è°ƒç”¨åå°†ç«‹å³æ¸…é™¤ç¼“å­˜</p><h4 id="ä½¿ç”¨Jedisè¿æ¥"><a href="#ä½¿ç”¨Jedisè¿æ¥" class="headerlink" title="ä½¿ç”¨Jedisè¿æ¥"></a>ä½¿ç”¨Jedisè¿æ¥</h4><p>è¦æ³¨æ„ï¼Œredisåœ¨5.0ç‰ˆæœ¬ä»¥åä¸æ”¯æŒJedis</p><h5 id="POM-15"><a href="#POM-15" class="headerlink" title="POM"></a>POM</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="é…ç½®ç±»-2"><a href="#é…ç½®ç±»-2" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"redis"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> timeout;<span class="comment">//ç§’</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> poolMaxTotal;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> poolMaxIdle;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> poolMaxWait;<span class="comment">//ç§’</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisPoolFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisConfig redisConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JedisPool <span class="title">edisPoolFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        JedisPoolConfig poolConfig = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        poolConfig.setMaxIdle(redisConfig.getPoolMaxIdle());</span><br><span class="line">        poolConfig.setMaxTotal(redisConfig.getPoolMaxTotal());</span><br><span class="line">        poolConfig.setMaxWaitMillis(redisConfig.getPoolMaxWait() * <span class="number">1000</span>);</span><br><span class="line">        JedisPool jp = <span class="keyword">new</span> JedisPool(poolConfig, redisConfig.getHost(), redisConfig.getPort(),</span><br><span class="line">                redisConfig.getTimeout()*<span class="number">1000</span>, redisConfig.getPassword(), <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> jp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç›‘æ§ä¸­å¿ƒ"><a href="#ç›‘æ§ä¸­å¿ƒ" class="headerlink" title="ç›‘æ§ä¸­å¿ƒ"></a>ç›‘æ§ä¸­å¿ƒ</h2><p>Springbootç›‘æ§ä¸­å¿ƒæ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿä»–æ˜¯é’ˆå¯¹å¾®æœåŠ¡çš„ æœåŠ¡çŠ¶æ€ã€Httpè¯·æ±‚èµ„æºè¿›è¡Œç›‘æ§ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨å†…å­˜å˜åŒ–ï¼ˆå †å†…å­˜ã€çº¿ç¨‹ã€æ—¥å¿—ç®¡ç†ï¼‰ï¼Œå¯ä»¥æ£€æµ‹æœåŠ¡é…ç½®è¿æ¥åœ°å€æ˜¯å¦å¯ç”¨ï¼ˆæ¨¡æ‹Ÿè®¿é—®ï¼Œæ‡’åŠ è½½ï¼‰ï¼Œå¯ä»¥ç»Ÿè®¡æœ‰å¤šå°‘Beanæœ‰ä»€ä¹ˆå•ä¾‹å¤šä¾‹ï¼Œå¯ä»¥ç»Ÿè®¡SpringMVCæœ‰å¤šå°‘@RequestMapping</p><h3 id="Actuator"><a href="#Actuator" class="headerlink" title="Actuator"></a>Actuator</h3><p>Actuatoræ˜¯spring bootçš„ä¸€ä¸ªé™„åŠ åŠŸèƒ½,å¯å¸®åŠ©ä½ åœ¨åº”ç”¨ç¨‹åºç”Ÿäº§ç¯å¢ƒæ—¶ç›‘è§†å’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚</p><p>å¯ä»¥ä½¿ç”¨HTTPçš„å„ç§è¯·æ±‚æ¥ç›‘ç®¡,å®¡è®¡,æ”¶é›†åº”ç”¨çš„è¿è¡Œæƒ…å†µ.è¿”å›çš„æ˜¯json</p><p>ç¼ºç‚¹ï¼šæ²¡æœ‰å¯è§†åŒ–ç•Œé¢ã€‚</p><p>åœ¨springboot2.0ä¸­ï¼ŒActuatorçš„ç«¯ç‚¹ï¼ˆendpointï¼‰ç°åœ¨é»˜è®¤æ˜ å°„åˆ°/applicationï¼Œæ¯”å¦‚ï¼Œ/info ç«¯ç‚¹ç°åœ¨å°±æ˜¯åœ¨/application/infoã€‚ä½†ä½ å¯ä»¥ä½¿ç”¨management.context-pathæ¥è¦†ç›–æ­¤é»˜è®¤å€¼ã€‚</p><h4 id="POM-16"><a href="#POM-16" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®ä¿¡æ¯"><a href="#é…ç½®ä¿¡æ¯" class="headerlink" title="é…ç½®ä¿¡æ¯"></a>é…ç½®ä¿¡æ¯</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Actuator é€šè¿‡ä¸‹é¢çš„é…ç½®å¯ç”¨æ‰€æœ‰çš„ç›‘æ§ç«¯ç‚¹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›ç«¯ç‚¹æ˜¯ç¦ç”¨çš„ï¼›</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line"><span class="attr">  endpoints:</span></span><br><span class="line"><span class="attr">    web:</span></span><br><span class="line"><span class="attr">      exposure:</span></span><br><span class="line"><span class="attr">        include:</span> <span class="string">"*"</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">prod</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://127.0.0.1:3306/test</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><h4 id="Actuatorè®¿é—®è·¯å¾„"><a href="#Actuatorè®¿é—®è·¯å¾„" class="headerlink" title="Actuatorè®¿é—®è·¯å¾„"></a>Actuatorè®¿é—®è·¯å¾„</h4><p>é€šè¿‡actuator/+ç«¯ç‚¹åå°±å¯ä»¥è·å–ç›¸åº”çš„ä¿¡æ¯ã€‚</p><table><thead><tr><th>è·¯å¾„</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>/actuator/beans</td><td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸­æ‰€æœ‰Spring beançš„å®Œæ•´åˆ—è¡¨ã€‚</td></tr><tr><td>/actuator/configprops</td><td>æ˜¾ç¤ºæ‰€æœ‰é…ç½®ä¿¡æ¯ã€‚</td></tr><tr><td>/actuator/env</td><td>é™ˆåˆ—æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ã€‚</td></tr><tr><td>/actuator/mappings</td><td>æ˜¾ç¤ºæ‰€æœ‰@RequestMappingçš„urlæ•´ç†åˆ—è¡¨ã€‚</td></tr><tr><td>/actuator/health</td><td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶å†µä¿¡æ¯ upè¡¨ç¤ºæˆåŠŸ downå¤±è´¥</td></tr><tr><td>/actuator/info</td><td>æŸ¥çœ‹è‡ªå®šä¹‰åº”ç”¨ä¿¡æ¯</td></tr></tbody></table><h3 id="Admin-UIåˆ†å¸ƒå¼å¾®æœåŠ¡ç›‘æ§ä¸­å¿ƒ"><a href="#Admin-UIåˆ†å¸ƒå¼å¾®æœåŠ¡ç›‘æ§ä¸­å¿ƒ" class="headerlink" title="Admin-UIåˆ†å¸ƒå¼å¾®æœåŠ¡ç›‘æ§ä¸­å¿ƒ"></a>Admin-UIåˆ†å¸ƒå¼å¾®æœåŠ¡ç›‘æ§ä¸­å¿ƒ</h3><p>Admin-UIåº•å±‚ä½¿ç”¨actuatorï¼Œå®ç°ç›‘æ§ä¿¡æ¯ çš„ç•Œé¢</p><h4 id="POM-17"><a href="#POM-17" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æœåŠ¡ç«¯--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å®¢æˆ·ç«¯--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jolokia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jolokia-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.googlecode.json-simple<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json-simple<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-ymlé…ç½®æ–‡ä»¶"><a href="#application-ymlé…ç½®æ–‡ä»¶" class="headerlink" title="application.ymlé…ç½®æ–‡ä»¶"></a>application.ymlé…ç½®æ–‡ä»¶</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœåŠ¡ç«¯</span></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: spring-boot-admin-server</span><br><span class="line"><span class="comment">//å®¢æˆ·ç«¯</span></span><br><span class="line">spring:</span><br><span class="line">  boot:</span><br><span class="line">    admin:</span><br><span class="line">      client:</span><br><span class="line">        url: http:<span class="comment">//localhost:8080</span></span><br><span class="line">server:</span><br><span class="line">  port: <span class="number">8081</span></span><br><span class="line">  </span><br><span class="line">management:</span><br><span class="line">  endpoints:</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">        include: <span class="string">"*"</span></span><br><span class="line">  endpoint:</span><br><span class="line">    health:</span><br><span class="line">      show-details: ALWAYS</span><br></pre></td></tr></table></figure><h2 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h2><h3 id="æ‰«åŒ…ä¼˜åŒ–"><a href="#æ‰«åŒ…ä¼˜åŒ–" class="headerlink" title="æ‰«åŒ…ä¼˜åŒ–"></a>æ‰«åŒ…ä¼˜åŒ–</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ <code>@SpringBootApplication</code> æ³¨è§£æ¥è‡ªåŠ¨è·å–åº”ç”¨çš„é…ç½®ä¿¡æ¯ï¼Œä½†è¿™æ ·ä¹Ÿä¼šç»™åº”ç”¨å¸¦æ¥ä¸€äº›å‰¯ä½œç”¨ã€‚ä½¿ç”¨è¿™ä¸ªæ³¨è§£åï¼Œä¼šè§¦å‘è‡ªåŠ¨é…ç½®ï¼ˆ auto-configuration ï¼‰å’Œ ç»„ä»¶æ‰«æ ï¼ˆ component scanning ï¼‰ï¼Œè¿™è·Ÿä½¿ç”¨ <code>@Configuration</code>ã€<code>@EnableAutoConfiguration</code> å’Œ <code>@ComponentScan</code> ä¸‰ä¸ªæ³¨è§£çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚è¿™æ ·åšç»™å¼€å‘å¸¦æ¥æ–¹ä¾¿çš„åŒæ—¶ï¼Œä¹Ÿä¼šæœ‰ä¸‰æ–¹é¢çš„å½±å“ï¼š</p><p>1ã€ä¼šå¯¼è‡´é¡¹ç›®å¯åŠ¨æ—¶é—´å˜é•¿ã€‚å½“å¯åŠ¨ä¸€ä¸ªå¤§çš„åº”ç”¨ç¨‹åº,æˆ–å°†åšå¤§é‡çš„é›†æˆæµ‹è¯•å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œå½±å“ä¼šç‰¹åˆ«æ˜æ˜¾ã€‚</p><p>2ã€ä¼šåŠ è½½ä¸€äº›ä¸éœ€è¦çš„å¤šä½™çš„å®ä¾‹ï¼ˆbeansï¼‰ã€‚</p><p>3ã€ä¼šå¢åŠ  CPU æ¶ˆè€—ã€‚</p><p>é’ˆå¯¹ä»¥ä¸Šä¸‰ä¸ªæƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç§»é™¤ @SpringBootApplication å’Œ @ComponentScan ä¸¤ä¸ªæ³¨è§£æ¥ç¦ç”¨ç»„ä»¶è‡ªåŠ¨æ‰«æï¼Œç„¶ååœ¨æˆ‘ä»¬éœ€è¦çš„ bean ä¸Šè¿›è¡Œæ˜¾å¼é…ç½®ã€‚</p><h3 id="SpringBoot-JVMå‚æ•°è°ƒä¼˜"><a href="#SpringBoot-JVMå‚æ•°è°ƒä¼˜" class="headerlink" title="SpringBoot JVMå‚æ•°è°ƒä¼˜"></a>SpringBoot JVMå‚æ•°è°ƒä¼˜</h3><h5 id="å„ç§å‚æ•°"><a href="#å„ç§å‚æ•°" class="headerlink" title="å„ç§å‚æ•°"></a>å„ç§å‚æ•°</h5><table><thead><tr><th>å‚æ•°åç§°</th><th>å«ä¹‰</th><th>é»˜è®¤å€¼</th><th></th></tr></thead><tbody><tr><td>-Xms</td><td>åˆå§‹å †å¤§å°</td><td>ç‰©ç†å†…å­˜çš„1/64(&lt;1GB)</td><td>é»˜è®¤(MinHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å°äº40%æ—¶ï¼ŒJVMå°±ä¼šå¢å¤§å †ç›´åˆ°-Xmxçš„æœ€å¤§é™åˆ¶.</td></tr><tr><td>-Xmx</td><td>æœ€å¤§å †å¤§å°</td><td>ç‰©ç†å†…å­˜çš„1/4(&lt;1GB)</td><td>é»˜è®¤(MaxHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å¤§äº70%æ—¶ï¼ŒJVMä¼šå‡å°‘å †ç›´åˆ° -Xmsçš„æœ€å°é™åˆ¶</td></tr><tr><td>-Xmn</td><td>å¹´è½»ä»£å¤§å°(1.4or lator)</td><td></td><td>æ³¨æ„ï¼šæ­¤å¤„çš„å¤§å°æ˜¯ï¼ˆeden+ 2 survivor space).ä¸jmap -heapä¸­æ˜¾ç¤ºçš„New genæ˜¯ä¸åŒçš„ã€‚ æ•´ä¸ªå †å¤§å°=å¹´è½»ä»£å¤§å° + å¹´è€ä»£å¤§å° + æŒä¹…ä»£å¤§å°. å¢å¤§å¹´è½»ä»£å,å°†ä¼šå‡å°å¹´è€ä»£å¤§å°.æ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§,Sunå®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3/8</td></tr><tr><td>-XX:NewSize</td><td>è®¾ç½®å¹´è½»ä»£å¤§å°(for 1.3/1.4)</td><td></td><td></td></tr><tr><td>-XX:MaxNewSize</td><td>å¹´è½»ä»£æœ€å¤§å€¼(for 1.3/1.4)</td><td></td><td></td></tr><tr><td>-XX:PermSize</td><td>è®¾ç½®æŒä¹…ä»£(perm gen)åˆå§‹å€¼</td><td>ç‰©ç†å†…å­˜çš„1/64</td><td></td></tr><tr><td>-XX:MaxPermSize</td><td>è®¾ç½®æŒä¹…ä»£æœ€å¤§å€¼</td><td>ç‰©ç†å†…å­˜çš„1/4</td><td></td></tr><tr><td>-Xss</td><td>æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°</td><td></td><td>JDK5.0ä»¥åæ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º1M,ä»¥å‰æ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º256K.æ›´å…·åº”ç”¨çš„çº¿ç¨‹æ‰€éœ€å†…å­˜å¤§å°è¿›è¡Œ è°ƒæ•´.åœ¨ç›¸åŒç‰©ç†å†…å­˜ä¸‹,å‡å°è¿™ä¸ªå€¼èƒ½ç”Ÿæˆæ›´å¤šçš„çº¿ç¨‹.ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„,ä¸èƒ½æ— é™ç”Ÿæˆ,ç»éªŒå€¼åœ¨3000~5000å·¦å³ ä¸€èˆ¬å°çš„åº”ç”¨ï¼Œ å¦‚æœæ ˆä¸æ˜¯å¾ˆæ·±ï¼Œ åº”è¯¥æ˜¯128kå¤Ÿç”¨çš„ å¤§çš„åº”ç”¨å»ºè®®ä½¿ç”¨256kã€‚è¿™ä¸ªé€‰é¡¹å¯¹æ€§èƒ½å½±å“æ¯”è¾ƒå¤§ï¼Œéœ€è¦ä¸¥æ ¼çš„æµ‹è¯•ã€‚ï¼ˆæ ¡é•¿ï¼‰ å’Œthreadstacksizeé€‰é¡¹è§£é‡Šå¾ˆç±»ä¼¼,å®˜æ–¹æ–‡æ¡£ä¼¼ä¹æ²¡æœ‰è§£é‡Š,åœ¨è®ºå›ä¸­æœ‰è¿™æ ·ä¸€å¥è¯:â€â€ -Xss is translated in a VM flag named ThreadStackSizeâ€ ä¸€èˆ¬è®¾ç½®è¿™ä¸ªå€¼å°±å¯ä»¥äº†ã€‚</td></tr><tr><td>-XX:ThreadStackSize</td><td>Thread Stack Size</td><td></td><td>(0 means use default stack size) [Sparc: 512; Solaris x86: 320 (was 256 prior in 5.0 and earlier); Sparc 64 bit: 1024; Linux amd64: 1024 (was 0 in 5.0 and earlier); all others 0.]</td></tr><tr><td>-XX:NewRatio</td><td>å¹´è½»ä»£(åŒ…æ‹¬Edenå’Œä¸¤ä¸ªSurvivoråŒº)ä¸å¹´è€ä»£çš„æ¯”å€¼(é™¤å»æŒä¹…ä»£)</td><td></td><td>-XX:NewRatio=4è¡¨ç¤ºå¹´è½»ä»£ä¸å¹´è€ä»£æ‰€å æ¯”å€¼ä¸º1:4,å¹´è½»ä»£å æ•´ä¸ªå †æ ˆçš„1/5 Xms=Xmxå¹¶ä¸”è®¾ç½®äº†Xmnçš„æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°ä¸éœ€è¦è¿›è¡Œè®¾ç½®ã€‚</td></tr><tr><td>-XX:SurvivorRatio</td><td>EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼</td><td></td><td>è®¾ç½®ä¸º8,åˆ™ä¸¤ä¸ªSurvivoråŒºä¸ä¸€ä¸ªEdenåŒºçš„æ¯”å€¼ä¸º2:8,ä¸€ä¸ªSurvivoråŒºå æ•´ä¸ªå¹´è½»ä»£çš„1/10</td></tr><tr><td>-XX:LargePageSizeInBytes</td><td>å†…å­˜é¡µçš„å¤§å°ä¸å¯è®¾ç½®è¿‡å¤§ï¼Œ ä¼šå½±å“Permçš„å¤§å°</td><td></td><td>=128m</td></tr><tr><td>-XX:+UseFastAccessorMethods</td><td>åŸå§‹ç±»å‹çš„å¿«é€Ÿä¼˜åŒ–</td><td></td><td></td></tr><tr><td>-XX:+DisableExplicitGC</td><td>å…³é—­System.gc()</td><td></td><td>è¿™ä¸ªå‚æ•°éœ€è¦ä¸¥æ ¼çš„æµ‹è¯•</td></tr><tr><td>-XX:MaxTenuringThreshold</td><td>åƒåœ¾æœ€å¤§å¹´é¾„</td><td></td><td>å¦‚æœè®¾ç½®ä¸º0çš„è¯,åˆ™å¹´è½»ä»£å¯¹è±¡ä¸ç»è¿‡SurvivoråŒº,ç›´æ¥è¿›å…¥å¹´è€ä»£. å¯¹äºå¹´è€ä»£æ¯”è¾ƒå¤šçš„åº”ç”¨,å¯ä»¥æé«˜æ•ˆç‡.å¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§å€¼,åˆ™å¹´è½»ä»£å¯¹è±¡ä¼šåœ¨SurvivoråŒºè¿›è¡Œå¤šæ¬¡å¤åˆ¶,è¿™æ ·å¯ä»¥å¢åŠ å¯¹è±¡å†å¹´è½»ä»£çš„å­˜æ´» æ—¶é—´,å¢åŠ åœ¨å¹´è½»ä»£å³è¢«å›æ”¶çš„æ¦‚ç‡ è¯¥å‚æ•°åªæœ‰åœ¨ä¸²è¡ŒGCæ—¶æ‰æœ‰æ•ˆ.</td></tr><tr><td>-XX:+AggressiveOpts</td><td>åŠ å¿«ç¼–è¯‘</td><td></td><td></td></tr><tr><td>-XX:+UseBiasedLocking</td><td>é”æœºåˆ¶çš„æ€§èƒ½æ”¹å–„</td><td></td><td></td></tr><tr><td>-Xnoclassgc</td><td>ç¦ç”¨åƒåœ¾å›æ”¶</td><td></td><td></td></tr><tr><td>-XX:SoftRefLRUPolicyMSPerMB</td><td>æ¯å…†å †ç©ºé—²ç©ºé—´ä¸­SoftReferenceçš„å­˜æ´»æ—¶é—´</td><td>1s</td><td>softly reachable objects will remain alive for some amount of time after the last time they were referenced. The default value is one second of lifetime per free megabyte in the heap</td></tr><tr><td>-XX:PretenureSizeThreshold</td><td>å¯¹è±¡è¶…è¿‡å¤šå¤§æ˜¯ç›´æ¥åœ¨æ—§ç”Ÿä»£åˆ†é…</td><td>0</td><td>å•ä½å­—èŠ‚ æ–°ç”Ÿä»£é‡‡ç”¨Parallel Scavenge GCæ—¶æ— æ•ˆ å¦ä¸€ç§ç›´æ¥åœ¨æ—§ç”Ÿä»£åˆ†é…çš„æƒ…å†µæ˜¯å¤§çš„æ•°ç»„å¯¹è±¡,ä¸”æ•°ç»„ä¸­æ— å¤–éƒ¨å¼•ç”¨å¯¹è±¡.</td></tr><tr><td>-XX:TLABWasteTargetPercent</td><td>TLABå edenåŒºçš„ç™¾åˆ†æ¯”</td><td>1%</td><td></td></tr><tr><td>-XX:+CollectGen0First</td><td>FullGCæ—¶æ˜¯å¦å…ˆYGC</td><td>false</td></tr></tbody></table><h5 id="è°ƒä¼˜ç­–ç•¥"><a href="#è°ƒä¼˜ç­–ç•¥" class="headerlink" title="è°ƒä¼˜ç­–ç•¥"></a>è°ƒä¼˜ç­–ç•¥</h5><ol><li>åˆå§‹åŒ–å †å†…å­˜å’Œæœ€å¤§å †ç›¸åŒ</li><li>å‡å°‘åƒåœ¾å›æ”¶æ¬¡æ•°</li></ol><h5 id="å†…éƒ¨è°ƒä¼˜"><a href="#å†…éƒ¨è°ƒä¼˜" class="headerlink" title="å†…éƒ¨è°ƒä¼˜"></a>å†…éƒ¨è°ƒä¼˜</h5><p><img src="/2018/08/04/springboot/4.png" alt="1533633207629"></p><p>è¾“å…¥ -XX:+PrintGCDetails æ˜¯ä¸ºäº†åœ¨æ§åˆ¶å°æ˜¾ç¤ºå›æ”¶çš„ä¿¡æ¯</p><p><img src="/2018/08/04/springboot/5.png" alt="1533633302622"></p><h5 id="å¤–éƒ¨è°ƒä¼˜"><a href="#å¤–éƒ¨è°ƒä¼˜" class="headerlink" title="å¤–éƒ¨è°ƒä¼˜"></a>å¤–éƒ¨è°ƒä¼˜</h5><p>è¿›å…¥å¯¹åº”jarçš„ç›®å½•ï¼Œåœ¨CMDè¾“å…¥<code>java -server -Xms32m -Xmx32m  -jar springboot.jar</code> </p><h5 id="ä½¿ç”¨å·¥å…·java-visual-vm"><a href="#ä½¿ç”¨å·¥å…·java-visual-vm" class="headerlink" title="ä½¿ç”¨å·¥å…·java visual vm"></a>ä½¿ç”¨å·¥å…·java visual vm</h5><p><img src="/2018/08/04/springboot/6.jpg" alt="1533633302622"></p><h5 id="ä½¿ç”¨å·¥å…·java-console"><a href="#ä½¿ç”¨å·¥å…·java-console" class="headerlink" title="ä½¿ç”¨å·¥å…·java console"></a>ä½¿ç”¨å·¥å…·java console</h5><p><img src="/2018/08/04/springboot/7.png" alt="1533633885354"></p><h3 id="å°†Servletå®¹å™¨ä»Tomcatå˜æˆUndertow"><a href="#å°†Servletå®¹å™¨ä»Tomcatå˜æˆUndertow" class="headerlink" title="å°†Servletå®¹å™¨ä»Tomcatå˜æˆUndertow"></a>å°†Servletå®¹å™¨ä»Tomcatå˜æˆUndertow</h3><p>Undertow æ˜¯ä¸€ä¸ªé‡‡ç”¨ Java å¼€å‘çš„çµæ´»çš„é«˜æ€§èƒ½ Web æœåŠ¡å™¨ï¼Œæä¾›åŒ…æ‹¬é˜»å¡å’ŒåŸºäº NIO çš„éå µå¡æœºåˆ¶ã€‚Undertow æ˜¯çº¢å¸½å…¬å¸çš„å¼€æºäº§å“ï¼Œæ˜¯ JBossé»˜è®¤çš„ Web æœåŠ¡å™¨ã€‚ğŸ‘‡</p><p><a href="http://undertow.io/" target="_blank" rel="noopener">Undertow</a></p><h4 id="POM-18"><a href="#POM-18" class="headerlink" title="POM"></a>POM</h4><p>é¦–å…ˆï¼Œä»ä¾èµ–ä¿¡æ¯é‡Œç§»é™¤ Tomcat é…ç½® </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ·»åŠ  Undertowï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Tomcat-ä¼˜åŒ–"><a href="#Tomcat-ä¼˜åŒ–" class="headerlink" title="Tomcat ä¼˜åŒ–"></a>Tomcat ä¼˜åŒ–</h3><p>è§ğŸ‘‰<a href="https://spring.io/blog/2015/12/10/spring-boot-memory-performance" target="_blank" rel="noopener">Spring Boot Memory Performance</a></p><h2 id="çƒ­éƒ¨ç½²"><a href="#çƒ­éƒ¨ç½²" class="headerlink" title="çƒ­éƒ¨ç½²"></a>çƒ­éƒ¨ç½²</h2><p>çƒ­éƒ¨ç½²ï¼Œå°±æ˜¯åœ¨åº”ç”¨ç¨‹åºåœ¨ä¸åœæ­¢çš„æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨å®ç°æ–°çš„éƒ¨ç½²</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>ä½¿ç”¨ç±»åŠ è½½å™¨classroadæ¥æ£€æµ‹å­—èŠ‚ç æ–‡ä»¶ï¼Œç„¶åé‡æ–°åŠ è½½åˆ°jvmå†…å­˜ä¸­</p><p>ç¬¬ä¸€æ­¥ï¼šæ£€æµ‹æœ¬åœ°<code>.class</code>æ–‡ä»¶å˜åŠ¨ï¼ˆç‰ˆæœ¬å·ï¼Œä¿®æ”¹æ—¶é—´ä¸ä¸€æ ·ï¼‰</p><p>ç¬¬äºŒæ­¥ï¼šè‡ªåŠ¨ç›‘å¬ï¼Œå®ç°éƒ¨ç½²</p><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>æœ¬åœ°å¼€å‘æ—¶ï¼Œå¯ä»¥æé«˜è¿è¡Œç¯å¢ƒ</p><h3 id="Dev-tools"><a href="#Dev-tools" class="headerlink" title="Dev-tools"></a>Dev-tools</h3><p>spring-boot-devtools æ˜¯ä¸€ä¸ªä¸ºå¼€å‘è€…æœåŠ¡çš„ä¸€ä¸ªæ¨¡å—ï¼Œå…¶ä¸­æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯è‡ªåŠ¨åº”ç”¨ä»£ç æ›´æ”¹åˆ°æœ€æ–°çš„Appä¸Šé¢å»</p><h4 id="POM-19"><a href="#POM-19" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>true<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h4><ol><li>devtoolsä¼šç›‘å¬classpathä¸‹çš„æ–‡ä»¶å˜åŠ¨ï¼Œå¹¶ä¸”ä¼šç«‹å³é‡å¯åº”ç”¨ï¼ˆå‘ç”Ÿåœ¨ä¿å­˜æ—¶æœºï¼‰ï¼Œå› ä¸ºå…¶é‡‡ç”¨çš„è™šæ‹Ÿæœºæœºåˆ¶ï¼Œè¯¥é¡¹é‡å¯æ˜¯å¾ˆå¿«çš„ã€‚  </li><li>devtoolså¯ä»¥å®ç°é¡µé¢çƒ­éƒ¨ç½²ï¼ˆå³é¡µé¢ä¿®æ”¹åä¼šç«‹å³ç”Ÿæ•ˆï¼Œè¿™ä¸ªå¯ä»¥ç›´æ¥åœ¨application.propertiesæ–‡ä»¶ä¸­é…ç½®spring.thymeleaf.cache=falseæ¥å®ç°(æ³¨æ„ï¼šä¸åŒçš„æ¨¡æ¿é…ç½®ä¸ä¸€æ ·)  </li></ol><h2 id="å‘å¸ƒæ‰“åŒ…"><a href="#å‘å¸ƒæ‰“åŒ…" class="headerlink" title="å‘å¸ƒæ‰“åŒ…"></a>å‘å¸ƒæ‰“åŒ…</h2><h3 id="Jarç±»å‹æ‰“åŒ…æ–¹å¼"><a href="#Jarç±»å‹æ‰“åŒ…æ–¹å¼" class="headerlink" title="Jarç±»å‹æ‰“åŒ…æ–¹å¼"></a>Jarç±»å‹æ‰“åŒ…æ–¹å¼</h3><p>1.ä½¿ç”¨mvn clean  package æ‰“åŒ…</p><p>2.ä½¿ç”¨java â€“jar åŒ…å</p><h3 id="warç±»å‹æ‰“åŒ…æ–¹å¼"><a href="#warç±»å‹æ‰“åŒ…æ–¹å¼" class="headerlink" title="warç±»å‹æ‰“åŒ…æ–¹å¼"></a>warç±»å‹æ‰“åŒ…æ–¹å¼</h3><p>1.ä½¿ç”¨mvn celan package æ‰“åŒ…</p><p>2.ä½¿ç”¨java â€“jar åŒ…å </p><h3 id="å¤–éƒ¨Tomcatè¿è¡Œ"><a href="#å¤–éƒ¨Tomcatè¿è¡Œ" class="headerlink" title="å¤–éƒ¨Tomcatè¿è¡Œ"></a>å¤–éƒ¨Tomcatè¿è¡Œ</h3><p>1.ä½¿ç”¨mvn celan package æ‰“åŒ…</p><p>2.å°†waråŒ… æ”¾å…¥åˆ°tomcat webappsä¸‹è¿è¡Œå³å¯ã€‚</p><p>æ³¨æ„:springboot2.0å†…ç½®tomcat8.5.25ï¼Œå»ºè®®ä½¿ç”¨å¤–éƒ¨Tomcat9.0ç‰ˆæœ¬è¿è¡Œå³å¯,å¦åˆ™æŠ¥é”™ç‰ˆæœ¬ä¸å…¼å®¹ã€‚</p><h3 id="POM-20"><a href="#POM-20" class="headerlink" title="POM"></a>POM</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maimClass</span>&gt;</span>com.itmayiedu.app.App<span class="tag">&lt;/<span class="name">maimClass</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a href="http://blog.didispace.com/springbootdata1/" target="_blank" rel="noopener">JdbcTemplate</a></p><p><a href="https://blog.csdn.net/qq_28988969/article/details/78082116" target="_blank" rel="noopener">SpringBootåˆ†é¡µæ’ä»¶PageHelper</a></p><p><a href="https://www.cnblogs.com/arli/p/6914057.html" target="_blank" rel="noopener">jpa</a></p><p><a href="http://www.spring4all.com/article/558" target="_blank" rel="noopener">Spring For All ç¤¾åŒº Spring å®˜æ–¹æ•™ç¨‹ç¿»è¯‘</a></p><p><a href="https://www.cnblogs.com/gdpuzxs/p/7222309.html" target="_blank" rel="noopener">SpringBootä½¿ç”¨Redisç¼“å­˜</a></p><p><a href="https://blog.csdn.net/u010889990/article/details/78883764" target="_blank" rel="noopener">Spring Boot Adminç®€å•ä½¿ç”¨</a></p><p><a href="https://blog.csdn.net/github_32521685/article/details/50463895" target="_blank" rel="noopener">Spring Boot æ€§èƒ½ä¼˜åŒ–</a></p><p><a href="https://blog.csdn.net/u013970971/article/details/79468356" target="_blank" rel="noopener">WebFlux</a></p><p>æ„Ÿè°¢ä»¥ä¸Šå¤§å¤§ä»¬~ï¼</p><p>å¹¿å‘Šæ—¶é—´ï¼šæƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://tengshe789.github.io/">æˆ‘çš„åšå®¢</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘å†ç ”ç©¶springbootçš„åŸç†ğŸ˜‹é¢‡æœ‰æ”¶è·ï¼Œç°åœ¨è®©æˆ‘åˆ†äº«ä¸€ä¸‹springbootå¦‚ä½•ä½¿ç”¨å§~&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.tech/&quot; target=&quot;_blank&quot; rel=&quot;noopen
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="Spring" scheme="https://tengshe789.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>å®‰åˆ©è½¯ä»¶-å¦‚ä½•ä¸€é”®è£…B</title>
    <link href="https://tengshe789.github.io/2018/08/02/%E5%A6%82%E4%BD%95%E4%B8%80%E9%94%AE%E8%A3%85B/"/>
    <id>https://tengshe789.github.io/2018/08/02/å¦‚ä½•ä¸€é”®è£…B/</id>
    <published>2018-08-02T05:14:30.000Z</published>
    <updated>2019-11-20T13:39:41.255Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ•™å¤§å®¶å¦‚æœé«˜å¤§ä¸Šçš„è£…Bï¼</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h3 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h3><p><a href="https://github.com/WWILLV/GodOfHacker" target="_blank" rel="noopener">https://github.com/WWILLV/GodOfHacker</a></p><p>å…‹éš†è½¯ä»¶</p><h3 id="ç¬¬äºŒéƒ¨"><a href="#ç¬¬äºŒéƒ¨" class="headerlink" title="ç¬¬äºŒéƒ¨"></a>ç¬¬äºŒéƒ¨</h3><p>ä½¿ç”¨</p><p><img src="/2018/08/02/å¦‚ä½•ä¸€é”®è£…B/1533187094163.png" alt="1533187094163"></p><p><img src="/2018/08/02/å¦‚ä½•ä¸€é”®è£…B/1533187121497.png" alt="1533187121497"></p><p><img src="/2018/08/02/å¦‚ä½•ä¸€é”®è£…B/1533187138329.png" alt="1533187138329"></p><p>ä¸è°¢å“¦ğŸ˜</p><p>ç»“æŸ æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> .</p><p>æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼ŒjuejinåŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œç¼˜åˆ†å‘¢å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹~ </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©æ•™å¤§å®¶å¦‚æœé«˜å¤§ä¸Šçš„è£…Bï¼&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.tech/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æˆ‘çš„åšå®¢&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;ç¬¬ä¸€æ­¥&quot;&gt;&lt;a hr
      
    
    </summary>
    
    
      <category term="æ—¥å¸¸" scheme="https://tengshe789.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
      <category term="Windows10" scheme="https://tengshe789.github.io/tags/Windows10/"/>
    
      <category term="è½¯ä»¶æ•™å­¦" scheme="https://tengshe789.github.io/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡å¤±è´¥çš„rediså®‰è£…</title>
    <link href="https://tengshe789.github.io/2018/08/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%A4%B1%E8%B4%A5%E7%9A%84redis%E5%AE%89%E8%A3%85/"/>
    <id>https://tengshe789.github.io/2018/08/02/è®°ä¸€æ¬¡å¤±è´¥çš„rediså®‰è£…/</id>
    <published>2018-08-02T03:16:35.000Z</published>
    <updated>2019-11-20T13:39:41.559Z</updated>
    
    <content type="html"><![CDATA[<p>åˆšåˆšçœ‹è§ç¾¤å‹è¯´VPSåˆæå¹´ä¸­ç‰¹ä»·äº†ï¼Œçœ‹æ¥çœ‹å»ï¼Œé€‰äº†ä¸ªå¹´ä»˜$9.99çš„CN2çº¿è·¯çš„KVM VPSï¼Œå¿ƒé‡Œç¾æ»‹æ»‹ã€‚ç„¶è€Œè¿™å®¶çš„æœ€å°åŒ–centOSå±…ç„¶å¾ˆå¤šåŸºç¡€è¿è¡Œç¯å¢ƒéƒ½ä¸è£…ï¼Œç”šæ˜¯å¤´ç–¼ã€‚æ¥ä¸‹æ¥æˆ‘æ¥åˆ†äº«ä¸€ä¸‹æˆ‘è£…æœºçš„è¿‡ç¨‹</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h3 id="å®‰è£…ç¼–è¯‘ç¯å¢ƒ"><a href="#å®‰è£…ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="å®‰è£…ç¼–è¯‘ç¯å¢ƒ"></a>å®‰è£…ç¼–è¯‘ç¯å¢ƒ</h3><p>é¦–å…ˆï¼Œç”¨sftpï¼ˆå¦ˆè›‹ç«Ÿç„¶æ²¡æœ‰å†…ç½®wgetï¼‰ä¸‹è½½å¥½redisï¼Œè¿›å…¥redisç›®å½•</p><p>è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget</span><br><span class="line">yum -y install make</span><br><span class="line">yum install gcc</span><br></pre></td></tr></table></figure><p>è£…å¥½makeç­‰ç¯å¢ƒï¼Œmake ä¸€ä¸‹ï¼ŒæŠ¥é”™äº†ï¼š</p><p><img src="/2018/08/02/è®°ä¸€æ¬¡å¤±è´¥çš„rediså®‰è£…/1533180420775.png" alt="1533180420775"></p><p>å›¾æ˜¯æˆ‘ä»csdnæˆªçš„ï¼Œæˆ‘å’Œä»–çš„é”™è¯¯ä¸€æ¨¡ä¸€æ ·ã€‚æŸ¥äº†æŸ¥åŸå› ï¼Œæ˜¯å› ä¸ºï¼Œredameä¸­æœ‰è¿™æ ·ä¸€å¥è¯ï¼š</p><blockquote><p>Allocator   â€”â€”â€”     Selecting a non-default memory allocator when building Redis is done by setting   the <code>MALLOC</code> environment variable. Redis is compiled and linked against libc   malloc by default, with the exception of jemalloc being the default on Linux   systems. This default was picked because jemalloc has proven to have fewer   fragmentation problems than libc malloc.     To force compiling against libc malloc, use:         % make MALLOC=libc     To compile against jemalloc on Mac OS X systems, use:         % make MALLOC=jemalloc </p></blockquote><p>å®ƒè¯´ï¼Œåœ¨æ„å»ºRedisæ—¶é€‰æ‹©éé»˜è®¤å†…å­˜åˆ†é…å™¨æ˜¯é€šè¿‡è®¾ç½®å®Œæˆçš„ <code>MALLOC</code>ç¯å¢ƒå˜é‡ã€‚ Redisæ˜¯é’ˆå¯¹libcç¼–è¯‘å’Œé“¾æ¥çš„ é»˜è®¤æƒ…å†µä¸‹ä¸ºmallocï¼Œä½†jemallocæ˜¯Linuxä¸Šçš„é»˜è®¤è®¾ç½®ç³»ç»Ÿã€‚ </p><p>æ‰€ä»¥ï¼Œè¦æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make MALLOC=libc</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ<code>make &amp;&amp; make install</code>  å®‰è£…redis</p><p><img src="/2018/08/02/è®°ä¸€æ¬¡å¤±è´¥çš„rediså®‰è£…/1533180709607.png" alt="1533180709607"></p><p>å¤§åŠŸå‘Šæˆï¼</p><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>æ¥ä¸‹æ¥æ”¹<strong>redisé…ç½®æ–‡ä»¶</strong></p><p><img src="/2018/08/02/è®°ä¸€æ¬¡å¤±è´¥çš„rediså®‰è£…/1533181103111.png" alt="1533181103111"></p><p>ç»‘å®š0.0.0.0ï¼ŒåŠå…è®¸ä»»æ„æœåŠ¡å™¨è®¿é—®redis</p><p><img src="/2018/08/02/è®°ä¸€æ¬¡å¤±è´¥çš„rediså®‰è£…/1533181255094.png" alt="1533181255094"></p><p>å°†daemonizeæ”¹æˆyesï¼ŒåŠå…è®¸åå°æ‰§è¡Œ</p><p><img src="/2018/08/02/è®°ä¸€æ¬¡å¤±è´¥çš„rediså®‰è£…/1533181462841.png" alt="1533181462841"></p><p>è®¿é—®å¯†ç requirepassè®¾ç½®æˆè‡ªå·±çš„</p><h3 id="å¯åŠ¨redis"><a href="#å¯åŠ¨redis" class="headerlink" title="å¯åŠ¨redis"></a>å¯åŠ¨redis</h3><p>ç”¨åˆšåˆšçš„é…ç½®æ–‡ä»¶å¯åŠ¨redisï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server ./redis.conf</span><br><span class="line">ps -ef |grep redis</span><br></pre></td></tr></table></figure><p><img src="/2018/08/02/è®°ä¸€æ¬¡å¤±è´¥çš„rediså®‰è£…/1533181897184.png" alt="1533181897184"></p><p>ç„¶åè¿›å…¥utilsç›®å½•ä¸‹ï¼Œè¿è¡Œç”Ÿæˆç³»ç»ŸæœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./install_server.sh</span><br></pre></td></tr></table></figure><p><img src="/2018/08/02/è®°ä¸€æ¬¡å¤±è´¥çš„rediså®‰è£…/1533182026640.png" alt="1533182026640"></p><p><img src="/2018/08/02/è®°ä¸€æ¬¡å¤±è´¥çš„rediså®‰è£…/1533182420542.png" alt="1533182420542"></p><h3 id="Redisé…ç½®æ–‡ä»¶æ ·ä¾‹"><a href="#Redisé…ç½®æ–‡ä»¶æ ·ä¾‹" class="headerlink" title="Redisé…ç½®æ–‡ä»¶æ ·ä¾‹"></a>Redisé…ç½®æ–‡ä»¶æ ·ä¾‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br></pre></td><td class="code"><pre><span class="line"># Redisé…ç½®æ–‡ä»¶æ ·ä¾‹</span><br><span class="line"></span><br><span class="line"># Note on units: when memory size is needed, it is possible to specifiy</span><br><span class="line"># it in the usual form of 1k 5GB 4M and so forth:</span><br><span class="line">#</span><br><span class="line"># 1k =&gt; 1000 bytes</span><br><span class="line"># 1kb =&gt; 1024 bytes</span><br><span class="line"># 1m =&gt; 1000000 bytes</span><br><span class="line"># 1mb =&gt; 1024*1024 bytes</span><br><span class="line"># 1g =&gt; 1000000000 bytes</span><br><span class="line"># 1gb =&gt; 1024*1024*1024 bytes</span><br><span class="line">#</span><br><span class="line"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span><br><span class="line"></span><br><span class="line"># Redisé»˜è®¤ä¸æ˜¯ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œå¯ä»¥é€šè¿‡è¯¥é…ç½®é¡¹ä¿®æ”¹ï¼Œä½¿ç”¨yeså¯ç”¨å®ˆæŠ¤è¿›ç¨‹</span><br><span class="line"># å¯ç”¨å®ˆæŠ¤è¿›ç¨‹åï¼ŒRedisä¼šæŠŠpidå†™åˆ°ä¸€ä¸ªpidfileä¸­ï¼Œåœ¨/var/run/redis.pid</span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line"># å½“Redisä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼ŒRedisé»˜è®¤ä¼šæŠŠpidå†™å…¥/var/run/redis.pidæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡pidfileæŒ‡å®š</span><br><span class="line">pidfile /var/run/redis.pid</span><br><span class="line"></span><br><span class="line"># æŒ‡å®šRedisç›‘å¬ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º6379</span><br><span class="line"># å¦‚æœæŒ‡å®š0ç«¯å£ï¼Œè¡¨ç¤ºRedisä¸ç›‘å¬TCPè¿æ¥</span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"># ç»‘å®šçš„ä¸»æœºåœ°å€</span><br><span class="line"># ä½ å¯ä»¥ç»‘å®šå•ä¸€æ¥å£ï¼Œå¦‚æœæ²¡æœ‰ç»‘å®šï¼Œæ‰€æœ‰æ¥å£éƒ½ä¼šç›‘å¬åˆ°æ¥çš„è¿æ¥</span><br><span class="line"># bind 127.0.0.1</span><br><span class="line"></span><br><span class="line"># Specify the path for the unix socket that will be used to listen for</span><br><span class="line"># incoming connections. There is no default, so Redis will not listen</span><br><span class="line"># on a unix socket when not specified.</span><br><span class="line">#</span><br><span class="line"># unixsocket /tmp/redis.sock</span><br><span class="line"># unixsocketperm 755</span><br><span class="line"></span><br><span class="line"># å½“å®¢æˆ·ç«¯é—²ç½®å¤šé•¿æ—¶é—´åå…³é—­è¿æ¥ï¼Œå¦‚æœæŒ‡å®šä¸º0ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½</span><br><span class="line">timeout 0</span><br><span class="line"></span><br><span class="line"># æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedisæ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸ºverbose</span><br><span class="line"># debug (å¾ˆå¤šä¿¡æ¯, å¯¹å¼€å‘ï¼æµ‹è¯•æ¯”è¾ƒæœ‰ç”¨)</span><br><span class="line"># verbose (many rarely useful info, but not a mess like the debug level)</span><br><span class="line"># notice (moderately verbose, what you want in production probably)</span><br><span class="line"># warning (only very important / critical messages are logged)</span><br><span class="line">loglevel verbose</span><br><span class="line"></span><br><span class="line"># æ—¥å¿—è®°å½•æ–¹å¼ï¼Œé»˜è®¤ä¸ºæ ‡å‡†è¾“å‡ºï¼Œå¦‚æœé…ç½®ä¸ºredisä¸ºå®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œï¼Œè€Œè¿™é‡Œåˆé…ç½®ä¸ºæ ‡å‡†è¾“å‡ºï¼Œåˆ™æ—¥å¿—å°†ä¼šå‘é€ç»™/dev/null</span><br><span class="line">logfile stdout</span><br><span class="line"></span><br><span class="line"># To enable logging to the system logger, just set &apos;syslog-enabled&apos; to yes,</span><br><span class="line"># and optionally update the other syslog parameters to suit your needs.</span><br><span class="line"># syslog-enabled no</span><br><span class="line"></span><br><span class="line"># Specify the syslog identity.</span><br><span class="line"># syslog-ident redis</span><br><span class="line"></span><br><span class="line"># Specify the syslog facility.  Must be USER or between LOCAL0-LOCAL7.</span><br><span class="line"># syslog-facility local0</span><br><span class="line"></span><br><span class="line"># è®¾ç½®æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ï¼Œå¯ä»¥ä½¿ç”¨select &lt;dbid&gt;å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“id</span><br><span class="line"># dbidæ˜¯ä»0åˆ°â€˜databasesâ€™-1çš„æ•°ç›®</span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line">################################ SNAPSHOTTING  #################################</span><br><span class="line"># æŒ‡å®šåœ¨å¤šé•¿æ—¶é—´å†…ï¼Œæœ‰å¤šå°‘æ¬¡æ›´æ–°æ“ä½œï¼Œå°±å°†æ•°æ®åŒæ­¥åˆ°æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥å¤šä¸ªæ¡ä»¶é…åˆ</span><br><span class="line"># Save the DB on disk:</span><br><span class="line">#</span><br><span class="line">#   save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line">#</span><br><span class="line">#   Will save the DB if both the given number of seconds and the given</span><br><span class="line">#   number of write operations against the DB occurred.</span><br><span class="line">#</span><br><span class="line">#   æ»¡è¶³ä»¥ä¸‹æ¡ä»¶å°†ä¼šåŒæ­¥æ•°æ®:</span><br><span class="line">#   900ç§’ï¼ˆ15åˆ†é’Ÿï¼‰å†…æœ‰1ä¸ªæ›´æ”¹</span><br><span class="line">#   300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰å†…æœ‰10ä¸ªæ›´æ”¹</span><br><span class="line">#   60ç§’å†…æœ‰10000ä¸ªæ›´æ”¹</span><br><span class="line">#   Note: å¯ä»¥æŠŠæ‰€æœ‰â€œsaveâ€è¡Œæ³¨é‡Šæ‰ï¼Œè¿™æ ·å°±å–æ¶ˆåŒæ­¥æ“ä½œäº†</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line"># æŒ‡å®šå­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ•°æ®ï¼Œé»˜è®¤ä¸ºyesï¼ŒRedisé‡‡ç”¨LZFå‹ç¼©ï¼Œå¦‚æœä¸ºäº†èŠ‚çœCPUæ—¶é—´ï¼Œå¯ä»¥å…³é—­è¯¥é€‰é¡¹ï¼Œä½†ä¼šå¯¼è‡´æ•°æ®åº“æ–‡ä»¶å˜çš„å·¨å¤§</span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line"># æŒ‡å®šæœ¬åœ°æ•°æ®åº“æ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸ºdump.rdb</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"># å·¥ä½œç›®å½•.</span><br><span class="line"># æŒ‡å®šæœ¬åœ°æ•°æ®åº“å­˜æ”¾ç›®å½•ï¼Œæ–‡ä»¶åç”±ä¸Šä¸€ä¸ªdbfilenameé…ç½®é¡¹æŒ‡å®š</span><br><span class="line"># </span><br><span class="line"># Also the Append Only File will be created inside this directory.</span><br><span class="line"># </span><br><span class="line"># æ³¨æ„ï¼Œè¿™é‡Œåªèƒ½æŒ‡å®šä¸€ä¸ªç›®å½•ï¼Œä¸èƒ½æŒ‡å®šæ–‡ä»¶å</span><br><span class="line">dir ./</span><br><span class="line"></span><br><span class="line">################################# REPLICATION #################################</span><br><span class="line"></span><br><span class="line"># ä¸»ä»å¤åˆ¶ã€‚ä½¿ç”¨slaveofä» RedisæœåŠ¡å™¨å¤åˆ¶ä¸€ä¸ªRediså®ä¾‹ã€‚æ³¨æ„ï¼Œè¯¥é…ç½®ä»…é™äºå½“å‰slaveæœ‰æ•ˆ</span><br><span class="line"># so for example it is possible to configure the slave to save the DB with a</span><br><span class="line"># different interval, or to listen to another port, and so on.</span><br><span class="line"># è®¾ç½®å½“æœ¬æœºä¸ºslavæœåŠ¡æ—¶ï¼Œè®¾ç½®masteræœåŠ¡çš„ipåœ°å€åŠç«¯å£ï¼Œåœ¨Rediså¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä»masterè¿›è¡Œæ•°æ®åŒæ­¥</span><br><span class="line"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># å½“masteræœåŠ¡è®¾ç½®äº†å¯†ç ä¿æŠ¤æ—¶ï¼ŒslavæœåŠ¡è¿æ¥masterçš„å¯†ç </span><br><span class="line"># ä¸‹æ–‡çš„â€œrequirepassâ€é…ç½®é¡¹å¯ä»¥æŒ‡å®šå¯†ç </span><br><span class="line"># masterauth &lt;master-password&gt;</span><br><span class="line"></span><br><span class="line"># When a slave lost the connection with the master, or when the replication</span><br><span class="line"># is still in progress, the slave can act in two different ways:</span><br><span class="line">#</span><br><span class="line"># 1) if slave-serve-stale-data is set to &apos;yes&apos; (the default) the slave will</span><br><span class="line">#    still reply to client requests, possibly with out of data data, or the</span><br><span class="line">#    data set may just be empty if this is the first synchronization.</span><br><span class="line">#</span><br><span class="line"># 2) if slave-serve-stale data is set to &apos;no&apos; the slave will reply with</span><br><span class="line">#    an error &quot;SYNC with master in progress&quot; to all the kind of commands</span><br><span class="line">#    but to INFO and SLAVEOF.</span><br><span class="line">#</span><br><span class="line">slave-serve-stale-data yes</span><br><span class="line"></span><br><span class="line"># Slaves send PINGs to server in a predefined interval. It&apos;s possible to change</span><br><span class="line"># this interval with the repl_ping_slave_period option. The default value is 10</span><br><span class="line"># seconds.</span><br><span class="line">#</span><br><span class="line"># repl-ping-slave-period 10</span><br><span class="line"></span><br><span class="line"># The following option sets a timeout for both Bulk transfer I/O timeout and</span><br><span class="line"># master data or ping response timeout. The default value is 60 seconds.</span><br><span class="line">#</span><br><span class="line"># It is important to make sure that this value is greater than the value</span><br><span class="line"># specified for repl-ping-slave-period otherwise a timeout will be detected</span><br><span class="line"># every time there is low traffic between the master and the slave.</span><br><span class="line">#</span><br><span class="line"># repl-timeout 60</span><br><span class="line"></span><br><span class="line">################################## SECURITY ###################################</span><br><span class="line"></span><br><span class="line"># Warning: since Redis is pretty fast an outside user can try up to</span><br><span class="line"># 150k passwords per second against a good box. This means that you should</span><br><span class="line"># use a very strong password otherwise it will be very easy to break.</span><br><span class="line"># è®¾ç½®Redisè¿æ¥å¯†ç ï¼Œå¦‚æœé…ç½®äº†è¿æ¥å¯†ç ï¼Œå®¢æˆ·ç«¯åœ¨è¿æ¥Redisæ—¶éœ€è¦é€šè¿‡auth &lt;password&gt;å‘½ä»¤æä¾›å¯†ç ï¼Œé»˜è®¤å…³é—­</span><br><span class="line"># requirepass foobared</span><br><span class="line"></span><br><span class="line"># Command renaming.</span><br><span class="line">#</span><br><span class="line"># It is possilbe to change the name of dangerous commands in a shared</span><br><span class="line"># environment. For instance the CONFIG command may be renamed into something</span><br><span class="line"># of hard to guess so that it will be still available for internal-use</span><br><span class="line"># tools but not available for general clients.</span><br><span class="line">#</span><br><span class="line"># Example:</span><br><span class="line">#</span><br><span class="line"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span><br><span class="line">#</span><br><span class="line"># It is also possilbe to completely kill a command renaming it into</span><br><span class="line"># an empty string:</span><br><span class="line">#</span><br><span class="line"># rename-command CONFIG &quot;&quot;</span><br><span class="line"></span><br><span class="line">################################### LIMITS ####################################</span><br><span class="line"></span><br><span class="line"># è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤æ— é™åˆ¶ï¼ŒRediså¯ä»¥åŒæ—¶æ‰“å¼€çš„å®¢æˆ·ç«¯è¿æ¥æ•°ä¸ºRedisè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°ï¼Œ</span><br><span class="line"># å¦‚æœè®¾ç½®maxclients 0ï¼Œè¡¨ç¤ºä¸ä½œé™åˆ¶ã€‚å½“å®¢æˆ·ç«¯è¿æ¥æ•°åˆ°è¾¾é™åˆ¶æ—¶ï¼ŒRedisä¼šå…³é—­æ–°çš„è¿æ¥å¹¶å‘å®¢æˆ·ç«¯è¿”å›max Number of clients reachedé”™è¯¯ä¿¡æ¯</span><br><span class="line"># maxclients 128</span><br><span class="line"></span><br><span class="line"># Don&apos;t use more memory than the specified amount of bytes.</span><br><span class="line"># When the memory limit is reached Redis will try to remove keys with an</span><br><span class="line"># EXPIRE set. It will try to start freeing keys that are going to expire</span><br><span class="line"># in little time and preserve keys with a longer time to live.</span><br><span class="line"># Redis will also try to remove objects from free lists if possible.</span><br><span class="line">#</span><br><span class="line"># If all this fails, Redis will start to reply with errors to commands</span><br><span class="line"># that will use more memory, like SET, LPUSH, and so on, and will continue</span><br><span class="line"># to reply to most read-only commands like GET.</span><br><span class="line">#</span><br><span class="line"># WARNING: maxmemory can be a good idea mainly if you want to use Redis as a</span><br><span class="line"># &apos;state&apos; server or cache, not as a real DB. When Redis is used as a real</span><br><span class="line"># database the memory usage will grow over the weeks, it will be obvious if</span><br><span class="line"># it is going to use too much memory in the long run, and you&apos;ll have the time</span><br><span class="line"># to upgrade. With maxmemory after the limit is reached you&apos;ll start to get</span><br><span class="line"># errors for write operations, and this may even lead to DB inconsistency.</span><br><span class="line"># æŒ‡å®šRedisæœ€å¤§å†…å­˜é™åˆ¶ï¼ŒRedisåœ¨å¯åŠ¨æ—¶ä¼šæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¾¾åˆ°æœ€å¤§å†…å­˜åï¼ŒRedisä¼šå…ˆå°è¯•æ¸…é™¤å·²åˆ°æœŸæˆ–å³å°†åˆ°æœŸçš„Keyï¼Œ</span><br><span class="line"># å½“æ­¤æ–¹æ³•å¤„ç†åï¼Œä»ç„¶åˆ°è¾¾æœ€å¤§å†…å­˜è®¾ç½®ï¼Œå°†æ— æ³•å†è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†ä»ç„¶å¯ä»¥è¿›è¡Œè¯»å–æ“ä½œã€‚</span><br><span class="line"># Redisæ–°çš„vmæœºåˆ¶ï¼Œä¼šæŠŠKeyå­˜æ”¾å†…å­˜ï¼ŒValueä¼šå­˜æ”¾åœ¨swapåŒº</span><br><span class="line"># maxmemory &lt;bytes&gt;</span><br><span class="line"></span><br><span class="line"># MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span><br><span class="line"># is reached? You can select among five behavior:</span><br><span class="line"># </span><br><span class="line"># volatile-lru -&gt; remove the key with an expire set using an LRU algorithm</span><br><span class="line"># allkeys-lru -&gt; remove any key accordingly to the LRU algorithm</span><br><span class="line"># volatile-random -&gt; remove a random key with an expire set</span><br><span class="line"># allkeys-&gt;random -&gt; remove a random key, any key</span><br><span class="line"># volatile-ttl -&gt; remove the key with the nearest expire time (minor TTL)</span><br><span class="line"># noeviction -&gt; don&apos;t expire at all, just return an error on write operations</span><br><span class="line"># </span><br><span class="line"># Note: with all the kind of policies, Redis will return an error on write</span><br><span class="line">#       operations, when there are not suitable keys for eviction.</span><br><span class="line">#</span><br><span class="line">#       At the date of writing this commands are: set setnx setex append</span><br><span class="line">#       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span><br><span class="line">#       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span><br><span class="line">#       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span><br><span class="line">#       getset mset msetnx exec sort</span><br><span class="line">#</span><br><span class="line"># The default is:</span><br><span class="line">#</span><br><span class="line"># maxmemory-policy volatile-lru</span><br><span class="line"></span><br><span class="line"># LRU and minimal TTL algorithms are not precise algorithms but approximated</span><br><span class="line"># algorithms (in order to save memory), so you can select as well the sample</span><br><span class="line"># size to check. For instance for default Redis will check three keys and</span><br><span class="line"># pick the one that was used less recently, you can change the sample size</span><br><span class="line"># using the following configuration directive.</span><br><span class="line">#</span><br><span class="line"># maxmemory-samples 3</span><br><span class="line"></span><br><span class="line">############################## APPEND ONLY MODE ###############################</span><br><span class="line"></span><br><span class="line"># </span><br><span class="line"># Note that you can have both the async dumps and the append only file if you</span><br><span class="line"># like (you have to comment the &quot;save&quot; statements above to disable the dumps).</span><br><span class="line"># Still if append only mode is enabled Redis will load the data from the</span><br><span class="line"># log file at startup ignoring the dump.rdb file.</span><br><span class="line"># æŒ‡å®šæ˜¯å¦åœ¨æ¯æ¬¡æ›´æ–°æ“ä½œåè¿›è¡Œæ—¥å¿—è®°å½•ï¼ŒRedisåœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥çš„æŠŠæ•°æ®å†™å…¥ç£ç›˜ï¼Œå¦‚æœä¸å¼€å¯ï¼Œå¯èƒ½ä¼šåœ¨æ–­ç”µæ—¶å¯¼è‡´ä¸€æ®µæ—¶é—´å†…çš„æ•°æ®ä¸¢å¤±ã€‚</span><br><span class="line"># å› ä¸ºredisæœ¬èº«åŒæ­¥æ•°æ®æ–‡ä»¶æ˜¯æŒ‰ä¸Šé¢saveæ¡ä»¶æ¥åŒæ­¥çš„ï¼Œæ‰€ä»¥æœ‰çš„æ•°æ®ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…åªå­˜åœ¨äºå†…å­˜ä¸­ã€‚é»˜è®¤ä¸ºno</span><br><span class="line"># IMPORTANT: Check the BGREWRITEAOF to check how to rewrite the append</span><br><span class="line"># log file in background when it gets too big.</span><br><span class="line"></span><br><span class="line">appendonly no</span><br><span class="line"></span><br><span class="line"># æŒ‡å®šæ›´æ–°æ—¥å¿—æ–‡ä»¶åï¼Œé»˜è®¤ä¸ºappendonly.aof</span><br><span class="line"># appendfilename appendonly.aof</span><br><span class="line"></span><br><span class="line"># The fsync() call tells the Operating System to actually write data on disk</span><br><span class="line"># instead to wait for more data in the output buffer. Some OS will really flush </span><br><span class="line"># data on disk, some other OS will just try to do it ASAP.</span><br><span class="line"></span><br><span class="line"># æŒ‡å®šæ›´æ–°æ—¥å¿—æ¡ä»¶ï¼Œå…±æœ‰3ä¸ªå¯é€‰å€¼ï¼š</span><br><span class="line"># no:è¡¨ç¤ºç­‰æ“ä½œç³»ç»Ÿè¿›è¡Œæ•°æ®ç¼“å­˜åŒæ­¥åˆ°ç£ç›˜ï¼ˆå¿«ï¼‰</span><br><span class="line"># always:è¡¨ç¤ºæ¯æ¬¡æ›´æ–°æ“ä½œåæ‰‹åŠ¨è°ƒç”¨fsync()å°†æ•°æ®å†™åˆ°ç£ç›˜ï¼ˆæ…¢ï¼Œå®‰å…¨ï¼‰</span><br><span class="line"># everysec:è¡¨ç¤ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼ˆæŠ˜è¡·ï¼Œé»˜è®¤å€¼ï¼‰</span><br><span class="line"></span><br><span class="line">appendfsync everysec</span><br><span class="line"># appendfsync no</span><br><span class="line"></span><br><span class="line"># When the AOF fsync policy is set to always or everysec, and a background</span><br><span class="line"># saving process (a background save or AOF log background rewriting) is</span><br><span class="line"># performing a lot of I/O against the disk, in some Linux configurations</span><br><span class="line"># Redis may block too long on the fsync() call. Note that there is no fix for</span><br><span class="line"># this currently, as even performing fsync in a different thread will block</span><br><span class="line"># our synchronous write(2) call.</span><br><span class="line">#</span><br><span class="line"># In order to mitigate this problem it&apos;s possible to use the following option</span><br><span class="line"># that will prevent fsync() from being called in the main process while a</span><br><span class="line"># BGSAVE or BGREWRITEAOF is in progress.</span><br><span class="line">#</span><br><span class="line"># This means that while another child is saving the durability of Redis is</span><br><span class="line"># the same as &quot;appendfsync none&quot;, that in pratical terms means that it is</span><br><span class="line"># possible to lost up to 30 seconds of log in the worst scenario (with the</span><br><span class="line"># default Linux settings).</span><br><span class="line"># </span><br><span class="line"># If you have latency problems turn this to &quot;yes&quot;. Otherwise leave it as</span><br><span class="line"># &quot;no&quot; that is the safest pick from the point of view of durability.</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line"># Automatic rewrite of the append only file.</span><br><span class="line"># Redis is able to automatically rewrite the log file implicitly calling</span><br><span class="line"># BGREWRITEAOF when the AOF log size will growth by the specified percentage.</span><br><span class="line"># </span><br><span class="line"># This is how it works: Redis remembers the size of the AOF file after the</span><br><span class="line"># latest rewrite (or if no rewrite happened since the restart, the size of</span><br><span class="line"># the AOF at startup is used).</span><br><span class="line">#</span><br><span class="line"># This base size is compared to the current size. If the current size is</span><br><span class="line"># bigger than the specified percentage, the rewrite is triggered. Also</span><br><span class="line"># you need to specify a minimal size for the AOF file to be rewritten, this</span><br><span class="line"># is useful to avoid rewriting the AOF file even if the percentage increase</span><br><span class="line"># is reached but it is still pretty small.</span><br><span class="line">#</span><br><span class="line"># Specify a precentage of zero in order to disable the automatic AOF</span><br><span class="line"># rewrite feature.</span><br><span class="line"></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line">################################## SLOW LOG ###################################</span><br><span class="line"></span><br><span class="line"># The Redis Slow Log is a system to log queries that exceeded a specified</span><br><span class="line"># execution time. The execution time does not include the I/O operations</span><br><span class="line"># like talking with the client, sending the reply and so forth,</span><br><span class="line"># but just the time needed to actually execute the command (this is the only</span><br><span class="line"># stage of command execution where the thread is blocked and can not serve</span><br><span class="line"># other requests in the meantime).</span><br><span class="line"># </span><br><span class="line"># You can configure the slow log with two parameters: one tells Redis</span><br><span class="line"># what is the execution time, in microseconds, to exceed in order for the</span><br><span class="line"># command to get logged, and the other parameter is the length of the</span><br><span class="line"># slow log. When a new command is logged the oldest one is removed from the</span><br><span class="line"># queue of logged commands.</span><br><span class="line"></span><br><span class="line"># The following time is expressed in microseconds, so 1000000 is equivalent</span><br><span class="line"># to one second. Note that a negative number disables the slow log, while</span><br><span class="line"># a value of zero forces the logging of every command.</span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line"></span><br><span class="line"># There is no limit to this length. Just be aware that it will consume memory.</span><br><span class="line"># You can reclaim memory used by the slow log with SLOWLOG RESET.</span><br><span class="line">slowlog-max-len 1024</span><br><span class="line"></span><br><span class="line">################################ VIRTUAL MEMORY ###############################</span><br><span class="line"></span><br><span class="line">### WARNING! Virtual Memory is deprecated in Redis 2.4</span><br><span class="line">### The use of Virtual Memory is strongly discouraged.</span><br><span class="line"></span><br><span class="line">### WARNING! Virtual Memory is deprecated in Redis 2.4</span><br><span class="line">### The use of Virtual Memory is strongly discouraged.</span><br><span class="line"></span><br><span class="line"># Virtual Memory allows Redis to work with datasets bigger than the actual</span><br><span class="line"># amount of RAM needed to hold the whole dataset in memory.</span><br><span class="line"># In order to do so very used keys are taken in memory while the other keys</span><br><span class="line"># are swapped into a swap file, similarly to what operating systems do</span><br><span class="line"># with memory pages.</span><br><span class="line"># æŒ‡å®šæ˜¯å¦å¯ç”¨è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼Œé»˜è®¤å€¼ä¸ºnoï¼Œ</span><br><span class="line"># VMæœºåˆ¶å°†æ•°æ®åˆ†é¡µå­˜æ”¾ï¼Œç”±Rediså°†è®¿é—®é‡è¾ƒå°‘çš„é¡µå³å†·æ•°æ®swapåˆ°ç£ç›˜ä¸Šï¼Œè®¿é—®å¤šçš„é¡µé¢ç”±ç£ç›˜è‡ªåŠ¨æ¢å‡ºåˆ°å†…å­˜ä¸­</span><br><span class="line"># æŠŠvm-enabledè®¾ç½®ä¸ºyesï¼Œæ ¹æ®éœ€è¦è®¾ç½®å¥½æ¥ä¸‹æ¥çš„ä¸‰ä¸ªVMå‚æ•°ï¼Œå°±å¯ä»¥å¯åŠ¨VMäº†</span><br><span class="line">vm-enabled no</span><br><span class="line"># vm-enabled yes</span><br><span class="line"></span><br><span class="line"># This is the path of the Redis swap file. As you can guess, swap files</span><br><span class="line"># can&apos;t be shared by different Redis instances, so make sure to use a swap</span><br><span class="line"># file for every redis process you are running. Redis will complain if the</span><br><span class="line"># swap file is already in use.</span><br><span class="line">#</span><br><span class="line"># Redisäº¤æ¢æ–‡ä»¶æœ€å¥½çš„å­˜å‚¨æ˜¯SSDï¼ˆå›ºæ€ç¡¬ç›˜ï¼‰</span><br><span class="line"># è™šæ‹Ÿå†…å­˜æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º/tmp/redis.swapï¼Œä¸å¯å¤šä¸ªRediså®ä¾‹å…±äº«</span><br><span class="line"># *** WARNING *** if you are using a shared hosting the default of putting</span><br><span class="line"># the swap file under /tmp is not secure. Create a dir with access granted</span><br><span class="line"># only to Redis user and configure Redis to create the swap file there.</span><br><span class="line">vm-swap-file /tmp/redis.swap</span><br><span class="line"></span><br><span class="line"># With vm-max-memory 0 the system will swap everything it can. Not a good</span><br><span class="line"># default, just specify the max amount of RAM you can in bytes, but it&apos;s</span><br><span class="line"># better to leave some margin. For instance specify an amount of RAM</span><br><span class="line"># that&apos;s more or less between 60 and 80% of your free RAM.</span><br><span class="line"># å°†æ‰€æœ‰å¤§äºvm-max-memoryçš„æ•°æ®å­˜å…¥è™šæ‹Ÿå†…å­˜ï¼Œæ— è®ºvm-max-memoryè®¾ç½®å¤šå°‘ï¼Œæ‰€æœ‰ç´¢å¼•æ•°æ®éƒ½æ˜¯å†…å­˜å­˜å‚¨çš„ï¼ˆRedisçš„ç´¢å¼•æ•°æ®å°±æ˜¯keysï¼‰</span><br><span class="line"># ä¹Ÿå°±æ˜¯è¯´å½“vm-max-memoryè®¾ç½®ä¸º0çš„æ—¶å€™ï¼Œå…¶å®æ˜¯æ‰€æœ‰valueéƒ½å­˜åœ¨äºç£ç›˜ã€‚é»˜è®¤å€¼ä¸º0</span><br><span class="line">vm-max-memory 0</span><br><span class="line"></span><br><span class="line"># Redis swapæ–‡ä»¶åˆ†æˆäº†å¾ˆå¤šçš„pageï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥ä¿å­˜åœ¨å¤šä¸ªpageä¸Šé¢ï¼Œä½†ä¸€ä¸ªpageä¸Šä¸èƒ½è¢«å¤šä¸ªå¯¹è±¡å…±äº«ï¼Œvm-page-sizeæ˜¯è¦æ ¹æ®å­˜å‚¨çš„æ•°æ®å¤§å°æ¥è®¾å®šçš„ã€‚</span><br><span class="line"># å»ºè®®å¦‚æœå­˜å‚¨å¾ˆå¤šå°å¯¹è±¡ï¼Œpageå¤§å°æœ€åè®¾ç½®ä¸º32æˆ–64bytesï¼›å¦‚æœå­˜å‚¨å¾ˆå¤§çš„å¯¹è±¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ›´å¤§çš„pageï¼Œå¦‚æœä¸ç¡®å®šï¼Œå°±ä½¿ç”¨é»˜è®¤å€¼</span><br><span class="line">vm-page-size 32</span><br><span class="line"></span><br><span class="line"># è®¾ç½®swapæ–‡ä»¶ä¸­çš„pageæ•°é‡ç”±äºé¡µè¡¨ï¼ˆä¸€ç§è¡¨ç¤ºé¡µé¢ç©ºé—²æˆ–ä½¿ç”¨çš„bitmapï¼‰æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œåœ¨ç£ç›˜ä¸Šæ¯8ä¸ªpageså°†æ¶ˆè€—1byteçš„å†…å­˜</span><br><span class="line"># swapç©ºé—´æ€»å®¹é‡ä¸º vm-page-size * vm-pages</span><br><span class="line">#</span><br><span class="line"># With the default of 32-bytes memory pages and 134217728 pages Redis will</span><br><span class="line"># use a 4 GB swap file, that will use 16 MB of RAM for the page table.</span><br><span class="line">#</span><br><span class="line"># It&apos;s better to use the smallest acceptable value for your application,</span><br><span class="line"># but the default is large in order to work in most conditions.</span><br><span class="line">vm-pages 134217728</span><br><span class="line"></span><br><span class="line"># Max number of VM I/O threads running at the same time.</span><br><span class="line"># This threads are used to read/write data from/to swap file, since they</span><br><span class="line"># also encode and decode objects from disk to memory or the reverse, a bigger</span><br><span class="line"># number of threads can help with big objects even if they can&apos;t help with</span><br><span class="line"># I/O itself as the physical device may not be able to couple with many</span><br><span class="line"># reads/writes operations at the same time.</span><br><span class="line"># è®¾ç½®è®¿é—®swapæ–‡ä»¶çš„I/Oçº¿ç¨‹æ•°ï¼Œæœ€åä¸è¦è¶…è¿‡æœºå™¨çš„æ ¸æ•°ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆæ‰€æœ‰å¯¹swapæ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„ï¼Œå¯èƒ½ä¼šé€ æˆæ¯”è¾ƒé•¿æ—¶é—´çš„å»¶è¿Ÿï¼Œé»˜è®¤å€¼ä¸º4</span><br><span class="line">vm-max-threads 4</span><br><span class="line"></span><br><span class="line">############################### ADVANCED CONFIG ###############################</span><br><span class="line"></span><br><span class="line"># Hashes are encoded in a special way (much more memory efficient) when they</span><br><span class="line"># have at max a given numer of elements, and the biggest element does not</span><br><span class="line"># exceed a given threshold. You can configure this limits with the following</span><br><span class="line"># configuration directives.</span><br><span class="line"># æŒ‡å®šåœ¨è¶…è¿‡ä¸€å®šçš„æ•°é‡æˆ–è€…æœ€å¤§çš„å…ƒç´ è¶…è¿‡æŸä¸€ä¸´ç•Œå€¼æ—¶ï¼Œé‡‡ç”¨ä¸€ç§ç‰¹æ®Šçš„å“ˆå¸Œç®—æ³•</span><br><span class="line">hash-max-zipmap-entries 512</span><br><span class="line">hash-max-zipmap-value 64</span><br><span class="line"></span><br><span class="line"># Similarly to hashes, small lists are also encoded in a special way in order</span><br><span class="line"># to save a lot of space. The special representation is only used when</span><br><span class="line"># you are under the following limits:</span><br><span class="line">list-max-ziplist-entries 512</span><br><span class="line">list-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"># Sets have a special encoding in just one case: when a set is composed</span><br><span class="line"># of just strings that happens to be integers in radix 10 in the range</span><br><span class="line"># of 64 bit signed integers.</span><br><span class="line"># The following configuration setting sets the limit in the size of the</span><br><span class="line"># set in order to use this special memory saving encoding.</span><br><span class="line">set-max-intset-entries 512</span><br><span class="line"></span><br><span class="line"># Similarly to hashes and lists, sorted sets are also specially encoded in</span><br><span class="line"># order to save a lot of space. This encoding is only used when the length and</span><br><span class="line"># elements of a sorted set are below the following limits:</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"># Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in</span><br><span class="line"># order to help rehashing the main Redis hash table (the one mapping top-level</span><br><span class="line"># keys to values). The hash table implementation redis uses (see dict.c)</span><br><span class="line"># performs a lazy rehashing: the more operation you run into an hash table</span><br><span class="line"># that is rhashing, the more rehashing &quot;steps&quot; are performed, so if the</span><br><span class="line"># server is idle the rehashing is never complete and some more memory is used</span><br><span class="line"># by the hash table.</span><br><span class="line"># </span><br><span class="line"># The default is to use this millisecond 10 times every second in order to</span><br><span class="line"># active rehashing the main dictionaries, freeing memory when possible.</span><br><span class="line">#</span><br><span class="line"># If unsure:</span><br><span class="line"># use &quot;activerehashing no&quot; if you have hard latency requirements and it is</span><br><span class="line"># not a good thing in your environment that Redis can reply form time to time</span><br><span class="line"># to queries with 2 milliseconds delay.</span><br><span class="line"># æŒ‡å®šæ˜¯å¦æ¿€æ´»é‡ç½®å“ˆå¸Œï¼Œé»˜è®¤ä¸ºå¼€å¯</span><br><span class="line">activerehashing yes</span><br><span class="line"></span><br><span class="line">################################## INCLUDES ###################################</span><br><span class="line"></span><br><span class="line"># æŒ‡å®šåŒ…å«å…¶ä»–çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸»æœºä¸Šå¤šä¸ªRediså®ä¾‹ä¹‹é—´ä½¿ç”¨åŒä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œè€ŒåŒæ—¶å„å®ä¾‹åˆæ‹¥æœ‰è‡ªå·±çš„ç‰¹å®šé…ç½®æ–‡ä»¶</span><br><span class="line"># include /path/to/local.conf</span><br><span class="line"># include /path/to/other.conf</span><br></pre></td></tr></table></figure><h3 id="å®Œæˆï¼"><a href="#å®Œæˆï¼" class="headerlink" title="å®Œæˆï¼"></a>å®Œæˆï¼</h3><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œç¼˜åˆ†å‘¢å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹~  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åˆšåˆšçœ‹è§ç¾¤å‹è¯´VPSåˆæå¹´ä¸­ç‰¹ä»·äº†ï¼Œçœ‹æ¥çœ‹å»ï¼Œé€‰äº†ä¸ªå¹´ä»˜$9.99çš„CN2çº¿è·¯çš„KVM VPSï¼Œå¿ƒé‡Œç¾æ»‹æ»‹ã€‚ç„¶è€Œè¿™å®¶çš„æœ€å°åŒ–centOSå±…ç„¶å¾ˆå¤šåŸºç¡€è¿è¡Œç¯å¢ƒéƒ½ä¸è£…ï¼Œç”šæ˜¯å¤´ç–¼ã€‚æ¥ä¸‹æ¥æˆ‘æ¥åˆ†äº«ä¸€ä¸‹æˆ‘è£…æœºçš„è¿‡ç¨‹&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https
      
    
    </summary>
    
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://tengshe789.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="è½¯ä»¶æ•™å­¦" scheme="https://tengshe789.github.io/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E5%AD%A6/"/>
    
      <category term="redis" scheme="https://tengshe789.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>å­¦å¥½åˆ†å¸ƒå¼æ¶æ„=5=-zookeeper</title>
    <link href="https://tengshe789.github.io/2018/07/29/%E6%88%91%E8%A6%81%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F-zookeeper/"/>
    <id>https://tengshe789.github.io/2018/07/29/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-zookeeper/</id>
    <published>2018-07-29T08:02:49.000Z</published>
    <updated>2019-11-20T13:39:41.401Z</updated>
    
    <content type="html"><![CDATA[<p>â€œå­¦å¥½åˆ†å¸ƒå¼æ¶æ„â€èŠ‚ç›®åšåˆ°ç¬¬å››æœŸäº†ï¼ŒğŸ‘ğŸ‘ğŸ‘</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h1 id="åˆ†å¸ƒå¼æ¦‚å¿µï¼ˆå‰æˆï¼‰"><a href="#åˆ†å¸ƒå¼æ¦‚å¿µï¼ˆå‰æˆï¼‰" class="headerlink" title="åˆ†å¸ƒå¼æ¦‚å¿µï¼ˆå‰æˆï¼‰"></a>åˆ†å¸ƒå¼æ¦‚å¿µï¼ˆå‰æˆï¼‰</h1><p>äº†è§£ä¸€ä¸ªæŠ€æœ¯ï¼Œå…ˆè¦æŒæ¡å®ƒçš„ç†è®ºï¼Œç„¶åå¾ªåºæ¸è¿›ã€‚æ‰€ä»¥ï¼Œç†è®ºæ¥äº†~</p><p>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼å‘¢ï¼Ÿç®€å•è¯´ï¼Œåˆ†å¸ƒå¼ç³»ç»ŸèƒŒåæ˜¯ç”±ä¸€ç³»åˆ—çš„è®¡ç®—æœºç»„æˆçš„ï¼Œä½†ç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°èƒŒåçš„é€»è¾‘ï¼Œå°±åƒè®¿é—®å•ä¸ªè®¡ç®—æœºä¸€æ · </p><p><img src="/2018/07/29/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-zookeeper/0.png" alt="åˆ†å¸ƒå¼æ¦‚å¿µ"></p><h2 id="æœ€åŸºæœ¬çš„ç‰¹ç‚¹"><a href="#æœ€åŸºæœ¬çš„ç‰¹ç‚¹" class="headerlink" title="æœ€åŸºæœ¬çš„ç‰¹ç‚¹"></a>æœ€åŸºæœ¬çš„ç‰¹ç‚¹</h2><h4 id="åˆ†å¸ƒæ€§"><a href="#åˆ†å¸ƒæ€§" class="headerlink" title="åˆ†å¸ƒæ€§"></a>åˆ†å¸ƒæ€§</h4><p>æœåŠ¡å™¨çš„ä½ç½®å¯èƒ½åœ¨ä¸ä¸€ä¸ªä½ç½®</p><h4 id="å¹¶å‘æ€§"><a href="#å¹¶å‘æ€§" class="headerlink" title="å¹¶å‘æ€§"></a>å¹¶å‘æ€§</h4><p>ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¹¶å‘æ€§æ“ä½œæ˜¯å¾ˆå¸¸è§çš„ã€‚æ¯”å¦‚åŒä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤šä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶è®¿é—®ä¸€ä¸ªå…±äº«èµ„æºã€‚æ•°æ®åº“ã€åˆ†å¸ƒå¼å­˜å‚¨</p><h4 id="æ— åºæ€§"><a href="#æ— åºæ€§" class="headerlink" title="æ— åºæ€§"></a>æ— åºæ€§</h4><p>è¿›ç¨‹ä¹‹é—´çš„æ¶ˆæ¯é€šä¿¡ï¼Œä¼šå‡ºç°é¡ºåºä¸ä¸€è‡´é—®é¢˜</p><h2 id="åˆ†å¸ƒå¼ç¯å¢ƒä¸‹é¢ä¸´çš„é—®é¢˜"><a href="#åˆ†å¸ƒå¼ç¯å¢ƒä¸‹é¢ä¸´çš„é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼ç¯å¢ƒä¸‹é¢ä¸´çš„é—®é¢˜"></a>åˆ†å¸ƒå¼ç¯å¢ƒä¸‹é¢ä¸´çš„é—®é¢˜</h2><p>åˆ†å¸ƒå¼çš„ç‰¹ç‚¹å†³å®šäº†å®ƒä¸€å®šä¼šæœ‰ç›¸åº”çš„é—®é¢˜</p><h3 id="ç½‘ç»œé€šä¿¡"><a href="#ç½‘ç»œé€šä¿¡" class="headerlink" title="ç½‘ç»œé€šä¿¡"></a>ç½‘ç»œé€šä¿¡</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¿¡æ¯é€šè¿‡ç½‘ç»œæ¥ä¼ è¾“çš„ï¼Œè€Œç½‘ç»œæœ¬èº«çš„ä¸å¯é æ€§ï¼Œå› æ­¤ä¼šæ¶‰åŠåˆ°ä¸€äº›ç½‘ç»œé€šä¿¡é—®é¢˜</p><h3 id="ç½‘ç»œåˆ†åŒº-è„‘è£‚"><a href="#ç½‘ç»œåˆ†åŒº-è„‘è£‚" class="headerlink" title="ç½‘ç»œåˆ†åŒº(è„‘è£‚)"></a>ç½‘ç»œåˆ†åŒº(è„‘è£‚)</h3><p>ä»€ä¹ˆæ˜¯è„‘è£‚å‘¢ï¼Ÿ</p><p>åœ¨é«˜å¯ç”¨ï¼ˆHAï¼‰ç³»ç»Ÿä¸­ï¼Œå½“è”ç³»2ä¸ªèŠ‚ç‚¹çš„â€œå¿ƒè·³çº¿â€æ–­å¼€æ—¶ï¼Œæœ¬æ¥ä¸ºä¸€æ•´ä½“ã€åŠ¨ä½œåè°ƒçš„HAç³»ç»Ÿï¼Œå°±åˆ†è£‚æˆä¸º2ä¸ªç‹¬ç«‹çš„ä¸ªä½“ã€‚ç”±äºç›¸äº’å¤±å»äº†è”ç³»ï¼Œéƒ½ä»¥ä¸ºæ˜¯å¯¹æ–¹å‡ºäº†æ•…éšœã€‚ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„HAè½¯ä»¶åƒâ€œè£‚è„‘äººâ€ä¸€æ ·ï¼Œäº‰æŠ¢â€œå…±äº«èµ„æºâ€ã€äº‰èµ·â€œåº”ç”¨æœåŠ¡â€ï¼Œå°±ä¼šå‘ç”Ÿä¸¥é‡åæœâ€”â€”æˆ–è€…å…±äº«èµ„æºè¢«ç“œåˆ†ã€2è¾¹â€œæœåŠ¡â€éƒ½èµ·ä¸æ¥äº†ï¼›æˆ–è€…2è¾¹â€œæœåŠ¡â€éƒ½èµ·æ¥äº†ï¼Œä½†åŒæ—¶è¯»å†™â€œå…±äº«å­˜å‚¨â€ï¼Œå¯¼è‡´æ•°æ®æŸåï¼ˆå¸¸è§å¦‚æ•°æ®åº“è½®è¯¢ç€çš„è”æœºæ—¥å¿—å‡ºé”™ï¼‰ã€‚ </p><p>è€Œå½“ç½‘ç»œå‘ç”Ÿå¼‚å¸¸å¯¼è‡´åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éƒ¨åˆ†èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œå»¶æ—¶ä¸æ–­å¢å¤§ï¼Œå°±ä¼šäº§ç”Ÿè„‘è£‚ç°è±¡ï¼Œå³ç»„æˆåˆ†å¸ƒå¼æ¶æ„çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œåªæœ‰éƒ¨åˆ†èŠ‚ç‚¹èƒ½å¤Ÿæ­£å¸¸é€šä¿¡</p><h3 id="ä¸‰æ€"><a href="#ä¸‰æ€" class="headerlink" title="ä¸‰æ€"></a>ä¸‰æ€</h3><p>åœ¨æ­£å¸¸çš„å•æœºç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªç¨‹åºè°ƒç”¨ä¸€ä¸ªæ¥å£ï¼Œæ­£å¸¸æƒ…å†µä¸‹åªæœ‰2ä¸ªçŠ¶æ€ï¼ŒæˆåŠŸæ€å’Œå¤±è´¥æ€ã€‚  ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå°±åˆå¤šäº†ä¸€ç§çŠ¶æ€ï¼Œå«åšè¶…æ—¶æ€ï¼ŒæŒ‡çš„å°±æ˜¯åœ¨åˆ†å¸ƒå¼ç½‘è·¯é€šä¿¡æ—¶ï¼Œå› ä¸ºç½‘ç»œæ•…éšœï¼Œæˆ‘çš„æ¶ˆæ¯ä¸€ç›´æ²¡æœ‰æ”¶åˆ°è¿”å›æˆ–è€…æ˜¯æˆ‘çš„æ¶ˆæ¯æ²¡æœ‰å‘é€å‡ºå»ã€‚ </p><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>åˆ†å¸ƒå¼ä¹Ÿä¼šæœ‰äº‹ç‰©é—®é¢˜ï¼Œå³ACID(åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§)ã€‚è­¬å¦‚ï¼Œå¦‚æœä¸¤å°åˆ†å¸ƒå¼æ¶æ„çš„æœåŠ¡å™¨æœ‰è¿™ç›¸åŒçš„åŠŸèƒ½ï¼Œå½“ç”¨æˆ·æ“ä½œçš„æ—¶å€™ï¼Œä½ è¦ä¿å­˜è¿™ä¸¤å°æœåŠ¡å™¨çš„åŒæ—¶å‘ç”ŸåŒæ—¶æˆåŠŸï¼Œè¿™å°±å±äºäº‹ç‰©é—®é¢˜ã€‚</p><blockquote><p>1.åŸå­æ€§ï¼ˆAtomicityï¼‰</p><p>â€‹    ä¸€ä¸ªåŸå­äº‹åŠ¡è¦ä¹ˆå®Œæ•´æ‰§è¡Œï¼Œè¦ä¹ˆå¹²è„†ä¸æ‰§è¡Œã€‚è¿™æ„å‘³ç€ï¼Œå·¥ä½œå•å…ƒä¸­çš„æ¯é¡¹ä»»åŠ¡éƒ½å¿…é¡»æ­£ç¡®æ‰§è¡Œã€‚å¦‚æœæœ‰ä»»ä¸€ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œåˆ™æ•´ä¸ªå·¥ä½œå•å…ƒæˆ–äº‹åŠ¡å°±ä¼šè¢«ç»ˆæ­¢ã€‚å³æ­¤å‰å¯¹æ•°æ®æ‰€ä½œçš„ä»»ä½•ä¿®æ”¹éƒ½å°†è¢«æ’¤é”€ã€‚å¦‚æœæ‰€æœ‰ä»»åŠ¡éƒ½è¢«æˆåŠŸæ‰§è¡Œï¼Œäº‹åŠ¡å°±ä¼šè¢«æäº¤ï¼Œå³å¯¹æ•°æ®æ‰€ä½œçš„ä¿®æ”¹å°†ä¼šæ˜¯æ°¸ä¹…æ€§çš„ã€‚</p><p>2.ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</p><p>â€‹    ä¸€è‡´æ€§ä»£è¡¨äº†åº•å±‚æ•°æ®å­˜å‚¨çš„å®Œæ•´æ€§ã€‚å®ƒå¿…é¡»ç”±äº‹åŠ¡ç³»ç»Ÿå’Œåº”ç”¨å¼€å‘äººå‘˜å…±åŒæ¥ä¿è¯ã€‚äº‹åŠ¡ç³»ç»Ÿé€šè¿‡ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Œéš”ç¦»æ€§å’ŒæŒä¹…æ€§æ¥æ»¡è¶³è¿™ä¸€è¦æ±‚; åº”ç”¨å¼€å‘äººå‘˜åˆ™éœ€è¦ä¿è¯æ•°æ®åº“æœ‰é€‚å½“çš„çº¦æŸ(ä¸»é”®ï¼Œå¼•ç”¨å®Œæ•´æ€§ç­‰)ï¼Œå¹¶ä¸”å·¥ä½œå•å…ƒä¸­æ‰€å®ç°çš„ä¸šåŠ¡é€»è¾‘ä¸ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´(å³ï¼Œæ•°æ®é¢„æœŸæ‰€è¡¨è¾¾çš„ç°å®ä¸šåŠ¡æƒ…å†µä¸ç›¸ä¸€è‡´)ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€æ¬¡è½¬è´¦è¿‡ç¨‹ä¸­ï¼Œä»æŸä¸€è´¦æˆ·ä¸­æ‰£é™¤çš„é‡‘é¢å¿…é¡»ä¸å¦ä¸€è´¦æˆ·ä¸­å­˜å…¥çš„é‡‘é¢ç›¸ç­‰ã€‚</p><p>3.éš”ç¦»æ€§ï¼ˆIsolationï¼‰</p><p>â€‹    éš”ç¦»æ€§æ„å‘³ç€äº‹åŠ¡å¿…é¡»åœ¨ä¸å¹²æ‰°å…¶ä»–è¿›ç¨‹æˆ–äº‹åŠ¡çš„å‰æä¸‹ç‹¬ç«‹æ‰§è¡Œã€‚æ¢è¨€ä¹‹ï¼Œåœ¨äº‹åŠ¡æˆ–å·¥ä½œå•å…ƒæ‰§è¡Œå®Œæ¯•ä¹‹å‰ï¼Œå…¶æ‰€è®¿é—®çš„æ•°æ®ä¸èƒ½å—ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†çš„å½±å“ã€‚</p><p>4.æŒä¹…æ€§ï¼ˆDurabilityï¼‰</p><p>â€‹    æŒä¹…æ€§è¡¨ç¤ºåœ¨æŸä¸ªäº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®æ‰€ä½œçš„æ‰€æœ‰æ”¹åŠ¨éƒ½å¿…é¡»åœ¨äº‹åŠ¡æˆåŠŸç»“æŸå‰ä¿å­˜è‡³æŸç§ç‰©ç†å­˜å‚¨è®¾å¤‡ã€‚è¿™æ ·å¯ä»¥ä¿è¯ï¼Œæ‰€ä½œçš„ä¿®æ”¹åœ¨ä»»ä½•ç³»ç»Ÿç˜«ç—ªæ—¶ä¸è‡³äºä¸¢å¤±ã€‚</p></blockquote><h4 id="ä¸­å¿ƒåŒ–å’Œå»ä¸­å¿ƒåŒ–"><a href="#ä¸­å¿ƒåŒ–å’Œå»ä¸­å¿ƒåŒ–" class="headerlink" title="ä¸­å¿ƒåŒ–å’Œå»ä¸­å¿ƒåŒ–"></a>ä¸­å¿ƒåŒ–å’Œå»ä¸­å¿ƒåŒ–</h4><p>æ•°æ®åº“å¤‡ä»½ä¸€èˆ¬ä½¿ç”¨å†·å¤‡æˆ–è€…çƒ­å¤‡</p><blockquote><p>çƒ­å¤‡ï¼šä¸€èˆ¬ç”¨äºä¿è¯æœåŠ¡æ­£å¸¸ä¸é—´æ–­è¿è¡Œï¼Œç”¨ä¸¤å°æœºå™¨ä½œä¸ºæœåŠ¡æœºå™¨ï¼Œä¸€å°ç”¨äºå®é™…æ•°æ®åº“æ“ä½œåº”ç”¨,å¦å¤–ä¸€å°å®æ—¶çš„ä»å‰è€…ä¸­è·å–æ•°æ®ä»¥ä¿æŒæ•°æ®ä¸€è‡´.å¦‚æœå½“å‰çš„æœºå™¨ç†„ç«,å¤‡ä»½çš„æœºå™¨ç«‹é©¬å–ä»£å½“å‰çš„æœºå™¨ç»§ç»­æä¾›æœåŠ¡</p><p>å†·å¤‡ï¼š.å†·å¤‡ä»½æŒ‡åœ¨æ•°æ®åº“å…³é—­å,è¿›è¡Œå¤‡ä»½,é€‚ç”¨äºæ‰€æœ‰æ¨¡å¼çš„æ•°æ®åº“</p></blockquote><p>åˆ†å¸ƒå¼æ¶æ„é‡Œé¢ï¼Œå¾ˆå¤šçš„æ¶æ„æ€æƒ³é‡‡ç”¨çš„æ˜¯å»ä¸­å¿ƒåŒ–ã€‚å³åœ¨ä¸€ä¸ªåˆ†å¸ƒæœ‰ä¼—å¤šèŠ‚ç‚¹çš„ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å…·æœ‰é«˜åº¦è‡ªæ²»çš„ç‰¹å¾ã€‚èŠ‚ç‚¹ä¹‹é—´å½¼æ­¤å¯ä»¥è‡ªç”±è¿æ¥ï¼Œå½¢æˆæ–°çš„è¿æ¥å•å…ƒã€‚ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¯èƒ½æˆä¸ºé˜¶æ®µæ€§çš„ä¸­å¿ƒï¼Œä½†ä¸å…·å¤‡å¼ºåˆ¶æ€§çš„ä¸­å¿ƒæ§åˆ¶åŠŸèƒ½ã€‚èŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´çš„å½±å“ï¼Œä¼šé€šè¿‡ç½‘ç»œè€Œå½¢æˆéçº¿æ€§å› æœå…³ç³»ã€‚è¿™ç§å¼€æ”¾å¼ã€æ‰å¹³åŒ–ã€å¹³ç­‰æ€§çš„ç³»ç»Ÿç°è±¡æˆ–ç»“æ„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå»ä¸­å¿ƒåŒ– </p><p>æœ€å…¸å‹çš„æ˜¯ï¼š zookeeper / etcd</p><h4 id="ç»å…¸çš„CAP"><a href="#ç»å…¸çš„CAP" class="headerlink" title="ç»å…¸çš„CAP"></a>ç»å…¸çš„CAP</h4><p>C<strong>ä¸€è‡´æ€§</strong> ï¼ˆConsistencyï¼‰: æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„æ•°æ®ï¼Œæ—¶åˆ»ä¿æŒä¸€è‡´</p><p>A<strong>å¯ç”¨æ€§</strong>ï¼ˆAvailabilityï¼‰ï¼šæ¯ä¸ªè¯·æ±‚éƒ½èƒ½å¤Ÿæ”¶åˆ°ä¸€ä¸ªå“åº”ï¼Œæ— è®ºå“åº”æˆåŠŸæˆ–è€…å¤±è´¥</p><p>P<strong>åˆ†åŒºå®¹é”™</strong> ï¼ˆPartition-toleranceï¼‰ï¼šè¡¨ç¤ºç³»ç»Ÿå‡ºç°è„‘è£‚ä»¥åï¼Œå¯èƒ½å¯¼è‡´æŸäº›serverä¸é›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨å¤±å»è”ç³»</p><p>æ— è®ºå¦‚ä½•ï¼Œéƒ½åªèƒ½ä¿è¯CPæˆ–è€… APã€‚<em>CAPç†è®ºä»…é€‚ç”¨äºåŸå­è¯»å†™çš„Nosqlåœºæ™¯ï¼Œä¸é€‚ç”¨äºæ•°æ®åº“ç³»ç»Ÿ</em></p><h4 id="BASEç†è®º"><a href="#BASEç†è®º" class="headerlink" title="BASEç†è®º"></a>BASEç†è®º</h4><p>åŸºäºCAPç†è®ºï¼ŒCAPç†è®ºå¹¶ä¸é€‚ç”¨äºæ•°æ®åº“äº‹åŠ¡ï¼ˆå› ä¸ºæ›´æ–°ä¸€äº›é”™è¯¯çš„æ•°æ®è€Œå¯¼è‡´æ•°æ®å‡ºç°ç´Šä¹±ï¼Œæ— è®ºä»€ä¹ˆæ ·çš„æ•°æ®åº“é«˜å¯ç”¨æ–¹æ¡ˆéƒ½æ˜¯å¾’åŠ³ï¼‰ ï¼Œè™½ç„¶XAäº‹åŠ¡å¯ä»¥ä¿è¯æ•°æ®åº“åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹çš„ACIDç‰¹æ€§ï¼Œä½†æ˜¯ä¼šå¸¦æ¥æ€§èƒ½æ–¹é¢çš„å½±å“ï¼›</p><p>eBayå°è¯•äº†ä¸€ç§å®Œå…¨ä¸åŒçš„å¥—è·¯ï¼Œæ”¾å®½äº†å¯¹äº‹åŠ¡ACIDçš„è¦æ±‚ã€‚æå‡ºäº†BASEç†è®ºï¼š</p><p><strong>Basically available</strong>  ï¼š æ•°æ®åº“é‡‡ç”¨åˆ†ç‰‡æ¨¡å¼ï¼Œ æŠŠ100Wçš„ç”¨æˆ·æ•°æ®åˆ†å¸ƒåœ¨5ä¸ªå®ä¾‹ä¸Šã€‚å¦‚æœç ´åäº†å…¶ä¸­ä¸€ä¸ªå®ä¾‹ï¼Œä»ç„¶å¯ä»¥ä¿è¯</p><p>80%çš„ç”¨æˆ·å¯ç”¨</p><p><strong>soft-state</strong>ï¼š  åœ¨åŸºäºclient-serveræ¨¡å¼çš„ç³»ç»Ÿä¸­ï¼Œserverç«¯æ˜¯å¦æœ‰çŠ¶æ€ï¼Œå†³å®šäº†ç³»ç»Ÿæ˜¯å¦å…·å¤‡è‰¯å¥½çš„æ°´å¹³æ‰©å±•ã€è´Ÿè½½å‡è¡¡ã€æ•…éšœæ¢å¤ç­‰ç‰¹æ€§ã€‚</p><p>Serverç«¯æ‰¿è¯ºä¼šç»´æŠ¤clientç«¯çŠ¶æ€æ•°æ®ï¼Œè¿™ä¸ªçŠ¶æ€ä»…ä»…ç»´æŒä¸€å°æ®µæ—¶é—´, è¿™æ®µæ—¶é—´ä»¥åï¼Œserverç«¯å°±ä¼šä¸¢å¼ƒè¿™ä¸ªçŠ¶æ€ï¼Œæ¢å¤æ­£å¸¸çŠ¶æ€</p><p><strong>Eventually consistent</strong>ï¼šæ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§</p><p>æ˜¯</p><h1 id="Zookeeperï¼ˆæ­£ç‰‡ï¼‰"><a href="#Zookeeperï¼ˆæ­£ç‰‡ï¼‰" class="headerlink" title="Zookeeperï¼ˆæ­£ç‰‡ï¼‰"></a>Zookeeperï¼ˆæ­£ç‰‡ï¼‰</h1><p>zookeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œæä¾›åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆã€‚æ˜¯ç”±é›…è™åˆ›å»ºçš„ï¼ŒåŸºäºgoogle chubbyã€‚ </p><h2 id="zookeeperæ˜¯ä»€ä¹ˆ"><a href="#zookeeperæ˜¯ä»€ä¹ˆ" class="headerlink" title="zookeeperæ˜¯ä»€ä¹ˆ"></a>zookeeperæ˜¯ä»€ä¹ˆ</h2><p>åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆ</p><h2 id="zookeeperèƒ½åšä»€ä¹ˆ"><a href="#zookeeperèƒ½åšä»€ä¹ˆ" class="headerlink" title="zookeeperèƒ½åšä»€ä¹ˆ"></a>zookeeperèƒ½åšä»€ä¹ˆ</h2><p>æ•°æ®çš„å‘å¸ƒ/è®¢é˜…ï¼ˆé…ç½®ä¸­å¿ƒ:disconfï¼‰  ã€ è´Ÿè½½å‡è¡¡ï¼ˆdubboåˆ©ç”¨äº†zookeeperæœºåˆ¶å®ç°è´Ÿè½½å‡è¡¡ï¼‰ ã€å‘½åæœåŠ¡ã€</p><p>masteré€‰ä¸¾(kafkaã€hadoopã€hbase)ã€åˆ†å¸ƒå¼é˜Ÿåˆ—ã€åˆ†å¸ƒå¼é”</p><h3 id="zookeeperç‰¹æ€§"><a href="#zookeeperç‰¹æ€§" class="headerlink" title="zookeeperç‰¹æ€§"></a>zookeeperç‰¹æ€§</h3><h4 id="é¡ºåºä¸€è‡´æ€§"><a href="#é¡ºåºä¸€è‡´æ€§" class="headerlink" title="é¡ºåºä¸€è‡´æ€§"></a>é¡ºåºä¸€è‡´æ€§</h4><p>ä»åŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„äº‹åŠ¡è¯·æ±‚ï¼Œæœ€ç»ˆä¼šä¸¥æ ¼æŒ‰ç…§é¡ºåºè¢«åº”ç”¨åˆ°zookeeperä¸­</p><h4 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h4><p>æ‰€æœ‰çš„äº‹åŠ¡è¯·æ±‚çš„å¤„ç†ç»“æœåœ¨æ•´ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰æœºå™¨ä¸Šçš„åº”ç”¨æƒ…å†µæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä¹ˆæ•´ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰æœºå™¨éƒ½æˆåŠŸåº”ç”¨äº†æŸä¸€äº‹åŠ¡ã€è¦ä¹ˆå…¨éƒ½ä¸åº”ç”¨</p><h4 id="å¯é æ€§"><a href="#å¯é æ€§" class="headerlink" title="å¯é æ€§"></a>å¯é æ€§</h4><p>ä¸€æ—¦æœåŠ¡å™¨æˆåŠŸåº”ç”¨äº†æŸä¸€ä¸ªäº‹åŠ¡æ•°æ®ï¼Œå¹¶ä¸”å¯¹å®¢æˆ·ç«¯åšäº†å“åº”ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®åœ¨æ•´ä¸ªé›†ç¾¤ä¸­ä¸€å®šæ˜¯åŒæ­¥å¹¶ä¸”ä¿ç•™ä¸‹æ¥çš„</p><h4 id="å®æ—¶æ€§"><a href="#å®æ—¶æ€§" class="headerlink" title="å®æ—¶æ€§"></a>å®æ—¶æ€§</h4><p>ä¸€æ—¦ä¸€ä¸ªäº‹åŠ¡è¢«æˆåŠŸåº”ç”¨ï¼Œå®¢æˆ·ç«¯å°±èƒ½å¤Ÿç«‹å³ä»æœåŠ¡å™¨ç«¯è¯»å–åˆ°äº‹åŠ¡å˜æ›´åçš„æœ€æ–°æ•°æ®çŠ¶æ€ï¼›ï¼ˆzookeeperä»…ä»…ä¿è¯åœ¨ä¸€å®šæ—¶é—´å†…ï¼Œè¿‘å®æ—¶ï¼‰</p><h2 id="zookeeperé›†ç¾¤ç¯å¢ƒ"><a href="#zookeeperé›†ç¾¤ç¯å¢ƒ" class="headerlink" title="zookeeperé›†ç¾¤ç¯å¢ƒ"></a>zookeeperé›†ç¾¤ç¯å¢ƒ</h2><p>zookeeperé›†ç¾¤, åŒ…å«ä¸‰ç§è§’è‰²: leader / follower /observer</p><p> <img src="/2018/07/29/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-zookeeper/1.png" alt="ä¸‰ç§è§’è‰²"></p><p><code>observer</code></p><p>observer æ˜¯ä¸€ç§ç‰¹æ®Šçš„zookeeperèŠ‚ç‚¹ã€‚å¯ä»¥<strong>å¸®åŠ©è§£å†³zookeeperçš„æ‰©å±•æ€§</strong>ï¼ˆå¦‚æœå¤§é‡å®¢æˆ·ç«¯è®¿é—®æˆ‘ä»¬zookeeperé›†ç¾¤ï¼Œéœ€è¦å¢åŠ zookeeperé›†ç¾¤æœºå™¨æ•°é‡ã€‚ä»è€Œå¢åŠ zookeeperé›†ç¾¤çš„æ€§èƒ½ã€‚ å¯¼è‡´zookeeperå†™æ€§èƒ½ä¸‹é™ï¼Œ zookeeperçš„æ•°æ®å˜æ›´éœ€è¦<strong>åŠæ•°</strong>ä»¥ä¸ŠæœåŠ¡å™¨æŠ•ç¥¨é€šè¿‡ã€‚é€ æˆç½‘ç»œæ¶ˆè€—å¢åŠ æŠ•ç¥¨æˆæœ¬ï¼‰</p><ol><li><p>observerä¸å‚ä¸æŠ•ç¥¨ã€‚ <strong>åªæ¥æ”¶</strong>æŠ•ç¥¨ç»“æœã€‚ä¸å’Œfollowerè”ç³»ã€‚</p></li><li><p>ä¸å±äºzookeeperçš„å…³é”®éƒ¨ä½ã€‚</p></li></ol><p><img src="/2018/07/29/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-zookeeper/6.png" alt="1532939249421"></p><h3 id="å®‰è£…zookeeper"><a href="#å®‰è£…zookeeper" class="headerlink" title="å®‰è£…zookeeper"></a>å®‰è£…zookeeper</h3><p>å¯ä»¥è™šæ‹Ÿæœºä¸­æ“ä½œï¼Œç³»ç»Ÿcentos7ï¼Œzookeeperå»å®˜æ–¹ç½‘ä¸‹ç¨³å®šç‰ˆã€‚å®‰è£…åï¼š</p><h5 id="ç¬¬ä¸€æ­¥ï¼š-ä¿®æ”¹é…ç½®æ–‡ä»¶zoo-cfg"><a href="#ç¬¬ä¸€æ­¥ï¼š-ä¿®æ”¹é…ç½®æ–‡ä»¶zoo-cfg" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼š ä¿®æ”¹é…ç½®æ–‡ä»¶zoo.cfg"></a>ç¬¬ä¸€æ­¥ï¼š ä¿®æ”¹é…ç½®æ–‡ä»¶zoo.cfg</h5><p><code>server.id=host:port:port</code></p><p>idçš„å–å€¼èŒƒå›´ï¼š 1~255ï¼› ç”¨idæ¥æ ‡è¯†è¯¥æœºå™¨åœ¨é›†ç¾¤ä¸­çš„æœºå™¨åºå·ï¼›</p><p>2888æ˜¯è¡¨ç¤ºfollowerèŠ‚ç‚¹ä¸leaderèŠ‚ç‚¹äº¤æ¢ä¿¡æ¯çš„ç«¯å£å·ï¼Œè¦å®šä¹‰æˆå’Œç³»ç»Ÿæ²¡æœ‰å†²çªçš„ç«¯å£å·ï¼›</p><p>3181 è¡¨ç¤ºleaderé€‰ä¸¾çš„ç«¯å£ï¼Œå¦‚æœleaderèŠ‚ç‚¹æŒ‚æ‰äº†, éœ€è¦ä¸€ä¸ªç«¯å£æ¥é‡æ–°é€‰ä¸¾ </p><p> æ —å­ï¼š</p><p>server.1=192.168.11.129:2888:3181</p><p>server.2=192.168.11.131:2888:3181</p><p>server.3=192.168.11.135:2888:3181</p><p>å¦‚æœéœ€è¦å¢åŠ observerèŠ‚ç‚¹ï¼Œzoo.cfgä¸­ï¼Œå¢åŠ  ;peerType=observer</p><p>server.1=192.168.11.129:2888:3181  </p><p>server.2=192.168.11.135:2888:3181   </p><p>server.3=192.168.111.136:2888:3181:observer</p><h5 id="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºmyid"><a href="#ç¬¬äºŒæ­¥ï¼šåˆ›å»ºmyid" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºmyid"></a>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºmyid</h5><p>åœ¨æ¯ä¸€ä¸ªæœåŠ¡å™¨çš„dataDirç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmyidçš„æ–‡ä»¶ï¼Œæ–‡ä»¶å°±ä¸€è¡Œæ•°æ®ï¼Œæ•°æ®å†…å®¹æ˜¯æ¯å°æœºå™¨å¯¹åº”çš„server IDçš„æ•°å­—</p><p><img src="/2018/07/29/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-zookeeper/2.png" alt="1532938048382"></p><h5 id="ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨zookeeper"><a href="#ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨zookeeper" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨zookeeper"></a>ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨zookeeper</h5><p><img src="/2018/07/29/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-zookeeper/3.png" alt="1532938153285"></p><p>å…³æ‰é˜²ç«å¢™</p><p><img src="/2018/07/29/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-zookeeper/5.png" alt="1532938312978"></p><p>çœ‹åˆ°ç”Ÿæˆ<code>zeekeeper.out</code>è¿™æ ·çš„ä¸€ä¸ªæ—¥å¿—ï¼Œå¯ä»¥ä½¿ç”¨<code>tail</code>å‘½ä»¤æŸ¥çœ‹</p><p><img src="/2018/07/29/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-zookeeper/4.png" alt="1532938204685"></p><h3 id="Zookeeperä¸­çš„ä¸€äº›æ¦‚å¿µ"><a href="#Zookeeperä¸­çš„ä¸€äº›æ¦‚å¿µ" class="headerlink" title="Zookeeperä¸­çš„ä¸€äº›æ¦‚å¿µ"></a>Zookeeperä¸­çš„ä¸€äº›æ¦‚å¿µ</h3><h4 id="Zookeeperé…ç½®è§£æ"><a href="#Zookeeperé…ç½®è§£æ" class="headerlink" title="Zookeeperé…ç½®è§£æ"></a>Zookeeperé…ç½®è§£æ</h4><p><img src="/2018/07/29/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-zookeeper/7.png" alt="1532955279402"></p><p><code>tickTime=2000</code>  zookeeperä¸­æœ€å°çš„æ—¶é—´å•ä½é•¿åº¦ ï¼ˆmsï¼‰</p><p><code>initLimit=10</code>  followerèŠ‚ç‚¹å¯åŠ¨åä¸leaderèŠ‚ç‚¹å®Œæˆæ•°æ®åŒæ­¥çš„æ—¶é—´</p><p><code>syncLimit</code>=5 leaderèŠ‚ç‚¹å’ŒfollowerèŠ‚ç‚¹è¿›è¡Œå¿ƒè·³æ£€æµ‹çš„æœ€å¤§å»¶æ—¶æ—¶é—´</p><p><code>dataDir</code>=/tmp/zookeeper  è¡¨ç¤ºzookeeperæœåŠ¡å™¨å­˜å‚¨å¿«ç…§æ–‡ä»¶çš„ç›®å½•</p><p><code>dataLogDir</code> è¡¨ç¤ºé…ç½® zookeeperäº‹åŠ¡æ—¥å¿—çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æŒ‡å®šåœ¨dataDirç›®å½•ä¸‹</p><p><code>clientPort</code> è¡¨ç¤ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„ç«¯å£å·ï¼š 2181</p><h4 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h4><p><code>zookeeper</code>çš„æ•°æ®æ¨¡å‹å’Œæ–‡ä»¶ç³»ç»Ÿç±»ä¼¼ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ç§°ä¸ºï¼š<code>znode</code>.  æ˜¯zookeeperä¸­çš„æœ€å°æ•°æ®å•å…ƒã€‚æ¯ä¸€ä¸ª<code>znode</code>ä¸Šéƒ½å¯ä»¥ä¿å­˜æ•°æ®å’ŒæŒ‚è½½å­èŠ‚ç‚¹ã€‚ ä»è€Œæ„æˆä¸€ä¸ªå±‚æ¬¡åŒ–çš„å±æ€§ç»“æ„</p><h5 id="èŠ‚ç‚¹ç‰¹æ€§"><a href="#èŠ‚ç‚¹ç‰¹æ€§" class="headerlink" title="èŠ‚ç‚¹ç‰¹æ€§"></a>èŠ‚ç‚¹ç‰¹æ€§</h5><p>æŒä¹…åŒ–èŠ‚ç‚¹  ï¼š èŠ‚ç‚¹åˆ›å»ºåä¼šä¸€ç›´å­˜åœ¨<code>zookeeper</code>æœåŠ¡å™¨ä¸Šï¼Œç›´åˆ°ä¸»åŠ¨åˆ é™¤</p><p>æŒä¹…åŒ–æœ‰åºèŠ‚ç‚¹ ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šä¸ºå®ƒçš„ä¸€çº§å­èŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªé¡ºåº</p><p>ä¸´æ—¶èŠ‚ç‚¹ ï¼š ä¸´æ—¶èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸå’Œå®¢æˆ·ç«¯çš„<strong>ä¼šè¯</strong>ä¿æŒä¸€è‡´ã€‚å½“å®¢æˆ·ç«¯ä¼šè¯å¤±æ•ˆï¼Œè¯¥èŠ‚ç‚¹è‡ªåŠ¨æ¸…ç†</p><p>ä¸´æ—¶æœ‰åºèŠ‚ç‚¹ ï¼š åœ¨ä¸´æ—¶èŠ‚ç‚¹ä¸Šå¤šå‹’ä¸€ä¸ªé¡ºåºæ€§ç‰¹æ€§</p><h5 id="ä¼šè¯"><a href="#ä¼šè¯" class="headerlink" title="ä¼šè¯"></a>ä¼šè¯</h5><p>å®¢æˆ·ç«¯å’Œ<code>zookeeper</code>ä¼šå»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªä¼šè¯ã€‚</p><p>ä¼šè¯æœ‰ä»€ä¹ˆè¿‡ç¨‹å‘¢ï¼Ÿ</p><p><img src="/2018/07/29/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-zookeeper/8.png" alt="1532956130898"></p><h5 id="Watcherï¼ˆç›‘å¬ï¼‰"><a href="#Watcherï¼ˆç›‘å¬ï¼‰" class="headerlink" title="Watcherï¼ˆç›‘å¬ï¼‰"></a>Watcherï¼ˆç›‘å¬ï¼‰</h5><p><code>zookeeper</code>æä¾›äº†åˆ†å¸ƒå¼æ•°æ®å‘å¸ƒ/è®¢é˜…,<code>zookeeper</code>å…è®¸å®¢æˆ·ç«¯å‘æœåŠ¡å™¨æ³¨å†Œä¸€ä¸ª<code>watcher</code>ç›‘å¬ã€‚å½“æœåŠ¡å™¨ç«¯çš„èŠ‚ç‚¹è§¦å‘æŒ‡å®šäº‹ä»¶çš„æ—¶å€™ï¼Œä¼šè§¦å‘<code>watcher</code>ã€‚æœåŠ¡ç«¯ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªäº‹ä»¶é€šçŸ¥ <code>watcher</code>çš„<strong>é€šçŸ¥æ˜¯ä¸€æ¬¡æ€§</strong>ï¼Œä¸€æ—¦è§¦å‘ä¸€æ¬¡é€šçŸ¥åï¼Œè¯¥<code>watcher</code>å°±å¤±æ•ˆ</p><h5 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h5><p><code>zookeeper</code>æä¾›æ§åˆ¶èŠ‚ç‚¹è®¿é—®æƒé™çš„åŠŸèƒ½ï¼Œç”¨äºæœ‰æ•ˆçš„ä¿è¯<code>zookeeper</code>ä¸­æ•°æ®çš„å®‰å…¨æ€§ã€‚é¿å…è¯¯æ“ä½œè€Œå¯¼è‡´ç³»ç»Ÿå‡ºç°é‡å¤§äº‹æ•…ã€‚</p><p>æä¾›äº†ï¼šCREATE /READ/WRITE/DELETE/ADMIN</p><h4 id="Zookeeperå‘½ä»¤æ“ä½œ-å¢åˆ æ”¹æŸ¥"><a href="#Zookeeperå‘½ä»¤æ“ä½œ-å¢åˆ æ”¹æŸ¥" class="headerlink" title="Zookeeperå‘½ä»¤æ“ä½œ(å¢åˆ æ”¹æŸ¥)"></a>Zookeeperå‘½ä»¤æ“ä½œ(å¢åˆ æ”¹æŸ¥)</h4><ol><li><code>create [-s]   -e path data acl</code></li></ol><p>-s è¡¨ç¤ºèŠ‚ç‚¹æ˜¯å¦æœ‰åº</p><p>-e è¡¨ç¤ºæ˜¯å¦ä¸ºä¸´æ—¶èŠ‚ç‚¹</p><p>(é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¯æŒä¹…åŒ–èŠ‚ç‚¹)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create /zoo #åˆ›å»ºzooèŠ‚ç‚¹</span><br><span class="line">create /zoo /zoo-1 #åˆ›å»ºzooèŠ‚ç‚¹ä¸‹çš„zoo-1</span><br><span class="line">ls /nodes #æ˜¾ç¤ºèŠ‚ç‚¹</span><br></pre></td></tr></table></figure><ol start="2"><li><code>get path [watch]</code></li></ol><p>è·å¾—æŒ‡å®š pathçš„ä¿¡æ¯</p><p>â€‹    3.<code>set path data [version]</code></p><p>ä¿®æ”¹èŠ‚ç‚¹ pathå¯¹åº”çš„data</p><p><code>version</code>è¡¨ç¤ºä¹è§‚é”ï¼ŒåŠæ•°æ®åº“ä¸­æœ‰ä¸€ä¸ªversionå­—æ®µå»æ§åˆ¶æ•°æ®è¡Œçš„ç‰ˆæœ¬å·</p><blockquote><p>ä¹è§‚é”ï¼ˆ Optimistic Locking ï¼‰ ç›¸å¯¹<a href="https://baike.baidu.com/item/%E6%82%B2%E8%A7%82%E9%94%81" target="_blank" rel="noopener">æ‚²è§‚é”</a>è€Œè¨€ï¼Œä¹è§‚é”æœºåˆ¶é‡‡å–äº†æ›´åŠ å®½æ¾çš„åŠ é”æœºåˆ¶ã€‚æ‚²è§‚é”å¤§å¤šæ•°æƒ…å†µä¸‹ä¾é æ•°æ®åº“çš„é”æœºåˆ¶å®ç°ï¼Œä»¥ä¿è¯æ“ä½œæœ€å¤§ç¨‹åº¦çš„ç‹¬å æ€§ã€‚ä½†éšä¹‹è€Œæ¥çš„å°±æ˜¯æ•°æ®åº“æ€§èƒ½çš„å¤§é‡å¼€é”€ï¼Œç‰¹åˆ«æ˜¯å¯¹é•¿<a href="https://baike.baidu.com/item/%E4%BA%8B%E5%8A%A1" target="_blank" rel="noopener">äº‹åŠ¡</a>è€Œè¨€ï¼Œè¿™æ ·çš„å¼€é”€å¾€å¾€æ— æ³•æ‰¿å—ã€‚è€Œä¹è§‚é”æœºåˆ¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä¹è§‚é”ï¼Œå¤§å¤šæ˜¯åŸºäºæ•°æ®ç‰ˆæœ¬ï¼ˆ Version ï¼‰è®°å½•æœºåˆ¶å®ç°ã€‚ä½•è°“æ•°æ®ç‰ˆæœ¬ï¼Ÿå³ä¸ºæ•°æ®å¢åŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼Œåœ¨åŸºäºæ•°æ®åº“è¡¨çš„ç‰ˆæœ¬è§£å†³æ–¹æ¡ˆä¸­ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸ºæ•°æ®åº“è¡¨å¢åŠ ä¸€ä¸ª â€œversionâ€ å­—æ®µæ¥å®ç°ã€‚è¯»å–å‡ºæ•°æ®æ—¶ï¼Œå°†æ­¤ç‰ˆæœ¬å·ä¸€åŒè¯»å‡ºï¼Œä¹‹åæ›´æ–°æ—¶ï¼Œå¯¹æ­¤ç‰ˆæœ¬å·åŠ ä¸€ã€‚æ­¤æ—¶ï¼Œå°†æäº¤æ•°æ®çš„ç‰ˆæœ¬æ•°æ®ä¸æ•°æ®åº“è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæäº¤çš„æ•°æ®ç‰ˆæœ¬å·å¤§äºæ•°æ®åº“è¡¨å½“å‰ç‰ˆæœ¬å·ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ã€‚  </p></blockquote><p>â€‹     4.<code>delete path [version]</code></p><p>åˆ é™¤èŠ‚ç‚¹</p><h5 id="èŠ‚ç‚¹çŠ¶æ€statä¿¡æ¯"><a href="#èŠ‚ç‚¹çŠ¶æ€statä¿¡æ¯" class="headerlink" title="èŠ‚ç‚¹çŠ¶æ€statä¿¡æ¯"></a>èŠ‚ç‚¹çŠ¶æ€statä¿¡æ¯</h5><p><code>cversion</code> = 0       å­ï¼ˆchildï¼‰èŠ‚ç‚¹çš„ç‰ˆæœ¬å·</p><p><code>aclVersion</code> = 0     è¡¨ç¤ºaclçš„ç‰ˆæœ¬å·ï¼Œä¿®æ”¹èŠ‚ç‚¹æƒé™</p><p><code>dataVersion</code> = 1    è¡¨ç¤ºçš„æ˜¯å½“å‰èŠ‚ç‚¹æ•°æ®çš„ç‰ˆæœ¬å·</p><p><code>czxid</code>    èŠ‚ç‚¹è¢«åˆ›å»ºæ—¶çš„äº‹åŠ¡ID</p><p><code>mzxid</code>   èŠ‚ç‚¹æœ€åä¸€æ¬¡è¢«æ›´æ–°çš„äº‹åŠ¡ID</p><p><code>pzxid</code>    å½“å‰èŠ‚ç‚¹ä¸‹çš„å­èŠ‚ç‚¹æœ€åä¸€æ¬¡è¢«ä¿®æ”¹æ—¶çš„äº‹åŠ¡ID</p><p><code>ctime</code> = åˆ›å»ºæ—¶é—´</p><p><code>mtime</code> = ä¿®æ”¹æ—¶é—´</p><p><code>ephemeralOwner</code> = 0x0   åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ªsessionId ã€‚ è¯¥å€¼å­˜å‚¨çš„å°±æ˜¯è¿™ä¸ªsessionid ã€‚0X0ä»£è¡¨æ— </p><p><code>dataLength</code> = 3    æ•°æ®å€¼é•¿åº¦</p><p><code>numChildren</code> = 0  å­èŠ‚ç‚¹æ•°</p><h3 id="åœ¨Javaä¸­ä½¿ç”¨zookeeper"><a href="#åœ¨Javaä¸­ä½¿ç”¨zookeeper" class="headerlink" title="åœ¨Javaä¸­ä½¿ç”¨zookeeper"></a>åœ¨Javaä¸­ä½¿ç”¨zookeeper</h3><p>å¼•å…¥ä¾èµ–</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å›°äº†ï¼Œç¡è§‰ã€‚æ˜å¤©å†ç å­—ã€‚æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚ã€‚ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://www.cnblogs.com/savorboard/p/distributed-system-transaction-consistency.html" target="_blank" rel="noopener">èŠèŠåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå†è¯´è¯´è§£å†³æ–¹æ¡ˆ</a></p><p>æ„Ÿè°¢</p><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œ<strong>ç¼˜åˆ†å‘¢</strong>å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹ï¼Œå’±ä»¬ä¸¤ä¸ªæƒ³ä¸ªå·ç ï¼Œ ä¹°ä¸ªå½©ç¥¨ï¼Œå…ˆæŒ£ä»–ä¸ªå‡ ç™¾ä¸‡ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;â€œå­¦å¥½åˆ†å¸ƒå¼æ¶æ„â€èŠ‚ç›®åšåˆ°ç¬¬å››æœŸäº†ï¼ŒğŸ‘ğŸ‘ğŸ‘&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.tech/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æˆ‘çš„åšå®¢&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="å­¦å¥½åˆ†å¸ƒå¼æ¶æ„" scheme="https://tengshe789.github.io/tags/%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>å­¦å¥½åˆ†å¸ƒå¼æ¶æ„=4=-webservice</title>
    <link href="https://tengshe789.github.io/2018/07/28/%E6%88%91%E8%A6%81%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F-webservice/"/>
    <id>https://tengshe789.github.io/2018/07/28/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-webservice/</id>
    <published>2018-07-28T14:12:36.000Z</published>
    <updated>2019-11-20T13:39:41.398Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©å’±ä»¬ä¸€èµ·æ¢ç´¢ä¸€ä¸‹webserviceè¿™ä¸ªæŠ€æœ¯ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h3 id="ä»€ä¹ˆæ˜¯webservice"><a href="#ä»€ä¹ˆæ˜¯webservice" class="headerlink" title="ä»€ä¹ˆæ˜¯webservice"></a>ä»€ä¹ˆæ˜¯webservice</h3><p><code>webservice</code>ä¹Ÿå¯ä»¥å«xml web service webserviceï¼ˆåœ¨javax.jwsï¼‰, è½»é‡çº§çš„ç‹¬ç«‹çš„é€šè®¯æŠ€æœ¯</p><ol><li><p>åŸºäºwebçš„æœåŠ¡ï¼šæœåŠ¡ç«¯æä¾›çš„æœåŠ¡æ¥å£è®©å®¢æˆ·ç«¯è®¿é—®</p></li><li><p>è·¨å¹³å°ã€è·¨è¯­è¨€çš„æ•´åˆæ–¹æ¡ˆ</p></li></ol><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨webservice"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨webservice" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨webservice"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨webservice</h3><p>ç›¸æ¯”RMIï¼Œå®ƒæ˜¯ä»¥å‰æ¯”è¾ƒå¥½çš„è·¨è¯­è¨€è°ƒç”¨çš„è§£å†³æ–¹æ¡ˆ</p><p> å°±è­¬å¦‚è¯´ï¼Œä¸€ä¸ªç”µå•†å¹³å°ï¼Œè®¢å•å¯ä»¥æŸ¥çœ‹ç‰©æµçŠ¶æ€ã€‚ï¼Œè¿™å¯èƒ½å°±æ˜¯.netå®ç°çš„webserviceæœåŠ¡æ¥å£ã€‚</p><h3 id="webserviceä¸­çš„ä¸€äº›æ¦‚å¿µ"><a href="#webserviceä¸­çš„ä¸€äº›æ¦‚å¿µ" class="headerlink" title="webserviceä¸­çš„ä¸€äº›æ¦‚å¿µ"></a>webserviceä¸­çš„ä¸€äº›æ¦‚å¿µ</h3><h4 id="WSDL-web-service-definition-language-webservice-å®šä¹‰è¯­è¨€"><a href="#WSDL-web-service-definition-language-webservice-å®šä¹‰è¯­è¨€" class="headerlink" title="WSDL(web service definition language  webservice å®šä¹‰è¯­è¨€)"></a>WSDL(web service definition language  webservice å®šä¹‰è¯­è¨€)</h4><p><code>webservice</code>æœåŠ¡éœ€è¦é€šè¿‡wsdlæ–‡ä»¶æ¥è¯´æ˜è‡ªå·±æœ‰ä»€ä¹ˆæœåŠ¡å¯ä»¥å¯¹å¤–è°ƒç”¨ã€‚å¹¶ä¸”æœ‰å“ªäº›æ–¹æ³•ã€æ–¹æ³•é‡Œé¢æœ‰å“ªäº›å‚æ•°</p><p>wsdlåŸºäºXMLï¼ˆå¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼‰å»å®šä¹‰äº†</p><ol><li><p>å¯¹åº”ä¸€ä¸ª<code>.wsdl</code>çš„æ–‡ä»¶ç±»å‹</p></li><li><p>å®šä¹‰äº†webserviceçš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åº”ç”¨è¿›è¡Œäº¤äº’çš„ä¼ é€’æ•°æ®å’Œå“åº”æ•°æ®æ ¼å¼å’Œæ–¹å¼</p></li><li><p>ä¸€ä¸ªwebserviceå¯¹åº”å”¯ä¸€ä¸€ä¸ªwsdlæ–‡æ¡£</p></li></ol><h4 id="SOAPï¼ˆsimple-object-access-protocalç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰"><a href="#SOAPï¼ˆsimple-object-access-protocalç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰" class="headerlink" title="SOAPï¼ˆsimple object access protocalç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰"></a>SOAPï¼ˆsimple object access protocalç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰</h4><p>å·®ä¸å¤šå°±æ˜¯<code>http+xml</code>ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿwebserviceé€šè¿‡httpåè®®å‘é€å’Œæ¥æ”¶è¯·æ±‚æ—¶ï¼Œ å‘é€çš„å†…å®¹ï¼ˆè¯·æ±‚æŠ¥æ–‡ï¼‰å’Œæ¥æ”¶çš„å†…å®¹ï¼ˆå“åº”æŠ¥æ–‡ï¼‰éƒ½æ˜¯é‡‡ç”¨xmlæ ¼å¼è¿›è¡Œå°è£…ï¼Œè¿™äº›ç‰¹å®šçš„HTTPæ¶ˆæ¯å¤´å’ŒXMLå†…å®¹æ ¼å¼å°±æ˜¯SOAPåè®®ã€‚</p><p>ä¸€æ¡ SOAP æ¶ˆæ¯å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ XML æ–‡æ¡£ï¼ŒåŒ…å«ä¸‹åˆ—å…ƒç´ ï¼š  </p><p>â€¢ Envelope å…ƒç´ ï¼Œæ ‡è¯†XML æ–‡æ¡£ä¸€æ¡ SOAP æ¶ˆæ¯  </p><p>â€¢ Header å…ƒç´ ï¼ŒåŒ…å«å¤´éƒ¨ä¿¡æ¯çš„XMLæ ‡ç­¾  </p><p>â€¢ Body å…ƒç´ ï¼ŒåŒ…å«æ‰€æœ‰çš„è°ƒç”¨å’Œå“åº”çš„ä¸»ä½“ä¿¡æ¯çš„æ ‡ç­¾  </p><p>â€¢ Fault å…ƒç´ ï¼Œé”™è¯¯ä¿¡æ¯æ ‡ç­¾ã€‚  </p><p>æ’ä¸€å¥å˜´ï¼Œç°åœ¨çš„å‘¢ï¼ŒåŸºäºRESTfulæ¥å£çš„éƒ½æ˜¯http+json</p><p>å›åˆ°ä¸»é¢˜ï¼Œä»€ä¹ˆæ˜¯soapï¼Ÿ</p><ol><li><p>ä¸€ç§ç®€å•ã€åŸºäºHTTPå’ŒXMLçš„åè®®</p></li><li><p>soapæ¶ˆæ¯ï¼šè¯·æ±‚å’Œå“åº”æ¶ˆæ¯</p></li><li><p>http+xmlæŠ¥æ–‡</p></li></ol><h4 id="SEIï¼ˆwebservice-endpoint-interface-webserviceçš„ç»ˆç«¯æ¥å£ï¼‰"><a href="#SEIï¼ˆwebservice-endpoint-interface-webserviceçš„ç»ˆç«¯æ¥å£ï¼‰" class="headerlink" title="SEIï¼ˆwebservice endpoint interface webserviceçš„ç»ˆç«¯æ¥å£ï¼‰"></a>SEIï¼ˆwebservice endpoint interface webserviceçš„ç»ˆç«¯æ¥å£ï¼‰</h4><p>webserviceæœåŠ¡ç«¯ç”¨æ¥å¤„ç†è¯·æ±‚çš„æ¥å£ï¼Œä¹Ÿå°±æ˜¯å‘å¸ƒå‡ºå»çš„æ¥å£ã€‚</p><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p>å¦‚ä½•å®ç°å‘¢ï¼Ÿå†™ä¸€ä¸ªå°demo</p><p>é¦–å…ˆæ˜¯æœåŠ¡ç«¯çš„æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebService</span><span class="comment">//SEIä»¥åŠå®ç°ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ISayHello</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@WebMethod</span><span class="comment">//seiä¸­çš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebService</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SayHello</span> <span class="keyword">implements</span> <span class="title">ISayHello</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bootstrap</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ç»ˆç«¯å‘å¸ƒ~</span></span><br><span class="line">        Endpoint.publish(<span class="string">"http://localhost:8888/tech/hello"</span>,<span class="keyword">new</span> SayHello());</span><br><span class="line">        System.out.println(<span class="string">"å‘å¸ƒæˆåŠŸ~"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å¯åŠ¨ç¨‹åºã€‚åˆ°æµè§ˆå™¨è¾“å…¥url+â€?wsdlâ€å°±å¯ä»¥æŸ¥çœ‹wsdlæ–‡æ¡£äº†</p><p><img src="/2018/07/28/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-webservice/0.png" alt="1532855168339"></p><p>æ¥ä¸‹æ¥åœ¨IDEAä¸­æ‰“å¼€terminalæˆ–è€…ç›´æ¥è¿›å…¥cmdï¼Œè°ƒç”¨wsimportå·¥å…·,è¾“å…¥å‘½ä»¤:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsimport -keep http://localhost:8888/tech/hello?wsdl</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç®€ä»‹ä¸€ä¸‹åƒæ•°ï¼š</p><ol><li>-d è¡¨ç¤ºè¾“å‡ºçš„æ–‡ä»¶å¤¹ã€‚æ–‡ä»¶å¤¹å¿…é¡»äº‹å…ˆå­˜åœ¨ï¼Œå¦åˆ™å¯¼å‡ºå¤±è´¥ã€‚</li><li>-keep è¡¨ç¤ºå¯¼å‡ºwebserviceçš„classæ–‡ä»¶æ—¶æ˜¯å¦ä¹Ÿå¯¼å‡ºæºç javaæ–‡ä»¶ã€‚</li><li>-verbose verboseè¡¨ç¤ºå…·ä½“ä¿¡æ¯ã€‚</li></ol><p><img src="/2018/07/28/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-webservice/1.png" alt="1532857279266"></p><p>è¿™æ—¶å€™ç”Ÿæˆçš„å®¢æˆ·ç«¯ä»£ç </p><p><img src="/2018/07/28/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-webservice/2.png" alt="1532857770651"></p><p>è¿ç§»åˆ°IDEAæ‰“å¼€ï¼Œæ–°å»ºä¸€ä¸ªdemo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SayHelloService service=<span class="keyword">new</span> SayHelloService();</span><br><span class="line">        SayHello sayHello= (SayHello) service.getSayHelloPort();</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>demoå®Œæˆ~ï¼</p><h3 id="å…³äºWSDLæ–‡æ¡£"><a href="#å…³äºWSDLæ–‡æ¡£" class="headerlink" title="å…³äºWSDLæ–‡æ¡£"></a>å…³äºWSDLæ–‡æ¡£</h3><p>ä¸‹é¢è¯´è¯´wsdlæ–‡æ¡£å„ä¸ªæ ‡ç­¾çš„å«ä¹‰</p><p><img src="/2018/07/28/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-webservice/3.png" alt="wsdl"></p><h4 id="Typesæ ‡ç­¾"><a href="#Typesæ ‡ç­¾" class="headerlink" title="Typesæ ‡ç­¾"></a>Typesæ ‡ç­¾</h4><p>å®šä¹‰æ•´æœåŠ¡ç«¯çš„æ•°æ®æŠ¥æ–‡</p><h4 id="Schemaæ ‡ç­¾"><a href="#Schemaæ ‡ç­¾" class="headerlink" title="Schemaæ ‡ç­¾"></a>Schemaæ ‡ç­¾</h4><p>ä¸ºäº†å®ç°æœ€å¤§çš„äº’æ“ä½œæ€§ï¼ˆinteroperabilityï¼‰å’Œå¹³å°ä¸­ç«‹æ€§ï¼ˆneutralityï¼‰ï¼ŒWSDLé€‰ç”¨XML Schema DataTypesï¼Œç®€ç§°XSDä½œä¸ºæ ‡å‡†ç±»å‹ç³»ç»Ÿï¼Œå¹¶å°†å®ƒä½œä¸ºå›ºæœ‰ç±»å‹ç³»ç»Ÿã€‚</p><p>å›¾ä¸­çš„æ˜¯æ•°æ®å®šä¹‰éƒ¨åˆ†ï¼Œè¯¥éƒ¨åˆ†å®šä¹‰äº†ä¸¤ä¸ªå…ƒç´ ï¼Œä¸€ä¸ªæ˜¯sayHelloï¼Œä¸€ä¸ªæ˜¯sayHelloResponseï¼š</p><ul><li>sayHelloï¼šå®šä¹‰äº†ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œä»…ä»…åŒ…å«ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼Œå°†æ¥ç”¨æ¥æè¿°æ“ä½œçš„å‚å…¥ä¼ å…¥éƒ¨åˆ†ï¼›</li></ul><ul><li>sayHelloResponseï¼šå®šä¹‰äº†ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œä»…ä»…åŒ…å«ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼Œå°†æ¥ç”¨æ¥æè¿°æ“ä½œçš„è¿”å›å€¼ï¼›</li></ul><h4 id="Messageæ ‡ç­¾"><a href="#Messageæ ‡ç­¾" class="headerlink" title="Messageæ ‡ç­¾"></a>Messageæ ‡ç­¾</h4><p>å®šä¹‰å…ƒç´ æ•°æ®ç±»å‹</p><h4 id="Porttype"><a href="#Porttype" class="headerlink" title="Porttype"></a>Porttype</h4><p>å®šä¹‰æœåŠ¡å™¨ç«¯çš„SEI</p><p>input/outputå±æ€§ï¼šæŒ‡å®šè¾“å…¥è¾“å‡ºçš„æ•°æ®ç±»å‹</p><h4 id="Bindingæ ‡ç­¾"><a href="#Bindingæ ‡ç­¾" class="headerlink" title="Bindingæ ‡ç­¾"></a>Bindingæ ‡ç­¾</h4><p>typeå±æ€§ï¼šå¼•ç”¨PortType</p><h4 id="serviceæ ‡ç­¾"><a href="#serviceæ ‡ç­¾" class="headerlink" title="serviceæ ‡ç­¾"></a>serviceæ ‡ç­¾</h4><p>è¡¨ç¤ºæœåŠ¡å™¨ç«¯çš„ä¸€ä¸ªwebserviceå®¹å™¨</p><p>nameå±æ€§ï¼šåˆ¶å®šå®¢æˆ·ç«¯å±æ€§</p><p>protå±æ€§ï¼šæŒ‡å®šå®¢æˆ·ç«¯çš„å®¹å™¨ç±»</p><p>addressï¼šå¤§éƒ¨åˆ†å…¨éƒ¨webserviceçš„åœ°å€</p><p><img src="/2018/07/28/æˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼-webservice/4.png" alt="1532860870497"></p><h3 id="è¿‡å»çš„Webserviceå·¥å…·"><a href="#è¿‡å»çš„Webserviceå·¥å…·" class="headerlink" title="è¿‡å»çš„Webserviceå·¥å…·"></a>è¿‡å»çš„Webserviceå·¥å…·</h3><p>å‘ä¸ªåå­—ç•™ä½œå¤‡ä»½ï¼Œå› ä¸ºç°åœ¨æ—©å·²ä¸ç”¨å¤æ‚çš„webserviceäº†</p><h4 id="cxf"><a href="#cxf" class="headerlink" title="cxf"></a>cxf</h4><p>celtix+xfire</p><h4 id="axis"><a href="#axis" class="headerlink" title="axis"></a>axis</h4><h3 id="å®Œ"><a href="#å®Œ" class="headerlink" title="å®Œ"></a>å®Œ</h3><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œ<strong>ç¼˜åˆ†å‘¢</strong>å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹ï¼Œå’±ä»¬ä¸¤ä¸ªæƒ³ä¸ªå·ç ï¼Œ ä¹°ä¸ªå½©ç¥¨ï¼Œå…ˆæŒ£ä»–ä¸ªå‡ ç™¾ä¸‡ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©å’±ä»¬ä¸€èµ·æ¢ç´¢ä¸€ä¸‹webserviceè¿™ä¸ªæŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.tech/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æˆ‘çš„åšå®¢&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="å­¦å¥½åˆ†å¸ƒå¼æ¶æ„" scheme="https://tengshe789.github.io/tags/%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>å­¦å¥½åˆ†å¸ƒå¼æ¶æ„=6=-RMIé€šä¿¡æ¡†æ¶</title>
    <link href="https://tengshe789.github.io/2018/07/26/RMI%E9%80%9A%E4%BF%A1%E6%A1%86%E6%9E%B6/"/>
    <id>https://tengshe789.github.io/2018/07/26/RMIé€šä¿¡æ¡†æ¶/</id>
    <published>2018-07-26T11:28:30.000Z</published>
    <updated>2019-11-20T13:39:40.597Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ†å¸ƒå¼æ¡†æ¶æ˜¯æœ€è¿‘å‡ å¹´çš„çƒ­é—¨ã€‚å¯æ˜¯è¦æƒ³ç†è§£åˆ†å¸ƒå¼æ¡†æ¶ç€å®ä¸æ˜“ï¼Œä¸ºäº†åŠªåŠ›è·Ÿä¸Šæ—¶ä»£æ½®æµï¼Œç‰¹æ­¤å¼€äº†ä¸€ä¸ªä¸“é¢˜ï¼Œèµ·åâ€œæˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼â€ï¼Œé€šè¿‡åšå®¢æ¥åˆ†äº«ä¸€ä¸‹æˆ‘çš„å­¦ä¹ è¿‡ç¨‹ï¼ŒåŠ æ·±æˆ‘å¯¹åˆ†å¸ƒå¼æ•´ä½“æ¡†æ¶çš„ç†è§£ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h3 id="ä»€ä¹ˆæ˜¯RPC"><a href="#ä»€ä¹ˆæ˜¯RPC" class="headerlink" title="ä»€ä¹ˆæ˜¯RPC"></a>ä»€ä¹ˆæ˜¯RPC</h3><p>è‹±æ–‡å°±ä¸è¯´äº†ã€‚ä¸­æ–‡åè¿œç¨‹è¿›ç¨‹è°ƒç”¨åè®®ã€‚é¡¾åæ€ä¹‰ï¼Œå®¢æˆ·ç«¯åœ¨ä¸çŸ¥é“ç»†èŠ‚çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è°ƒç”¨è¿œç¨‹è®¡ç®—æœºçš„apiï¼Œå°±åƒæ˜¯è°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ã€‚</p><p>RPCåè®®æ˜¯ä¸€ä¸ªè§„èŒƒã€‚ä¸»æµçš„PRCåè®®æœ‰<code>Dubbo</code>ã€<code>Thrif</code>ã€<code>RMI</code>ã€<code>Webservice</code>ã€<code>Hessain</code></p><p>ä»–åˆä¸€ä¸ªéå¸¸å¤§çš„ç‰¹ç‚¹ï¼Œç½‘ç»œåè®®å’Œç½‘ç»œIOå¯¹äºè°ƒç”¨ç«¯å’ŒæœåŠ¡ç«¯æ¥è¯´æ˜¯é€æ˜çš„ï¼ˆåŠ¨æ€ä»£ç†ï¼‰</p><p> ä¸€ä¸ªRPCæ¡†æ¶åŒ…å«çš„è¦ç´ ï¼š</p><p><img src="/2018/07/26/RMIé€šä¿¡æ¡†æ¶/0.png" alt="1532605493344"></p><h3 id="RMI"><a href="#RMI" class="headerlink" title="RMI"></a>RMI</h3><p>RMI(remote method invocation)  , å¯ä»¥è®¤ä¸ºæ˜¯RPCçš„javaç‰ˆæœ¬ </p><p>RMIä½¿ç”¨çš„æ˜¯JRMPï¼ˆJava Remote Messageing Protocolï¼‰, JRMPæ˜¯ä¸“é—¨ä¸ºjavaå®šåˆ¶çš„é€šä¿¡åè®®ï¼Œæ‰€ä»¥ä»–æ˜¯çº¯javaçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ ã€‚</p><h4 id="RMI-Demo"><a href="#RMI-Demo" class="headerlink" title="RMI Demo"></a>RMI Demo</h4><ol><li>å…ˆå†™ä¸ªæµ‹è¯•ç”¨çš„è¿œç¨‹æ¥å£ï¼Œæ³¨æ„æ¥å£è¦æŠ›å¼‚å¸¸</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ISayHello</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">satHello</span><span class="params">(String name)</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>2.å®ç°è¿œç¨‹æ¥å£ï¼Œå¹¶ä¸”ç»§æ‰¿ï¼š`UnicastRemoteObject`</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SayHelloImpl</span> <span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">ISayHello</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SayHelloImpl</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">satHello</span><span class="params">(String name)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello,"</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>3.åˆ›å»ºæœåŠ¡å™¨ç¨‹åºï¼š `createRegistry`æ–¹æ³•æ³¨å†Œè¿œç¨‹å¯¹è±¡</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.AlreadyBoundException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ISayHello sayHello =<span class="keyword">new</span> SayHelloImpl();</span><br><span class="line">            LocateRegistry.createRegistry(<span class="number">8888</span>);</span><br><span class="line">            Naming.bind(<span class="string">"rmi://localhost:8888/sayhello"</span>,sayHello);</span><br><span class="line">            System.out.println(<span class="string">"server start success"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AlreadyBoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><pre><code>4.åˆ›å»ºå®¢æˆ·ç«¯ç¨‹åº</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ISayHello iSayHello = (ISayHello) Naming.lookup(<span class="string">"rmi://localhost:8888/sayhello"</span>);</span><br><span class="line">            System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NotBoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RMIè°ƒç”¨è¿‡ç¨‹"><a href="#RMIè°ƒç”¨è¿‡ç¨‹" class="headerlink" title="RMIè°ƒç”¨è¿‡ç¨‹"></a>RMIè°ƒç”¨è¿‡ç¨‹</h4><p><img src="/2018/07/26/RMIé€šä¿¡æ¡†æ¶/1.png" alt="1532610569381"></p><p><strong>æµç¨‹ï¼š</strong></p><p>1.å»æ³¨å†Œä¸­å¿ƒæ³¨å†Œï¼Œserverç«¯å¯åŠ¨æœåŠ¡ã€‚</p><p>2.æ³¨å†Œä¸­å¿ƒè”ç³»stubï¼ˆå­˜æ ¹ï¼‰ã€‚stubç”¨äºå®¢æˆ·ç«¯ ï¼Œåœ¨j2eeä¸­æ˜¯è¿™ä¹ˆè¯´çš„ï¼šä¸ºå±è”½å®¢æˆ·è°ƒç”¨è¿œç¨‹ä¸»æœºä¸Šçš„å¯¹è±¡ï¼Œå¿…é¡»æä¾›æŸç§æ–¹å¼æ¥æ¨¡æ‹Ÿæœ¬åœ°å¯¹è±¡,è¿™ç§æœ¬åœ°å¯¹è±¡ç§°ä¸ºå­˜æ ¹(stub),å­˜æ ¹è´Ÿè´£æ¥æ”¶æœ¬åœ°æ–¹æ³•è°ƒç”¨,å¹¶å°†å®ƒä»¬å§”æ´¾ç»™å„è‡ªçš„å…·ä½“å®ç°å¯¹è±¡ </p><p>3.serveræ³¨å†Œå¯¹è±¡ï¼Œç„¶åè¿”å›æ³¨å†Œå¯¹è±¡</p><p>4.å®¢æˆ·ç«¯è®¿é—®æ³¨å†Œä¸­å¿ƒï¼Œï¼ˆåŠ¨æ€ä»£ç†ï¼‰è¿”å›stubå¯¹è±¡</p><p>5.stubï¼ˆå­˜æ ¹ï¼‰è¿œç¨‹è°ƒç”¨skeleton ï¼ˆéª¨æ¶ ï¼‰</p><p>6.skeleton è°ƒç”¨ç›¸åº”æ¥å£</p><p><img src="/2018/07/26/RMIé€šä¿¡æ¡†æ¶/2.png" alt="1532610883598"></p><h4 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h4><p>è®©æˆ‘çœ‹çœ‹æ ¸å¿ƒçš„æ³¨å†ŒæœåŠ¡çš„æºç å®ç°</p><p><img src="/2018/07/26/RMIé€šä¿¡æ¡†æ¶/3.png" alt="1532612686999"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">RegistryImpl</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> var1)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bindings = <span class="keyword">new</span> Hashtable(<span class="number">101</span>);</span><br><span class="line">    <span class="comment">//å®‰å…¨è®¤è¯</span></span><br><span class="line">        <span class="keyword">if</span> (var1 == <span class="number">1099</span> &amp;&amp; System.getSecurityManager() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedExceptionAction&lt;Void&gt;() &#123;</span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Void <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">                        LiveRef var1x = <span class="keyword">new</span> LiveRef(RegistryImpl.id, var1);</span><br><span class="line">                        RegistryImpl.<span class="keyword">this</span>.setup(<span class="keyword">new</span> UnicastServerRef(var1x, (var0) -&gt; &#123;</span><br><span class="line">                            <span class="keyword">return</span> RegistryImpl.registryFilter(var0);</span><br><span class="line">                        &#125;));</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, (AccessControlContext)<span class="keyword">null</span>, <span class="keyword">new</span> SocketPermission(<span class="string">"localhost:"</span> + var1, <span class="string">"listen,accept"</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (PrivilegedActionException var3) &#123;</span><br><span class="line">                <span class="keyword">throw</span> (RemoteException)var3.getException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//åˆå§‹åŒ–è¿œç¨‹å¼•ç”¨UnicastServerRefå¯¹è±¡</span></span><br><span class="line">            LiveRef var2 = <span class="keyword">new</span> LiveRef(id, var1);<span class="comment">//ã€Š--------------------------</span></span><br><span class="line">            <span class="keyword">this</span>.setup(<span class="keyword">new</span> UnicastServerRef(var2, RegistryImpl::registryFilter));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç‚¹è¿›UnicastServerRefï¼Œæ‰¾å‡ºå®ç°çš„å…³ç³»~</p><p><img src="/2018/07/26/RMIé€šä¿¡æ¡†æ¶/4.png" alt="1532613044628"></p><p>ç‚¹è¿›setupæ–¹æ³•ï¼Œç”¨ideaåç¼–ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Remote <span class="title">exportObject</span><span class="params">(Remote var1, Object var2, <span class="keyword">boolean</span> var3)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        Class var4 = var1.getClass();</span><br><span class="line"></span><br><span class="line">        Remote var5;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            var5 = Util.createProxy(var4, <span class="keyword">this</span>.getClientRef(), <span class="keyword">this</span>.forceStubUse);<span class="comment">//ã€Š--------------------</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException var7) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ExportException(<span class="string">"remote object implements illegal remote interface"</span>, var7);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (var5 <span class="keyword">instanceof</span> RemoteStub) &#123;<span class="comment">//ã€Š--------------------------</span></span><br><span class="line">            <span class="keyword">this</span>.setSkeleton(var1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Target var6 = <span class="keyword">new</span> Target(var1, <span class="keyword">this</span>, var5, <span class="keyword">this</span>.ref.getObjID(), var3);<span class="comment">//ã€Š------------------------</span></span><br><span class="line">        <span class="keyword">this</span>.ref.exportObject(var6);</span><br><span class="line">        <span class="keyword">this</span>.hashToMethod_Map = (Map)hashToMethod_Maps.get(var4);</span><br><span class="line">        <span class="keyword">return</span> var5;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å‘ç°åœ¨åˆ›å»ºä»£ç†ï¼Œåˆ¤æ–­å½“å‰çš„varæ˜¯ä¸æ˜¯è¿œç¨‹stubï¼Œå¦‚æœæ˜¯å°±è®¾ç½®éª¨æ¶ã€‚å¦‚æœä¸æ˜¯ï¼Œå°±æ„å»ºtargetå¯¹è±¡ã€‚ç‚¹å¼€ä»£ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Remote <span class="title">createProxy</span><span class="params">(Class&lt;?&gt; var0, RemoteRef var1, <span class="keyword">boolean</span> var2)</span> <span class="keyword">throws</span> StubNotFoundException </span>&#123;</span><br><span class="line">        Class var3;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            var3 = getRemoteClass(var0);<span class="comment">//ã€Š--------------------------</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var9) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> StubNotFoundException(<span class="string">"object does not implement a remote interface: "</span> + var0.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (var2 || !ignoreStubClasses &amp;&amp; stubClassExists(var3)) &#123;</span><br><span class="line">            <span class="keyword">return</span> createStub(var3, var1);<span class="comment">//ã€Š--------------------------</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> ClassLoader var4 = var0.getClassLoader();</span><br><span class="line">            <span class="keyword">final</span> Class[] var5 = getRemoteInterfaces(var0);</span><br><span class="line">            <span class="keyword">final</span> RemoteObjectInvocationHandler var6 = <span class="keyword">new</span> RemoteObjectInvocationHandler(var1);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> (Remote)AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;Remote&gt;() &#123;</span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Remote <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> (Remote)Proxy.newProxyInstance(var4, var5, var6);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalArgumentException var8) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> StubNotFoundException(<span class="string">"unable to create proxy"</span>, var8);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å‘ç°åœ¨è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œç„¶ååˆ›å»ºäº†stubã€‚ç»§ç»­ç‚¹å¼€getRemoteClassï¼ˆï¼‰æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Class&lt;?&gt; getRemoteClass(Class&lt;?&gt; var0) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">       <span class="keyword">while</span>(var0 != <span class="keyword">null</span>) &#123;</span><br><span class="line">           Class[] var1 = var0.getInterfaces();<span class="comment">//ã€Š--------------------------</span></span><br><span class="line"></span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">int</span> var2 = var1.length - <span class="number">1</span>; var2 &gt;= <span class="number">0</span>; --var2) &#123;</span><br><span class="line">               <span class="keyword">if</span> (Remote.class.isAssignableFrom(var1[var2])) &#123;</span><br><span class="line">                   <span class="keyword">return</span> var0;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           var0 = var0.getSuperclass();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(<span class="string">"class does not implement java.rmi.Remote"</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å‘ç°ç°åœ¨åœ¨åˆ›å»ºå®ä¾‹</p><p>å¥½å§ï¼Œå›åˆ°createProxyæ–¹æ³•ï¼Œå†çœ‹çœ‹é¡ºç€å¾€ä¸‹èµ°ï¼Œçœ‹çœ‹<code>Target var6 = new Target(var1, this, var5, this.ref.getObjID(), var3);</code><br>        <code>this.ref.exportObject(var6);</code>çš„å‡ºå£å¯¹è±¡æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exportObject</span><span class="params">(Target var1)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ep.exportObject(var1);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Endpoint</span> </span>&#123;</span><br><span class="line">    <span class="function">Channel <span class="title">getChannel</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exportObject</span><span class="params">(Target var1)</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Transport <span class="title">getInboundTransport</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Transport <span class="title">getOutboundTransport</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exportObject</span><span class="params">(Target var1)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transport.exportObject(var1);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸€è·¯ç‚¹ä¸‹å»ï¼Œæ‰¾åˆ°äº†tcpå‡ºå£çš„æ–¹æ³•ã€‚è¿™æ˜¯å±äºåè®®å±‚çš„ç©æ„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exportObject</span><span class="params">(Target var1)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.listen();</span><br><span class="line">            ++<span class="keyword">this</span>.exportCount;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>ä¸€è·¯ç‚¹ä¸‹å»ï¼Œå‘ç°listenã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">listen</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        <span class="keyword">assert</span> Thread.holdsLock(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        TCPEndpoint var1 = <span class="keyword">this</span>.getEndpoint();</span><br><span class="line">        <span class="keyword">int</span> var2 = var1.getPort();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.server == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (tcpLog.isLoggable(Log.BRIEF)) &#123;</span><br><span class="line">                tcpLog.log(Log.BRIEF, <span class="string">"(port "</span> + var2 + <span class="string">") create server socket"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.server = var1.newServerSocket();<span class="comment">//ã€Š--------------------------</span></span><br><span class="line">                Thread var3 = (Thread)AccessController.doPrivileged(<span class="keyword">new</span> NewThreadAction(<span class="keyword">new</span> TCPTransport.AcceptLoop(<span class="keyword">this</span>.server), <span class="string">"TCP Accept-"</span> + var2, <span class="keyword">true</span>));</span><br><span class="line">                var3.start();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (BindException var4) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ExportException(<span class="string">"Port already in use: "</span> + var2, var4);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException var5) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ExportException(<span class="string">"Listen failed on port: "</span> + var2, var5);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            SecurityManager var6 = System.getSecurityManager();</span><br><span class="line">            <span class="keyword">if</span> (var6 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                var6.checkListen(var2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>å‘ç°newServerSocketï¼ï¼ï¼</p><p>ç»¼ä¸Šï¼Œæ€»ä½“æµç¨‹å’Œä¸Šå›¾ä¸€æ ·ã€‚</p><h4 id="RMIç¼ºé™·"><a href="#RMIç¼ºé™·" class="headerlink" title="RMIç¼ºé™·"></a>RMIç¼ºé™·</h4><p>1.åŸºäºjavaï¼Œæ”¯æŒè¯­è¨€å•ä¸€</p><p>2.æœåŠ¡æ³¨å†Œåªèƒ½æ³¨å†Œåˆ°æˆ‘ä¸Šé¢åˆ†æçš„é‚£ä¸ªæºç ã€‚æ³¨å†Œä¸­å¿ƒæŒ‚äº†ä»¥åå°±å®Œäº†</p><p>3.åºåˆ—åŒ–æ˜¯ç”¨javaåŸç”Ÿé‚£ä¸ªæ–¹æ³•ï¼Œæ•ˆç‡ä¸å¥½</p><p>4.æœåŠ¡ç«¯åº•å±‚æ˜¯bioæ–¹å¼ï¼Œæ€§èƒ½ä¸å¥½</p><h4 id="æ‰‹å†™ä¸ªRMIï¼Ÿ"><a href="#æ‰‹å†™ä¸ªRMIï¼Ÿ" class="headerlink" title="æ‰‹å†™ä¸ªRMIï¼Ÿ"></a>æ‰‹å†™ä¸ªRMIï¼Ÿ</h4><p>æ­¥éª¤ï¼š</p><ol><li><p>ç¼–å†™æœåŠ¡å™¨ç¨‹åºï¼Œæš´éœ²ä¸€ä¸ªç›‘å¬ï¼Œ å¯ä»¥ä½¿ç”¨socket</p></li><li><p>ç¼–å†™å®¢æˆ·ç«¯ç¨‹åºï¼Œé€šè¿‡ipå’Œç«¯å£è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”å°†æ•°æ®åšå°è£…ï¼ˆåºåˆ—åŒ–ï¼‰</p></li><li><p>æœåŠ¡å™¨ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œå…ˆååºåˆ—åŒ–ã€‚å†è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚æŠŠè¿”å›ç»“æœåºåˆ—åŒ–è¿”å›</p></li></ol><p>æºç ï¼š<a href="https://github.com/tengshe789/ForRMI" target="_blank" rel="noopener">https://github.com/tengshe789/ForRMI</a></p><p>æŠŠæºç å‘å¸ƒåˆ°GitHubäº†ï¼Œåœ¨æŠŠæºç ç²˜è´´å¤ªéº»çƒ¦äº†ã€‚</p><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œç¼˜åˆ†å‘¢å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹~  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åˆ†å¸ƒå¼æ¡†æ¶æ˜¯æœ€è¿‘å‡ å¹´çš„çƒ­é—¨ã€‚å¯æ˜¯è¦æƒ³ç†è§£åˆ†å¸ƒå¼æ¡†æ¶ç€å®ä¸æ˜“ï¼Œä¸ºäº†åŠªåŠ›è·Ÿä¸Šæ—¶ä»£æ½®æµï¼Œç‰¹æ­¤å¼€äº†ä¸€ä¸ªä¸“é¢˜ï¼Œèµ·åâ€œæˆ‘è¦å­¦å¥½åˆ†å¸ƒå¼â€ï¼Œé€šè¿‡åšå®¢æ¥åˆ†äº«ä¸€ä¸‹æˆ‘çš„å­¦ä¹ è¿‡ç¨‹ï¼ŒåŠ æ·±æˆ‘å¯¹åˆ†å¸ƒå¼æ•´ä½“æ¡†æ¶çš„ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.t
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="å­¦å¥½åˆ†å¸ƒå¼æ¶æ„" scheme="https://tengshe789.github.io/tags/%E5%AD%A6%E5%A5%BD%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/"/>
    
      <category term="ç½‘ç»œ" scheme="https://tengshe789.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>å…³æ‰X5å†…æ ¸è®©å¾®ä¿¡å˜å¾—é£å¿«~</title>
    <link href="https://tengshe789.github.io/2018/07/26/%E5%85%B3%E6%8E%89X5%E5%86%85%E6%A0%B8%E8%AE%A9%E5%BE%AE%E4%BF%A1%E5%8F%98%E5%BE%97%E9%A3%9E%E5%BF%AB/"/>
    <id>https://tengshe789.github.io/2018/07/26/å…³æ‰X5å†…æ ¸è®©å¾®ä¿¡å˜å¾—é£å¿«/</id>
    <published>2018-07-26T03:49:23.000Z</published>
    <updated>2019-11-20T13:39:41.173Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æˆ‘æ¢æ‰‹æœºäº†ã€‚ã€‚ã€‚</p><p>ä»¥å‰çš„å°S8å–æ‰äº†ï¼ˆæ—¥å¸¸æ“ä½œğŸ˜ï¼‰ç­‰ä»·æ¢äº†ä¸ªğŸ‘‡</p><p><img src="/2018/07/26/å…³æ‰X5å†…æ ¸è®©å¾®ä¿¡å˜å¾—é£å¿«/1532577045218.png" alt="mix2S"></p><p>æ–°æ‰‹æœºæµ‹è¯•å®ŒåŠŸèƒ½ï¼Œä¸‹å¥½å¾®ä¿¡ä»¥åï¼Œå‘ç°æµè§ˆæŠ€æœ¯å…¬ä¼—å·æ¯”è€æ‰‹æœºæ…¢äº†å¾ˆå¤šï¼Œçº³é—·ã€‚åæ¥æ‰æƒ³åˆ°å¿˜äº†æ¢å†…æ ¸äº†ã€‚</p><h3 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><p><a href="https://developer.android.google.cn/reference/android/webkit/WebView.html" target="_blank" rel="noopener"><strong>WebView</strong></a> æ˜¯Androidå¼€å‘ä¸­ç»å¸¸ä¼šç”¨åˆ°çš„åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªåŸºäºwebkitå¼•æ“ï¼Œç”¨äºæ˜¾ç¤ºæ¥è‡ªæœ¬åœ°ã€æœåŠ¡å™¨webé¡µé¢çš„æ§ä»¶ï¼Œå¯ä»¥å¾ˆå¥½çš„æå‡åº”ç”¨æ‰©å±•æ€§ã€‚æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>å¯ä»¥ç›´æ¥æ˜¾ç¤ºå’Œæ¸²æŸ“webé¡µé¢</li><li>webviewå¯ä»¥ç›´æ¥ç”¨htmlæ–‡ä»¶ï¼ˆç½‘ç»œä¸Šæˆ–æœ¬åœ°assetsä¸­ï¼‰ä½œå¸ƒå±€</li><li>å’ŒJavaScriptäº¤äº’è°ƒç”¨</li></ul><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†webviewæ›´æ–°åˆ°æœ€æ–°ã€‚</p><p><img src="/2018/07/26/å…³æ‰X5å†…æ ¸è®©å¾®ä¿¡å˜å¾—é£å¿«/QQå›¾ç‰‡20180726142634.png" alt=""></p><p>ç„¶åæ‰“å¼€å¾®ä¿¡ï¼Œåœ¨ä»»æ„èŠå¤©ç•Œé¢ï¼Œè¾“å…¥ debugtbs.qq.com  </p><p><img src="/2018/07/26/å…³æ‰X5å†…æ ¸è®©å¾®ä¿¡å˜å¾—é£å¿«/QQå›¾ç‰‡20180726142746.png" alt=""></p><p>ç‚¹å‡»ç¦ç”¨å†…æ ¸ï¼Œé‡å¯å¾®ä¿¡åï¼Œåœ¨ç‚¹å‡»æ¸…é™¤tbs</p><p>æ“ä½œå®Œæˆï¼Œç»“æŸï¼</p><p>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œç¼˜åˆ†å‘¢å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹~  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;æˆ‘æ¢æ‰‹æœºäº†ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥å‰çš„å°S8å–æ‰äº†ï¼ˆæ—¥å¸¸æ“ä½œğŸ˜ï¼‰ç­‰ä»·æ¢äº†ä¸ªğŸ‘‡&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2018/07/26/
      
    
    </summary>
    
    
      <category term="çªé—¨" scheme="https://tengshe789.github.io/tags/%E7%AA%8D%E9%97%A8/"/>
    
  </entry>
  
  <entry>
    <title>å®‰åˆ©è½¯ä»¶-å¦‚ä½•åœ¨Windowsè°ƒæ•´å¤šæ ¸å¿ƒCPUè´Ÿè½½å¹¶ä¼˜åŒ–ï¼Ÿ</title>
    <link href="https://tengshe789.github.io/2018/07/25/%E6%95%99%E4%BD%A0%E5%A6%82%E4%BD%95%E5%9C%A8Winddows%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%A4%9A%E6%A0%B8%E5%BF%83CPU%E8%B4%9F%E8%BD%BD%E4%BC%98%E5%8C%96/"/>
    <id>https://tengshe789.github.io/2018/07/25/æ•™ä½ å¦‚ä½•åœ¨Winddowsç¯å¢ƒä¸‹å¤šæ ¸å¿ƒCPUè´Ÿè½½ä¼˜åŒ–/</id>
    <published>2018-07-25T02:22:46.000Z</published>
    <updated>2019-11-20T13:39:41.535Z</updated>
    
    <content type="html"><![CDATA[<p><code>hexo</code>ä¸çŸ¥é“å’‹åœ°äº†ï¼Œ<code>markdown</code>è½¬<code>html</code>ç”Ÿæˆé™æ€èµ„æºçš„æ—¶å€™ï¼Œå›¾ç‰‡å®Œå…¨ä¸å†™è¿›<code>html</code>ï¼Œå‰é¢å‡ ç¯‡æºç åˆ†æçš„å›¾å…¨æ˜¾ç¤ºä¸å‡ºæ¥äº†ã€‚è„‘é˜”ç–¼~</p><p>ç”±äºæš‚æ—¶æ²¡æœ‰è§£å†³é™æ€èµ„æºçš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘æœ¬ç¯‡ä¸æ”¾å›¾ï¼Œæ¥ä¸€åœºæ²¡æœ‰ç¡çƒŸçš„æˆ˜äº‰ã€‚æˆ‘ä¼šå°½é‡è®©æ­¤æ–‡ç« é€šä¿—æ˜“æ‡‚ï¼Œå¾…æˆ‘è§£å†³é—®é¢˜æ—¶ï¼Œå†é‡æ–°ç¼–è¾‘ä¸€ä¸‹ï¼ˆ<strong>åæ­£è¿™ä¸ªåšå®¢æ²¡äººçœ‹</strong>ï¼‰ã€‚</p><p>ä»Šå¤©æˆ‘æ¥åˆ†äº«ä¸€ä¸ªè½¯ä»¶ï¼Œåå­—æ˜¯<code>Process Lasso Pro</code>ã€‚è¿™ä¸ªè½¯ä»¶çš„ä½œç”¨æ˜¯ä¼˜åŒ–è¿›ç¨‹è°ƒåº¦ï¼Œé™ä½é«˜CPUå ç”¨ç‡è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä¿è¯å‰å°è¿›ç¨‹å’Œç³»ç»Ÿæ‹¥æœ‰æœ€é«˜çš„å“åº”é€Ÿåº¦ï¼Œç®€å•è¯´å°±æ˜¯å°½å¯èƒ½ä¿è¯ç”µè„‘åœ¨é«˜CPUå ç”¨ç‡çš„æƒ…å†µä¸å¡ã€‚æ³¨æ„ï¼Œè½¯ä»¶å¦‚æœæ˜¯å®¶ç”¨å°±æ˜¯å…è´¹çš„ï¼Œä¸“ä¸šç‰ˆæœ‰é«˜çº§åŠŸèƒ½ï¼Œä¸è¿‡åŸºæœ¬ç”¨ä¸åˆ°ã€‚ </p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h3 id="ä¸»è¦ç‰¹æ€§"><a href="#ä¸»è¦ç‰¹æ€§" class="headerlink" title="ä¸»è¦ç‰¹æ€§"></a>ä¸»è¦ç‰¹æ€§</h3><p>å…ˆæ¥çœ‹çœ‹å®˜æ–¹å‘çš„äº§å“ç‰¹æ€§ã€‚</p><ul><li><p><code>ProBalance</code>ï¼šå®‰å…¨æœ‰æ•ˆåœ°å¹³è¡¡è¿›ç¨‹ä¼˜å…ˆçº§ï¼Œä»è€Œä½¿ç”µè„‘åœ¨é«˜è´Ÿè·çš„æ—¶å€™æé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œé˜²æ­¢ç³»ç»Ÿå¤±é€Ÿå’Œååº”æ»åã€‚æˆ‘ä»¬çš„æŠ€æœ¯å¹¶ä¸åšé¢å¤–çš„å‰å°æ¨è¿›è€Œæ˜¯é€‚å½“é™ä½äº†åå°è¿›ç¨‹ä¼˜å…ˆçº§ã€‚æˆ‘ä»¬å¤šå¹´çš„ç»éªŒä½¿æˆ‘ä»¬çš„ç®—æ³•é«˜åº¦ä¼˜åŒ–ã€ç‹¬ä¸€æ— äºŒã€‚  </p></li><li><p>æŒä¹…çš„ä¼˜å…ˆçº§å’Œäº²å’ŒåŠ›ï¼šä¸ºæ‚¨çš„è¿›ç¨‹è®¾ç½®â€œé»˜è®¤â€çš„ä¼˜å…ˆçº§å’Œ<code>CPU</code>äº²å’ŒåŠ›ï¼Œè®©æ‚¨å¯ä»¥è°ƒæ•´å®ƒä»¬çš„æ‰§è¡Œæ–¹å¼ã€‚  </p></li><li><p>è‡ªåŠ¨ç»ˆæ­¢ï¼šå¯¹äºæ‚¨æ‰€é€‰æ‹©çš„ç‰¹å®šè¿›ç¨‹ï¼Œå®ƒä¸€æ—¦è¿è¡Œï¼Œ<code>Process Lasso</code>å°†è‡ªåŠ¨ç»ˆæ­¢å®ƒã€‚  </p></li><li><p>è¿›ç¨‹çœ‹å®ˆï¼šå½“è¾¾åˆ°æŒ‡å®šçš„é˜ˆå€¼çš„æ—¶å€™ï¼Œå°†ç»ˆæ­¢ã€é‡æ–°å¯åŠ¨æˆ–æ›´æ”¹<code>CPU</code>äº²å’ŒåŠ›ã€‚  </p></li><li><p>å®ä¾‹æ•°é‡é™åˆ¶ï¼šå°†è¿›ç¨‹å®ä¾‹æ•°é‡é™åˆ¶åœ¨æŒ‡å®šçš„èŒƒå›´å†…ã€‚  </p></li><li><p>å¤šæ ¸ä¼˜åŒ–ï¼šé€šè¿‡é¢„è®¾çš„<code>CPU</code>äº²å’ŒåŠ›å’Œ<code>ProBalance</code>äº²å’ŒåŠ›çš„è°ƒæ•´ï¼Œå¯ä»¥ä¼˜åŒ–å¤šæ ¸å¤„ç†å™¨ï¼Œæé«˜<code>CPU</code>è¿è¡Œæ•ˆç‡ã€‚å®ƒè¿˜é¿å…ä½¿ç”¨é€»è¾‘æ ¸å¿ƒï¼Œä»è€Œåœ¨è¶…çº¿ç¨‹<code>CPU</code>ä¸‹æé«˜æé«˜æŸäº›åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚ </p></li><li><p><code>I/O</code>ä¼˜å…ˆçº§ï¼š<code>Windows Vista</code>åŠ<code>Windows 7</code>ä¸‹å¯ä»¥è®¾ç½®è¿›ç¨‹çš„å½“å‰çš„/é»˜è®¤çš„/æŒç»­çš„I / Oä¼˜å…ˆçº§  ç”µæºæ¨¡å¼è‡ªåŠ¨åŒ–ï¼šè®¾ç½®ç”µæºæ¨¡å¼ï¼Œå½“æŸäº›è¿›ç¨‹æ­£åœ¨è¿è¡Œæ—¶è‡ªåŠ¨æ›´æ”¹ä¸ºâ€œé«˜æ€§èƒ½â€ï¼Œå½“è¿›ç¨‹é€€å‡ºåå†æ¢åˆ°åŸå…ˆçš„æ¨¡å¼ï¼ˆè¾ƒæ–°ç‰ˆæœ¬åŠŸèƒ½æ›´å¼ºå¤§ï¼Œå¯ä»¥æ›´æ”¹åˆ°ä»»ä½•ç”µæºæ¨¡å¼ï¼‰ã€‚</p></li><li><p>èŠ‚çº¦ç”µèƒ½ï¼šæˆ–å½“éœ€è¦æ—¶æé«˜æ€§èƒ½ï¼  </p></li><li><p>ç³»ç»Ÿå“åº”æ ‡ï¼šæˆ‘ä»¬å°†ä»¥ç‹¬ç‰¹çš„ç®—æ³•ï¼Œä»¥æƒŠäººçš„å‡†ç¡®ç‡ç›‘æµ‹ç³»ç»Ÿå“åº”  ç‹¬ç«‹çš„æ ¸å¿ƒå¼•æ“ï¼šè¿™ä¸ªç‹¬ç«‹çš„åå°è¿›ç¨‹å¯ä»¥ä¸€ä¸ªæ™®é€šçš„è¿‡ç¨‹æˆ–æœåŠ¡å½¢å¼è¿è¡Œã€‚è¿™ä¸ªâ€œæ ¸å¿ƒå¼•æ“â€è¢«å‘½å <code>ProcessGovernor.exe</code>ï¼Œå®ƒå®é™…ä¸Šå¯ä»¥å¼ºåˆ¶æ‰§è¡Œè¿›ç¨‹è§„åˆ™å’Œ<code>ProBalance</code>ã€‚å®ƒæ ¹æœ¬ä¸éœ€è¦<code>GUI</code>ï¼ˆä¸»çª—å£ï¼‰çš„å­˜åœ¨ã€‚è¿™å¯ä»¥å®ç°æœ€å°çš„èµ„æºåˆ©ç”¨ç‡ã€‚  </p></li><li><p>æœ€å°çš„èµ„æºåˆ©ç”¨ï¼šåœ¨å®ç°æœ€å°çš„èµ„æºåˆ©ç”¨æ–¹é¢ï¼Œæ²¡æœ‰ä»»ä½•ä¸€ä¸ªç¨‹åºå¯ä»¥ä¸<code>Process Lasso</code>ç›¸æ¯”ã€‚å®ƒæ˜¯ç”¨åŸç”Ÿçš„C + +ç¼–å†™çš„ï¼Œå¹¶ä¸æ–­æ”¹è¿›ä»¥è·å¾—æœ€å¤§çš„æ•ˆç‡ã€‚æˆ‘ä»¬ä¹Ÿæä¾›åŸç”Ÿçš„64ä½ç‰ˆæœ¬ã€‚æœ¬ç¨‹åºçš„å†…å­˜ä½¿ç”¨é‡é€šå¸¸åœ¨1MBä»¥ä¸‹ï¼ï¼ˆä¾ç³»ç»Ÿè€Œå®šï¼‰ </p></li></ul><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>é¦–å…ˆï¼Œé€‰æ‹©X64å®‰è£…åŒ…ï¼Œä¸€è·¯<code>next</code>åˆ°åº•ã€‚</p><p><img src="/2018/07/25/æ•™ä½ å¦‚ä½•åœ¨Winddowsç¯å¢ƒä¸‹å¤šæ ¸å¿ƒCPUè´Ÿè½½ä¼˜åŒ–/0.png" alt="1532653358360"></p><h3 id="GUIä½¿ç”¨"><a href="#GUIä½¿ç”¨" class="headerlink" title="GUIä½¿ç”¨"></a>GUIä½¿ç”¨</h3><p>å®‰è£…å®Œæ¯•ï¼Œåœ¨ä¸»ç•Œé¢ä¸Šï¼Œå¯ä»¥çœ‹åˆ°å½“å‰æ‰€æœ‰çš„æ´»åŠ¨è¿›ç¨‹ï¼Œè¿™ä¸ªå’Œç³»ç»Ÿçš„èµ„æºç®¡ç†å™¨å¾ˆç›¸ä¼¼ã€‚<code>Process Lasso</code>åœ¨é»˜è®¤è®¾ç½®ä¸‹å·²ç»å¯ä»¥ç”Ÿæ•ˆï¼Œå®ƒä¼šç›‘è§†åå°è¿›ç¨‹ï¼Œå¦‚æœæŸä¸ªè¿›ç¨‹è¶…è¿‡äº†CPUå ç”¨ç‡çš„é˜ˆå€¼ï¼Œå°±ä¼šå¯¹ä»–è¿›è¡Œé™åˆ¶ï¼Œé™ä½CPUå¯¹è¿™ä¸ªè¿›ç¨‹çš„å“åº”ä¼˜å…ˆçº§ï¼Œè®©<code>CPU</code>ç€åŠ›äºå‰å°è¿›ç¨‹ï¼ˆå¦‚æ¸¸æˆç­‰ï¼‰ã€‚ </p><p><img src="/2018/07/25/æ•™ä½ å¦‚ä½•åœ¨Winddowsç¯å¢ƒä¸‹å¤šæ ¸å¿ƒCPUè´Ÿè½½ä¼˜åŒ–/1.png" alt="1532653454662"></p><p>å³å‡»è¾ƒä¸ºå <code>CPU</code>ä½¿ç”¨æ—¶é—´çš„æ¸¸æˆã€è§†é¢‘ç­‰çš„è¿›ç¨‹ï¼Œå‹¾é€‰â€œå½’ç±»ä¸ºæ¸¸æˆæˆ–å¤šåª’ä½“è¿›ç¨‹â€ ã€‚è¿™æ—¶ï¼Œ<code>Process Lasso</code>ä¼šæ’é™¤å¯¹è¿™ä¸ªè¿›ç¨‹çš„â€œæŠ‘åˆ¶â€ï¼Œå¹¶åœ¨è¿è¡Œè¿™ä¸ªè¿›ç¨‹æ—¶è°ƒèŠ‚ç”µæºæ–¹æ¡ˆä¸ºâ€œé«˜æ€§èƒ½â€ï¼Œå……åˆ†è°ƒåŠ¨<code>CPU</code>èµ„æºã€‚ </p><p><img src="/2018/07/25/æ•™ä½ å¦‚ä½•åœ¨Winddowsç¯å¢ƒä¸‹å¤šæ ¸å¿ƒCPUè´Ÿè½½ä¼˜åŒ–/2.png" alt="1532653515949"></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œé‡ç‚¹å°±æ˜¯ä¼˜åŒ–å¤šæ ¸å¿ƒ<code>CPU</code>çš„åˆ©ç”¨ç‡äº†ï¼Œè¿˜æ˜¯å³é”®å•å‡»è¦ä¼˜åŒ–æ‰§è¡Œçš„è¿›ç¨‹ï¼Œé€‰ä¸­â€œ<code>CPU</code>äº²å’ŒåŠ›ï¼ˆé™åˆ¶CPUä½¿ç”¨ï¼‰â€“&gt;æ€»æ˜¯â€“&gt;é€‰æ‹©<code>CPU</code>äº²å’ŒåŠ›â€ï¼ŒæŒ‰ç…§è‡ªå·±çš„éœ€æ±‚å‹¾é€‰éœ€è¦ä½¿ç”¨çš„<code>CPU</code>æ ¸å¿ƒ(ä¸€èˆ¬æ¥è¯´ï¼Œ<code>CPU 0</code>æ€§èƒ½æœ€å¼ºï¼Œ<code>CPU 1</code>æ€§èƒ½ç¬¬äºŒå¼ºâ€¦â€¦.<code>CPU n</code>æ€§èƒ½æœ€å¼±)ï¼Œè¿™æ ·è¿™ä¸ªè¿›ç¨‹å…³é—­åå†è¿è¡Œä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªè®¾ç½®è°ƒç”¨<code>CPU</code>èµ„æºã€‚ </p><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol><li>ä¸æ¨èå¯¹<code>Process Lasso</code>è‡ªèº«/å®‰å…¨è½¯ä»¶/æ€æ¯’è½¯ä»¶/ç³»ç»Ÿå…³é”®æœåŠ¡è¿›ç¨‹ç­‰è¿›è¡Œç»“æŸè¿›ç¨‹ã€é™ä½å†…å­˜æˆ–<code>I/O</code>ä¼˜å…ˆçº§è‡³éå¸¸ä½ã€ç¡¬èŠ‚æµç­‰æ“ä½œï¼Œä¸”éƒ¨åˆ†æ€æ¯’ã€å®‰å…¨è½¯ä»¶æœ‰è‡ªæˆ‘ä¿æŠ¤åŠŸèƒ½ï¼Œç»“æŸè¿›ç¨‹ã€<code>CPU</code>ä¼˜å…ˆçº§ã€<code>I/O</code>ä¼˜å…ˆçº§ ç½®å¯èƒ½ä¼šå¤±æ•ˆ</li><li>èœå•-&gt;é€‰é¡¹-&gt;æ—¥å¿—è®¾ç½®-&gt;å‹¾é€‰â€œé€€å‡ºæ—¶æ¸…é™¤æ—¥å¿—â€â€œä¿æŒæ—¥å¿—ä¿®å‰ªâ€å¯ä»¥æœ‰æ•ˆé™ä½æ—¥å¿—æ•°é‡</li><li>å»ºè®®ä¿æŒ<code>Process Lasso</code>å¼€æœºå¯åŠ¨(åŒ…æ‹¬æœåŠ¡)ï¼Œéƒ¨åˆ†å¼€æœºåŠ é€Ÿä¼˜åŒ–è½¯ä»¶ä¼šç¦æ­¢<code>Process Lasso</code>å¯åŠ¨ï¼Œè¿™å°†å¯¼è‡´<code>Process Lasso</code>æ— æ³•å®æ—¶ä¼˜åŒ–ç³»ç»Ÿ</li><li><code>Process Lasso</code>åœ¨ç•Œé¢è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œç”±äºæœ‰å¤§é‡ä¿¡æ¯éœ€è¦è·å–å¹¶å®æ—¶æ˜¾ç¤ºï¼Œå¯èƒ½ä¼šçœ‹åˆ°<code>Process Lasso</code>å›¾å½¢ç•Œé¢æˆ–æ ¸å¿ƒå¼•æ“è¿›ç¨‹<code>CPU</code>ä½¿ç”¨ç‡è¾¾åˆ°15%~40%ï¼Œè¿™å±äºæ­£å¸¸ç°è±¡ã€‚éšè—æˆ–å…³é—­æ­¤ç•Œé¢å<code>Process Lasso</code>çš„èµ„æºå ç”¨ç‡å°†ä¼šå˜å¾—éå¸¸å°ï¼Œä¸ä¼šæ‹–æ…¢ç”µè„‘é€Ÿåº¦ã€‚</li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å…ˆå–Šä¸€å¥å£å·ï¼Œ<code>Process Lasso</code>ç‰›é€¼ï¼</p><p>ä¸è¿‡ç»™å¤§å®¶ä¸¾ä¾‹çš„ä¸è¿‡æ˜¯å®ƒçš„çš®æ¯›è€Œå·²ï¼Œæ›´å¤šä¼˜åŒ–è®¾ç½®å¯ä»¥é€šè¿‡è‡ªå·±çš„å°è¯•è°ƒæ•´è·å¾—ï¼Œå¸Œæœ›å¤§å®¶å¯ä»¥å¤šå¤šç ”ç©¶ï¼Œå‘ç°æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ç©æ³•å¯ä»¥ç§èŠæˆ‘ã€‚</p><p>å¯¹äº†ï¼Œè¿™ä¸ªè½¯ä»¶æœ‰æ”¶è´¹Proç‰ˆå’Œå…è´¹ç‰ˆï¼Œæ”¶è´¹ç‰ˆæœ‰å¾ˆå¤šæ–°åŠŸèƒ½ï¼Œæ¯”å¦‚å¼ºåˆ¶æ€§å¯¹è¿›ç¨‹çš„CPUå ç”¨ç‡è¿›è¡ŒåŠ¨æ€è°ƒæ•´ï¼Œèƒ½å¤Ÿæ˜æ˜¾æå‡éƒ¨åˆ†åº”ç”¨çš„æ‰§è¡Œæ•ˆç‡ã€‚åŸåˆ™ä¸Šæˆ‘ä¸æ¨èä»»ä½•ç”¨æˆ·ä½¿ç”¨ç›—ç‰ˆè½¯ä»¶çš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;code&gt;hexo&lt;/code&gt;ä¸çŸ¥é“å’‹åœ°äº†ï¼Œ&lt;code&gt;markdown&lt;/code&gt;è½¬&lt;code&gt;html&lt;/code&gt;ç”Ÿæˆé™æ€èµ„æºçš„æ—¶å€™ï¼Œå›¾ç‰‡å®Œå…¨ä¸å†™è¿›&lt;code&gt;html&lt;/code&gt;ï¼Œå‰é¢å‡ ç¯‡æºç åˆ†æçš„å›¾å…¨æ˜¾ç¤ºä¸å‡ºæ¥äº†ã€‚è„‘é˜”ç–¼~&lt;/p&gt;
&lt;p&gt;ç”±äºæš‚æ—¶æ²¡æœ‰è§£å†³é™
      
    
    </summary>
    
    
      <category term="æ—¥å¸¸" scheme="https://tengshe789.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Windows10" scheme="https://tengshe789.github.io/tags/Windows10/"/>
    
      <category term="è½¯ä»¶æ•™å­¦" scheme="https://tengshe789.github.io/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>é‚£äº›å¹´æ•°ç»„çš„æ’åº</title>
    <link href="https://tengshe789.github.io/2018/07/24/%E9%82%A3%E4%BA%9B%E5%B9%B4%E6%95%B0%E7%BB%84%E7%9A%84%E6%8E%92%E5%BA%8F/"/>
    <id>https://tengshe789.github.io/2018/07/24/é‚£äº›å¹´æ•°ç»„çš„æ’åº/</id>
    <published>2018-07-24T06:08:19.000Z</published>
    <updated>2020-03-21T12:59:30.850Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ¥å›é¡¾ä¸€ä¸‹ç®€å•çš„æ’åºæ€æƒ³ï¼Œç•™ä½œä»Šåçš„å¤ä¹ å’Œå¤‡ä»½ç”¨ã€‚æœ¬ç¯‡æ˜¯éå¸¸éå¸¸åŸºç¡€çš„ï¼Œç”šè‡³éƒ½ä¸ä¼šè®²å®é™…é¡¹ç›®çœŸæ­£èƒ½ç”¨çš„æ’åºæ–¹æ³•ï¼Œè­¬å¦‚åŒè½´å¿«é€Ÿæ’åº ã€‚å†™çš„ä¸å¥½è¯·å¤šå¤šè°…è§£ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><h1 id="å‡†å¤‡é˜¶æ®µ"><a href="#å‡†å¤‡é˜¶æ®µ" class="headerlink" title="å‡†å¤‡é˜¶æ®µ"></a>å‡†å¤‡é˜¶æ®µ</h1><h3 id="ç›¸å…³åŠŸèƒ½å‡½æ•°"><a href="#ç›¸å…³åŠŸèƒ½å‡½æ•°" class="headerlink" title="ç›¸å…³åŠŸèƒ½å‡½æ•°"></a>ç›¸å…³åŠŸèƒ½å‡½æ•°</h3><p>ä¸ºäº†ä¿æŒä»£ç çš„æ•´æ´ï¼Œå…ˆåˆ›é€ å¥½å¯¹æ•°å™¨å’Œç›¸å…³åŠŸèƒ½æ€§å‡½æ•°ã€‚</p><h4 id="äº¤æ¢å™¨"><a href="#äº¤æ¢å™¨" class="headerlink" title="äº¤æ¢å™¨"></a>äº¤æ¢å™¨</h4><p>ä¸¤ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ æ¯”è¾ƒæ’åºè¿‡ç¨‹ä¸­ï¼Œä¸€å®šä¼šæœ‰å…ƒç´ çš„äº¤æ¢æ“ä½œã€‚ä¸ºäº†ä¿æŒä»£ç çš„æ•´æ´ï¼Œå…ˆå†™å‡ºäº¤æ¢æ“ä½œçš„å‡½æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">arr[i] = arr[i] ^ arr[j];</span><br><span class="line">arr[j] = arr[i] ^ arr[j];</span><br><span class="line">arr[i] = arr[i] ^ arr[j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éšæœºæ ·æœ¬äº§ç”Ÿå™¨"><a href="#éšæœºæ ·æœ¬äº§ç”Ÿå™¨" class="headerlink" title="éšæœºæ ·æœ¬äº§ç”Ÿå™¨"></a>éšæœºæ ·æœ¬äº§ç”Ÿå™¨</h4><p>è‡ªå·±ç¼–æ•°ç»„å¤ªéº»çƒ¦äº†ï¼Œè®©ä»–è‡ªå·±ç”Ÿäº§å§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] generateRandomArray(<span class="keyword">int</span> maxSize, <span class="keyword">int</span> maxValue) &#123;</span><br><span class="line"><span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[(<span class="keyword">int</span>) ((maxSize + <span class="number">1</span>) * Math.random())];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">arr[i] = (<span class="keyword">int</span>) ((maxValue + <span class="number">1</span>) * Math.random()) - (<span class="keyword">int</span>) (maxValue * Math.random());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¯¹æ•°å™¨"><a href="#å¯¹æ•°å™¨" class="headerlink" title="å¯¹æ•°å™¨"></a>å¯¹æ•°å™¨</h4><p>å¯¹æ•°å™¨å…¶å®å°±æ˜¯ä¸€ä¸ªç»å¯¹æ­£ç¡®ä½†æ˜¯å¤æ‚åº¦ä¸å¥½çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">comparator</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">Arrays.sort(arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´è¯´<code>Arrays.sort()</code>çš„é€»è¾‘å§ã€‚æ•°ç»„è¿›å…¥æ–¹æ³•ï¼Œå…ˆåˆ¤æ–­ã€‚å¦‚æœæ•°ç»„çš„é•¿åº¦å°äº<code>QUICKSORT_THRESHOLD</code>ï¼ˆé»˜è®¤å€¼æ˜¯286ï¼‰çš„è¯ï¼Œå†åˆ¤æ–­ï¼Œå¦‚æœæ•°ç»„é•¿åº¦å°äº<code>INSERTION_SORT_THRESHOLD</code>(å€¼ä¸º47)çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šç”¨æ’å…¥æ’åº ï¼Œå¦åˆ™å°±ä¼šä½¿ç”¨åŒè½´å¿«é€Ÿæ’åºã€‚</p><p>å¦‚æœå¤§äº286å‘¢ï¼Œå®ƒå°±ä¼šåšæŒæ•°ç»„çš„è¿ç»­å‡åºå’Œè¿ç»­é™åºæ€§å¥½ä¸å¥½ï¼Œå¦‚æœå¥½çš„è¯å°±ç”¨å½’å¹¶æ’åºï¼Œä¸å¥½çš„è¯å°±ç”¨å¿«é€Ÿæ’åºã€‚</p><h4 id="æ¯”è¾ƒå™¨"><a href="#æ¯”è¾ƒå™¨" class="headerlink" title="æ¯”è¾ƒå™¨"></a>æ¯”è¾ƒå™¨</h4><p>æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„ä¸€ä¸ä¸€æ ·~</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isEqual</span><span class="params">(<span class="keyword">int</span>[] arr1, <span class="keyword">int</span>[] arr2)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> ((arr1 == <span class="keyword">null</span> &amp;&amp; arr2 != <span class="keyword">null</span>) || (arr1 != <span class="keyword">null</span> &amp;&amp; arr2 == <span class="keyword">null</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (arr1 == <span class="keyword">null</span> &amp;&amp; arr2 == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (arr1.length != arr2.length) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr1.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (arr1[i] != arr2[i]) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰“å°å™¨"><a href="#æ‰“å°å™¨" class="headerlink" title="æ‰“å°å™¨"></a>æ‰“å°å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (arr == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">      System.out.print(arr[i] + <span class="string">" "</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   System.out.println();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤åˆ¶å™¨"><a href="#å¤åˆ¶å™¨" class="headerlink" title="å¤åˆ¶å™¨"></a>å¤åˆ¶å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] copyArray(<span class="keyword">int</span>[] arr) &#123;</span><br><span class="line"><span class="keyword">if</span> (arr == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[arr.length];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">res[i] = arr[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸»å‡½æ•°"><a href="#ä¸»å‡½æ•°" class="headerlink" title="ä¸»å‡½æ•°"></a>ä¸»å‡½æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> testTime = <span class="number">500000</span>;</span><br><span class="line">   <span class="keyword">int</span> maxSize = <span class="number">100</span>;</span><br><span class="line">   <span class="keyword">int</span> maxValue = <span class="number">100</span>;</span><br><span class="line">   <span class="keyword">boolean</span> succeed = <span class="keyword">true</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; testTime; i++) &#123;</span><br><span class="line">      <span class="keyword">int</span>[] arr1 = generateRandomArray(maxSize, maxValue);</span><br><span class="line">      <span class="keyword">int</span>[] arr2 = copyArray(arr1);</span><br><span class="line">      bubbleSort(arr1);</span><br><span class="line">      comparator(arr2);</span><br><span class="line">      <span class="keyword">if</span> (!isEqual(arr1, arr2)) &#123;</span><br><span class="line">         succeed = <span class="keyword">false</span>;</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   System.out.println(succeed ? <span class="string">"ç‰›é€¼ï¼Œç®—æ³•å¯¹äº†!"</span> : <span class="string">"âŒ!"</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">int</span>[] arr = generateRandomArray(maxSize, maxValue);</span><br><span class="line">   printArray(arr);</span><br><span class="line">   bubbleSort(arr);<span class="comment">//æµ‹è¯•çš„ç®—æ³•</span></span><br><span class="line">   printArray(arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è„‘å­"><a href="#è„‘å­" class="headerlink" title="è„‘å­"></a>è„‘å­</h3><p>è„‘é˜”ç–¼</p><h1 id="æ­£ç¯‡"><a href="#æ­£ç¯‡" class="headerlink" title="æ­£ç¯‡"></a>æ­£ç¯‡</h1><h2 id="åŸºäºæ¯”è¾ƒçš„æ’åº"><a href="#åŸºäºæ¯”è¾ƒçš„æ’åº" class="headerlink" title="åŸºäºæ¯”è¾ƒçš„æ’åº"></a>åŸºäºæ¯”è¾ƒçš„æ’åº</h2><h3 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>å†’æ³¡æ’åºç®—æ³•çš„åŸç†å¦‚ä¸‹ï¼š</p><ol><li>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚æ­¤æ—¶è¿™ä¸¤ä¸ªæ•°ï¼Œæ°¸è¿œæ˜¯åé¢çš„æ•°å¤§ã€‚</li><li>ç¬¬ä¸€å›åˆå°†æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ åšåŒæ ·çš„å·¥ä½œã€‚å›åˆç»“æŸåï¼Œæœ€åçš„å…ƒç´ æ˜¯æ•´ä¸ªæ•°ç»„æœ€å¤§çš„æ•°ã€‚</li><li>ç¬¬äºŒå›åˆâ€¦ç¬¬nå›åˆè¿‡ç¨‹ä¸­ï¼Œå¯¹é™¤äº†æœ€åä¸€ä¸ªå…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ã€‚</li></ol><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (arr == <span class="keyword">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> end = arr.length - <span class="number">1</span>; end &gt; <span class="number">0</span>; end--) &#123;<span class="comment">//endæœ€åçš„æ•°</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; e; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (arr[i] &gt; arr[i + <span class="number">1</span>]) &#123;</span><br><span class="line">swap(arr, i, i + <span class="number">1</span>);<span class="comment">//äº¤æ¢</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤æ‚åº¦"><a href="#å¤æ‚åº¦" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><p>æ—¶é—´å¤æ‚åº¦ï¼šO(NÂ²)</p><p>é¢å¤–ç©ºé—´å¤æ‚åº¦ï¼šO(1)</p><h3 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h3><h4 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>1.ç¬¬ä¸€å›åˆï¼Œå°†æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå°†ç¬¬ä¸€ä¸ªå…ƒç´ å’Œå‰©ä½™çš„å…ƒç´ æ¯”è¾ƒï¼Œæœ€å°çš„å…ƒç´ æ”¾åˆ°ä¸€å·ä½ç½®ã€‚</p><p>2.ç¬¬äºŒå›åˆâ€¦ç¬¬nå›åˆè¿‡ç¨‹ä¸­ï¼ŒæŒ‡é’ˆåŠ ä¸€ã€‚å¯¹é™¤äº†ç¬¬ä¸€ä¸ªå…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ã€‚</p><h4 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">selectionSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (arr == <span class="keyword">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">int</span> minIndex = i;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line">         minIndex = arr[j] &lt; arr[minIndex] ? j : minIndex;</span><br><span class="line">      &#125;</span><br><span class="line">      swap(arr, i, minIndex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤æ‚åº¦-1"><a href="#å¤æ‚åº¦-1" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><p>æ—¶é—´å¤æ‚åº¦ï¼šO(NÂ²)</p><p>é¢å¤–ç©ºé—´å¤æ‚åº¦ï¼šO(1)</p><h3 id="æ’å…¥æ’åºçš„"><a href="#æ’å…¥æ’åºçš„" class="headerlink" title="æ’å…¥æ’åºçš„"></a>æ’å…¥æ’åºçš„</h3><h4 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>1.ç¬¬ä¸€å›åˆï¼Œæ¯”è¾ƒç¬¬ä¸€ä¸ªå…ƒç´ å’Œç¬¬äºŒä¸ªå…ƒç´ å¤§å°ï¼Œå¤§çš„æ”¾åœ¨ç¬¬äºŒä¸ªä½ç½®ä¸Š</p><p>2.ç¬¬äºŒå›åˆï¼Œå°†ç¬¬ä¸‰ä¸ªå…ƒç´ ä¸ç¬¬äºŒã€ç¬¬ä¸€ä¸ªå…ƒç´ æ¯”è¾ƒï¼Œå¤§çš„æ”¾åœ¨ç¬¬ä¸‰ä¸ªä½ç½®ä¸Š</p><p>3.è½®å›</p><h4 id="å®ç°-2"><a href="#å®ç°-2" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insertionSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (arr == <span class="keyword">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = i - <span class="number">1</span>; j &gt;= <span class="number">0</span> &amp;&amp; arr[j] &gt; arr[j + <span class="number">1</span>]; j--) &#123;</span><br><span class="line">         swap(arr, j, j + <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤æ‚åº¦-2"><a href="#å¤æ‚åº¦-2" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><p>æ—¶é—´å¤æ‚åº¦ï¼šO(NÂ²)</p><p>é¢å¤–ç©ºé—´å¤æ‚åº¦ï¼šO(1)</p><h3 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h3><p>å †å…¶å®å°±æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œçœ‹å †è¦é¦–å…ˆçŸ¥é“å¤§é¡¶å †ã€å°é¡¶å †ã€‚</p><p>æ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œç§°ä¸ºå¤§é¡¶å †ï¼›æˆ–è€…æ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œç§°ä¸ºå°é¡¶å †ã€‚</p><p>å¤§é¡¶å †ï¼šarr[i] &gt;= arr[2i+1] &amp;&amp; arr[i] &gt;= arr[2i+2]  </p><p>å°é¡¶å †ï¼šarr[i] &lt;= arr[2i+1] &amp;&amp; arr[i] &lt;= arr[2i+2]  </p><p><img src="/2018/07/24/é‚£äº›å¹´æ•°ç»„çš„æ’åº/QQæˆªå›¾20180724205705.jpg" alt="daxiao"></p><h4 id="åŸç†-3"><a href="#åŸç†-3" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>å°†å¾…æ’åºåºåˆ—æ„é€ æˆä¸€ä¸ªå¤§é¡¶å †ï¼ˆå‡åºé‡‡ç”¨å¤§é¡¶å †ï¼Œé™åºé‡‡ç”¨å°é¡¶å †ï¼‰ï¼Œæ­¤æ—¶ï¼Œæ•´ä¸ªåºåˆ—çš„æœ€å¤§å€¼å°±æ˜¯å †é¡¶çš„æ ¹èŠ‚ç‚¹ã€‚å°†å…¶ä¸æœ«å°¾å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œæ­¤æ—¶æœ«å°¾å°±ä¸ºæœ€å¤§å€¼ã€‚ç„¶åå°†å‰©ä½™n-1ä¸ªå…ƒç´ é‡æ–°æ„é€ æˆä¸€ä¸ªå †ï¼Œè¿™æ ·ä¼šå¾—åˆ°nä¸ªå…ƒç´ çš„æ¬¡å°å€¼ã€‚å¦‚æ­¤åå¤æ‰§è¡Œï¼Œä¾¿èƒ½å¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—äº† </p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (arr == <span class="keyword">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//0-iä¹‹é—´ç”Ÿæˆå¤§æ ¹å †è¿™ç§ç»“æ„</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">heapInsert(arr, i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> size = arr.length;<span class="comment">//å®šä¹‰æ•°ç»„å¤§å°ï¼Œå¯ä»¥åˆ¤æ–­æ˜¯å¦è¶Šç•Œ</span></span><br><span class="line">swap(arr, <span class="number">0</span>, --size);</span><br><span class="line"><span class="keyword">while</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">heapify(arr, <span class="number">0</span>, size);</span><br><span class="line">swap(arr, <span class="number">0</span>, --size);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç”Ÿæˆå¤§æ ¹å †è¿™ç§ç»“æ„</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapInsert</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line"><span class="keyword">while</span> (arr[index] &gt; arr[(index - <span class="number">1</span>) / <span class="number">2</span>]) &#123;<span class="comment">//å¦‚æœæˆ‘è¿™ä¸ªèŠ‚ç‚¹æ¯”çˆ¶èŠ‚ç‚¹å¤§</span></span><br><span class="line">swap(arr, index, (index - <span class="number">1</span>) / <span class="number">2</span>);<span class="comment">//äº¤æ¢</span></span><br><span class="line">index = (index - <span class="number">1</span>) / <span class="number">2</span>;<span class="comment">//å›åˆ°çˆ¶ä½ç½®ç»§ç»­</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†æ•°å€¼å°çš„å…ƒç´ å¾€ä¸‹æ²‰</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapify</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> index, <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> left = index * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (left &lt; size) &#123;<span class="comment">//å·¦å­©å­åœ¨å †ä¸Šï¼Œæ²¡è¶Šç•Œ</span></span><br><span class="line"><span class="keyword">int</span> largest = left + <span class="number">1</span> &lt; size &amp;&amp; arr[left + <span class="number">1</span>] &gt; arr[left] ? left + <span class="number">1</span> : left;<span class="comment">//æ‰¾å‡ºå·¦å³å­©å­ä¸­æœ€å¤§çš„æ•°</span></span><br><span class="line">largest = arr[largest] &gt; arr[index] ? largest : index;<span class="comment">//å’Œçˆ¶æ¯”è¾ƒ</span></span><br><span class="line"><span class="keyword">if</span> (largest == index) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">swap(arr, largest, index);</span><br><span class="line">index = largest;<span class="comment">//å›åˆ°è¾ƒå¤§èŠ‚ç‚¹</span></span><br><span class="line">left = index * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤æ‚åº¦-3"><a href="#å¤æ‚åº¦-3" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><p>å¦‚æœåªæ˜¯å»ºç«‹å †çš„è¿‡ç¨‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(N) </p><p>æ—¶é—´å¤æ‚åº¦O(N*logN)</p><p>é¢å¤–ç©ºé—´å¤æ‚åº¦O(1)</p><h3 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h3><p>å¿«é€Ÿæ’åºä¸æ˜¯ä¸€ç§ç¨³å®šçš„æ’åºç®—æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¤šä¸ªç›¸åŒçš„å€¼çš„ç›¸å¯¹ä½ç½®ä¹Ÿè®¸ä¼šåœ¨ç®—æ³•ç»“æŸæ—¶äº§ç”Ÿå˜åŠ¨ã€‚</p><blockquote><p>å‡å®šåœ¨å¾…æ’åºçš„è®°å½•åºåˆ—ä¸­ï¼Œå­˜åœ¨å¤šä¸ªå…·æœ‰ç›¸åŒçš„å…³é”®å­—çš„è®°å½•ï¼Œè‹¥ç»è¿‡æ’åºï¼Œè¿™äº›è®°å½•çš„ç›¸å¯¹æ¬¡åºä¿æŒä¸å˜ï¼Œå³åœ¨åŸåºåˆ—ä¸­ï¼Œr[i]=r[j]ï¼Œä¸”r[i]åœ¨r[j]ä¹‹å‰ï¼Œè€Œåœ¨æ’åºåçš„åºåˆ—ä¸­ï¼Œr[i]ä»åœ¨r[j]ä¹‹å‰ï¼Œåˆ™ç§°è¿™ç§æ’åºç®—æ³•æ˜¯ç¨³å®šçš„ï¼›å¦åˆ™ç§°ä¸ºä¸ç¨³å®šçš„ã€‚</p></blockquote><h4 id="åŸç†-4"><a href="#åŸç†-4" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>æˆ‘å…ˆè¯´è¯´ç»å…¸å¿«æ’çš„æ€è·¯å§ã€‚</p><p>å°†æ•°ç»„åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯å°äºç­‰äºæŸä¸ªæ•°çš„ï¼Œä¸€éƒ¨åˆ†æ˜¯å¤§äºç­‰äºæŸä¸ªæ•°çš„ã€‚è¿™ä¸¤éƒ¨åˆ†åˆå§‹æŒ‡é’ˆåœ¨æ•°ç»„çš„å·¦(L)å³(R)ä¸¤å¤´ï¼Œæ­¤æ—¶Lå’ŒRåˆ†åˆ«æ˜¯ä¸€ä¸ªè¾¹ç•Œç‚¹ã€‚</p><p>1.å…ˆå®šä¹‰lessåŒºåŸŸå’ŒmoreåŒºåŸŸï¼Œä»£è¡¨æ¯”æ•°ç»„ä¸­æŸä¸€ä¸ªæ•°æ›´å°æ›´å¤§çš„åŒºåŸŸã€‚åˆå§‹lessåŒºåŸŸæ˜¯L-1ä»¥å·¦çš„éƒ¨åˆ†ï¼ŒmoreåŒºåŸŸæ˜¯Rä»¥å³çš„åŒºåŸŸ</p><p><img src="/2018/07/24/é‚£äº›å¹´æ•°ç»„çš„æ’åº/QQæˆªå›¾20180724205757.jpg" alt="1532425834921"></p><p>2.ç¬¬ä¸€å›åˆï¼Œä»æ•°ç»„å·¦è¾¹å¼€å§‹ã€‚è‹¥LæŒ‡é’ˆæŒ‡çš„èŠ‚ç‚¹å€¼å°äºæŸä¸ªæ•°å€¼ï¼ŒlessåŒºåŸŸå‘å³ç§»åŠ¨ä¸€ä¸ªä½ç½® <code>swap(arr,++less,L++);</code>ï¼ŒLèŠ‚ç‚¹ä½ç½®+1å‡†å¤‡ä¸‹ä¸€ä¸ªå›åˆï¼›è‹¥å®ƒå¤§äºè¿™ä¸ªæ•°å€¼ï¼ŒmoreåŒºåŸŸå‘å·¦æ‰©å¼ ä¸€æ ¼ï¼Œç„¶åå°†è¿™ä¸ªèŠ‚ç‚¹æ”¾åˆ°moreåŒºåŸŸ<code>swap(arr,--more,L++);</code>ï¼ŒLèŠ‚ç‚¹ä½ç½®+1å‡†å¤‡ä¸‹ä¸€ä¸ªå›åˆï¼›è‹¥ä»–ç­‰äºè¿™ä¸ªæ•°å€¼ï¼Œä»€ä¹ˆä¹Ÿä¸ç®¡ï¼Œåªæ˜¯LèŠ‚ç‚¹ä½ç½®+1å‡†å¤‡ä¸‹ä¸€ä¸ªå›åˆã€‚</p><p>3.é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œå¾—åˆ°äº†ä¸€ä¸ªæ•°ç»„ï¼Œä»–çš„LæŒ‡é’ˆå³è¾¹æ—¶å°äºæŸä¸ªæ•°çš„ï¼ŒRçš„å³è¾¹æ—¶å¤§äºæŸä¸ªæ•°çš„ã€‚[L,R]è¿™ä¸ªåŒºé—´æ˜¯ç­‰äºæŸä¸ªæ•°çš„ã€‚</p><p>4.è¿”å›è¿™ä¸ªéƒ½æ˜¯ç›¸åŒæ•°çš„æ•°ç»„çš„å·¦è¾¹ç•Œã€å³è¾¹ç•Œ</p><p>5.ä¸æ–­é€’å½’</p><p>ç»å…¸å¿«æ’æœ‰ä¸€ä¸ªå¼Šç«¯ã€‚<strong>å·¦éƒ¨åˆ†å’Œå³éƒ¨åˆ†çš„è§„æ¨¡ä¸ä¸€æ ·æˆ–è€…æœ‰ä¸€ä¸ªéƒ¨åˆ†è§„æ¨¡ç‰¹åˆ«å¤§ï¼Œç®—æ³•æ•ˆç‡ä¼šå˜å·®ã€‚</strong>ä¸¾ä¸ªæ —å­ï¼Œå¦‚æœæˆ‘æœ‰ä¸ªæ•°ç»„[1,1,3,4,7,6,1,2,1,5,1,7]ï¼Œæˆ‘æŒ‡å®šçš„æŸä¸ªæ•°å­—æ˜¯7ï¼Œé‚£ä¹ˆé‚£ä¹ˆæ’åºåå°±å˜æˆäº†[1ï¼Œ1ï¼Œ1ï¼Œ1ï¼Œ1,2,3,4,5,6,7],ç»å…¸å¿«æ’ç»“æŸååªæå®šäº†ä¸€ä¸ªä¸€ä¸ªåŒºé—´ï¼ˆ&lt;7çš„åŒºé—´ï¼‰ï¼Œå¤æ‚åº¦å°±ä»ç†æƒ³çŠ¶æ€ä¸‹çš„Oï¼ˆNï¼‰å˜æˆäº†Oï¼ˆNÂ²ï¼‰</p><p>ç„¶åå°±æœ‰äº†æ”¹è¿›åçš„éšæœºå¿«æ’ã€‚</p><p>éšæœºå¿«æ’æ¯”ç»å…¸å¿«æ’å¤šäº†ä¸€ä¸ªé€‰éšæœºæ•°çš„è¿‡ç¨‹ <code>swap(arr, L + (int) (Math.random() * (R - L + 1)), R);ã€‚</code>å°±æ˜¯éšæœºç”ŸæˆæŸä¸ªæ•°ï¼Œè¿™æ ·ç”Ÿæˆçš„åŒºé—´è™½ç„¶ä¹Ÿä¼šå‡ºç°ä¸Šè¿°ç»å…¸å¿«æ’çš„æ¶åŠ£æƒ…å†µï¼Œä½†æ˜¯æ­¤æ—¶çš„å¤æ‚åº¦å°±ä»åŸæ¥çš„æ¶åŠ£äº‹ä»¶å˜æˆäº†æœ‰æ¦‚ç‡æ¶åŠ£äº‹ä»¶ï¼Œä½†æ€»ä½“æœŸæœ›æ˜¯å¥½çš„ã€‚è¿™å°±å˜æˆäº†ä¸€ä¸ªæ¦‚ç‡é—®é¢˜ã€‚</p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>ä»¥ä¸‹ä¸ºéšæœºå¿«æ’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] nums = &#123;<span class="number">9</span>,<span class="number">10</span>,<span class="number">45</span>,<span class="number">36</span>,<span class="number">98</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    quickSort(nums);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> num : nums) &#123;</span><br><span class="line">        System.out.print(num+<span class="string">","</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¿«é€Ÿæ’åºï¼Œä½¿å¾—æ•´æ•°æ•°ç»„ arr æœ‰åº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (arr == <span class="keyword">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    quickSort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¿«é€Ÿæ’åºï¼Œä½¿å¾—æ•´æ•°æ•°ç»„ arr çš„ [L, R] éƒ¨åˆ†æœ‰åº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(L &lt; R) &#123;</span><br><span class="line">        <span class="comment">// æŠŠæ•°ç»„ä¸­éšæœºçš„ä¸€ä¸ªå…ƒç´ ä¸æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œè¿™æ ·ä»¥æœ€åä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†å€¼å®é™…ä¸Šå°±æ˜¯ä»¥æ•°ç»„ä¸­éšæœºçš„ä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†å€¼</span></span><br><span class="line">        swap(arr, <span class="keyword">new</span> Random().nextInt(R - L + <span class="number">1</span>) + L, R);</span><br><span class="line">        <span class="keyword">int</span>[] p = partition(arr, L, R);</span><br><span class="line">        quickSort(arr, L, p[<span class="number">0</span>] - <span class="number">1</span>);</span><br><span class="line">        quickSort(arr, p[<span class="number">1</span>] + <span class="number">1</span>, R);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†åŒºçš„è¿‡ç¨‹ï¼Œæ•´æ•°æ•°ç»„ arr çš„[L, R]éƒ¨åˆ†ä¸Šï¼Œä½¿å¾—ï¼š</span></span><br><span class="line"><span class="comment"> *   å¤§äº arr[R] çš„å…ƒç´ ä½äº[L, R]éƒ¨åˆ†çš„å³è¾¹ï¼Œä½†è¿™éƒ¨åˆ†æ•°æ®ä¸ä¸€å®šæœ‰åº</span></span><br><span class="line"><span class="comment"> *   å°äº arr[R] çš„å…ƒç´ ä½äº[L, R]éƒ¨åˆ†çš„å·¦è¾¹ï¼Œä½†è¿™éƒ¨åˆ†æ•°æ®ä¸ä¸€å®šæœ‰åº</span></span><br><span class="line"><span class="comment"> *   ç­‰äº arr[R] çš„å…ƒç´ ä½äº[L, R]éƒ¨åˆ†çš„ä¸­é—´</span></span><br><span class="line"><span class="comment"> * è¿”å›ç­‰äºéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡å’Œæœ€åä¸€ä¸ªä¸‹æ ‡ç»„æˆçš„æ•´æ•°æ•°ç»„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] partition(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> L, <span class="keyword">int</span> R) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> basic = arr[R];</span><br><span class="line">    <span class="keyword">int</span> less = L - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> more = R + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(L &lt; more) &#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[L] &lt; basic) &#123;</span><br><span class="line">            swap(arr, ++less, L++);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[L] &gt; basic) &#123;</span><br><span class="line">            swap(arr, --more, L);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            L++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; less + <span class="number">1</span>, more - <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * äº¤æ¢æ•°ç»„ arr ä¸­ä¸‹æ ‡ä¸º i å’Œä¸‹æ ‡ä¸º j ä½ç½®çš„å…ƒç´ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = arr[i];</span><br><span class="line">    arr[i] = arr[j];</span><br><span class="line">    arr[j] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤æ‚åº¦-4"><a href="#å¤æ‚åº¦-4" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><p>ç§‘å­¦å®¶æ•°å­¦è¯æ˜ï¼Œé•¿æœŸæœŸæœ›çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logN*N)</p><p>å¿«é€Ÿæ’åºå¯ä»¥åšåˆ°ç¨³å®šæ€§é—®é¢˜ï¼Œéå¸¸éš¾ï¼Œè¦çŸ¥é“çš„å¯ä»¥è°·æ­Œâ€œ01 stable sortâ€ ï¼Œåæ­£æˆ‘ä¸ä¼šã€‚</p><h3 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h3><h4 id="åŸç†-5"><a href="#åŸç†-5" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>1.å’Œä¸Šé¢˜ä¸€æ ·ï¼Œå…ˆå®šä¹‰å·¦è¾¹ç•ŒLå³è¾¹ç•ŒRæ•°ç»„ä¸­ï¼Œç„¶åå®šä¹‰ä¸€ä¸ªä¸­é—´å€¼<code>mid = (r-l)/2</code></p><p>2.é€’å½’ï¼Œåœ¨è¾¹ç•Œå†…éƒ¨ä¸æ–­çš„æ‰¾ä¸­é—´å€¼mid</p><h4 id="å®ç°-3"><a href="#å®ç°-3" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å½’å¹¶æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (arr==<span class="keyword">null</span> || arr.length &lt;<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mergeSort(arr,<span class="number">0</span>,arr.length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l + ((r - l) &gt;&gt; <span class="number">1</span>); <span class="comment">//(r-l)/2</span></span><br><span class="line">    mergeSort(arr,l,mid);</span><br><span class="line">    mergeSort(arr,mid+<span class="number">1</span>,r);</span><br><span class="line">    merge(arr, l, mid, r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤æ‚åº¦-5"><a href="#å¤æ‚åº¦-5" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><p>æ—¶é—´å¤æ‚åº¦O(N*logN)</p><p>é¢å¤–ç©ºé—´å¤æ‚åº¦O(N)ï¼Œå½’å¹¶æ’åºçš„é¢å¤–ç©ºé—´å¤æ‚åº¦å¯ä»¥å˜æˆO(1)ï¼Œä½†æ˜¯éå¸¸éš¾ï¼Œæˆ‘æ²¡èŠ±æ—¶é—´ç ”ç©¶ï¼Œè¦çŸ¥é“çš„å¯ä»¥è°·æ­Œâ€œå½’å¹¶æ’åº å†…éƒ¨ç¼“å­˜æ³•â€ </p><p>è¿™é‡Œçš„æ—¶é—´å¤æ‚åº¦æ€ä¹ˆç®—å‡ºæ¥çš„å‘¢ï¼Ÿæœ‰ä¸€ä¸ª<strong>masterå®šç†</strong>ï¼š</p><p>T(N) = a*T(N/b) + O(N^d)</p><p>å…¶ä¸­ a &gt;= 1 and b &gt; 1 æ˜¯å¸¸é‡ï¼Œå…¶è¡¨ç¤ºçš„æ„ä¹‰æ˜¯nè¡¨ç¤ºé—®é¢˜çš„è§„æ¨¡ï¼Œaè¡¨ç¤ºé€’å½’çš„æ¬¡æ•°ä¹Ÿå°±æ˜¯ç”Ÿæˆçš„å­é—®é¢˜æ•°ï¼Œbè¡¨ç¤ºæ¯æ¬¡é€’å½’æ˜¯åŸæ¥çš„1/bä¹‹ä¸€ä¸ªè§„æ¨¡ã€‚ å¦‚ä¸‹ï¼š</p><p>1) log(b,a) &gt; d -&gt; å¤æ‚åº¦ä¸ºO(N^log(b,a)) </p><p>2) log(b,a) = d -&gt; å¤æ‚åº¦ä¸ºO(N^d * logN) </p><p>3) log(b,a) &lt;  d -&gt; å¤æ‚åº¦ä¸ºO(N^d)</p><p>è¿™é‡Œï¼Œå½’å¹¶æ’åºä¸­b=2ï¼Œa=2.</p><h2 id="éåŸºäºæ¯”è¾ƒçš„æ’åº"><a href="#éåŸºäºæ¯”è¾ƒçš„æ’åº" class="headerlink" title="éåŸºäºæ¯”è¾ƒçš„æ’åº"></a>éåŸºäºæ¯”è¾ƒçš„æ’åº</h2><p>éåŸºäºæ¯”è¾ƒçš„æ’åºï¼Œä¸è¢«æ’åºçš„æ ·æœ¬çš„å®é™…æ•°æ®çŠ¶å†µå¾ˆæœ‰å…³ç³»ï¼Œæ‰€ä»¥å®é™…ä¸­å¹¶ä¸ç»å¸¸ä½¿ç”¨ </p><h3 id="æ¡¶æ’åº"><a href="#æ¡¶æ’åº" class="headerlink" title="æ¡¶æ’åº"></a>æ¡¶æ’åº</h3><h4 id="åŸç†-6"><a href="#åŸç†-6" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>1.æ‰¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­æœ€å¤§æ•°çš„å€¼</p><p>2.å®šä¹‰ï¼ˆæœ€å¤§æ•°+1ï¼‰ä¸ªæ¡¶</p><p>3.å°†æ•°ç»„çš„æ•°æ”¾åˆ°å¯¹åº”ç¼–å·ç›¸åŒçš„æ¡¶ä¸­ï¼Œæ¯æ”¾è¿›ä¸€ä¸ªæ•°ï¼Œæ¡¶é‡Œé¢çš„æ•°å€¼åŠ ä¸€</p><p>4.ä¾æ¬¡ä»å°è¾“å‡ºè¿™ä¸ªæ¡¶ï¼Œæ¡¶é‡Œçš„å…ƒç´ å‡ºç°å‡ æ¬¡å°±è¾“å‡ºå‡ ä¸ªæ¡¶çš„ç¼–å·</p><h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// only for 0~200 value</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bucketSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (arr == <span class="keyword">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> max = Integer.MIN_VALUE;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">max = Math.max(max, arr[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span>[] bucket = <span class="keyword">new</span> <span class="keyword">int</span>[max + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">bucket[arr[i]]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; bucket.length; j++) &#123;</span><br><span class="line"><span class="keyword">while</span> (bucket[j]-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">arr[i++] = j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤æ‚åº¦-6"><a href="#å¤æ‚åº¦-6" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><p>æ—¶é—´å¤æ‚åº¦O(N)</p><p>é¢å¤–ç©ºé—´å¤æ‚åº¦O(N)</p><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œç¼˜åˆ†å‘¢å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹~  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©æ¥å›é¡¾ä¸€ä¸‹ç®€å•çš„æ’åºæ€æƒ³ï¼Œç•™ä½œä»Šåçš„å¤ä¹ å’Œå¤‡ä»½ç”¨ã€‚æœ¬ç¯‡æ˜¯éå¸¸éå¸¸åŸºç¡€çš„ï¼Œç”šè‡³éƒ½ä¸ä¼šè®²å®é™…é¡¹ç›®çœŸæ­£èƒ½ç”¨çš„æ’åºæ–¹æ³•ï¼Œè­¬å¦‚åŒè½´å¿«é€Ÿæ’åº ã€‚å†™çš„ä¸å¥½è¯·å¤šå¤šè°…è§£ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.tech/
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="https://tengshe789.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºTreeMapçš„ä¸ªäººç†è§£</title>
    <link href="https://tengshe789.github.io/2018/07/23/TreeMap/"/>
    <id>https://tengshe789.github.io/2018/07/23/TreeMap/</id>
    <published>2018-07-23T07:23:27.000Z</published>
    <updated>2019-11-20T13:39:40.601Z</updated>
    
    <content type="html"><![CDATA[<p>ç¾¤é‡Œçš„å¤§å“¥è¯´äº†ï¼Œè¦æƒ³æ‡‚çº¢é»‘æ ‘çš„åº”ç”¨ï¼Œå…ˆè¦çœ‹<code>TreeMap</code>ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">https://blog.tengshe789.tech/</a></p><p>OKï¼Œç°åœ¨å¼€å§‹ï¼š</p><h4 id="çº¢é»‘æ ‘ç®€ä»‹"><a href="#çº¢é»‘æ ‘ç®€ä»‹" class="headerlink" title="çº¢é»‘æ ‘ç®€ä»‹"></a>çº¢é»‘æ ‘ç®€ä»‹</h4><p>çº¢é»‘æ ‘åˆç§°çº¢-é»‘äºŒå‰æ ‘ï¼Œå®ƒé¦–å…ˆæ˜¯ä¸€é¢—äºŒå‰æ ‘ï¼Œå®ƒå…·ä½“äºŒå‰æ ‘æ‰€æœ‰çš„ç‰¹æ€§ã€‚åŒæ—¶çº¢é»‘æ ‘æ›´æ˜¯ä¸€é¢—è‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ã€‚</p><p>â€‹       ä¸€èˆ¬çš„äºŒå‰æ ‘ä»–ä»¬éƒ½éœ€è¦æ»¡è¶³ä¸€ä¸ªåŸºæœ¬æ€§è´¨â€“å³æ ‘ä¸­çš„ä»»ä½•èŠ‚ç‚¹çš„å€¼å¤§äºå®ƒçš„å·¦å­èŠ‚ç‚¹ï¼Œä¸”å°äºå®ƒçš„å³å­èŠ‚ç‚¹ã€‚å› ä¸ºæŒ‰ç…§è¿™ä¸ªåŸºæœ¬æ€§è´¨ä½¿å¾—æ ‘çš„æ£€ç´¢æ•ˆç‡å¤§å¤§æé«˜ã€‚ä½†æˆ‘ä»¬çŸ¥é“åœ¨ç”ŸæˆäºŒå‰æ ‘çš„è¿‡ç¨‹æ˜¯éå¸¸å®¹æ˜“å¤±è¡¡çš„ï¼Œæœ€åçš„æƒ…å†µå°±æ˜¯ä¸€è¾¹å€’ï¼ˆåªæœ‰å³/å·¦å­æ ‘ï¼‰ï¼Œè¿™æ ·åŠ¿å¿…ä¼šå¯¼è‡´äºŒå‰æ ‘çš„æ£€ç´¢æ•ˆç‡å¤§å¤§é™ä½ï¼ˆO(n)ï¼‰ï¼Œæ‰€ä»¥ä¸ºäº†ç»´æŒäºŒå‰æ ‘çš„å¹³è¡¡ï¼Œå¤§ç‰›ä»¬æå‡ºäº†å„ç§å®ç°çš„ç®—æ³•ï¼Œå¦‚ï¼š<a href="http://baike.baidu.com/view/414610.htm" target="_blank" rel="noopener">AVL</a>ï¼Œ<a href="http://baike.baidu.com/view/2957252.htm" target="_blank" rel="noopener">SBT</a>ï¼Œ<a href="http://baike.baidu.com/view/1118088.htm" target="_blank" rel="noopener">ä¼¸å±•æ ‘</a>ï¼Œ<a href="http://baike.baidu.com/view/956602.htm" target="_blank" rel="noopener">TREAP</a> ï¼Œ<a href="http://baike.baidu.com/view/133754.htm?fr=aladdin#1_1" target="_blank" rel="noopener">çº¢é»‘æ ‘</a>ç­‰ç­‰ã€‚</p><p>â€‹       <strong>å¹³è¡¡äºŒå‰æ ‘</strong>å¿…é¡»å…·å¤‡å¦‚ä¸‹ç‰¹æ€§ï¼šå®ƒæ˜¯ä¸€æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚ä¹Ÿå°±æ˜¯è¯´è¯¥äºŒå‰æ ‘çš„ä»»ä½•ä¸€ä¸ªç­‰ç­‰å­èŠ‚ç‚¹ï¼Œå…¶å·¦å³å­æ ‘çš„é«˜åº¦éƒ½ç›¸è¿‘ã€‚</p><p><img src="/2018/07/23/TreeMap/1.png" alt="å¹³è¡¡äºŒå‰æ ‘å’Œæ™®é€šçš„åŒºåˆ«"></p><p>çº¢é»‘æ ‘é¡¾åæ€ä¹‰å°±æ˜¯èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–è€…é»‘è‰²çš„å¹³è¡¡äºŒå‰æ ‘ï¼Œå®ƒé€šè¿‡é¢œè‰²çš„çº¦æŸæ¥ç»´æŒç€äºŒå‰æ ‘çš„å¹³è¡¡ã€‚å¯¹äºä¸€æ£µæœ‰æ•ˆçš„çº¢é»‘æ ‘äºŒå‰æ ‘è€Œè¨€æˆ‘ä»¬å¿…é¡»å¢åŠ å¦‚ä¸‹<strong>è§„åˆ™</strong>ï¼š</p><p>â€‹       <strong>1ã€æ¯ä¸ªèŠ‚ç‚¹éƒ½åªèƒ½æ˜¯çº¢è‰²æˆ–è€…é»‘è‰²</strong></p><p>â€‹       <strong>2ã€æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²</strong></p><p>â€‹       <strong>3ã€æ¯ä¸ªå¶èŠ‚ç‚¹ï¼ˆNILèŠ‚ç‚¹ï¼Œç©ºèŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²çš„ã€‚</strong></p><p>â€‹       <strong>4ã€å¦‚æœä¸€ä¸ªç»“ç‚¹æ˜¯çº¢çš„ï¼Œåˆ™å®ƒä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€æ¡è·¯å¾„ä¸Šä¸èƒ½å‡ºç°ç›¸é‚»çš„ä¸¤ä¸ªçº¢è‰²ç»“ç‚¹ã€‚</strong></p><p>â€‹       <strong>5ã€ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚</strong></p><p>â€‹       è¿™äº›çº¦æŸå¼ºåˆ¶äº†çº¢é»‘æ ‘çš„å…³é”®æ€§è´¨: <strong>ä»æ ¹åˆ°å¶å­çš„æœ€é•¿çš„å¯èƒ½è·¯å¾„ä¸å¤šäºæœ€çŸ­çš„å¯èƒ½è·¯å¾„çš„ä¸¤å€é•¿ã€‚</strong>ç»“æœæ˜¯è¿™æ£µæ ‘å¤§è‡´ä¸Šæ˜¯å¹³è¡¡çš„ã€‚å› ä¸ºæ“ä½œæ¯”å¦‚æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æŸä¸ªå€¼çš„æœ€åæƒ…å†µæ—¶é—´éƒ½è¦æ±‚ä¸æ ‘çš„é«˜åº¦æˆæ¯”ä¾‹ï¼Œè¿™ä¸ªåœ¨é«˜åº¦ä¸Šçš„ç†è®ºä¸Šé™å…è®¸çº¢é»‘æ ‘åœ¨æœ€åæƒ…å†µä¸‹éƒ½æ˜¯é«˜æ•ˆçš„ï¼Œè€Œä¸åŒäºæ™®é€šçš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚æ‰€ä»¥çº¢é»‘æ ‘å®ƒæ˜¯å¤æ‚è€Œé«˜æ•ˆçš„ï¼Œå…¶æ£€ç´¢æ•ˆç‡O(log <em>n</em>)ã€‚ä¸‹å›¾ä¸ºä¸€é¢—å…¸å‹çš„çº¢é»‘äºŒå‰æ ‘ã€‚</p><p><img src="/2018/07/23/TreeMap/2.png" alt="çº¢é»‘æ ‘çš„ç»“æ„"> </p><h3 id="å…³äºTreeMap"><a href="#å…³äºTreeMap" class="headerlink" title="å…³äºTreeMap"></a>å…³äºTreeMap</h3><p>æˆ‘æ²¡çœ‹æ‡‚å•Šå•Šå•Šå•Šï¼Œæˆ‘çœ‹æ‡‚äº†åœ¨æ›´æ–°(ç«‹FLAGğŸš©)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç¾¤é‡Œçš„å¤§å“¥è¯´äº†ï¼Œè¦æƒ³æ‡‚çº¢é»‘æ ‘çš„åº”ç”¨ï¼Œå…ˆè¦çœ‹&lt;code&gt;TreeMap&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.tech/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;htt
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="æºç " scheme="https://tengshe789.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>A æ­»é” ã® ç‰©è¯­(Ë‰â–½Ë‰ï¼›)...</title>
    <link href="https://tengshe789.github.io/2018/07/23/A-%E6%AD%BB%E9%94%81/"/>
    <id>https://tengshe789.github.io/2018/07/23/A-æ­»é”/</id>
    <published>2018-07-23T02:04:00.000Z</published>
    <updated>2019-11-20T13:39:40.559Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tengshe789</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadLock</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String obj1 = <span class="string">"obj1"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String obj2 = <span class="string">"obj2"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Lock1 running"</span>);</span><br><span class="line">                <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">                    <span class="keyword">synchronized</span>(DeadLock.obj1)&#123;</span><br><span class="line">                        System.out.println(<span class="string">"Lock1 lock obj1"</span>);</span><br><span class="line">                        Thread.sleep(<span class="number">3000</span>);<span class="comment">//è·å–obj1åå…ˆç­‰ä¸€ä¼šå„¿ï¼Œè®©Lock2æœ‰è¶³å¤Ÿçš„æ—¶é—´é”ä½obj2</span></span><br><span class="line">                        <span class="keyword">synchronized</span>(DeadLock.obj2)&#123;</span><br><span class="line">                            System.out.println(<span class="string">"Lock1 lock obj2"</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();<span class="comment">//first thread with lambda</span></span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Lock2 running"</span>);</span><br><span class="line">                <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">                    <span class="keyword">synchronized</span>(DeadLock.obj2)&#123;</span><br><span class="line">                        System.out.println(<span class="string">"Lock2 lock obj2"</span>);</span><br><span class="line">                        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                        <span class="keyword">synchronized</span>(DeadLock.obj1)&#123;</span><br><span class="line">                            System.out.println(<span class="string">"Lock2 lock obj1"</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();<span class="comment">//second thread</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œç¼˜åˆ†å‘¢å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹~  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=
      
    
    </summary>
    
    
      <category term="æ—¥å¸¸" scheme="https://tengshe789.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºLinkedHashmapçš„ä¸ªäººç†è§£</title>
    <link href="https://tengshe789.github.io/2018/07/18/%E5%85%B3%E4%BA%8ELinkedHashmap%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%90%86%E8%A7%A3/"/>
    <id>https://tengshe789.github.io/2018/07/18/å…³äºLinkedHashmapçš„ä¸ªäººç†è§£/</id>
    <published>2018-07-18T01:39:02.000Z</published>
    <updated>2019-11-20T13:39:41.172Z</updated>
    
    <content type="html"><![CDATA[<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªè¦ä¸æ¶‰åŠçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒMapåŸºæœ¬éƒ½å¯ä»¥ä½¿ç”¨<code>HashMap</code>ï¼Œä¸è¿‡<code>HashMap</code>æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿­ä»£HashMapçš„é¡ºåºå¹¶ä¸æ˜¯<code>HashMap</code>æ”¾ç½®çš„é¡ºåºã€‚<code>HashMap</code>çš„è¿™ä¸€ç¼ºç‚¹å¾€å¾€ä¼šå¸¦æ¥å›°æ‰°ï¼Œå› ä¸ºæœ‰äº›åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœ‰åºçš„<code>Map</code>ã€‚<code>LinkedHashMap</code>å°±å¯ä»¥åšåˆ°ï¼Œå®ƒè™½ç„¶å¢åŠ äº†æ—¶é—´å’Œç©ºé—´ä¸Šçš„å¼€é”€ï¼Œä½†æ˜¯é€šè¿‡ç»´æŠ¤ä¸€ä¸ªè¿è¡Œäºæ‰€æœ‰æ¡ç›®çš„åŒå‘é“¾è¡¨ï¼Œ<code>LinkedHashMap</code>ä¿è¯äº†å…ƒç´ è¿­ä»£çš„é¡ºåºã€‚æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">https://blog.tengshe789.tech/</a></p><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>æ‰“å¼€æºç å¯ä»¥çœ‹åˆ°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashMap.Node subclass for normal LinkedHashMap entries.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">HashMap</span>.<span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        Entry&lt;K,V&gt; before, after;</span><br><span class="line">        Entry(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">super</span>(hash, key, value, next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>LinkedHashMap</code>ç»§æ‰¿äº†<code>HashMap</code>çš„<code>Entry</code>ï¼Œå¹¶æ–°å¢åŠ äº†ä¸¤ä¸ªæŒ‡é’ˆ</p><p><img src="/2018/07/18/å…³äºLinkedHashmapçš„ä¸ªäººç†è§£/1.png" alt="LinkedHashmapæ•°æ®ç»“æ„"></p><p>å‚ç…§ä¸€ä¸‹ç½‘ç»œä¸Šæœåˆ®çš„å›¾ç‰‡ï¼Œå¯ä»¥çœ‹å‡ºæ•°æ®ç»“æ„ä¸º<strong>æ•°ç»„ + å•é“¾è¡¨ + çº¢é»‘æ ‘ + åŒé“¾è¡¨</strong>ï¼Œæ¯”<code>HashMap</code>å¤šäº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå°±æ˜¯åˆ©ç”¨äº†å¤´èŠ‚ç‚¹å’Œå…¶ä½™çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´é€šè¿‡ <code>Entry</code> ä¸­çš„ <code>after</code> å’Œ <code>before</code> æŒ‡é’ˆè¿›è¡Œå…³è”ã€‚ </p><h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><p>çœ‹ä¸€ä¸‹æ„é€ æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(initialCapacity, loadFactor);</span><br><span class="line">        accessOrder = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(initialCapacity);</span><br><span class="line">        accessOrder = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        accessOrder = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        accessOrder = <span class="keyword">false</span>;</span><br><span class="line">        putMapEntries(m, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªçš„æ„é€ æ–¹æ³•ç¬¬ä¸€å¥è¯åŸºæœ¬éƒ½æ˜¯è°ƒç”¨çˆ¶ç±»<code>HashMap</code>æ–¹æ³•ã€‚ä¼°è®¡æ˜¯ç”¨å¤šæ€æ¥å®ç°çš„ç›¸å…³åŠŸèƒ½ã€‚æ¯” <code>HashMap</code> å¤šäº†ä¸€ä¸ª <code>accessOrder</code> çš„å‚æ•°ï¼Œç”¨æ¥æŒ‡å®šæŒ‰ç…§ <code>LRU</code> æ’åˆ—æ–¹å¼è¿˜æ˜¯é¡ºåºæ’å…¥çš„æ’åºæ–¹å¼</p><h3 id="æ·»åŠ "><a href="#æ·»åŠ " class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h3><p>çœ‹ <code>LinkedHashMap</code> çš„ <code>put()</code> æ–¹æ³•ä¹‹å‰å…ˆçœ‹çœ‹ <code>HashMap</code> çš„ <code>putVal</code> æ–¹æ³•ï¼š </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;K,V&gt; e; K k;</span><br><span class="line">            <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                e = p;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                            treeifyBin(tab, hash);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                =============================æ•²é»‘æ¿==========================================</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ++modCount;</span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™ç¯‡å·²ç»æ˜¯æˆ‘æ—©æœ‰å‡†å¤‡çš„ï¼Œç¬¬ä¸€æ¬¡çœ‹æºç çš„æ—¶å€™å·²ç»æƒŠäº†ã€‚<code>LinkedHashMap</code> è‡ªå·±æ²¡æœ‰é‡å†™<code>put</code>æ–¹æ³•ï¼Œå…¨æ˜¯ç…§ç€ä»–çˆ¹æ¬è¿‡æ¥çš„ï¼Œ<em>æ— èµ–</em> å•Šã€‚ä»£ç ä¸­æ•²é»‘æ¿ä½ç½®ï¼Œæ˜¯<code>LinkedHashMap</code> é‡å†™äº† <code>afterNodeAccess()</code> è¿™ä¸ªæ–¹æ³•ã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†æœ€è¿‘ä½¿ç”¨çš„Node eï¼Œæ”¾åœ¨é“¾è¡¨çš„æœ€æœ«å°¾</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterNodeAccess</span><span class="params">(Node&lt;K,V&gt; e)</span> </span>&#123; <span class="comment">// move node to last</span></span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; last;</span><br><span class="line">   <span class="comment">//ä»…å½“æŒ‰ç…§LRUåŸåˆ™ä¸”eä¸åœ¨æœ€æœ«å°¾ï¼Œæ‰æ‰§è¡Œä¿®æ”¹é“¾è¡¨ï¼Œå°†eç§»åˆ°é“¾è¡¨æœ€æœ«å°¾çš„æ“ä½œ</span></span><br><span class="line">    <span class="comment">//accessOrderä¸ºtrueåˆ™è¡¨ç¤ºæŒ‰ç…§åŸºäºè®¿é—®çš„é¡ºåºæ¥æ’åˆ—</span></span><br><span class="line">        <span class="keyword">if</span> (accessOrder &amp;&amp; (last = tail) != e) &#123;</span><br><span class="line">            <span class="comment">//å°†eèµ‹å€¼ä¸´æ—¶èŠ‚ç‚¹pï¼Œ bæ˜¯eçš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ aæ˜¯eçš„åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">                (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class="line">            <span class="comment">//èŠ‚ç‚¹ç§»åŠ¨è¿‡ç¨‹</span></span><br><span class="line">            p.after = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (b == <span class="keyword">null</span>)</span><br><span class="line">                head = a;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                b.after = a;</span><br><span class="line">            <span class="keyword">if</span> (a != <span class="keyword">null</span>)</span><br><span class="line">                a.before = b;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                last = b;</span><br><span class="line">            <span class="keyword">if</span> (last == <span class="keyword">null</span>)</span><br><span class="line">                head = p;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                p.before = last;</span><br><span class="line">                last.after = p;</span><br><span class="line">            &#125;</span><br><span class="line">            tail = p;</span><br><span class="line">            ++modCount;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p><img src="/2018/07/18/å…³äºLinkedHashmapçš„ä¸ªäººç†è§£/2aa6jef7ac.png" alt="2"></p><p>ç»“æŸ <br> æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢ æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼ŒjuejinåŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œç¼˜åˆ†å‘¢å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹~  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªè¦ä¸æ¶‰åŠçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒMapåŸºæœ¬éƒ½å¯ä»¥ä½¿ç”¨&lt;code&gt;HashMap&lt;/code&gt;ï¼Œä¸è¿‡&lt;code&gt;HashMap&lt;/code&gt;æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿­ä»£HashMapçš„é¡ºåºå¹¶ä¸æ˜¯&lt;code&gt;HashMap&lt;/code&gt;æ”¾ç½®çš„é¡ºåºã€‚&lt;code&gt;HashMap&lt;/c
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="æºç " scheme="https://tengshe789.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºConcurrentHashMap1.8çš„ä¸ªäººç†è§£</title>
    <link href="https://tengshe789.github.io/2018/07/17/ConcurrentHashMap1-8/"/>
    <id>https://tengshe789.github.io/2018/07/17/ConcurrentHashMap1-8/</id>
    <published>2018-07-17T04:13:36.000Z</published>
    <updated>2019-11-20T13:39:40.559Z</updated>
    
    <content type="html"><![CDATA[<p><code>ConcurrenHashMap</code> ã€‚ä¸‹é¢åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹<code>ConcurrentHashMap</code> çš„ç†è§£ï¼Œä¸»è¦ç”¨äºä¸ªäººå¤‡å¿˜ã€‚å¦‚æœæœ‰ä¸å¯¹ï¼Œè¯·æ‰¹è¯„ã€‚</p><p><code>HashMap</code>â€œä¸¥é‡â€çš„å‹¾èµ·äº†æˆ‘å¯¹<code>HashMap</code>å®¶æ—çš„å¥½å¥‡å¿ƒï¼Œä¸‹é¢åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹<code>ConcurrentHashMap</code> çš„ç†è§£ï¼Œä¸»è¦ç”¨äºä¸ªäººå¤‡å¿˜ã€‚å¦‚æœæœ‰ä¸å¯¹ï¼Œè¯·æ‰¹è¯„ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">https://blog.tengshe789.tech/</a></p><h3 id="æ€»èµ·"><a href="#æ€»èµ·" class="headerlink" title="æ€»èµ·"></a>æ€»èµ·</h3><p><code>HashMap</code>æ˜¯æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ç”¨çš„æ¯”è¾ƒå¤šçš„é›†åˆï¼Œä½†å®ƒæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨æ¶‰åŠåˆ°å¤šçº¿ç¨‹å¹¶å‘çš„æƒ…å†µï¼Œè¿›è¡Œgetæ“ä½œæœ‰å¯èƒ½ä¼šå¼•èµ·æ­»å¾ªç¯ï¼Œå¯¼è‡´CPUåˆ©ç”¨ç‡æ¥è¿‘100%ã€‚ </p><p>å› æ­¤éœ€è¦æ”¯æŒçº¿ç¨‹å®‰å…¨çš„å¹¶å‘å®¹å™¨ <code>ConcurrentHashMap</code> ã€‚</p><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p><img src="/2018/07/17/ConcurrentHashMap1-8/446.png" alt="img"> </p><h3 id="é‡è¦æˆå‘˜å˜é‡"><a href="#é‡è¦æˆå‘˜å˜é‡" class="headerlink" title="é‡è¦æˆå‘˜å˜é‡"></a>é‡è¦æˆå‘˜å˜é‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The array of bins. Lazily initialized upon first insertion.</span></span><br><span class="line"><span class="comment">   * Size is always a power of two. Accessed directly by iterators.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">transient</span> <span class="keyword">volatile</span> Node&lt;K,V&gt;[] table;</span><br></pre></td></tr></table></figure><p><code>table</code>ä»£è¡¨æ•´ä¸ªå“ˆå¸Œè¡¨ã€‚ é»˜è®¤ä¸ºnullï¼Œåˆå§‹åŒ–å‘ç”Ÿåœ¨ç¬¬ä¸€æ¬¡æ’å…¥æ“ä½œï¼Œé»˜è®¤å¤§å°ä¸º16çš„æ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨NodeèŠ‚ç‚¹æ•°æ®ï¼Œæ‰©å®¹æ—¶å¤§å°æ€»æ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The next table to use; non-null only while resizing.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node&lt;K,V&gt;[] nextTable;</span><br></pre></td></tr></table></figure><p><code>nextTable</code>æ˜¯ä¸€ä¸ªè¿æ¥è¡¨ï¼Œç”¨äºå“ˆå¸Œè¡¨æ‰©å®¹ï¼Œé»˜è®¤ä¸ºnullï¼Œæ‰©å®¹æ—¶æ–°ç”Ÿæˆçš„æ•°ç»„ï¼Œå…¶å¤§å°ä¸ºåŸæ•°ç»„çš„ä¸¤å€ã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Base counter value, used mainly when there is no contention,</span></span><br><span class="line"><span class="comment">    * but also as a fallback during table initialization</span></span><br><span class="line"><span class="comment">    * races. Updated via CAS.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">long</span> baseCount;</span><br></pre></td></tr></table></figure><p><code>baseCount</code>ä¿å­˜ç€æ•´ä¸ªå“ˆå¸Œè¡¨ä¸­å­˜å‚¨çš„æ‰€æœ‰çš„ç»“ç‚¹çš„ä¸ªæ•°æ€»å’Œï¼Œæœ‰ç‚¹ç±»ä¼¼äº HashMap çš„ size å±æ€§ã€‚ è¿™ä¸ªæ•°é€šè¿‡CASç®—æ³•æ›´æ–°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Table initialization and resizing control.  When negative, the</span></span><br><span class="line"><span class="comment">    * table is being initialized or resized: -1 for initialization,</span></span><br><span class="line"><span class="comment">    * else -(1 + the number of active resizing threads).  Otherwise,</span></span><br><span class="line"><span class="comment">    * when table is null, holds the initial table size to use upon</span></span><br><span class="line"><span class="comment">    * creation, or 0 for default. After initialization, holds the</span></span><br><span class="line"><span class="comment">    * next element count value upon which to resize the table.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">int</span> sizeCtl;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–å“ˆå¸Œè¡¨å’Œæ‰©å®¹ rehash çš„è¿‡ç¨‹ï¼Œéƒ½éœ€è¦ä¾èµ–<code>sizeCtl</code>ã€‚è¯¥å±æ€§æœ‰ä»¥ä¸‹å‡ ç§å–å€¼ï¼š</p><ul><li>0ï¼šé»˜è®¤å€¼</li><li>-1ï¼šä»£è¡¨å“ˆå¸Œè¡¨æ­£åœ¨è¿›è¡Œåˆå§‹åŒ–</li><li>å¤§äº0ï¼šç›¸å½“äº HashMap ä¸­çš„ thresholdï¼Œè¡¨ç¤ºé˜ˆå€¼</li><li>å°äº-1ï¼šä»£è¡¨æœ‰å¤šä¸ªçº¿ç¨‹æ­£åœ¨è¿›è¡Œæ‰©å®¹ã€‚ï¼ˆè­¬å¦‚ï¼š-N è¡¨ç¤ºæœ‰N-1ä¸ªçº¿ç¨‹æ­£åœ¨è¿›è¡Œæ‰©å®¹æ“ä½œ ï¼‰</li></ul><h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="keyword">int</span> cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; <span class="number">1</span>)) ?</span><br><span class="line">                   MAXIMUM_CAPACITY :</span><br><span class="line">                   tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; <span class="number">1</span>) + <span class="number">1</span>));<span class="comment">//MAXIMUM_CAPACITY = 1 &lt;&lt; 30</span></span><br><span class="line">        <span class="keyword">this</span>.sizeCtl = cap;<span class="comment">//ConcurrentHashMapåœ¨æ„é€ å‡½æ•°ä¸­åªä¼šåˆå§‹åŒ–sizeCtlå€¼ï¼Œå¹¶ä¸ä¼šç›´æ¥åˆå§‹åŒ–tableï¼Œè€Œæ˜¯å»¶ç¼“åˆ°ç¬¬ä¸€æ¬¡putæ“ä½œã€‚ </span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sizeCtl = DEFAULT_CAPACITY;<span class="comment">//DEFAULT_CAPACITY = 16</span></span><br><span class="line">        putAll(m);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ„é€ æ–¹æ³•æ˜¯ä¸‰ä¸ªã€‚é‡ç‚¹æ˜¯ç¬¬äºŒä¸ªï¼Œå¸¦å‚çš„æ„é€ æ–¹æ³•ã€‚è¿™ä¸ªå¸¦å‚çš„æ„é€ æ–¹æ³•ä¼šè°ƒç”¨<code>tableSizeFor()</code>æ–¹æ³•ï¼Œç¡®ä¿tableçš„å¤§å°æ€»æ˜¯2çš„å¹‚æ¬¡æ–¹ï¼ˆå‡è®¾å‚æ•°ä¸º100ï¼Œæœ€ç»ˆä¼šè°ƒæ•´æˆ256ï¼‰ã€‚ç®—æ³•å¦‚ä¸‹ï¼š </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a power of two table size for the given desired capacity.</span></span><br><span class="line"><span class="comment">     * See Hackers Delight, sec 3.2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = c - <span class="number">1</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="PUT-æ–¹æ³•"><a href="#PUT-æ–¹æ³•" class="headerlink" title="PUT()æ–¹æ³•"></a>PUT()æ–¹æ³•</h3><p><code>put()</code>è°ƒç”¨<code>putVal()</code>æ–¹æ³•ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(K key, V value, <span class="keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œåˆæ³•æ€§åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (key == <span class="keyword">null</span> || value == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">int</span> hash = spread(key.hashCode());<span class="comment">//è®¡ç®—é”®æ‰€å¯¹åº”çš„ hash å€¼</span></span><br><span class="line">        <span class="keyword">int</span> binCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;</span><br><span class="line">            Node&lt;K,V&gt; f; <span class="keyword">int</span> n, i, fh;</span><br><span class="line">            <span class="comment">//å¦‚æœå“ˆå¸Œè¡¨è¿˜æœªåˆå§‹åŒ–ï¼Œé‚£ä¹ˆåˆå§‹åŒ–å®ƒ</span></span><br><span class="line">            <span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">                tab = initTable();</span><br><span class="line"> <span class="comment">//æ ¹æ®hashå€¼è®¡ç®—å‡ºåœ¨tableé‡Œé¢çš„ä½ç½®</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="keyword">null</span>) &#123; </span><br><span class="line">                <span class="comment">//å¦‚æœè¿™ä¸ªä½ç½®æ²¡æœ‰å€¼ ï¼Œé‚£ä¹ˆä»¥CASæ— é”å¼å‘è¯¥ä½ç½®æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (casTabAt(tab, i, <span class="keyword">null</span>,</span><br><span class="line">                             <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key, value, <span class="keyword">null</span>)))</span><br><span class="line">                    <span class="keyword">break</span>;                   <span class="comment">// no lock when adding to empty bin</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//æ£€æµ‹åˆ°æ¡¶ç»“ç‚¹æ˜¯ ForwardingNode ç±»å‹ï¼ŒååŠ©æ‰©å®¹ï¼ˆMOVED  = -1; // hash for forwarding nodesï¼‰</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">                tab = helpTransfer(tab, f);</span><br><span class="line">            <span class="comment">//æ¡¶ç»“ç‚¹æ˜¯æ™®é€šçš„ç»“ç‚¹ï¼Œé”ä½è¯¥æ¡¶å¤´ç»“ç‚¹å¹¶è¯•å›¾åœ¨è¯¥é“¾è¡¨çš„å°¾éƒ¨æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                V oldVal = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">                        <span class="comment">//å‘æ™®é€šçš„é“¾è¡¨ä¸­æ·»åŠ å…ƒç´ </span></span><br><span class="line">                        <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                            binCount = <span class="number">1</span>;</span><br><span class="line">                            <span class="comment">//éå†é“¾è¡¨æ‰€æœ‰çš„ç»“ç‚¹</span></span><br><span class="line">                            <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">                                K ek;</span><br><span class="line">                                <span class="comment">//å¦‚æœhashå€¼å’Œkeyå€¼ç›¸åŒï¼Œåˆ™ä¿®æ”¹å¯¹åº”ç»“ç‚¹çš„valueå€¼</span></span><br><span class="line">                                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                                    ((ek = e.key) == key ||</span><br><span class="line">                                     (ek != <span class="keyword">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                                    oldVal = e.val;</span><br><span class="line">                                    <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                        e.val = value;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                Node&lt;K,V&gt; pred = e;</span><br><span class="line">                                <span class="comment">//å¦‚æœéå†åˆ°äº†æœ€åä¸€ä¸ªç»“ç‚¹ï¼Œé‚£ä¹ˆå°±è¯æ˜æ–°çš„èŠ‚ç‚¹éœ€è¦æ’å…¥é“¾è¡¨å°¾éƒ¨</span></span><br><span class="line">                                <span class="keyword">if</span> ((e = e.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                                    pred.next = <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key,</span><br><span class="line">                                                              value, <span class="keyword">null</span>);</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//å¦‚æœè¿™ä¸ªèŠ‚ç‚¹æ˜¯æ ‘èŠ‚ç‚¹ï¼Œå°±æŒ‰ç…§æ ‘çš„æ–¹å¼æ’å…¥å€¼</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;</span><br><span class="line">                            Node&lt;K,V&gt; p;</span><br><span class="line">                            binCount = <span class="number">2</span>;</span><br><span class="line">                            <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class="line">                                                           value)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                oldVal = p.val;</span><br><span class="line">                                <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                    p.val = value;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//å¦‚æœé“¾è¡¨é•¿åº¦å·²ç»è¾¾åˆ°ä¸´ç•Œå€¼8ï¼Œå°±éœ€è¦æŠŠé“¾è¡¨è½¬æ¢ä¸ºæ ‘ç»“æ„ï¼ˆTREEIFY_THRESHOLD = 8ï¼‰</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">                        treeifyBin(tab, i);</span><br><span class="line">                    <span class="keyword">if</span> (oldVal != <span class="keyword">null</span>)</span><br><span class="line">                        <span class="keyword">return</span> oldVal;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">   <span class="comment">//CAS å¼æ›´æ–°baseCountï¼Œå¹¶åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line">        addCount(<span class="number">1L</span>, binCount);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…¶å®putVal()ä¹Ÿå¤šå¤šå°‘å°‘æ‰ç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œè®©æˆ‘ä»¬ç»§ç»­æ¢ç©¶ä¸€ä¸‹ã€‚</p><h4 id="CASï¼ˆcompare-and-swapï¼‰"><a href="#CASï¼ˆcompare-and-swapï¼‰" class="headerlink" title="CASï¼ˆcompare and swapï¼‰"></a>CASï¼ˆcompare and swapï¼‰</h4><p>ç§‘æ™®compare and swapï¼Œè§£å†³å¤šçº¿ç¨‹å¹¶è¡Œæƒ…å†µä¸‹ä½¿ç”¨é”é€ æˆæ€§èƒ½æŸè€—çš„ä¸€ç§æœºåˆ¶ï¼ŒCASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€”å†…å­˜ä½ç½®ï¼ˆVï¼‰ã€é¢„æœŸåŸå€¼ï¼ˆAï¼‰å’Œæ–°å€¼(B)ã€‚å¦‚æœå†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼ã€‚å¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œå®ƒéƒ½ä¼šåœ¨CASæŒ‡ä»¤ä¹‹å‰è¿”å›è¯¥ä½ç½®çš„å€¼ã€‚CASæœ‰æ•ˆåœ°è¯´æ˜äº†â€œæˆ‘è®¤ä¸ºä½ç½®Våº”è¯¥åŒ…å«å€¼Aï¼›å¦‚æœåŒ…å«è¯¥å€¼ï¼Œåˆ™å°†Bæ”¾åˆ°è¿™ä¸ªä½ç½®ï¼›å¦åˆ™ï¼Œä¸è¦æ›´æ”¹è¯¥ä½ç½®ï¼Œåªå‘Šè¯‰æˆ‘è¿™ä¸ªä½ç½®ç°åœ¨çš„å€¼å³å¯ã€‚ </p><h4 id="spread"><a href="#spread" class="headerlink" title="spread"></a>spread</h4><p>é¦–å…ˆï¼Œç¬¬å››è¡Œå‡ºç°çš„<code>int hash = spread(key.hashCode());</code>è¿™æ˜¯ä¼ ç»Ÿçš„è®¡ç®—hashçš„æ–¹æ³•ã€‚keyçš„hashå€¼é«˜16ä½ä¸å˜ï¼Œä½16ä½ä¸é«˜16ä½å¼‚æˆ–ä½œä¸ºkeyçš„æœ€ç»ˆhashå€¼ã€‚ï¼ˆh &gt;&gt;&gt; 16ï¼Œè¡¨ç¤ºæ— ç¬¦å·å³ç§»16ä½ï¼Œé«˜ä½è¡¥0ï¼Œä»»ä½•æ•°è·Ÿ0å¼‚æˆ–éƒ½æ˜¯å…¶æœ¬èº«ï¼Œå› æ­¤keyçš„hashå€¼é«˜16ä½ä¸å˜ã€‚ï¼‰  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">spread</span><span class="params">(<span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> (h ^ (h &gt;&gt;&gt; <span class="number">16</span>)) &amp; HASH_BITS;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="initTable"><a href="#initTable" class="headerlink" title="initTable"></a>initTable</h4><p>ç¬¬åè¡Œï¼Œ <code>tab = initTable();</code>è¿™ä¸ªæ–¹æ³•çš„äº®ç‚¹æ˜¯ï¼Œå¯ä»¥è®©putå¹¶å‘æ‰§è¡Œï¼Œå®ç°tableåªåˆå§‹åŒ–ä¸€æ¬¡ ã€‚</p><blockquote><p>initTable()æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹å¯¹è¡¨è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹è¿›æ¥äº†ï¼Œé‚£ä¹ˆä¼šè®©å…¶ä»–çº¿ç¨‹äº¤å‡º CPU ç­‰å¾…ä¸‹æ¬¡ç³»ç»Ÿè°ƒåº¦ã€‚è¿™æ ·ï¼Œä¿è¯äº†è¡¨åŒæ—¶åªä¼šè¢«ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–ã€‚ </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Node&lt;K,V&gt;[] initTable() &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; <span class="keyword">int</span> sc;</span><br><span class="line">    <span class="comment">//å¦‚æœè¡¨ä¸ºç©ºæ‰è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">        <span class="keyword">while</span> ((tab = table) == <span class="keyword">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœä¸€ä¸ªçº¿ç¨‹å‘ç°sizeCtl&lt;0ï¼Œæ„å‘³ç€å¦å¤–çš„çº¿ç¨‹æ‰§è¡ŒCASæ“ä½œæˆåŠŸï¼Œå½“å‰çº¿ç¨‹åªéœ€è¦è®©å‡ºcpuæ—¶é—´ç‰‡ï¼ˆæ”¾å¼ƒ CPU çš„ä½¿ç”¨ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> ((sc = sizeCtl) &lt; <span class="number">0</span>)</span><br><span class="line">                Thread.yield(); <span class="comment">// lost initialization race; just spin</span></span><br><span class="line">            <span class="comment">//å¦åˆ™è¯´æ˜è¿˜æœªæœ‰çº¿ç¨‹å¯¹è¡¨è¿›è¡Œåˆå§‹åŒ–ï¼Œé‚£ä¹ˆæœ¬çº¿ç¨‹å°±æ¥åšè¿™ä¸ªå·¥ä½œ</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt(<span class="keyword">this</span>, SIZECTL, sc, -<span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="comment">//sc å¤§äºé›¶è¯´æ˜å®¹é‡å·²ç»åˆå§‹åŒ–äº†ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å®¹é‡</span></span><br><span class="line">                        <span class="keyword">int</span> n = (sc &gt; <span class="number">0</span>) ? sc : DEFAULT_CAPACITY;</span><br><span class="line">                        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">                        Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node&lt;?,?&gt;[n];</span><br><span class="line">                        table = tab = nt;</span><br><span class="line">                        <span class="comment">//è®¡ç®—é˜ˆå€¼ï¼Œç­‰æ•ˆäº n*0.75</span></span><br><span class="line">                        sc = n - (n &gt;&gt;&gt; <span class="number">2</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">//è®¾ç½®é˜ˆå€¼</span></span><br><span class="line">                    sizeCtl = sc;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tab;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œç¬¬19è¡Œã€‚ <code>tab = helpTransfer(tab, f);</code>è¿™å¥è¯ã€‚è¦äº†è§£è¿™ä¸ªï¼Œé¦–å…ˆéœ€è¦çŸ¥é“<code>ForwardingNode</code> è¿™ä¸ªèŠ‚ç‚¹ç±»å‹ã€‚å®ƒä¸€ä¸ªç”¨äºè¿æ¥ä¸¤ä¸ª<code>table</code>çš„èŠ‚ç‚¹ç±»ã€‚å®ƒåŒ…å«ä¸€ä¸ª<code>nextTable</code>æŒ‡é’ˆï¼Œç”¨äºæŒ‡å‘ä¸‹ä¸€å¼ hashè¡¨ã€‚è€Œä¸”è¿™ä¸ªèŠ‚ç‚¹çš„keyã€valueã€nextæŒ‡é’ˆå…¨éƒ¨ä¸ºnullï¼Œå®ƒçš„hashå€¼ä¸ºMOVEDï¼ˆstatic final int <code>MOVED</code>    = -1ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ForwardingNode</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Node&lt;K,V&gt;[] nextTable;</span><br><span class="line">        ForwardingNode(Node&lt;K,V&gt;[] tab) &#123;</span><br><span class="line">            <span class="keyword">super</span>(MOVED, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">this</span>.nextTable = tab;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//findçš„æ–¹æ³•æ˜¯ä»nextTableé‡Œè¿›è¡ŒæŸ¥è¯¢èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ä»¥è‡ªèº«ä¸ºå¤´èŠ‚ç‚¹è¿›è¡ŒæŸ¥æ‰¾ </span></span><br><span class="line">    <span class="function">Node&lt;K,V&gt; <span class="title">find</span><span class="params">(<span class="keyword">int</span> h, Object k)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// loop to avoid arbitrarily deep recursion on forwarding nodes</span></span><br><span class="line">            outer: <span class="keyword">for</span> (Node&lt;K,V&gt;[] tab = nextTable;;) &#123;</span><br><span class="line">                Node&lt;K,V&gt; e; <span class="keyword">int</span> n;</span><br><span class="line">                <span class="keyword">if</span> (k == <span class="keyword">null</span> || tab == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span> ||</span><br><span class="line">                    (e = tabAt(tab, (n - <span class="number">1</span>) &amp; h)) == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                    <span class="keyword">int</span> eh; K ek;</span><br><span class="line">                    <span class="keyword">if</span> ((eh = e.hash) == h &amp;&amp;</span><br><span class="line">                        ((ek = e.key) == k || (ek != <span class="keyword">null</span> &amp;&amp; k.equals(ek))))</span><br><span class="line">                        <span class="keyword">return</span> e;</span><br><span class="line">                    <span class="keyword">if</span> (eh &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ForwardingNode) &#123;</span><br><span class="line">                            tab = ((ForwardingNode&lt;K,V&gt;)e).nextTable;</span><br><span class="line">                            <span class="keyword">continue</span> outer;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            <span class="keyword">return</span> e.find(h, k);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> ((e = e.next) == <span class="keyword">null</span>)</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="helpTransfer"><a href="#helpTransfer" class="headerlink" title="helpTransfer"></a>helpTransfer</h4><p>åœ¨æ‰©å®¹æ“ä½œä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªæ¡¶ä¸­çš„ç»“ç‚¹è¿›è¡Œåˆ†ç¦»å’Œè½¬ç§»ã€‚å¦‚æœæŸä¸ªæ¡¶ç»“ç‚¹ä¸­æ‰€æœ‰èŠ‚ç‚¹éƒ½å·²ç»è¿ç§»å®Œæˆäº†ï¼ˆå·²ç»è¢«è½¬ç§»åˆ°æ–°è¡¨ nextTable ä¸­äº†ï¼‰ï¼Œé‚£ä¹ˆä¼šåœ¨åŸ table è¡¨çš„è¯¥ä½ç½®æŒ‚ä¸Šä¸€ä¸ª ForwardingNode ç»“ç‚¹ï¼Œè¯´æ˜æ­¤æ¡¶å·²ç»å®Œæˆè¿ç§»ã€‚</p><p><code>helpTransfer</code>ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿæ˜¯æ£€æµ‹åˆ°å½“å‰å“ˆå¸Œè¡¨æ­£åœ¨æ‰©å®¹ï¼Œç„¶åè®©å½“å‰çº¿ç¨‹å»ååŠ©æ‰©å®¹ ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] helpTransfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt; f) &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] nextTab; <span class="keyword">int</span> sc;</span><br><span class="line">        <span class="keyword">if</span> (tab != <span class="keyword">null</span> &amp;&amp; (f <span class="keyword">instanceof</span> ForwardingNode) &amp;&amp;</span><br><span class="line">            (nextTab = ((ForwardingNode&lt;K,V&gt;)f).nextTable) != <span class="keyword">null</span>) &#123;<span class="comment">//æ–°çš„tableï¼ŒnextTabå·²ç»å­˜åœ¨å‰æä¸‹æ‰èƒ½å¸®åŠ©æ‰©å®¹</span></span><br><span class="line">            <span class="keyword">int</span> rs = resizeStamp(tab.length);<span class="comment">//è¿”å›ä¸€ä¸ª 16 ä½é•¿åº¦çš„æ‰©å®¹æ ¡éªŒæ ‡è¯†</span></span><br><span class="line">            <span class="keyword">while</span> (nextTab == nextTable &amp;&amp; table == tab &amp;&amp;</span><br><span class="line">                   (sc = sizeCtl) &lt; <span class="number">0</span>) &#123;<span class="comment">//sizeCtl å¦‚æœå¤„äºæ‰©å®¹çŠ¶æ€çš„è¯</span></span><br><span class="line">                <span class="keyword">if</span> ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + <span class="number">1</span> ||</span><br><span class="line">                    sc == rs + MAX_RESIZERS || transferIndex &lt;= <span class="number">0</span>)</span><br><span class="line">                  <span class="comment">//å‰ 16 ä½æ˜¯æ•°æ®æ ¡éªŒæ ‡è¯†ï¼Œå 16 ä½æ˜¯å½“å‰æ­£åœ¨æ‰©å®¹çš„çº¿ç¨‹æ€»æ•°</span></span><br><span class="line">            <span class="comment">//è¿™é‡Œåˆ¤æ–­æ ¡éªŒæ ‡è¯†æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœæ ¡éªŒç¬¦ä¸ç­‰æˆ–è€…æ‰©å®¹æ“ä½œå·²ç»å®Œæˆäº†ï¼Œç›´æ¥é€€å‡ºå¾ªç¯ï¼Œä¸ç”¨ååŠ©å®ƒä»¬æ‰©å®¹äº†</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">if</span> (U.compareAndSwapInt(<span class="keyword">this</span>, SIZECTL, sc, sc + <span class="number">1</span>)) &#123;<span class="comment">//sc + 1 æ ‡è¯†å¢åŠ äº†ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ‰©å®¹</span></span><br><span class="line">                    transfer(tab, nextTab);<span class="comment">//è°ƒç”¨æ‰©å®¹æ–¹æ³•</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> nextTab;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> table;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>helpTransfer</code>ç²¾é«“çš„æ˜¯å¯ä»¥è°ƒç”¨å¤šä¸ªå·¥ä½œçº¿ç¨‹ä¸€èµ·å¸®åŠ©è¿›è¡Œæ‰©å®¹ï¼Œè¿™æ ·çš„æ•ˆç‡å°±ä¼šæ›´é«˜ï¼Œè€Œä¸æ˜¯åªæœ‰æ£€æŸ¥åˆ°è¦æ‰©å®¹çš„é‚£ä¸ªçº¿ç¨‹è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œå…¶ä»–çº¿ç¨‹å°±è¦ç­‰å¾…æ‰©å®¹æ“ä½œå®Œæˆæ‰èƒ½å·¥ä½œã€‚ </p><h4 id="transfer"><a href="#transfer" class="headerlink" title="transfer"></a>transfer</h4><p>æ—¢ç„¶è¿™é‡Œæ¶‰åŠåˆ°æ‰©å®¹çš„æ“ä½œï¼Œæˆ‘ä»¬ä¹Ÿä¸€èµ·æ¥çœ‹çœ‹æ‰©å®¹æ–¹æ³•<code>transferï¼ˆï¼‰</code> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = tab.length, stride;</span><br><span class="line">    <span class="comment">//è®¡ç®—å•ä¸ªçº¿ç¨‹å…è®¸å¤„ç†çš„æœ€å°‘tableæ¡¶é¦–èŠ‚ç‚¹ä¸ªæ•°ï¼Œä¸èƒ½å°äº 16</span></span><br><span class="line">        <span class="keyword">if</span> ((stride = (NCPU &gt; <span class="number">1</span>) ? (n &gt;&gt;&gt; <span class="number">3</span>) / NCPU : n) &lt; MIN_TRANSFER_STRIDE)</span><br><span class="line">            stride = MIN_TRANSFER_STRIDE; <span class="comment">// subdivide range</span></span><br><span class="line">     <span class="comment">//åˆšå¼€å§‹æ‰©å®¹ï¼Œåˆå§‹åŒ– nextTab </span></span><br><span class="line">        <span class="keyword">if</span> (nextTab == <span class="keyword">null</span>) &#123;            <span class="comment">// initiating</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">                Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node&lt;?,?&gt;[n &lt;&lt; <span class="number">1</span>];</span><br><span class="line">                nextTab = nt;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable ex) &#123;      <span class="comment">// try to cope with OOME</span></span><br><span class="line">                sizeCtl = Integer.MAX_VALUE;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            nextTable = nextTab;</span><br><span class="line">            <span class="comment">//transferIndex æŒ‡å‘æœ€åä¸€ä¸ªæ¡¶ï¼Œæ–¹ä¾¿ä»åå‘å‰éå† </span></span><br><span class="line">            transferIndex = n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> nextn = nextTab.length;</span><br><span class="line">       <span class="comment">//å®šä¹‰ ForwardingNode ç”¨äºæ ‡è®°è¿ç§»å®Œæˆçš„æ¡¶</span></span><br><span class="line">        ForwardingNode&lt;K,V&gt; fwd = <span class="keyword">new</span> ForwardingNode&lt;K,V&gt;(nextTab);</span><br><span class="line">        <span class="keyword">boolean</span> advance = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">boolean</span> finishing = <span class="keyword">false</span>; <span class="comment">// to ensure sweep before committing nextTab</span></span><br><span class="line">    <span class="comment">//i æŒ‡å‘å½“å‰æ¡¶ï¼Œbound æŒ‡å‘å½“å‰çº¿ç¨‹éœ€è¦å¤„ç†çš„æ¡¶ç»“ç‚¹çš„åŒºé—´ä¸‹é™</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, bound = <span class="number">0</span>;;) &#123;</span><br><span class="line">            Node&lt;K,V&gt; f; <span class="keyword">int</span> fh;</span><br><span class="line">            <span class="comment">//éå†å½“å‰çº¿ç¨‹æ‰€åˆ†é…åˆ°çš„æ¡¶ç»“ç‚¹</span></span><br><span class="line">            <span class="keyword">while</span> (advance) &#123;</span><br><span class="line">                <span class="keyword">int</span> nextIndex, nextBound;</span><br><span class="line">                <span class="keyword">if</span> (--i &gt;= bound || finishing)</span><br><span class="line">                    advance = <span class="keyword">false</span>;</span><br><span class="line">                <span class="comment">//transferIndex &lt;= 0 è¯´æ˜å·²ç»æ²¡æœ‰éœ€è¦è¿ç§»çš„æ¡¶äº†</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((nextIndex = transferIndex) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    i = -<span class="number">1</span>;</span><br><span class="line">                    advance = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//æ›´æ–° transferIndex</span></span><br><span class="line">           <span class="comment">//ä¸ºå½“å‰çº¿ç¨‹åˆ†é…ä»»åŠ¡ï¼Œå¤„ç†çš„æ¡¶ç»“ç‚¹åŒºé—´ä¸ºï¼ˆnextBound,nextIndexï¼‰</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt</span><br><span class="line">                         (<span class="keyword">this</span>, TRANSFERINDEX, nextIndex,</span><br><span class="line">                          nextBound = (nextIndex &gt; stride ?</span><br><span class="line">                                       nextIndex - stride : <span class="number">0</span>))) &#123;</span><br><span class="line">                    bound = nextBound;</span><br><span class="line">                    i = nextIndex - <span class="number">1</span>;</span><br><span class="line">                    advance = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">             <span class="comment">//å½“å‰çº¿ç¨‹æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">            <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= n || i + n &gt;= nextn) &#123;</span><br><span class="line">                <span class="keyword">int</span> sc;</span><br><span class="line">                <span class="keyword">if</span> (finishing) &#123;</span><br><span class="line">                    nextTable = <span class="keyword">null</span>;</span><br><span class="line">                    table = nextTab;</span><br><span class="line">                    sizeCtl = (n &lt;&lt; <span class="number">1</span>) - (n &gt;&gt;&gt; <span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (U.compareAndSwapInt(<span class="keyword">this</span>, SIZECTL, sc = sizeCtl, sc - <span class="number">1</span>)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((sc - <span class="number">2</span>) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    finishing = advance = <span class="keyword">true</span>;</span><br><span class="line">                    i = n; <span class="comment">// recheck before commit</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¾…è¿ç§»æ¡¶ä¸ºç©ºï¼Œé‚£ä¹ˆåœ¨æ­¤ä½ç½® CAS æ·»åŠ  ForwardingNode ç»“ç‚¹æ ‡è¯†è¯¥æ¡¶å·²ç»è¢«å¤„ç†è¿‡äº†</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i)) == <span class="keyword">null</span>)</span><br><span class="line">                advance = casTabAt(tab, i, <span class="keyword">null</span>, fwd);</span><br><span class="line">            <span class="comment">//å¦‚æœæ‰«æåˆ° ForwardingNodeï¼Œè¯´æ˜æ­¤æ¡¶å·²ç»è¢«å¤„ç†è¿‡äº†ï¼Œè·³è¿‡å³å¯</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">                advance = <span class="keyword">true</span>; <span class="comment">// already processed</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">                        Node&lt;K,V&gt; ln, hn;</span><br><span class="line">                        <span class="comment">//é“¾è¡¨çš„è¿ç§»æ“ä½œ</span></span><br><span class="line">                        <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">int</span> runBit = fh &amp; n;</span><br><span class="line">                            Node&lt;K,V&gt; lastRun = f;</span><br><span class="line">                            <span class="comment">//æ•´ä¸ª for å¾ªç¯ä¸ºäº†æ‰¾åˆ°æ•´ä¸ªæ¡¶ä¸­æœ€åè¿ç»­çš„ fh &amp; n ä¸å˜çš„ç»“ç‚¹</span></span><br><span class="line">                            <span class="keyword">for</span> (Node&lt;K,V&gt; p = f.next; p != <span class="keyword">null</span>; p = p.next) &#123;</span><br><span class="line">                                <span class="keyword">int</span> b = p.hash &amp; n;</span><br><span class="line">                                <span class="keyword">if</span> (b != runBit) &#123;</span><br><span class="line">                                    runBit = b;</span><br><span class="line">                                    lastRun = p;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span> (runBit == <span class="number">0</span>) &#123;</span><br><span class="line">                                ln = lastRun;</span><br><span class="line">                                hn = <span class="keyword">null</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                hn = lastRun;</span><br><span class="line">                                ln = <span class="keyword">null</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">for</span> (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) &#123;</span><br><span class="line">                                <span class="keyword">int</span> ph = p.hash; K pk = p.key; V pv = p.val;</span><br><span class="line">                                <span class="keyword">if</span> ((ph &amp; n) == <span class="number">0</span>)</span><br><span class="line">                                    ln = <span class="keyword">new</span> Node&lt;K,V&gt;(ph, pk, pv, ln);</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    hn = <span class="keyword">new</span> Node&lt;K,V&gt;(ph, pk, pv, hn);</span><br><span class="line">                            &#125;</span><br><span class="line">                            setTabAt(nextTab, i, ln);</span><br><span class="line">                            setTabAt(nextTab, i + n, hn);</span><br><span class="line">                            setTabAt(tab, i, fwd);</span><br><span class="line">                            advance = <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//çº¢é»‘æ ‘çš„å¤åˆ¶ç®—æ³•ï¼Œ</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;</span><br><span class="line">                            TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f;</span><br><span class="line">                            TreeNode&lt;K,V&gt; lo = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                            TreeNode&lt;K,V&gt; hi = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                            <span class="keyword">int</span> lc = <span class="number">0</span>, hc = <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">for</span> (Node&lt;K,V&gt; e = t.first; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">                                <span class="keyword">int</span> h = e.hash;</span><br><span class="line">                                TreeNode&lt;K,V&gt; p = <span class="keyword">new</span> TreeNode&lt;K,V&gt;</span><br><span class="line">                                    (h, e.key, e.val, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">                                <span class="keyword">if</span> ((h &amp; n) == <span class="number">0</span>) &#123;</span><br><span class="line">                                    <span class="keyword">if</span> ((p.prev = loTail) == <span class="keyword">null</span>)</span><br><span class="line">                                        lo = p;</span><br><span class="line">                                    <span class="keyword">else</span></span><br><span class="line">                                        loTail.next = p;</span><br><span class="line">                                    loTail = p;</span><br><span class="line">                                    ++lc;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="keyword">if</span> ((p.prev = hiTail) == <span class="keyword">null</span>)</span><br><span class="line">                                        hi = p;</span><br><span class="line">                                    <span class="keyword">else</span></span><br><span class="line">                                        hiTail.next = p;</span><br><span class="line">                                    hiTail = p;</span><br><span class="line">                                    ++hc;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                            ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) :</span><br><span class="line">                                (hc != <span class="number">0</span>) ? <span class="keyword">new</span> TreeBin&lt;K,V&gt;(lo) : t;</span><br><span class="line">                            hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) :</span><br><span class="line">                                (lc != <span class="number">0</span>) ? <span class="keyword">new</span> TreeBin&lt;K,V&gt;(hi) : t;</span><br><span class="line">                            setTabAt(nextTab, i, ln);</span><br><span class="line">                            setTabAt(nextTab, i + n, hn);</span><br><span class="line">                            setTabAt(tab, i, fwd);</span><br><span class="line">                            advance = <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œputæ–¹æ³•è®²å®Œäº†</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™~"></a>å‚è€ƒèµ„æ–™~</h3><p><a href="https://www.cnblogs.com/yangming1996/p/8031199.html" target="_blank" rel="noopener">å‚è€ƒèµ„æ–™</a></p><p>æ„Ÿè°¢</p><p>ç»“æŸ <br>æ­¤ç‰‡å®Œäº†~ æƒ³è¦äº†è§£æ›´å¤šç²¾å½©æ–°å§¿åŠ¿ï¼Ÿ<br>è¯·è®¿é—®æˆ‘çš„<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">ä¸ªäººåšå®¢</a> æœ¬ç¯‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå·²åœ¨ä¸ªäººåšå®¢ç‡å…ˆå‘è¡¨ï¼ŒéšåCSDNï¼Œsegmentfaultï¼Œæ˜é‡‘ï¼Œç®€ä¹¦ï¼Œå¼€æºä¸­å›½åŒæ­¥å‘å‡ºã€‚å¦‚æœ‰é›·åŒï¼Œç¼˜åˆ†å‘¢å…„å¼Ÿã€‚èµ¶å¿«åŠ ä¸ªå¥½å‹~  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;code&gt;ConcurrenHashMap&lt;/code&gt; ã€‚ä¸‹é¢åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹&lt;code&gt;ConcurrentHashMap&lt;/code&gt; çš„ç†è§£ï¼Œä¸»è¦ç”¨äºä¸ªäººå¤‡å¿˜ã€‚å¦‚æœæœ‰ä¸å¯¹ï¼Œè¯·æ‰¹è¯„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;HashMap&lt;/code&gt;â€œä¸¥é‡â€çš„å‹¾èµ·äº†æˆ‘å¯¹&lt;code&gt;
      
    
    </summary>
    
    
      <category term="æºç " scheme="https://tengshe789.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>HashSetåŸç†</title>
    <link href="https://tengshe789.github.io/2018/07/17/HashSet%E5%8E%9F%E7%90%86/"/>
    <id>https://tengshe789.github.io/2018/07/17/HashSetåŸç†/</id>
    <published>2018-07-17T03:48:08.000Z</published>
    <updated>2019-11-20T13:39:40.561Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h1><p><code>HashSet</code> æ˜¯ä¸€ä¸ªä¸å…è®¸å­˜å‚¨é‡å¤å…ƒç´ çš„é›†åˆã€‚ <code>HashSet</code>å®ç°<code>Set</code>æ¥å£ï¼Œç”±å“ˆå¸Œè¡¨ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ª<code>HashMap</code>å®ä¾‹ï¼‰æ”¯æŒã€‚å®ƒä¸ä¿è¯set çš„è¿­ä»£é¡ºåºï¼›ç‰¹åˆ«æ˜¯å®ƒä¸ä¿è¯è¯¥é¡ºåºæ’ä¹…ä¸å˜ã€‚æ­¤ç±»å…è®¸ä½¿ç”¨nullå…ƒç´ ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">https://blog.tengshe789.tech/</a></p><h3 id="HashSetå’ŒHashMapæ¯”è¾ƒ"><a href="#HashSetå’ŒHashMapæ¯”è¾ƒ" class="headerlink" title="HashSetå’ŒHashMapæ¯”è¾ƒ"></a>HashSetå’ŒHashMapæ¯”è¾ƒ</h3><h4 id="HashSetï¼š"><a href="#HashSetï¼š" class="headerlink" title="HashSetï¼š"></a>HashSetï¼š</h4><p>ã€€ã€€<code>HashSet</code>å®ç°äº†<code>Set</code>æ¥å£ï¼Œå®ƒä¸å…è®¸é›†åˆä¸­å‡ºç°é‡å¤å…ƒç´ ã€‚å½“æˆ‘ä»¬æåˆ°<code>HashSet</code>æ—¶ï¼Œç¬¬ä¸€ä»¶äº‹å°±æ˜¯åœ¨å°†å¯¹è±¡å­˜å‚¨åœ¨</p><p><code>HashSet</code>ä¹‹å‰ï¼Œè¦ç¡®ä¿é‡å†™<code>hashCodeï¼ˆï¼‰</code>æ–¹æ³•å’Œ<code>equalsï¼ˆï¼‰</code>æ–¹æ³•ï¼Œè¿™æ ·æ‰èƒ½æ¯”è¾ƒå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œç¡®ä¿é›†åˆä¸­æ²¡æœ‰</p><p>å‚¨å­˜ç›¸åŒçš„å¯¹è±¡ã€‚å¦‚æœä¸é‡å†™ä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°†ä½¿ç”¨ä¸‹é¢æ–¹æ³•é»˜è®¤å®ç°ï¼š</p><p>ã€€public boolean add(Object obj)æ–¹æ³•ç”¨åœ¨Setæ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœå…ƒç´ å€¼é‡å¤æ—¶è¿”å› â€œfalseâ€ï¼Œå¦‚æœæ·»åŠ æˆåŠŸåˆ™è¿”å›â€trueâ€</p><h4 id="HashMapï¼š"><a href="#HashMapï¼š" class="headerlink" title="HashMapï¼š"></a>HashMapï¼š</h4><p>ã€€ã€€<code>HashMap</code>å®ç°äº†<code>Map</code>æ¥å£ï¼ŒMapæ¥å£å¯¹é”®å€¼å¯¹è¿›è¡Œæ˜ å°„ã€‚<code>Map</code>ä¸­ä¸å…è®¸å‡ºç°é‡å¤çš„é”®ï¼ˆKeyï¼‰ã€‚<code>Map</code>æ¥å£æœ‰ä¸¤ä¸ªåŸºæœ¬çš„å®ç°</p><p>TreeMapå’ŒHashMapã€‚TreeMapä¿å­˜äº†å¯¹è±¡çš„æ’åˆ—æ¬¡åºï¼Œè€Œ<code>HashMap</code>ä¸èƒ½ã€‚<code>HashMap</code>å¯ä»¥æœ‰ç©ºçš„é”®å€¼å¯¹ï¼ˆKeyï¼ˆnullï¼‰-Valueï¼ˆnullï¼‰ï¼‰</p><p><code>HashMap</code>æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼ˆéSynchronizeï¼‰ï¼Œè¦æƒ³å®ç°çº¿ç¨‹å®‰å…¨ï¼Œé‚£ä¹ˆéœ€è¦è°ƒç”¨collectionsç±»çš„é™æ€æ–¹æ³•synchronizeMapï¼ˆï¼‰å®ç°ã€‚</p><p>public Object put(Object Key,Object value)æ–¹æ³•ç”¨æ¥å°†å…ƒç´ æ·»åŠ åˆ°<code>map</code>ä¸­ã€‚ </p><h2 id="æˆå‘˜å˜é‡"><a href="#æˆå‘˜å˜é‡" class="headerlink" title="æˆå‘˜å˜é‡"></a>æˆå‘˜å˜é‡</h2><p>é¦–å…ˆäº†è§£ä¸‹ <code>HashSet</code> çš„æˆå‘˜å˜é‡:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”¨transientå…³é”®å­—æ ‡è®°çš„æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ–è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> HashMap&lt;E,Object&gt; map;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Dummy value to associate with an Object in the backing Map</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object PRESENT = <span class="keyword">new</span> Object();</span><br></pre></td></tr></table></figure><p>å‘ç°ä¸»è¦å°±ä¸¤ä¸ªå˜é‡:</p><ul><li><code>map</code> ï¼šç”¨äºå­˜æ”¾æœ€ç»ˆæ•°æ®çš„ã€‚</li><li><code>PRESENT</code> ï¼šæ˜¯æ‰€æœ‰å†™å…¥ map çš„ <code>value</code> å€¼ã€‚</li></ul><h2 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°å¾ˆç®€å•ï¼Œåˆ©ç”¨äº† <code>HashMap</code> åˆå§‹åŒ–äº† <code>map</code> ã€‚</p><h2 id="add"><a href="#add" class="headerlink" title="add"></a>add</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒå…³é”®çš„å°±æ˜¯è¿™ä¸ª <code>add()</code> æ–¹æ³•ã€‚ å¯ä»¥çœ‹å‡ºå®ƒæ˜¯å°†å­˜æ”¾çš„å¯¹è±¡å½“åšäº† <code>HashMap</code> çš„å¥ï¼Œ<code>value</code> éƒ½æ˜¯ç›¸åŒçš„ <code>PRESENT</code> ã€‚ç”±äº <code>HashMap</code> çš„ <code>key</code> æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œæ‰€ä»¥æ¯å½“æœ‰é‡å¤çš„å€¼å†™å…¥åˆ° <code>HashSet</code> æ—¶ï¼Œ<code>value</code> ä¼šè¢«è¦†ç›–ï¼Œä½† <code>key</code> ä¸ä¼šæ”¶åˆ°å½±å“ï¼Œè¿™æ ·å°±ä¿è¯äº† <code>HashSet</code> ä¸­åªèƒ½å­˜æ”¾ä¸é‡å¤çš„å…ƒç´ ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>HashSet</code> çš„åŸç†æ¯”è¾ƒç®€å•ï¼Œå‡ ä¹å…¨éƒ¨å€ŸåŠ©äº <code>HashMap</code> æ¥å®ç°çš„ã€‚</p><p>æ‰€ä»¥ <code>HashMap</code> ä¼šå‡ºç°çš„é—®é¢˜ <code>HashSet</code> ä¾ç„¶ä¸èƒ½é¿å…ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;HashSet&quot;&gt;&lt;a href=&quot;#HashSet&quot; class=&quot;headerlink&quot; title=&quot;HashSet&quot;&gt;&lt;/a&gt;HashSet&lt;/h1&gt;&lt;p&gt;&lt;code&gt;HashSet&lt;/code&gt; æ˜¯ä¸€ä¸ªä¸å…è®¸å­˜å‚¨é‡å¤å…ƒç´ çš„é›†åˆã€‚ &lt;code&gt;HashSe
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="æºç " scheme="https://tengshe789.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜</title>
    <link href="https://tengshe789.github.io/2018/07/11/%E5%88%86%E4%BA%AB%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E5%8F%88%E5%A4%8D%E6%9D%82%E7%9A%84%E7%A8%8B%E5%BA%8F%E9%80%89%E6%8B%A9%E9%A2%98/"/>
    <id>https://tengshe789.github.io/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/</id>
    <published>2018-07-11T10:45:52.000Z</published>
    <updated>2019-11-20T13:39:41.216Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨ç‰›å®¢ç½‘åˆ·é¢˜ï¼Œçœ‹è§ä¸€ä¸ªéå¸¸ç®€å•åˆå¾ˆå¤æ‚çš„é¢˜ç›®ï¼Œæˆ‘ç°åœ¨æ¥åˆ†äº«ä¸€ä¸‹ã€‚</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p><p>é¢˜ç›®æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> B().getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">int</span> value;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">                setValue(v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.value = value;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    value++;</span><br><span class="line">                    <span class="keyword">return</span> value;</span><br><span class="line">                &#125; <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    System.out.println(e.toString());</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">this</span>.setValue(value);</span><br><span class="line">                    System.out.println(value);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span>&#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">B</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>(<span class="number">5</span>);</span><br><span class="line">                setValue(getValue() - <span class="number">3</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.setValue(<span class="number">2</span> * value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®è®©å†™å‡ºä¸Šè¿°ä»£ç æ‰§è¡Œå®Œæˆåçš„è¾“å‡ºç»“æœ</p><p>è¿™é“é¢˜è€ƒçš„å…¶å®å°±æ˜¯ä»£ç æ‰§è¡Œé¡ºåºçš„çŸ¥è¯†ï¼Œæ¯”è¾ƒåŸºç¡€çš„ä¸œè¥¿ã€‚é¦–å…ˆï¼Œç”¨IDEAæ‰“ä¸€ä¸‹æ–­ç‚¹ï¼Œå¦‚å›¾ï¼š</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/1.png" alt=""></p><p>é¦–å…ˆèµ°ä¸»å‡½æ•°ï¼Œnew Bï¼Œè¿›å…¥Bçš„æ„é€ æ–¹æ³•</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/2.png" alt=""></p><p>å¹¶å°†çˆ¶ç±»Aä¼ å…¥5ï¼ˆå½“å­ç±»æ„é€ å™¨ä¸­æ²¡æœ‰ä½¿ç”¨â€super(å‚æ•°æˆ–æ— å‚æ•°)â€æŒ‡å®šè°ƒç”¨çˆ¶ç±»æ„é€ å™¨æ—¶ï¼Œæ˜¯é»˜è®¤è°ƒç”¨çˆ¶ç±»çš„æ— å‚æ„é€ å™¨ï¼Œå¦‚æœçˆ¶ç±»ä¸­åŒ…å«æœ‰å‚æ„é€ å™¨ï¼Œå´æ²¡æœ‰æ— å‚æ„é€ å™¨ï¼Œåˆ™åœ¨å­ç±»æ„é€ å™¨ä¸­ä¸€å®šè¦ä½¿ç”¨â€œsuper(å‚æ•°)â€æŒ‡å®šè°ƒç”¨çˆ¶ç±»çš„æœ‰å‚æ„é€ å™¨ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™ã€‚ ï¼‰</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/3.png" alt=""></p><p>è°ƒç”¨çˆ¶ç±»çš„setValueæ–¹æ³•ï¼Œç”±äºå­ç±»å·²å°†å…¶é‡å†™ï¼Œæ‰€ä»¥ç›´æ¥åˆ°å­ç±»{</p><p>æ•²é»‘æ¿ï¼š</p><p>1.çˆ¶ç±»ï¼Œå­ç±»ä¹‹é—´è½¬å‹çš„é—®é¢˜ï¼Œå½“çˆ¶ç±»å£°æ˜æŒ‡å‘å­ç±»å¯¹è±¡ï¼Œä¼šå‘ç”Ÿéšå¼å‘ä¸Šè½¬å‹ã€‚</p><p>2.ç¼–è¯‘æ—¶æ‰€å‚è€ƒçš„å¯¹è±¡ç±»å‹æ˜¯å£°æ˜å¯¹è±¡æ‰€ç”¨çš„ç±»å‹ï¼Œè€Œè¿è¡Œæ—¶åˆ™æ˜¯å‚è€ƒå¯¹è±¡å®ä¾‹åŒ–çš„ç±»å‹ã€‚</p><p>3.å½“å­ç±»é‡å†™äº†çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œä¼šå°†çˆ¶ç±»çš„æ–¹æ³•è¿›è¡Œéšè—ï¼Œå› æ­¤è¿™è¾¹<strong>æœ€åè°ƒåˆ°çš„éƒ½æ˜¯å­ç±»é‡å†™çš„æ–¹æ³•ã€‚</strong></p><p>}</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/4.png" alt=""></p><p>ç°åœ¨å›åˆ°value=10</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/5.png" alt=""></p><p>ç°åœ¨valueæ˜¯10ï¼Œå‡†å¤‡è¿›å…¥geiValueé˜¶æ®µ</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/6.png" alt=""></p><p>è¿˜æ˜¯10</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/7.png" alt=""></p><p>åœ¨è¿™é‡Œè¿”å›valueï¼Œæ­¤æ—¶valueæ˜¯11</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/8.png" alt=""></p><p>try{}catch{}æ‰§è¡Œå®Œä¸€å®šè¦èµ°finnally</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/9.png" alt=""></p><p>valueæ˜¯22äº†</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/10.png" alt=""></p><p>ç»ˆäºå¼€å§‹æ‰“å°äº†ï¼Œæ‰“å°ç¬¬ä¸€ä¸ªæ•°å­—ï¼š22</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/11.png" alt=""></p><p>è¿”å›value =22</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/12.png" alt=""></p><p>å›åˆ°åˆšåˆšBé‚£é‡Œï¼Œç¬¬ä¸€æ¬¡è¿”å›çš„valueæ˜¯11ï¼Œå°†11-3=8</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/13.png" alt=""></p><p>å°†8*2=16å¾—åˆ°value</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/14.png" alt=""></p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/15.png" alt=""></p><p>å›åˆ°ä¸»æ–¹æ³•</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/16.png" alt=""></p><p>å†èµ°ä¸€è¾¹getValueï¼ˆï¼‰</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/17.png" alt=""></p><p>è¿›å…¥finallyï¼Œå†å°†value*2=34</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/18.png" alt=""></p><p>ç¬¬äºŒä¸ªæ•°å­—å‡ºæ¥äº†ï¼Œæ‰“å°34ï¼Œç„¶åè¿”å›3</p><p><img src="/2018/07/11/åˆ†äº«ä¸€ä¸ªç®€å•åˆå¤æ‚çš„ç¨‹åºé€‰æ‹©é¢˜/19.png" alt=""></p><p>åˆ°è¿™é‡Œä¸»å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œä½†æ˜¯æ³¨æ„äº†ã€‚ç¬¬äºŒæ¬¡è¿”å›å€¼æ˜¯17ï¼Œç¬¬ä¸‰æ¬¡æ˜¯34ã€‚åˆ°äº†æœ€ååˆè¾“å‡ºäº†getValueï¼ˆï¼‰ç¬¬äºŒæ¬¡çš„è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯17 </p><p><strong>æ‰€ä»¥æ•´ä¸ªè¿‡ç¨‹æ‰§è¡Œå®Œåçš„è¾“å‡ºç»“æœæ˜¯22ã€34ã€17ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</strong> </p><p>è¿™ä¸ªé¢˜æœ‰äº›è¯­å¥æœ‰ç‚¹å¤šä½™ï¼Œè­¬å¦‚finallyä»£ç å—åé¢returnæ°¸è¿œç”¨ä¸ä¸Šã€‚</p><p><strong>è¿™é“é¢˜è™½ç„¶é¥¶äº†å¾ˆå¤šå¼¯ï¼Œä½†ç»†ç»†å“å‘³åå…¶å®å¹¶æ²¡é‚£ä¹ˆéš¾ï¼Œè€ƒç‚¹æ˜¯ï¼š</strong></p><p><strong>1.è‡ªç±»ç»§æ‰¿çˆ¶ç±»ï¼Œè°ƒç”¨æ–¹æ³•æ—¶å…ˆæ˜¯è°ƒç”¨å­ç±»ä¸­çš„æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰å°±è°ƒç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³•ã€‚</strong></p><p><strong>2.try{ }ã€catch{ }ã€finally{ }è¿”å›å€¼çš„é—®é¢˜ï¼Œä¸€æ—¦try{ }ä¸­è¿”å›äº†æŸä¸€ä¸ªå€¼ï¼Œå¦‚æœfinallyæœ‰è¿”å›å€¼ï¼Œfinallyä¸­çš„è¿”å›å€¼ä¼šè¦†ç›–tryçš„è¿”å›å€¼ï¼Œå¦‚æœfinallyæ²¡æœ‰è¿”å›å€¼ï¼Œå°±æ˜¯tryä¸­çš„è¿”å›å€¼ã€‚</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©åœ¨ç‰›å®¢ç½‘åˆ·é¢˜ï¼Œçœ‹è§ä¸€ä¸ªéå¸¸ç®€å•åˆå¾ˆå¤æ‚çš„é¢˜ç›®ï¼Œæˆ‘ç°åœ¨æ¥åˆ†äº«ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.tengshe789.tech/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æˆ‘çš„åšå®¢&lt;/a&gt;&lt;/p
      
    
    </summary>
    
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
      <category term="é”™é¢˜" scheme="https://tengshe789.github.io/tags/%E9%94%99%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºHashmapçš„ä¸ªäººç†è§£</title>
    <link href="https://tengshe789.github.io/2018/07/08/%E5%85%B3%E4%BA%8EHashmap%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%90%86%E8%A7%A3/"/>
    <id>https://tengshe789.github.io/2018/07/08/å…³äºHashmapçš„ä¸ªäººç†è§£/</id>
    <published>2018-07-08T15:01:27.000Z</published>
    <updated>2019-11-20T13:39:41.172Z</updated>
    
    <content type="html"><![CDATA[<p>åˆšåˆšçœ‹åˆ°QQç¾¤æœ‰äººå¹<code>Hashmap</code>ï¼Œä¸€æƒ³æˆ‘å•¥éƒ½ä¸æ‡‚ï¼Œå°±èµ¶å¿«è¡¥äº†ä¸€æ³¢ã€‚ä¸‹é¢åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹<code>Hashmap</code>çš„ç†è§£ï¼Œä¸»è¦ç”¨äºä¸ªäººå¤‡å¿˜ã€‚å¦‚æœæœ‰ä¸å¯¹ï¼Œè¯·æ‰¹è¯„ã€‚æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">https://blog.tengshe789.tech/</a></p><h3 id="æ€»èµ·"><a href="#æ€»èµ·" class="headerlink" title="æ€»èµ·"></a>æ€»èµ·</h3><p><code>Hashmap</code>æ˜¯æ•£åˆ—è¡¨ï¼Œå­˜å‚¨ç»“æ„æ˜¯é”®å€¼å¯¹å½¢å¼ã€‚æ ¹æ®å¥çš„Hashcodeå€¼å­˜å‚¨æ•°æ®ï¼Œæœ‰è¾ƒå¿«çš„è®¿é—®é€Ÿåº¦ã€‚</p><p>å®ƒçš„çº¿ç¨‹æ˜¯ä¸å®‰å…¨çš„ï¼Œåœ¨ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å°è¯•æ‰©å®¹HashMapæ—¶ï¼Œå¯èƒ½å°†ä¸€ä¸ªé“¾è¡¨å½¢æˆç¯å½¢çš„é“¾è¡¨ï¼Œæ‰€æœ‰çš„nextéƒ½ä¸ä¸ºç©ºï¼Œè¿›å…¥æ­»å¾ªç¯ï¼›è¦æƒ³è®©å®ƒå®‰å…¨ï¼Œå¯ä»¥ç”¨ <code>Collections</code>çš„synchronizedMap æ–¹æ³•ä½¿ <code>HashMap</code>å…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨<code>ConcurrentHashMap</code> ã€‚</p><p>ä»–çš„é”®å€¼å¯¹éƒ½å¯ä»¥ä¸ºç©ºï¼Œæ˜ å°„ä¸æ˜¯æœ‰åºçš„ã€‚</p><p>Hashmapæœ‰ä¸¤ä¸ªå‚æ•°å½±å“æ€§èƒ½ï¼šåˆå§‹å®¹é‡ï¼ŒåŠ è½½å› å­ã€‚</p><h3 id="Hashmapå­˜å‚¨ç»“æ„"><a href="#Hashmapå­˜å‚¨ç»“æ„" class="headerlink" title="Hashmapå­˜å‚¨ç»“æ„"></a>Hashmapå­˜å‚¨ç»“æ„</h3><p>JDK1.8ä¸­<code>Hashmap</code>æ˜¯ç”±é“¾è¡¨ã€çº¢é»‘æ ‘ã€æ•°ç»„å®ç°çš„</p><p><img src="https://images2015.cnblogs.com/blog/938494/201702/938494-20170217113451550-1406894023.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”¨æ¥å®ç°æ•°ç»„ã€é“¾è¡¨çš„æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> hash;<span class="comment">//ä¿å­˜èŠ‚ç‚¹çš„Hash</span></span><br><span class="line">        <span class="keyword">final</span> K key;<span class="comment">//ä¿å­˜èŠ‚ç‚¹çš„é”®å€¼</span></span><br><span class="line">        V value;<span class="comment">//ä¿å­˜èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        Node&lt;K,V&gt; next;<span class="comment">//æŒ‡å‘é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">        Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.hash = hash;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> K <span class="title">getKey</span><span class="params">()</span>        </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">getValue</span><span class="params">()</span>      </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">setValue</span><span class="params">(V newValue)</span> </span>&#123;</span><br><span class="line">            V oldValue = value;</span><br><span class="line">            value = newValue;</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Map.Entry) &#123;</span><br><span class="line">                Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line">                <span class="keyword">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class="line">                    Objects.equals(value, e.getValue()))</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="Hashmapæ„é€ æ–¹æ³•"><a href="#Hashmapæ„é€ æ–¹æ³•" class="headerlink" title="Hashmapæ„é€ æ–¹æ³•"></a>Hashmapæ„é€ æ–¹æ³•</h3><p><code>HashMap</code>æœ‰4ä¸ªæ„é€ æ–¹æ³•ã€‚</p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–¹æ³•1.åˆ¶å®šåˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal initial capacity: "</span> +</span><br><span class="line">                    initialCapacity);</span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">            initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">        <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal load factor: "</span> +</span><br><span class="line">                    loadFactor);</span><br><span class="line">        <span class="keyword">this</span>.loadFactor = loadFactor;</span><br><span class="line">        <span class="keyword">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•2.æŒ‡å®šåˆå§‹å®¹é‡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•ä¸‰ã€‚æ— å‚æ„é€ ã€‚</span></span><br><span class="line">     HashMap() &#123;</span><br><span class="line">        <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•å››ã€‚å°†å¦ä¸€ä¸ª Map ä¸­çš„æ˜ å°„æ‹·è´ä¸€ä»½åˆ°è‡ªå·±çš„å­˜å‚¨ç»“æ„ä¸­æ¥ï¼Œè¿™ä¸ªæ–¹æ³•ä¸æ˜¯å¾ˆå¸¸ç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class="line">        putMapEntries(m, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="Hashmapå˜é‡æˆå‘˜"><a href="#Hashmapå˜é‡æˆå‘˜" class="headerlink" title="Hashmapå˜é‡æˆå‘˜"></a>Hashmapå˜é‡æˆå‘˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœªæŒ‡å®šå®¹é‡çš„æ—¶å€™ï¼Œæ•°ç»„çš„åˆå§‹å®¹é‡ã€‚åˆå§‹å®¹é‡æ˜¯16</span></span><br><span class="line"><span class="comment">//ä¸ºä»€ä¹ˆä¸ç›´æ¥å†™16ï¼Ÿå› ä¸ºé€Ÿåº¦å¿«ã€‚è®¡ç®—æœºé‡Œé¢è¦è½¬æ¢äºŒè¿›åˆ¶ã€‚</span></span><br><span class="line"><span class="comment">//å¿…é¡»2çš„næ¬¡å¹‚</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è´Ÿè½½å› å­ã€‚å½“hashmapå®¹é‡è¶…è¿‡ å®¹é‡*è´Ÿè½½å› å­ æ—¶ï¼Œè¿›è¡Œæ‰©å®¹æ“ä½œï¼ˆresizeï¼ˆï¼‰ï¼‰</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¡®å®šä½•æ—¶å°†hashå†²çªçš„é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”¨æ¥ç¡®ä½•æ—¶å°†çº¢é»‘æ ‘è½¬æ¢æˆé“¾è¡¨</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNTREEIFY_THRESHOLD = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å½“é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘æ—¶ï¼Œéœ€è¦åˆ¤æ–­æ•°ç»„å®¹é‡ã€‚è‹¥æ•°ç»„å®¹é‡å¤ªå°å¯¼è‡´hashå†²çªå¤ªå¤šï¼Œåˆ™ä¸è¿›è¡Œçº¢é»‘æ ‘æ“ä½œï¼Œè½¬è€Œåˆ©ç”¨reseizeæ‰©å®¹</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="number">64</span>;</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹å®¹é‡ã€è´Ÿè½½å› å­ã€é˜ˆå€¼"><a href="#åˆå§‹å®¹é‡ã€è´Ÿè½½å› å­ã€é˜ˆå€¼" class="headerlink" title="åˆå§‹å®¹é‡ã€è´Ÿè½½å› å­ã€é˜ˆå€¼."></a>åˆå§‹å®¹é‡ã€è´Ÿè½½å› å­ã€é˜ˆå€¼.</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ— å‚æ„é€ æ–¹æ³•åˆ›å»º <code>HashMap</code>ã€‚ä½†å½“æˆ‘ä»¬å¯¹æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦æœ‰è¦æ±‚çš„æ—¶å€™ï¼Œä½¿ç”¨é»˜è®¤å€¼æœ‰æ—¶å¯èƒ½è¾¾ä¸åˆ°æˆ‘ä»¬çš„è¦æ±‚ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ‰‹åŠ¨è°ƒå‚ã€‚ </p><p>åœ¨ HashMap æ„é€ æ–¹æ³•ä¸­ï¼Œå¯ä¾›æˆ‘ä»¬è°ƒæ•´çš„å‚æ•°æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯åˆå§‹å®¹é‡<code>initialCapacity</code>ï¼Œå¦ä¸€ä¸ªè´Ÿè½½å› å­<code>loadFactor</code>ã€‚é€šè¿‡è¿™ä¸¤ä¸ªè®¾å®šè¿™ä¸¤ä¸ªå‚æ•°ï¼Œå¯ä»¥è¿›ä¸€æ­¥å½±å“é˜ˆå€¼å¤§å°ã€‚ä½†åˆå§‹é˜ˆå€¼ <code>threshold</code> ä»…ç”±<code>initialCapacity</code> ç»è¿‡ç§»ä½æ“ä½œè®¡ç®—å¾—å‡ºã€‚ </p><table><thead><tr><th style="text-align:left">åç§°</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td style="text-align:left">initialCapacity</td><td>HashMap åˆå§‹å®¹é‡</td></tr><tr><td style="text-align:left">loadFactor</td><td>è´Ÿè½½å› å­</td></tr><tr><td style="text-align:left">threshold</td><td>å½“å‰ HashMap æ‰€èƒ½å®¹çº³é”®å€¼å¯¹æ•°é‡çš„æœ€å¤§å€¼ï¼Œè¶…è¿‡è¿™ä¸ªå€¼ï¼Œåˆ™éœ€æ‰©å®¹</td></tr></tbody></table><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒHashMap åˆå§‹å®¹é‡æ˜¯16ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚ æ³¨é‡Šä¸­æœ‰è¯´æ˜ï¼Œé˜ˆå€¼å¯ç”±å®¹é‡ä¹˜ä¸Šè´Ÿè½½å› å­è®¡ç®—è€Œæ¥ ï¼Œå³<code>threshold = capacity * loadFactor</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> cap)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = cap - <span class="number">1</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æœ‰ç‚¹éš¾ï¼Œæ ¹æ®å¤§ç¥çš„è¯´æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ„æ€æ˜¯ï¼Œ<strong>æ‰¾åˆ°å¤§äºæˆ–ç­‰äº cap çš„æœ€å°2çš„å¹‚</strong>ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ <strong>tableSizeFor</strong> æ–¹æ³•çš„å›¾è§£ ï¼š</p><p><img src="https://blog-pictures.oss-cn-shanghai.aliyuncs.com/15159249414047.jpg" alt=""></p><p>å›¾ä¸­å®¹é‡æ˜¯2<sup>29</sup>+1ï¼Œè®¡ç®—åæ˜¯2<sup>30</sup></p><p>å¼•ç”¨ä¸€ä¸‹å•Šå¤§ç¥è¯´çš„ï¼š</p><blockquote><p>å¯¹äº HashMap æ¥è¯´ï¼Œè´Ÿè½½å› å­æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å‚æ•°ï¼Œè¯¥å‚æ•°ååº”äº† HashMap æ¡¶æ•°ç»„çš„ä½¿ç”¨æƒ…å†µï¼ˆå‡è®¾é”®å€¼å¯¹èŠ‚ç‚¹å‡åŒ€åˆ†å¸ƒåœ¨æ¡¶æ•°ç»„ä¸­ï¼‰ã€‚é€šè¿‡è°ƒèŠ‚è´Ÿè½½å› å­ï¼Œå¯ä½¿ HashMap æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ä¸Šæœ‰ä¸åŒçš„è¡¨ç°ã€‚å½“æˆ‘ä»¬è°ƒä½è´Ÿè½½å› å­æ—¶ï¼ŒHashMap æ‰€èƒ½å®¹çº³çš„é”®å€¼å¯¹æ•°é‡å˜å°‘ã€‚æ‰©å®¹æ—¶ï¼Œé‡æ–°å°†é”®å€¼å¯¹å­˜å‚¨æ–°çš„æ¡¶æ•°ç»„é‡Œï¼Œé”®çš„é”®ä¹‹é—´äº§ç”Ÿçš„ç¢°æ’ä¼šä¸‹é™ï¼Œé“¾è¡¨é•¿åº¦å˜çŸ­ã€‚æ­¤æ—¶ï¼ŒHashMap çš„å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œçš„æ•ˆç‡å°†ä¼šå˜é«˜ï¼Œè¿™é‡Œæ˜¯å…¸å‹çš„æ‹¿ç©ºé—´æ¢æ—¶é—´ã€‚ç›¸åï¼Œå¦‚æœå¢åŠ è´Ÿè½½å› å­ï¼ˆè´Ÿè½½å› å­å¯ä»¥å¤§äº1ï¼‰ï¼ŒHashMap æ‰€èƒ½å®¹çº³çš„é”®å€¼å¯¹æ•°é‡å˜å¤šï¼Œç©ºé—´åˆ©ç”¨ç‡é«˜ï¼Œä½†ç¢°æ’ç‡ä¹Ÿé«˜ã€‚è¿™æ„å‘³ç€é“¾è¡¨é•¿åº¦å˜é•¿ï¼Œæ•ˆç‡ä¹Ÿéšä¹‹é™ä½ï¼Œè¿™ç§æƒ…å†µæ˜¯æ‹¿æ—¶é—´æ¢ç©ºé—´ã€‚è‡³äºè´Ÿè½½å› å­æ€ä¹ˆè°ƒèŠ‚ï¼Œè¿™ä¸ªçœ‹ä½¿ç”¨åœºæ™¯äº†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨é»˜è®¤å€¼å°±å¯ä»¥äº†ã€‚</p></blockquote><h3 id="æ’å…¥PUT"><a href="#æ’å…¥PUT" class="headerlink" title="æ’å…¥PUT"></a>æ’å…¥PUT</h3><p>è¿‡ç¨‹ï¼š</p><ol><li>å¯¹Keyæ±‚hashå€¼ï¼Œç„¶åè®¡ç®—ä¸‹æ ‡</li><li>å¦‚æœæ²¡æœ‰ç¢°æ’ï¼Œå°±æ”¾å…¥æ¡¶ä¸­</li><li>å¦‚æœç¢°æ’äº†ï¼Œå°±ä»¥é“¾è¡¨å½¢å¼æ”¾åˆ°åé¢</li><li>å¦‚æœé“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼ï¼Œå°±æŠŠé“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘</li><li>å¦‚æœé“¾è¡¨å­˜åœ¨åˆ™æ›¿æ¢æ—§å€¼</li><li>å¦‚æœæ¡¶æ»¡äº†ï¼ˆå®¹é‡*è´Ÿè½½å› å­ï¼‰ï¼Œåˆ™é‡æ–°resize</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è°ƒç”¨æ ¸å¿ƒæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="putVal"><a href="#putVal" class="headerlink" title="putVal"></a>putVal</h4><p>æ ¸å¿ƒç®—æ³•åœ¨putValï¼ˆï¼‰ä¸­ã€‚è¦æƒ³ç†è§£ï¼Œå…ˆè¦æ˜ç™½<strong>æ¡¶æ’åº(Bucket Sort)</strong></p><p>å®ƒæ˜¯è¿„ä»Šä¸ºæ­¢æœ€å¿«çš„ä¸€ç§æ’åºæ³•ï¼Œå…¶<strong>æ—¶é—´å¤æ‚åº¦ä»…ä¸ºÎŸ(n)</strong>ï¼Œä¹Ÿå°±æ˜¯çº¿æ€§å¤æ‚åº¦ã€‚</p><p>æ¡¶æ’åºæ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>æ ¹æ®æ•°æ®è§„æ¨¡nåˆ’åˆ†ï¼Œmä¸ªç›¸åŒå¤§å°çš„åŒºé—´ ï¼ˆæ¯ä¸ªåŒºé—´ä¸ºä¸€ä¸ªæ¡¶ï¼Œæ¡¶å¯ç†è§£ä¸ºå®¹å™¨ï¼‰</strong>  ã€‚å°†nä¸ªå…ƒç´ <strong>æŒ‰ç…§è§„å®šèŒƒå›´</strong>åˆ†å¸ƒåˆ°å„ä¸ªæ¡¶ä¸­å» ï¼Œå†å¯¹æ¯ä¸ªæ¡¶ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºï¼Œæ’åºæ–¹æ³•å¯æ ¹æ®éœ€è¦ï¼Œé€‰æ‹©å¿«é€Ÿæ’åºï¼Œæˆ–è€…å½’å¹¶æ’åºï¼Œæˆ–è€…æ’å…¥æ’åº ï¼Œç„¶åä¾æ¬¡ä»æ¯ä¸ªæ¡¶ä¸­å–å‡ºå…ƒç´ ï¼ŒæŒ‰é¡ºåºæ”¾å…¥åˆ°æœ€åˆçš„è¾“å‡ºåºåˆ—ä¸­(ç›¸å½“äºæŠŠæ‰€æœ‰çš„æ¡¶ä¸­çš„å…ƒç´ åˆå¹¶åˆ°ä¸€èµ·) ã€‚</p><p>ä¸‹é¢æ˜¯ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//næ˜¯æ•°ç»„é•¿åº¦</span></span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ¡¶æ•°ç»„æ˜¯å¦æ˜¯ç©º</span></span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            <span class="comment">//æ˜¯å°±ç”¨resizeï¼ˆï¼‰åˆå§‹åŒ–</span></span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">//æ ¹æ® hash å€¼ç¡®å®šèŠ‚ç‚¹åœ¨æ•°ç»„ä¸­çš„æ’å…¥ä½ç½®</span></span><br><span class="line">    <span class="comment">//è‹¥æ­¤ä½ç½®æ²¡æœ‰å…ƒç´ åˆ™è¿›è¡Œæ’å…¥ï¼Œæ³¨æ„ç¡®å®šæ’å…¥ä½ç½®æ‰€ç”¨çš„è®¡ç®—æ–¹æ³•ä¸ºã€€(n - 1) &amp; hash,ç”±äºã€€n ä¸€å®šæ˜¯ï¼’çš„å¹‚æ¬¡ï¼Œè¿™ä¸ªæ“ä½œç›¸å½“äºhash % n</span></span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">            <span class="comment">//å°†æ–°èŠ‚ç‚¹å¼•å…¥æ¡¶ä¸­</span></span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//ä¸´æ—¶å˜é‡eè¿›è¡Œè®°å½•ã€‚å¦‚æœæœ‰å€¼ï¼Œè¯´æ˜ä»…ä»…æ˜¯å€¼çš„è¦†ç›–ã€‚</span></span><br><span class="line">            Node&lt;K,V&gt; e; K k;</span><br><span class="line">            <span class="comment">// å¦‚æœé”®çš„å€¼ä»¥åŠèŠ‚ç‚¹ hash ç­‰äºé“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹èŠ‚ç‚¹æ—¶ï¼Œåˆ™å°† e æŒ‡å‘è¯¥é”®å€¼å¯¹</span></span><br><span class="line">            <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                e = p;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)<span class="comment">// å¦‚æœæ¡¶ä¸­çš„å¼•ç”¨ç±»å‹ä¸º TreeNodeï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ’å…¥æ–¹æ³•</span></span><br><span class="line">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">            <span class="keyword">else</span> &#123;<span class="comment">// å¯¹é“¾è¡¨è¿›è¡Œéå†ï¼Œå¹¶ç»Ÿè®¡é“¾è¡¨é•¿åº¦</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                        <span class="comment">// é“¾è¡¨ä¸­ä¸åŒ…å«è¦æ’å…¥çš„é”®å€¼å¯¹èŠ‚ç‚¹æ—¶ï¼Œåˆ™å°†è¯¥èŠ‚ç‚¹æ¥åœ¨é“¾è¡¨çš„æœ€å</span></span><br><span class="line">                        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                            treeifyBin(tab, hash);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ä¸´æ—¶å˜é‡eä¸ä¸ºç©ºæ—¶ï¼Œè¯´æ˜å·²ç»æœ‰å€¼è¿›è¡Œæ›¿æ¢äº†</span></span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="comment">//è¿”å›è€å€¼</span></span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ++modCount;</span><br><span class="line">    <span class="comment">//æ‰©å®¹</span></span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="HASH"><a href="#HASH" class="headerlink" title="HASH"></a>HASH</h4><p>hashç®—æ³•ï¼Œé«˜åå…­ä½ä¸ä½åå…­è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä½¿å¾—åˆ°ç»“æœä¼šå°½å¯èƒ½ä¸åŒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> h;</span><br><span class="line">        <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="resize"><a href="#resize" class="headerlink" title="resize"></a>resize</h4><blockquote><p>HashMap çš„æ‰©å®¹æœºåˆ¶ä¸å…¶ä»–å˜é•¿é›†åˆçš„å¥—è·¯ä¸å¤ªä¸€æ ·ï¼ŒHashMap æŒ‰å½“å‰æ¡¶æ•°ç»„é•¿åº¦çš„2å€è¿›è¡Œæ‰©å®¹ï¼Œé˜ˆå€¼ä¹Ÿå˜ä¸ºåŸæ¥çš„2å€ï¼ˆå¦‚æœè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œé˜ˆå€¼æº¢å‡ºå½’é›¶ï¼Œåˆ™æŒ‰é˜ˆå€¼å…¬å¼é‡æ–°è®¡ç®—ï¼‰ã€‚æ‰©å®¹ä¹‹åï¼Œè¦é‡æ–°è®¡ç®—é”®å€¼å¯¹çš„ä½ç½®ï¼Œå¹¶æŠŠå®ƒä»¬ç§»åŠ¨åˆ°åˆé€‚çš„ä½ç½®ä¸Šå»ã€‚</p></blockquote><p>resizeæ€»å…±åšäº†3ä»¶äº‹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ol><li>è®¡ç®—æ–°æ¡¶æ•°ç»„çš„å®¹é‡ newCap å’Œæ–°é˜ˆå€¼ newThr</li><li>æ ¹æ®è®¡ç®—å‡ºçš„ newCap åˆ›å»ºæ–°çš„æ¡¶æ•°ç»„ï¼Œæ¡¶æ•°ç»„ table ä¹Ÿæ˜¯åœ¨è¿™é‡Œè¿›è¡Œåˆå§‹åŒ–çš„</li><li>å°†é”®å€¼å¯¹èŠ‚ç‚¹é‡æ–°æ˜ å°„åˆ°æ–°çš„æ¡¶æ•°ç»„é‡Œã€‚å¦‚æœèŠ‚ç‚¹æ˜¯ TreeNode ç±»å‹ï¼Œåˆ™éœ€è¦æ‹†åˆ†çº¢é»‘æ ‘ã€‚å¦‚æœæ˜¯æ™®é€šèŠ‚ç‚¹ï¼Œåˆ™èŠ‚ç‚¹æŒ‰åŸé¡ºåºè¿›è¡Œåˆ†ç»„ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//resizeï¼ˆï¼‰å‡½æ•°åœ¨sizeã€€&gt; thresholdæ—¶è¢«è°ƒç”¨</span></span><br><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">        <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">        <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">        <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//oldCapå¤§äº 0 ä»£è¡¨åŸæ¥çš„ table éç©º</span></span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// å½“ table å®¹é‡è¶…è¿‡å®¹é‡æœ€å¤§å€¼ï¼Œåˆ™ä¸å†æ‰©å®¹</span></span><br><span class="line">            <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">                <span class="comment">//é˜ˆå€¼è®¾ä¸ºæ•´å½¢æœ€å¤§å€¼</span></span><br><span class="line">                threshold = Integer.MAX_VALUE;</span><br><span class="line">                <span class="keyword">return</span> oldTab;</span><br><span class="line">            &#125;<span class="comment">// æŒ‰æ—§å®¹é‡å’Œé˜ˆå€¼çš„2å€è®¡ç®—æ–°å®¹é‡å’Œé˜ˆå€¼çš„å¤§å°</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                     oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">                newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            *oldCap å°äºç­‰äº 0 ä¸” oldThr å¤§äº0ï¼Œä»£è¡¨ç”¨æˆ·åˆ›å»ºäº†ä¸€ä¸ª HashMapï¼Œä½†æ˜¯ä½¿ç”¨çš„æ„é€ å‡½æ•°ä¸º</span></span><br><span class="line"><span class="comment">       * HashMap(int initialCapacity, float loadFactor) æˆ– HashMap(int initialCapacity)</span></span><br><span class="line"><span class="comment">       * æˆ– HashMap(Map&lt;? extends K, ? extends V&gt; m)ï¼Œå¯¼è‡´ oldTab ä¸º nullï¼ŒoldCap ä¸º0ï¼Œ</span></span><br><span class="line"><span class="comment">       * oldThr ä¸ºç”¨æˆ·æŒ‡å®šçš„ HashMapçš„åˆå§‹å®¹é‡</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            newCap = oldThr;</span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="comment">//è®¾ç½®æ–°å®¹é‡å’Œæ–°é˜ˆå€¼å¤§å°</span></span><br><span class="line">            newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">            newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// newThr ä¸º 0 æ—¶ï¼ŒæŒ‰é˜ˆå€¼è®¡ç®—å…¬å¼è¿›è¡Œè®¡ç®—</span></span><br><span class="line">        <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//è®¡ç®—æ–°é˜ˆå€¼</span></span><br><span class="line">            <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">            newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                      (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//å‡†å¤‡åˆå§‹åŒ–è¿‡ç¨‹</span></span><br><span class="line">        threshold = newThr;</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)</span><br><span class="line">            Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">        table = newTab;</span><br><span class="line">        <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//éå†ã€‚æŠŠã€€oldTab ä¸­çš„èŠ‚ç‚¹ã€€reHash åˆ°ã€€newTab ä¸­å»</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">                Node&lt;K,V&gt; e;</span><br><span class="line">                <span class="comment">//åˆ¤æ–­è€æ•°ç»„æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">                <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//ä¸ä¸ºç©ºï¼Œè®¾æˆç©º</span></span><br><span class="line">                    oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="comment">//è‹¥èŠ‚ç‚¹æ˜¯å•ä¸ªèŠ‚ç‚¹ï¼Œç›´æ¥é‡æ–°åˆ†é…å®šä½</span></span><br><span class="line">                    <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                        newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                    <span class="comment">//è‹¥èŠ‚ç‚¹æ˜¯ã€€TreeNode èŠ‚ç‚¹ï¼Œè¦è¿›è¡Œ çº¢é»‘æ ‘çš„ rehashã€€æ“ä½œ</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                        ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">                    <span class="comment">//è‹¥æ˜¯é“¾è¡¨ï¼Œè¿›è¡Œé“¾è¡¨çš„ rehashã€€æ“ä½œ</span></span><br><span class="line">                    <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                        Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                        Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                        Node&lt;K,V&gt; next;</span><br><span class="line">                        <span class="comment">// éå†é“¾è¡¨ï¼Œå¹¶å°†é“¾è¡¨èŠ‚ç‚¹æŒ‰åŸé¡ºåºè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">                        <span class="keyword">do</span> &#123;</span><br><span class="line">                            next = e.next;</span><br><span class="line">                            <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                    loHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    loTail.next = e;</span><br><span class="line">                                loTail = e;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                    hiHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    hiTail.next = e;</span><br><span class="line">                                hiTail = e;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                        <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                            newTab[j] = loHead;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                            <span class="comment">// rehashã€€åèŠ‚ç‚¹æ–°çš„ä½ç½®ä¸€å®šä¸ºåŸæ¥åŸºç¡€ä¸ŠåŠ ä¸Šã€€oldCap</span></span><br><span class="line">                            newTab[j + oldCap] = hiHead;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newTab;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="å…³äºHashMapåœ¨ä»€ä¹ˆæ—¶å€™æ—¶é—´å¤æ‚åº¦æ˜¯Oï¼ˆ1ï¼‰ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯Oï¼ˆnï¼‰ï¼Œä»€ä¹ˆæ—¶å€™åˆæ˜¯Oï¼ˆlognï¼‰çš„é—®é¢˜"><a href="#å…³äºHashMapåœ¨ä»€ä¹ˆæ—¶å€™æ—¶é—´å¤æ‚åº¦æ˜¯Oï¼ˆ1ï¼‰ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯Oï¼ˆnï¼‰ï¼Œä»€ä¹ˆæ—¶å€™åˆæ˜¯Oï¼ˆlognï¼‰çš„é—®é¢˜" class="headerlink" title="å…³äºHashMapåœ¨ä»€ä¹ˆæ—¶å€™æ—¶é—´å¤æ‚åº¦æ˜¯Oï¼ˆ1ï¼‰ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯Oï¼ˆnï¼‰ï¼Œä»€ä¹ˆæ—¶å€™åˆæ˜¯Oï¼ˆlognï¼‰çš„é—®é¢˜"></a>å…³äºHashMapåœ¨ä»€ä¹ˆæ—¶å€™æ—¶é—´å¤æ‚åº¦æ˜¯Oï¼ˆ1ï¼‰ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯Oï¼ˆnï¼‰ï¼Œä»€ä¹ˆæ—¶å€™åˆæ˜¯Oï¼ˆlognï¼‰çš„é—®é¢˜</h3><p><strong>Oï¼ˆ1ï¼‰</strong>ï¼šé“¾è¡¨çš„é•¿åº¦å°½å¯èƒ½çŸ­ï¼Œç†æƒ³çŠ¶æ€ä¸‹é“¾è¡¨é•¿åº¦éƒ½ä¸º1 </p><p><strong>Oï¼ˆnï¼‰</strong>ï¼šå½“ Hash å†²çªä¸¥é‡æ—¶ï¼Œå¦‚æœæ²¡æœ‰çº¢é»‘æ ‘ï¼Œé‚£ä¹ˆåœ¨æ¡¶ä¸Šå½¢æˆçš„é“¾è¡¨ä¼šå˜çš„è¶Šæ¥è¶Šé•¿ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢æ—¶çš„æ•ˆç‡å°±ä¼šè¶Šæ¥è¶Šä½ï¼›æ—¶é—´å¤æ‚åº¦ä¸ºO(N)ã€‚ </p><p><strong>Oï¼ˆlognï¼‰</strong>ï¼šé‡‡ç”¨çº¢é»‘æ ‘ä¹‹åå¯ä»¥ä¿è¯æŸ¥è¯¢æ•ˆç‡O(logn) </p><h3 id="æ‰‹å†™"><a href="#æ‰‹å†™" class="headerlink" title="æ‰‹å†™"></a>æ‰‹å†™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tengshe789</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> æ‰‹å†™<span class="title">HashMap</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span>&#123;</span><br><span class="line">        K key;</span><br><span class="line">        V value;</span><br><span class="line">        Node&lt;K,V&gt; next;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(K key, V value, Node&lt;K, V&gt; next)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.key;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.value=value;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HashMap</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt;</span>&#123;</span><br><span class="line">        <span class="comment">/*æ•°æ®å­˜å‚¨çš„ç»“æ„==&gt;æ•°ç»„+é“¾è¡¨*/</span></span><br><span class="line">        Node&lt;K,V&gt;[] array=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">/* å“ˆå¸Œæ¡¶çš„é•¿åº¦ */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> defaultLength=<span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*åŠ è½½å› å­/æ‰©å®¹å› å­*/</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">double</span> factor=<span class="number">0.75</span>D;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°*/</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*æ‰“å°å‡½æ•°*/</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"==============================="</span>);</span><br><span class="line">            <span class="keyword">if</span>(array!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                Node&lt;K, V&gt; node=<span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">                    node=array[i];</span><br><span class="line">                    System.out.print(<span class="string">"ä¸‹æ ‡["</span>+i+<span class="string">"]"</span>);</span><br><span class="line">                    <span class="comment">//éå†é“¾è¡¨</span></span><br><span class="line">                    <span class="keyword">while</span>(node!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                        System.out.print(<span class="string">"["</span>+node.getKey()+<span class="string">":"</span>+node.getValue()+<span class="string">"]"</span>);</span><br><span class="line">                        <span class="keyword">if</span>(node.next!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                            node=node.next;</span><br><span class="line">                        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="comment">//åˆ°å°¾éƒ¨å…ƒç´ </span></span><br><span class="line">                            node=<span class="keyword">null</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//putå…ƒç´ æ–¹æ³•</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K k, V v)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//1.æ‡’åŠ è½½æœºåˆ¶ï¼Œä½¿ç”¨çš„æ—¶å€™è¿›è¡Œåˆ†é…</span></span><br><span class="line">            <span class="keyword">if</span>(array==<span class="keyword">null</span>) &#123;</span><br><span class="line">                array=<span class="keyword">new</span> Node[defaultLength];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.é€šè¿‡hashç®—æ³•ï¼Œè®¡ç®—å‡ºå…·ä½“æ’å…¥çš„ä½ç½®</span></span><br><span class="line">            <span class="keyword">int</span> index=position(k,defaultLength);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ‰©å®¹ã€‚åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line">            <span class="comment">//æ‰©å®¹çš„å‡†åˆ™ï¼Œå…ƒç´ çš„ä¸ªæ•°   å¤§äº  æ¡¶çš„å°ºå¯¸*åŠ è½½å› å­</span></span><br><span class="line">            <span class="keyword">if</span>(size &gt; defaultLength*factor) &#123;</span><br><span class="line">                resize();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.æ”¾å…¥è¦æ’å…¥çš„å…ƒç´ </span></span><br><span class="line">            Node&lt;K, V&gt; node=array[index];</span><br><span class="line">            <span class="keyword">if</span>(node==<span class="keyword">null</span>) &#123;</span><br><span class="line">                array[index]=<span class="keyword">new</span> Node&lt;K,V&gt;(k,v,<span class="keyword">null</span>);</span><br><span class="line">                size++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(k.equals(node.getKey()) || k==node.getKey()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> node.setValue(v);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    array[index]=<span class="keyword">new</span> Node&lt;K,V&gt;(k,v,node);</span><br><span class="line">                    size++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰©å®¹ï¼Œå¹¶ä¸”é‡æ–°æ’åˆ—å…ƒç´ </span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">//ç¿»å€æ‰©å®¹</span></span><br><span class="line">            <span class="comment">//1.åˆ›å»ºæ–°çš„arrayä¸´æ—¶å˜é‡,ç›¸å½“äºdefaultlength*2</span></span><br><span class="line">            Node&lt;K, V&gt;[] temp=<span class="keyword">new</span> Node[defaultLength &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.é‡æ–°è®¡ç®—æ•£åˆ—å€¼ï¼Œæ’å…¥åˆ°æ–°çš„arrayä¸­å»ã€‚ code=key % defaultLength ==&gt; code=key % defaultLength*2</span></span><br><span class="line">            Node&lt;K, V&gt; node=<span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">                node=array[i];</span><br><span class="line">                <span class="keyword">while</span>(node!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//é‡æ–°æ•£åˆ—</span></span><br><span class="line">                    <span class="keyword">int</span> index=position(node.getKey(),temp.length);</span><br><span class="line">                    <span class="comment">//æ’å…¥å¤´éƒ¨</span></span><br><span class="line">                    Node&lt;K, V&gt; next = node.next;</span><br><span class="line">                    <span class="comment">//3</span></span><br><span class="line">                    node.next=temp[index];</span><br><span class="line">                    <span class="comment">//1</span></span><br><span class="line">                    temp[index]=node;</span><br><span class="line">                    <span class="comment">//2</span></span><br><span class="line">                    node=next;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.æ›¿æ¢æ‰è€array</span></span><br><span class="line">            array=temp;</span><br><span class="line">            defaultLength=temp.length;</span><br><span class="line">            temp=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">position</span><span class="params">(K k,<span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> code=k.hashCode();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å–æ¨¡ç®—æ³•</span></span><br><span class="line">            <span class="keyword">return</span> code % (length-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ±‚ä¸ç®—æ³•</span></span><br><span class="line">            <span class="comment">//return code &amp; (defaultLength-1);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K k)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(array!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> index=position(k,defaultLength);</span><br><span class="line">                Node&lt;K, V&gt; node=array[index];</span><br><span class="line">                <span class="comment">//éå†é“¾è¡¨</span></span><br><span class="line">                <span class="keyword">while</span>(node!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//å¦‚æœkeyå€¼ç›¸åŒè¿”å›value</span></span><br><span class="line">                    <span class="keyword">if</span>(node.getKey()==k) &#123;</span><br><span class="line">                        <span class="keyword">return</span> node.getValue();</span><br><span class="line">                    &#125; <span class="keyword">else</span></span><br><span class="line">                        <span class="comment">//å¦‚æœkeyå€¼ä¸åŒåˆ™è°ƒåˆ°ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">                    &#123;</span><br><span class="line">                        node=node.next;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">            HashMap&lt;String, String&gt; map=<span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">            map.put(<span class="string">"001å·"</span>, <span class="string">"001"</span>);</span><br><span class="line">            map.put(<span class="string">"002å·"</span>, <span class="string">"002"</span>);</span><br><span class="line">            map.put(<span class="string">"003å·"</span>, <span class="string">"003"</span>);</span><br><span class="line">            map.put(<span class="string">"004å·"</span>, <span class="string">"004"</span>);</span><br><span class="line">            map.put(<span class="string">"005å·"</span>, <span class="string">"005"</span>);</span><br><span class="line">            map.put(<span class="string">"006å·"</span>, <span class="string">"006"</span>);</span><br><span class="line">            map.put(<span class="string">"007å·"</span>, <span class="string">"007"</span>);</span><br><span class="line">            map.put(<span class="string">"008å·"</span>, <span class="string">"008"</span>);</span><br><span class="line">            map.put(<span class="string">"009å·"</span>, <span class="string">"009"</span>);</span><br><span class="line">            map.put(<span class="string">"010å·"</span>, <span class="string">"010"</span>);</span><br><span class="line">            map.put(<span class="string">"011å·"</span>, <span class="string">"011"</span>);</span><br><span class="line">            map.print();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"========&gt;"</span>+map.get(<span class="string">"009å·"</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://segmentfault.com/a/1190000012926722#articleHeader4" target="_blank" rel="noopener">coolblog</a></p><p><a href="https://www.bilibili.com/video/av24032788" target="_blank" rel="noopener">é˜¿é‡Œæ¶æ„å¸ˆå¸¦ä½ åˆ†æHashMapæºç å®ç°åŸç†</a></p><p>æ„Ÿè°¢ï¼</p><hr><p>ä»¥ä¸‹æ¥è‡ªnå¤©åçš„æˆ‘ï¼š</p><p>è¡¥å……ä¸€ä¸‹çœ‹åˆ°ä¸€ä¸ªéå¸¸å¥½çš„ï¼š<a href="https://blog.csdn.net/v123411739/article/details/78996181" target="_blank" rel="noopener">ç‚¹å‡»é“¾æ¥</a>ï¼Œå€¼å¾—å­¦ä¹ </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åˆšåˆšçœ‹åˆ°QQç¾¤æœ‰äººå¹&lt;code&gt;Hashmap&lt;/code&gt;ï¼Œä¸€æƒ³æˆ‘å•¥éƒ½ä¸æ‡‚ï¼Œå°±èµ¶å¿«è¡¥äº†ä¸€æ³¢ã€‚ä¸‹é¢åˆ†äº«ä¸€ä¸‹æˆ‘å¯¹&lt;code&gt;Hashmap&lt;/code&gt;çš„ç†è§£ï¼Œä¸»è¦ç”¨äºä¸ªäººå¤‡å¿˜ã€‚å¦‚æœæœ‰ä¸å¯¹ï¼Œè¯·æ‰¹è¯„ã€‚æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®&lt;a href=&quot;https://blog.teng
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="æºç " scheme="https://tengshe789.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="java" scheme="https://tengshe789.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>å¤šç»ˆç«¯åŒæ­¥Hexo</title>
    <link href="https://tengshe789.github.io/2018/07/07/%E5%A4%9A%E7%BB%88%E7%AB%AF%E5%90%8C%E6%AD%A5Hexo/"/>
    <id>https://tengshe789.github.io/2018/07/07/å¤šç»ˆç«¯åŒæ­¥Hexo/</id>
    <published>2018-07-07T11:11:18.000Z</published>
    <updated>2021-06-06T06:19:57.401Z</updated>
    
    <content type="html"><![CDATA[<p>æ”¾å¯’å‡äº†ï¼Œç©æ¸¸æˆï¼</p><p><img src="/2018/07/07/å¤šç»ˆç«¯åŒæ­¥Hexo/1.png" alt="img"></p><p>å‘¸å‘¸å‘¸</p><p>æˆ‘æ˜¯é‚£ç§äººä¹ˆï¼Ÿï¼Ÿï¼Ÿ</p><p>æ”¾å‡äº†è¦å¥½å¥½å­¦ä¹ ï¼Œè€Œä¸”å­¦ä»€ä¹ˆè¦è®°å½•ä¸€ä¸‹ï¼Œæ¯å¤©å†™ç‚¹åšå®¢è®°å½•ä¸€ä¸‹è‡ªå·±çš„ç‚¹ç‚¹æ»´æ»´å•Š~ï¼å¯åƒåœ¾ç¬”è®°æœ¬å±å¹•å¤ªå°äº†ï¼Œçœ‹çš„çœ¼ç–¼ï¼Œæ²¡æœ‰åŠæ³•åœ¨åŸå…ˆæœ¬æœ¬ä¸Šå†™MDåšå®¢</p><p><strong>è‚¿ä¹ˆåŠï¼Ÿ</strong></p><p>ä¸æ…Œï¼Œå¯ä»¥åˆ©ç”¨Gitåœ¨å¤šå¹³å°ä¸ŠåŒæ­¥Hexoï¼</p><p>ä¸‹é¢æˆ‘å°±åˆ†äº«ä¸€ä¸‹æ­¥éª¤~</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>ç¯å¢ƒæˆ‘å°±ä¸è¯´äº†ï¼ŒNode.jsï¼ŒGitï¼ŒHexoï¼Œè¿™äº›éƒ½æ˜¯æœ€åŸºæœ¬çš„</p><h4 id="ä¸‹è½½Git"><a href="#ä¸‹è½½Git" class="headerlink" title="ä¸‹è½½Git"></a>ä¸‹è½½Git</h4><p>ä¸‹è½½ git OSX ç‰ˆ:git-scm.com/download/maâ€¦<br>ä¸‹è½½ git Windows ç‰ˆ:git-scm.com/download/wiâ€¦<br>ä¸‹è½½ git Linux ç‰ˆ:git-scm.com/download/liâ€¦</p><h4 id="å®‰è£…Git"><a href="#å®‰è£…Git" class="headerlink" title="å®‰è£…Git"></a>å®‰è£…Git</h4><p>Linux<br>$ sudo yum install git<br>æˆ–è€…<br>$ sudo apt-get install git<br>Mac<br>ç›´æ¥åœ¨ Terminal æ‰§è¡Œ git å‘½ä»¤, å¦‚æœæ²¡æœ‰ä¼šæç¤ºå®‰è£…æ–¹æ³•.</p><h3 id="ç¬”è®°æœ¬ç«¯ï¼ˆéœ€è¦å¤‡ä»½çš„ä¸€ç«¯ï¼‰"><a href="#ç¬”è®°æœ¬ç«¯ï¼ˆéœ€è¦å¤‡ä»½çš„ä¸€ç«¯ï¼‰" class="headerlink" title="ç¬”è®°æœ¬ç«¯ï¼ˆéœ€è¦å¤‡ä»½çš„ä¸€ç«¯ï¼‰"></a>ç¬”è®°æœ¬ç«¯ï¼ˆéœ€è¦å¤‡ä»½çš„ä¸€ç«¯ï¼‰</h3><p>è¿›å…¥æˆ‘åšå®¢çš„åŸå§‹æ–‡ä»¶å¤¹å†…ï¼Œæ‰¾åˆ°.gitignoreï¼ˆGitå°±ä¼šè‡ªåŠ¨å¿½ç•¥æ–‡ä»¶æ€»æ±‡ï¼‰æ–‡ä»¶ï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€~</p><p>æ·»åŠ å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public/</span><br><span class="line">.deploy*/</span><br><span class="line">node_modules/ #npm installäº§ç”Ÿçš„node_modulesç”±äºè·¯å¾„è¿‡é•¿ä¸å¥½å¤„ç†</span><br></pre></td></tr></table></figure><p>æ·»åŠ å®Œæˆåï¼Œå³é”® Git Bashï¼Œè¾“å…¥ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git init  #åˆå§‹åŒ–æœ¬åœ°ä»“åº“</span><br><span class="line">git add . #å°†å¿…è¦çš„æ–‡ä»¶ä¾æ¬¡æ·»åŠ </span><br><span class="line">git commit -m "æ›´æ–°è¯´æ˜" #å¼•å·é‡Œé¢éšä¾¿æ”¹å“¦~</span><br><span class="line">git branch hexo  #æ–°å»ºhexoåˆ†æ”¯ï¼Œå½“ç„¶ï¼Œåˆ†æ”¯åå­—â€œhexoâ€ä¹Ÿå¯ä»¥éšä¾¿æ”¹å“¦~</span><br><span class="line">git checkout hexo  #åˆ‡æ¢åˆ°hexoåˆ†æ”¯ä¸Š</span><br><span class="line">git remote add origin git@github.com:tengshe789/tengshe789.github.io.git  #å°†æœ¬åœ°ä¸Githubé¡¹ç›®å¯¹æ¥ï¼Œtengshe789ä¸ºæˆ‘çš„ç”¨æˆ·å</span><br><span class="line">git push origin hexo  #pushåˆ°Githubé¡¹ç›®çš„hexoåˆ†æ”¯ä¸Š</span><br></pre></td></tr></table></figure><p>å®Œæˆååˆå½±~</p><p><img src="/2018/07/07/å¤šç»ˆç«¯åŒæ­¥Hexo/2.png" alt="">è¿™é‡Œæœ‰å¾ˆå¤šéšç§æ–‡ä»¶å¤¹ï¼Œè­¬å¦‚config.yml,db.jsonâ€¦..æˆ‘ä¹Ÿä¸€ä¸€ä¸Šä¼ äº†ï¼Œå› ä¸ºæˆ‘æ˜¯ä¸ªä¸æ€•æš´æ¼éšç§çš„äººå“ˆå“ˆå“ˆå“ˆã€‚è¦æƒ³é¿å…è¿™ä¸ªæƒ…å†µåªå°†sourceæ·»åŠ å³å¯</p><h3 id="å°å¼æœºç«¯ï¼ˆéœ€è¦è¿˜åŸçš„ä¸€ç«¯ï¼‰"><a href="#å°å¼æœºç«¯ï¼ˆéœ€è¦è¿˜åŸçš„ä¸€ç«¯ï¼‰" class="headerlink" title="å°å¼æœºç«¯ï¼ˆéœ€è¦è¿˜åŸçš„ä¸€ç«¯ï¼‰"></a>å°å¼æœºç«¯ï¼ˆéœ€è¦è¿˜åŸçš„ä¸€ç«¯ï¼‰</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git clone -b hexo git@github.com:tengshe789/tengshe789.github.io.git  #å°†Githubä¸­hexoåˆ†æ”¯cloneåˆ°æœ¬åœ°</span><br><span class="line">cd  tengshe789.github.io  #åˆ‡æ¢åˆ°åˆšåˆšcloneçš„æ–‡ä»¶å¤¹å†…</span><br><span class="line">npm install    #æ³¨æ„ï¼Œè¿™é‡Œä¸€å®šè¦åˆ‡æ¢åˆ°åˆšåˆšcloneçš„æ–‡ä»¶å¤¹å†…æ‰§è¡Œï¼Œå®‰è£…å¿…è¦çš„æ‰€éœ€ç»„ä»¶ï¼Œä¸ç”¨å†init</span><br><span class="line">npm install hexo-cli -g # å¦‚æœä¸åŒæœºå™¨nodeç‰ˆæœ¬å‡çº§äº†ï¼Œéœ€è¦é‡æ–°è¿è¡Œè¿™ä¸ª</span><br><span class="line">npm install https://github.com/CodeFalling/hexo-asset-image --save #å›¾ç‰‡æ’ä»¶</span><br><span class="line">npm install --save hexo-pdf #pdfæ’ä»¶</span><br><span class="line">npm install hexo-deployer-git #éƒ¨ç½²</span><br><span class="line">npm install hexo-generator-restful --save #ç”Ÿæˆ restful é£æ ¼çš„ json æ•°æ® https://github.com/yscoder/hexo-generator-restful</span><br></pre></td></tr></table></figure><p>å®Œæˆï¼</p><p>æ¥ä¸‹æ¥å†™ä¸€ç¯‡åšå®¢åº†ç¥ä¸€ä¸‹~</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new post "new blog name"   #æ–°å»ºä¸€ä¸ª.mdæ–‡ä»¶ï¼Œå¹¶ç¼–è¾‘å®Œæˆè‡ªå·±çš„åšå®¢å†…å®¹</span><br></pre></td></tr></table></figure><p>å†™å®Œï¼Œå¤‡ä»½ä¸€ä¸‹ï¼Œå†åŒæ­¥åˆ°githubï¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add source  #æ¯æ¬¡åªè¦æ›´æ–°sorcererä¸­çš„æ–‡ä»¶åˆ°Githubä¸­å³å¯ï¼Œå› ä¸ºåªæ˜¯æ–°å»ºäº†ä¸€ç¯‡æ–°åšå®¢</span><br><span class="line">git commit -m "æ›´æ–°è¯´æ˜"</span><br><span class="line">git push origin hexo  #æ›´æ–°åˆ†æ”¯</span><br><span class="line">hexo d -g   #pushæ›´æ–°å®Œåˆ†æ”¯ä¹‹åå°†è‡ªå·±å†™çš„åšå®¢å¯¹æ¥åˆ°è‡ªå·±æ­çš„åšå®¢ç½‘ç«™ä¸Šï¼ŒåŒæ—¶åŒæ­¥äº†Githubä¸­çš„master</span><br></pre></td></tr></table></figure><h3 id="ç•ªå¤–ï¼šç¬”è®°æœ¬æ€ä¹ˆåŒæ­¥ï¼Ÿ"><a href="#ç•ªå¤–ï¼šç¬”è®°æœ¬æ€ä¹ˆåŒæ­¥ï¼Ÿ" class="headerlink" title="ç•ªå¤–ï¼šç¬”è®°æœ¬æ€ä¹ˆåŒæ­¥ï¼Ÿ"></a>ç•ªå¤–ï¼šç¬”è®°æœ¬æ€ä¹ˆåŒæ­¥ï¼Ÿ</h3><p>è¿›å…¥æˆ‘åšå®¢çš„åŸå§‹æ–‡ä»¶å¤¹å†…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin hexo  #å…ˆpullå®Œæˆæœ¬åœ°ä¸è¿œç«¯çš„èåˆ</span><br></pre></td></tr></table></figure><h4 id="Hexoå¼‚å¸¸ï¼šfatal-inunpopulatedsubmoduleâ€™-deploy-gitâ€™æ€ä¹ˆè§£å†³"><a href="#Hexoå¼‚å¸¸ï¼šfatal-inunpopulatedsubmoduleâ€™-deploy-gitâ€™æ€ä¹ˆè§£å†³" class="headerlink" title="Hexoå¼‚å¸¸ï¼šfatal:inunpopulatedsubmoduleâ€™.deploy_gitâ€™æ€ä¹ˆè§£å†³"></a>Hexoå¼‚å¸¸ï¼šfatal:inunpopulatedsubmoduleâ€™.deploy_gitâ€™æ€ä¹ˆè§£å†³</h4><p>å®åœ¨ä¸è¡Œï¼Œå°±æŠŠå®ƒåˆ æ‰ï¼Œç„¶åé‡æ–°ç”Ÿæˆå’Œéƒ¨ç½²ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`rm -rf .deploy_git``hexo g``hexo d`</span><br></pre></td></tr></table></figure><h3 id="Gitå‘½ä»¤æ•´ç†"><a href="#Gitå‘½ä»¤æ•´ç†" class="headerlink" title="Gitå‘½ä»¤æ•´ç†"></a>Gitå‘½ä»¤æ•´ç†</h3><h4 id="Gité…ç½®"><a href="#Gité…ç½®" class="headerlink" title="Gité…ç½®"></a>Gité…ç½®</h4><p>git config â€“global user.name â€œrobbinâ€<br>git config â€“global user.email â€œ<a href="mailto:randyvan007@hotmail.com" target="_blank" rel="noopener">randyvan007@hotmail.com</a>â€œ<br>git config â€“global color.ui true<br>git config â€“global alias.co checkout<br>git config â€“global alias.ci commit<br>git config â€“global alias.st status<br>git config â€“global alias.br branch<br>git config â€“global core.editor â€œmate -wâ€    # è®¾ç½®Editorä½¿ç”¨textmate<br>git config -l  # åˆ—ä¸¾æ‰€æœ‰é…ç½®<br>ç”¨æˆ·çš„gité…ç½®æ–‡ä»¶~/.gitconfig</p><h4 id="Gitå¸¸ç”¨å‘½ä»¤"><a href="#Gitå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Gitå¸¸ç”¨å‘½ä»¤"></a>Gitå¸¸ç”¨å‘½ä»¤</h4><p>æŸ¥çœ‹ã€æ·»åŠ ã€æäº¤ã€åˆ é™¤ã€æ‰¾å›ï¼Œé‡ç½®ä¿®æ”¹æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">git help  &lt;command&gt;  # æ˜¾ç¤ºcommandçš„help</span><br><span class="line">git show            # æ˜¾ç¤ºæŸæ¬¡æäº¤çš„å†…å®¹</span><br><span class="line">git show $id</span><br><span class="line"></span><br><span class="line">git co  -- &lt;file&gt;   # æŠ›å¼ƒå·¥ä½œåŒºä¿®æ”¹</span><br><span class="line">git co  .           # æŠ›å¼ƒå·¥ä½œåŒºä¿®æ”¹</span><br><span class="line"></span><br><span class="line">git add &lt;file&gt;      # å°†å·¥ä½œæ–‡ä»¶ä¿®æ”¹æäº¤åˆ°æœ¬åœ°æš‚å­˜åŒº</span><br><span class="line">git add .           # å°†æ‰€æœ‰ä¿®æ”¹è¿‡çš„å·¥ä½œæ–‡ä»¶æäº¤æš‚å­˜åŒº</span><br><span class="line"></span><br><span class="line">git rm &lt;file&gt;       # ä»ç‰ˆæœ¬åº“ä¸­åˆ é™¤æ–‡ä»¶</span><br><span class="line">git rm &lt;file&gt; --cached  # ä»ç‰ˆæœ¬åº“ä¸­åˆ é™¤æ–‡ä»¶ï¼Œä½†ä¸åˆ é™¤æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">git reset &lt;file&gt;    # ä»æš‚å­˜åŒºæ¢å¤åˆ°å·¥ä½œæ–‡ä»¶</span><br><span class="line">git reset -- .      # ä»æš‚å­˜åŒºæ¢å¤åˆ°å·¥ä½œæ–‡ä»¶</span><br><span class="line">git reset --hard    # æ¢å¤æœ€è¿‘ä¸€æ¬¡æäº¤è¿‡çš„çŠ¶æ€ï¼Œå³æ”¾å¼ƒä¸Šæ¬¡æäº¤åçš„æ‰€æœ‰æœ¬æ¬¡ä¿®æ”¹</span><br><span class="line"></span><br><span class="line">git ci &lt;file&gt;</span><br><span class="line">git ci .</span><br><span class="line">git ci -a           # å°†git add, git rmå’Œgit ciç­‰æ“ä½œéƒ½åˆå¹¶åœ¨ä¸€èµ·åš</span><br><span class="line">git ci -am "some comments"</span><br><span class="line">git ci --amend      # ä¿®æ”¹æœ€åä¸€æ¬¡æäº¤è®°å½•</span><br><span class="line"></span><br><span class="line">git revert &lt;$id&gt;    # æ¢å¤æŸæ¬¡æäº¤çš„çŠ¶æ€ï¼Œæ¢å¤åŠ¨ä½œæœ¬èº«ä¹Ÿåˆ›å»ºäº†ä¸€æ¬¡æäº¤å¯¹è±¡</span><br><span class="line">git revert HEAD     # æ¢å¤æœ€åä¸€æ¬¡æäº¤çš„çŠ¶æ€</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ–‡ä»¶diff"><a href="#æŸ¥çœ‹æ–‡ä»¶diff" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶diff"></a>æŸ¥çœ‹æ–‡ä»¶diff</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git diff &lt;file&gt;     # æ¯”è¾ƒå½“å‰æ–‡ä»¶å’Œæš‚å­˜åŒºæ–‡ä»¶å·®å¼‚</span><br><span class="line">git diff</span><br><span class="line">git diff &lt;$id1&gt; &lt;$id2&gt;   # æ¯”è¾ƒä¸¤æ¬¡æäº¤ä¹‹é—´çš„å·®å¼‚</span><br><span class="line">git diff &lt;branch1&gt;..&lt;branch2&gt; # åœ¨ä¸¤ä¸ªåˆ†æ”¯ä¹‹é—´æ¯”è¾ƒ</span><br><span class="line">git diff --staged   # æ¯”è¾ƒæš‚å­˜åŒºå’Œç‰ˆæœ¬åº“å·®å¼‚</span><br><span class="line">git diff --cached   # æ¯”è¾ƒæš‚å­˜åŒºå’Œç‰ˆæœ¬åº“å·®å¼‚</span><br><span class="line">git diff --stat     # ä»…ä»…æ¯”è¾ƒç»Ÿè®¡ä¿¡æ¯</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æäº¤è®°å½•"><a href="#æŸ¥çœ‹æäº¤è®°å½•" class="headerlink" title="æŸ¥çœ‹æäº¤è®°å½•"></a>æŸ¥çœ‹æäº¤è®°å½•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git log</span><br><span class="line">git log &lt;file&gt;      # æŸ¥çœ‹è¯¥æ–‡ä»¶æ¯æ¬¡æäº¤è®°å½•</span><br><span class="line">git log -p &lt;file&gt;   # æŸ¥çœ‹æ¯æ¬¡è¯¦ç»†ä¿®æ”¹å†…å®¹çš„diff</span><br><span class="line">git log -p -2       # æŸ¥çœ‹æœ€è¿‘ä¸¤æ¬¡è¯¦ç»†ä¿®æ”¹å†…å®¹çš„diff</span><br><span class="line">git log --stat      # æŸ¥çœ‹æäº¤ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">tig</span><br><span class="line">Macä¸Šå¯ä»¥ä½¿ç”¨tigä»£æ›¿diffå’Œlogï¼Œbrew install tig</span><br></pre></td></tr></table></figure><h4 id="Git-æœ¬åœ°åˆ†æ”¯ç®¡ç†"><a href="#Git-æœ¬åœ°åˆ†æ”¯ç®¡ç†" class="headerlink" title="Git æœ¬åœ°åˆ†æ”¯ç®¡ç†"></a>Git æœ¬åœ°åˆ†æ”¯ç®¡ç†</h4><p>æŸ¥çœ‹ã€åˆ‡æ¢ã€åˆ›å»ºå’Œåˆ é™¤åˆ†æ”¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">git br -r           # æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</span><br><span class="line">git br &lt;new_branch&gt; # åˆ›å»ºæ–°çš„åˆ†æ”¯</span><br><span class="line">git br -v           # æŸ¥çœ‹å„ä¸ªåˆ†æ”¯æœ€åæäº¤ä¿¡æ¯</span><br><span class="line">git br --merged     # æŸ¥çœ‹å·²ç»è¢«åˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯</span><br><span class="line">git br --no-merged  # æŸ¥çœ‹å°šæœªè¢«åˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯</span><br><span class="line"></span><br><span class="line">git co &lt;branch&gt;     # åˆ‡æ¢åˆ°æŸä¸ªåˆ†æ”¯</span><br><span class="line">git co -b &lt;new_branch&gt; # åˆ›å»ºæ–°çš„åˆ†æ”¯ï¼Œå¹¶ä¸”åˆ‡æ¢è¿‡å»</span><br><span class="line">git co -b &lt;new_branch&gt; &lt;branch&gt;  # åŸºäºbranchåˆ›å»ºæ–°çš„new_branch</span><br><span class="line"></span><br><span class="line">git co $id          # æŠŠæŸæ¬¡å†å²æäº¤è®°å½•checkoutå‡ºæ¥ï¼Œä½†æ— åˆ†æ”¯ä¿¡æ¯ï¼Œåˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯ä¼šè‡ªåŠ¨åˆ é™¤</span><br><span class="line">git co $id -b &lt;new_branch&gt;  # æŠŠæŸæ¬¡å†å²æäº¤è®°å½•checkoutå‡ºæ¥ï¼Œåˆ›å»ºæˆä¸€ä¸ªåˆ†æ”¯</span><br><span class="line"></span><br><span class="line">git br -d &lt;branch&gt;  # åˆ é™¤æŸä¸ªåˆ†æ”¯</span><br><span class="line">git br -D &lt;branch&gt;  # å¼ºåˆ¶åˆ é™¤æŸä¸ªåˆ†æ”¯ (æœªè¢«åˆå¹¶çš„åˆ†æ”¯è¢«åˆ é™¤çš„æ—¶å€™éœ€è¦å¼ºåˆ¶)</span><br></pre></td></tr></table></figure><h4 id="åˆ†æ”¯åˆå¹¶å’Œrebase"><a href="#åˆ†æ”¯åˆå¹¶å’Œrebase" class="headerlink" title="åˆ†æ”¯åˆå¹¶å’Œrebase"></a>åˆ†æ”¯åˆå¹¶å’Œrebase</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git merge &lt;branch&gt;               # å°†branchåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯</span><br><span class="line">git merge origin/master --no-ff  # ä¸è¦Fast-Fowardåˆå¹¶ï¼Œè¿™æ ·å¯ä»¥ç”Ÿæˆmergeæäº¤</span><br><span class="line"></span><br><span class="line">git rebase master &lt;branch&gt;       # å°†master rebaseåˆ°branchï¼Œç›¸å½“äºï¼š</span><br><span class="line">git co &lt;branch&gt; &amp;&amp; git rebase master &amp;&amp; git co master &amp;&amp; git merge &lt;branch&gt;</span><br></pre></td></tr></table></figure><h4 id="Gitè¡¥ä¸ç®¡ç†-æ–¹ä¾¿åœ¨å¤šå°æœºå™¨ä¸Šå¼€å‘åŒæ­¥æ—¶ç”¨"><a href="#Gitè¡¥ä¸ç®¡ç†-æ–¹ä¾¿åœ¨å¤šå°æœºå™¨ä¸Šå¼€å‘åŒæ­¥æ—¶ç”¨" class="headerlink" title="Gitè¡¥ä¸ç®¡ç†(æ–¹ä¾¿åœ¨å¤šå°æœºå™¨ä¸Šå¼€å‘åŒæ­¥æ—¶ç”¨)"></a>Gitè¡¥ä¸ç®¡ç†(æ–¹ä¾¿åœ¨å¤šå°æœºå™¨ä¸Šå¼€å‘åŒæ­¥æ—¶ç”¨)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git diff &gt; ../sync.patch         # ç”Ÿæˆè¡¥ä¸</span><br><span class="line">git apply ../sync.patch          # æ‰“è¡¥ä¸</span><br><span class="line">git apply --check ../sync.patch  # æµ‹è¯•è¡¥ä¸èƒ½å¦æˆåŠŸ</span><br></pre></td></tr></table></figure><h4 id="Gitæš‚å­˜ç®¡ç†"><a href="#Gitæš‚å­˜ç®¡ç†" class="headerlink" title="Gitæš‚å­˜ç®¡ç†"></a>Gitæš‚å­˜ç®¡ç†</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git stash                        # æš‚å­˜</span><br><span class="line">git stash list                   # åˆ—æ‰€æœ‰stash</span><br><span class="line">git stash apply                  # æ¢å¤æš‚å­˜çš„å†…å®¹</span><br><span class="line">git stash drop                   # åˆ é™¤æš‚å­˜åŒº</span><br></pre></td></tr></table></figure><h4 id="Gitè¿œç¨‹åˆ†æ”¯ç®¡ç†"><a href="#Gitè¿œç¨‹åˆ†æ”¯ç®¡ç†" class="headerlink" title="Gitè¿œç¨‹åˆ†æ”¯ç®¡ç†"></a>Gitè¿œç¨‹åˆ†æ”¯ç®¡ç†</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git pull                         # æŠ“å–è¿œç¨‹ä»“åº“æ‰€æœ‰åˆ†æ”¯æ›´æ–°å¹¶åˆå¹¶åˆ°æœ¬åœ°</span><br><span class="line">git pull --no-ff                 # æŠ“å–è¿œç¨‹ä»“åº“æ‰€æœ‰åˆ†æ”¯æ›´æ–°å¹¶åˆå¹¶åˆ°æœ¬åœ°ï¼Œä¸è¦å¿«è¿›åˆå¹¶</span><br><span class="line">git fetch origin                 # æŠ“å–è¿œç¨‹ä»“åº“æ›´æ–°</span><br><span class="line">git merge origin/master          # å°†è¿œç¨‹ä¸»åˆ†æ”¯åˆå¹¶åˆ°æœ¬åœ°å½“å‰åˆ†æ”¯</span><br><span class="line">git co --track origin/branch     # è·Ÿè¸ªæŸä¸ªè¿œç¨‹åˆ†æ”¯åˆ›å»ºç›¸åº”çš„æœ¬åœ°åˆ†æ”¯</span><br><span class="line">git co -b &lt;local_branch&gt; origin/&lt;remote_branch&gt;  # åŸºäºè¿œç¨‹åˆ†æ”¯åˆ›å»ºæœ¬åœ°åˆ†æ”¯ï¼ŒåŠŸèƒ½åŒä¸Š</span><br><span class="line"></span><br><span class="line">git push                         # pushæ‰€æœ‰åˆ†æ”¯</span><br><span class="line">git push origin master           # å°†æœ¬åœ°ä¸»åˆ†æ”¯æ¨åˆ°è¿œç¨‹ä¸»åˆ†æ”¯</span><br><span class="line">git push -u origin master        # å°†æœ¬åœ°ä¸»åˆ†æ”¯æ¨åˆ°è¿œç¨‹(å¦‚æ— è¿œç¨‹ä¸»åˆ†æ”¯åˆ™åˆ›å»ºï¼Œç”¨äºåˆå§‹åŒ–è¿œç¨‹ä»“åº“)</span><br><span class="line">git push origin &lt;local_branch&gt;   # åˆ›å»ºè¿œç¨‹åˆ†æ”¯ï¼Œ originæ˜¯è¿œç¨‹ä»“åº“å</span><br><span class="line">git push origin &lt;local_branch&gt;:&lt;remote_branch&gt;  # åˆ›å»ºè¿œç¨‹åˆ†æ”¯</span><br><span class="line">git push origin :&lt;remote_branch&gt;  #å…ˆåˆ é™¤æœ¬åœ°åˆ†æ”¯(git br -d &lt;branch&gt;)ï¼Œç„¶åå†pushåˆ é™¤è¿œç¨‹åˆ†æ”¯</span><br></pre></td></tr></table></figure><h4 id="Gitè¿œç¨‹ä»“åº“ç®¡ç†"><a href="#Gitè¿œç¨‹ä»“åº“ç®¡ç†" class="headerlink" title="Gitè¿œç¨‹ä»“åº“ç®¡ç†"></a>Gitè¿œç¨‹ä»“åº“ç®¡ç†</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git remote -v                    # æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨åœ°å€å’Œä»“åº“åç§°</span><br><span class="line">git remote show origin           # æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨ä»“åº“çŠ¶æ€</span><br><span class="line">git remote add origin git@github:robbin/robbin_site.git         # æ·»åŠ è¿œç¨‹ä»“åº“åœ°å€</span><br><span class="line">git remote set-url origin git@github.com:robbin/robbin_site.git # è®¾ç½®è¿œç¨‹ä»“åº“åœ°å€(ç”¨äºä¿®æ”¹è¿œç¨‹ä»“åº“åœ°å€)</span><br><span class="line">git remote rm &lt;repository&gt;       # åˆ é™¤è¿œç¨‹ä»“åº“</span><br></pre></td></tr></table></figure><p>åˆ›å»ºè¿œç¨‹ä»“åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git clone --bare robbin_site robbin_site.git  # ç”¨å¸¦ç‰ˆæœ¬çš„é¡¹ç›®åˆ›å»ºçº¯ç‰ˆæœ¬ä»“åº“</span><br><span class="line">scp -r my_project.git git@git.csdn.net:~      # å°†çº¯ä»“åº“ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Š</span><br><span class="line"></span><br><span class="line">mkdir robbin_site.git &amp;&amp; cd robbin_site.git &amp;&amp; git --bare init # åœ¨æœåŠ¡å™¨åˆ›å»ºçº¯ä»“åº“</span><br><span class="line">git remote add origin git@github.com:robbin/robbin_site.git    # è®¾ç½®è¿œç¨‹ä»“åº“åœ°å€</span><br><span class="line">git push -u origin master                                      # å®¢æˆ·ç«¯é¦–æ¬¡æäº¤</span><br><span class="line">git push -u origin develop  # é¦–æ¬¡å°†æœ¬åœ°developåˆ†æ”¯æäº¤åˆ°è¿œç¨‹developåˆ†æ”¯ï¼Œå¹¶ä¸”track</span><br><span class="line"></span><br><span class="line">git remote set-head origin master   # è®¾ç½®è¿œç¨‹ä»“åº“çš„HEADæŒ‡å‘masteråˆ†æ”¯</span><br><span class="line">ä¹Ÿå¯ä»¥å‘½ä»¤è®¾ç½®è·Ÿè¸ªè¿œç¨‹åº“å’Œæœ¬åœ°åº“</span><br><span class="line"></span><br><span class="line">git branch --set-upstream master origin/master</span><br><span class="line">git branch --set-upstream develop origin/develop</span><br></pre></td></tr></table></figure><h3 id="HappyEnding"><a href="#HappyEnding" class="headerlink" title="HappyEnding"></a>HappyEnding</h3><p>å®Œæˆï¼Œç»§ç»­ç©æ¸¸æˆï¼</p><p><a href="https://reuixiy.github.io/technology/computer/computer-aided-art/2017/06/09/hexo-next-optimization.html" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥1</a></p><p><a href="https://blog.csdn.net/qq_32454537/article/details/79482896" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥2</a></p><p>æ„Ÿè°¢ï¼</p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ”¾å¯’å‡äº†ï¼Œç©æ¸¸æˆï¼&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2018/07/07/å¤šç»ˆç«¯åŒæ­¥Hexo/1.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;å‘¸å‘¸å‘¸&lt;/p&gt;
&lt;p&gt;æˆ‘æ˜¯é‚£ç§äººä¹ˆï¼Ÿï¼Ÿï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ”¾å‡äº†è¦å¥½å¥½å­¦ä¹ ï¼Œè€Œä¸”å­¦ä»€ä¹ˆè¦è®°å½•ä¸€ä¸‹ï¼Œæ¯å¤©å†™ç‚¹åšå®¢è®°å½•ä¸€ä¸‹è‡ªå·±çš„ç‚¹ç‚¹
      
    
    </summary>
    
    
      <category term="æ—¥å¸¸" scheme="https://tengshe789.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Windows10" scheme="https://tengshe789.github.io/tags/Windows10/"/>
    
      <category term="Hexo" scheme="https://tengshe789.github.io/tags/Hexo/"/>
    
      <category term="git" scheme="https://tengshe789.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>WIN10 1809éšè—å¤§æ€å™¨--å“è¶Šæ¨¡å¼</title>
    <link href="https://tengshe789.github.io/2018/07/06/WIN10-1809%E9%9A%90%E8%97%8F%E5%A4%A7%E6%9D%80%E5%99%A8-%E5%8D%93%E8%B6%8A%E6%A8%A1%E5%BC%8F/"/>
    <id>https://tengshe789.github.io/2018/07/06/WIN10-1809éšè—å¤§æ€å™¨-å“è¶Šæ¨¡å¼/</id>
    <published>2018-07-06T12:24:29.000Z</published>
    <updated>2019-11-20T13:39:40.602Z</updated>
    
    <content type="html"><![CDATA[<p><strong> é“›é“›é“›</strong><br><img src="/2018/07/06/WIN10-1809éšè—å¤§æ€å™¨-å“è¶Šæ¨¡å¼/1.jpg" alt=""></p><h2 id="å¼€ç®±"><a href="#å¼€ç®±" class="headerlink" title="å¼€ç®±"></a>å¼€ç®±</h2><p>å¿«é€’æ¥äº†ï¼æ–°cpuåˆ°äº†<br>å…¶å®ä¹Ÿä¸ç®—æ–°cpuï¼Œæ¯•ç«Ÿè¿™ä¸ªcpuå·²ç»å‡ºäº†6å¹´äº†ã€‚</p><p>æ”¾æš‘å‡äº†ï¼Œæ€»è¦å¨±ä¹ä¸€ä¸‹ã€‚å¥ˆä½•å®¶é‡Œçš„è€ç”µè„‘cpuæ€§èƒ½ä¸å¤§å¤Ÿï¼ˆäºŒä»£i5 @2.9ghzï¼‰ï¼Œå¹²å•¥å•¥ä¸ç—›å¿«ï¼Œå¾ˆæ˜¯è‹¦æ¼ã€‚æ­£å¥½ï¼Œè¶ç€i7 9900Kå°†è¦å‘å”®çš„æ—¶å€™ï¼Œèµ¶å¿«ä¹°äº†ä¸ªE3-1240V2å……å€¼ä¿¡ä»°ï¼</p><p>å…ˆæ¥å›é¡¾ä¸€ä¸‹æ–°ä¹°cpuçš„å‚æ•°ã€‚</p><h6 id="åŸºæœ¬å‚æ•°"><a href="#åŸºæœ¬å‚æ•°" class="headerlink" title="åŸºæœ¬å‚æ•°"></a>åŸºæœ¬å‚æ•°</h6><p>CPUç³»åˆ—    Xeon E3 v2ç³»åˆ—<br><br>åˆ¶ä½œå·¥è‰º    22çº³ç±³<br><br>æ ¸å¿ƒä»£å·    Ivy Bridge<br></p><h6 id="æ€§èƒ½å‚æ•°"><a href="#æ€§èƒ½å‚æ•°" class="headerlink" title="æ€§èƒ½å‚æ•°"></a>æ€§èƒ½å‚æ•°</h6><p>æ ¸å¿ƒæ•°é‡    å››æ ¸å¿ƒ<br><br>çº¿ç¨‹æ•°é‡    å…«çº¿ç¨‹<br><br>CPUä¸»é¢‘    3.4GHz<br><br>åŠ¨æ€åŠ é€Ÿé¢‘ç‡    3.8GHz<br><br>L3ç¼“å­˜    8MB<br><br>æ€»çº¿è§„æ ¼    DMI 5GT/s<br><br>çƒ­è®¾è®¡åŠŸè€—(TDP)    69W<br></p><h6 id="å†…å­˜è§„æ ¼"><a href="#å†…å­˜è§„æ ¼" class="headerlink" title="å†…å­˜è§„æ ¼"></a>å†…å­˜è§„æ ¼</h6><p>æ”¯æŒæœ€å¤§å†…å­˜å®¹é‡    32GB<br><br>å†…å­˜ç±»å‹    DDR3 1333/1600MHz<br><br>å†…å­˜æè¿°    åŒé€šé“DDR3-1333/1600MHz<br></p><h6 id="å°è£…è§„æ ¼"><a href="#å°è£…è§„æ ¼" class="headerlink" title="å°è£…è§„æ ¼"></a>å°è£…è§„æ ¼</h6><p>æ’æ§½ç±»å‹    LGA 1155<br><br>å°è£…å¤§å°    37.5Ã—37.5mm<br><br>æœ€å¤§CPUé…ç½®    1é¢—</p><h6 id="æŠ€æœ¯å‚æ•°"><a href="#æŠ€æœ¯å‚æ•°" class="headerlink" title="æŠ€æœ¯å‚æ•°"></a>æŠ€æœ¯å‚æ•°</h6><p>ç¿é¢‘åŠ é€ŸæŠ€æœ¯    æ”¯æŒï¼Œ2.0<br><br>è¶…çº¿ç¨‹æŠ€æœ¯    æ”¯æŒ<br><br>è™šæ‹ŸåŒ–æŠ€æœ¯    Intel VT-x<br><br>æŒ‡ä»¤é›†    AVXï¼ŒSSE4.1ï¼ŒSSE4.2<br><br>64ä½å¤„ç†å™¨    æ”¯æŒ<br><br>å…¶å®ƒæŠ€æœ¯    æ”¯æŒåšé”æŠ€æœ¯ï¼Œå®šå‘I/Oè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå¢å¼ºå‹SpeedStepæŠ€æœ¯ï¼ŒæŒ‰éœ€é…ç”µæŠ€æœ¯ï¼Œæ¸©åº¦ç›‘è§†æŠ€æœ¯ï¼Œèº«ä»½ä¿æŠ¤æŠ€æœ¯ï¼Œæ•°æ®ä¿æŠ¤æŠ€æœ¯ï¼Œå¹³å°ä¿æŠ¤æŠ€æœ¯<br><br>é›†æˆæ˜¾å¡    ä¸æ”¯æŒ<br></p><p>è¿™ä¸ªcpuç°åœ¨æ¥çœ‹å‚æ•°ä¸æ€ä¹ˆæ ·ï¼Œæ€§èƒ½ä¹Ÿå¤§æ¦‚æ¯”i3-8100é«˜ä¸€ç‚¹ï¼Œä½†æ˜¯è¿™çš„ç¡®æ˜¯LGA1155å¹³å°ä¸Šæ€§èƒ½æ¯”è¾ƒé«˜çš„äº†ã€‚ä¸å¸¦é›†æˆæ˜¾å¡ï¼Œè§„æ ¼ä¸»é¢‘å’Œi7 3770kå·®ä¸å¤šï¼Œç”±äºæˆ‘è¿™è¾¹è€ä¸»æ¿æ˜¯b75ï¼Œä¸èƒ½ç»™i7è¶…é¢‘ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡é€‰ã€‚</p><h2 id="è£…æœº"><a href="#è£…æœº" class="headerlink" title="è£…æœº"></a>è£…æœº</h2><p>è£…æœºè¿‡ç¨‹æ²¡æœ‰æ‹æ‘„ï¼Œä¸Šä¸€ç»„è£…æœºæˆåŠŸçš„BIOSæˆªå›¾å§ã€‚<br><img src="/2018/07/06/WIN10-1809éšè—å¤§æ€å™¨-å“è¶Šæ¨¡å¼/2.jpg" alt=""><br>ä¸€æ¬¡æˆåŠŸç‚¹äº®ï¼<br>ç”±äºæˆ‘ä¹°çš„1240v2æ˜¯äºŒå­—å¤´ï¼Œä½“è´¨å¥½ï¼Œå¯ä»¥è°ƒé¢‘ã€‚æœæ–­æŠŠc1ã€c3ã€c6å…³æ‰ï¼ŒèŠ‚ç”µå…³æ‰ï¼Œå†…å­˜è¶…å¯¼1600ï¼Œæ—¶åºé™ä½ä¸€ç‚¹<br><img src="/2018/07/06/WIN10-1809éšè—å¤§æ€å™¨-å“è¶Šæ¨¡å¼/3.jpg" alt=""><br>è®¾ç½®æˆå•æ ¸3.8ghzï¼Œæœ€ä½3.6ghz</p><h3 id="æ¸¸æˆæµ‹è¯•"><a href="#æ¸¸æˆæµ‹è¯•" class="headerlink" title="æ¸¸æˆæµ‹è¯•"></a>æ¸¸æˆæµ‹è¯•</h3><p>æµ‹è¯•ä¸€ä¸‹æˆ‘æœ€è¿‘å–œæ¬¢ç©çš„æ¸¸æˆï¼ŒæƒŠé­‚5ï¼Œç”»è´¨å…¨é«˜<br><img src="/2018/07/06/WIN10-1809éšè—å¤§æ€å™¨-å“è¶Šæ¨¡å¼/4.png" alt=""></p><p><img src="/2018/07/06/WIN10-1809éšè—å¤§æ€å™¨-å“è¶Šæ¨¡å¼/5.png" alt=""></p><p><img src="/2018/07/06/WIN10-1809éšè—å¤§æ€å™¨-å“è¶Šæ¨¡å¼/6.png" alt=""></p><p>å®é™…è¿è¡Œè¡¨æ˜ï¼Œæœ€é«˜å¸§81ï¼Œæœ€ä½62ï¼Œå¯ä»¥æµç•…è¿è¡Œã€‚è€Œè€å¹³å°æœ€ä½51ï¼Œæœ€é«˜72ã€‚æµç•…æ€§æœ‰æ˜¾è‘—æå‡ã€‚</p><h2 id="win10ç”µæºç®¡ç†â€“å“è¶Šæ¨¡å¼"><a href="#win10ç”µæºç®¡ç†â€“å“è¶Šæ¨¡å¼" class="headerlink" title="win10ç”µæºç®¡ç†â€“å“è¶Šæ¨¡å¼"></a>win10ç”µæºç®¡ç†â€“å“è¶Šæ¨¡å¼</h2><p>æ¥ä¸‹æ¥æ˜¯æ ‡é¢˜å†…å®¹äº†~</p><p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼ŒWin10æ›´æ–°1803ä»¥æ¥ï¼Œå¾®è½¯ä¸ä»…å¸¦æ¥äº†ä¸€äº›æ–°åŠŸèƒ½ï¼ˆå’ŒBUGï¼‰ï¼Œè¿˜æ‚„æ‚„åœ°åŠ å…¥äº†ä¸€ä¸ªâ€œå“è¶Šæ€§èƒ½æ¨¡å¼â€ï¼Œå¼€äº†å®ƒï¼ŒCPUç”µå‹ä¼šæ¯”é«˜æ€§èƒ½æ¨¡å¼æ›´ä½ï¼Œä»è€Œå¸¦æ¥ç›¸å¯¹æ›´ä½ä¸€äº›çš„æ¸©åº¦ä»¥åŠç¨³å®šæ€§ï¼Œå¹¶ä¸”å¯¹å†…å­˜è¶…é¢‘ä¹Ÿæœ‰ä¸€å®šå¸®åŠ©</p><h3 id="å¼€å¯"><a href="#å¼€å¯" class="headerlink" title="å¼€å¯"></a>å¼€å¯</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŒ‰Winé”®æœç´¢å¹¶å³é”®ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€[ Windows Powershell ]ï¼Œ<br><img src="/2018/07/06/WIN10-1809éšè—å¤§æ€å™¨-å“è¶Šæ¨¡å¼/7.png" alt=""></p><p>ç„¶åè¾“å…¥powercfg -duplicatescheme e9a42b02-d5df-448d-aa00-03f14749eb61ï¼š</p><p><img src="/2018/07/06/WIN10-1809éšè—å¤§æ€å™¨-å“è¶Šæ¨¡å¼/8.png" alt=""></p><p>é‚£ä¹ˆæ­å–œä½ ï¼Œä½ çš„ç”µè„‘å·²ç»æˆåŠŸå¼€å¯äº†â€œå“è¶Šæ€§èƒ½æ¨¡å¼â€ï¼Œåœ¨ç”µæºé€‰é¡¹ä¸­è½»æ¾æ‰¾åˆ°å®ƒå•¦~</p><p><img src="/2018/07/06/WIN10-1809éšè—å¤§æ€å™¨-å“è¶Šæ¨¡å¼/9.png" alt=""></p><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>æ­¤ç‰‡å®Œäº†~</p><p>å¼€å¯å“è¶Šæ¨¡å¼çš„æ–‡ç« ç½‘ä¸Šä¸€å¤§å †ä¸€å¤§å †çš„ï¼Œè¿™æ¬¡å‘¢é‡ç‚¹è¿˜æ˜¯ä¸»è¦åˆ†äº«ä¸€ä¸‹æˆ‘æ¢cpuçš„æ•…äº‹ã€‚å½“ç„¶ï¼Œâ€œå“è¶Šæ€§èƒ½â€åŸºæœ¬å¯ä»¥ä»£æ›¿â€œé«˜æ€§èƒ½â€æ¨¡å¼ä½¿ç”¨ï¼Œæ¯•ç«Ÿæœ‰äº†ï¼ˆçœ‹èµ·æ¥ï¼‰æ›´å¥½çš„è‡ªç„¶å°±é€‰æ‹©æ›´å¥½çš„äº†ã€‚å¹¶ä¸”éå¸¸æ¨èå–œæ¬¢è¶…è¶…é¢‘ã€ç©ç¡¬ä»¶çš„ç”¨æˆ·ä½¿ç”¨ï¼Œå› ä¸ºç¡®å®æœ‰æ€§èƒ½æå‡ï¼Œèƒ½å¼€å°±å¼€å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt; é“›é“›é“›&lt;/strong&gt;&lt;br&gt;&lt;img src=&quot;/2018/07/06/WIN10-1809éšè—å¤§æ€å™¨-å“è¶Šæ¨¡å¼/1.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;å¼€ç®±&quot;&gt;&lt;a href=&quot;#å¼€ç®±&quot; class=&quot;headerlink&quot; title
      
    
    </summary>
    
    
      <category term="æ—¥å¸¸" scheme="https://tengshe789.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
      <category term="æŠ€æœ¯" scheme="https://tengshe789.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Windows10" scheme="https://tengshe789.github.io/tags/Windows10/"/>
    
  </entry>
  
  <entry>
    <title>=_=æˆ‘çš„ä¸Šä¸€ä¸ªåšå®¢è¢«æ”»å‡»ç˜«ç—ªäº†=_=</title>
    <link href="https://tengshe789.github.io/2018/07/04/HelloWorld/"/>
    <id>https://tengshe789.github.io/2018/07/04/HelloWorld/</id>
    <published>2018-07-04T02:15:23.000Z</published>
    <updated>2019-11-20T13:39:40.562Z</updated>
    
    <content type="html"><![CDATA[<p>  åˆšåˆšç»“æŸæœŸæœ«è€ƒè¯•ï¼Œå‘¼å‘¼(_ã€€_)ã‚œzï½šï¼ºï¼Œç´¯æ­»äº†ã€‚<br><img src="/2018/07/04/HelloWorld/20170226153645068.jpg" alt=""></p><p>ä¸€æƒ³åˆ°åŸæ¥çš„åšå®¢æ²¡æœ‰äº†ï¼Œ<img src="/2018/07/04/HelloWorld/20170226154012235.jpg" alt=""></p><p>è¿˜è¦åœ¨æ­ä¸€ä¸ªï¼Œå°±æ›´ç´¯äº†ï¼</p><p>  ä¸‡äº‹å¼€å¤´éš¾ï¼ŒhelloWorldä¸èƒ½ä¸å†™ã€‚è€Œä¸”å› ä¸ºä¸æ˜¯ç¬¬ä¸€æ¬¡å†™HelloWorldäº†ï¼Œæ‰€ä»¥è¿™æ¬¡å†™çš„ç®€å•ç‚¹å§ã€‚<br><br><img src="/2018/07/04/HelloWorld/20170226153942698.jpg" alt=""></p><p>å“¦ï¼Œå¿˜äº†äº¤ä»£äº†ï¼Œæˆ‘çš„ä¸Šä¸€ä¸ªåšå®¢æŒ‚æ‰äº†ï¼Œ<img src="/2018/07/04/HelloWorld/20170226153729569.jpg" alt=""></p><p>è¢«DDOSæ”»å‡»æ”»å‡»ï¼Œæ”»å‡»å®Œäº†æš‚ä¸”ä¸è¯´ï¼Œç™»é™†å¯†ç åˆè¢«æš´åŠ›ç ´è§£äº†ã€‚å“ï¼Œéš¾å—ï¼Œå›¾çœé’±ä¹°çš„OpenVZæœåŠ¡å™¨ï¼Œæ”»å‡»ååœ¨æ•°æ®ä¸­å¿ƒç®¡ç†å‘˜çš„å‡ ç»ç¡®è®¤ä¸‹ï¼Œè¢«åˆ¤å®šæ­»äº¡ã€‚<br>æ•°æ®æ— æ³•ä¿®å¤ï¼Œå†…æ ¸è¢«ç ´åï¼Œæ— æ³•å¯åŠ¨ã€‚</p><p>è€Œæˆ‘ä¹Ÿæ²¡æœ‰è®¾ç½®å¤‡ä»½ï¼ˆè¿˜ä¸æ˜¯å› ä¸ºæ‡’ï¼ï¼‰ï¼Œé›ªä¸ŠåŠ éœœï¼</p><p>ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•</p><p><strong> æœ¬çˆ¶äº²å¥½éš¾å—ï¼</strong></p><p>ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•ğŸ˜•</p><p>è¿™æ¬¡æˆ‘å­¦ä¹–äº†ï¼Œæ–°çš„åšå®¢æ­å»ºåœ¨GithubPageä¸Šï¼Œé»‘å®¢ä½ ä»¬éšä¾¿æ”»å‡»ï¼Œå¤§ä¸äº†å°±æ²¡æœ‰æµé‡ã€‚å¾…è€å¤«æœ‰é’±äº†ï¼Œå°±å»æ¶ˆè´¹ä¸ªCDNï¼Œçˆ±å’‹åœ°åœ¨åœ°ã€‚</p><p>è¡Œï¼Œå°±è¿™æ ·å§ï¼Œ</p><p><img src="/2018/07/04/HelloWorld/20170226154126642.jpg" alt=""></p><p>æƒ³è¦è§£é”æ›´å¤šæ–°å§¿åŠ¿ï¼Ÿè¯·è®¿é—®<a href="https://blog.tengshe789.tech/" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;  åˆšåˆšç»“æŸæœŸæœ«è€ƒè¯•ï¼Œå‘¼å‘¼(_ã€€_)ã‚œzï½šï¼ºï¼Œç´¯æ­»äº†ã€‚&lt;br&gt;&lt;img src=&quot;/2018/07/04/HelloWorld/20170226153645068.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸€æƒ³åˆ°åŸæ¥çš„åšå®¢æ²¡æœ‰äº†ï¼Œ&lt;img src=&quot;/2018/07/04/H
      
    
    </summary>
    
    
      <category term="æ—¥å¸¸" scheme="https://tengshe789.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
      <category term="åˆ" scheme="https://tengshe789.github.io/tags/%E5%88%9D/"/>
    
  </entry>
  
</feed>
